<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dyspnea Mini Test - -Tmt - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2023-24
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A 68-year-old man with a long history of heavy smoking presents with complaints of shortness of breath and chronic coughing. He is diagnosed with chronic obstructive pulmonary disease and started on regular use of ipratropium bromide. What is the mechanism of action of this drug?",
    "choices": [
      {
        "id": 1,
        "text": "Muscarinic receptor agonist"
      },
      {
        "id": 2,
        "text": "Ganglionic stimulant"
      },
      {
        "id": 3,
        "text": "Acetylcholinesterase inhibitor"
      },
      {
        "id": 4,
        "text": "Muscarinic receptor antagonist"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Ipratropium bromide</strong>&nbsp;acts as a <strong>muscarinic receptor antagonist</strong>.</p>\n<p>It is a semisynthetic derivative of <strong>atropine</strong> and&nbsp;acts selectively on bronchial muscles to produce <strong>bronchodilation</strong>. It is used extensively for&nbsp;acute exacerbations of<strong>&nbsp;</strong><strong>COPD</strong>&nbsp;and rhinorrhea.</p>\n<div class=\"page\" title=\"Page 175\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Ipratropium blocks all subtypes of muscarinic receptors thereby antagonizing the inhibition of ACh release. It is a <strong>short-acting</strong> muscarinic antagonist that is administered in a powdered or nebulized form via <strong>metered dose inhaler</strong> around 3-4 times a day.</p>\n<div class=\"page\" title=\"Page 742\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">Nebulized ipratropium bromide may increase the risk of <strong>glaucoma</strong> in elderly patients and thus cautiously used to avoid exposure of the drug to the eye. <strong>Paradoxical bronchoconstriction</strong> may occur with ipratropium bromide when given along with <strong>hypotonic nebulizer solution</strong> and antibacterial additives, such as benzalkonium chloride and EDTA.</div>\n</div>\n</div>\n</div>\n<p>Other options:</p>\n</div>\n</div>\n</div>\n</div>\n<p>Option A: <strong>Muscarinic receptor agonists </strong>such as <strong>pilocarpine&nbsp;</strong>directly act on the muscarinic receptor to produce actions similar to acetylcholine.&nbsp;</p>\n<p>Muscarinic receptors are those that are selectively stimulated by muscarine and blocked by atropine. They are mainly of three subtypes:&nbsp;<strong>M1 </strong>(increasing intestinal secretions),&nbsp;<strong>M2</strong> (mediates vagal bradycardia), and&nbsp;<strong>M3</strong>&nbsp;(constriction of visceral and bronchial smooth muscles, vasodilatation&nbsp;in vascular endothelium&nbsp;causing&nbsp;penile erection).</p>\n<p>Option B: <strong>Ganglionic stimulants&nbsp;</strong>can be divided into selective nicotinic agonists&nbsp;(nicotine and varenicline) and<strong>&nbsp;</strong><strong>nonselective</strong>/&nbsp;<strong>muscarinic agonists</strong>&nbsp;(acetylcholine and <strong>pilocarpine).</strong></p>\n<p>Option C: <strong>Acetylcholinesterase inhibitors&nbsp;</strong>such as physostigmine, neostigmine, and galantamine inhibit cholinesterase enzyme (protects acetylcholine) and produce cholinergic symptoms.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 1-year-old boy presents with shortness of breath and bluish discoloration of lips. Chest X-ray shows a boot-shaped heart due to an upturned cardiac apex. The finding seen on the chest X-ray is due to:",
    "choices": [
      {
        "id": 1,
        "text": "Right ventricular hypertrophy"
      },
      {
        "id": 2,
        "text": "Left ventricular hypertrophy"
      },
      {
        "id": 3,
        "text": "Left atrial dilatation"
      },
      {
        "id": 4,
        "text": "Right atrial  dilatation"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The clinical description of shortness of breath and bluish discoloration of lips, along with boot-shaped heart on chest X-ray,<strong>&nbsp;</strong>suggests <strong>tetralogy of Fallot </strong>(TOF).&nbsp;The findings of a<strong> boot-shaped heart</strong>&nbsp;due to the&nbsp;<strong>upturned cardiac apex</strong>&nbsp;is due to <strong>right ventricular hypertrophy.</strong></p>\n<p><strong>Tetralogy of Fallot (TOF)</strong>&nbsp;is a&nbsp;<strong>cyanotic</strong> congenital heart condition. The four cardinal features of the<strong> tetralogy of Fallot</strong>&nbsp;are as follows:</p>\n<ul>\n<li>Ventricular septal defect (VSD)</li>\n<li>Obstruction of the right ventricular outflow tract (subpulmonary stenosis)</li>\n<li>An aorta that overrides the ventricular septum</li>\n<li><strong>Right ventricular hypertrophy</strong></li>\n</ul>\n<p>The image given below shows cardinal features seen in TOF:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ebfbf1cd58a9484fb10feeb378f88647x1280x3010.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ec9d20bd1b724292a0c457834f4da982x1200x1419.GIF"
    ]
  },
  {
    "text": "A middle-aged woman with chronic kidney disease presents to the OPD  with exercise intolerance, fatigue, and shortness of breath.  On examination, she is found to have severe pallor.  Which of the following is least likely to be a cause for these findings?",
    "choices": [
      {
        "id": 1,
        "text": "Deficiency of erythropoietin"
      },
      {
        "id": 2,
        "text": "Iron deficiency"
      },
      {
        "id": 3,
        "text": "Hyperparathyroidism"
      },
      {
        "id": 4,
        "text": "Sickle cell anemia"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Sickle cell anemia is not a feature of chronic kidney disease (<strong>CKD</strong>).</p>\n<p>Common causes of <strong>anemia</strong> in CKD include:</p>\n<ul>\n<li><strong>Erythropoietin deficiency</strong></li>\n<li>Diminished red blood cell survival</li>\n<li>Bleeding diathesis</li>\n<li><strong>Iron deficiency</strong></li>\n<li>Vitamin B12 and folate deficiency</li>\n<li><strong>Hyperparathyroidism</strong> (due to bone marrow fibrosis)</li>\n<li>Hemoglobinopathy</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 32-year-old woman presents with abdominal pain, shortness of breath, and vomiting for a few hours. She is on ovulation induction therapy for infertility. The sonogram of both her ovaries is shown below. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Ovarian hyperstimulation syndrome"
      },
      {
        "id": 2,
        "text": "Polycystic ovarian syndrome"
      },
      {
        "id": 3,
        "text": "Hyperreactio luteinalis"
      },
      {
        "id": 4,
        "text": "Hematometra"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The above clinical scenario and the sonogram showing enlarged ovaries meeting in the midline having large cysts are suggestive of <strong>ovarian hyperstimulation syndrome.&nbsp;</strong></p>\n<p>Ovarian hyperstimulation syndrome (OHSS) is characterized by <strong>mul&shy;tiple ovarian follicular cysts</strong> accompanied by <strong>increased capillary permeability.</strong> It happens most often as a complication of <strong>ovulation&shy; induction therapy</strong> for infertility. It occurs due to the<strong>&nbsp;stimulation of</strong> vascular endo&shy;thelial growth factor (<strong>VEGF</strong>) expression in granulosa-lutein cells<strong> by</strong>&nbsp;<strong>hCG</strong>.</p>\n<p>They often present with shortness of breath, abdominal pain, and gastrointestinal disturbances like nausea, vomiting, and oliguria.</p>\n<p><strong>Abdominal pain</strong> occurs due to ovarian enlargement and accumulation of peritoneal fluid.&nbsp;Increased vascular permeability and loss of fluid, protein, and electrolytes into the peritoneal cavity cause <strong>ascites</strong> and result in <strong>hemoconcentration</strong>. Hemoconcentartion causes hyperviscosity and leads to hypercoagulability.&nbsp;&nbsp;</p>\n<p>Hyponatremia, hyperkalemia, leukocytosis, pleural effusion, and pericardial effusion can be associated with OHSS.&nbsp;</p>\n<p>Some of the risk factors for OHSS:</p>\n<ul>\n<li>Polycystic ovarian syndrome</li>\n<li>Young age</li>\n<li>High estradiol during ovulation induction</li>\n<li>Pregnancy</li>\n</ul>\n<p>Classification of ovarian hyperstimulation syndrome</p>\n<table style=\"height: 169px; width: 349px;\">\n<tbody>\n<tr>\n<td style=\"width: 71px; text-align: left;\">Grade I</td>\n<td style=\"width: 257px;\">Abdominal discomfort or distension</td>\n</tr>\n<tr>\n<td style=\"width: 71px; text-align: left;\">Grade II</td>\n<td style=\"width: 257px;\">\n<p>Abdominal discomfort or distension + nausea and vomiting or diarrhea+ Enlarged ovaries (5-12 cm)</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 71px; text-align: left;\">Grade III</td>\n<td style=\"width: 257px;\">Ultrasonographic evidence of ascites</td>\n</tr>\n<tr>\n<td style=\"width: 71px; text-align: left;\">Grade IV</td>\n<td style=\"width: 257px;\">Clinical evidence of ascites/hydrothorax/breathing difficulty</td>\n</tr>\n<tr>\n<td style=\"width: 71px; text-align: left;\">Grade V</td>\n<td style=\"width: 257px;\">All of the above with decreased blood volume, hemoconcentration, diminished renal perfusion and function, and coagulation abnormalities.&nbsp;</td>\n</tr>\n</tbody>\n</table>\n<div class=\"page\" title=\"Page 1214\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<div class=\"page\" title=\"Page 566\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>This condition can be prevented by</p>\n<ul>\n<li>Withholding hCG in a cycle if there are more than 20 follicles on ultrasound and E2 level rises to 3000 pg/ mL.</li>\n<li>Albumin 5% infusion in 500 mL lactated Ringer&rsquo;s solution during and after oocyte retrieval</li>\n<li>Dopamine agonist cabergoline 0.5 mg daily for 8 days starting on day 1 of hCG.</li>\n</ul>\n</div>\n</div>\n</div>\n<p>OHSS is primarily managed with general supportive care. Paracentesis is performed to ameliorate abdominal discomfort and relieve respiratory discomfort.</p>\n<p>Other options:</p>\n<p>Option B-&nbsp;<strong>Polycystic ovarian syndrome</strong>&nbsp;(PCOS) is the most common endocrine disorder of the reproductive age group. Patients with PCOS present with<strong> menstrual</strong> <strong>irregularities, hirsutism, acne</strong>, infertility, etc.</p>\n<p>Sonographic criteria for PCOS include:</p>\n<ul>\n<li>&gt;/= 20 small cysts ( 2 to 9 mm diameter) or,</li>\n<li>Increased ovarian volume (&gt;10 mL), or both</li>\n</ul>\n<p>The ultrasound examination image shown below is of PCOS showing enlarged ovaries with multiple cysts.&nbsp;</p>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/60d005e3613848d89fdd60443eea49ed.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/604d6dd13cb3461687488d4e041b29a9x512x381.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/246ceb2a1d61486998bee2709d934de3x512x247.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/fe381b4a4bd04707b1786578bda1b0a3x358x293.PNG"
    ]
  },
  {
    "text": "A 30-year-old woman presents with shortness of breath and fatigue. She has a medical history of limited cutaneous systemic sclerosis. Her pulmonary function test results are given below. What is the most probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Pulmonary artery hypertension"
      },
      {
        "id": 2,
        "text": "Interstitial lung disease"
      },
      {
        "id": 3,
        "text": "Congestive heart failure"
      },
      {
        "id": 4,
        "text": "Bronchiectasis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The above PFT pattern shows <strong>near-normal FVC</strong>, <strong>increased FEV1%,</strong> and <strong>markedly</strong>&nbsp;<strong>decreased DLCO</strong>. This along with the given history is suggestive of&nbsp;<strong>pulmonary artery hypertension</strong>(PAH). It is more commonly associated with&nbsp;<strong>limited cutaneous systemic sclerosis</strong>.</p>\n<p>Option B: Interstitial lung disease is a restrictive lung disease. In ILD, the FVC is usually,<strong>&lt;80%</strong> of the predicted value. It is more commonly associated with <strong>diffuse cutaneous systemic sclerosis</strong>.</p>\n<p>Options C and D: Congestive heart failure and bronchiectasis have obstructive pathology. They would have decreased FEV1% and normal DLCO.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ce1a98738515471db75429cf0dae9e35.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 42-year-old woman with history of squamous cell carcinoma lung presents with shortness of breath. Her chest X-ray is shown below. Which among the following is the most probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Right upper lobe collapse"
      },
      {
        "id": 2,
        "text": "Right lower lobe collapse"
      },
      {
        "id": 3,
        "text": "Left upper lobe collapse"
      },
      {
        "id": 4,
        "text": "Left lower lobe collapse"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given X-ray shows the <strong>golden S sign</strong> which is seen in the <strong>right upper lobe collapse.</strong></p>\n<p><strong>Golden S-sign</strong>&nbsp;is seen on both PA chest radiographs and on CT scans in the right upper lobe collapse. It is named because this sign resembles a reverse S shape, and is therefore sometimes referred to as the&nbsp;reverse S-sign of Golden.&nbsp;</p>\n<p>Although typically seen with the&nbsp;<strong>right upper lobe collapse</strong>, the S-sign can also be seen with the collapse of other lobes. It is created by a central mass obstructing the upper lobe bronchus. It should raise suspicion of a primary&nbsp;<strong>bronchogenic carcinoma</strong>. It can also be caused by other central masses, such as metastasis, primary mediastinal tumor, or enlarged lymph nodes.</p>\n<p>The additional finding in this X-ray is the presence of calcified breast implants.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/04e640911cb84548a3bc4296fa97c487.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1430e2fc6ec94ec088c0534260a14729x657x598.PNG"
    ]
  },
  {
    "text": "Helen is a 78-year-old woman who is a smoker for the past 30 years and has a history of angina. She presents to your accident and emergency (A&E) department with chest pain worse on inspiration and shortness of breath. Her ECG shows signs of:",
    "choices": [
      {
        "id": 1,
        "text": "Premature atrial contractions"
      },
      {
        "id": 2,
        "text": "Pulmonary embolism"
      },
      {
        "id": 3,
        "text": "AV nodal re-entrant tachycardia"
      },
      {
        "id": 4,
        "text": "Atrial flutter"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<ul>\n<li>The ECG changes are classic of <strong>pulmonary embolism</strong> showing <strong>S1Q3T3.</strong></li>\n</ul>\n<p><strong>ECG findings in pulmonary embolism</strong></p>\n<ul>\n<li>Sinus tachycardia</li>\n<li>Complete or incomplete RBBB (seen in the given ECG also)</li>\n<li><strong>S1Q3T3: deep S wave in lead I, Q wave in III, inverted T wave in III</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/03361c938c3b406693a6640cf9c58811.JPEG"
    ],
    "explanation_images": [
      "https://cdn1.dailyrounds.org/uploads/b9bee1a209c34343b68cd2bbf5664b43x357x171.PNG"
    ]
  },
  {
    "text": "An elderly man is diagnosed with ischemic heart disease and is started on propranolol. After some days, he is brought to the emergency department with a history of difficulty in breathing. He says that he is a smoker and has had difficulty breathing for the past several years. However, it has worsened after taking propranolol. The mechanism that is mainly responsible for worsening his breathing difficulty is",
    "choices": [
      {
        "id": 1,
        "text": "Beta 1 blockade"
      },
      {
        "id": 2,
        "text": "Beta 2 blockade"
      },
      {
        "id": 3,
        "text": "Alpha 1 blockade"
      },
      {
        "id": 4,
        "text": "Alpha 2 blockade"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In the given clinical scenario, the symptoms of respiratory difficulty in the patient have worsened after the intake of propranolol. The mechanism that is mainly responsible for worsening his breathing is&nbsp;<strong>&beta;<sub><span class=\"s1\">2 </span></sub><span class=\"s1\">blockade.&nbsp;</span></strong>Propranolol is a&nbsp;<strong>non-selective</strong>&nbsp;<strong>beta-blocker</strong>. It blocks the&nbsp;<strong>&beta;<sub><span class=\"s1\">2 </span></sub>receptors</strong> in bronchial smooth muscle and prevents bronchodilation. Therefore, it should not be given to patients who have asthma and chronic obstructive pulmonary disease.</p>\n<p>Other important side effects of beta-blockers are:</p>\n<ul>\n<li>Cardiovascular system-&nbsp;\n<ul>\n<li>Beta blockade decreases myocardial contractility. Therefore, it can <strong>exacerbate decompensated heart failure.</strong></li>\n<li>Decreased heart rate- Bradycardia, In patients with heart block it can cause fatal <strong>bradyarrhythmias</strong></li>\n<li class=\"p1\">Abrupt discontinuation of &beta; receptor antagonists after long-term treatment can exacerbate angina</li>\n</ul>\n</li>\n<li>Respiratory system- <strong>bronchospasm</strong> due to <strong>blockade of&nbsp;&beta;<sub><span class=\"s1\">2&nbsp;</span></sub></strong><span class=\"s1\"><strong>receptors</strong> in the bronchial smooth muscles</span><strong><span class=\"s1\">.</span></strong></li>\n<li>Central nervous system- <strong>fatigue, sleep disturbances, and depression</strong>.</li>\n<li>Exacerbation of peripheral artery disease occurs due to the blockade of&nbsp;&beta;<sub><span class=\"s1\">2&nbsp;</span></sub><span class=\"s1\">receptors in the vascular smooth muscles.</span></li>\n<li>It can slow the recovery from insulin-induced hypoglycemia as they inhibit catecholamine-mediated glycogenolysis.</li>\n<li>This class of drugs is also known to mask the hypoglycemia symptoms in diabetic patients. The symptoms of hypoglycemia&nbsp;which are <strong>mediated by the adrenaline release</strong> will be masked as <strong>beta-blockers will not allow adrenaline to react and interact with its beta 1 receptor</strong>.&nbsp;&nbsp;</li>\n<li><strong>Hyperkalemia</strong>- blockade of&nbsp;&beta;<sub><span class=\"s1\">2&nbsp;</span></sub><span class=\"s1\">receptors prevents the entry of extracellular potassium into the cells.</span></li>\n<li><span class=\"s1\">Sexual dysfunction in males</span></li>\n<li><span class=\"s1\">They can also alter the serum triglyceride and HDL-cholesterol concentrations. Beta-blockers such as&nbsp;atenolol,&nbsp;metoprolol, and&nbsp;propranolol increase the levels of&nbsp;triglycerides and decrease the levels of high-density lipoprotein (HDL) cholesterol. Other beta-blockers like labetalol, pindolol, and acebutolol do not have any effect on lipid levels.</span></li>\n</ul>\n<p>Autonomic innervation of the lung.</p>\n<p><strong>Relaxation</strong> of the tracheal and bronchial smooth muscles is brought by&nbsp;<strong>&beta;<sub><span class=\"s1\">2&nbsp;</span></sub></strong><span class=\"s1\"><strong>receptors.&nbsp;Contraction</strong> is by the <strong>M2 and M3</strong> cholinergic receptors. Therefore, important drugs that used for bronchodilation are&nbsp;</span></p>\n<ul>\n<li><span class=\"s1\"><strong>&beta;<sub>2&nbsp;</sub></strong>selective <strong>agonists</strong> like salbutamol, terbutaline, salmeterol, formoterol, etc,</span></li>\n<li><span class=\"s1\"><strong>Antimuscarinic agents</strong> like <strong>ipratropium bromide, tiotropium</strong>,&nbsp;</span>aclidinium, and umeclidinium.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A young farmer on a hike developed sudden shortness of breath, chest pain, and cough with salty phlegm. He was rushed to the emergency and stabilized. A CT scan showed the following. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Ruptured hydatid cyst"
      },
      {
        "id": 2,
        "text": "Acute pulmonary edema"
      },
      {
        "id": 3,
        "text": "Acute respiratory distress syndrome"
      },
      {
        "id": 4,
        "text": "Acute mountain sickness"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario and the CT image showing<strong>&nbsp;</strong>the<strong> 'water lily sign'</strong>&nbsp;is suggestive of a <strong>ruptured</strong>&nbsp;<strong>pulmonary</strong>&nbsp;<strong>hydatid cyst</strong><strong>.</strong></p>\n<p><strong>Hydatid disease</strong>&nbsp;or echinococcosis is a&nbsp;zoonotic infection&nbsp;caused by the&nbsp;<strong><em>Echinococcus</em>&nbsp;</strong>species of&nbsp;flatworms. Its life cycle consists of <strong>dogs</strong> as <strong>definitive hosts</strong> and <strong>humans</strong> as <strong>intermediate hosts</strong>.</p>\n<p>Primary hydatid cysts <strong>most commonly</strong> occur in the<strong>&nbsp;liver.&nbsp;</strong>Most patients are asymptomatic but when symptomatic, the patient presents with hepatomegaly, pain, and obstructive jaundice.</p>\n<p>The<strong> 2nd most common site</strong> is the&nbsp;<strong>lung</strong>, specifically the lower lobe of the right lung. Symptomatic patients present with<strong> cough</strong> with<strong> salty</strong> <strong>phlegm</strong>, fever, <strong>chest pain,</strong> and, hemoptysis. <strong>Silent cysts</strong> may present as an <strong>emergency</strong> due to <strong>rupture.</strong></p>\n<p><strong>Computed tomography</strong>&nbsp;(CT) scan is accurate for detecting<strong>&nbsp;</strong>hydatid cysts. If there is disruption of the inner layers of the cyst, the following signs may be noted:</p>\n<ul>\n<li><strong>Water lily sign/ camalote sign</strong>&nbsp;- air-fluid level with a floating membrane (as shown below)</li>\n<li><strong>Rising sun sign/ serpent</strong>&nbsp;<strong>sign</strong> - a&nbsp;double-wall, dry cyst with crumpled membranes lying at its bottom&nbsp;</li>\n<li><strong>Empty cyst sign -&nbsp;</strong>when all the contents are removed&nbsp;</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/512ea5cd21fd4f2cb65989afcb7eac19.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0c6767ecf5d447ab963e1e0dc7b590eex720x961.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0e9cc0fd93074ad1a32ef86427734ffax720x477.JPEG"
    ]
  },
  {
    "text": "A woman from rural South America presents with fever, shortness of breath, and swelling of the eyelids. Echocardiography reveals biventricular dilatation, with massive cardiac enlargement. The image of the vector responsible for transmitting the disease is given below. Name the vector.",
    "choices": [
      {
        "id": 1,
        "text": "Dermacentor tick"
      },
      {
        "id": 2,
        "text": "Soft tick"
      },
      {
        "id": 3,
        "text": "Reduviid bug"
      },
      {
        "id": 4,
        "text": "Tsetse fly"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The above clinical scenario, along with echocardiography findings of <strong>dilated cardiomyopathy,</strong> are suggestive of <strong>Chagas disease</strong>.&nbsp;It is caused by <em><strong>Trypanosoma cruzi. </strong></em>The vector responsible for the&nbsp;transmission is the&nbsp;<strong>reduviid bug.&nbsp;</strong></p>\n<div class=\"page\" title=\"Page 728\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Transmission occurs by the rubbing of the feces of the&nbsp;reduviid bug into bite wounds or eye, blood transfusion, and transplacental spread.</p>\n</div>\n</div>\n</div>\n</div>\n<p><strong>Chagas disease</strong> is&nbsp;endemic to <strong>North, Central, </strong>and <strong>South America. </strong><em>Trypanosoma cruzi</em> exists in three forms:</p>\n<ul>\n<li><strong>Epimastigotes</strong>- in the reduviid bug</li>\n<li><strong>Trypomastigotes-</strong> in the bloodstream</li>\n<li><strong>Amastigotes-&nbsp;</strong>intracellular replicating form</li>\n</ul>\n<p>Clinically, the infection course of Chagas disease is divided into acute and chronic phases.</p>\n<p>In the acute phase, the majority of the patients will be asymptomatic.&nbsp;Fever, regional lymphadenitis, <strong>chagoma </strong>(localized subcutaneous nodule at the bite site), and the <strong>Romana's sign </strong>(unilateral swelling of the eyelids) may be seen.</p>\n<p>The chronic phase is characterized by the following findings:</p>\n<ul>\n<li><strong>Chagasic dilated cardiomyopathy</strong> with&nbsp;marked <strong>bilateral ventricular enlargement.</strong> This may lead to congestive heart failure presenting as <strong>shortness of breath.</strong> Endomyocardial biopsy shows fibrosis and the presence of intracellular parasites.</li>\n<li><strong>Megaesophagus</strong> and <strong>megacolon</strong>.&nbsp;</li>\n</ul>\n<div class=\"page\" title=\"Page 728\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Diagnosis is confirmed by demonstrating trypomastigotes on microscopy of blood smears or polymerase chain reactions during the acute phase. In the chronic phase, detection of <em>anti-T. cruzi </em>IgG or endomyocardial biopsy is helpful.</p>\n</div>\n<div class=\"column\">\n<p>Treatment<span data-preserver-spaces=\"true\">&nbsp;of Chagas disease is most effective when administered&nbsp;</span><strong><span data-preserver-spaces=\"true\">early</span></strong><span data-preserver-spaces=\"true\">&nbsp;in the course of infection</span><span data-preserver-spaces=\"true\">&nbsp;and has a lesser efficacy in chronic Chagas.&nbsp;</span><strong>Benznidazole</strong> and<strong>&nbsp;nifurtimox</strong> can be used for the treatment.</p>\n</div>\n</div>\n</div>\n</div>\n<p>The image below shows Romana's sign.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3019a8feda7342ee83171de440e5b1fe.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9e08b1114ff04d428d1997e966b68f3ax250x169.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d342af277a324a33b0b3042b2baf21c9x800x450.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/21155649b31c4c3fbc660c7cc860de0cx564x600.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/41202a7328ba48d6b616ec99482a88c1x720x480.JPEG"
    ]
  },
  {
    "text": "A  patient with shortness of breath is diagnosed to have acute pulmonary edema. His chest X-ray, on PA view, revealed lines in the periphery of the lungs that are perpendicular to the pleural surface. What are these lines?",
    "choices": [
      {
        "id": 1,
        "text": "Kerley B lines"
      },
      {
        "id": 2,
        "text": "Kerley D lines"
      },
      {
        "id": 3,
        "text": "Kerley A lines"
      },
      {
        "id": 4,
        "text": "Kerley C lines"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Lines in the periphery of the lungs that are perpendicular to the pleural surface in a patient with pulmonary edema are suggestive of <strong>Kerley B lines.</strong></p>\n<p>Kerley lines are septal lines that are seen when the&nbsp;interlobular septa&nbsp;in the pulmonary interstitium become prominent. It can be due to<strong>&nbsp;</strong>lymphatic engorgement&nbsp;or&nbsp;edema of the connective tissues&nbsp;of the interlobular septa. These are usually seen when the&nbsp;pulmonary capillary wedge pressure reaches<strong> 20-25 mmHg</strong>.</p>\n<p>Types of Kerley lines:&nbsp;</p>\n<p><strong>Kerley A lines</strong>- They extend <strong>radially from the hilum to the upper lobes </strong>and&nbsp;cross the normal vascular markings.<strong>&nbsp;</strong>These are oblique lines that are &lt;1 mm thick, 2-6cm long, and course towards the hila.&nbsp;They represent thickened interlobular septa&nbsp;that contain lymphatic connections between the perivenous and bronchoarterial lymphatics in the lung parenchyma. The best modality for the demonstration of Kerley A-lines is <strong>HRCT</strong>.</p>\n<p><strong>Kerley B-lines&nbsp;</strong>- These are seen in the periphery of the lungs and are seen&nbsp;<strong>perpendicular to the pleural surface. </strong>These are thin 1-2 cm long lines. These are usually seen at the lung bases and represent thickened subpleural interlobular septa.</p>\n<p><strong>Kerley C-lines - </strong>These&nbsp;are short lines that do not reach the pleura (i.e. not B or D lines) and do not course radially away from the hila (i.e. not A-lines).</p>\n<p><strong>Kerley D-lines -</strong> These<strong>&nbsp;</strong>are the same as Kerley B lines, except that they are seen on lateral chest radiographs in the retrosternal air gap (the lucent area behind the sternum).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ccd13e7c69654337846386abf14e82d6x742x1024.JPEG"
    ]
  },
  {
    "text": "A 17-year-old Chinese boy presented with prolonged fatigue, shortness of breath, and swelling in the legs. His echocardiography was suggestive of dilated cardiomyopathy. Which of the following nutritional deficiencies can explain his condition?",
    "choices": [
      {
        "id": 1,
        "text": "Molybdenum"
      },
      {
        "id": 2,
        "text": "Manganese"
      },
      {
        "id": 3,
        "text": "Zinc"
      },
      {
        "id": 4,
        "text": "Selenium"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The patient is probably suffering from<strong>&nbsp;Keshan's disease, </strong>which is due to<strong>&nbsp;selenium deficiency.</strong><strong>&nbsp;</strong>It is endemic&nbsp;dilated&nbsp;<strong>cardiomyopathy</strong> that affects children and women of childbearing age in some areas in China.</p>\n<p>The nutritional deficiencies that can lead to cardiomyopathy are:</p>\n<ul>\n<li>Thiamine</li>\n<li>Selenium</li>\n<li>Carnitine</li>\n<li>Calcium</li>\n<li>Phosphate</li>\n<li>Magnesium</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A middle-aged woman presented to you with shortness of breath and dry cough for the past 3 months. On examination, the following skin lesions were seen. You will order all of the following investigations except:",
    "choices": [
      {
        "id": 1,
        "text": "Serum angiotensin converting enzyme levels"
      },
      {
        "id": 2,
        "text": "CD4/CD8 counts in the blood"
      },
      {
        "id": 3,
        "text": "Biopsy of the lymph nodes"
      },
      {
        "id": 4,
        "text": "Gallium scan"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario and examination findings of <strong>erythema nodosum</strong> are suggestive of <strong>sarcoidosis</strong>.&nbsp;<strong>CD4/CD8 ratio in bronchoalveolar lavage</strong> (BAL) fluid, <strong>not blood</strong>, is used for diagnosis of sarcoidosis.</p>\n<p>Erythema nodosum is inflammation of the subcutaneous fat (panniculitis) seen in sarcoidosis.</p>\n<p>The investigations used in the diagnosis of sarcoidosis include:</p>\n<ul>\n<li>Serum<strong> ACE</strong> (angiotensin-converting enzyme) levels&nbsp;- elevated</li>\n<li>BAL- lymphocytosis and increased&nbsp;CD4/CD8 ratio. A ratio of <strong>&gt;3.5 </strong>in BAL&nbsp;is strongly supportive of sarcoidosis.</li>\n<li><strong>PET-CT</strong> scan<strong> -&nbsp;</strong>to identify areas of granulomatous disease</li>\n<li><strong>Gallium scan</strong>&nbsp;shows the following signs:\n<ul>\n<li><strong>Panda sign-&nbsp;</strong>due to bilateral involvement of parotid and lacrimal&nbsp;glands in sarcoidosis</li>\n<li><strong>Lambda sign-&nbsp;</strong>due to&nbsp;bilateral hilar and right paratracheal lymph nodes&nbsp;which resembles lambda (&lambda;)</li>\n</ul>\n</li>\n<li><strong>Biopsy</strong>&nbsp;showing non-caseating granulomas in a patient with features of sarcoidosis confirms the diagnosis.</li>\n</ul>\n<p>The image given below shows the Panda sign:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/897c632cd7554555b86daaee54002eee.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/de1d5da24b3e4eb5b78552a2a99de166x720x602.PNG"
    ]
  },
  {
    "text": "A 50-year-old man with a history of smoking for the past 30 years is admitted to the ward with cough and shortness of breath. The spirometry result is given below. Which of the following physical finding is unlikely to be associated with his condition?",
    "choices": [
      {
        "id": 1,
        "text": "Cyanosis"
      },
      {
        "id": 2,
        "text": "Barrel chest"
      },
      {
        "id": 3,
        "text": "Loss of subcutaneous adipose tissue"
      },
      {
        "id": 4,
        "text": "Clubbing"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical scenario of a patient with a <strong>history of smoking</strong> for the past 30 years now presenting with <strong>cough</strong> and <strong>shortness of breath</strong>, with the <strong>spirometry</strong> showing an <strong>obstructive pattern</strong> (<strong>coved in appearance</strong> of the expiratory limb) suggests <strong>chronic obstructive pulmonary disease (COPD)</strong>. <strong>Clubbing</strong> is <strong>not</strong> a physical finding <strong>seen in COPD</strong>.</p>\n<p><strong>Patients</strong> with COPD <strong>present</strong> <strong>with</strong> <strong>cough</strong>, <strong>sputum production</strong>, and <strong>dyspnea</strong> on exertion. General physical examination may show <strong>cyanosis</strong> (option A) in the lips and the nail beds. COPD is also accompanied by <strong>severe weight loss</strong> due to the <strong>loss of subcutaneous adipose tissue</strong> (option C). This occurs <strong>due to</strong> inadequate food intake and <strong>high inflammatory cytokines</strong> such as <strong>TNF-\u03b1</strong>.</p>\n<p>On <strong>respiratory examination</strong>, a prolonged expiratory phase and an <strong>expiratory wheeze</strong> may be noted.<strong> Hyperinflation of the lungs </strong>gives rise to the characteristic<strong> barrel-shaped chest</strong> (option B) seen in these patients. Severe airflow limitation causes the patients to sit in a tripod position to and <strong>use the accessory muscles</strong> of respiration.\u00a0</p>\n<p><strong>Clubbing</strong> of the digits is <strong>not</strong> a <strong>sign of COPD</strong>. Its <strong>presence</strong> in a chronic smoker with COPD most commonly <strong>indicates</strong> the <strong>development of lung cancer</strong> in such a patient.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/4e857c3dc712454db9346adbbcc8c5e3.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/cb15cb269c724a80a2c3146ac92b8590x1280x4291.JPEG"
    ]
  },
  {
    "text": "An infant presents to the emergency department due to difficulty breathing, constipation, and anorexia. Upon examination, the physician notes flaccid paralysis. A toxin screen of the stool identified the agent. What is the mechanism of action of the toxin?",
    "choices": [
      {
        "id": 1,
        "text": "ADP ribosylation of eukaryotic elongation factor 2 (eEF-2)"
      },
      {
        "id": 2,
        "text": "ADP ribosylation of Gi"
      },
      {
        "id": 3,
        "text": "ADP ribosylation of GTP-binding protein"
      },
      {
        "id": 4,
        "text": "Blocks release of acetylcholine"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The characteristic clinical history of <strong>flaccid paralysis</strong>, <strong>constipation</strong>, <strong>difficulty</strong> breathing, <strong>tox screen of stool</strong>, and age are suggestive of <strong>infant botulism </strong>(also called floppy baby syndrome) caused by <strong>Clostridium botulinum.</strong></p>\n<p>The <strong>flaccid paralysis</strong> is due to the toxin that blocks the release of <strong>acetylcholine</strong>.</p>\n<p>Clostridium botulinum in adults causes <strong>food poisoning</strong>.</p>\n<p><strong>Other options:</strong></p>\n<p><strong>Option a: </strong>ADP ribosylation of eukaryotic elongation factor 2 (eEF-2) describes toxins found in Corynebacterium diphtheriae and Pseudomonas aeruginosa.</p>\n<p><strong>Option b: </strong>ADP ribosylation of Gi, an inhibitory subunit of the G protein describes Bordetella pertussis.</p>\n<p><strong>Option c: </strong>ADP ribosylation of GTP-binding protein describes the toxins found in ETEC and Vibrio cholerae.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 45-year-old man comes to the hospital with complaints of difficulty breathing. Chest X-Ray shows \"eggshell\" calcification. Histopathology of the lung shows the following. What is the most likely diagnosis in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Silicosis"
      },
      {
        "id": 2,
        "text": "Asbestosis"
      },
      {
        "id": 3,
        "text": "Hamartoma"
      },
      {
        "id": 4,
        "text": "Tuberculosis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>This patient's radiological and histopathological features are seen in<strong> silicosis.</strong></p>\n<p>Eggshell calcification&nbsp;refers to the fine rim of calcification seen at the periphery of a mass (usually a lymph node)</p>\n<p><strong>Silicotic&nbsp;nodules</strong> are characterized by concentrically arranged hyalinized collagen fibers surrounding an amorphous center in the hilar lymph nodes and the upper zones of the lungs.</p>\n<p>When it is rimmed by thin sheets of calcification in the lymph nodes, they are appreciated <strong>radiographically as &ldquo;eggshell&rdquo; calcification.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/bcb5dbad081e4feabae5bf92e063ee5b.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6c323a2b8bc24ed882a2cb15ddde10bex1024x683.JPEG"
    ]
  },
  {
    "text": "The parents notice that their child is tired and that he has shortness of breath on climbing stairs and while lying down. What is the first investigation that you would do?",
    "choices": [
      {
        "id": 1,
        "text": "Echocardiogram"
      },
      {
        "id": 2,
        "text": "Chest x-ray"
      },
      {
        "id": 3,
        "text": "Spirometry"
      },
      {
        "id": 4,
        "text": "MRI to rule out enlarged heart"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The first investigation to be done for a child who feels shortness of breath on climbing stairs and in the supine position is a <strong>chest x-ray</strong>.</p>\n<p>The child having shortness of breath on climbing stairs is known as <strong>dyspnea on exertion</strong>. The most common cause is <strong>congestive heart failure</strong>.&nbsp;The child feeling&nbsp;shortness of breath&nbsp;in the <strong>supine</strong> position is <strong>or</strong><strong>thopnea</strong>. It is relieved on sitting or standing.</p>\n<p>Respiratory causes include asthma, chronic obstructive pulmonary disorder (COPD), pneumonia, and pulmonary embolism. Cardiovascular causes include congestive heart failure(CHF), pulmonary edema, valvular heart defect, and pulmonary hypertension.&nbsp;</p>\n<p>Evaluation begins with assessing the airway, breathing, and circulation of the patient. <strong>Oxygen saturation</strong> can appear normal at rest, and hence oxygen saturation during physical activity should be obtained. A <strong>chest x-ray</strong> is the <strong>first diagnostic test</strong>&nbsp;which can show pulmonary pathology or pumonary edema and other signs of CHF that could help in identifying the cause and further evaluation.</p>\n<p>Other options:</p>\n<p>Option A: An <strong>echocardiogram</strong> can be done if the chest X-ray is abnormal. It is done to evaluate <strong>cardiac function</strong>, valvular function, and pericardial space.</p>\n<p>Option C: <strong>Spirometry</strong> is done when the chest x-ray is normal. It is done to determine<strong> lung function</strong>. Abnormal spirometry can indicate either an obstructive pathology such as asthma, or COPD or a restrictive disease such as interstitial fibrosis.&nbsp;</p>\n<p>Option D: <strong>Cardiac MRI </strong>(Magnetic resonance imaging)<strong>&nbsp;</strong>is an emerging modality done to look for <strong>cardiomegaly</strong>. It is for the accurate evaluation of left and right ventricular mass, size, and function. It is also used for localizing ischemic and non-ischemic causes such as myocarditis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A man presented with salt and pepper skin changes on his chest and back and with shortness of breath. A CT revealed fibrotic changes in the lower lobe of both the lungs. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Rheumatoid arthritis"
      },
      {
        "id": 2,
        "text": "Systemic lupus erythematosus"
      },
      {
        "id": 3,
        "text": "Dermatomyositis"
      },
      {
        "id": 4,
        "text": "Systemic sclerosis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Salt-and-pepper appearance is characterized by the presence of <strong>patchy hypopigmentation</strong> and<strong> hyperpigmentation</strong> of the skin manifesting as <strong>depigmentation</strong> with<strong> perifollicular pigmentary retention. </strong>This along with lung fibrosis is seen in <strong>systemic sclerosis.</strong></p>\n<p>This appearance may also be seen&nbsp;in areas of repigmentation in lesions of vitiligo.</p>\n<p>The image below shows salt and pepper appearance of skin over the abdomen seen in systemic sclerosis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8691e2a4bd894688894107baf1891e92x357x535.PNG"
    ]
  },
  {
    "text": "A 21-year-old female presented with shortness of breath and pleuritic chest pain. Chest X-ray revealed pulmonary metastases as shown in the image below. Which of the following primary tumours is most likely possible?",
    "choices": [
      {
        "id": 1,
        "text": "Choriocarcinoma"
      },
      {
        "id": 2,
        "text": "Osteosarcoma"
      },
      {
        "id": 3,
        "text": "Carcinoma of the cervix"
      },
      {
        "id": 4,
        "text": "Soft tissue sarcoma"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The X-ray shows numerous <strong>calcified pulmonary</strong> metastases, which is commonly seen usually due to <strong>osteosarcoma</strong>.</p>\n<p><strong>Pulmonary metastases</strong> usually occur from thee <strong>primary tumours</strong> involving the breast, GI tract, kidney, testes; head and neck tumours or bone and soft tissue sarcomas.&nbsp;The metastases may spread either through a <strong>haematogenous</strong> route (common) or a <strong>lymphatic</strong> and <strong>endobronchial</strong> route (rare).</p>\n<p><strong>Radiological features</strong> of pulmonary metastases:</p>\n<p>&nbsp;</p>\n<p><strong>A. Haematogenous metastases:</strong> They usually appear as multiple discrete pulmonary nodules measure up to a few cms in size.</p>\n<p style=\"padding-left: 30px;\"><strong>Appearance</strong>:</p>\n<ul>\n<li>The nodules are usually spherical, with a <strong>well-defined margin</strong>. However, an <strong>irregular edge</strong> may be seen with <strong>metastatic adenocarcinoma,&nbsp;</strong>and an <strong>ill-defined margin</strong> is suggestive of haemorrhage, classically <strong>choriocarcinoma</strong>&nbsp;(option a).</li>\n<li><strong>Cavitation</strong> of the pulmonary nodules may be seen with metastatic squamous carcinoma, such as <strong>carcinoma of the cervix</strong>&nbsp;(option c).</li>\n<li><strong>Calcification&nbsp;</strong>is rarely seen. If present, it is commonly due to <strong>osteosarcoma.</strong>&nbsp;Rarely, calcified deposits may be seen due to chondrosarcoma or mucinous adenocarcinoma.</li>\n</ul>\n<p style=\"padding-left: 30px;\"><strong>Location:</strong></p>\n<ul>\n<li>Metastases are usually <strong>bilateral,</strong> and within the <strong>sub-pleural region,</strong> where the tumour cells are trapped in the smallest vessels.</li>\n<li>The pulmonary nodules may be seen predominantly in the <strong>bases</strong> due to greater <strong>gravitational perfusion.</strong></li>\n<li>Presence of pneumothorax together with cavitation of subpleural metastases may occur due to a <strong>soft-tissue sarcoma</strong>&nbsp;(option d)<strong>.</strong></li>\n</ul>\n<p>&nbsp;</p>\n<div class=\"page\" title=\"Page 96\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>B. Endobronchial metastases:</strong></p>\n<ul>\n<li>They are <strong>rare</strong> and may occur due to primaries such as melanoma, renal, colorectal and breast carcinomas.</li>\n<li>The metastases may appear as a hilar mass, with or without airway obstruction.</li>\n</ul>\n<p>&nbsp;</p>\n<p><strong>C. Miliary metastases:</strong></p>\n<ul>\n<li>They appear as multiple, small parenchymal nodules measuring approximately 2 mm in size, resembling <strong>'millet seeds'.</strong></li>\n<li>They are rare and may be seen with <strong>thyroid</strong> and <strong>renal</strong> carcinomas.</li>\n</ul>\n<p>&nbsp;</p>\n<p><strong>D. Tumor emboli:</strong></p>\n<ul>\n<li>In rare cases, the tumour emboli may block pulmonary arteries leading to <strong>pulmonary arterial hypertension.</strong></li>\n<li>It may occur in primaries such as <strong>hepatocellular carcinoma,&nbsp;</strong>or tumours involving breast, renal, stomach, prostate, or <strong>choriocarcinoma.</strong></li>\n</ul>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/afbf4992b1344561a606bc1cd7297f66.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A  58-year-old man presented to the casualty with complaints of increasing shortness of breath, lightheadedness, and palpitations. He had an irregularly irregular pulse and blood pressure was 120/70mm Hg. His ECG is given below. What is the treatment of choice?",
    "choices": [
      {
        "id": 1,
        "text": "Immediate defibrillation"
      },
      {
        "id": 2,
        "text": "Synchronized cardioversion"
      },
      {
        "id": 3,
        "text": "IV adenosine"
      },
      {
        "id": 4,
        "text": "IV ibutilide"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The patient is in <strong>atrial fibrillation</strong> but his <strong>hemodynamic status is normal</strong>. So the <strong>treatment of choice </strong>is<strong> IV Ibutilide.</strong></p>\n<p>Ibutilide is a<strong> class III antiarrhythmic drug</strong> that has a rapid onset of action. It restores sinus rhythm by prolonging the action potential duration and effective refractory period.</p>\n<p>It is administered at a dose of <strong>1 mg over 10 minutes</strong>. If necessary, a second dose can be administered 10 minutes after the first.</p>\n<p>If there is evidence of <strong>hemodynamic</strong> <strong>deterioration</strong>, immediate <strong>cardioversion</strong> is the treatment of choice.</p>\n<p>Cardioversion is a <strong>synchronized</strong> administration of shock as the timing is typically synchronized with the&nbsp;<strong>R waves or QRS complex</strong> of a cardiac cycle. On the other hand,&nbsp;random administration of shock anywhere in between a cardiac cycle is termed as Defibrillation which is non-synchronized.</p>\n<p>However, the mechanism for both processes is quite similar. The electric current is made to travel from the negative to the positive electrode in such a way that it traverses the <strong>entire myocardium at once</strong> to conduct a simultaneous contraction of each cell of the heart muscle. It is made to interrupt any ongoing abnormal electrical activity by terminating it so that the sinus node can take back the charge and resume its normal pacemaker activity.</p>\n<table style=\"width: 642.671875px; height: 140px;\">\n<tbody>\n<tr>\n<td style=\"width: 323px;\">Indications for electrical cardioversion</td>\n<td style=\"width: 312.671875px;\">Indications for defibrillation</td>\n</tr>\n<tr>\n<td style=\"width: 323px;\">\n<div class=\"topbullet\">\n<p><span style=\"color: #000000;\"><strong>Supraventricular tachycardia</strong></span></p>\n<p><span style=\"color: #000000;\">(atrioventricular nodal reentrant tachycardia [AVNRT] and atrioventricular reentrant tachycardia [AVRT])</span></p>\n</div>\n<div class=\"topbullet\">\n<p><strong><span style=\"color: #000000;\">Atrial fibrillation</span></strong></p>\n</div>\n<div class=\"topbullet\">\n<p><span style=\"color: #000000;\"><strong>Atrial flutter</strong>&nbsp;(types I and II)</span></p>\n</div>\n<div class=\"topbullet\">\n<p><span style=\"color: #000000;\"><strong>Ventricular tachycardia</strong>&nbsp;</span><span style=\"color: #000000;\">(with a pulse)</span></p>\n</div>\n<div class=\"topbullet\">\n<p><span style=\"color: #000000;\">Any patient with<strong> re-entrant</strong> tachycardia with <strong>narrow or wide QRS</strong> complex (ventricular rate &gt;150 bpm) who is <strong>unstable</strong> (eg, ischemic chest pain, acute pulmonary edema, hypotension, acute altered mental status, signs of shock)</span></p>\n</div>\n</td>\n<td style=\"width: 312.671875px;\">\n<div class=\"topbullet\">\n<p><strong><span style=\"color: #000000;\">Pulseless ventricular tachycardia (VT)</span></strong></p>\n<p><strong><span style=\"color: #000000;\">Ventricular fibrillation (VF)</span></strong></p>\n</div>\n<div class=\"topbullet\">\n<p><span style=\"color: #000000;\"><strong>Cardiac arrest</strong> due to or resulting in VF</span></p>\n</div>\n<span style=\"color: #000000;\">&nbsp;</span></td>\n</tr>\n</tbody>\n</table>\n<p>Cardioversion is typically performed under <strong>induction or sedation</strong> using a short-acting agent such as midazolam, unless the patient is hemodynamically unstable or if cardiovascular collapse is imminent. Defibrillation is more of an emergent maneuver and, when necessary, should be preferably performed in conjunction with or prior to the administration of induction or sedative agents.</p>\n<div id=\"ads-pos-a4_1\" class=\"inContentAd\"></div>\n<div class=\"inContentAd\">Energy may be delivered through mainly two waveforms in defibrillators that are monophasic or biphasic.\n<div id=\"ads-pos-a7_8\" class=\"inContentAd\">\n<p>Monophasic defibrillation delivers a charge in only <strong>one direction</strong> as opposed to biphasic defibrillation delivering a charge in <strong>one direction for half </strong>of the shock and in the electrically <strong>opposite direction for the second half.</strong></p>\n<div id=\"ads-pos-a7_9\" class=\"inContentAd\">Biphasic waveforms are adopted in newer defibrillators as they deliver a more consistent magnitude of the current which successfully terminates arrhythmias at lower energies than monophasic waveform defibrillators.</div>\n<div class=\"inContentAd\">&nbsp;</div>\n<div class=\"inContentAd\">Energy selection for defibrillation or cardioversion.&nbsp;Following are the guidelines for&nbsp;<strong>initial&nbsp;</strong>energy requirements issued by the American Heart Association in 2010.</div>\n<p><strong>Atrial fibrillation</strong> energy requirements are as follows:</p>\n<ul>\n<li><strong>200</strong> Joules for monophasic devices</li>\n<li>120-200 Joules for biphasic devices</li>\n</ul>\n<p>Atrial flutter energy requirements are as follows:</p>\n<div class=\"topbullet\">\n<ul>\n<li>100 Joules for monophasic devices</li>\n<li>50-100 Joules for biphasic devices</li>\n</ul>\n</div>\n<div id=\"ads-pos-a7_13\" class=\"inContentAd\">Ventricular tachycardia with pulse energy requirements are as follows:</div>\n<div class=\"topbullet\">\n<ul>\n<li>200 Joules for monophasic devices</li>\n<li>100 Joules for biphasic devices</li>\n</ul>\n</div>\n<div id=\"ads-pos-a7_14\" class=\"inContentAd\">Ventricular fibrillation or pulseless ventricular tachycardia energy requirements are as follows:</div>\n<div class=\"topbullet\">\n<ul>\n<li>360 Joules for monomorphic devices</li>\n<li>120-200 Joules for biphasic devices</li>\n</ul>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/71941fcd59ea464ea79143a8111ed5e0.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/08ae6f62fa4e4ba8a3253dfa1301f8b1x1280x2567.JPEG"
    ]
  }
];
        let quizName = 'Dyspnea Mini Test - -Tmt';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2023-24"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>