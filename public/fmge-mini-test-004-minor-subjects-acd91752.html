<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fmge Mini Test - 004 (Minor Subjects) - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / FMGE Mini Test Series / 2023
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A 4-year-old boy presented with itchy skin lesions on his face. for the past 3 days. On examination, there are erythematous lesions near the mouth with honey-yellow crusting, as shown in the image given below. Identify the condition.",
    "choices": [
      {
        "id": 1,
        "text": "Impetigo contagiosa"
      },
      {
        "id": 2,
        "text": "Molluscum contagiosum"
      },
      {
        "id": 3,
        "text": "Herpes Labialis"
      },
      {
        "id": 4,
        "text": "Cellulitis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The above image showing erythematous lesions with <strong>honey-colored crusts</strong> is suggestive of <strong>impetigo contagiosa</strong>\u00a0(a.k.a\u00a0<strong>non-bullous impetigo</strong>).</p>\n<p><strong>Impetigo</strong> is a type of bacterial skin infection, commonly caused by <strong>Staphylococcus aureus</strong> and <strong>group A beta-hemolytic Streptococcus pyogenes</strong>. It is <strong>self-limiting, </strong>has an incubation period of <strong>4-10 days,</strong> and lasts for about <strong>two-three weeks</strong>.</p>\n<p><strong>Topical antibiotics\u00a0</strong>are preferable to oral antibiotics for limited impetigo. Three topical antibiotics recommended for impetigo are\u00a0<strong>mupirocin 2%, retapamulin 1% ointment,</strong>\u00a0and\u00a0<strong>fusidic acid</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/fb9bc7c4f2ea48638f18cc2decfcd1f8.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6ef33b6f10b742758c74f76c13a89da4x1280x1378.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5037130f2176479e905d2101de6c23b2x400x327.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f38943e51e1c4840852e251c26e7c23cx720x537.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/77d3e5bad82d47a8aea407fa573009bex720x540.JPEG"
    ]
  },
  {
    "text": "Wernicke\u2019s encephalopathy is associated with all except _____",
    "choices": [
      {
        "id": 1,
        "text": "Amnesia"
      },
      {
        "id": 2,
        "text": "Mental status changes"
      },
      {
        "id": 3,
        "text": "Ophthalmoplegia"
      },
      {
        "id": 4,
        "text": "Ataxia"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Amnesia</strong> is characteristic of <strong>Korsakoff syndrome</strong>,<strong> not Wernicke's encephalopathy.</strong></p>\n<p>Wernicke's encephalopathy is a specific aetiology of delirium which is caused by <strong>thiamine</strong> deficiency, commonly due to <strong>alcohol abuse</strong>. &nbsp;</p>\n<p><strong>Wernicke's encephalopathy:</strong></p>\n<ul>\n<li><strong>Acute</strong>, neuropsychiatric syndrome characterized by nystagmus and <strong>ophthalmoplegia, mental status changes, and unsteadiness of stance and gait (ataxia)</strong>.</li>\n<li>Wernicke&rsquo;s encephalopathy is a medical emergency, and thiamine should be initiated immediately, either intravenously or intramuscularly. <strong>&nbsp;</strong></li>\n</ul>\n<p><strong>Korsakoff syndrome:</strong></p>\n<ul>\n<li>Korsakoff syndrome is characterized by a pronounced <strong>anterograde and retrograde amnesia</strong> along with potential impairment in visuospatial, abstract, and other types of learning.</li>\n<li><strong>Permanent</strong> in at least a partial form in about 50 percent of the people affected. &nbsp; &nbsp;</li>\n</ul>\n<table style=\"width: 215px;\">\n<tbody>\n<tr>\n<td style=\"width: 215px;\">\n<p><strong>Korsakoff Syndrome</strong></p>\n<p>Thiamine deficiency</p>\n<ul>\n<li>Anterograde amnesia</li>\n<li>Retrograde amnesia</li>\n<li>Confabulation</li>\n</ul>\n<p><strong>Anton syndrome</strong><strong>(</strong><strong>visual anosognosia)</strong></p>\n<p>Occipital lobe damage (Usually due to stroke)</p>\n<ul>\n<li>Cortical blindness</li>\n<li>Confabulation</li>\n</ul>\n<p><strong>Kluver Bucy syndrome</strong>&nbsp;</p>\n<p>Bitemporal lesions</p>\n<ul>\n<li>Anterograde amnesia</li>\n<li>Retrograde Amnesia</li>\n<li>Visual agnosia</li>\n<li>Hyperphagia</li>\n<li>Hyperorality</li>\n<li>Hypersexuality</li>\n</ul>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient presents with pruritic hypopigmented macules and confluent patches over the chest as seen in the image. On KOH mount, spaghetti and meatballs appearance is noted. Identify the condition.",
    "choices": [
      {
        "id": 1,
        "text": "Tinea cruris"
      },
      {
        "id": 2,
        "text": "Tinea capitis"
      },
      {
        "id": 3,
        "text": "Tinea corporis"
      },
      {
        "id": 4,
        "text": "Tinea versicolor"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The characteristic appearance of<strong> &lsquo;spaghetti and meatballs&rsquo;</strong> or<strong> &lsquo;bananas and grapes' </strong>on<strong> KOH mount and microscopy </strong>(shown below)<strong>&nbsp;</strong>is suggestive of<strong>&nbsp;tinea versicolor or pityriasis versicolor.&nbsp;</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/0d3774c058a545b6985af41cdd579e46.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d6333eebee9f41bab0fb1e5814bf807ax720x484.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/150d22320a0d403ba4789449dcecfef1x1280x960.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/679fdc0e5eba4f3dbb927fa7804bd4b9x720x960.JPEG"
    ]
  },
  {
    "text": "Match the following skull radiology findings and the associated conditions.",
    "choices": [
      {
        "id": 1,
        "text": "1-B,2-A,3-D,4-C"
      },
      {
        "id": 2,
        "text": "1-C,2-A,3-D,4-B"
      },
      {
        "id": 3,
        "text": "1-D,2-C,3-A,4-B"
      },
      {
        "id": 4,
        "text": "1-D,2-A,3-B,4-C"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The correct option is\u00a01-C, 2-A, 3-D, 4-B.</p>\n<ul>\n<li>Salt and pepper appearance -\u00a0Hyperparathyroidism\u00a0</li>\n<li>J-shaped sella -\u00a0Hurler's syndrome</li>\n<li>Punched-out lesions -\u00a0Multiple myeloma</li>\n<li>Cotton wool appearance -\u00a0Paget's disease</li>\n</ul>\n<p><strong>Salt and pepper appearance</strong> of the skull: It is also known as <strong>pepper pot skull</strong> and is seen in <strong>hyperparathyroidism</strong>. It is characterized by multiple tiny well-defined lucencies in the skull that occur due to resorption of the trabecular bone.</p>\n<p>Other radiological findings in hyperparathyroidism:</p>\n<ul>\n<li><strong>Sub-periosteal resorption -\u00a0</strong>Classical and pathognomonic feature of hyperparathyroidism</li>\n<li>Loss of lamina dura\u00a0</li>\n<li>Expansile lytic lesion, otherwise known as <strong>brown tumor,</strong> generally affecting maxilla/ mandible</li>\n</ul>\n<p>Image showing salt and pepper appearance of the skull:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c3fbe8719a9f48b4889f01eb18d3cb6bx672x526.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1fb8c43f7b14494f95d0bb1ef270dfcbx720x539.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ca74048c210747609a6d98f28b6501c2x720x720.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/142694f1c82f492e9ea0dd96ac754708x720x555.PNG"
    ]
  },
  {
    "text": "All of the following forms the right cardiac border on the chest X-ray PA view except:",
    "choices": [
      {
        "id": 1,
        "text": "SVC"
      },
      {
        "id": 2,
        "text": "IVC"
      },
      {
        "id": 3,
        "text": "Right atrium"
      },
      {
        "id": 4,
        "text": "Right ventricle"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>On a chest x-ray PA view, the right ventricle does not form&nbsp;the right cardiac border.</p>\n<p><strong>Right cardiac border formed by:</strong></p>\n<ul>\n<li>SVC</li>\n<li>Right atrium</li>\n<li>IVC</li>\n</ul>\n<p><strong>Left cardiac border formed by:</strong></p>\n<ul>\n<li>Subclavian artery</li>\n<li>Aortic knob/ knuckle (Aortic Arch)</li>\n<li>Pulmonary artery segment</li>\n<li>Left atrial appendage</li>\n<li>Left ventricle</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5f806a7d17034ce3a91873e7d805b90ax1024x1024.JPEG"
    ]
  },
  {
    "text": "A 43-year-old man presents to the emergency department accompanied by police. He came to the police station accusing his daughter of wanting to kill him. The police on investigating the family and the neighbors understood that it was a false accusation. His physical examination is not remarkable. What is the most likely diagnosis here?",
    "choices": [
      {
        "id": 1,
        "text": "Delusional disorder"
      },
      {
        "id": 2,
        "text": "Illusions"
      },
      {
        "id": 3,
        "text": "Cotard syndrome"
      },
      {
        "id": 4,
        "text": "Hallucinations"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>In the given scenario the patient thinks that his daughter wants to kill him which is not true. Since the patient appears normal apart from the delusion, the clinical scenario is likely to be of a <strong>delusional disorder,</strong> more specifically <strong>delusion of persecution</strong>.\u00a0</p>\n<p class=\"p1\">Delusion is a <strong>false belief</strong>, that is <strong>firmly</strong> held despite objective and obvious contradictory proof. Other members of the culture do not share this belief. It can be present in conditions like schizophrenia, mania, major depressive disorders, and delusional disorders.\u00a0</p>\n<p>Other options:</p>\n<p>Option B: <strong>Illusion </strong>is an incorrect perception or misinterpretation of a sensory stimulus. Eg: There is a rope in front of you but you see it as a snake.</p>\n<p>Option C:<strong> Hallucination</strong>: Perception in the absence of any stimulus. Eg: There is nothing in front of you but you can see a snake.</p>\n<p>Option D:\u00a0<strong>Cotard syndrome</strong>\u00a0is a condition in which an individual feels like they have lost all possessions and status, including their entire being and all internal organs.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Exclamation mark hair pattern is seen in:",
    "choices": [
      {
        "id": 1,
        "text": "Alopecia areata"
      },
      {
        "id": 2,
        "text": "Trichotillomania"
      },
      {
        "id": 3,
        "text": "Telogen effluvium"
      },
      {
        "id": 4,
        "text": "Androgenic alopecia"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Exclamation mark hair</strong> pattern is seen in<strong> alopecia areata</strong>.</p>\n<p><strong>Alopecia areata</strong> is a chronic inflammatory disease that causes <strong>non-scarring hair loss</strong>.&nbsp;It is a <strong>T-cell mediated inflammatory disease.&nbsp;</strong>It is associated with several autoimmune diseases including <strong>thyroiditis</strong>, lupus erythematosus<strong>,</strong> vitiligo, and psoriasis.</p>\n<p>It mainly affects the&nbsp;<strong>scalp, </strong>but can also affect the <strong>beard, eyebrows, </strong>and<strong> eyelashes.&nbsp;</strong>In some cases, this progresses to a total loss of scalp hair <strong>(alopecia totalis)</strong> or a loss of all hair on the body<strong> (alopecia universalis)</strong>.</p>\n<p>The lesions of alopecia areata are characterized by a&nbsp;<strong>smooth circumscribed patch </strong>of<strong> alopecia. </strong>Some broken hairs can be seen which are&nbsp;called&nbsp;<strong>exclamation marks. </strong>They are easily extractable. It preferentially&nbsp;<strong>affects pigmented hair</strong> and spares white hair. It can cause <strong>fine stippled pitting</strong> of the nails and roughening of the nail bed, which is called <strong>trachyonychia.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0e228debbfce427888f6ce363b09fc50x1280x1453.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/05f85157dcc74d539b1e8d3f92fbd235x1280x1458.JPEG"
    ]
  },
  {
    "text": "A 25-year-old female reported symptoms of anxiety, palpitations, sweating, breathlessness, chest pain, and a feeling of impending doom. She recalls having experienced 5-6 similar episodes in the past 6 months, each episode lasting for about 20-30 minutes. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Post-traumatic stress disorder"
      },
      {
        "id": 2,
        "text": "Bipolar disorder"
      },
      {
        "id": 3,
        "text": "Depression"
      },
      {
        "id": 4,
        "text": "Panic attack"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical scenario is suggestive of a <strong>panic disorder</strong>.&nbsp;&nbsp;Panic disorder refers to an <strong>acute intense attack</strong> of <strong>anxiety</strong> accompanied by feelings of <strong>impending doom. </strong>Such attacks may not only occur in response to a fearful situation, or phobic objects, or in response to obsession or separation as in other anxiety disorders.</p>\n<p>Panic disorder is characterized by the presence of<strong>&nbsp;</strong>an<strong>&nbsp;</strong>abrupt surge of&nbsp;<strong>intense fear</strong>&nbsp;or <strong>intense discomfort</strong> that reaches a peak within minutes.<strong>&nbsp;</strong>They may occur at any time and are <strong>not</strong> associated with any <strong>identifiable stimulus</strong>. During the episode, the person may experience symptoms like&nbsp;<strong>palpitations, sweating,&nbsp;</strong>trembling or shaking, shortness of breath, nausea,<strong> dizziness,</strong> chest pain or discomfort or fear of dying. The patient also might feel like losing control, having a heart attack, or<strong> going crazy.</strong></p>\n<div class=\"page\" title=\"Page 412\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<div class=\"page\" title=\"Page 410\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<div class=\"page\" title=\"Page 412\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Some habits predispose a patient to panic attacks. These include the use of&nbsp;<strong>caffeine, alcohol, nicotine,</strong>&nbsp;or other substances, and unusual patterns of sleeping or eating.&nbsp;</p>\n<div class=\"page\" title=\"Page 412\">&nbsp;</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n<p>For rapid control of symptoms,&nbsp;<strong>alprazolam&nbsp;</strong>is the drug of choice.&nbsp;<strong>Selective serotonin reuptake inhibitors</strong>&nbsp;such as&nbsp;<strong>paroxetine</strong>&nbsp;are started concurrently and alprazolam is slowly tapered.&nbsp;<strong>Fluoxetine</strong>&nbsp;is used for panic attacks with&nbsp;<strong>co-morbid depression.</strong></p>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the maneuver being performed in the given image?",
    "choices": [
      {
        "id": 1,
        "text": "Head tilt, chin lift"
      },
      {
        "id": 2,
        "text": "Jaw thrust"
      },
      {
        "id": 3,
        "text": "Head extension"
      },
      {
        "id": 4,
        "text": "In line manual stabilisation"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The maneuver being performed in the given image is that of <strong>head-tilt chin-lift. </strong>It is an<strong>&nbsp;</strong>important technique in emergency airway management to open up the airway.</p>\n<p>Basic life support involves early recognition and management of emergencies such as&nbsp;heart attack, stroke, and foreign body airway obstruction. The sequence of BLS is&nbsp;<strong>circulation</strong> (chest compression), <strong>airway</strong>, and then <strong>breathing.</strong></p>\n<p>The airway is usually obstructed by posterior displacement of the tongue or epiglottis. One hand (palm) is placed on the patient&rsquo;s forehead applying pressure to tilt the head back. Simultaneously, the chin is lifted with the forefinger and index finger of the opposite hand. This causes cervical flexion with an atlantooccipital extension (sniffing position). This lifts the tongue from the back of the throat.</p>\n<p>Head-tilt chin-lift<strong>&nbsp;</strong>should not be performed in a patient with suspected cervical injury.</p>\n<p>Other options:&nbsp;</p>\n<p>Option B: <strong>Jaw thrust</strong>-&nbsp;Both hands of the clinician are placed on either side of the patient&rsquo;s head and the angles of the jaw are grasped and lifted. It can be performed in a patient with cervical injury but caution must be followed to not hyperextend the neck.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/58a866b2e5d8432d988fdf5bd1369bf0.GIF"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7339e1fa13354a7aafc600098c9b06afx1024x768.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/51372811b83143fea81e919fcf94d2c0x394x193.JPEG"
    ]
  },
  {
    "text": "Which of the following diseases are incorrectly matched with their imaging modality of choice?",
    "choices": [
      {
        "id": 1,
        "text": "Neonatal hydrocephalus- Neurosonogram"
      },
      {
        "id": 2,
        "text": "Hirschsprung\u2019s disease- Plain x-ray abdomen with air contrast"
      },
      {
        "id": 3,
        "text": "Pyloric stenosis- Ultrasound"
      },
      {
        "id": 4,
        "text": "Neonatal hepatitis- Nuclear medicine; hepatobiliary scintigraphy"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The imaging modality of choice in <strong>Hirschsprung's disease</strong> is a contrast radiograph with&nbsp;<strong>barium</strong> or <strong>gastrografin enema.</strong>&nbsp;</p>\n<p>The most important film is a <strong>lateral</strong> or <strong>oblique</strong> view of the rectum during <strong>slow filling.</strong> It typically shows a <strong>low bowel obstruction.</strong>&nbsp;The <strong>rectum</strong> is seen as a <strong>narrow</strong> tube and a <strong>cone-shaped transition zone,</strong>&nbsp;seen <strong>proximal</strong> to the <strong>dilated ganglionated bowel.</strong>&nbsp;</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/18cd88adc0994796b4e97f28faabcbc0x720x571.PNG"
    ]
  },
  {
    "text": "A 27-year-old lady presented with pain and swelling in her knee. Histopathology of the lesion showed a large number of osteoclast-like giant cells seen scattered amidst round or spindle-shaped mononuclear cells. The stroma appeared well vascularized, with bands of fibrous tissue with areas of hemorrhage and collections of foamy macrophages interspersed in between. Which of the following x-rays belongs to this patient?",
    "choices": [
      {
        "id": 1,
        "text": "3"
      },
      {
        "id": 2,
        "text": "1"
      },
      {
        "id": 3,
        "text": "2"
      },
      {
        "id": 4,
        "text": "4"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The clinical stem and characteristic histopathology findings are suggestive of a giant cell tumor (GCT), or osteoclastoma. The x-ray findings of GCT are seen in&nbsp;<strong>Image 2,</strong>&nbsp;which shows an&nbsp;<strong>expansile, eccentric, sub-articular lesion,</strong> with a <strong>soap-bubble</strong> appearance.</p>\n<p>A GCT is typically seen on x-ray as an<strong>&nbsp;eccentric, lobulated, lytic lesion</strong> with non-sclerotic borders, giving a <strong>soap-bubble appearance</strong>. GCTs usually have little or no matrix calcification, new bone formation, or periosteal reaction. Tumors that extend into the soft tissues are seen as soft-tissue masses, which may be covered by a thin layer of sclerosis. They are usually located in the <strong>epiphysis</strong>&nbsp;of the long bone, but may also extend to<strong>&nbsp;</strong>the metaphysis. If malignant, the tumor appears as a lytic lesion with a sclerosing destructive tumor adjacent to it.</p>\n<div class=\"page\" title=\"Page 223\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>CT imaging estimates cortical bone involvement, and MRI shows an isointense or hypointense lesion on T1-weighted images.</p>\n<div class=\"page\" title=\"Page 223\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>GCTs are benign but locally aggressive tumors of the bone and are characterized by a proliferation of mononuclear cells, with scattered macrophages. They are most commonly seen at 20&ndash;45 years of age.&nbsp;GCTs may occasionally be associated with Paget&rsquo;s disease of bone and focal dermal hypoplasia (Goltz syndrome).</p>\n<p>They are seen in the <strong>epiphysis</strong> of long bones, more commonly the distal femur, proximal tibia, distal radius, and proximal humerus. Patients present with pain and a mass.&nbsp;</p>\n<div class=\"page\" title=\"Page 224\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Histologically, GCTs consist of a large number of <strong>osteoclast-like giant cells,</strong> with scattered, round, or spindle-shaped mononuclear cells. The tumor stroma is well-vascularized, with bands of cellular or collagenous fibrous tissue. Interposed areas of hemorrhage, hemosiderin, and foamy macrophages are seen.</p>\n<p>The image below shows the histopathology of osteoclastoma.</p>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/4e222cfbbc3d476db08a71276cc7b230.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8618336d048a4e1f9293f60122ddabaex1280x1184.JPEG"
    ]
  },
  {
    "text": "Which of the following can be classified as ionizing radiation?",
    "choices": [
      {
        "id": 1,
        "text": "1, 2 and 5"
      },
      {
        "id": 2,
        "text": "3, 4 and 5"
      },
      {
        "id": 3,
        "text": "3 and 4 only"
      },
      {
        "id": 4,
        "text": "1, 2 , 3 and 4"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Among the given options,\u00a0<strong>alpha rays, beta rays, gamma rays, </strong>and<strong> x-rays</strong>\u00a0are <strong>ionizing radiations</strong>. MRI is an example of non-ionizing electromagnetic radiation.\u00a0</p>\n<p>Ionizing radiation is a type of radiation with enough energy to remove tightly bound electrons from the orbit of an atom, causing the atom to be charged or <strong>ionized</strong>. They can be either directly ionizing or indirectly ionizing. Alpha rays and beta rays are directly ionizing radiation because they carry a charge and can directly interact with atomic electrons. Alpha and beta rays are also particulate radiation (composed of particles).\u00a0</p>\n<p>Gamma rays\u00a0and x-rays are <strong>electromagnetic rays. </strong>They are indirectly ionizing radiation as they are electrically neutral and do not interact directly with electrons.\u00a0</p>\n<p>MRI is a technique that produces topographic images by means of <strong>magnetic fields </strong>and <strong>radiofrequency waves.</strong> It uses non-ionizing electromagnetic radiation. MRI is based on the ability of nuclei of certain atoms to absorb and emit radio wave energy when the body is placed within a strong magnetic field. \u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 25-year-old man presented with a widespread rash. It started on the chest and spread out over his body. On examination, there are multiple purpuric macules affecting the face and torso. Nikolsky's sign is positive. There is also the involvement of his mouth and eyes. The body surface area affected is 45%. He was recently started on allopurinol for gout. Which of the following is most likely the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Toxic epidermal necrolysis"
      },
      {
        "id": 2,
        "text": "Stevens Johnson syndrome"
      },
      {
        "id": 3,
        "text": "Bullous pemphgoid"
      },
      {
        "id": 4,
        "text": "Pemphigus vulgaris"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The most likely diagnosis is <strong>Toxic epidermal necrolysis\u00a0(TEN).\u00a0</strong></p>\n<p>Stevens Johnson syndrome(SJS)/TEN is a drug-induced condition characterized by <strong>widespread epithelial keratinocyte necrosis</strong> of both skin and mucous membranes. It is due to <strong>cytotoxic T-lymphocytes</strong>. SJS with extensive involvement of skin (more than 30% of body surface area) is considered toxic epidermal necrolysis (TEN).</p>\n<p>The most common drugs involved in SJS/TEN are <strong>allopurinol</strong>, carbamazepine, lamotrigine, nevirapine, oxicam nonsteroidal antiinflammatory drugs, phenobarbital, phenytoin, sulfamethoxazole, and sulfasalazine.\u00a0</p>\n<p>Patients usually present <strong>7-10 days</strong> after consuming the drug with malaise and fever. It then <strong>progresses to a skin rash</strong> starting on the face and chest which then spreads over the rest of the body. There are <strong>purpuric macules</strong> that can easily be desquamated. <strong>Positive Nikolsky's sign</strong> may be present (gentle lateral pressure causing sliding of the epidermis).</p>\n<p>Eyes, oral mucosa, and genitals are frequently involved.\u00a0</p>\n<p>SJS/TEN is classified based on <strong>severity</strong> and <strong>involvement of body surface area</strong> (BSA)</p>\n<table style=\"height: 15px; width: 460px;\">\n<tbody>\n<tr>\n<td style=\"width: 128px;\"><strong>SJS</strong></td>\n<td style=\"width: 318px;\">Epidermal detachment of <strong>less than 10%</strong> BSA with widespread purpuric macules or flat atypical targets</td>\n</tr>\n<tr>\n<td style=\"width: 128px;\"><strong>SJS/TEN overlap</strong></td>\n<td style=\"width: 318px;\">Epidermal detachment of <strong>10-30% BSA</strong> with widespread\u00a0purpuric macules or flat atypical targets</td>\n</tr>\n<tr>\n<td style=\"width: 128px;\"><strong>TEN\u00a0</strong></td>\n<td style=\"width: 318px;\">Epidermal detachment of <strong>&gt;30% BSA</strong>\u00a0with or without widespread\u00a0purpuric macules or flat atypical targets</td>\n</tr>\n</tbody>\n</table>\n<p>Complications of SJS/TEN involve <strong>loss of thermoregulatory control</strong>, severe dehydration, and septicemia. Dehydration can cause acute kidney injury due to hypoperfusion.\u00a0</p>\n<p>The first step in management is to identify and <strong>stop the offending drug</strong>. Those with extensive loss of epidermis should be admitted to the <strong>burns unit</strong> for skin-directed therapy, fluid replacement, and nutrition. The skin should be carefully handled to avoid further removal of skin. In addition, local therapy should be provided for the eyes, mouth, and urogenital tract. Patients should be given <strong>analgesia</strong> and be<strong> monitored for infection.</strong> <strong>Immunomodulating</strong> drugs like corticosteroids and cyclosporin may be used.\u00a0\u00a0</p>\n<p>The following image shows <strong>Nikolsky's sign,</strong> where the application of gentle lateral pressure causes sliding of the epidermis.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7c330cbed0504394835802a04b981aa9x1279x1103.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/82170d43acbd445491f0c24f953d36bax720x541.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4e11f92267664d6d8ed7e31c7de9aaa1x800x1066.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/722878e9b8884cf7bb83b8f6ac19d47dx800x1066.JPEG"
    ]
  },
  {
    "text": "During resuscitation, when is the given position indicated?",
    "choices": [
      {
        "id": 1,
        "text": "Unconsciousness with pulse and breathing absent"
      },
      {
        "id": 2,
        "text": "Unconsciousness with pulse present and breathing absent"
      },
      {
        "id": 3,
        "text": "Unconsciousness with pulse and breathing present"
      },
      {
        "id": 4,
        "text": "Unconsciousness with pulse absent and breathing present"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The position illustrated in the picture is known as the <strong>recovery position,</strong> and it is used in the management of patients who are\u00a0<strong>unconscious</strong>\u00a0but with <strong>pulse present</strong> and <strong>breathing present.</strong></p>\n<p>The recovery position can help prevent complications such as aspiration and airway obstruction in unconscious individuals. Additionally, it is crucial to monitor the patient's airway, breathing, and circulation continuously while they are in the recovery position and seek immediate medical assistance.\u00a0<span style=\"text-align: justify;\">An unresponsive patient who is breathing spontaneously in the supine position is at risk of airway obstruction from their tongue, mucus, vomit, etc. A modified lateral position is used and the following 6 principles are considered while choosing which variation of recovery position to use,</span></p>\n<div class=\"elementor-element elementor-element-42a5f4c5 elementor-icon-list--layout-traditional elementor-list-item-link-full_width elementor-widget elementor-widget-icon-list\" data-id=\"42a5f4c5\" data-element_type=\"widget\" data-widget_type=\"icon-list.default\">\n<ol class=\"NLM_list-list_type-order\" style=\"text-align: justify;\">\n<li>\n<p class=\"inline\">The victim should be in as near a true <strong>lateral position</strong> as possible, with the head dependent to allow free drainage of fluid.</p>\n</li>\n<li>\n<p class=\"inline\">The position should be stable.</p>\n</li>\n<li>\n<p class=\"inline\"><strong>Avoid any pressure</strong> on the chest that impairs breathing.</p>\n</li>\n<li>\n<p class=\"inline\">It should be possible to turn the victim on his or her side and to return to the back easily and safely, with concern for a possible cervical spine injury.</p>\n</li>\n<li>\n<p class=\"inline\">Good observation of and access to the airway should be possible.</p>\n</li>\n<li>\n<p class=\"inline\">The position itself should not cause injury to the victim.</p>\n</li>\n</ol>\n<p>Other options</p>\n<p>Option A: <strong>Unconsciousness with pulse and breathing absent</strong> - In this situation, the patient is in cardiac arrest and requires immediate cardiopulmonary resuscitation (CPR), not the recovery position. CPR involves chest compressions and rescue breaths to support circulation and respiration.</p>\n<p>Option B: <strong>Unconsciousness with pulse present and breathing absent</strong> - In this case, the patient is experiencing respiratory arrest. Rescue breathing or bag-valve-mask ventilation should be initiated to support the patient's breathing. The recovery position is not indicated in this scenario.</p>\n<p>Option D: <strong>Unconsciousness with pulse absent and breathing present </strong>- This option is not physiologically plausible, as the absence of a pulse implies a lack of circulation, and breathing cannot be present without circulation.</p>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d9e7e3c8329341808ce0d5e70e127cd7.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 26-year-old term primigravida is taken to the operation theatre for an emergency cesarean section due to sudden fetal distress. The anaesthetist wants to prevent chances of pulmonary aspiration and decides to intubate using rapid sequence intubation. Which of the following steps is not performed in this technique?",
    "choices": [
      {
        "id": 1,
        "text": "Preoxygenation"
      },
      {
        "id": 2,
        "text": "Cricoid pressure"
      },
      {
        "id": 3,
        "text": "Bag\u00a0and mask ventilation"
      },
      {
        "id": 4,
        "text": "Propofol infusion"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Bag and mask ventilation is <strong>avoided</strong> in rapid sequence intubation because it leads to <strong>stomach</strong> <strong>inflation</strong> and increases the risk of<strong> aspiration</strong>.<br /><strong><br /></strong><strong>Indications of Rapid sequence intubation:</strong></p>\n<p>RSI is done when the patient is at increased risk of pulmonary aspiration&nbsp;as in:</p>\n<ul>\n<li aria-level=\"1\"><strong>pregnancy</strong></li>\n<li aria-level=\"1\">full stomach</li>\n<li aria-level=\"1\">intestinal obstruction</li>\n<li aria-level=\"1\">hiatus hernia</li>\n<li aria-level=\"1\">encephalopathy</li>\n<li aria-level=\"1\">morbid obesity</li>\n<li aria-level=\"1\">diabetic gastroparesis.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7f3e319aa6174d5d9044e026fef3eed6x1176x1512.PNG"
    ]
  },
  {
    "text": "Which of the following airway devices helps in maintaining FiO2 of 0.25 to 0.60 irrespective of the patient's breathing effort?",
    "choices": [
      {
        "id": 1,
        "text": "Nasal canula"
      },
      {
        "id": 2,
        "text": "Simple face mask"
      },
      {
        "id": 3,
        "text": "Venturi mask"
      },
      {
        "id": 4,
        "text": "Non-rebreathing mask"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Venturi mask</strong> helps in maintaining <strong>FiO2 of 0.25 to 0.60</strong> irrespective of patient's breathing effort.</p>\n<p>Oxygen delivery devices can be broadly divided into low-flow oxygen devices (eg: nasal cannula, simple face mask, non-rebreathing mask) and high-flow oxygen devices (eg: venturi mask).</p>\n<p>Venturi mask is a\u00a0<strong>high-flow, fixed-performance</strong>\u00a0oxygen delivery system and the\u00a0highest oxygen concentration (<strong>FiO<sub>2</sub></strong>) delivered is\u00a0<strong>60% at a flow rate of 15 L/min. </strong>It\u00a0is useful with patients who require greater FiO<sub>2\u00a0</sub>such as COPD patients, where it is important to provide controlled oxygenation.\u00a0It is available in different colors, with the green valve venturi mask providing 60% FiO<sub>2.\u00a0</sub></p>\n<table style=\"width: 335px; height: 171px;\">\n<tbody>\n<tr>\n<td style=\"width: 162px;\">Color of Venturi valve</td>\n<td style=\"width: 72px;\">FiO2 (%)</td>\n<td style=\"width: 79px;\">Flow rate\u00a0<br />(L/min)</td>\n</tr>\n<tr>\n<td style=\"width: 162px;\">Blue</td>\n<td style=\"width: 72px;\">24\u00a0</td>\n<td style=\"width: 79px;\">2</td>\n</tr>\n<tr>\n<td style=\"width: 162px;\">White</td>\n<td style=\"width: 72px;\">28\u00a0</td>\n<td style=\"width: 79px;\">4</td>\n</tr>\n<tr>\n<td style=\"width: 162px;\">Orange</td>\n<td style=\"width: 72px;\">31\u00a0</td>\n<td style=\"width: 79px;\">6</td>\n</tr>\n<tr>\n<td style=\"width: 162px;\">Yellow</td>\n<td style=\"width: 72px;\">35\u00a0</td>\n<td style=\"width: 79px;\">8</td>\n</tr>\n<tr>\n<td style=\"width: 162px;\">Red</td>\n<td style=\"width: 72px;\">40\u00a0</td>\n<td style=\"width: 79px;\">10</td>\n</tr>\n<tr>\n<td style=\"width: 162px;\">Green</td>\n<td style=\"width: 72px;\">60\u00a0</td>\n<td style=\"width: 79px;\">15</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/de01d78e942b4d11851454d04e3b9902x1279x1224.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d419bb4f6fe442bfa006d725e65d6381x1280x1280.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/93b83a912b5241778fab311ff1eb319fx1280x1390.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/313df8b6389e4cd78156714b5cc3834fx720x960.JPEG"
    ]
  },
  {
    "text": "Arrange the following anesthetic agents on the basis of their potency.",
    "choices": [
      {
        "id": 1,
        "text": "Methoxyflurane> Halothane> Isoflurane> Nitrous oxide"
      },
      {
        "id": 2,
        "text": "Methoxyflurane> Isoflurane> Halothane> Nitrous oxide"
      },
      {
        "id": 3,
        "text": "Methoxyflurane> Nitrous oxide> Halothane> Isoflurane"
      },
      {
        "id": 4,
        "text": "Halothane> Isoflurane> Nitrous oxide> Methoxyflurane"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The <strong>potency</strong> of the inhaled anesthetics given above can be arranged as<strong>\u00a0methoxyflurane&gt; halothane&gt; isoflurane&gt; nitrous</strong> <strong>oxide</strong>. It is due to the change in the agents' <strong>minimum alveolar concentration (MAC)</strong>.</p>\n<p>The<strong> minimum alveolar concentration (MAC</strong>) of an inhaled anesthetic is the\u00a0<strong>lowest concentration\u00a0</strong>required to prevent movement in response to a defined noxious stimulus in 50% of subjects. It is a measure of the\u00a0<strong>potency</strong> of inhalational anesthetics. So, the lower the MAC value, the lower the concentration of anesthetic drug required, implying the drug is more potent.</p>\n<p><strong>MAC values\u00a0</strong>(expressed as a '%' of 1 atmosphere) of some anesthetic agents:</p>\n<ul>\n<li><strong>Nitrous oxide</strong>\u00a0with a MAC value of\u00a0104\u00a0is the\u00a0<strong>least potent</strong>\u00a0inhaled anesthetic</li>\n<li><strong>Methoxyflurane</strong>\u00a0\u2013 MAC- 0.2 (<strong>most potent</strong>)</li>\n<li><strong>Desflurane</strong>: 6.0\u00a0</li>\n<li>Sevoflurane\u2013 2.05</li>\n<li>Isoflurane \u2013 1.28</li>\n<li><strong>Halothane</strong>\u00a0\u2013 0.75</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Identify the type of psoriasis in the given picture.",
    "choices": [
      {
        "id": 1,
        "text": "Guttate"
      },
      {
        "id": 2,
        "text": "Erythrodermic"
      },
      {
        "id": 3,
        "text": "Pustular"
      },
      {
        "id": 4,
        "text": "Inverse"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The picture shows scattered <strong>drop-like</strong> <strong>papules</strong> and <strong>plaques</strong> suggestive of <strong>guttate psoriasis.</strong></p>\n<p><strong>Guttate</strong> <strong>psoriasis</strong> is a distinct variant of psoriasis that is classically triggered by <strong>streptococcal infection</strong> (pharyngitis or perianal) and is more common in <strong>children</strong> and <strong>adolescents</strong> than adults.\u00a0</p>\n<p>On examination, guttate psoriasis manifests as numerous, small <strong>scattered papules and plaques</strong>. These are often referred to as \u201c<strong>drop-like</strong>\u201d and typically manifest as\u00a0round or slightly oval <strong>2 to 10 mm papules</strong>. They are scattered more or less evenly over the body, particularly on the\u00a0<strong>trunk and proximal part of the limbs\u00a0</strong>as shown below.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/bb5c849abbac4f0d84b44a15d42363c9.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/71532733244f40e18ed20ff295c79e3dx500x333.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e22daa77ea8c489cbfa07b2d28210553x850x478.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/be551c8d63b64e50af1f6a46ea57fa05x500x326.JPEG"
    ]
  },
  {
    "text": "A 25-year-old man with a history of schizophrenia was brought to the hospital with acute onset of neck stiffness. On examination, his upper body and neck are rigid. On review of his medications, it is seen that he has been started on haloperidol 5 days back. What is the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Akathisia"
      },
      {
        "id": 2,
        "text": "Dystonia"
      },
      {
        "id": 3,
        "text": "Neuroleptic malignant syndrome"
      },
      {
        "id": 4,
        "text": "Tardive dyskinesia"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Based on the clinical presentation and the history of recent<strong> haloperidol usage</strong> the most probable diagnosis is <strong>acute dystonia.&nbsp;</strong></p>\n<p><strong>Treatment:</strong> anticholinergics, such as benztropine, diphenhydramine, or trihexyphenidyl.</p>\n<p><strong>Other options:</strong></p>\n<ul>\n<li><strong>Akathisia: </strong>Extrapyramidal syndrome characterized by a feeling of restlessness, frequent repetitive stereotyped movements and an inability to sit still for more than a short period of time. It usually occurs during the first few months of drug use.</li>\n<li><strong>Neuroleptic malignant syndrome:</strong> It usually occurs within 10 days of starting neuroleptic therapy. Clinical manifestations include fever, encephalopathy, muscle rigidity, dystonia, diaphoresis, tachycardia and labile blood pressure. Treatment is with dantrolene or with dopamine agonists such as bromocriptine.</li>\n<li><strong>Tardive dyskinesia:</strong> It is characterized by involuntary, choreoathetoid movements in patients treated with antipsychotic medications. This disorder would be unlikely to occur within a few days of the initiation of drug therapy.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Psychogenic erectile dysfunction can be differentiated from organic erectile dysfunction by ______.",
    "choices": [
      {
        "id": 1,
        "text": "Decreased vibratory perception in the penis"
      },
      {
        "id": 2,
        "text": "Absence of erection with any partner"
      },
      {
        "id": 3,
        "text": "Presence of nocturnal penile tumescence"
      },
      {
        "id": 4,
        "text": "No good erection during masturbation"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The presence of <strong>nocturnal penile tumescence&nbsp;</strong>almost <strong>rules out organic </strong>causes of erectile dysfunction.</p>\n<p><strong>Organic causes are considered negligible in the following:</strong></p>\n<ul>\n<li><strong>Spontaneous erections</strong> at times when he does not plan to have intercourse.</li>\n<li>Having <strong>morning erections or&nbsp;nocturnal penile tumescence </strong>(erection during REM sleep)<strong>.</strong></li>\n<li>Only <strong>sporadic</strong> erectile dysfunction.</li>\n<li>Having good <strong>erections with masturbation.</strong></li>\n<li>Having good erection with <strong>partners other than his usual</strong> one.</li>\n</ul>\n<p><strong>Organic (non-psychogenic) causes of erectile dysfunction:</strong></p>\n<ul>\n<li>Vasculogenic</li>\n<li>Endocrinologic</li>\n<li>Neurogenic</li>\n<li>Iatrogenic</li>\n</ul>\n<p>In the case of <strong>organic causes</strong>, there is a pathological causing erectile dysfunction because of which a person <strong>does not have</strong> even <strong>morning erections</strong>. In the case of <strong>psychogenic</strong>, there is no disease/pathological process interfering with erections. Hence a patient with psychogenic ED <strong>has morning erections.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = 'Fmge Mini Test - 004 (Minor Subjects)';
        const quizFilename = 'fmge-mini-test-004-minor-subjects-acd91752.html';
        let hierarchy = ["Marrow", "FMGE Mini Test Series", "2023"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>