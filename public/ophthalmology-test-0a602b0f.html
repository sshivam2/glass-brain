<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ophthalmology Test - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / FMGE Test Series Subject / 2024
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">30</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "The visual field defect usually found in craniopharyngioma is _____.",
    "choices": [
      {
        "id": 1,
        "text": "Bitemporal hemianopia"
      },
      {
        "id": 2,
        "text": "Binasal hemianopia"
      },
      {
        "id": 3,
        "text": "Superior quadrantanopia"
      },
      {
        "id": 4,
        "text": "Inferior quadrantanopia"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The visual field defect usually found in craniopharyngioma is <strong>bitemporal</strong> <strong>hemianopia</strong>.</p>\n<p>Craniopharyngiomas are&nbsp;benign masses&nbsp;usually presenting in the&nbsp;suprasellar region&nbsp;arising near the pituitary stalk and can produce&nbsp;<strong>functional impairment</strong>&nbsp;of the hypophysis due to&nbsp;<strong>mass effect</strong>. The clinical features of craniopharyngiomas include headaches, visual field defects, growth failure and delayed sexual maturation due to pituitary hypofunction. CT scan may show calcifications in the supra-sellar region. Treatment includes trans-sphenoidal resection of the tumor followed by adjuvant chemotherapy.</p>\n<p>Lesions of the optic <strong>chiasma</strong> can cause <strong>bitemporal</strong> <strong>hemianopia,&nbsp;</strong>i.e, loss of vision in the temporal halves of both visual fields. Nasal fibers of each retina cross through the chiasma at this level, and hence, these fibers are compromised.</p>\n<p>Other causes of chiasmal lesions are</p>\n<ul>\n<li aria-level=\"1\">Pituitary adenoma (most common)</li>\n<li aria-level=\"1\">Aneurysm of the anterior communicating artery</li>\n<li aria-level=\"1\">Meningioma</li>\n<li aria-level=\"1\">Glioma</li>\n</ul>\n<p>Other options:</p>\n<p>Option B) <strong>Binasal</strong> <strong>hemianopia</strong> is a rare visual field defect also caused due to lesions at the optic chiasma. &nbsp;</p>\n<p>Option C) <strong>Superior</strong> <strong>quadrantanopia</strong> is also known as pie-in-the-sky defect and is caused when lesions affect the inferior fibers of the optic radiations in the temporal lobe. &nbsp;</p>\n<p>Option D)&nbsp;<strong>Inferior quadrantanopia</strong>&nbsp;is also known as pie-on-the-floor defect and is caused due to lesions affecting the superior fibers of the optic radiations in the parietal lobe. &nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 50-year-old male patient came with complaints of excessive lacrimation. Ocular examination showed an abnormality similar to what is shown below. Which of the following organism is likely to cause this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Chlamydia trachomatis"
      },
      {
        "id": 2,
        "text": "Herpes simplex type 1"
      },
      {
        "id": 3,
        "text": "Neiserria gonorrhea"
      },
      {
        "id": 4,
        "text": "Staphylococcus aureus"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The above image shows<strong> Herbert's pits</strong>. This finding is seen in <strong>trachoma</strong> which is caused by <strong><em>Chlamydia trachomatis,</em></strong> more specifically the<strong>&nbsp;TRIC</strong>&nbsp;(trachoma inclusion conjunctivitis) <strong>serovars A</strong>,<strong> B</strong>, <strong>Ba</strong>, <strong>C</strong>.&nbsp;</p>\n<p><strong>Trachoma</strong> is a form of chronic infective conjunctivitis and is one of the<strong> leading causes</strong> of <strong>blindness</strong>. It has an &lsquo;active&rsquo; inflammatory stage and a &lsquo;cicatricial&rsquo; chronic stage.</p>\n<p>The<strong> active inflammatory stage</strong>&nbsp;is<strong> more prevalent</strong> in <strong>children</strong> and presents with nonspecific symptoms of ocular irritation, foreign body sensation, and discharge (often mild symptoms). Examination findings at this stage show:&nbsp;</p>\n<ul>\n<li><strong>Conjunctival follicles </strong>containung&nbsp;<strong>Leber cells </strong>(multinucleated lymphocytes)</li>\n<li>corneal&nbsp;<strong>Herbert's follicles&nbsp;</strong>(similar to conjunctival follicles)</li>\n</ul>\n<p><strong>Cicatricial chronic stage</strong> is seen in <strong>middle age</strong>. And when the chronic infection with sequelae sets in, the patient complains of pain, lacrimation,<strong> photophobia</strong> and later blurring, and finally<strong>&nbsp;loss of vision</strong>. Conjunctiva shows&nbsp;<strong>c</strong><strong>oncretions</strong>&nbsp;(whitish deposits of inspissated mucus in depressions called glands of Henle). Corneal signs include:&nbsp;</p>\n<ul>\n<li><strong>Herbert pits</strong>&nbsp;(pitted scars in the limbal which are remnants of healed of Herbert follicles)</li>\n<li><strong>corneal opacity </strong>is seen in later stages.</li>\n</ul>\n<p>There can be associated <strong>t</strong><strong>richiasis&nbsp;</strong>( when at least one eyelash rubs the eyeball) and entropion.</p>\n<p>At present&nbsp;<strong>WHO grading </strong>with&nbsp;<strong>`FISTO&rsquo;</strong> is in use.</p>\n<p>Trachoma is treated according to the WHO classification using the&nbsp;<strong>SAFE</strong> <strong>strategy</strong>&nbsp;(<strong>S</strong>urgery, <strong>A</strong>ntibiotics,<strong> F</strong>acial hygiene, and <strong>E</strong>nvironmental improvement). <strong>Azithromycin</strong> is the&nbsp;<strong>antibiotic of choice</strong>, and surgery involves the correction of&nbsp;<strong>trichiasis and entropion</strong>. In case of significant corneal scarring, penetrating keratoplasty is done.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/8c9a6b541a524e56a98ee56842d40a32.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Identify the lesion in the given image.",
    "choices": [
      {
        "id": 1,
        "text": "Viral keratitis"
      },
      {
        "id": 2,
        "text": "Fungal keratitis"
      },
      {
        "id": 3,
        "text": "Bacterial keratitis"
      },
      {
        "id": 4,
        "text": "Interstitial keratitis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The above image shows a&nbsp;<strong>dendritic ulcer</strong>&nbsp;caused by&nbsp;<strong>herpes simplex virus.&nbsp;</strong></p>\n<p><em><strong>Herpes simplex</strong></em>&nbsp;causes&nbsp;<strong>epithelial keratitis</strong>&nbsp;and in severe forms,&nbsp;<strong>dendritic ulcers</strong>&nbsp;develop. Most of the patients present with&nbsp;<strong>redness</strong>, photophobia,&nbsp;<strong>watering,</strong>&nbsp;and blurred vision. On examination, visual acuity and&nbsp;<strong>corneal sensation</strong>&nbsp;are<strong>&nbsp;reduced</strong>. Follicular conjunctivitis and blepharitis may develop but are usually mild. Clinical reactivation occurs due to multiple stress factors and causes recurrent infections.</p>\n<p>The&nbsp;<strong>fluorescein</strong>-stained image under slit-lamp examination shows&nbsp;<strong>dendritic ulcers, a</strong>&nbsp;<strong>pathognomic&nbsp;</strong>feature of epithelial keratitis. They are mostly treated with&nbsp;<strong>acyclovir</strong>&nbsp;3% ointment or&nbsp;<strong>ganciclovir</strong>&nbsp;0.15% gel.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d2dc09f20d7a4b3592da7590642bb08a.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 50-year-old man comes with complaints of floaters and photopsia for the past 3 months. The consultant uses the following instrument to evaluate the patient. What method is being used?",
    "choices": [
      {
        "id": 1,
        "text": "Slit-lamp biomicroscopy"
      },
      {
        "id": 2,
        "text": "Indirect ophthalmoscopy"
      },
      {
        "id": 3,
        "text": "Direct ophthalmoscopy"
      },
      {
        "id": 4,
        "text": "Distant direct ophthalmoscopy"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The method being used is&nbsp;<strong>indirect</strong> <strong>ophthalmoscopy. </strong>It is a type of&nbsp;ophthalmoscopy<strong>&nbsp;</strong>and is used for&nbsp;<strong>fundus examination</strong>.&nbsp;</p>\n<p>Fundus examination can be done using ophthalmoscopy or a slit-lamp biomicroscopy. Ophthalmoscopy is the method of assessing the interior of the eye by using an ophthalmoscope. There are 3 <strong>types of ophthalmoscopy,</strong> mainly <strong>indirect</strong> ophthalmoscopy,<strong> direct</strong> ophthalmoscopy, and <strong>distant direct</strong> ophthalmoscopy.</p>\n<p>An <strong>indirect ophthalmoscope</strong> produces a real, inverted, and magnified image. It is essential for&nbsp;<strong>assessing retinal detachment</strong>&nbsp;and other&nbsp;<strong>peripheral retinal lesions</strong>.&nbsp;</p>\n<p>Advantages of&nbsp; an indirect ophthalmoscope over a direct ophthalmoscope are:</p>\n<table style=\"height: 246px; width: 354px;\">\n<tbody>\n<tr>\n<td style=\"width: 97px;\">Feature</td>\n<td style=\"width: 113.359px;\">Indirect Ophthalmoscopy</td>\n<td style=\"width: 70.6406px;\">Direct Ophthalmoscopy</td>\n</tr>\n<tr>\n<td style=\"width: 97px;\"><strong>Image</strong></td>\n<td style=\"width: 113.359px;\"><strong>Real, Inverted</strong></td>\n<td style=\"width: 70.6406px;\"><strong>Virtual, Erect</strong></td>\n</tr>\n<tr>\n<td style=\"width: 97px;\">Magnification</td>\n<td style=\"width: 113.359px;\">&nbsp;X~2.5&nbsp;</td>\n<td style=\"width: 70.6406px;\">&nbsp;X 15</td>\n</tr>\n<tr>\n<td style=\"width: 97px;\"><strong>Area of the field in focus</strong></td>\n<td style=\"width: 113.359px;\">&nbsp;<strong>Much larger</strong> (8 disc diameter)</td>\n<td style=\"width: 70.6406px;\"><strong>Small (2 disc diameter)</strong></td>\n</tr>\n<tr>\n<td style=\"width: 97px;\"><strong>Examination through hazy media</strong></td>\n<td style=\"width: 113.359px;\"><strong>Possible</strong></td>\n<td style=\"width: 70.6406px;\">Not possible</td>\n</tr>\n<tr>\n<td style=\"width: 97px;\"><strong>Depth perception</strong></td>\n<td style=\"width: 113.359px;\"><strong>Possible</strong></td>\n<td style=\"width: 70.6406px;\">Not possible</td>\n</tr>\n</tbody>\n</table>\n<p>Other options:</p>\n<p>Option A: <strong>Slit-lamp </strong>biomicroscopy is used to scan the eye anteroposteriorly and horizontally.&nbsp;</p>\n<p>Option C: <strong>Direct ophthalmoscope&nbsp;</strong>is most commonly used in routine fundus examination. Its features can be seen in the table above.</p>\n<p>Option D: <strong>Distant direct ophthalmoscopy</strong> is used to help recognize a detached retina, diagnose opacities in the refractive media, etc. It can be performed using a self-illuminated ophthalmoscope or a simple plain mirror with a hole at its center.</p>\n<p>Below attached is an image of a direct ophthalmoscope.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b3d946a696204b4eb22cd878baa814fb.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/02b5f1c8c0454290a4e72a32ee40aa42x1280x1269.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c55d01ec6ca6420da188a5f7cb75d9c6x720x958.PNG"
    ]
  },
  {
    "text": "Which is the most common cause of staphyloma at point D in the given image?",
    "choices": [
      {
        "id": 1,
        "text": "Trauma"
      },
      {
        "id": 2,
        "text": "Glaucoma"
      },
      {
        "id": 3,
        "text": "Degenerative high axial myopia"
      },
      {
        "id": 4,
        "text": "Scleritis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Degenerative high axial myopia </strong>is the most common cause for<strong> posterior staphyloma (Point D)</strong></p>\n<p><strong>Staphyloma:</strong></p>\n<ul>\n<li>It is an abnormal protrusion of the&nbsp;<strong>uveal tissue</strong> through a weak and thin portion of the&nbsp;<strong>cornea</strong>&nbsp;or sclera.</li>\n<li>So, staphyloma is <strong>lined internally by uveal tissue</strong> and <strong>externally by weak cornea or sclera</strong>.</li>\n<li>Types of Staphyloma:\n<ul>\n<li><strong>Anterior</strong>&nbsp;staphyloma: It is characterized&nbsp;by <strong>ectasia of the pseudo-cornea,</strong> which occurs after the total sloughing of the&nbsp;cornea. It is lined internally by the iris and externally by the newly formed epithelium.</li>\n<li><strong>Intercalary</strong> staphyloma: This is located <strong>at the limbus</strong> and is lined by the root of the iris and the anterior-most part of the ciliary body</li>\n<li><strong>Ciliary</strong> staphyloma: It is characterized by ectasia of weak sclera lined by the&nbsp;ciliary body. This affects the <strong>ciliary zone,</strong> which includes the region <strong>up to 8 mm behind the limbus.</strong></li>\n<li><strong>Equatorial</strong> staphyloma: This occurs at the <strong>equatorial region up to 14 mm behind the limbus</strong> of the eye.</li>\n<li><strong>Posterior</strong> staphyloma: This affects the <strong>posterior pole</strong> of the eye.</li>\n</ul>\n</li>\n<li><strong>Note :</strong>\n<ul>\n<li>The most common cause for <strong>anterior</strong> staphyloma is <strong>sloughing corneal ulcer.</strong></li>\n<li>The most common cause for <strong>posterior</strong> staphyloma is <strong>degenerative high axial myopia.</strong></li>\n</ul>\n</li>\n<li><strong>In the image:</strong>\n<ul>\n<li>A: Intercalary staphyloma</li>\n<li>B: Ciliary staphyloma</li>\n<li>C: Equatorial staphyloma</li>\n<li>D: Posterior staphyloma</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/4b93e55c3c0044ffbdb7d5fc2d14b525.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "During ward  rounds in Ophthalmology, there was a discussion about various modes of ultrasound scan. Which of the following is not an indication for a B mode  scan?",
    "choices": [
      {
        "id": 1,
        "text": "Assessment of the vitreous"
      },
      {
        "id": 2,
        "text": "Study of intraocular tumours"
      },
      {
        "id": 3,
        "text": "Evaluation of cause of papilledema"
      },
      {
        "id": 4,
        "text": "Measurement of anterior chamber depth"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Assessment of<strong> anterior chamber depth</strong>\u00a0is done by <strong>\"A\" scan</strong>. The rest are all indications for a B scan.\u00a0</p>\n<p>Both 'A' and 'B' scans are types of ultrasound (USG) scans.</p>\n<table style=\"height: 460px;\" width=\"408\">\n<tbody>\n<tr style=\"height: 48px;\">\n<td style=\"width: 195.969px; height: 48px;\"><span style=\"font-size: 14pt;\">A scan (time amplitude)</span></td>\n<td style=\"width: 196.031px; height: 48px;\"><span style=\"font-size: 14pt;\">B scan (intensity modulation)</span></td>\n</tr>\n<tr style=\"height: 66.1632px;\">\n<td style=\"width: 195.969px; height: 66.1632px;\">It\u00a0produces a unidimensional image and echoes are plotted as spikes.</td>\n<td style=\"width: 196.031px; height: 66.1632px;\">It\u00a0<span class=\"s1\">produces a\u00a0</span>two-dimensional dotted section of the eyeball.</td>\n</tr>\n<tr style=\"height: 166px;\">\n<td style=\"width: 195.969px; height: 166px;\">\n<p><strong>Uses:</strong></p>\n<ul>\n<li>Axial length</li>\n<li>Intraocular lens (IOL) power calculation: Biometry</li>\n<li>Anterior chamber depth</li>\n<li>The thickness of intraocular mass</li>\n</ul>\n</td>\n<td style=\"width: 196.031px; height: 166px;\">\n<p><strong>Uses:</strong></p>\n<ul>\n<li>Assessment of the posterior segment in opaque media</li>\n<li>Study of intraocular tumors</li>\n<li>Localization of intraocular and intra-orbital foreign bodies</li>\n</ul>\n</td>\n</tr>\n</tbody>\n</table>\n<p>\u00a0</p>\n<p>The first image below shows \"A\" scan ultrasound amplitude spikes.</p>\n<p>The second image shows a normal \"B\" scan of the eye.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/de48c6e43be04fe293d17dad28c5ca1bx250x186.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/73814f4365974652a1e4918aa98245b0x240x178.JPEG"
    ]
  },
  {
    "text": "A 45-year-old man presents to the casualty with a sudden loss of vision and painful ocular movements. On examination of the affected eye, a relative afferent pupillary defect with a normal optic disc is seen. Visual field testing was done which revealed central scotoma in the same eye. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Optic nerve glioma"
      },
      {
        "id": 2,
        "text": "Optic neuritis"
      },
      {
        "id": 3,
        "text": "Eale\u2019s disease"
      },
      {
        "id": 4,
        "text": "Neuroretinitis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario of a sudden painful loss of vision in the absence of fundoscopic changes, RAPD and central scotoma is suggestive of<strong>&nbsp;optic neuritis,&nbsp;</strong>specifically retrobulbar neuritis.&nbsp;</p>\n<p>There are 3 types of optic neuritis:</p>\n<ul>\n<li>papillitis</li>\n<li>neuroretinitis</li>\n<li>retrobulbar neuritis</li>\n</ul>\n<p>Clinically, optic neuritis is characterized by sudden, progressive visual loss.&nbsp; Ocular movements are <strong>painful</strong> in <strong>retrobulbar neuritis</strong> and painless in papillitis and neuroretinitis. Glowing sensations known as <strong>phosphenes</strong> may be induced with sound or movement. Color vision may also be impaired.&nbsp;</p>\n<p>Signs of optic neuritis:</p>\n<ul>\n<li>Marked reduction in visual acuity</li>\n<li>Impaired color vision</li>\n<li><strong>Marcus Gunn Pupil</strong>&nbsp;indicates the <strong>relative afferent pupillary defect&nbsp;(RAPD)</strong>, is a diagnostic sign. Can be detected by <strong>swinging flashlight test</strong></li>\n<li>Disc hyperemia with blurred margin</li>\n<li><strong>Central </strong>or<strong> centrocaecal scotoma</strong> in the visual field (most common field defect in optic neuritis)</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0f878abaf2224dccad1de66d0ceb5cf8x1280x2560.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/29391d1eb10348b0a7fd4b78579fe69cx512x389.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8bbee13f5cbb4361921cf13758fe28b9x606x603.PNG"
    ]
  },
  {
    "text": "Identify the surgical step shown in the image below.",
    "choices": [
      {
        "id": 1,
        "text": "Capsulorrhexis"
      },
      {
        "id": 2,
        "text": "Hydrodissection"
      },
      {
        "id": 3,
        "text": "Intraocular lens implantation"
      },
      {
        "id": 4,
        "text": "Lens aspiration"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Capsulorrhexis</strong> is the step shown in the given image.</p>\n<p>Capsulorrhexis is a method of <strong>anterior capsulotomy,&nbsp;</strong>where a<span class=\"word\">n opening is made in the anterior capsule of the lens.&nbsp;</span>It is one of the steps involved in <strong>conventional extracapsular cataract extraction</strong> (ECCE).</p>\n<p>Continuous curvilinear capsulorrhexis&nbsp;(CCC) is considered to be superior to all the pre-existing methods because when done correctly, it does not leave any edges or tears. <strong>Trypan blue dye</strong> can be used to stain the lens capsule for better visibility.</p>\n<p>In ECCE, a portion of the anterior capsule of the lens is removed, allowing extraction of the lens nucleus and cortex. This leaves the remainder of the anterior capsule, the posterior capsule, and the zonular support intact. The intact lens nucleus is then removed from the eye through a limbal incision.&nbsp;</p>\n<p>An anterior capsulotomy is followed by <strong>hydrodissection</strong>&nbsp;using a <strong>balanced salt solution.</strong>&nbsp;This helps to separate the corticonuclear mass from the capsule.&nbsp;<strong>Removal of lens nucleus</strong> and <strong>aspiration </strong>of the<strong> cortex</strong>&nbsp;is done using a two-way irrigation and aspiration cannula. An intraocular lens (IOL) is then <strong>implanted</strong> and the incision is then closed.</p>\n<p>Some of the IOLs used are shown in the image below.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e69fc0a77e5a420a91342b71ac4a1b7e.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/dbebefc0e9804d32bb27cb661ca63fffx608x1068.PNG"
    ]
  },
  {
    "text": "A middle-imaged female patient presents to the clinic with sudden onset mild ptosis, decreased sweating on the same side, and anisocoria. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Adie's tonic pupil"
      },
      {
        "id": 2,
        "text": "Horner syndrome"
      },
      {
        "id": 3,
        "text": "Bell's palsy"
      },
      {
        "id": 4,
        "text": "Argyll Robertson pupil"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The likely diagnosis in a patient with sudden onset mild ptosis, decreased sweating on the same side and anisocoria is<strong> Horner syndrome.</strong></p>\n<p><strong>Horner syndrome\u00a0</strong>is also termed <strong>oculosympathetic palsy.\u00a0</strong>Presentation depends on the level of lesion in the sympathetic chain.</p>\n<p>Patients commonly present with symptoms such as</p>\n<ul>\n<li>Mild ptosis</li>\n<li>Anisocoria (difference in size of the pupils) accentuated in dim light</li>\n<li>Reduced ipsilateral sweating</li>\n</ul>\n<p>Tests with topical apraclonidine and cocaine can be used to confirm a diagnosis of Horner syndrome.</p>\n<p>Other options</p>\n<p>Option A: <strong>Adie's tonic pupil</strong> is caused by damaged sphincter pupillae and ciliary muscle following a viral illness. Patients present with large regular pupils that have absent/sluggish light reflexes.</p>\n<p>Option C: <strong>Bell's palsy</strong> is an idiopathic facial palsy affecting lower motor neurons. There is an ipsilateral restriction of eye closure and facial muscle weakness.</p>\n<p>Option D: <strong>Argyll Robertson pupil</strong> is caused by neurosyphilis. On examination, there are irregular small pupils that do not change in size in bright light. However, they constrict on accommodation.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An 8-year-old child presents with fever and painful swelling of the left eye. He is being treated for acute ethmoiditis for 5 days. On examination, the visual acuity in the left eye is 6/12, there is chemosis, axial proptosis, limitation of ocular motility in all directions, and relative afferent pupillary defect. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Optic neuritis"
      },
      {
        "id": 2,
        "text": "Cavernous sinus thrombosis"
      },
      {
        "id": 3,
        "text": "Orbital cellulitis"
      },
      {
        "id": 4,
        "text": "Preseptal cellulitis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The most likely diagnosis of this patient is <strong>orbital cellulitis</strong>.</p>\n<p>Orbital cellulitis is an acute infection of the soft tissues of the orbit posterior to the orbital septum. If left untreated it may progress to either a <strong>subperiosteal</strong> or <strong>orbital abscess</strong>.&nbsp;</p>\n<p><strong>Ethmoidal sinusitis</strong> is the most common cause of orbital cellulitis in children.</p>\n<p>Patients present with pain, lid edema, erythema, conjunctival&nbsp;<strong>chemosis</strong>, and <strong>axial proptosis</strong>. Decreased ocular motility and relative afferent pupillary defect can also be seen.&nbsp;A rapid loss of vision is due to the involvement of the optic nerve.</p>\n<p>Relative afferent pupillary defect (RAPD) is a paradoxical response of a pupil to a light stimulus. It is tested by the<strong> swinging flashlight test</strong>.</p>\n<p>Other options:</p>\n<p>Option A: <strong>Optic neuritis&nbsp;</strong>is an inflammatory and demyelinating disorder of the optic nerve in which patients present with symptoms such as sudden monocular vision loss, impaired color vision, and impaired depth perception.</p>\n<p>Option B: Patients with <strong>cavernous sinus thrombosis</strong> present with edema in the mastoid region which is not seen in orbital cellulitis. Cavernous sinus thrombosis is a <strong>bilateral</strong> condition due to intercavernous communication. Patients can also present with ophthalmoplegia due to palsy of the 3rd,4th and 6th cranial nerves.</p>\n<p>Option D: Preseptal cellulitis refers to infection of the subcutaneous tissues <strong>anterior</strong> to the orbital septum. Patients present with painful periorbital swelling and there is <strong>no proptosis</strong>. Ocular movements and visual acuity are normal in patients with this condition.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Identify the condition below which presents as painless loss of vision.",
    "choices": [
      {
        "id": 1,
        "text": "Central retinal vein occlusion (CRVO)"
      },
      {
        "id": 2,
        "text": "Branched retinal vein occlusion (BRVO)"
      },
      {
        "id": 3,
        "text": "Central retinal arterial occlusion (CRAO)"
      },
      {
        "id": 4,
        "text": "Branched retinal artery occlusion (BRAO)"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The image shows a&nbsp;<strong>splashed tomato appearance</strong>&nbsp;which is characteristic of&nbsp;<strong>central retinal vein occlusion</strong>&nbsp;(CRVO).</p>\n<div class=\"page\" title=\"Page 285\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>CRVO refers to sudden or acute occlusion of the central retinal vein. It presents with a <strong>sudden loss of vision</strong>. On examination, a relative afferent pupillary defect is present.</p>\n<p>Funduscopy shows engorged and tortuous retinal veins, massive&nbsp;<strong>retinal hemorrhages</strong>&nbsp;with&nbsp;<strong>splashed tomato appearance</strong>, and cotton wool spots. The disc is edematous and hyperemic. Changes that occur later include neovascularization at the disc or periphery with pigmentary changes at the macula.</p>\n</div>\n</div>\n</div>\n<p>Complications:</p>\n<ul>\n<li>Rubeosis iridis or neovascularization of the iris</li>\n<li>Neovascular glaucoma (NVG) or 100 day glaucoma</li>\n<li>Vitreous hemorrhage</li>\n</ul>\n<p>100-day glaucoma is a type of neovascular glaucoma (NVG) and is so-called because it typically develops&nbsp;<strong>3 months after</strong>&nbsp;the episode of CRVO.</p>\n<p>Treatment usually involves treating the <strong>underlying cause </strong>and<strong> complications.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/82bfaada75de4acabfc07ae5c9716811.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "3 months following cataract surgery, a patient comes with complaints of decreased visual acuity. On examination, posterior capsular opacification is seen. What type of laser can be used to treat this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Femto laser"
      },
      {
        "id": 2,
        "text": "Nd-Yag laser"
      },
      {
        "id": 3,
        "text": "Argon flouride"
      },
      {
        "id": 4,
        "text": "Argon"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given history mentions\u00a0<strong>decreased visual acuity</strong> 3 months post-cataract surgery and the presence of\u00a0<strong>posterior capsular opacification</strong> is suggestive of<strong>\u00a0after-cataract. </strong>A posterior\u00a0capsulotomy (creating a hole in the posterior capsule) using an <strong>Nd: YAG laser</strong> is the mainstay of treatment.</p>\n<p>Posterior capsular opacification, otherwise known as\u00a0<strong>after cataract/</strong><strong>secondary cataract,</strong>\u00a0is the\u00a0<strong>most common late complication</strong>\u00a0of uncomplicated cataract surgery. It occurs due to the<strong> proliferation</strong> of <strong>lens\u00a0epithelial cells</strong>\u00a0that have been left out inside the capsular bag after cataract surgery.\u00a0The rate of posterior capsule opacification following extracapsular cataract extraction (ECCE) and phacoemulsification varies with\u00a0the age of the patient, the surgeon, the surgical technique, the type of intraocular lens used, and the duration after surgery.</p>\n<p>Symptoms of after cataract include:</p>\n<ul>\n<li>Reduction of visual acuity</li>\n<li>Slowly worsening blurring</li>\n<li>Glare and occasionally monocular diplopia</li>\n</ul>\n<p>They can present in different patterns such as:</p>\n<ul>\n<li><strong>Elschnig's pearls</strong>: present as<strong>\u00a0</strong>vacuolated (pearl-type) grape-like clusters of swollen cells\u00a0</li>\n<li><strong>Soemmering's ring</strong>: present as a white annular proliferation that is formed at the periphery of the capsular bag.</li>\n<li><strong>Fibrosis type</strong>: present as fibroblastic metaplasia of the epithelial cells\u00a0</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2512b89adf444626b1c9613e97042b7ax1279x1441.JPEG"
    ]
  },
  {
    "text": "A  post-cataract surgery patient who had the surgery 3 months back presents with complaints of blurring of vision for the past 2 weeks. On fundoscopy, there is a honeycomb appearance. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Cystoid macular edema"
      },
      {
        "id": 2,
        "text": "Macular hole"
      },
      {
        "id": 3,
        "text": "Central serous retinopathy"
      },
      {
        "id": 4,
        "text": "After cataract"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The clinical scenario of a\u00a0<strong>post-cataract surgery</strong> patient presenting with a blurring of vision and a <strong>honeycomb appearance on fundoscopy</strong>\u00a0is suggestive of\u00a0<strong>cystoid macular edema</strong> (CME).</p>\n<p>Common causes of CME include previous <strong>cataract surgery</strong>, uveitis, central retinal vein occlusions, <strong>diabetic retinopathy</strong>, retinitis pigmentosa, retinopathy of prematurity, and topical <strong>prostaglandins</strong>. Cystoid macular edema in post-cataract surgery patients is termed as <strong>Irvine-Gass</strong> syndrome.\u00a0</p>\n<p>In CME, optical coherence tomography (OCT) shows loss of foveal depression, <strong>intraretinal cystoid spaces</strong>, and retinal thickening. CME occurs due to a break in the <strong>inner and outer blood-retinal barrier</strong>. Due to retinal vessel leak fluid or exudate comes out and forms cystic space in the central retina. Mostly it gets <strong>accumulated</strong> in the <strong>outer plexiform</strong> (Henle's layer) and <strong>inner nuclear layers</strong> of the retina.\u00a0</p>\n<p>On fundoscopy, the multiple cystoid oval spaces in CME appear as a\u00a0 <strong>honeycomb appearance</strong>. In Fundus fluorescein angiography fluid accumulation in the outer plexiform, layer shows a characteristic <strong>flower petal pattern</strong> (<strong>petaloid appearance</strong>) as shown below:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/75f339fe6bc94e2eb96be8fd4804c332x204x136.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/07394bd891a14ccc920a99f2a2b06eb9x338x106.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1abc1b9b97c648928ab85cd932d22189x800x502.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/43c02c0a5ddf428b9a63dd42becec01fx1279x1441.JPEG"
    ]
  },
  {
    "text": "Internal hordeolum is due to inflammation of:",
    "choices": [
      {
        "id": 1,
        "text": "Mohl gland"
      },
      {
        "id": 2,
        "text": "Zeis gland"
      },
      {
        "id": 3,
        "text": "Meibomian gland"
      },
      {
        "id": 4,
        "text": "Lacrimal gland"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Internal hordeolum</strong> is due to inflammation of&nbsp;<strong>Meibomian gland.</strong></p>\n<p>Hordeolum internum is the <strong>suppurative inflammation</strong> of the <strong>Meibomian gland</strong> and may occur as a <strong>primary infection</strong> or secondary to <strong>infected chalazion</strong>. There is a <strong>tender swelling</strong> with the <strong>pus point</strong> facing toward the tarsal <strong>conjunctiva</strong>. The below image shows an internal hordeolum.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/78d538945eb14f35be45297dfcd46c93x600x450.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/75c5241525de4e03a17b66bff65f9e2bx1279x972.JPEG"
    ]
  },
  {
    "text": "Which of the following is not a disease included under Global Vision 2020 Program, but included recently in Vision 2020 program for India?",
    "choices": [
      {
        "id": 1,
        "text": "Cataract"
      },
      {
        "id": 2,
        "text": "Refractive error"
      },
      {
        "id": 3,
        "text": "Childhood blindness"
      },
      {
        "id": 4,
        "text": "Glaucoma"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Glaucoma</strong>&nbsp;is not included in the Global Vision 2020 Program but is included <strong>under&nbsp;Vision 2020 program for India</strong>.</p>\n<p><strong>Diseases</strong> targeted under <strong>Vision 2020</strong></p>\n<table style=\"height: 229px; width: 365px;\">\n<tbody>\n<tr style=\"height: 36px;\">\n<td style=\"width: 39px; text-align: center; height: 36px;\"><strong>S. No</strong></td>\n<td style=\"width: 144.646px; text-align: center; height: 36px;\"><strong>Globally</strong></td>\n<td style=\"width: 158.354px; text-align: center; height: 36px;\"><strong>India&nbsp;</strong></td>\n</tr>\n<tr style=\"height: 46px;\">\n<td style=\"width: 39px; text-align: center; height: 46px;\">\n<p>1.&nbsp;</p>\n</td>\n<td style=\"width: 144.646px; height: 46px;\">\n<p><strong>Cataract</strong></p>\n</td>\n<td style=\"width: 158.354px; height: 46px;\"><strong>Cataract</strong></td>\n</tr>\n<tr style=\"height: 46px;\">\n<td style=\"width: 39px; text-align: center; height: 46px;\">\n<p>2.</p>\n</td>\n<td style=\"width: 144.646px; height: 46px;\">\n<p><strong>Refractive errors</strong></p>\n</td>\n<td style=\"width: 158.354px; height: 46px;\">\n<p><strong>Refractive errors</strong></p>\n</td>\n</tr>\n<tr style=\"height: 46px;\">\n<td style=\"width: 39px; text-align: center; height: 46px;\">\n<p>3.</p>\n</td>\n<td style=\"width: 144.646px; height: 46px;\">\n<p><strong>Childhood blindness</strong></p>\n</td>\n<td style=\"width: 158.354px; height: 46px;\">\n<p><strong>Childhood blindness</strong></p>\n</td>\n</tr>\n<tr style=\"height: 64px;\">\n<td style=\"width: 39px; text-align: center; height: 64px;\">\n<p>4.</p>\n</td>\n<td style=\"width: 144.646px; height: 64px;\">\n<p>Onchocerciasis</p>\n</td>\n<td style=\"width: 158.354px; height: 64px;\">\n<p><strong>Glaucoma</strong></p>\n</td>\n</tr>\n<tr style=\"height: 46px;\">\n<td style=\"width: 39px; text-align: center; height: 46px;\">\n<p>5.</p>\n</td>\n<td style=\"width: 144.646px; height: 46px;\">\n<p>Trachoma</p>\n</td>\n<td style=\"width: 158.354px; height: 46px;\">\n<p>Diabetic retinopathy</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 39px; text-align: center;\">\n<p>6.&nbsp;</p>\n</td>\n<td style=\"width: 144.646px;\">\n<p>Low vision</p>\n</td>\n<td style=\"width: 158.354px;\">\n<p>Corneal blindness</p>\n</td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 65-year-old woman presented with sudden, progressive, painless loss of vision in the right eye. There was no history of associated photopsia. On examination, shifting fluid sign is present. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Exudative RD"
      },
      {
        "id": 2,
        "text": "Traction RD"
      },
      {
        "id": 3,
        "text": "Rhegmatogenous RD"
      },
      {
        "id": 4,
        "text": "Retinal dialysis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario with&nbsp;the&nbsp;<strong>presence of shifting fluid&nbsp;</strong>is suggestive of&nbsp;<strong>exudative retinal detachment.&nbsp;</strong></p>\n<p><strong>Exudative RD</strong>&nbsp;is characterized by the accumulation of fluid beneath the retina in the absence of a retinal break or traction. Fluid leaks outside the vessels and accumulates under the retina. RD does not occur as long as the retinal pigment epithelium is pumping the leaking fluid into the choroidal circulation.&nbsp;Causes:</p>\n<ul>\n<li>Inflammatory conditions like choroiditis, posterior scleritis.</li>\n<li>Choroidal tumours like melanoma.</li>\n<li>Toxaemia of pregnancy</li>\n<li>Central serous retinopathy</li>\n<li>Coats disease</li>\n</ul>\n<p>Patients may present with painless progressive visual field defects without photopsia. Floaters may be present if there is an associated vitritis. Clinical signs include:</p>\n<ul>\n<li>Convex configuration of the retinal detachment, with a smooth surface</li>\n<li>A detached retina is very mobile</li>\n<li><strong>Shifting fluid sign</strong>- Subretinal fluid detaches the area of the retina under which it accumulates. In the upright position, it collects under the inferior retina. But in the supine position, the inferior retina flattens, the fluid shifts posteriorly which detach the superior retina.</li>\n<li>The cause of the RD may be apparent.&nbsp;</li>\n<li>Leopard spots- Scattered areas of clumped subretinal pigment may be seen after the detachment has flattened</li>\n</ul>\n<p>Retinal detachment (RD) is the result of the accumulation of fluid between the retina and the retinal pigment epithelium. It&nbsp;is classified into the following:</p>\n<ul>\n<li>Rhegmatogenous RD- due to a tear or break in the retina</li>\n<li>Secondary RD - due to some other preceding event\n<ul>\n<li>Exudative RD</li>\n<li>Tractional RD</li>\n</ul>\n</li>\n</ul>\n<p>The image shows the shifting fluid sign and late-phase&nbsp;fluorescein angiogram showing hyperfluorescent spots with a<strong>&nbsp;leopard spot pattern</strong>&nbsp;in the posterior fundus and staining of the arteries and an avascular area in the nasal region respectively.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/bbf5b35d2b88410c87c39ddc1871a787x1280x2442.JPEG"
    ]
  },
  {
    "text": "Cornea verticillate is caused by______.",
    "choices": [
      {
        "id": 1,
        "text": "Erythromycin"
      },
      {
        "id": 2,
        "text": "Amiodarone"
      },
      {
        "id": 3,
        "text": "Timolol"
      },
      {
        "id": 4,
        "text": "Tetracycline"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<ul>\n<li><strong>Cornea verticillate</strong>/<strong>vortex keratopathy</strong> is a&nbsp;<strong>whorl-like</strong> opacity in the <strong>corneal epithelium</strong>.</li>\n<li>Causes\n<ul>\n<li><strong>Amiodarone </strong></li>\n<li>Tamoxifen</li>\n<li>Indomethacin</li>\n<li>Chloroquine</li>\n<li>Fabry&rsquo;s disease</li>\n<li>Rare cause: chlorpromazine</li>\n</ul>\n</li>\n<li>Opacity due to drugs is&nbsp;<strong>reversible</strong> on stopping the drug.</li>\n</ul>\n<p>Image: Vortex keratopathy</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a4835f4c2d994a9f94c7a0d5c8cee93ax623x415.PNG"
    ]
  },
  {
    "text": "A neonate is brought with complaints of photophobia and watering. Clinical examination shows normal tear passages and a clear, but large, cornea as well as Haab\u2019s striae. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Buphthalmos"
      },
      {
        "id": 2,
        "text": "Keratoconus"
      },
      {
        "id": 3,
        "text": "Trachoma"
      },
      {
        "id": 4,
        "text": "Keratoglobus"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario is suggestive of&nbsp;<strong>buphthalmos.&nbsp;</strong><strong>Haab&rsquo;s striae</strong> are horizontal/circumferential breaks in <strong>Descemet&rsquo;s</strong> membrane seen in<strong>&nbsp;buphthalmos</strong>.</p>\n<p>Buphthalmos (bull<strong>-</strong>like eyes) is an enlargement of the eyeball seen in <strong>true congenital</strong> and <strong>infantile glaucoma,</strong> usually when the disease onset is <strong>before</strong> <strong>3</strong> <strong>years.</strong></p>\n<p>The image given below shows&nbsp;Haab's striae and a child having buphthalmos in congenital glaucoma.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://cdn1.dailyrounds.org/uploads/8c94f464a48143879195b4489a6d0fcfx268x188.JPEG",
      "https://cdn1.dailyrounds.org/uploads/b77dc64f6e124e929988a7a9e807a8a6x638x351.JPEG",
      "https://cdn1.dailyrounds.org/uploads/a6f9a4a76c784bc69dc3947ea936998ex246x205.JPEG"
    ]
  },
  {
    "text": "An 18-year-old boy presents with a history of injury to the eye caused while climbing a tree 5 days ago; the injury has caused pain, photophobia, and redness of the eye for 2 days. He is diagnosed with a fungal ulcer. What of the following will be seen in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Reverse hypopyon"
      },
      {
        "id": 2,
        "text": "Dendritic ulcer on a fluorescien dye"
      },
      {
        "id": 3,
        "text": "Ring abscess"
      },
      {
        "id": 4,
        "text": "Satellite lesion"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Satellite lesions</strong> are characteristic of fungal ulcer.</p>\n<p>The given clinical vignette and the image of an\u00a0<strong>ulcer</strong>\u00a0with\u00a0<strong>irregular feathery margins</strong>\u00a0are suggestive of a\u00a0<strong>fungal corneal ulcer. Satellite lesions</strong>\u00a0are a feature of fungal ulcers.</p>\n<p>A fungal corneal ulcer is usually caused by trauma with\u00a0<strong>vegetative</strong>\u00a0or organic matter.\u00a0<strong>Signs</strong>\u00a0are more pronounced than symptoms. The corneal ulcer\u00a0<strong>appears\u00a0dry.</strong></p>\n<p><strong>Causative organisms</strong>:</p>\n<ul>\n<li><em>Aspergillus</em></li>\n<li><em>Fusarium</em></li>\n<li><em>Candida albicans</em></li>\n</ul>\n<p><strong>Signs of a fungal ulcer:</strong></p>\n<ul>\n<li>Irregular margins of the ulcer</li>\n<li>Presence of\u00a0<strong>satellite lesions</strong>\u00a0surrounding the ulcer.</li>\n<li>An immune ring (Wesseley ring) may be seen around the ulcer due to the deposition of the immune complexes.</li>\n<li>Slough is usually dry, with feathery borders surrounded by a yellow line of demarcation.</li>\n<li>Hypopyon may be present or absent. If present, it is thick, and immobile due to the direct invasion of the fungal hyphae into the anterior chamber.</li>\n</ul>\n<p>The image given below shows a fungal ulcer:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://cdn1.dailyrounds.org/uploads/a4348274f725436081a49dae9020ef36.PNG"
    ]
  },
  {
    "text": "A worried mother brought her son for vision examination when she noticed him reading a book too closely. She says he also narrows his eyes while watching television. Examination revealed myopia. Which of the following lens should be prescribed to correct this child's vision?",
    "choices": [
      {
        "id": 1,
        "text": "Convex"
      },
      {
        "id": 2,
        "text": "Concave"
      },
      {
        "id": 3,
        "text": "Cylindrical"
      },
      {
        "id": 4,
        "text": "Concave + convex"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Concave</strong> lenses are used for correcting <strong>myopic</strong> errors.</p>\n<p><strong>Myopia</strong>, also known as '<strong>short sight</strong>', is that dioptric condition of the eye in which, with the&nbsp;<strong>accommodation at rest</strong>, incident parallel rays come to a focus anterior to the light-sensitive layer of the retina.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8f91fb8bcf7145de8d154b883877458ax1280x1006.JPEG"
    ]
  },
  {
    "text": "An infant is brought with complaints of constant watering of eyes with mucopurulent discharge and a non-pulsatile swelling as shown in the image. What is the possible diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Anterior encephalocele"
      },
      {
        "id": 2,
        "text": "Congenital dacryocystitis"
      },
      {
        "id": 3,
        "text": "Syringoma"
      },
      {
        "id": 4,
        "text": "Chalazion"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given presentation of <strong>excessive watering </strong>of the eyes<strong>&nbsp;</strong>and&nbsp;<strong>swelling</strong>&nbsp;over the lacrimal sac in an <strong>infant</strong> is suggestive of&nbsp;<strong>congenital dacryocystitis</strong>.</p>\n<p>Congenital dacryocystitis is the <strong>chronic inflammation</strong> of the<strong> lacrimal sac</strong> due to the accumulation of secretions. This occurs secondary to an obstruction along the course of the nasolacrimal duct.</p>\n<p>Clinical features are <strong>epiphora</strong>&nbsp;progressing to <strong>mucopurulent discharge</strong>,&nbsp;<strong>positive regurgitation test</strong>, and<strong> swelling</strong> over the lacrimal sac area.</p>\n<p>The treatment plan is decided according to the age at presentation.&nbsp;<strong>Massaging </strong>over the lacrimal sac and <strong>topical antibiotics</strong> are used as first-line treatment.</p>\n<p>Management</p>\n<ul>\n<li><strong>Massage</strong> over the lacrimal sac area along with topical antibiotics is a conservative management method that can cure symptoms in infants up to <strong>6-9 months</strong></li>\n<li>Probing of the nasolacrimal duct with Bowman's probe can be attempted if symptoms do not resolve within 6 months.&nbsp;</li>\n<li><strong>Dacryocystorhinostomy</strong> may be done if the child is brought late or if all other treatment methods fail.&nbsp;</li>\n</ul>\n<p>Other options:</p>\n<p>Option A: <strong>Anterior encephalocele</strong> is a pulsatile swelling in the superomedial part of the orbit. It is caused by the herniation of intracranial content through a congenital defect in the skull.</p>\n<p>Option C: <strong>Syringomas</strong> are benign proliferations of eccrine sweat glands and are noted as multiple small papules.&nbsp;</p>\n<p>Option D: <strong>Chalazion</strong> is a chronic granulomatous,<strong>&nbsp;painless swelling</strong> of the <strong>Meibomian gland</strong> in the eyelid.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c50e6188deb34380b0f1ccf8bd859777.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not derived from surface ectoderm?",
    "choices": [
      {
        "id": 1,
        "text": "Lens"
      },
      {
        "id": 2,
        "text": "Corneal epithelium"
      },
      {
        "id": 3,
        "text": "Conjunctival epithelium"
      },
      {
        "id": 4,
        "text": "Iris epithelium"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Iris epithelium</strong> is not derived from surface ectoderm. It is derived from <strong>neural ectoderm</strong>.</p>\n<p><strong>Lens, corneal epithelium, and conjunctival epithelium</strong> are all derivatives of <strong>surface ectoderm.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following test is not used to assess color vision?",
    "choices": [
      {
        "id": 1,
        "text": "Ishihara\u2019s chart"
      },
      {
        "id": 2,
        "text": "Farnsworth\u2013Munsell 100-hue test"
      },
      {
        "id": 3,
        "text": "Amsler's grid test"
      },
      {
        "id": 4,
        "text": "Holmgren's wools test"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Amsler's grid</strong> test&nbsp;is not used to assess color vision. It is used to assess <strong>macular pathology</strong>.</p>\n<p>Commonly employed color vision tests include:</p>\n<ul>\n<li><strong>Ishihara&rsquo;s chart</strong></li>\n<li><strong>Farnsworth&ndash;Munsell 100-hue test</strong></li>\n<li>Hardy&ndash;Rand&ndash;Rittler test</li>\n<li class=\"p1\">Edridge-Green lantern test</li>\n<li>City University test</li>\n<li><strong>Holmgrens wool-matching test</strong></li>\n<li>Naegels anamoloscope</li>\n</ul>\n<p>The below image shows the <strong>Farnsworth&ndash;Munsell 100-hue test,&nbsp;</strong>which is used&nbsp;to test color vision.&nbsp;<strong>Farnsworth D15 hue</strong> discrimination test <span class=\"s1\">is similar to the below&nbsp;</span>test but it utilizes only <strong>15 hue caps</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b21f3df62c96487299205e9c396ca5dfx720x269.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a4215a566b114826a4f6c493323dfff1x800x800.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/83596dc31f314030b20b42b3ef1474a8x447x599.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/171038bb48fa4e0abeca0e2eb3e9d6ffx1280x1280.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f5ad0410d99a4d31a3b54cfb25fd2b89x720x763.JPEG"
    ]
  },
  {
    "text": "Internuclear ophthalmoplegia is due to a lesion in the _______.",
    "choices": [
      {
        "id": 1,
        "text": "Occipital lobe"
      },
      {
        "id": 2,
        "text": "Paramedian pontine reticular formation (PPRF)"
      },
      {
        "id": 3,
        "text": "Medial longitudinal fasciculus"
      },
      {
        "id": 4,
        "text": "Pretectal fibres"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Lesion to the <strong>medial longitudinal fasciculus</strong> causes <strong>internulcear ophthalmoplegia</strong>.</p>\n<p><strong>Internuclear ophthalmoplegia</strong></p>\n<ul>\n<li>Lesion to <strong>medial longitudinal fasciculus </strong>(MLF)</li>\n<li>Seen in multiple sclerosis</li>\n</ul>\n<p>Anatomy</p>\n<ul>\n<li>After initiation, horizontal eye movements are generated in the&nbsp;<strong>horizontal gaze centre (PPRF)</strong> and mediated via a common pathway.</li>\n<li>From here, impulses travel\n<ul>\n<li><strong>directly</strong> to the ipsilateral sixth nerve nucleus and</li>\n<li><strong>indirectly</strong> via internuclear neurons that cross the midline at the level of the pons and pass up the contralateral medial longitudinal fasciculus (MLF), to motor neurones in the medial rectus subnucleus of the contralateral third nerve complex.</li>\n</ul>\n</li>\n<li>Stimulation of the horizontal gaze center on one side, thereby causing a conjugate movement of the eyes to the same side.</li>\n</ul>\n<p>Features:</p>\n<ul>\n<li>Defect in ipsilateral adduction: Medial rectus defect</li>\n<li>Horizontal diplopia</li>\n<li>Nystagmus of opposite eye</li>\n<li>Convergence is normal</li>\n</ul>\n<p>&nbsp;<strong>Image</strong>: Internuclear ophthalmoplegia</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/38bbb35dc53a4e168fbd41cbc0aec091x1280x2729.JPEG"
    ]
  },
  {
    "text": "What is the use of this surgical instrument?",
    "choices": [
      {
        "id": 1,
        "text": "Dilate the punctum of lacrimal gland"
      },
      {
        "id": 2,
        "text": "Probing the nasolacrimal duct"
      },
      {
        "id": 3,
        "text": "Syringing the lacrimal passage"
      },
      {
        "id": 4,
        "text": "Curette the lacrimal sac in cases of epiphora"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given image shows&nbsp;<strong>Bowman's lacrimal probe.&nbsp; </strong>It is identified<strong>&nbsp;</strong>by the ends of the lacrimal probe which are <strong>blunt</strong> with a central stable platform. It is used to probe the nasolacrimal duct in the management of&nbsp;<strong>congenital nasolacrimal duct obstruction.&nbsp;</strong>It is also used to identify the lacrimal sac during dacryocystorhinostomy and dacryocystectomy.</p>\n<p>Other common instruments used in lacrimal gland surgeries:</p>\n<p><strong>Nettleship lacrimal punctum dilator</strong> (shown in the image attached below) is used to dilate the punctum before lacrimal sac surgeries (Option-A)</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/90b535c6ae1b43bc89cf30c06f8475df.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5ed23a41bacd4c6489de9c05b5cc0953x1200x900.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/200b0b91cadb4cdb95d4751cb3866954x1280x790.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ca47b6366238429a95e8e521339044cfx1280x1335.JPEG"
    ]
  },
  {
    "text": "A patient suffers head trauma following which he complains of diplopia. His extraocular motility testing in the 9 gazes is as shown in the image. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Medial rectus palsy"
      },
      {
        "id": 2,
        "text": "Trochlear nerve palsy"
      },
      {
        "id": 3,
        "text": "Abducens nerve palsy"
      },
      {
        "id": 4,
        "text": "Oculomotor nerve palsy"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The image is suggestive of&nbsp;<strong>oculomotor nerve palsy&nbsp;</strong>(3<sup>rd</sup>&nbsp;nerve palsy).</p>\n<p>The central image shows the eyes in primary gaze where the patient's <strong>left eye</strong> has <strong>deviated down and out</strong>. There is also profound<strong> ptosis</strong> due to the weakness of the<strong> levator muscle</strong>.&nbsp;Due to the involvement of the <strong>superior rectus </strong>and<strong> medial rectus</strong>, <strong>elevation and adduction</strong> will be <strong>impaired</strong>. Abduction and depression in the primary position (down and out) due to unopposed action of the lateral rectus and superior oblique muscles. All of these findings indicate&nbsp;<strong>left oculomotor nerve palsy</strong>.</p>\n<p>The signs of left oculomotor nerve palsy are summarized in the image attached below.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d4bb23f4600141258c1fe80f0d6a159a.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8d647a6530f34aba91fec5720a4a03bcx1280x3519.JPEG"
    ]
  },
  {
    "text": "A 2-year-old child is brought to the ophthalmology OPD with complaints of watering eyes and inability to keep eyes opened in a bright room. On ocular examination, the following finding is noted. The finding is a defect in which of the following layers of the cornea?",
    "choices": [
      {
        "id": 1,
        "text": "Descemet's membrane"
      },
      {
        "id": 2,
        "text": "Stroma"
      },
      {
        "id": 3,
        "text": "Endothelium"
      },
      {
        "id": 4,
        "text": "Epithelium"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario of a child with photophobia and excessive watering and image showing <strong>Haab striae</strong> is suggestive of\u00a0<strong>congenital glaucoma.\u00a0</strong>Haab striae are curvilinear healed breaks in the <strong>descemet membrane</strong>.</p>\n<p><strong>Primary congenital glaucoma</strong> refers to abnormally high intraocular pressure (IOP) which occurs as a result of a developmental anomaly of the angle of the anterior chamber. It is not associated with any other ocular or systemic anomaly. It can be classified as follows:</p>\n<ul>\n<li style=\"font-weight: 400;\">True congenital glaucoma (40%) in which intraocular pressure (IOP) is elevated during intrauterine life.</li>\n<li style=\"font-weight: 400;\">Infantile glaucoma (55%), which manifests prior to age 3.</li>\n<li style=\"font-weight: 400;\">Juvenile glaucoma, the least common, in which IOP rises between 3 and 16 years of age.</li>\n</ul>\n<p><strong>Diagnosis:</strong></p>\n<ul>\n<li style=\"font-weight: 400;\"><strong>Corneal haze</strong> is due to diffuse edema secondary to raised IOP.</li>\n<li style=\"font-weight: 400;\"><strong>Buphthalmos</strong> is a large eye as a result of stretching due to elevated IOP prior to the age of 3 years.</li>\n<li style=\"font-weight: 400;\"><strong>Haab striae</strong> are curvilinear healed breaks in Descemet's membrane.</li>\n<li style=\"font-weight: 400;\">Corneal scarring</li>\n</ul>\n<p>Below image shows hazy cornea.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/12e0a1f91d8c421da3569ff32ff2a432.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/08ba56f47bd943b385af64f20d88ffa4x720x340.PNG"
    ]
  },
  {
    "text": "A preterm baby in the neonatal intensive care unit is being screened for retinopathy of prematurity (ROP). She is found to have stage 2 ROP in zone I with no plus disease.  What is the recommended treatment for this stage of the disease?",
    "choices": [
      {
        "id": 1,
        "text": "Laser ablation"
      },
      {
        "id": 2,
        "text": "Pars plana vitrectomy"
      },
      {
        "id": 3,
        "text": "Careful observation"
      },
      {
        "id": 4,
        "text": "Intravitreal bevacizumab injection"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The recommended treatment for ROP stage 2 in zone I (categorized as type I/low-risk ROP) is <strong>careful observation</strong> and follow-up.</p>\n<p>Retinopathy of prematurity occurs in <strong>premature infants</strong> with low birth weight, with a typical history of <strong>exposure to oxygen</strong> in <strong>high concentrations</strong> leading to bilateral proliferative retinopathy.&nbsp;</p>\n<p>Stages of Retinopathy of Prematurity:</p>\n<ul>\n<li>Stage 1- demarcation line formation at the edge of vessels, dividing the vascular from the avascular retina.</li>\n<li>Stage 2- intraretinal ridge formation</li>\n<li>Stage 3- ridge with extraretinal fibrovascular proliferation into the vitreous.</li>\n<li>Stage 4-&nbsp;subtotal retinal detachment</li>\n<li>Stage 5- total retinal detachment</li>\n<li><strong>'Plus' disease</strong> is characterized by <strong>dilatation</strong> and<strong> tortuosity of blood vessels</strong> in <strong>at least two quadrants</strong> of the <strong>posterior fundus</strong>. It signifies the progression of the disease.</li>\n</ul>\n<p>Location:</p>\n<p>Zone I: Circular area with a radius twice the distance from disc to the fovea, with the disc as the center. (as shown in the image)<br />Zone II: It covers the area beyond zone I circumferentially till nasal ora serrata.<br />Zone III: It consists of residual temporal crescent anterior to zone II.</p>\n<p>These zones are shown in the image below:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8460e2377cbf4a1dafcf1d9115d74304x1280x1277.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/baed159ca8bf41c0b3faa8193ab04432x510x2089.GIF"
    ]
  },
  {
    "text": "Silent choroid on FFA is a feature of",
    "choices": [
      {
        "id": 1,
        "text": "Stargardt's disease"
      },
      {
        "id": 2,
        "text": "Best's disease"
      },
      {
        "id": 3,
        "text": "Age related macular degeneration"
      },
      {
        "id": 4,
        "text": "Cystoid macular edema"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Silent choroid / Dark choroid </strong>on FFA is a feature of Stargardt's disease.&nbsp;</p>\n<p>The classic feature of 'silent choroid' or &lsquo;dark choroid&rsquo; is due to<strong> masking of background choroidal fluorescence</strong> by diffuse RPE abnormality.&nbsp;</p>\n<p><strong>Stargardt disease / Fundus flavimaculatus (FFM)</strong>&nbsp;</p>\n<p>It constitutes the most common type of <strong>macular dystrophy</strong>. It is characterized by the <strong>accumulation of lipofuscin</strong> within the RPE.<strong>&nbsp;</strong></p>\n<p><strong>Signs</strong></p>\n<ul>\n<li>The macula :\n<ul>\n<li>May initially be normal ,later progressing to an oval <strong>&lsquo;snail slime&rsquo;</strong> or &lsquo;<strong>beaten-bronze</strong>&rsquo; appearance and subsequently to geographic atrophy.</li>\n</ul>\n</li>\n<li>Numerous yellow&ndash;white round, oval or <strong>fish-shaped lesions</strong> at the level of the RPE.&nbsp;</li>\n</ul>\n<p><strong>Investigation</strong><strong>&nbsp;</strong></p>\n<ul>\n<li>Visual fields show <strong>central loss</strong></li>\n<li>FFA -<strong> Dark choroid</strong> ,the macula shows <strong>mixed hyper and hypofluorescence</strong></li>\n</ul>\n<p>Indocyanine green angiography <strong>(ICGA</strong>) shows<strong> hypofluorescent spots.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://cdn1.dailyrounds.org/uploads/7c1f79f978eb417d8e67a085a2f878dax236x189.PNG"
    ]
  },
  {
    "text": "A patient's eye was hit by a tennis ball and developed Hyphema. What is the likely source of bleeding ?",
    "choices": [
      {
        "id": 1,
        "text": "Circulus arteriosus major"
      },
      {
        "id": 2,
        "text": "Anterior ciliary artery"
      },
      {
        "id": 3,
        "text": "Posterior Ciliary artery"
      },
      {
        "id": 4,
        "text": "Circulus arteriosus minor"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Circulus arteriosus major</strong> is responsible for Hyphaema (blood in the anterior chamber).</p>\n<p><strong>Hyphaema:</strong></p>\n<p><strong>Causes of Hyphaema:</strong></p>\n<ul>\n<li>Ocular injuries</li>\n<li>Postoperative</li>\n<li>Herpes zoster iritis</li>\n<li>Gonococcal iritis</li>\n<li>Intraocular tumor</li>\n<li>Spontaneous (from rubeosis iridis)</li>\n</ul>\n<p><strong>Two-way irrigation and aspiration cannula can be used for aspirating hyphaema</strong>.</p>\n<p><strong>Blood Supply of Eye:</strong></p>\n<p><strong>Cornea:&nbsp;</strong>Avascular</p>\n<p><strong>Uvea:&nbsp;</strong>3 arteries are important.</p>\n<ul>\n<li>Short post ciliary artery- Choroid</li>\n<li>Long post ciliary artery-2 in number join each other near ciliary muscle with anterior ciliary arteries to form circulus arteriolar major (C A major).</li>\n<li>Short anterior ciliary arteries join long posterior ciliary arteries to form C A major.</li>\n<li>Branches from circulus arteriolar major go to the pupillary border to form <strong>circulus arteriosus minor(C A minor)</strong>.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/681fb24ad00746be8f78fcb045e13118x1280x1304.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ca343606128743a59eae6cf534986c53x1280x1493.JPEG"
    ]
  }
];
        let quizName = 'Ophthalmology Test';
        const quizFilename = 'ophthalmology-test-0a602b0f.html';
        let hierarchy = ["Marrow", "FMGE Test Series Subject", "2024"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>