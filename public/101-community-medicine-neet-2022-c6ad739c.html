<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>101 Community Medicine Neet 2022 - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / PYQs / Community Medicine
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">12</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "The average life expectancy for a woman in Japan is 87 years. Due to recent advances in testing for cervical cancer, there is an increase in life expectancy by 15 years. The healthcare utility value is 0.8. Which of the following can be calculated from the parameters given?",
    "choices": [
      {
        "id": 1,
        "text": "HALE"
      },
      {
        "id": 2,
        "text": "DALY"
      },
      {
        "id": 3,
        "text": "DFLE"
      },
      {
        "id": 4,
        "text": "QALY"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>QALY&nbsp;</strong>(quality-<span tabindex=\"0\" role=\"tooltip\"><span class=\"povykd\" tabindex=\"0\" role=\"button\" data-enable-toggle-animation=\"true\" data-extra-container-classes=\"ZLo7Eb\" data-hover-hide-delay=\"1000\" data-hover-open-delay=\"500\" data-send-open-event=\"true\" data-theme=\"0\" data-width=\"250\" data-ved=\"2ahUKEwiEy-CYpoL5AhWqUGwGHUOYBkkQmpgGegQIBhAD\"><span class=\"JPfdse\" data-bubble-link=\"\" data-segment-text=\"adjusted life-year\">adjusted life year</span></span></span><span tabindex=\"0\" role=\"tooltip\"><span class=\"povykd\" tabindex=\"0\" role=\"button\" data-enable-toggle-animation=\"true\" data-extra-container-classes=\"ZLo7Eb\" data-hover-hide-delay=\"1000\" data-hover-open-delay=\"500\" data-send-open-event=\"true\" data-theme=\"0\" data-width=\"250\" data-ved=\"2ahUKEwiEy-CYpoL5AhWqUGwGHUOYBkkQmpgGegQIBhAD\"><span class=\"JPfdse\" data-bubble-link=\"\" data-segment-text=\"adjusted life-year\">)&nbsp;</span></span></span>can be calculated by the <strong>utility value</strong>.&nbsp;</p>\n<p>QALY is a <strong>disability rate</strong> indicator. It is based on the <strong>number of years</strong> that would be <strong>added to life</strong> due to <strong>medical intervention.</strong> A utility value of&nbsp;<strong>1.0</strong> is given for each year of&nbsp;<strong>perfect health </strong>and <strong>0</strong> for <strong>death</strong>.&nbsp;It is the measure of the disease burden which includes both quality and quantity of life.</p>\n<p><strong>Disability rates</strong> that are related to illness and injury are used as supplementation to mortality and morbidity indicators. It is based on the concept that a <strong>full range </strong>of <strong>daily activities</strong> implies good health. It is divided into:</p>\n<ul>\n<li><strong>Event-type indicators</strong>: It counts the number of days of restricted activity, bed disability days, and work loss days.</li>\n<li><strong>Person-type indicators</strong>: It counts limitation of mobility and limitation of activity.&nbsp;</li>\n</ul>\n<p>Other options:</p>\n<p>Option A: <strong>HALE</strong>&nbsp;(health adjusted life expectancy) is an&nbsp;indicator that estimates the number of&nbsp;<strong>years</strong>&nbsp;a <strong>newborn</strong> is <strong>expected</strong> to <strong>live</strong>&nbsp;in<strong> full health</strong>&nbsp;based on the&nbsp;<strong>current rates</strong>&nbsp;of<strong>&nbsp;ill health</strong>&nbsp;and&nbsp;<strong>mortality</strong>. HALE&nbsp;is calculated using the&nbsp;<strong>life expectancy&nbsp;</strong>at<strong>&nbsp;birth</strong>&nbsp;with an&nbsp;<strong>adjustment&nbsp;</strong>for time spent in<strong>&nbsp;poor health</strong>. It was known as&nbsp;<strong>DALE&nbsp;</strong>(disability-adjusted life expectancy) previously.&nbsp;</p>\n<p>Option B: <strong>DALY </strong>(disability adjusted life years) is an indicator that estimates&nbsp;the <strong>number </strong>of <strong>years lost</strong> due to ill-health, disability, or early death. It is calculated by:</p>\n<p>DALY=<strong> Years of life lost </strong>(YLL) +<strong> Years lived with disability </strong>(YLD)</p>\n<p>Option C: <strong>DFLE </strong>(disability-free life expectancy) is an indicator that estimates the average number of years an <strong>individual</strong> is<strong> expected </strong>to<strong> live free </strong>of <strong>disability</strong> if the current pattern of mortality and disability continues to apply. It is also known as <strong>active life expectancy&nbsp;</strong>and is calculated by:</p>\n<p>DFLE =&nbsp;<strong>Life expectancy&nbsp;</strong>-<strong> Duration of disability</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You are working in a primary health center (PHC) situated in a high seismic zone. Which of the following will you do as part of preparedness for an emergency?",
    "choices": [
      {
        "id": 1,
        "text": "1, 2, 3, 4"
      },
      {
        "id": 2,
        "text": "2, 3, 4"
      },
      {
        "id": 3,
        "text": "1, 2, 3"
      },
      {
        "id": 4,
        "text": "1, 2, 4"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Steps</strong> <strong>1, 2, </strong>and<strong> 3</strong> are done as part of\u00a0<strong>preparedness</strong> for an emergency by someone working in a PHC situated in a high seismic zone.</p>\n<p><strong>Emergency preparedness</strong> refers to <strong>long-term development activities</strong> that strengthen the capacity of a country to effectively <strong>manage</strong> all kinds of <strong>emergencies</strong>. It involves the following steps:</p>\n<ol>\n<li>Disaster preparedness by making sure all <strong>financial </strong>and other resources are <strong>available</strong></li>\n<li><strong>Increase public awareness</strong> through campaigns and loudspeakers</li>\n<li>Conduct a <strong>simulation</strong> for the disaster and assess the response</li>\n<li>Evaluate the risk of disaster</li>\n<li>Information sessions coordination with news media</li>\n<li>Adopt standards and regulations</li>\n</ol>\n<div class=\"page\" title=\"Page 867\"><strong>Disaster risk management</strong> is a systematic process using administrative decisions, policies, and strategies to lessen the impacts of natural hazards and disasters. The steps are:</div>\n<ul>\n<li><strong>Response</strong> - This includes\u00a0activities such as:<br />\n<ul>\n<li>Search, rescue, and first aid: This step is important since the organized relief services will be able to address only a small fraction of demand after a major disaster.</li>\n<li>Field care: This includes making health care available regardless of facilities and operating status.\u00a0</li>\n<li>Triage: <strong>Classifying</strong>\u00a0the\u00a0<strong>injured</strong>\u00a0based on the\u00a0<strong>severity</strong>\u00a0of the\u00a0<strong>injuries</strong>\u00a0and chances of survival with medical intervention.\u00a0</li>\n<li>Tagging: Tags with name, age, triage category, diagnosis and treatment are put for identification purposes.\u00a0</li>\n<li>Identification of the dead: The dead bodies should be shifted from the disaster site to the mortuary.</li>\n</ul>\n</li>\n<li><strong>Rehabilitation</strong> -\u00a0This includes\u00a0<strong>measures</strong> that lead to the\u00a0<strong>restoration\u00a0</strong>of\u00a0<strong>pre-disaster conditions.\u00a0</strong>These measures include water supply restoration, food safety, basic sanitation,\u00a0personal hygiene, and vector control.</li>\n<li><strong>Mitigation\u00a0</strong>- This includes <strong>measures</strong> to<strong> prevent disasters</strong> from <strong>causing emergencies</strong>\u00a0or to lessen the likely effects of emergencies<strong>.\u00a0</strong>Some of them are flood mitigation, land use planning, improved building codes, and the reduction and protection of vulnerable populations or structures.\u00a0</li>\n<li><strong>Preparedness</strong> - This is a program that aims at <strong>strengthening</strong> the <strong>capacity</strong> of a <strong>country</strong> to manage all types of emergencies efficiently. Its <strong>objective</strong> is to ensure that appropriate measurements are taken for the <strong>relief</strong> and <strong>rehabilitation</strong> of disaster victims.</li>\n</ul>\n<div class=\"page\" title=\"Page 868\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Some measures that should be followed by all <strong>in case of an emergency</strong> include:</p>\n<ul>\n<li><strong>Avoiding</strong> telephone use, unless it is to call for help</li>\n<li>Listen to and carry out the radio or loudspeaker broadcast messages</li>\n<li>Carry out the official instructions given over the radio or by loudspeaker</li>\n<li>Keep a family emergency kit ready</li>\n</ul>\n</div>\n</div>\n</div>\n<p>Note: Vaccination of the general population post-disaster against typhoid, cholera, and tetanus\u00a0is<strong> not recommended.\u00a0</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/809cbb270756434d8959a436b1beab42x1280x1665.JPEG"
    ]
  },
  {
    "text": "Although many animals are implicated in the spread of rabies, dogs are the most common ones. Also, it usually affects children in developing countries. Knowing this, what is the most cost-effective and logical way to reduce the incidence of rabies?",
    "choices": [
      {
        "id": 1,
        "text": "Testing all the dogs for rabies"
      },
      {
        "id": 2,
        "text": "Reduce stray dog population and vaccinate all dogs"
      },
      {
        "id": 3,
        "text": "Increase the laboratory facilities"
      },
      {
        "id": 4,
        "text": "Increase capacity of healthcare workers for surveillance"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Reducing the stray dog population</strong>&nbsp;and <strong>vaccinating all dogs</strong>&nbsp;is the most cost-effective and logical way to reduce the incidence of rabies. The Animal Birth Control initiative from the Government of India is directed towards this goal.&nbsp;</p>\n<p><strong>Rabies </strong>is a highly fatal viral disease caused by<strong><em>&nbsp;</em>Lyssavirus type 1,<em>&nbsp;</em></strong>affecting the<strong> central nervous system. Dogs</strong> are considered the major <strong>source</strong> of rabies infection. Thus immunization of dogs at the age of<strong> 3-4 months</strong> and booster doses at regular intervals is recommended to control rabies. The type of vaccines used are:</p>\n<ul>\n<li><strong>BPL inactivated nervous tissue vaccine&nbsp;</strong>- it is a <strong>single-dose</strong> vaccine. Booster is advised after <strong>6 months</strong> and subsequently&nbsp;<strong>every year</strong>.&nbsp;</li>\n<li><strong>Modified live virus vaccine&nbsp;</strong>- it is also a single-dose vaccine and a booster is given <strong>every 3 years</strong>.&nbsp;</li>\n</ul>\n<p>Other methods to <strong>control rabies</strong> include:</p>\n<ul>\n<li>Registration and licensing of all domestic dogs</li>\n<li>The immediate killing of dogs and cats bitten by rabid animals</li>\n<li>6 months quarantine for imported dogs</li>\n<li>Educating people regarding dog care and prevention of rabies.&nbsp;</li>\n</ul>\n<p>Note: <strong>Strengthening laboratory facilities</strong> and&nbsp;<strong>surveillance</strong> are also the methods used to reduce the incidence according to the <strong>National Rabies Control Program (NRCP)</strong></p>\n<p>Humans get infected after a <strong>deep bite</strong> or <strong>scratch</strong> by an infected animal. The transmission also occurs when the <strong>saliva</strong> of the infected dog comes into direct contact with human mucosa or fresh skin wounds.&nbsp;</p>\n<p>Rabies in man is also known as&nbsp;<strong>hydrophobia</strong>. The clinical features usually begin as prodromal symptoms like headache, and fever followed by<strong> neurological</strong> <strong>symptoms</strong>. The patients usually present with confusion, hallucination, irritability, hydrophobia, <strong>aerophobia</strong>, and muscle spasms. They also present with symptoms of <strong>autonomic dysfunction</strong> such as <strong>hypersalivation</strong>, lacrimation, cardiac arrhythmias, etc.&nbsp;</p>\n<p>Laboratory tests for rabies include:&nbsp;</p>\n<ul>\n<li><strong>Fluorescent antibody test</strong> is a highly reliable and best test for rapid detection of rabies antigen in the infected specimens</li>\n<li>Microscopic examination of the brain tissue to demonstrate <strong>Negri bodies</strong>.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following steps is not included in STEP approach of WHO?",
    "choices": [
      {
        "id": 1,
        "text": "Therapeutic assessment"
      },
      {
        "id": 2,
        "text": "Physical assessment"
      },
      {
        "id": 3,
        "text": "Psychological assessment"
      },
      {
        "id": 4,
        "text": "Behavioral assessment"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Therapeutic assessment</strong>\u00a0is not included in the <strong>STEP approach</strong> of WHO.\u00a0</p>\n<p>STEP approach of WHO is a survey methodology developed to assess risk factors of non-communicable diseases(NCD). It helps the countries to establish an <strong>NCD\u00a0surveillance system.\u00a0</strong>The steps include the following:</p>\n<ul>\n<li>Questionnaires contain questions about <strong>behavioral</strong> risk factors like tobacco use, alcohol use, diet, and physical activity.\u00a0</li>\n<li><strong>Physical measurements</strong>\u00a0contain blood pressure, height, weight, and waist size</li>\n<li>Biochemical measurements contain blood glucose, blood lipids, urinary sodium, and creatinine.\u00a0\u00a0</li>\n</ul>\n<p>Note: Mental health and suicide are included in optional behavioral risk factors (step 1). Hence,\u00a0<strong>psychological assessment</strong> is also included in the STEP approach.\u00a0</p>\n<p><strong>Surveillance</strong> is defined as systematic and continuous data analysis and taking appropriate preventive actions according to the results obtained. Identification of cases that are missed and not notified is known as\u00a0<strong>sentinel surveillance</strong>. It is used in communicable diseases such as HIV, malaria, etc. The<strong> study population</strong>\u00a0for <strong>HIV sentinel surveillance</strong> are sex workers, IV drug abusers, transgender people, migrant workers, truck drivers, etc.\u00a0</p>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A male patient diagnosed with tuberculosis took complete treatment. Sputum examination was done after the completion of the intensive and the continuation phases. It was found to be negative. What is the status of the patient?",
    "choices": [
      {
        "id": 1,
        "text": "Cured"
      },
      {
        "id": 2,
        "text": "Treatment completed"
      },
      {
        "id": 3,
        "text": "Lost to follow up"
      },
      {
        "id": 4,
        "text": "Treatment failed"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The negative sputum examination at the end of the treatment implies the status of the patient is <strong>cured.&nbsp;</strong></p>\n<p>Tuberculosis (TB) is a communicable disease caused by <em><strong>M</strong><strong>ycobacterium tuberculosis</strong>.</em> The disease mainly affects the lungs and causes pulmonary tuberculosis.&nbsp;</p>\n<p>A <strong>bacteriologically confirmed TB</strong> case is one in which the biological specimen tests positive on smear microscopy and culture. A clinically diagnosed TB case is one that is diagnosed as an active TB case by a clinician, who has decided to give the patient a full course of TB treatment.&nbsp;</p>\n<p>There are two phases in the treatment of TB. The <strong>intensive phase</strong> lasts for 2 months and four drugs are used. They are isoniazid, rifampicin, pyrazinamide, and ethambutol. The <strong>continuation phase</strong> lasts for 4 months, where isoniazid is given along with rifampicin and Ethambutol.&nbsp;</p>\n<p>After the completion of anti-tubercular treatment, the sputum/culture is tested and one of the <strong>outcomes</strong> given below is assigned to the patient:&nbsp;</p>\n<ul>\n<li><strong>Cured&nbsp;</strong>- A TB patient whose smear or culture turned negative in the last month of treatment and on at least one previous occasion&nbsp;</li>\n<li><strong>Treatment completed </strong>-<strong>&nbsp;</strong>A TB patient&nbsp;who completed treatment without any failure, but has<strong> no record</strong> to show that <strong>sputum smear</strong> or <strong>culture</strong> results in the last month of treatment and on at least one previous occasion were <strong>negative</strong>; it may be either because tests were not done or because results are unavailable</li>\n<li><strong>Treatment failed&nbsp;</strong>-&nbsp;A TB patient whose <strong>sputum smear</strong> or <strong>culture</strong> is still <strong>positive</strong> <strong>after treatment</strong> for <strong>5 months</strong> or more&nbsp;</li>\n<li><strong>Lost to follow-up&nbsp;</strong>-<strong>&nbsp;</strong>A TB patient who <strong>did not start treatment</strong> or whose <strong>treatment</strong> was <strong>interrupted</strong> for <strong>2 consecutive months</strong> or more</li>\n<li>Died -&nbsp;A TB patient who dies before starting or during the course of treatment for any reason</li>\n<li>Not evaluated - A TB patient for whom no treatment outcome is assigned; this includes cases \"transferred out\" to another treatment unit and cases for whom the treatment outcome is unknown to the reporting unit whose treatment I interrupted</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A cohort study was conducted with drinkers and non-drinkers of green tea to study its effect on diabetes mellitus. The risk ratio was found to be 0.84. Which of the following statements is correct?",
    "choices": [
      {
        "id": 1,
        "text": "Green tea reduces the risk of diabetes"
      },
      {
        "id": 2,
        "text": "Green tea increases the risk of diabetes"
      },
      {
        "id": 3,
        "text": "Data insufficient to establish causal association"
      },
      {
        "id": 4,
        "text": "The value (0.85) tends to be close to 1, hence there is no effect"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Green tea reduces the risk of diabetes mellitus</strong>&nbsp;is the correct statement since the <strong>risk ratio is 0.84.</strong></p>\n<p><strong>Relative risk</strong>&nbsp;(RR) or&nbsp;<strong>risk ratio</strong>&nbsp;is the ratio of the incidence of the disease (or death) among exposed and the incidence among non-exposed. It can be determined from a<strong> cohort study.&nbsp;</strong></p>\n<p>It is a direct measure of the&nbsp;<strong>strength of the association</strong>&nbsp;between suspected cause and effect. The larger the RR, the greater the strength of the association between the suspected factor and disease.&nbsp;</p>\n<ul>\n<li>RR &lt; 1 indicates inverse association(protective effect).</li>\n<li>RR = 1 indicates no association</li>\n<li>RR &gt; 1 indicates a positive association.</li>\n<li>RR of 2 indicates a 100% increase in risk.</li>\n</ul>\n<p>&nbsp;In the question, the risk ratio is less than 1. Hence it implies the incidence of diabetes mellitus is reduced when exposed to green tea.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which statement refers best to the criteria for starting an urban community health center?",
    "choices": [
      {
        "id": 1,
        "text": "Caters to a population of 1-1.5 lakh"
      },
      {
        "id": 2,
        "text": "Referral centre for 2- 3 primary health centers"
      },
      {
        "id": 3,
        "text": "No sub-district and district hospitals present in the area"
      },
      {
        "id": 4,
        "text": "Should have a 100-bed facility in metro cities"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>An <strong>urban</strong> <strong>community health center </strong>(U-CHC)&nbsp;has a <strong>100-bed facility in metro cities.&nbsp;&nbsp;</strong><strong>&nbsp;</strong></p>\n<p>U-CHC acts as a <strong>referral center</strong> for&nbsp;<strong>4&ndash;5 urban primary health centers (U-PHC)</strong>. It is usually a 30&ndash;50 bedded facility that caters to a <strong>population</strong> of<strong> 2,50,000</strong>.&nbsp;</p>\n<p>When it comes to<strong> metro cities,</strong>&nbsp;it caters to a population of<strong> 5,00,000</strong> with a <strong>100-bed facility</strong>. These hospitals will have surgeons, gynecologists, physicians, and pediatricians, along with x-ray and laboratory facilities.&nbsp;</p>\n<p>The specialists at the community health center can refer a patient to the state-level hospital or the nearest medical college hospital directly. The<strong> subdistrict</strong> and <strong>district hospitals</strong> operate <strong>in addition</strong> to CHC to cater to the population.&nbsp;&nbsp;</p>\n<p>Services of CHC:</p>\n<ul>\n<li>Care of routine and emergency cases in medicine and surgery</li>\n<li>Maternal, newborn, and child health</li>\n<li>Family planning</li>\n<li>All the national health program functions</li>\n<li>Physical medicine and rehabilitation services</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "How is a broken vaccine vial disposed, according to biomedical waste management?",
    "choices": [
      {
        "id": 1,
        "text": "Puncture proof blue bin"
      },
      {
        "id": 2,
        "text": "White container"
      },
      {
        "id": 3,
        "text": "Yellow container"
      },
      {
        "id": 4,
        "text": "Red container"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>\u00a0</p>\n<p>The methods used for <strong>treatment and disposal</strong> of healthcare waste are:</p>\n<ul>\n<li><strong>Incineration:</strong>\u00a0This\u00a0is a dry oxidation process done using high temperatures.</li>\n<li><strong>Chemical disinfection</strong>: Chemicals are added to waste to kill or inactivate the microorganisms.</li>\n<li><strong>Wet and dry thermal treatment</strong>: Shredded infectious waste is exposed to\u00a0high temperature, high-pressure steam and it resembles an autoclave sterilization process.\u00a0</li>\n<li><strong>Microwave irradiation:\u00a0</strong>Microorganisms are killed using high-frequency microwave.</li>\n<li><strong>Land disposal.</strong></li>\n<li><strong>Inertization:</strong> Waste<strong>\u00a0</strong>is mixed with cement and other substances before disposal to reduce toxicity.\u00a0</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/955feb4d376a48b09a4a7c7336ec9046x720x558.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/677a8692eede4111ad442e1e257bd814x1280x782.JPEG"
    ]
  },
  {
    "text": "In an urban area in the state of Madhya Pradesh, a primigravida goes for institutional delivery after being motivated by an ASHA worker. What are the benefits they will receive (in terms of money in rupees) under the Janani Suraksha Yojana?",
    "choices": [
      {
        "id": 1,
        "text": "1000 for mother and 400 for ASHA"
      },
      {
        "id": 2,
        "text": "1400 for mother and 600 for ASHA"
      },
      {
        "id": 3,
        "text": "600 for mother and 400 for ASHA"
      },
      {
        "id": 4,
        "text": "400 for mother and 600 for ASHA"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>According to<strong> Janani Suraksha Yojana (JSY)\u00a0</strong>scheme, the <strong>mother </strong>will receive<strong> 1000 rupees</strong> and the <strong>ASHA worker</strong>\u00a0will receive <strong>400 rupees.</strong></p>\n<p>Janani Suraksha Yojana (JSY) is a program under the National Rural Health Mission (NRHM),<strong>\u00a0</strong>whose aim is to <strong>reduce maternal mortality</strong> by encouraging <strong>delivery</strong> in<strong> government health facilities</strong>. Under the scheme, a financial incentive is also provided for giving birth in a government health facility.\u00a0</p>\n<p>The <strong>Accredited Social Health Activist </strong>(ASHA)<strong>\u00a0</strong>is the link between pregnant women and health institutions. She is responsible for making institutional antenatal and postnatal care available.\u00a0</p>\n<p>States are divided into low-performing and high-performing on the basis of <strong>institutional\u00a0delivery rate</strong>. The 10 low-performing states (LPS) with a low institutional delivery rate are\u00a0Uttar Pradesh, Uttarakhand, Madhya Pradesh, Jharkhand, Bihar, Rajasthan, Chattisgarh, Odisha, Assam, and Jammu &amp; Kashmir. All the other states are high-performing states\u00a0(HPS).</p>\n<p>The incentives under JSY are as follows:</p>\n<table style=\"height: 245px; width: 484.719px;\">\n<tbody>\n<tr>\n<td style=\"width: 77px; text-align: left;\">Category\u00a0</td>\n<td style=\"width: 186px; text-align: left;\">Rural area</td>\n<td style=\"width: 196.719px; text-align: left;\"><strong>Urban area</strong></td>\n</tr>\n<tr>\n<td style=\"width: 77px; text-align: left;\">LPS</td>\n<td style=\"width: 186px; text-align: left;\">\n<p>Mother package: 1400/-<br />ASHA's package:600/-<br />Total:2000/-</p>\n</td>\n<td style=\"width: 196.719px; text-align: left;\"><strong>Mother package: 1000/-</strong><br /><strong>ASHA's package:400/-</strong><br />Total:1400/-</td>\n</tr>\n<tr>\n<td style=\"width: 77px; text-align: left;\">HPS</td>\n<td style=\"width: 186px; text-align: left;\">Mother package: 700/-<br />ASHA's package:600/-<br />Total:1300/-</td>\n<td style=\"width: 196.719px; text-align: left;\">Mother package: 600/-<br />ASHA's package:400/-<br />Total:1000/-</td>\n</tr>\n</tbody>\n</table>\n<p>Under this scheme, the cost of cesarean section and management of obstetric complications is also subsidized, up to <strong>Rs 1500</strong> per delivery to the government institutions, where government specialists are not present.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following agency provides seed and manure in applied nutrition programs in schools?",
    "choices": [
      {
        "id": 1,
        "text": "CARE"
      },
      {
        "id": 2,
        "text": "UNDP"
      },
      {
        "id": 3,
        "text": "UNICEF"
      },
      {
        "id": 4,
        "text": "WHO"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>UNICEF&nbsp;</strong>provides seed and manure in applied nutrition programs in schools.&nbsp;</p>\n<p><strong>Applied Nutrition Program&nbsp;</strong>is implemented with the aim of producing various types of productive food by the community for the community itself.</p>\n<p><strong>UNICEF</strong> assists the program by providing implements, <strong>seeds, manure, </strong>and&nbsp;water supply equipment. If free land is available in <strong>schools,&nbsp;</strong>the facilities provided by UNICEF should be used in developing school gardens.</p>\n<p>The produce obtained from the gardens can be utilized for<strong> school feeding programs</strong> and for nutrition education.&nbsp;</p>\n<p>Another strategy called&nbsp;<strong>GOBI&nbsp;</strong>was also implemented by UNICEF with the aim of a <strong>child health revolution.&nbsp;</strong></p>\n<p>Other options:</p>\n<p>Option A- <strong>CARE</strong>-&nbsp;Cooperative for Assistance and Relief Everywhere aims at<strong> providing food</strong> for children in the age group of 6-11 years. It is also helping in projects like&nbsp;integrated nutrition and health project, better health and nutrition projects, anemia control projects, etc.</p>\n<p>Option B- <strong>UNDP</strong>-&nbsp;The United Nations Development Program provides funds for <strong>technical assistance.</strong>&nbsp;Its main objective is to help poorer nations in developing their human and natural resources.&nbsp;</p>\n<p>Option D-<strong> WHO-</strong>&nbsp;World Health Organization aims at the attainment of the <strong>highest level of health</strong> by all people, which helps them to lead a socially and economically productive life.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Many children from a particular community coming to a hospital were detected to have acute lymphoblastic leukemia (ALL). It was assumed that it is due to the presence of cytotoxic waste in the water of that community. If a case-control study has to be done to find whether the chemical and ALL are associated, what will be taken as the control?",
    "choices": [
      {
        "id": 1,
        "text": "Children from the area exposed, but unaffected with the disease"
      },
      {
        "id": 2,
        "text": "Children from the area not exposed and affected with the disease"
      },
      {
        "id": 3,
        "text": "Children coming to your OPD, who do not have the disease"
      },
      {
        "id": 4,
        "text": "All children with ALL irrespective of exposure status"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Children coming to the OPD, who do not have the disease,&nbsp;</strong>will be taken as the&nbsp;<strong>control&nbsp;</strong>for the <strong>case-control study.&nbsp;</strong></p>\n<p>The prerequisite for selecting a&nbsp;<strong>control</strong>&nbsp;<strong>group</strong> is that they must be <strong>free from the disease</strong> under study. They must be as similar as possible to the cases, except for the fact that they should not have the disease.&nbsp;Usually, the control group consists of persons who <strong>have not been exposed</strong> to the disease or factor whose influence is under study. Therefore, among the options, the best answer would be the&nbsp;<strong>children</strong> <strong>coming to the OPD</strong>, <strong>who do not have the disease</strong>&nbsp;as&nbsp;<strong>controls</strong> for the study.</p>\n<p><strong class=\"ng-binding\">Case-control studies&nbsp;</strong>are also called&nbsp;<strong>retrospective</strong>&nbsp;<strong>studies.</strong>&nbsp;This study proceeds from&nbsp;<strong>effect to cause</strong>&nbsp;and is done after the exposure and outcome have occurred.</p>\n<p>They focus on diseases or health problems that have already developed. They are less time-consuming and have no risk of attrition because they&nbsp;<strong>do not require follow-up</strong>.</p>\n<p class=\"p1\">There are four basic steps in conducting a case-control study:</p>\n<ul>\n<li><strong>Selection of cases and controls.</strong></li>\n<li><strong>Matching</strong>- This is done to ensure comparability between cases and controls. Controls are selected such that they are similar to cases with respect to certain factors, like age, that influence the disease outcome.</li>\n<li><strong>Measurement of exposure -&nbsp;</strong>This is<strong>&nbsp;</strong>obtained by interviews, questionnaires, or study of the past records of cases.</li>\n<li><strong>Analysis</strong>&nbsp;in the form of exposure rates, risk ratio, and odds ratio.</li>\n</ul>\n<p class=\"p1\">The <strong>Odds Ratio</strong> (OR) calculated from a case-control study, is a measure of the&nbsp;<strong>strength of the association</strong>&nbsp;between risk factor and outcome.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An auxiliary nurse midwife has to conduct a vaccination camp in a village. She received 2 open vials, one of which is a pentavalent vaccine and the other is an MR vaccine. What can she do regarding the utilization of these vials?",
    "choices": [
      {
        "id": 1,
        "text": "Use MR vaccine and discard pentavalent vaccine"
      },
      {
        "id": 2,
        "text": "Use pentavalent vaccine and discard MR vaccine"
      },
      {
        "id": 3,
        "text": "Use both"
      },
      {
        "id": 4,
        "text": "Discard both"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>She can <strong>use </strong>the <strong>pentavalent vaccine </strong>and<strong> discard </strong>the <strong>MR vaccine.&nbsp;&nbsp;</strong>According to the <strong>open vial policy</strong>, the<strong>&nbsp;</strong>pentavalent vaccine can be reused, whereas MR can not be reused.&nbsp;</p>\n<p>Open vial policy was implemented to allow the reuse of partially used <strong>multidose vials</strong> under the Universal Immunization Program (UIP) for up to <strong>28 days&nbsp;</strong>if certain conditions are met. This was implemented to <strong>reduce vaccine wastage</strong>.</p>\n<p>It&nbsp;applies only to DPT, TT, hepatitis B, oral polio vaccine (OPV),<strong> liquid pentavalent</strong>, PCV, injectable IPV, inactivated Japanese encephalitis (JE) vaccine, and rotavirus vaccine. It does not apply to <strong>Measles/MR </strong>and<strong> </strong>BCG vaccines.</p>\n<p>Note:&nbsp;<strong>Open vial policy</strong>&nbsp;does not apply to rotavirus vaccine with VVM on cap, it applies&nbsp;<strong>only</strong>&nbsp;to&nbsp;<strong>new</strong>&nbsp;rotavirus vaccine with&nbsp;<strong>VVM on label.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '101 Community Medicine Neet 2022';
        let hierarchy = ["Marrow", "PYQs", "Community Medicine"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>