<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>07 Basics Of Cornea And Infectious Keratitis - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Ophthalmology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">25</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "What is the corneal epithelium normally composed of?",
    "choices": [
      {
        "id": 1,
        "text": "Stratified keratinized epithelium"
      },
      {
        "id": 2,
        "text": "Stratified non-keratinized epithelium"
      },
      {
        "id": 3,
        "text": "Columnar epithelium"
      },
      {
        "id": 4,
        "text": "Pseudostratified epithelium"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Layers of the cornea:</p>\n<ul>\n<li><strong>Epithelium </strong>(Stratified squamous non-keratinized epithelium)</li>\n<li><strong>Bowman&rsquo;s</strong> <strong>membrane -&nbsp;</strong>Acellular; does<strong> not regenerate</strong></li>\n<li><strong>Stroma (Thickest layer) -&nbsp;</strong>The stroma can scar, but <strong>cannot regenerate</strong></li>\n<li><strong>Dua&rsquo;s</strong>&nbsp;layer (<strong>Newly discovered, toughest layer</strong>)</li>\n<li><strong>Descemet&rsquo;s</strong>&nbsp;membrane- Ends peripherally as <strong>Schwalbe&rsquo;s ring; </strong>has<strong> regenerative</strong> potential</li>\n<li><strong>Endothelium </strong>(<strong>Most metabolically active layer</strong>)- does <strong>not regenerate</strong></li>\n</ul>\n<p><strong>Note:&nbsp;</strong>&nbsp;<strong>Limbal stem cells </strong>are located at the corneoscleral limbus, in the palisades of Vogt. Deficiency may result in chronic epithelial defects and <strong>\"conjunctivalization\"</strong>&nbsp;of the cornea</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/64c9d0650104451f93a76ed45bf371e7x1200x1471.JPEG"
    ]
  },
  {
    "text": "Which of the following layers is responsible for maintaining the hydration and transparency of the cornea?",
    "choices": [
      {
        "id": 1,
        "text": "Descemet's membrane"
      },
      {
        "id": 2,
        "text": "Endothelial cells"
      },
      {
        "id": 3,
        "text": "Stroma"
      },
      {
        "id": 4,
        "text": "Corneal epithelium"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The hydration level and transparency of the cornea is maintained mainly by the <strong>endothelial cells\u00a0</strong>of the cornea.\u00a0</p>\n<p>The endothelium possesses <strong>Na<sup>+</sup>/K<sup>+</sup> ATPase,</strong> which keeps the corneal stroma\u00a0in<strong>\u00a0</strong>a relatively<strong> dehydrated state</strong>. This helps maintain corneal transparency. <span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">Endothelial cells decrease in number with age. If the cornea becomes overhydrated, it begins to scatter light and gradually begins to lose its transparency</span></p>\n<p>Other factors contributing to the\u00a0transparency of the cornea are as follows:</p>\n<ul>\n<li>Regular arrangement of corneal lamellae (<strong>Maurice theory</strong>)</li>\n<li>The peculiar refractive index of corneal lamellae (<strong>Goldmann theory</strong>)</li>\n<li><strong>Avascularity </strong>of the cornea</li>\n<li>A balance between the intraocular pressure (<strong>IOP</strong>) and <strong>swelling pressure</strong></li>\n</ul>\n<div class=\"page\" title=\"Page 31\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>The different layers of the cornea are as follows:</p>\n<ul>\n<li>Epithelium</li>\n<li>Bowman\u2019s membrane</li>\n<li>Stroma (substantia propria)</li>\n<li>Dua\u2019s layer (pre-Descemet\u2019s layer)</li>\n<li>Descemet\u2019s membrane</li>\n<li>Endothelium</li>\n</ul>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the average density of corneal endothelial cells?",
    "choices": [
      {
        "id": 1,
        "text": "2000\u20132500 cells/mm\u00b2"
      },
      {
        "id": 2,
        "text": "1000\u20131500 cells/mm\u00b2"
      },
      {
        "id": 3,
        "text": "3500\u20134000 cells/mm\u00b2"
      },
      {
        "id": 4,
        "text": "2500\u20133000 cells/mm\u00b2"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The density of corneal endothelial cells in <strong>adults</strong> is about\u00a0<strong>2500\u20133000 cells/mm\u00b2.\u00a0</strong></p>\n<p>Variation in corneal endothelial density with age:\u00a0</p>\n<ul>\n<li><strong>At birth-</strong>\u00a03,500\u20134,000 cells/mm<sup>2</sup>\u00a0at birth</li>\n<li><strong>Young adults-</strong>\u00a02500\u20133000 cells/mm\u00b2</li>\n<li><strong>Old age (about 80 years)-</strong>\u00a02000 cells/mm\u00b2</li>\n</ul>\n<p>Corneas stored in eye banks are assessed for their quality and viability using a variety of parameters. Donor tissues are screened for stress lines, mechanical trauma, scarring, corneal edema, and infiltrates that could indicate poor tissue quality. They are further evaluated for thickness and endothelial cell density (a surrogate for endothelial function) which are important determinants of successful graft transplantation.</p>\n<p>Endothelial cell density (ECD) and morphology are assessed using a <strong>specular microscope</strong> or by a bright-field/phase-contrast light microscope.</p>\n<p><strong>Note</strong>: The number of cells decreases at about 0.6% per year, and the neighboring cells enlarge to fill the space as the cells cannot regenerate. At a density of about 500 cells/mm<sup><span class=\"s1\">2</span></sup><span class=\"s1\">,</span><sup><span class=\"s1\">\u00a0</span></sup>corneal edema develops and transparency is impaired. This is known as critical endothelial density.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Below what horizontal diameter can a diagnosis of micro-cornea be made?",
    "choices": [
      {
        "id": 1,
        "text": "8 mm"
      },
      {
        "id": 2,
        "text": "9 mm"
      },
      {
        "id": 3,
        "text": "10 mm"
      },
      {
        "id": 4,
        "text": "11 mm"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>To make a diagnosis of <strong>microcornea,</strong> in this child, the <strong>diameter</strong> of the cornea should be <strong>less than 10 mm.</strong></p>\n<p><strong>Micro-cornea</strong></p>\n<ul>\n<li>Horizontal corneal diameter is <strong>10 mm or less</strong>\u00a0(over 2 years of age) or <strong>less than 9 mm </strong>(in the <strong>newborn</strong>).</li>\n<li>There may be <strong>hypermetropia</strong> and a <strong>shallow anterior chamber</strong> but other dimensions are normal.</li>\n</ul>\n<p><strong>Megalocornea</strong></p>\n<ul>\n<li>Horizontal corneal diameter is <strong>12 mm or more</strong> (<strong>up to\u00a02</strong> years of age) or <strong>13 mm or more</strong> (if age <strong>&gt;2</strong> years)</li>\n<li>There is typically <strong>high</strong> <strong>myopia</strong> and <strong>astigmatism</strong>, but normal corrected visual acuity.</li>\n<li>Usually <strong>X-linked recessive; 90%</strong> of affected individuals are <strong>male</strong>.</li>\n</ul>\n<p><strong>Cornea plana</strong></p>\n<ul>\n<li>The cornea is<strong> flatter than normal</strong>, i.e.,\u00a0the radius of curvature is larger.</li>\n<li>There is a corresponding reduction in refractive power, resulting in <strong>high hypermetropia. </strong></li>\n</ul>\n<p><strong>Keratectasia</strong></p>\n<ul>\n<li>It is characterized by a<strong> protuberance between the eyelids</strong>\u00a0caused by a <strong>severely opacified,</strong> and sometimes <strong>vascularized, cornea</strong>.</li>\n<li>It is often associated with<strong> raised intraocular pressure </strong>as well as<strong> intrauterine keratitis.</strong></li>\n<li>Usually<strong> unilateral</strong></li>\n</ul>\n<p><strong>Microphthalmos </strong></p>\n<ul>\n<li>Microphthalmia is a condition in which the <strong>entire eye is small</strong>, with an <strong>axial length</strong> at least <strong>two standard deviations</strong> <strong>below</strong> the mean for age.</li>\n<li>It may or may not be associated with ocular dysgenesis.</li>\n</ul>\n<p><strong>Nanophthalmos</strong></p>\n<ul>\n<li>In nanophthalmos (<strong>simple microphthalmos</strong>), the <strong>entire eye is small,</strong> but is <strong>structurally normal</strong>;<strong>\u00a0</strong></li>\n<li>It is usually associated with <strong>hypermetropia</strong> and <strong>strabismus</strong></li>\n</ul>\n<p><strong>Anophthalmos</strong>:<strong>\u00a0</strong>Anophthalmos (anophthalmia) refers to the <strong>complete absence</strong> of any visible globe structure.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following organisms are capable of invading the intact cornea?",
    "choices": [
      {
        "id": 1,
        "text": "Gonococcus"
      },
      {
        "id": 2,
        "text": "Staphylococcus aureus"
      },
      {
        "id": 3,
        "text": "Pneumococcus"
      },
      {
        "id": 4,
        "text": "Pseudomonas"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><em><strong>Gonococcus</strong></em> can invade an intact cornea.</p>\n<p>Organisms that can penetrate the&nbsp;<strong>intact epithelium</strong> of the cornea can be remembered with the mnemonic-&nbsp;<strong>CHaNNeLS</strong></p>\n<ul>\n<li><em><strong>C</strong>orynebacterium diphtheria</em></li>\n<li><em><strong>Ha</strong>emophilus influenza;Haemophilus aegypticus</em></li>\n<li><em><strong>Ne</strong>isseria gonorrhea; Neisseria meningitidis</em></li>\n<li><em><strong>L</strong>isteria</em></li>\n<li><em><strong>S</strong>higella</em></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient with a history of uncomplicated cataract surgery 1 year back, presents with pain, redness, and purulent discharge from his right eye. A greyish-white serpiginous ulcer was noted over the lower third of the cornea. The anterior chamber showed a 4 mm hypopyon and a moderate flare reaction. A smear from the ulcerated area is likely to demonstrate which of the following organisms?",
    "choices": [
      {
        "id": 1,
        "text": "Pseudomonas"
      },
      {
        "id": 2,
        "text": "Pneumococcus"
      },
      {
        "id": 3,
        "text": "Corynebacteria"
      },
      {
        "id": 4,
        "text": "Gonococcus"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Hypopyon corneal ulcer</strong>\u00a0with a characteristic <strong>serpiginous</strong> description (ulcus serpens) is typically caused by<em> <strong>Pneumococcus</strong></em>. The bacterial hypopyon is <strong>sterile</strong>.\u00a0</p>\n<p>Ulcus serpens is a <strong>greyish-white</strong> or <strong>yellowish</strong> <strong>disc-shaped</strong> ulcer occurring near the centre of the cornea. The ulcer has a tendency to creep over the cornea in a <strong>serpiginous fashion</strong>.</p>\n<p>Risk factors include both surgical and non-surgical ocular trauma, dry eye, chronic corneal disease, immune alterations and contact lenses.</p>\n<p>An examination may reveal the following signs:</p>\n<ul>\n<li>Swelling of lids and blepharospasm</li>\n<li>Conjunctival hyperemia</li>\n<li>Ciliary congestion, hypopyon and anterior chamber flare reaction</li>\n<li>Iridocyclitis\u00a0</li>\n</ul>\n<p>Image given below shows ulcus serpens.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://cdn1.dailyrounds.org/uploads/cb7f8fdbd4954b6c9b84f459a3768afax450x309.JPEG"
    ]
  },
  {
    "text": "A young woman presents with sudden onset, rapidly progressing ocular pain, photophobia, and blurred vision in her right eye for 1 day.  A deep, 4 mm diameter corneal ulcer, surrounded by stromal infiltrates was visualized. The anterior chamber has small amounts of mucopurulent discharge. She mentions using a cosmetic contact lens which she forgot to remove before sleeping 2 days ago. What is the most likely etiology?",
    "choices": [
      {
        "id": 1,
        "text": "Staphylococcus"
      },
      {
        "id": 2,
        "text": "Diphtheria"
      },
      {
        "id": 3,
        "text": "Pseudomonas"
      },
      {
        "id": 4,
        "text": "Aspergillus"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The sudden onset and rapid progression of ocular symptoms and ulceration in this patient along with the history of improper <strong>contact lens</strong> usage are suggestive of a <strong>Pseudomonas</strong> infection.\u00a0</p>\n<p><em>Pseudomonas aeruginosa</em> is the<strong> most common gram-negative organism isolated from corneal ulcers</strong> and is a frequent cause of <strong>contact lens\u2013associated\u00a0keratitis.</strong> Other risk factors include chlorinated swimming pools,\u00a0hot tubs, ventilators, nebulizer, and vaporizer solutions, and ophthalmic solution bottles.</p>\n<p>Pseudomonas keratitis has a rapid and fulminant course if left untreated and are associated with a worse visual prognosis than that caused by most other common bacterial pathogens.\u00a0<strong><em>Pseudomonas</em> spp.</strong>\u00a0can cause\u00a0corneal perforation in just <strong>48 hours</strong>. Treatment is mainly by topical NSAIDs and topical antipseudomonal antibiotic eye drops such as tobramycin 1.3% and fluoroquinolone eye drops.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A young woman comes with sudden onset ocular pain, tearing, and photophobia in the left eye. You suspect a bacterial corneal ulcer. What concentration of cephazolin drops would you prescribe for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "2%"
      },
      {
        "id": 2,
        "text": "3%"
      },
      {
        "id": 3,
        "text": "4%"
      },
      {
        "id": 4,
        "text": "5%"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The concentration of fortified cephazolin used to treat uncomplicated bacterial keratitis is <strong>5% ( 50 mg/mL)</strong></p>\n<p><strong>Treatment of uncomplicated bacterial keratitis:</strong></p>\n<ul>\n<li><strong>Antibiotic</strong> eyedrops (broad-spectrum)</li>\n<li>If not responding, fortified antibiotic eye drops are used\n<ul>\n<li>Fortified cephazolin (5%)</li>\n<li>Fortified tobramycin (1.3%)</li>\n<li>Fortified vancomycin (5%)</li>\n</ul>\n</li>\n<li><strong>Cycloplegic drugs-</strong>\u00a0Preferably 1% atropine eye ointment or drops to prevent pain due to ciliary spasm. Also, it\u00a0prevents the development of posterior synechiae.</li>\n<li><strong>Oral vitamin A and vitamin C</strong> help in the\u00a0healing of the epithelium</li>\n<li><strong>Systemic analgesics</strong> and anti-inflammatory drugs</li>\n</ul>\n<p><strong>Management of non-healing ulcers:</strong></p>\n<ul>\n<li><strong>Debridement</strong></li>\n<li>Chemical <strong>cauterization-</strong>\u00a010\u201320% <strong>trichloroacetic acid, </strong>carbolic acid</li>\n<li>Conjunctival <strong>flapping</strong></li>\n</ul>\n<p><strong>Management of impending perforation:</strong></p>\n<ul>\n<li>Decrease intraocular pressure (IOP) by antiglaucoma drugs</li>\n<li>Tissue adhesive glue such as cyanoacrylate</li>\n<li>Bandage contact lens</li>\n<li>No strain</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ab66e42381bb46c1a4d6ac138f04a073.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A non-sterile hypopyon is seen in______.",
    "choices": [
      {
        "id": 1,
        "text": "Pneumococcus infection"
      },
      {
        "id": 2,
        "text": "Pseudomonas infection"
      },
      {
        "id": 3,
        "text": "Fungal infection"
      },
      {
        "id": 4,
        "text": "Gonoccocal infection"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Fungal keratitis can cause <strong>non-sterile hypopyon.</strong></p>\n<p>Unlike bacterial ulcer, the hypopyon may not be sterile as the fungi can penetrate into the anterior chamber without perforation.</p>\n<p><em><strong>Aspergillus</strong></em>\u00a0spp. are the <strong>most common cause</strong>.</p>\n<p>Hypopyon in a fungal ulcer is <strong>fixed</strong>, non-sterile and contains <strong>fungal filaments.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 30-year-old man presents with a history of injury to the eye caused by a leaf 5 days ago, resulting in pain, photophobia, and redness of the eye for 2 days. What would be the most likely pathology?",
    "choices": [
      {
        "id": 1,
        "text": "Anterior uveitis"
      },
      {
        "id": 2,
        "text": "Conjunctivitis"
      },
      {
        "id": 3,
        "text": "Fungal corneal ulcer"
      },
      {
        "id": 4,
        "text": "Corneal laceration"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Option D: <strong>Corneal laceration: </strong>Partial corneal laceration or <strong>lamellar corneal laceration</strong> occurs from a <strong>blunt trauma</strong> and is treated by patching and antibiotics.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c096c57f84794b37997c2853177dc660x372x302.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/938decda907d40fbb4dc1aefb10d627cx1118x1198.JPEG"
    ]
  },
  {
    "text": "A farmer presents with blurring of vision in his left eye. He has a history of injury with a bush to the same eye while working. An ulcer is seen in his cornea with feathery margins. Slit-lamp examination shows infiltrates in the corneal stroma in a circular fashion. Which type of hypersensitivity reaction causes these infiltrates?",
    "choices": [
      {
        "id": 1,
        "text": "Type 4"
      },
      {
        "id": 2,
        "text": "Type 3"
      },
      {
        "id": 3,
        "text": "Type 2"
      },
      {
        "id": 4,
        "text": "Type 1"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical situation points towards a <strong>fungal corneal ulcer</strong> and the infiltrates of stroma in a circular fashion are suggestive of the\u00a0<strong>immune ring of Wessely.</strong>\u00a0This immune ring is due to<strong> type 3 hypersensitivity</strong> reaction (antigen-antibody complex).</p>\n<p>The <strong>immune ring of Wessely</strong> can be made out as a <strong>deep stromal haze</strong> in a slit lamp. It occurs as a result of the deposition of <strong>antigen-antibody complexes</strong> in the stroma. Once deposited it draws the immune cells, inciting further inflammation.</p>\n<p>The given shows an ulcer in the cornea and the adjacent immune ring of Wessely.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0018bcaae4be472eae5056cf17b70f80x688x514.PNG"
    ]
  },
  {
    "text": "What is the characteristic feature of a fungal ulcer?",
    "choices": [
      {
        "id": 1,
        "text": "Reverse hypopyon"
      },
      {
        "id": 2,
        "text": "Dendritic ulcer on a fluorescien dye"
      },
      {
        "id": 3,
        "text": "Ring abscess"
      },
      {
        "id": 4,
        "text": "Satellite lesion"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Satellite lesions</strong> are characteristic of fungal ulcer.</p>\n<p>The signs of a fungal ulcer include:</p>\n<ul>\n<li>Irregular margins of the ulcer.</li>\n<li>Presence of <strong>satellite lesions</strong> surrounding the ulcer.</li>\n<li>An immune ring (Wesseley) may be seen around the ulcer due to deposition of the immune complexes.</li>\n<li>Slough is usually dry, with feathery borders surrounded by a yellow line of demarcation.</li>\n<li>Hypopyon may be present or absent. If present, it is thick, immobile due to the direct invasion of the fungal hyphae into the anterior chamber.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Steroids are contraindicated in_______.",
    "choices": [
      {
        "id": 1,
        "text": "Vernal keratoconjunctivitis"
      },
      {
        "id": 2,
        "text": "Fungal corneal ulcer"
      },
      {
        "id": 3,
        "text": "Atopic dermatitis"
      },
      {
        "id": 4,
        "text": "Stromal keratitis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Steroids </strong>are <strong>contraindicated</strong> in fungal corneal ulcer</p>\n<p>Steroids make the fungi <strong>facultative pathogens</strong>\u00a0when they\u00a0are otherwise symbiotic saprophytes. Therefore, the use of these drugs <strong>predisposes</strong> the patients to <strong>fungal infections</strong> and <strong>perforation</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 41-year-old female presented with a one-month history of photophobia and foreign body sensation in her right eye. A slit-lamp examination showed a corneal ulcer. The culture of the corneal scrapings grew a filamentous organism identified as a fusarium species. What would be the drug of choice in this case?",
    "choices": [
      {
        "id": 1,
        "text": "Natamycin"
      },
      {
        "id": 2,
        "text": "Nystatin"
      },
      {
        "id": 3,
        "text": "Fluconazole"
      },
      {
        "id": 4,
        "text": "Amphotericin B"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>This patient with a one-month history of eye foreign body sensations and photophobia and slit lamp exam showing an ulcer that had fusarium growth most likely has a fungal corneal ulcer. <strong>Natamycin 5% </strong>suspension\u00a0is the drug of choice for <strong>filamentous fungal keratitis</strong> caused by <strong>fusariam</strong> species.\u00a0</p>\n<p>Surface debridement is also done as it helps to remove slough, reduce the load of infection and enhances drug penetration. Amphotericin B is particularly effective against yeasts but less effective against filamentous fungi. Also, its penetration through an intact epithelium is less than natamycin.</p>\n<p><strong>Amphotericin B i</strong>s the first <strong>agent of choice </strong>against<strong> yeasts. </strong>Amphotericin B (0.15%) drops can be considered alone or in combination with natamycin in refractory cases.</p>\n<p>Treatment of specific fungal corneal ulcers:</p>\n<p>Topical antifungal drops</p>\n<ul>\n<li><em>Aspergillus and Fusarium-\u00a0</em>Natamycin 5%, amphotericin B, fluconazole (0.2%)\u00a0</li>\n<li><em>Candida-\u00a0</em>Amphotericin B (0.15%) or econazole (1%)\u00a0</li>\n</ul>\n<p>Systemic antifungals such as itraconazole and voriconazole are used for severe <strong>non-responding cases</strong> or if the location of the ulcer is near the <strong>limbus</strong> or if there is a <strong>risk of perforation</strong> leading to endophthalmitis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not a feature of the given condition?",
    "choices": [
      {
        "id": 1,
        "text": "Superficial punctate keratitis"
      },
      {
        "id": 2,
        "text": "Corneal guttata"
      },
      {
        "id": 3,
        "text": "Geographical ulcer"
      },
      {
        "id": 4,
        "text": "Immune stromal keratitis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The above image shows a <strong>dendritic ulcer</strong> caused by <strong>herpes simplex virus. Corneal guttata</strong> are <strong>not</strong> seen in HSV infection. They are droplet-like accumulations of non-banded collagen on the posterior surface of Descemet's membrane. It is a feature of <strong>corneal dystrophies.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3bf4ee42037e46d6afa629f870b90329.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is true about the given condition?",
    "choices": [
      {
        "id": 1,
        "text": "It is related to Hutchinson\u2019s triad"
      },
      {
        "id": 2,
        "text": "There is usually a history of primary HSV infection as a child"
      },
      {
        "id": 3,
        "text": "Can lead to neurotrophic keratitis"
      },
      {
        "id": 4,
        "text": "High dose topical acyclovir is the treatment of choice"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The image shows a unilateral painful, vesicular rash suggestive of<strong> herpes zoster ophthalmicus (HZO)\u00a0</strong>caused by\u00a0<strong>reactivation</strong> of the varicella-zoster virus (VZV) within the <strong>ophthalmic nerve.</strong>\u00a0<strong>Neurotrophic keratitis</strong> is a complication of HZV infection.</p>\n<p>Keratitis occurs due to corneal nerve damage by the virus leading to decreased sensation, frequent infections, persistent epithelial defect, thinning and even perforation.\u00a0</p>\n<p><strong>Corneal</strong> lesions in <strong>HZO\u00a0</strong>(zoster keratitis):</p>\n<ul>\n<li>Epithelium- superficial punctate keratitis and pseudo-dendritic\u00a0ulcer</li>\n<li>Stroma- nummular keratitis and disciform keratitis\u00a0</li>\n</ul>\n<p><strong>Other ocular lesions in herpes zoster:</strong></p>\n<ul>\n<li>Uveitis</li>\n<li>Episcleritis and scleritis</li>\n<li>Conjunctivitis</li>\n<li>Acute retinal necrosis</li>\n<li>Secondary glaucoma</li>\n<li>Anterior segment necrosis and pthisis bulbi</li>\n</ul>\n<p>Other options:\u00a0</p>\n<p>Option A: Hutchinson\u2019s <strong>rule</strong> is related to herpes zoster ophthalmicus.\u00a0It states that if the tip of the nose is involved, there will be a significant risk of ocular involvement. This is due to the involvement of the nasociliary nerve.\u00a0Hutchinson's triad is seen in congenital syphilis.</p>\n<p>Option B: There is primary<strong> HZV </strong>infection (chickenpox/varicella)<strong> not HSV </strong>infection.</p>\n<p>Option D: <strong>Systemic</strong> acyclovir is the treatment of choice; not topical antiviral drops. Oral acyclovir 800 mg five times a day for 7-10 days, ideally initiated within 72 h of the onset of symptoms is the usual regimen.</p>\n<p>The image shows Hutchinson's sign in a patient with herpes zoster ophthalmicus.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/2b8d284a2e2d418294dd5d4116153c03.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a71269125f3c4a34848588da1b5dd22ax164x454.JPEG"
    ]
  },
  {
    "text": "A 17-year-old boy presented with blurred vision, photophobia, and increasing pain in his right eye. He has been using contact lenses for the past 2 years. He mentions swimming with his cousins 2 weeks back in a local pond. A close-up image of the eye is given below. What is the most likely explanation?",
    "choices": [
      {
        "id": 1,
        "text": "Bacterial keratitis"
      },
      {
        "id": 2,
        "text": "Fungal keratitis"
      },
      {
        "id": 3,
        "text": "Simplex keratitis"
      },
      {
        "id": 4,
        "text": "Acanthamoeba keratitis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The history of a patient with contact lens use with swimming in freshwater ponds with the image depicting a <strong>ring lesion (stromal infiltrate) </strong>makes <strong>acanthamoeba keratitis</strong> the likely diagnosis.</p>\n<p>Acanthamoeba keratitis is a rare protozoal infection of the cornea. It is more common\u00a0in <strong>soft contact lens users. </strong>The organism exists either as active, motile trophozoites or dormant, double-walled cysts.<strong>\u00a0</strong>Suspicious sources of infection can be swimming or use of the hot tub while wearing contact lenses, homemade saline solution to wash contact lenses, exposure to standing groundwater etc.</p>\n<p><strong>Pain</strong> is disproportionate to the degree of keratitis due to <strong>perineural invasion</strong>. It presents as <strong>ring lesion</strong> (most common), pseudo-dendrites and as a reticular pattern.</p>\n<p>Diagnosis:</p>\n<ul>\n<li><strong>Confocal microscopy - </strong>may reveal bright trophozoites with pseudopodia in the basal epithelium and double-walled cyst forms</li>\n<li><strong>Histopathology - double-walled cysts </strong>are seen\u00a0on H&amp;E. Other stains for\u00a0<em>Acanthamoeba\u00a0</em>include calcofluor white, acridic orange, Giemsa-Wright, Wheatly trichrome or periodic acid-Schiff</li>\n<li><strong>Culture -</strong>\u00a0<em>Acanthamoeba\u00a0</em>can be grown on a bed of\u00a0<em>E. coli\u00a0</em>plated on a non-nutrient agar</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b1e04bab8c984a75b89abb8d17a66815.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 39-year-old contact lens user with a corneal ulcer, showing no improvement to tobramycin drops, was referred to a tertiary care centre. Corneal biopsy revealed double-walled cysts within the stroma. Which of the following is the treatment of choice?",
    "choices": [
      {
        "id": 1,
        "text": "Polyhexamethylene biguanide"
      },
      {
        "id": 2,
        "text": "Neomycin"
      },
      {
        "id": 3,
        "text": "Propamidine isothionate"
      },
      {
        "id": 4,
        "text": "Nystatin"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>This patient with a corneal ulcer whose biopsy showed double walled cysts in the stroma most likely has acanthamoeba keratitis. <strong>Polyhexamethylene biguanide (PHMB)</strong> is the treatment of choice for acanthamoeba keratitis.</p>\n<p><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">Combination therapy with\u00a0</span><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">chlorhexidine</strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">\u00a0is most effective against trophozoites and cysts. This is recommended as the </span><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">first line of therapy.</strong></p>\n<p>Other topical anti-amoebic agents:</p>\n<ul>\n<li>Diamidines-\u00a0<strong>Propamidine isethionate</strong> (0.1 %), Hexamidine</li>\n<li>Aminoglycosides-\u00a0<strong>Neomycin,\u00a0</strong>Paramomycin</li>\n<li>Imidazoles- Clotrimazole, Miconazole</li>\n</ul>\n<div class=\"page\" title=\"Page 210\">\n<div class=\"section\">\n<div class=\"layoutArea\">\u00a0</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following does not cause interstitial keratitis?",
    "choices": [
      {
        "id": 1,
        "text": "Tuberculosis"
      },
      {
        "id": 2,
        "text": "Herpes simplex virus"
      },
      {
        "id": 3,
        "text": "Syphilis"
      },
      {
        "id": 4,
        "text": "Diphtheria"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong><em>Diphtheria</em>\u00a0</strong>is <strong>not </strong>a cause of<strong> interstitial keratitis. </strong></p>\n<p>Interstitial keratitis is a <strong>non-ulcerating, inflammatory reaction</strong> of the corneal <strong>stroma</strong> that is characterized by <strong>non-suppurative infiltration</strong> and often stromal <strong>vascularization</strong>. The epithelium and endothelium are <strong>not</strong> affected. Scarring due to stromal inflammation and vascularization, in interstitial keratitis, can result in decreased vision.</p>\n<p>Interstitial keratitis (IK) is a common endpoint of any keratitis that predominantly involves the corneal stroma. So there is a wide range of potential etiologies.</p>\n<table style=\"height: 195px; width: 699px;\">\n<tbody>\n<tr>\n<td style=\"width: 240.195px;\">Immune-mediated etiologies</td>\n<td style=\"width: 430.211px;\">Infectious etiologies</td>\n</tr>\n<tr>\n<td style=\"width: 240.195px;\">\n<ul>\n<ul>\n<li>Cogan syndrome:</li>\n</ul>\n</ul>\n<ul>\n<li>\n<ul>\n<li>Interstitial keratitis + deafness + vertigo</li>\n</ul>\n</li>\n<li>Sarcoidosis</li>\n<li>Mycosis fungoides</li>\n</ul>\n</td>\n<td style=\"width: 430.211px;\">\n<p>Bacterial causes:</p>\n<ul>\n<li>Syphilis; Lyme disease</li>\n<li>Tuberculosis; Leprosy</li>\n<li>Brucellosis;\u00a0Leptospirosis.</li>\n</ul>\n<p>Viral causes:</p>\n<ul>\n<li>Herpes simplex (HSV), Herpes zoster (VZV)</li>\n<li>Epstein-Barr (EBV), mumps, rubella (measles)</li>\n<li>influenza, and vaccinia</li>\n</ul>\n<p>Parasitic causes:</p>\n<ul>\n<li>leishmaniasis</li>\n<li>onchocerciasis</li>\n<li>trypanosomiasis\u00a0</li>\n<li>plasmodium</li>\n<li>acanthamoeba</li>\n</ul>\n</td>\n</tr>\n</tbody>\n</table>\n<p>Treatment for IK typically involves the use of topical corticosteroids, as well as appropriate systemic medications for the associated systemic disease.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following infections is classically associated with salmon patch appearance of the cornea?",
    "choices": [
      {
        "id": 1,
        "text": "TB"
      },
      {
        "id": 2,
        "text": "HIV"
      },
      {
        "id": 3,
        "text": "Syphilis"
      },
      {
        "id": 4,
        "text": "HSV"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Salmon patch appearance</strong> of the cornea is classically associated with <strong>syphilitic</strong> infection.</p>\n<p>This is because, syphilis causes <strong>deep vascularization</strong> of the cornea, leading to a <strong>radial bundle</strong> of <strong>brush-like</strong> vessels.</p>\n<p>Stages of interstitial keratitis in congenital syphilis:</p>\n<ul>\n<li><strong>Progressive</strong> stage\u00a0<strong>-</strong>\u00a0<strong>ground-glass</strong> appearance</li>\n<li><strong>Florid</strong> stage - salmon patch appearance</li>\n<li>Stage of <strong>regression -</strong>\u00a0<strong>ghost vessels</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://cdn1.dailyrounds.org/uploads/4176d2ac7f8940899e7b2ed03a54e1cex727x502.PNG"
    ]
  },
  {
    "text": "A patient with recurrent corneal epithelial erosions is diagnosed with limbal stem cell deficiency. She has been enrolled on a research trial for corneal epithelial stem cell transplant. All are markers that can be used to identify stem cells from an ex-vivo culture except?",
    "choices": [
      {
        "id": 1,
        "text": "ABCG2 transporter"
      },
      {
        "id": 2,
        "text": "Nuclear protein p63"
      },
      {
        "id": 3,
        "text": "Alpha-enolase"
      },
      {
        "id": 4,
        "text": "Connexin 50"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Connexin 50 is <strong>not a </strong>limbal stem-cell marker.</p>\n<p>The major markers proposed for epithelial stem cells can be categorized into at least three groups:</p>\n<ul>\n<li>Nuclear proteins such as <strong>transcription factor p63</strong></li>\n<li>Cell membrane or transmembrane proteins\n<ul>\n<li>Integrins (integrin \u00df1, \u03b16, and \u03b19),</li>\n<li>Receptors (epidermal growth factor [EGF] receptor and transferrin receptor CD71)</li>\n<li>Drug-resistance transporters (<strong>ABCG2\u2014</strong>a universal stem cell marker)</li>\n</ul>\n</li>\n<li>Cytoplasmic proteins such as\n<ul>\n<li>Cytokeratins (<strong>cytokeratin 14</strong> - exclusively at LSC)</li>\n<li><strong>Alpha-enolase</strong></li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "For her final year thesis, an ophthalmology resident is studying endothelial cell loss due to phacoemulsification surgery. The image is taken during the pre-op evaluation of one of the cataract patients. What does this show?",
    "choices": [
      {
        "id": 1,
        "text": "Normal endothelium"
      },
      {
        "id": 2,
        "text": "Polymegathism only"
      },
      {
        "id": 3,
        "text": "Polymegathism and pleomorphism"
      },
      {
        "id": 4,
        "text": "Corneal guttata"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given image is a <strong>specular</strong> <strong>microscopy</strong> view of endothelial cells of different shapes (<strong>pleomorphism</strong>) and large surface area <strong>(polymegathism).</strong> These are indicators of endothelial dysfunction.</p>\n<p>A normal endothelium has a regular <strong>hexagonal</strong> shape. Because these cells are terminally differentiated cells, they do not divide, and when they die, the remaining cells have to stretch to cover more area, resulting in polymegathism and pleomorphism.</p>\n<p>Taking an endothelial cell count can be helpful before taking patients up for cataract or refractive surgery so that any potential endothelial dysfunction or thinning is recognized before they have the surgical intervention.</p>",
    "explanation_video": "",
    "question_images": [
      "https://daily-rounds-staging.s3.amazonaws.com/uploads/07f450c0c18545689f1afd2c5b1be0e4.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not a feature of herpetic keratitis?",
    "choices": [
      {
        "id": 1,
        "text": "Stromal keratitis"
      },
      {
        "id": 2,
        "text": "Dendritic ulcer"
      },
      {
        "id": 3,
        "text": "Corneal guttata"
      },
      {
        "id": 4,
        "text": "Disciform keratitis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Corneal guttata</strong>\u00a0are seen in\u00a0<strong>corneal dystrophy</strong>.</p>\n<p>Peripheral guttata are seen in old age\u2014Hassall\u2013Henle bodies. Central guttata, on the other hand, are found in Fuch's endothelial dystrophy.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A corneal foreign body was removed from a 53-year-old man. He was sent home with chloramphenicol and steroid eye drops. Two days later he came back with a corneal ulcer and a hypopyon. The ulcer scraping under microscopy revealed branched septate hyphae. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Candida"
      },
      {
        "id": 2,
        "text": "Aspergillus"
      },
      {
        "id": 3,
        "text": "Mucurmycosis"
      },
      {
        "id": 4,
        "text": "Histoplasma"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given history of trauma and worsening with antibiotic-steroid drops suggests a fungal corneal ulcer. Out of the given options,\u00a0<em><strong>Aspergillus</strong>\u00a0</em>is the fungus with\u00a0branched septate hyphae.\u00a0</p>\n<p>Clinically, fungi are classified on a morphological basis into <strong>filamentous</strong>, <strong>yeast</strong>, and <strong>dimorphic</strong>\u00a0forms:</p>\n<ul>\n<li><strong>Filamentous</strong> organisms are multicellular with branched hyphae. It can be septate or aseptate.\n<ul>\n<li><strong>Septate </strong>filamentous organisms, such as <em><strong>Fusarium</strong></em><strong>\u00a0</strong>and <em><strong>Aspergillus</strong></em>, have hyphae that are divided by cell walls.</li>\n<li><strong>Non-septate</strong> filamentous fungi, include\u00a0<em><strong>Mucor</strong> </em>and<em> <strong>Rhizopus.</strong></em></li>\n</ul>\n</li>\n<li><strong>Yeasts</strong>, such as <em><strong>Candida</strong>\u00a0</em>and<em> <strong>Cryptococcus</strong></em>, are <strong>unicellular fungi</strong> that reproduce by <strong>budding</strong>, but in tissue, they might develop elongated buds (<strong>pseudohyphae).</strong></li>\n<li><strong>Dimorphic fungi</strong> such as <em><strong>Histoplasma</strong></em>,<em> <strong>Coccidioides</strong></em>, and<em> <strong>Blastomyces</strong></em> demonstrate both a yeast phase that occurs in tissues and a mycelial phase that appears on culture media and saprophytic surfaces.</li>\n</ul>\n<p>Image: Branched septate hyphae of <em style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">Aspergillus</em><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> spp.</span></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/bed67a12804a4cd48c06e8ba71a5e785x375x206.JPEG"
    ]
  },
  {
    "text": "Corneal sensation is lost in____.",
    "choices": [
      {
        "id": 1,
        "text": "Conjunctivitis"
      },
      {
        "id": 2,
        "text": "Fungal infection"
      },
      {
        "id": 3,
        "text": "Trachoma"
      },
      {
        "id": 4,
        "text": "Herpes simplex keratitis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Corneal sensation</strong> is <strong>lost</strong> in <strong>herpes simplex</strong> virus (HSV) infection.</p>\n<p>The pathognomic feature of viral keratitis is <strong>decreased corneal sensation</strong>. Decreased corneal sensation is also seen in <strong>diabetes mellitus</strong> and <strong>leprosy.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '07 Basics Of Cornea And Infectious Keratitis';
        let hierarchy = ["Marrow", "qBank", "Ophthalmology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>