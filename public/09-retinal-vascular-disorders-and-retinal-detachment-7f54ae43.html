<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>09 Retinal Vascular Disorders And Retinal Detachment - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Ophthalmology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">35</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Identify the marked layer of the retina.",
    "choices": [
      {
        "id": 1,
        "text": "Inner plexiform layer"
      },
      {
        "id": 2,
        "text": "External limiting layer"
      },
      {
        "id": 3,
        "text": "Internal limiting layer"
      },
      {
        "id": 4,
        "text": "Outer plexiform layer"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The<strong> inner plexiform layer</strong> is the marked layer in the given histological image of retina, identified as the <strong>fourth</strong> layer from the uppermost (innermost) layer.</p>\n<p>The retina consists of <strong>10 layers. </strong>The\u00a0<strong>retinal pigment epithelium </strong>(RPE) is the <strong>outermost layer</strong> - below the Bruch's membrane of the choroid - and the <strong>internal limiting membrane</strong> is the <strong>innermost layer </strong>- separating the retina from the vitreous.</p>\n<p>The retinal pigment epithelium consists of a <strong>single layer</strong> of cells containing <strong>pigment</strong>.<strong>\u00a0</strong>It is separated from the neurosensory retinal layers by the\u00a0potential space between them which is known as interphotoreceptor matrix.\u00a0</p>\n<p>The<strong><span data-preserver-spaces=\"true\"> inner plexiform layer</span></strong><span data-preserver-spaces=\"true\">\u00a0consists of\u00a0</span><strong><span data-preserver-spaces=\"true\">synapsing nerve fibers</span></strong><span data-preserver-spaces=\"true\">. The\u00a0</span>axons\u00a0of\u00a0bipolar\u00a0cells synapse with\u00a0dendrites\u00a0of\u00a0ganglion<span data-preserver-spaces=\"true\">\u00a0cells; and both these\u00a0</span>processes synapse\u00a0with processes of\u00a0amacrine<span data-preserver-spaces=\"true\">\u00a0cells. It also contains some horizontally placed\u00a0</span>internal plexiform cells; and also a few\u00a0ganglion cells.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/4bb98bfa6f5c4ee79dcef1ef6868e1f2.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/15d36c08680e478294529651a92c0b63x1280x866.JPEG"
    ]
  },
  {
    "text": "Identify the structure marked with red arrow",
    "choices": [
      {
        "id": 1,
        "text": "Outer limiting membrane"
      },
      {
        "id": 2,
        "text": "Inner plexiform layer"
      },
      {
        "id": 3,
        "text": "Outer plexiform layer"
      },
      {
        "id": 4,
        "text": "Outer nuclear layer"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The marked structure in the slide is the <strong>outer plexiform layer </strong>of the <strong>retina</strong>.\u00a0</p>\n<p>The <strong>outer plexiform layer</strong>\u00a0(outer synaptic layer) is present between the outer nuclear layer and the inner nuclear layer.\u00a0This layer stains lightly. This layer consists of the axons of rods and cones which synapse with dendrites of bipolar neurons and horizontal cells.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/8ca58d7290654e00b6aea4350ec11073.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/15d36c08680e478294529651a92c0b63x1280x866.JPEG"
    ]
  },
  {
    "text": "The distance of the fovea from the temporal margin of the optic disc is _______.",
    "choices": [
      {
        "id": 1,
        "text": "1 disc diameter"
      },
      {
        "id": 2,
        "text": "2 disc diameters"
      },
      {
        "id": 3,
        "text": "3 disc diameters"
      },
      {
        "id": 4,
        "text": "4 disc diameters"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The distance of the fovea from the temporal margin of the optic disc is<strong>\u00a02 disc diameters</strong>.</p>\n<p>The <strong>fovea</strong> is an<strong> excavation</strong> in the retinal surface at the center of the <strong>macula</strong>, with a diameter of 1.5 mm, which is about the same as that of the optic disc. The<strong> foveola</strong> forms the bottom of the fovea and has a diameter of 0.35 mm. It is devoid of ganglion cells.\u00a0The <strong>umbo</strong> is the central floor the foveola, which corresponds to the foveolar light reflex. The <strong>foveal avascular zone</strong> (FAZ) is a central area (including foveola and surrounding areas) which contains no blood vessels but is surrounded by a continuous network of capillaries.<strong><br /></strong></p>\n<p>The <strong>macula</strong> is a round area at the <strong>posterior pole,</strong> lying inside the temporal vascular arcades. It measures 5.5 mm in diameter. The inner layers of the macula contain the yellow <strong>xanthophyll carotenoid</strong> pigments lutein and <strong>zeaxanthin</strong> in far higher concentrations than the peripheral retina (hence, the full name \"macula lutea\", which means yellow plaque).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://cdn1.dailyrounds.org/uploads/5e0f9b669b04489a86a45ae1daf2446dx712x535.JPEG"
    ]
  },
  {
    "text": "Causes for expanding blind spot are all except __________",
    "choices": [
      {
        "id": 1,
        "text": "POAG"
      },
      {
        "id": 2,
        "text": "Hypoplasia of optic disc"
      },
      {
        "id": 3,
        "text": "Papilledema"
      },
      {
        "id": 4,
        "text": "Medullated nerve fibres"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Optic disc hypoplasia\u00a0</strong>does <strong>not</strong> <strong>cause</strong> enlargement of the blind spot.</p>\n<p>The<strong> physiological blind spot</strong> is an area of absolute<strong> scotoma</strong> in the visual field, seen in the region of<strong> optic disc</strong>. It is due to the absence of photoreceptors (rods and cones) in that region. Enlarged blind spot is seen in\u00a0primary open-angle glaucoma (POAG) (Option A), papilledema (Option C), medullated nerve fibers (Option D), optic disc drusen, coloboma of optic disc and<br />myopic disc with a crescent.\u00a0</p>\n<p><strong>Optic nerve hypoplasia</strong>\u00a0is the <strong>most common </strong>congenital optic disc anomaly. There is <strong>underdevelopment</strong> of the optic disc in the disease and it typically presents with a small disc that is surrounded by a yellowish pigmented ring, called the <strong>'double ring sign'.</strong></p>\n<p>Option A: In <strong>primary open-angle glaucoma</strong>(POAG), the optic disc enlargement is seen secondary to increased intra-ocular pressure (IOP) in the eye.</p>\n<p>Option C: <strong>Papilledema</strong> is a passive disc swelling seen with raised intracranial pressure. The blind spot is enlarged due to the edema of the optic disc.\u00a0</p>\n<p>Option D:<strong> Medullated</strong> or <strong>opaque nerve fibers</strong><strong>\u00a0</strong>are the abnormal <strong>myelination</strong> of nerve fibers of the retina. Normally, optic nerve myelination stops at the level of lamina cribrosa. If the myelination continues beyond the optic disc it leads to the expansion of the blind spot.\u00a0 On ophthalmoscopic examination, these are seen as a <strong>whitish patch</strong> with <strong>feathery margins.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which statement regarding M\u00fcller cells is false?",
    "choices": [
      {
        "id": 1,
        "text": "They are modified glial cells"
      },
      {
        "id": 2,
        "text": "Their nuclei lie in the outer nuclear layer"
      },
      {
        "id": 3,
        "text": "Their foot processes form the inner & outer limiting membranes"
      },
      {
        "id": 4,
        "text": "They contribute to inner blood retinal barrier"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The nuclei of M\u00fcller cells lie in the <strong>inner nuclear layer.</strong></p>\n<p><strong>M\u00fcller cells</strong> are a type of macroglial cells of the retina. The human retina contains 8\u201310 million M\u00fcller cells. Their <strong>nuclei</strong> lie in the<strong> inner nuclear layer</strong> and their processes extend across the retinal layers to form the <strong>inner</strong> and <strong>outer limiting membranes</strong>. Their functions include:</p>\n<p>1. Providing structural stability to the retina<br />2. Interacting with other neurons and their functional and metabolic support<br />3. Providing neurons with trophic substances and removing metabolic waste<br />4. Playing a critical role in regulating the extracellular space volume as well as ion and water homeostasis and in maintaining the inner blood-retinal barrier</p>\n<p><strong>Astrocytes</strong> are another type of macroglial cells of the retina. They play a crucial role in retinal vascularization. In the mature retina, they are restricted to the nerve fiber and ganglion cell layers.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is false regarding the development of retinal vasculature?",
    "choices": [
      {
        "id": 1,
        "text": "Grow to temporal ora by 34 weeks of gestation"
      },
      {
        "id": 2,
        "text": "Grow to nasal ora by 36 weeks of gestation"
      },
      {
        "id": 3,
        "text": "Originate from mesenchymal tissue during week 16 of gestation"
      },
      {
        "id": 4,
        "text": "Radiate centrifugally from optic nerve"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Retinal vessels reach<strong> temporal ora</strong> at approximately<strong>\u00a040</strong>\u00a0weeks of gestation.</p>\n<p>Retinal vessels develop de novo from<strong>\u00a0mesenchymal tissue</strong>, beginning during the <strong>4<sup>th</sup> month</strong> of gestation. They radiate <strong>outward </strong>(centrifugally) from the optic nerve, reaching the nasal ora by\u00a036 weeks.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A preterm baby treated for respiratory distress syndrome is found to have white pupillary reflex on opthalmologic examination. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Posterior persistent primary hyperplastic vitreous"
      },
      {
        "id": 2,
        "text": "Coat's retinopathy"
      },
      {
        "id": 3,
        "text": "Retrolental fibroplasia"
      },
      {
        "id": 4,
        "text": "Congenital cataract"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>A preterm baby, treated for respiratory distress syndrome, with<strong> leucocoria </strong>(white pupillary reflex) most likely has <strong>retrolental</strong> <strong>fibroplasia.</strong></p>\n<p>Retrolental fibroplasia, also known as <strong>retinopathy </strong>of<strong> prematurity</strong>, is a proliferative retinopathy. Risk factors include\u00a0<strong>prematurity</strong>,<strong> </strong>very low birth weight and supplemental oxygen therapy (given for respiratory distress syndrome).\u00a0ROP can be mild and may resolve spontaneously, but may lead to blindness in serious cases.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/17c7b700f1994c95bc233f1c355272edx510x2089.GIF",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5b296f457a3147068d95d5e99df7e3a4x1280x1392.JPEG"
    ]
  },
  {
    "text": "Which of the following is included under threshold disease when screening neonates for retinopathy of prematurity?",
    "choices": [
      {
        "id": 1,
        "text": "ROP stage 1 extending from 6'o clock to 11'0 clock in zone 1 with plus disease"
      },
      {
        "id": 2,
        "text": "ROP stage 3 extending  from 2'o clock to 7'o clock in zone 2 with plus disease"
      },
      {
        "id": 3,
        "text": "ROP stage 3 extending from 1'o clock to 4'o clock in zone 1 without plus disease"
      },
      {
        "id": 4,
        "text": "ROP stage 2 extending from 3'o clock to 6'o clock in zone 2 with plus disease"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Treatment of the various stages of ROP includes:</p>\n<ul>\n<li>Pre-threshold type 1 disease - Treatment is now recommended within <strong>48 hours</strong> and is done by <strong>laser photocoagulation</strong> of avascular retina.</li>\n<li>Pre-threshold type 2 disease (Any ROP not following under type 1)- <strong>Observation</strong> for progression</li>\n<li>Threshold disease - <strong>Laser photocoagulation</strong> of avascular retina</li>\n<li>Aggresive posterior-ROP-\u00a0Intravitreal <strong>anti-VEGF agents</strong>, eg., bevacizumab</li>\n<li>Tractional retinal detachment (stage 4A) -<strong> Pars plana vitrectomy</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/bd2e4bd83ac642efa034efa464d8f823x1280x3016.JPEG"
    ]
  },
  {
    "text": "All of the following are true statements regarding retinopathy of prematurity except:",
    "choices": [
      {
        "id": 1,
        "text": "First screening should be done 32 weeks PMA or 4 weeks PNA, whichever is later"
      },
      {
        "id": 2,
        "text": "For infants less than 28 week, screen at 3 week of postnatal age to detect APROP"
      },
      {
        "id": 3,
        "text": "Neonates are best examined at ophthalmology OPD and hence should be transported"
      },
      {
        "id": 4,
        "text": "Screening is done using indirect ophthalmoscopy by an expert ophthalmologist"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Neonates are <strong>best examined</strong> in the <strong>neonatal unit</strong> itself under the supervision of the attending neonatologist. It is not recommended to transport infants to the ophthalmic outpatient department for examination.</p>\n<p>The <strong>first screening</strong> examination should be carried out by <strong>indirect ophthalmoscopy</strong> at <strong>32 weeks PMA </strong>or <strong>4 weeks PNA</strong>, whichever is later. For infants born at<strong> less </strong>than<strong> 28 weeks</strong>, screening is done at <strong>3 weeks PNA</strong> to detect APROP.\u00a0<strong>Aggressive posterior ROP </strong>(\"rush\" disease, AP-ROP), if untreated, usually progresses to total retinal detachment (stage 5)\u00a0within a few days. It is characterized by its posterior location, prominence of plus disease\u00a0and ill-defined nature of the retinopathy.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/198169446c05486fa756d40d0d6a6300x1280x3016.JPEG"
    ]
  },
  {
    "text": "A preterm neonate admitted to NICU who received supplemental oxygen is being screened for retinopathy of prematurity. Fundus examination reveals a subtotal retinal detachment. How will you stage the disease?",
    "choices": [
      {
        "id": 1,
        "text": "Stage 2"
      },
      {
        "id": 2,
        "text": "Stage 3"
      },
      {
        "id": 3,
        "text": "Stage 4"
      },
      {
        "id": 4,
        "text": "Stage 5"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Subtotal retinal detachment is considered to be <strong>stage 4</strong> of<strong> retinopathy</strong> of<strong> prematurity</strong> (ROP).\u00a0</p>\n<p>The clinical staging of ROP is as follows:</p>\n<ul>\n<li>Stage 1 - Formation of a demarcation line at the edge of vessels, dividing the vascular from the avascular retina.</li>\n<li>Stage 2- Formation of an intraretinal ridge\u00a0</li>\n<li>Stage 3- Ridge with extraretinal fibrovascular proliferation into the vitreous</li>\n<li><strong>Stage 4</strong>-<strong> Subtotal retinal detachment</strong></li>\n<li>Stage 5- Total retinal detachment</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2e8cf7727c9b445f9d284ce7b5abbc6ax510x2089.GIF"
    ]
  },
  {
    "text": "A 14-day-old neonate born at 28 weeks of gestation had developed respiratory distress syndrome at birth. You want to screen for retinopathy of prematurity. How many weeks from now would you schedule the screening?",
    "choices": [
      {
        "id": 1,
        "text": "4 weeks"
      },
      {
        "id": 2,
        "text": "2 weeks"
      },
      {
        "id": 3,
        "text": "8 weeks"
      },
      {
        "id": 4,
        "text": "12 weeks"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In the scenario above, the <strong>postnatal age </strong>of the premature infant is <strong>2 weeks</strong>, and therefore, the infant must be screened in<strong> 2 weeks </strong>i.e.,<strong> 4 weeks </strong>of <strong>postnatal</strong> <strong>age</strong>, as per the guidelines for the management of retinopathy of prematurity (ROP).\u00a0</p>\n<p>ROP guidelines state that the first examination should be performed between <strong>4 </strong>and <strong>6 weeks </strong>of<strong> postnatal age </strong>(after birth) or between 31\u201333 weeks of post-conceptional age (calculated as gestational age + postnatal age), whichever is later. Ideally, 2 examinations must be performed; however, 1 may suffice if it shows complete retinal vascularisation.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/aff757ca80114535a17da45c4323fc08x1280x3016.JPEG"
    ]
  },
  {
    "text": "Which of the following is the most important factor for the development of diabetic retinopathy?",
    "choices": [
      {
        "id": 1,
        "text": "Duration of diabetes"
      },
      {
        "id": 2,
        "text": "Glycemic control"
      },
      {
        "id": 3,
        "text": "Association with hypertension"
      },
      {
        "id": 4,
        "text": "Age of the patient"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The <strong>most important factor</strong> for the development of diabetic retinopathy is the <strong>duration</strong> of <strong>diabetes</strong>.</p>\n<p><strong>Diabetic retinopathy</strong> constitutes the retinal changes seen in patients with type 2 diabetes mellitus. The most important factor for its development is duration of diabetes after the onset of puberty, followed by\u00a0<strong>glycemic control</strong>. It is <strong>more common</strong> in <strong>type</strong> <strong>1 diabetes mellitus</strong>. The presence of hypertension increases the risk of diabetic retinopathy.</p>\n<p>First fundus examination for<strong> type 1 diabetes </strong>is done after <strong>5 years\u00a0</strong>after diagnosis and for <strong>type 2</strong> is done<strong>\u00a0at </strong>the time of<strong> diagnosis</strong>. The frequency of follow-up for types 1 and 2 diabetes mellitus is every year. Diabetes in pregnancy is followed up every 3 months.</p>\n<p>The <strong>earliest feature</strong> of diabetic retinopathy is <strong>microaneurysms</strong>, which are present in the inner nuclear layer of the retina.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following findings on a fundus examination would suggest severe non-proliferative diabetic retinopathy?",
    "choices": [
      {
        "id": 1,
        "text": "Significant venous beading in any of the 4 quadrants"
      },
      {
        "id": 2,
        "text": "Micro-aneurysms in any 2 quadrants"
      },
      {
        "id": 3,
        "text": "Severe hemorrhages in all 4 quadrants"
      },
      {
        "id": 4,
        "text": "Macular star"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Severe hemorrhages</strong> in <strong>all 4 quadrants</strong> is a feature of<strong> severe NPDR.</strong></p>\n<p>Note: <strong>Macular star </strong>is a feature of <strong>malignant hypertensive retinopathy.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8d9238edd35b4a8e92acdd239c6290e7x512x399.PNG"
    ]
  },
  {
    "text": "A person is diagnosed to have diabetes on his 45th birthday. When will you recommend a dilated fundus examination for him?",
    "choices": [
      {
        "id": 1,
        "text": "Immediately"
      },
      {
        "id": 2,
        "text": "Before his 50th birthday"
      },
      {
        "id": 3,
        "text": "After his 50th birthday"
      },
      {
        "id": 4,
        "text": "When he complains of decrease in vision"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>A <strong>45 year</strong> old diagnosed with diabetes mellitus is <strong>likely</strong> to have <strong>type 2 diabetes</strong> and thus, he should undergo <strong>screening</strong> for diabetic retinopathy <strong>immediately</strong>.</p>\n<p><strong>Duration</strong> of diabetes is the <strong>most important</strong> risk factor for developing diabetic retinopathy, especially proliferative diabetic retinopathy. The recommendations for <strong>first fundus\u00a0</strong>examination in diabetic retinopathy is:</p>\n<ul>\n<li>Within <strong>3-5 years</strong> of diagnosis in type 1 diabetes</li>\n<li><strong>Immediately</strong> in type 2 diabetes.</li>\n</ul>\n<p>Later, the screening is continued once <strong>every year</strong> in both Type 1 and Type 2 diabetes. In the event proliferative diabetic retinopathy develops, screening is done more frequently - once every 2 months.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "ETDRS study was related to?",
    "choices": [
      {
        "id": 1,
        "text": "Central retinal artery occlusion"
      },
      {
        "id": 2,
        "text": "Diabetic macular edema"
      },
      {
        "id": 3,
        "text": "Primary open angle glaucoma"
      },
      {
        "id": 4,
        "text": "Non-infectious uveitis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Early Treatment Diabetic Retinopathy Study (ETDRS)</strong> was a randomized clinical trial that studied the effect of photocoagulation on <strong>diabetic macular edema</strong>.\u00a0</p>\n<p>The results of the study demonstrated the <strong>beneficial effects </strong>of\u00a0<strong>focal photocoagulation</strong> on <strong>diabetic macular edema</strong>. The study resulted in the recommendation that all\u00a0eyes with clinically significant diabetic macular edema should be considered for focal photocoagulation.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient with a history of diabetes and hypertension underwent fundus fluorescent  angiography (FFA) to evaluate his decreasing vision. The FFA yields an image as shown below, which is characteristic of:",
    "choices": [
      {
        "id": 1,
        "text": "Macular ischemia"
      },
      {
        "id": 2,
        "text": "Macular edema"
      },
      {
        "id": 3,
        "text": "Submacular haemorrhage"
      },
      {
        "id": 4,
        "text": "Premacular haemorrhage"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Option D: <strong>Premacular hemorrhage\u00a0</strong>is a term used to define vitreous hemorrhage that occurs in the subhyaloid space. It is seen as a region of<strong> hypofluorescence</strong> with no overlying retinal vasculature visualization on FFA.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/069caf36d3cc40b79335aaaf6679146e.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1dbbde29f7aa4377bb711a8abc91d8f7x720x528.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/44b9930c93004748bab07c5b76706c81x1280x1363.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4db0188b47484273bccf96a592189e5ex204x136.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b081c51feee94849b0b4cd034a93d691x974x398.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6af267802212441dbbb1ff3c366478fcx252x208.PNG"
    ]
  },
  {
    "text": "A 69-year-old patient with hypertension has silver wiring, papilledema, and arteriovenous nipping visible on fundoscopy, but no other changes. How would you grade his disease?",
    "choices": [
      {
        "id": 1,
        "text": "Grade I retinopathy"
      },
      {
        "id": 2,
        "text": "Grade IV retinopathy"
      },
      {
        "id": 3,
        "text": "Grade III retinopathy"
      },
      {
        "id": 4,
        "text": "Grade II retinopathy"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>A patient with hypertension having \"silver wiring,\" papilledema, and arteriovenous nipping visible on fundoscopy has <strong>Grade IV retinopathy.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f8c065ace33b4c709bcc39b733de6c94x1280x3068.JPEG"
    ]
  },
  {
    "text": "A 40-year-old male, newly diagnosed with systolic hypertension,  presents with a three-week history of bilateral blurry vision. His visual acuity is 20/30 and 20/120 in the right and left eye, respectively. The rest of the examination is unremarkable. Which of the following findings is least likely to be seen on his fundoscopy?",
    "choices": [
      {
        "id": 1,
        "text": "Arteriolar narrowing"
      },
      {
        "id": 2,
        "text": "Intraretinal microvascular abnormalities"
      },
      {
        "id": 3,
        "text": "Cotton wool spots"
      },
      {
        "id": 4,
        "text": "Papilledema"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Systolic hypertension (systolic blood pressure over 200 mm Hg) with bilateral blurry vision and unremarkable examination findings point to a diagnosis of hypertensive retinopathy. <strong>Intra-retinal microvascular abnormalities </strong>(IRMA)<strong>\u00a0</strong>are<strong> not seen</strong> in<strong> hypertensive retinopathy.</strong>\u00a0IRMA is a feature of diabetic retinopathy<strong>.</strong>\u00a0</p>\n<p><strong>Arteriolar narrowing</strong> occurs due to vasoconstriction and sclerosis of retinal vessels due to hypertension. <strong>Cotton wool spots</strong> are areas of nerve fibre layer infarcts. They occur due to capillary obliteration in hypertension.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ea6ea564de1843e5bfb520b83ba29d5bx1280x3068.JPEG"
    ]
  },
  {
    "text": "The following image shows the picture of the fundus in a patient taken 48 hours after sustaining severe head trauma. What is the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Hypertensive retinopathy"
      },
      {
        "id": 2,
        "text": "Diabetic retinopathy"
      },
      {
        "id": 3,
        "text": "Purtschers retinopathy"
      },
      {
        "id": 4,
        "text": "Central retinal vein occlusion"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The image shows <strong>multiple cotton wool</strong> spots around the disc. This is <strong>Purtschers' retinopathy</strong>,<strong>\u00a0</strong>which is classically associated with severe head injury.\u00a0</p>\n<p>It is also seen in <strong>pancreatitis </strong>and\u00a0<strong>chest trauma</strong> due to <strong>fat/air embolism</strong>. Ophthalmoscopy reveals multiple, variably sized cotton-wool spots and intraretinal hemorrhages around the optic nerve. There is <strong>no effective treatment</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/23c9142096b14446a5d108f86b80a477.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is not true regarding sickle cell retinopathy?",
    "choices": [
      {
        "id": 1,
        "text": "Sea-fan appearance is seen in supero-temporal quadrant."
      },
      {
        "id": 2,
        "text": "HbSS has more severe ocular manifestations than HbSC."
      },
      {
        "id": 3,
        "text": "Angioid streaks are seen."
      },
      {
        "id": 4,
        "text": "Central retinal vein occlusion may be seen."
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The image below shows '<strong>sea fans</strong>'<strong> </strong>as seen on <strong>fluorescein angiography</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/70c1ccdd79984d769e9864b13d159124x439x418.PNG"
    ]
  },
  {
    "text": "Roth spots are seen in ________.",
    "choices": [
      {
        "id": 1,
        "text": "Acute leukemia"
      },
      {
        "id": 2,
        "text": "Uveal melanoma"
      },
      {
        "id": 3,
        "text": "Uveal lymphoma"
      },
      {
        "id": 4,
        "text": "All of the above"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Option C: <strong>Uveal lymphoma\u00a0</strong>is characterized by localized or diffuse uveal infiltrates of malignant lymphoma cells. Fundus examination in these patients show diffuse creamy thickening of posterior uvea with nodular accentuation.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/935a7ca0fdd041699f300b438c02c372x720x583.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/35e1700ad0c44e8b97647a207e778d78x720x543.JPEG"
    ]
  },
  {
    "text": "A 7-year-old boy presents with 6/6 vision in the right eye and vision for only hand movements in the left eye. On fundoscopy, the right eye appears normal. The left eye shows retinal detachment, subretinal yellowish exudates, and telangiectatic vessels. What is the most probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Sympathetic ophthalmitis"
      },
      {
        "id": 2,
        "text": "Familial exudative vitreoretinopathy"
      },
      {
        "id": 3,
        "text": "Retinopathy of prematurity"
      },
      {
        "id": 4,
        "text": "Coat's disease"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Unilateral decreased vision with retinal detachment, subretinal yellowish exudates and telangiectatic vessels in a young boy points to the diagnosis of <strong>Coats' disease.</strong></p>\n<p><strong>Coats\u2019 disease,</strong> described by Coats in 1908, affects<strong>\u00a0boys</strong>\u00a0three times more often than girls, has<strong> </strong>no reported racial or ethnic predilection, and is usually<strong> unilateral.\u00a0</strong>The average<strong> </strong>age at diagnosis is 8\u201316 years. The clinical course is generally progressive.\u00a0</p>\n<p>It is characterized by<strong> </strong>discrete zones of retinal vascular abnormalities like <strong>aneurysmal dilatation </strong>and<strong> leakage</strong>. It is associated with localized <strong>lipid deposition</strong>\u00a0(hard exudates) and varying degrees of <strong>subretinal exudates.\u00a0</strong>Vessels may appear <strong>telangiectatic</strong>, and they may have <strong>aneurysms</strong> that are grape-like, clustered, or light bulb-shaped.\u00a0</p>\n<p>The image below depicts the typical vascular abnormalities with aneurysmal dilatation, telangiectasia, exudation, and severe lipid deposition in the macula which are seen in Coat's disease.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3d6a6c5012ec4745b0c4b1563671343ax496x445.PNG"
    ]
  },
  {
    "text": "A 64-year-old female presented with complaints of blurring of vision and pain in her left eye. She also gave a history of redness in her left eye about 3 months back, which she passed off as normal conjunctivitis. On tonometry, the IOP is 55 mm Hg. The slit-lamp revealed rubeosis iridis in all four quadrants. The fundus picture of the patient is given below. What is the most probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Central retinal vein occlusion (CRVO)"
      },
      {
        "id": 2,
        "text": "Branched retinal vein occlusion (BRVO)"
      },
      {
        "id": 3,
        "text": "Central retinal arterial occlusion (CRAO)"
      },
      {
        "id": 4,
        "text": "Branched retinal artery occlusion (BRAO)"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Monocular blurring of vision and pain with \"<strong>splashed sauce\" appearance </strong>on fundoscopy points towards a diagnosis of <strong>central retinal vein occlusion </strong>(CRVO).</p>\n<p>Ischemic central retinal vein occlusion (CRVO) is characterised by <strong>sudden visual loss</strong>. There is splashed sauce appearance on fundoscopy due to retinal hemorrhages. Risk factors include high intraocular pressure (IOP), hypertension and blood viscosity syndromes.\u00a0</p>\n<p>Its complications include <strong>neovascularisation</strong> of the iris (<strong>rubeosis iridis</strong>) and <strong>neovascular glaucoma</strong> (NVG). NVG typically occurs 3 months after the occlusive event. Up to 50% of eyes develop NVG following ischaemic CRVO.\u00a0<strong>Pan-retinal photocoagulation </strong>is the treatment of choice.</p>\n<p>CRVO is classified into two types:</p>\n<ul>\n<li><strong>Ischemic</strong> CRVO: Characterized by relative afferent pupillary defect (RAPD), markedly reduced visual acuity, and many cotton-wool spots</li>\n<li><strong>Non-ischemic</strong> CRVO: Characterized by normal pupillary reaction, reduced visual acuity, and few cotton-wool spots<br />Treatment usually involves treating the underlying cause and complications.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/138379357230491da57664e9bf3e03ff.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A man with history of hypertension and loss of vision in the left eye has the following fundoscopy findings. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Central retinal arterial occlusion (CRAO)"
      },
      {
        "id": 2,
        "text": "Central retinal venous occlusion (CRVO)"
      },
      {
        "id": 3,
        "text": "Branched retinal arterial occlusion (BRAO)"
      },
      {
        "id": 4,
        "text": "Branched retinal venous occlusion (BRVO)"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The image above demonstrates characteristic flame-shaped hemorrhages, localized to the superotemporal sector of the retina. The image, along with loss of vision and history of hypertension, points to a diagnosis of <strong>branched retinal vein occlusion</strong> (BRVO),<strong> </strong>specifically affecting the <strong>superotemporal </strong>branch of the retinal vein.</p>\n<p>Occlusion of a single branch of the retinal vein leads to branched retinal vein occlusion. This occlusion leads to<strong> impaired venous drainage</strong>, resulting in the accumulation of blood within the retina. The visual defect in BRVO tends to be partial.\u00a0</p>\n<p><strong>Note: </strong>The different types of retinal vascular obstructions are branched retinal vein obstruction (BRVO), central retinal vein obstruction (CRVO), branched retinal artery obstruction (BRAO) and central retinal artery obstruction (CRAO). <strong>Retinal vein occlusion (RVO)</strong> is the <strong>second most common</strong> retinal vascular disorder after diabetic retinopathy.</p>\n<p>In CRVO, tortuosity and engorgement of all branches of the central retinal vein are seen, affecting all quadrants of the retina.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3c4c9a446c9a44d6af900f7b93978013.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 67-year-old male presents to the emergency department with sudden painless vision loss in his left eye. He has had a similar episode before but his vision was quickly restored. On physical exam, a carotid bruit is heard and a relative afferent pupillary defect is noted on ocular examination. His fundus appears as shown below. Which of the following is the best immediate step in the management of this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Ocular massage"
      },
      {
        "id": 2,
        "text": "Steroids"
      },
      {
        "id": 3,
        "text": "Laser photodisruption"
      },
      {
        "id": 4,
        "text": "Fibrinolytic therapy"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Sudden painless unilateral vision loss with carotid bruit (carotid artery disease) and the fundus picture showing a cherry-red spot is suggestive of <strong>central retinal artery occlusion </strong>(CRAO)<strong>.\u00a0</strong>The best immediate step in management is <strong>ocular massage</strong> among the given options.</p>\n<p>Central retinal artery occlusion (CRAO)<strong> </strong>occurs due to obstruction of the retinal artery at the level of<strong> lamina cribrosa</strong>. Risk factors include heart disease, carotid artery disease, mucormycosis, varicella infection, radiation exposure and trauma. It may be caused by the following:\u00a0</p>\n<ul>\n<li>Emboli of <strong>carotid artery </strong>or <strong>cardiac origin</strong> are the <strong>most common</strong> cause of CRAO. Other emboli are cholesterol emboli, calcium emboli, and platelet fibrin emboli</li>\n<li>Atherosclerosis-related thrombosis</li>\n<li>Retinal arteritis with obliteration</li>\n<li>Angiospasm</li>\n<li>Raised intraocular pressure</li>\n<li>Thrombophilic disorders</li>\n</ul>\n<p>Patients often present with sudden painless monocular loss of vision with history of a similar episode that resolved spontaneously (<strong>amaurosis fugax</strong>). On examination, <strong>d<span class=\"s1\"><strong>ir</strong>ect pupillary reflex </span></strong>is absent and <strong>r</strong><strong>elative afferent pupillary defect </strong>(RAPD) is positive. Fundus examination <span class=\"s1\">shows m</span>arked attenuation of arteries (thread like arteries), interrupted blood flow in vein (<strong>cattle track</strong>\u00a0<strong>appearance</strong>)<strong>, c</strong><strong>herry red spot</strong>,<strong> </strong>severe edema and retinal pallor.</p>\n<p>A <strong>cherry-red spot</strong> of the macula is typical and arises in this area because of the absence of ganglion cells at the foveola resulting in the transmission of the normal choroidal color. This in contrast to the surrounding area where intense retinal whitening blocks the transmission of the normal choroidal color.</p>\n<p><strong>Treatment </strong>is to dislodge the emboli by suddenly decreasing the IOP by <strong>IV acetazolamide</strong> or<strong> </strong>ocular massage.<strong> Ocular massage</strong>\u00a0is considered the <strong>most effective</strong> method. Other treatment options include IV mannitol, vasodilators (nitrates), fibrinolytic therapy, or laser photodisruption in some cases. In cases of giant cell arteritis, steroids are beneficial.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/664903b987d846ad963e0fbb5e38a5b6.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 52-year-old woman presents with complaints of sudden painless loss of vision in the left eye since yesterday. She also gives a history of temporal headaches, myalgias, and pain in the jaw while chewing. Examination of the left eye reveals a visual acuity of HM+ and an RAPD. Fundus examination of the left eye shows cattle trucking of blood within the retinal veins on applying gentle pressure. Which of the following is the likely cause of fundal findings?",
    "choices": [
      {
        "id": 1,
        "text": "Ischemic central retinal venous occlusion"
      },
      {
        "id": 2,
        "text": "Central retinal artery occlusion"
      },
      {
        "id": 3,
        "text": "Non- ischemic central retinal venous occlusion"
      },
      {
        "id": 4,
        "text": "Branched retinal artery occlusion"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>A 52-year-old woman temporal headaches, myalgias and pain in the jaw while chewing likely has <strong>giant cell arteritis</strong> (GCA). Given that she has sudden painless monocular loss of vision with RAPD and points to a diagnosis of <strong>central retinal artery occlusion </strong>(CRAO).</p>\n<p>GCA is the <strong>most common primary vasculitis</strong> in <strong>adults.\u00a0</strong>It is a risk factor for the development of CRAO. CRAO occurs due to obstruction of the retinal artery at the level of <strong>lamina cribrosa</strong>. When obstruction to the blood flow is not complete, the flow may be partially restored. Thus, gentle pressure upon the globe may break the column of venous blood into red beads separated by clear interspaces. This gives the characteristic 'cattle truck' appearance.</p>\n<p>Option A: <strong>Ischemic CRVO </strong>shows a characteristic <strong>\"splashed tomato sauce\"</strong> appearance on fundoscopy.\u00a0</p>\n<p>Option C: <strong>Non-Ischemic CRVO</strong>\u00a0does not present with such a severe loss of visual acuity.</p>\n<p>Option D: <strong>Branched retinal artery occlusion</strong> presents with hemifield visual defects.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 60-year-old man presents with sudden painless loss of vision. Fundoscopy findings are shown below. Which of the following findings do you expect in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Relative afferent pupillary defect"
      },
      {
        "id": 2,
        "text": "Peripheral visual field loss"
      },
      {
        "id": 3,
        "text": "Redness of conjunctiva"
      },
      {
        "id": 4,
        "text": "Increased intraocular pressure"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Sudden painless monocular loss of vision with fundoscopy showing <strong>Hollehorst plaque</strong>\u00a0is\u00a0suggestive of <strong>central retinal artery occlusion</strong> (CRAO).<strong> Relative afferent pupillary defect\u00a0</strong>is seen in these cases.</p>\n<p>Hollenhorst plaques are<strong>\u00a0cholesterol emboli</strong>\u00a0that are seen in retinal arterioles. On fundus examination, it gives an appearance of a refractile <strong>yellow-white color</strong> substance in the retinal vessels.\u00a0</p>\n<p>Note: Although elevated intraocular pressure has been implicated as a cause of central retinal artery obstruction, it is unlikely that intraocular pressure can be raised high enough to block arterial inflow to the eye\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/df0a659c0d124a1596e178b0793378cb.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/114f80561fe34dd8859726527f9eafc4x510x451.GIF"
    ]
  },
  {
    "text": "A 61-year-old university professor presents with a loss of vision in his left eye. He describes the sensation that a curtain was coming up over his affected eye. In addition, 7 days ago the patient noticed what he described as flashing lights and floaters. He gives a history of having cataract surgery in the same eye 3 weeks ago. A B-scan image of his left eye is shown below. Which of the following statements best describes the pathology?",
    "choices": [
      {
        "id": 1,
        "text": "Fluid accumulation below retina"
      },
      {
        "id": 2,
        "text": "Fibrovascular membranes in the vitreous causing traction"
      },
      {
        "id": 3,
        "text": "Fluid accumulation between NSR and RPE due to retinal tear"
      },
      {
        "id": 4,
        "text": "Fluid accumulation between NSR and RPE due to choroidal exudation"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The prodromal symptoms of flashing lights, floaters followed by loss of monocular vision (curtain over the eye) and the B-scan suggest a diagnosis of<strong> rhegmatogenous retinal detachment</strong>. Rhegmatogenous retinal detachment is the result of the accumulation of <strong>fluid </strong>between <strong>NSR </strong>and<strong> RPE</strong> due to a<strong> retinal tear</strong>.</p>\n<p><strong>Retinal detachment</strong> is the separation of the neurosensory retina from the retinal pigment epithelium. Rhegmatogenous retinal detachment is the most common type of retinal detachment. It occurs due to fluid accumulation after a retinal break (tear). High myopia, trauma, <strong>pseudophakia</strong>, aphakia are predisposing factors. Patients present with photopsia (flashes of light due to vitreoretinal traction at the site of the break), floaters and visual field defect (black curtain/veil in front of the eye).\u00a0</p>\n<p>Signs include<strong> hypotony</strong>, as the liquefied vitreous in the subretinal space is absorbed through the RPE and <strong>Shafers sign </strong>or<strong> tobacco dusting </strong>(pigments in the anterior vitreous). The detached retina is convex in configuration. The surface is corrugated with undulations. The most dangerous type of retinal break is <strong>horseshoe tear </strong>and the most dangerous location of retinal break is the <strong>supero-temporal retina.\u00a0</strong></p>\n<p>Treatment is by prophylactic laser barrage, scleral buckling, pneumatic retinopexy and pars plana vitrectomy.\u00a0</p>\n<p>Other types of retinal detachment are<strong> tractional </strong>and <strong>exudative</strong> type:</p>\n<p><strong>Tractional retinal detachment </strong>occurs when<strong> f</strong><strong>ibro-vascular membranes</strong> in the <strong>vitreous</strong> due to long-standing <strong>retinal neovascularization</strong> exert traction on the retina. It is seen in proliferative diabetic retinopathy, central retinal venous occlusion, Eales disease and ROP. The detached retina is<strong> concave</strong> in configuration. No breaks are seen.\u00a0Treatment is with pars plana vitrectomy with endo photocoagulation.\u00a0</p>\n<p><strong>Exudative retinal detachment</strong> is seen when<strong> e</strong><strong>xudative fluid</strong> from the <strong>choroid</strong>\u00a0collects in the <strong>subretinal space.</strong> Patients present with visual field defects, <strong>floaters</strong> due to vitritis but <strong>no photopsia. </strong>The detached retina is<strong> convex</strong> in configuration. The surface is smooth. No break is seen. Shifting fluid is seen.\u00a0</p>\n<p>The image below shows a fundus which reveals retinal detachment inferiorly from 3-9 o'clock with tear at 3:30.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/13e723a817f842328035cb0a90a9e747.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b5e38fa735d648b3941a1af2a4b48484x1280x1326.9724770642201.JPEG"
    ]
  },
  {
    "text": "Pneumatic retinopexy is an outpatient procedure where retinal detachment is sealed with air insufflation. Which of the following gases would you use while performing the said procedure?",
    "choices": [
      {
        "id": 1,
        "text": "Carbon dioxide"
      },
      {
        "id": 2,
        "text": "Sulphur hexafluoride"
      },
      {
        "id": 3,
        "text": "Nitrogen oxide"
      },
      {
        "id": 4,
        "text": "Selenium hexafluoride"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Sulphur hexafluoride</strong> is the gas used in\u00a0<strong>pneumatic retinopexy</strong> for the <strong>treatment</strong> of <strong>retinal detachments</strong></p>\n<p>Pneumatic retinopexy is used for the treatment of fresh retinal detachments with a single retinal break in the <strong>superior two-thirds</strong> of the <strong>fundus. </strong>In this procedure, a bubble is injected intravitreally through the conjunctiva and postoperatively the patient is positioned so that the bubble tamponades the retinal break against the retinal pigment epithelium.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e329035ec02b4f9d91f50ff95f397695x1280x1974.160789844852.JPEG"
    ]
  },
  {
    "text": "A 24-year-old woman who is 8 months pregnant, myopic, and diabetic presents to you with sudden painless loss of vision in her right eye. She is a known case of Eales' disease. Her blood pressure is 170/110 mmHg. Which of her conditions is responsible for a fundus finding of retinal detachment with a positive shifting fluid sign?",
    "choices": [
      {
        "id": 1,
        "text": "Pathological myopia"
      },
      {
        "id": 2,
        "text": "Type 1 diabetes"
      },
      {
        "id": 3,
        "text": "Eales disease"
      },
      {
        "id": 4,
        "text": "Toxemia of pregnancy"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>\u00a0Exudative retinal detachment </strong>is characterized by positive shifting fluid sign. Among her conditions, toxemia of pregnancy is one of the causes of exudative retinal detachment.\u00a0</p>\n<p>Exudative retinal detachment occurs due to the presence of subretinal fluid in the absence of tear or traction. It is caused by:</p>\n<ul>\n<li>Malignant melanoma of the choroid</li>\n<li>Retinoblastoma</li>\n<li>Vogt\u2013Koyanagi\u2013Harada (VKH) syndrome</li>\n<li>Uveal effusion syndrome</li>\n<li>Posterior scleritis</li>\n<li>Coat\u2019s disease</li>\n<li>Malignant hypertension</li>\n<li>Pregnancy-induced hypertensive retinopathy</li>\n<li>Sympathetic ophthalmitis</li>\n</ul>\n<p>Patients present with sudden and painless diminution of vision, visual field defects and<strong> grey reflex</strong> (detached retina looks grey).<strong> Indirect ophthalmoscopy </strong>is the investigation of choice.</p>\n<p>The image depicts retinal detachment showing <strong>a smooth, detached convex retina</strong> with subretinal fluid.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/66058a9e047b4d968bbb779e30e6a5b8x420x311.PNG"
    ]
  },
  {
    "text": "Shifting fluid sign is seen in?",
    "choices": [
      {
        "id": 1,
        "text": "Exudative RD"
      },
      {
        "id": 2,
        "text": "Traction RD"
      },
      {
        "id": 3,
        "text": "Rhegmatogenous RD"
      },
      {
        "id": 4,
        "text": "Retinal dialysis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The presence of <strong>shifting</strong> <strong>fluid</strong> is a hallmark feature of <strong>serous</strong> or <strong>exudative retinal detachment.</strong></p>\n<p>In serous retinal detachment, there is a subretinal accumulation of the serous fluid mostly due to\u00a0the breakdown in the blood-retinal barrier.<strong>\u00a0</strong>When the position of the head is altered, the fluid shifts to the dependent portion. Serous retinal detachment has a smooth convex configuration. A<strong> retinal</strong>\u00a0<strong>tear</strong> or <strong>preretinal</strong>\u00a0<strong>traction</strong> is <strong>absent</strong>.</p>\n<p>Other options:\u00a0<br />Option B: <strong>Traction RD</strong> has a concave configuration and breaks are absent. Retinal mobility is severely reduced and shifting fluid is absent.<br />Option C: <strong>Rhegmatogenous RD </strong>presents with tobacco dust in anterior vitreous with substantial vitreous blood or inflammatory cells. Retinal breaks are also seen.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Hollenhorst plaques are seen in _______.",
    "choices": [
      {
        "id": 1,
        "text": "Central retinal arterial occlusion ( CRAO)"
      },
      {
        "id": 2,
        "text": "Central retinal venous occlusion ( CRVO)"
      },
      {
        "id": 3,
        "text": "Cystoid macular edema"
      },
      {
        "id": 4,
        "text": "Central serous retinopathy"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Hollenhorst plaques</strong> are<strong> </strong>seen in <strong>central retinal arterial occlusion</strong> (CRAO).\u00a0</p>\n<p>They are <strong>cholesterol emboli</strong> seen in retinal arterioles. They originate from atherosclerotis plaques in larger arteries. The image below shows\u00a0Hollenhorst plaques (arrow).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f9406b7c3c704395877a1c566a3308a8x275x435.PNG"
    ]
  },
  {
    "text": "Identify the condition.",
    "choices": [
      {
        "id": 1,
        "text": "Foveal detachment"
      },
      {
        "id": 2,
        "text": "Macular hole"
      },
      {
        "id": 3,
        "text": "Macular edema"
      },
      {
        "id": 4,
        "text": "Macular Drusens"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The above image shows a loss of <strong>foveal reflex</strong> and <strong>central serous retinopathy</strong>, therefore showing focal<strong> foveal detachment</strong>.</p>\n<p>There is <strong>oedema</strong> at the fovea signifying foveal detachment from underlying retinal pigment epithelium. <strong>Macular oedema</strong> is also present (grey dull retina with a ring reflex around the site of oedema). Thus, the most appropriate choice would be foveal detachment.</p>\n<p><strong>Central serous retinopathy</strong> is the spontaneous serous detachment of neurosensory retina in the macular region. It occurs due to increased permeability of choriocapillaris, leading to fluid accumulation in the subretinal space.<strong>\u00a0</strong>Therefore, it is now known as <strong>central serous\u00a0choriopathy</strong>\u00a0(CSC).</p>\n<p>If there is serous retinal detachment at macula, there is <strong>sudden painless loss</strong> of vision. Patients also have relative positive scotoma, micropsia and metamorphopsia. On ophthalmoscopy, a circular ring reflex present. The foveal reflex is absent. On fundus fluorescein angiography (FFA), an <strong>enlarging ink-blot pattern</strong> or <strong>smoke-stack pattern </strong>is seen.</p>\n<p>Treatment is generally not required. It is usually <strong>self-limiting,</strong> but often <strong>recurrent. </strong><strong>Steroids</strong> are <strong>contraindicated</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/5a51c7bc975142ae8561008fdeb4e1eb.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6ec581079d2445249767a15f82b3fe0fx598x491.PNG"
    ]
  },
  {
    "text": "In which of the following conditions is the given sign seen?",
    "choices": [
      {
        "id": 1,
        "text": "Cystoid macular edema"
      },
      {
        "id": 2,
        "text": "Central serous retinopathy"
      },
      {
        "id": 3,
        "text": "Significant macular edema"
      },
      {
        "id": 4,
        "text": "Coat\u2019s disease"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Amsler grid</strong> is used for:\u00a0</p>\n<ul>\n<li>Assess macular function and detecting maculopathy.</li>\n<li>Evaluate the visual field of 10\u00b0</li>\n<li>Good for follow-up in CSR</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3644d4f98f42431c99caf0e33f5820f5.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6359038b82984c289943119198f5ebbdx1280x1511.JPEG"
    ]
  },
  {
    "text": "The ETDRS chart is used for visual evaluation in diabetic patients. What does ETDRS stand for?",
    "choices": [
      {
        "id": 1,
        "text": "Extended treatment for diabetic retinopathy study"
      },
      {
        "id": 2,
        "text": "Early  treatment for diabetic retinopathy study"
      },
      {
        "id": 3,
        "text": "Emergency  treatment for diabetic retinopathy study"
      },
      {
        "id": 4,
        "text": "Emerging  treatment for diabetic retinopathy study"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>ETDRS</strong> stands for<strong> </strong>Early\u00a0Treatment for Diabetic Retinopathy Study.</p>\n<p>ETDRS was a clinical trial designed to evaluate if argon laser photocoagulation or aspirin treatment can reduce the risk of visual loss or slow the progression of diabetic retinopathy in patients with mild-to-severe nonproliferative or early proliferative diabetic retinopathy. During the study, three new visual acuity charts were created in place of Snellen's visual chart.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '09 Retinal Vascular Disorders And Retinal Detachment';
        let hierarchy = ["Marrow", "qBank", "Ophthalmology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>