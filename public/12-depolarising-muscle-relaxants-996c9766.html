<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>12 Depolarising Muscle Relaxants - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Anesthesia
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">25</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following statements is false regarding succinylcholine?",
    "choices": [
      {
        "id": 1,
        "text": "It produces both phase I and phase II block"
      },
      {
        "id": 2,
        "text": "It raises intracranial pressure"
      },
      {
        "id": 3,
        "text": "Precurarization reduces fasciculations and myalgia associated with Sch"
      },
      {
        "id": 4,
        "text": "It is a non\u2013depolarizing muscle relaxant"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Succinylcholine</strong> is a <strong>depolarizing</strong> muscle relaxant.</p>\n<p>Option A: It produces both phase I and phase II block (at a higher dose).</p>\n<p>Option B: Succinylcholine can produce a rise in intracranial pressure as a result of increased cerebral blood flow due to muscle fasciculations.</p>\n<p>Option C:&nbsp;<strong>Precurarization</strong> is the administration of a <strong>small dose</strong>&nbsp;of a <strong>non-depolarizing</strong> neuromuscular blocking <strong>agent,</strong> a few minutes <strong>before Sch</strong> to <strong>minimize</strong>&nbsp;<strong>complications</strong> like fasciculations, post-operative myalgia, rise in intragastric pressure, and rise in ICP.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which is the shortest acting muscle relaxant?",
    "choices": [
      {
        "id": 1,
        "text": "Vecuronium"
      },
      {
        "id": 2,
        "text": "Pancuronium"
      },
      {
        "id": 3,
        "text": "Suxamethonium"
      },
      {
        "id": 4,
        "text": "Pipecuronium"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Suxamethonium</strong> (succinylcholine) is the shortest-acting muscle relaxant.</p>\n<p>It has a <strong>rapid-onset</strong> (30\u201360secs) and <strong>short duration</strong> of action (typically less than 10 min) due to <strong>rapid hydrolysis</strong> by butyrylcholinesterase (<strong>plasma cholinesterase</strong> or pseudocholinesterase).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In a road traffic accident victim with a GCS of 8/15, rapid sequence intubation is planned. Which of the following muscle relaxants is used here?",
    "choices": [
      {
        "id": 1,
        "text": "Atracurium"
      },
      {
        "id": 2,
        "text": "Mivacurium"
      },
      {
        "id": 3,
        "text": "Rocuronium"
      },
      {
        "id": 4,
        "text": "Succinylcholine"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Succinylcholine</strong> is the muscle relaxant of choice for <strong>rapid sequence intubation. </strong>Although succinylcholine causes increase in ICP, it is used in rapid sequence intubation.</p>\n<p>Succinylcholine has a <strong>rapid onset</strong> of action and is the <strong>shortest acting</strong> muscle relaxant. It provides muscle relaxation within 30-60 seconds.</p>\n<p>If succinylcholine is <strong>contraindicated, </strong>then the non-depolarizing muscle relaxant,<strong> rocuronium </strong>can be used.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which drug produces phase II block?",
    "choices": [
      {
        "id": 1,
        "text": "Atracurium"
      },
      {
        "id": 2,
        "text": "Pancuronium"
      },
      {
        "id": 3,
        "text": "D-tubocurarine"
      },
      {
        "id": 4,
        "text": "Suxamethonium"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p style=\"text-align: justify;\"><strong>Suxamethonium</strong> (also known as succinylcholine) produces both <strong>phases I</strong> and <strong>II blocks.</strong></p>\n<p style=\"text-align: justify;\">Suxamethonium is a depolarizing muscle relaxant.</p>\n<p style=\"text-align: justify;\">Mechanism of\u00a0depolarizing blockade:</p>\n<ul style=\"text-align: justify;\">\n<li>Phase I block - continuous endplate depolarization and subsequent muscle relaxation.</li>\n<li>Phase II block - seen with a <strong>single,</strong>\u00a0<strong>large</strong>\u00a0dose, <strong>repeated</strong> doses, or a <strong>continuous</strong> infusion which can lead to <strong>desensitization</strong> of the receptors resulting in the <strong>prolonged</strong> neuromuscular <strong>blockade.</strong></li>\n</ul>\n<p style=\"text-align: justify;\">Phase II block has features of a <strong>non-depolarizing blockade</strong>. But 'phase II' is specifically used for depolarizing blockade by succinylcholine.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements regarding depolarising muscle relaxants is false?",
    "choices": [
      {
        "id": 1,
        "text": "Causes muscle fasciculations"
      },
      {
        "id": 2,
        "text": "Phase I block cannot be reversed by neostigmine"
      },
      {
        "id": 3,
        "text": "Depolarised muscle fibres are unresponsive to other stimuli"
      },
      {
        "id": 4,
        "text": "Fade is seen in phase I block"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p style=\"text-align: justify;\"><strong>Fade</strong> is seen in the non-depolarising <strong>phase II block</strong> caused by depolarizing muscle relaxants.</p>\n<p style=\"text-align: justify;\">Depolarising neuromuscular blockers result in <strong>prolonged depolarization</strong> with a brief period of <strong>fasciculations</strong> (repetitive excitation) followed by blocking of neuromuscular transmission and<strong> flaccid paralysis.&nbsp;</strong>This is termed as <strong>phase I&nbsp;block</strong> and can<strong>not</strong> be<strong> reversed</strong> by<strong> neostigmine</strong> as the membrane is in a depolarised state.</p>\n<p style=\"text-align: justify;\">The depolarised<strong> nerves</strong> are <strong>unresponsive</strong> to other stimuli during this period.</p>\n<p style=\"text-align: justify;\">As the concentration of the drug and time increases, the block may convert slowly to a non-depolarising phase II block. Fade&nbsp;can be seen in this phase. The phase II block is reversible by neostigmine but is difficult to predict and usually avoided in clinical conditions.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 70 kg athlete was posted for surgery on her injured rotator cuff. She was administered a total of 640mg of succinylcholine by intermittent dosing. During recovery, she was unable to respire spontaneously and move her limbs. What is the most likely reason for this?",
    "choices": [
      {
        "id": 1,
        "text": "Muscular weakness due to fasciculation produced by succinylcholine"
      },
      {
        "id": 2,
        "text": "Undiagnosed muscular dystrophy and muscular weakness"
      },
      {
        "id": 3,
        "text": "Phase II blockade produced by succinyl choline"
      },
      {
        "id": 4,
        "text": "Pseudocholinesterase deficiency increasing action of succinylcholine"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p style=\"text-align: justify;\">The most likely reason which led to this scenario is<strong> phase II&nbsp;blockade </strong>produced by <strong>succinylcholine.</strong></p>\n<p style=\"text-align: justify;\">Phase II block is clinically seen with the dose <strong>&gt;5 mg/kg.&nbsp;</strong>It is&nbsp;seen with a&nbsp;single <strong>large</strong> dose, <strong>repeated</strong> doses, or a <strong>continuous</strong> infusion of <strong>Sch</strong> which can lead to <strong>desensitization</strong> of the receptors resulting in a <strong>prolonged</strong> neuromuscular <strong>blockade.</strong></p>\n<p style=\"text-align: justify;\">Causes of prolonged apnea include:</p>\n<ul style=\"text-align: justify;\">\n<li>Atypical/pseudocholinesterase deficiency - can result in apnea even with a normal dose of succinylcholine</li>\n<li>Altered response of endplate to depolarizing relaxant (myasthenia gravis)</li>\n<li>Accumulation of succinylcholine leading to phase II blockade</li>\n</ul>\n<p style=\"text-align: justify;\">Note: Although options A, B, and D can lead to prolonged apnea, in the above case scenario, the patient has received ~9 mg/kg of succinylcholine. Hence, the most probable diagnosis is phase II blockade leading to prolonged apnea.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The anesthetist asks you to administer succinylcholine to a patient in the OT and warns you to monitor the dose carefully to prevent the development of a phase II block. Which of the following is incorrect regarding this phase of the block?",
    "choices": [
      {
        "id": 1,
        "text": "Presence of fade phenomenon"
      },
      {
        "id": 2,
        "text": "Presence of post  tetanic facilitation"
      },
      {
        "id": 3,
        "text": "Preceded by muscle fasciculation"
      },
      {
        "id": 4,
        "text": "Can be reversed by cholinesterase inhibitor"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p style=\"text-align: justify;\"><strong>Phase I</strong> depolarizing block is <strong>preceded</strong> by<strong> muscle fasciculation</strong>.</p>\n<table style=\"height: 180px; width: 741.98px;\">\n<tbody>\n<tr style=\"height: 18px;\">\n<td style=\"width: 341px; height: 18px; text-align: center;\"><strong>Phase I</strong></td>\n<td style=\"width: 381.98px; height: 18px; text-align: center;\"><strong>Phase II</strong></td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 341px; height: 18px;\">Depolarizing block</td>\n<td style=\"width: 381.98px; height: 18px;\">Non-depolarizing block</td>\n</tr>\n<tr style=\"height: 27.0227px;\">\n<td style=\"width: 341px; height: 27.0227px;\">\n<p>No fade during repetitive stimulation\u00a0</p>\n</td>\n<td style=\"width: 381.98px; height: 27.0227px;\">\n<p><strong>Fade</strong> during repetitive stimulation (tetanic or Train Of Four)</p>\n</td>\n</tr>\n<tr style=\"height: 46px;\">\n<td style=\"width: 341px; height: 46px;\">No post-tetanic facilitation</td>\n<td style=\"width: 381.98px; height: 46px;\">\n<p><strong>Post tetanic facilitation</strong>\u00a0(potentiation)</p>\n</td>\n</tr>\n<tr style=\"height: 51px;\">\n<td style=\"width: 341px; height: 51px;\">Block antagonized by rapid <strong>hydrolysis</strong> due to\u00a0<strong>butyrylcholinesterase/plasma cholinesterase</strong>\u00a0</td>\n<td style=\"width: 381.98px; height: 51px;\">Block can be antagonized by administering a <strong>cholinesterase inhibitor</strong>\u00a0like neostigmine.</td>\n</tr>\n</tbody>\n</table>\n<p>\u00a0</p>\n<p><strong>Note</strong>:\u00a0Cholinesterase inhibitors are not routinely used to reverse phase II blockade as certain individuals have\u00a0<strong data-stringify-type=\"bold\">abnormal cholinesterase activity\u00a0</strong>(due to genotypic variations). Their response to cholinesterase activity is unpredictable. Thus a\u00a0<strong data-stringify-type=\"bold\">wait and watch</strong>\u00a0policy is implemented where the patient is put on a\u00a0<strong data-stringify-type=\"bold\">ventilator</strong>\u00a0(100% O2) and observed for\u00a0<strong data-stringify-type=\"bold\">24-48 hours</strong>\u00a0until spontaneous reversal.<span class=\"c-message__edited_label\" dir=\"ltr\" data-sk=\"tooltip_parent\">\u00a0</span></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following skeletal muscle relaxants exhibit the following response to the 'train of four protocol' used in the clinical assessment of neuromuscular blockade?",
    "choices": [
      {
        "id": 1,
        "text": "d-Tubocurarine"
      },
      {
        "id": 2,
        "text": "Mivacurium"
      },
      {
        "id": 3,
        "text": "Succinylcholine"
      },
      {
        "id": 4,
        "text": "Atracurium"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<table style=\"height: 262px; width: 850px;\">\n<tbody>\n<tr style=\"height: 18px;\">\n<td style=\"width: 152px; height: 18px;\">&nbsp;</td>\n<td style=\"width: 334.594px; height: 18px;\"><strong>Non-depolarizing blockers</strong></td>\n<td style=\"width: 339.406px; height: 18px;\"><strong>Depolarizing blockers</strong></td>\n</tr>\n<tr style=\"height: 59px;\">\n<td style=\"width: 152px; height: 59px;\"><strong>Fade phenomenon&nbsp;</strong></td>\n<td style=\"width: 334.594px; height: 59px;\">Present&nbsp;</td>\n<td style=\"width: 339.406px; height: 59px;\">\n<p>Phase 1: Absent</p>\n<p>Phase 2: Present&nbsp;</p>\n</td>\n</tr>\n<tr style=\"height: 186px;\">\n<td style=\"width: 152px; height: 186px;\"><strong>Mechanism</strong></td>\n<td style=\"width: 334.594px; height: 186px;\">\n<p>Initial stimulus: Amount of Ach released is large enough to compete with the drug at the motor endplate causing maximal contraction of the muscle.</p>\n<p>Successive stimuli: Amount of Ach released is insufficient to compete with the drug and results in sequentially diminished contractions</p>\n</td>\n<td style=\"width: 339.406px; height: 186px;\">\n<p>Phase 1: No competition between Sch and Ach. Sch acts like Ach at its receptors, but is not as easily metabolized by acetylcholinesterases resulting in persistent depolarisation.&nbsp;</p>\n<p>Phase 2: When the dose of Sch is increased maximally, it also exhibits a fade phenomenon.</p>\n</td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a7866de0a3b64293bf3ddd0c1c1e3f2a.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d82ec65887b446d18af0026ea5495ad1x1280x1199.JPEG"
    ]
  },
  {
    "text": "Which drug stimulates the autonomic ganglia?",
    "choices": [
      {
        "id": 1,
        "text": "D-tubocurarine"
      },
      {
        "id": 2,
        "text": "Succinylcholine"
      },
      {
        "id": 3,
        "text": "Pancuronium"
      },
      {
        "id": 4,
        "text": "Vecuronium"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Succinylcholine</strong> stimulates the autonomic ganglia.&nbsp;</p>\n<ul>\n<li><strong>Parasympathetic</strong> ganglion (vagal ganglion) -&nbsp;bradycardia</li>\n<li><strong>Sympathetic</strong> ganglion - hypertension and tachycardia.</li>\n</ul>\n<p>Pancuronium causes tachycardia by blocking the cardiac muscarinic receptor and not by stimulation of autonomic ganglia.</p>\n<p>D-tubocurarine blocks the autonomic ganglia. Whereas vercuronium does not act on autonomic ganglia.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following muscle relaxants does not require the administration of a block reversal agent following surgery?",
    "choices": [
      {
        "id": 1,
        "text": "Succinylcholine"
      },
      {
        "id": 2,
        "text": "Pancuronium"
      },
      {
        "id": 3,
        "text": "Rocuronium"
      },
      {
        "id": 4,
        "text": "Vecuronium"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Reversal</strong> of neuromuscular blockade is usually <strong>not needed</strong> in cases where&nbsp;<strong>succinylcholine</strong>&nbsp;is used, as it is rapidly metabolized by pseudocholinesterase resulting in a <strong>short duration of action</strong>.</p>\n<p>Cholinesterase inhibitors can prolong neuromuscular blockade produced by succinylcholine&nbsp;by increasing neuromuscular junction ACh concentration and inhibiting the pseudocholinesterase-induced metabolism of succinylcholine.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following adverse effects are not attributed to succinylcholine?",
    "choices": [
      {
        "id": 1,
        "text": "Hypokalemia"
      },
      {
        "id": 2,
        "text": "Masseter spasm"
      },
      {
        "id": 3,
        "text": "Increased intracranial pressure"
      },
      {
        "id": 4,
        "text": "Arrhythmias"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Succinyl choline</strong> produces <strong>hyperkalemia</strong>&nbsp;not hypokalemia.</p>\n<p>Use of succinylcholine&nbsp;<strong>increases</strong> the plasma<strong> K+ levels </strong>by<strong> 0.5 mEq/L.</strong> This increase in K+ is well tolerated by healthy individuals but could be deliterious in patients with severe metabolic acidosis and hypovolemia.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "While inducing anesthesia, you noticed the patient's eyelids were twitching. A few hours post-op, she complains of generalized body ache. Which muscle relaxant was likely administered to her?",
    "choices": [
      {
        "id": 1,
        "text": "Atracurium"
      },
      {
        "id": 2,
        "text": "Mivacurium"
      },
      {
        "id": 3,
        "text": "Suxamethonium"
      },
      {
        "id": 4,
        "text": "Pancuronium"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The muscle relaxant administered was likely<strong>&nbsp;suxamethonium </strong>(succinylcholine). It is associated with <strong>muscle fasciculations</strong> and <strong>myalgia</strong>.</p>\n<p>Administration of a non-depolarizing muscle relaxant like rocuronium prior to succinylcholine (<strong>precurarization</strong>) is effective in <strong>prevent</strong>ing fasciculations and reducing postoperative myalgias.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You are about to administer succinylcholine to a patient before intubating him when your senior asks you to administer a non-depolarizing muscle relaxant before doing so. He says this will prevent muscle fasciculations. Which drug do you choose for this?",
    "choices": [
      {
        "id": 1,
        "text": "Pancuronium"
      },
      {
        "id": 2,
        "text": "Atracurium"
      },
      {
        "id": 3,
        "text": "Rocuronium"
      },
      {
        "id": 4,
        "text": "Vecuronium"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Rocuronium</strong> is the agent of choice for <strong>precurarization</strong>.</p>\n<p>Precurarization&nbsp;is the administration of a small dose (10% of ED95) of a&nbsp;<strong>non-depolarizing neuromuscular blocking agent,</strong>&nbsp;a few minutes before succinylcholine to <strong>minimize</strong>&nbsp;<strong>complications</strong>&nbsp;like fasciculations, postoperative myalgia, and rise in intragastric, intraocular, and intracranial pressure.</p>\n<p>Rocuronium is <strong>ideal</strong> because it has a <strong>rapid onset of action</strong> (90 seconds), which is comparable with succinylcholine and is very effective in decreasing fasciculations and postoperative myalgias.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following patients are not at risk of hyperkalemia from succinylcholine?",
    "choices": [
      {
        "id": 1,
        "text": "Patient of muscle dystrophy"
      },
      {
        "id": 2,
        "text": "Patient with 45% burns"
      },
      {
        "id": 3,
        "text": "Patient of spinal cord injury"
      },
      {
        "id": 4,
        "text": "Patient of myasthenia gravis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p style=\"text-align: left;\">All the given conditions except myasthenia gravis are associated with the risk of hyperkalemia from succinylcholine (SCh)&nbsp;</p>\n<p style=\"text-align: left;\">In patients with&nbsp;<strong>myasthenia gravis:&nbsp;</strong></p>\n<ul style=\"text-align: left;\">\n<li style=\"text-align: justify;\"><strong>Depolarizing</strong> muscle <strong>relaxants</strong> (SCh) - resistant&nbsp;</li>\n<li style=\"text-align: justify;\"><strong>Non-depolarizing</strong> muscle relaxants - hypersensitive&nbsp;</li>\n</ul>\n<p style=\"text-align: left;\">All the other options include conditions that can have preexisting hyperkalemia. Thus, the <strong>succinylcholine-induced release</strong> of <strong>potassium</strong> from skeletal muscles may lead to <strong>catastrophic hyperkalemia</strong> in these patients.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following adverse effects would you not expect while using succinylcholine as a muscle relaxant for a surgery being done under general anesthesia?",
    "choices": [
      {
        "id": 1,
        "text": "Increased intra ocular pressure"
      },
      {
        "id": 2,
        "text": "Increased intra cranial pressure"
      },
      {
        "id": 3,
        "text": "Hyperkalemia"
      },
      {
        "id": 4,
        "text": "Decreased intragastric pressure"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Succinylcholine\u00a0<strong>increases\u00a0intragastric pressure.\u00a0</strong>This is likely due to fasciculations of the abdominal skeletal muscle.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following conditions does not reduce the activity of butyrylcholinesterase?",
    "choices": [
      {
        "id": 1,
        "text": "Liver disease"
      },
      {
        "id": 2,
        "text": "Pregnancy"
      },
      {
        "id": 3,
        "text": "Malnutrition"
      },
      {
        "id": 4,
        "text": "Renal disease"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The <strong>renal disease</strong> does <strong>not affect</strong> the activity of <strong>butyrylcholinesterase.</strong></p>\n<p>Butyrylcholinesterase is the enzyme that <strong>degrades succinylcholine.</strong> It is <strong>synthesized</strong> in the <strong>liver</strong> and found in the plasma.</p>\n<p>Reduced butyrylcholinesterase activity is seen in:</p>\n<ul>\n<li>Liver disease</li>\n<li>Pregnancy</li>\n<li>Malnutrition</li>\n<li>Old age</li>\n<li>Drugs like - oral contraceptives, monoamine oxidase inhibitors, echothiophate, cytotoxic drugs,&nbsp; anticholinesterase drugs, and metoclopramide.</li>\n</ul>\n<p>Decreased butyrylcholinesterase is not a major concern in clinical practice because even a large decrease in the enzyme activity will produce only a slight increase in the duration of neuromuscular blockade.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following drugs potentiate the action of succinylcholine?",
    "choices": [
      {
        "id": 1,
        "text": "2, 3, 4, 5"
      },
      {
        "id": 2,
        "text": "1, 3, 5"
      },
      {
        "id": 3,
        "text": "1, 2, 4"
      },
      {
        "id": 4,
        "text": "1, 2, 3, 4"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Calcium</strong> causes <strong>resistance</strong> to neuromuscular <strong>blockade</strong>&nbsp;caused by succinylcholine.&nbsp;</p>\n<p>Neostigmine being an <strong>anticholinesterase</strong> leads to inhibition of acetylcholinesterase. This results in a <strong>higher ACh concentration</strong> at the nerve terminal, which intensifies depolarization.</p>\n<p><strong>Neostigmine,</strong> oral contraceptive pills <strong>(OCPs), metoclopramide,</strong> and<strong>&nbsp;aminoglycosides</strong> (streptomycin) can <strong>potentiate</strong> the <strong>paralysis</strong> produced by succinylcholine.</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the next line of management in a patient diagnosed with succinylcholine apnoea?",
    "choices": [
      {
        "id": 1,
        "text": "Increase the dose of succinylcholine"
      },
      {
        "id": 2,
        "text": "Administer neostigmine"
      },
      {
        "id": 3,
        "text": "Fresh frozen plasma transfusion"
      },
      {
        "id": 4,
        "text": "Continue mechanical ventilation"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p style=\"text-align: justify;\">The mainstay in the treatment of <strong>succinylcholine apnea</strong> due to atypical pseudocholinesterase is to&nbsp;<strong>continue mechanical ventilation </strong>until&nbsp;muscle function returns to normal by clinical signs.</p>\n<p style=\"text-align: justify;\">Option B: Administration of <strong>neostigmine</strong> is <strong>controversial</strong> as the effects may be transient, possibly followed by an intensified neuromuscular blockade.</p>\n<p style=\"text-align: justify;\">Option C: Fresh frozen plasma can augment the patient's endogenous plasma pseudocholinesterase activity but is not recommended because of the risk of iatrogenic viral infections.</p>\n<p style=\"text-align: justify;\">Note: If&nbsp;<strong>human plasma cholinesterase</strong>&nbsp;is available, it can be given to <strong>reverse neuromuscular blockade</strong>.</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 5-year-old child was given intravenous succinylcholine for rapid sequence intubation at a dose of 0.5 mg/kg. During intubation, a masseteric spasm was noted. Temperature and BP were normal. What would be your first line of management?",
    "choices": [
      {
        "id": 1,
        "text": "IV dantrolene"
      },
      {
        "id": 2,
        "text": "Cool the child by using cooling blanket"
      },
      {
        "id": 3,
        "text": "Stop intubation"
      },
      {
        "id": 4,
        "text": "Increase the dose of succinylcholine"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p style=\"text-align: left;\">The first line of management in this child would be to <strong>increase</strong> the<strong> dose</strong> of<strong> succinylcholine</strong>.</p>\n<p style=\"text-align: left;\">The incidence of <strong>muscle spasms without</strong> any symptoms and signs of <strong>malignant hyperthermia</strong> frequently results from an <strong>inadequate</strong> <strong>dosage</strong> of succinylcholine. Succinylcholine dosage for intubation is&nbsp;<strong>1-2mg/kg</strong></p>\n<p style=\"text-align: left;\">Conditions to be ruled out in isolated masseteric spasm:</p>\n<ul style=\"text-align: left;\">\n<li><strong>Inadequate dose</strong> of succinylcholine (less than the recommended dose of 1 mg/kg)</li>\n<li><strong>Inadequate time</strong> for the onset of succinylcholine action</li>\n<li>Duchenne muscular dystrophy, myotonia congenita, and other <strong>muscle disorders</strong></li>\n<li>Temporomandibular joint dislocation</li>\n</ul>\n<p style=\"text-align: left;\">Confusion-buster: Although an increase in the <strong>tone</strong> of the <strong>masseter</strong>&nbsp;is considered to be an <strong>early indicator</strong> of <strong>malignant hyperthermia,</strong> this finding is <strong>not consistently</strong> associated with it.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "During a pre-op evaluation, a patient tells you he had been kept on a ventilator for 2 days following his previous surgery. There are similar instances in his family history. The reports from his previous surgery reveal his dibucaine number to be 20. What is this number used to assess?",
    "choices": [
      {
        "id": 1,
        "text": "Concentration of butyrylcholinesterase"
      },
      {
        "id": 2,
        "text": "Concentration of acetyl cholinesterase"
      },
      {
        "id": 3,
        "text": "Genetic make up of an individual with respect to butyryl cholinesterase"
      },
      {
        "id": 4,
        "text": "Concentration of ACh receptors"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Dibucaine number</strong> indicates the <strong>genetic makeup </strong>of an individual with respect to<strong> butyrylcholinesterase. </strong>It is a qualitative measure that measures<strong> pseudocholinesterase function</strong> but not the amount of enzyme.</p>\n<p>A patient with <strong>normal </strong>pseudocholinesterase has a <strong>dibucaine number</strong> of<strong> 80</strong>; whereas a homozygote for an atypical enzyme will have a dibucaine number of 20.</p>\n<p>Therefore, the adequacy of pseudocholinesterase can be determined quantitatively in units per liter - in the&nbsp;laboratory</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In a patient with a Dibucaine number of 20, which of the following drug/s are to be avoided?",
    "choices": [
      {
        "id": 1,
        "text": "Only 1"
      },
      {
        "id": 2,
        "text": "1, 2 & 5"
      },
      {
        "id": 3,
        "text": "1 & 4"
      },
      {
        "id": 4,
        "text": "1, 2 & 3"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p style=\"text-align: justify;\"><strong>Succinylcholine</strong> and <strong>mivacurium</strong> are eliminated through hydrolysis by <strong>plasma cholinesterases</strong>. Thus, in a patient with a <strong>low Dibucaine number,</strong> both of these drugs should be <strong>avoided.&nbsp;</strong>Both drugs can cause prolonged apnea in patients with&nbsp;atypical plasma cholinesterase.&nbsp;</p>\n<p style=\"text-align: justify;\">Dibucaine number&nbsp;refers to the<strong>&nbsp;percentage</strong> of<strong> inhibition</strong> of<strong> pseudocholinesterase</strong>&nbsp;activity.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which selective GABA-B receptor agonist is used as a muscle relaxant?",
    "choices": [
      {
        "id": 1,
        "text": "Diazepam"
      },
      {
        "id": 2,
        "text": "Clonazepam"
      },
      {
        "id": 3,
        "text": "Flumazenil"
      },
      {
        "id": 4,
        "text": "Baclofen"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Baclofen</strong> is a centrally acting&nbsp;<strong>selective GABA-B receptor agonist</strong> used as a <strong>muscle relaxant</strong>.&nbsp;It hyperpolarizes neurons by increasing potassium conductance and altering calcium influx.&nbsp;</p>\n<div class=\"page\" title=\"Page 373\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<div class=\"page\" title=\"Page 374\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Centrally acting muscle relaxants reduce skeletal muscle tone by a selective action in the cerebrospinal axis without altering consciousness.</p>\n<p>Classification of centrally acting muscle relaxants:</p>\n<div class=\"column\">\n<ul>\n<li><strong>Mephenesin congeners</strong> - mephenesin, carisoprodol, chlorzoxazone, chlormezanone, methocarbamol.</li>\n<li><strong>Benzodiazepines</strong> - diazepam and others.</li>\n<li><strong>GABA mimetic</strong> - baclofen, thiocolchicoside.</li>\n<li><strong>Central &alpha;2 receptor agonist</strong> - tizanidine.</li>\n</ul>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following muscle relaxants decreases calcium release from sarcoplasmic reticulum?",
    "choices": [
      {
        "id": 1,
        "text": "Succinylcholine"
      },
      {
        "id": 2,
        "text": "Dantrolene"
      },
      {
        "id": 3,
        "text": "Vecuronium"
      },
      {
        "id": 4,
        "text": "Decamethonium"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Calcium release</strong> from the sarcoplasmic reticulum is <strong>decreased</strong> by&nbsp;<strong>dantrolene</strong>.</p>\n<p>It is a <strong>direct-acting</strong> skeletal muscle <strong>relaxant</strong> that acts on the <strong>RyR1</strong> (ryanodine receptor) calcium channels in the sarcoplasmic reticulum of skeletal muscles and <strong>inhibits calcium-induced calcium release</strong>. It results in the&nbsp;uncoupling of membrane depolarization and muscle contraction.</p>\n<p>IV dantrolene is the drug of<strong> choice</strong> for <strong>malignant hyperthermia</strong> which is due to the persistent release of calcium from the sarcoplasmic reticulum.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You are planning to administer a non-depolarising muscle relaxant to a patient. Which of the following will you not choose?",
    "choices": [
      {
        "id": 1,
        "text": "Pancuronium"
      },
      {
        "id": 2,
        "text": "Rocuronium"
      },
      {
        "id": 3,
        "text": "Suxamethonium"
      },
      {
        "id": 4,
        "text": "Vecuronium"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p style=\"text-align: justify;\">Suxamethonium or <strong>succinyl choline</strong> is a <strong>depolarizing</strong> muscle relaxant. All the other options are non-depolarising muscle relaxants and so can be chosen here.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 72-year-old man with a history of a stroke 8 years prior presents with a displaced humerus fracture. He is planned for open reduction and fixation. Which muscle relaxant is to be avoided in him?",
    "choices": [
      {
        "id": 1,
        "text": "Succinylcholine"
      },
      {
        "id": 2,
        "text": "Atracurium"
      },
      {
        "id": 3,
        "text": "Mivacurium"
      },
      {
        "id": 4,
        "text": "Cisatracurium"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Succinylcholine is <strong>avoided</strong> in patients with a history of <strong>stroke,</strong> due to the risk of<strong> hyperkalemia.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '12 Depolarising Muscle Relaxants';
        const quizFilename = '12-depolarising-muscle-relaxants-996c9766.html';
        let hierarchy = ["Marrow", "qBank", "Anesthesia"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>