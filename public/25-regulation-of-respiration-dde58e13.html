<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>25 Regulation Of Respiration - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Physiology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">30</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Where is the pneumotaxic centre located?",
    "choices": [
      {
        "id": 1,
        "text": "Pons"
      },
      {
        "id": 2,
        "text": "Midbrain"
      },
      {
        "id": 3,
        "text": "Medulla"
      },
      {
        "id": 4,
        "text": "Cerebellum"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Pneumotaxic center</strong> is located in <strong>upper pons</strong>.</p>\n<p><strong>Neural regulation of respiration</strong>:</p>\n<p>It involves set of neurons located in pons and medulla:</p>\n<ul>\n<li>Pons:\n<ul>\n<li>Pneumotaxic centre</li>\n<li>Apneustic centre</li>\n</ul>\n</li>\n<li>Medulla: Pre-Botzinger complex\n<ul>\n<li>Dorsal respiratory group</li>\n<li>Ventral respiratory group</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/756d0166e98d43029a420ca06255a2c3x818x1056.PNG"
    ]
  },
  {
    "text": "Pacemaker generating the rhythm for breathing is ________",
    "choices": [
      {
        "id": 1,
        "text": "Pneumotaxic centre"
      },
      {
        "id": 2,
        "text": "Dorsal group of neurons in the medulla"
      },
      {
        "id": 3,
        "text": "Pre-B\u0151tzinger complex"
      },
      {
        "id": 4,
        "text": "Apneustic centre"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Regulation of expiration:</strong> During <strong>quiet breathing, expiration</strong> is a <strong>passive process; </strong>there is no firing of neurons. <strong>Ventral respiratory group of neurons</strong> are involved in <strong>forceful expiration</strong> like during exercise.</p>\n<p><strong>Mnemonic DIVE</strong>:<strong>&nbsp;</strong><strong>D</strong>orsal respiratory group for <strong>I</strong>nspiration and <strong>V</strong>entral respiratory group for<strong> E</strong>xpiration.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is true about the main respiratory control neurons?",
    "choices": [
      {
        "id": 1,
        "text": "Send out regular bursts of impulses to expiratory muscles during quiet respiration"
      },
      {
        "id": 2,
        "text": "Are unaffected by pain"
      },
      {
        "id": 3,
        "text": "Are unaffected by impulses from the cerebral cortex"
      },
      {
        "id": 4,
        "text": "Send out regular bursts of impulses to inspiratory muscles during quiet respiration"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The <strong>main respiratory control neurons</strong>&nbsp;called the <strong>pre- B\u0151tzinger complex (pre-BOTC),</strong> are located in the<strong> medulla.</strong></p>\n<p><strong>Pre-B&ouml;tzinger complex </strong>(pre-B&Ouml;TC) is located on either side of the medulla, between the nucleus ambiguus and the lateral reticular nucleus&nbsp;</p>\n<p>They send out regular bursts of impulses to inspiratory muscles&nbsp;via phrenic nerve during quiet respiration.</p>\n<p>Option a: Expiration is passive during quiet breathing. There is no discharge of any neurons.</p>\n<p>Option b:&nbsp;Pain stimulates respiration. There are NK1 receptors and &mu;-opioid receptors in Pre-Botzinger complex, and, in vivo, substance P stimulates and opioids inhibit respiration.</p>\n<p>Option c: Impulses from cerebral cortex also influence the pre-Botzinger complex.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The rate of inspiration is controlled by _______",
    "choices": [
      {
        "id": 1,
        "text": "Cerebral cortex"
      },
      {
        "id": 2,
        "text": "Ventral group of neurons in medulla"
      },
      {
        "id": 3,
        "text": "Pneumotaxic centre"
      },
      {
        "id": 4,
        "text": "Apneustic centre"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The rate of inspiration is controlled by<strong> the pneumotaxic center.</strong></p>\n<p><strong>Pneumotaxic centre</strong>:</p>\n<p>Location: <strong>Upper pons</strong> (dorsally in nucleus parabrachialis)</p>\n<p><strong>Function:</strong></p>\n<ul>\n<li>Transmits signals to the inspiratory area, i.e., <strong>it inhibits the apneustic center</strong> and thus the dorsal respiratory group of neurons, to stop inspiration.&nbsp;</li>\n<li>It thus helps <strong>limit duration of inspiration&nbsp;</strong>and switching between inspiration and expiration.</li>\n<li>This has a secondary effect of <strong>increasing the rate of breathing</strong> because limiting the duration of inspiration also shortens the duration of expiration, and hence, the entire period of respiration.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0324c1312ebe43d89690c223d30c3f73x1280x1649.JPEG"
    ]
  },
  {
    "text": "Depth of inspiration is increased by_____",
    "choices": [
      {
        "id": 1,
        "text": "Pneumotaxic centre"
      },
      {
        "id": 2,
        "text": "Ventral group of neurons in medulla"
      },
      {
        "id": 3,
        "text": "Dorsal group of respiratory neurons"
      },
      {
        "id": 4,
        "text": "Apneustic centre"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Depth of inspiration is increased by the&nbsp;<strong>apneustic center</strong>.</p>\n<p>The apneustic centre sends signals to<strong> prevent switching off</strong> of inspiration maintained by the dorsal respiratory group of neurons, thereby increasing depth of inspiration.&nbsp;</p>\n<p>In contrast to this, the <strong>pneumotaxic center</strong> primarily <strong>limits inspiration</strong> by controlling the \"switch off\" point of the inspiratory ramp signal.&nbsp;</p>\n<p>A note on inspiratory ramp signal:</p>\n<p>The neural signals transmitted to the inspiratory muscle, mainly the diaphragm, is not the instantaneous burst of action potentials. Instead, it <strong>begins weakly</strong> and <strong>increases steadily </strong>in a ramped manner. The advantage of the ramp is that it causes a steady increase in the volume of the lungs during inspiration, rather than inspiratory gasps.</p>\n<p>Control of the <strong>limiting point at which the ramp suddenly ceases</strong>&nbsp;is the mechanism by which the respiratory centers control <strong>depth and rate of respiration</strong>.&nbsp;</p>\n<p>Option A: Pneumotaxic center of the pons regulates the <strong>rate and depth</strong> of breathing.<br />Option B: Ventral group of neurons regulate <strong>expiration</strong>.<br />Option C: Dorsal group of neurons regulate <strong>inspiration</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/11769e1b4d794ede9ca62f5305930574x1280x1649.JPEG"
    ]
  },
  {
    "text": "A young couple was spending their afternoon on a picnic. Suddenly, the woman got down on her knee, pulled out a ring, and proposed. The man was taken aback and began to hyperventilate. The overdrive mechanism observed is due to_____",
    "choices": [
      {
        "id": 1,
        "text": "Pneumotaxic centre"
      },
      {
        "id": 2,
        "text": "Dorsal group of neurons (DRG) in the medulla"
      },
      {
        "id": 3,
        "text": "Apneustic centre"
      },
      {
        "id": 4,
        "text": "Ventral group of neurons (VRG) in the medulla"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The <strong>ventral respiratory group</strong> contributes to the extra respiratory drive (overdrive mechanism)</p>\n<ul>\n<li><strong>During quiet breathing</strong>:&nbsp;Expiration is a passive process and the neurons from the&nbsp;<strong>ventral respiratory group remain almost totally inactive during quiet respiration</strong>.<strong>&nbsp;</strong>Unlike the dorsal respiratory group (DRG; dorsal group of neurons), VRG (the ventral group of neurons) does not appear to participate in the basic rhythmic oscillations that control respiration.</li>\n<li><strong>Extra-respiratory drive (overdrive mechanism)</strong>:<strong>&nbsp;</strong>When the respiratory drive for increased pulmonary ventilation becomes greater than normal, for example,&nbsp;<strong>during exercise</strong>, respiratory signals spill over to VRG from DRG. So, VRG contributes to the <strong>extra respiratory drive (overdrive mechanism)</strong>.</li>\n<li>The neurons of <strong>VRG contribute to both inspiration and expiration</strong>;&nbsp;especially, they are important in <strong>providing powerful expiratory signals to the abdominal muscles during very heavy expiration</strong>.&nbsp;</li>\n</ul>\n<p><strong>Dorsal and ventral respiratory group:</strong></p>\n<table>\n<tbody>\n<tr>\n<td>&nbsp;</td>\n<td><strong>Dorsal respiratory group</strong></td>\n<td>&nbsp;<strong>Ventral respiratory group</strong></td>\n</tr>\n<tr>\n<td>Location</td>\n<td>Nucleus Tractus Solitarius in medulla</td>\n<td>Nucleus Retro Ambigualis in medulla</td>\n</tr>\n<tr>\n<td>Function</td>\n<td>Inspiratory ramp signals - Stimulates inspiration</td>\n<td>Inactive during quiet breathing; Active during forced expiration</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/23042e8116cc460ca2f4468eb7fc8ad5x1280x1649.JPEG"
    ]
  },
  {
    "text": "Stimulation of the apneustic centre causes______",
    "choices": [
      {
        "id": 1,
        "text": "Decrease in the inspiratory ramp signal"
      },
      {
        "id": 2,
        "text": "Marked increase in inspiratory activity"
      },
      {
        "id": 3,
        "text": "Stimulation of pneumotaxic centre"
      },
      {
        "id": 4,
        "text": "Cessation of spontaneous respiration"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>apneustic center</strong> is located in the lower pons and it <strong>stimulates the inspiratory center to increase inspiratory activity.</strong></p>\n<p>The apneustic center of pons send signals to the DRG in medulla to delay the &lsquo;switch off&rsquo; signal of the inspiratory ramp provided by pneumotaxic center of pons. It gets feedback from vagal afferents and also from other respiratory centers.</p>\n<p>The apneustic center is inhibited by vagal afferents from pulmonary stretch receptors aroused by inspiration so that stimulatory effect on the inspiratory neurons is switched off allowing expiration to supervene.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A few nights before the respiratory physiology exam, a student was suffering from a recurring nightmare. In this nightmare, a knife-wielding horse was chasing him through the streets and threatening to cut off his brainstem at the mid-pontine level. Assuming the horse was proficient in its threat, and performed a bilateral vagotomy as well, which of the following outcomes would occur?",
    "choices": [
      {
        "id": 1,
        "text": "Ceasation of spontaneous respiration"
      },
      {
        "id": 2,
        "text": "Continuation of regular breathing"
      },
      {
        "id": 3,
        "text": "Irregular but rhythmic respiration"
      },
      {
        "id": 4,
        "text": "Apneusis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Transection </strong>of the<strong> brain stem at the mid-pontine level </strong>with<strong> bilateral vagotomy</strong> causes <strong>apneusis.</strong></p>\n<p>At mid pontine level lesion, the apneustic centre is intact while the <strong>pneumotaxic centre</strong> is separated. Concurrent removal of vagus inputs causes this kind of abnormal pattern of breathing characterized by deep, gasping inspiration with a pause at full inspiration followed by a brief insufficient release.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Peripheral chemoreceptors _____",
    "choices": [
      {
        "id": 1,
        "text": "Respond minimally to changes in PO2 under normoxic conditions"
      },
      {
        "id": 2,
        "text": "Respond to changes in arterial PO2 but not pH"
      },
      {
        "id": 3,
        "text": "Respond to changes on PCO2 slower than the central chemoreceptors"
      },
      {
        "id": 4,
        "text": "Are most important receptors causing an increased ventilation in response to a rise in PCO2"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Peripheral chemoreceptors <strong>respond minimally to changes in PO<sub>2</sub> under normoxic conditions.</strong></p>\n<div class=\"page\" title=\"Page 672\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Because of the enormous blood flow per unit of tissue to the carotid bodies, the receptors are not stimulated in conditions such as anemia or carbon monoxide poisoning, in which the amount of dissolved O2 in the blood reaching the receptors is generally normal, even though the combined O2 in the blood is markedly decreased.</p>\n</div>\n</div>\n</div>\n</div>\n<p>Peripheral chemoreceptors are responsive to changes in arterial O<sub>2</sub>, CO<sub>2</sub>, and H+ ions.</p>\n<p>They are excited by a decrease in arterial O2. However, a graph plotted between the rate of firing of afferent neurons in the chemoreceptor vs. arterial pO2 shows they are most sensitive to changes in pO<sub>2</sub> of less than 60mmHg. Thus, ventilation is driven by pCO<sub>2</sub> and H+ under normoxic conditions.\u00a0</p>\n<p><strong>Other options :</strong></p>\n<ul>\n<li>Option B: Peripheral chemoreceptors respond to changes in blood pH. They are <strong>excited by an increase in H+ ions</strong> (i.e decrease in pH)</li>\n<li>Option C: The <strong>response of peripheral chemoreceptors to changes in Pco<sub>2</sub> is faster</strong> than that of central chemoreceptors. Increase in arterial pCO2 stimulates respiration. However, the stimulation by way of peripheral chemoreceptors occurs 5 times as rapidly as that from central chemoreceptors. This helps increase the rapididty of response to CO<sub>2</sub> at the onset of exercise.</li>\n<li>Option D: <strong>Central chemoreceptors are more important</strong> than the peripheral chemoreceptors in the <strong>ventilatory response to increased CO<sub>2</sub>.</strong></li>\n</ul>\n<p><strong>Note</strong>:</p>\n<ul>\n<li>Most potent stimulus for central chemoreceptor in blood: CO<sub>2</sub></li>\n<li>Most potent stimulus for central chemoreceptor in CSF: H<sup>+</sup> ions</li>\n<li>Most potent stimulus for respiration: CO<sub>2</sub></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Peripheral chemoreceptors are primarily sensitive to_____",
    "choices": [
      {
        "id": 1,
        "text": "PaCO2"
      },
      {
        "id": 2,
        "text": "H+"
      },
      {
        "id": 3,
        "text": "PaO2"
      },
      {
        "id": 4,
        "text": "HCO3-"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The <strong>peripheral chemoreceptors</strong>, located in the <strong>carotid and aortic bodies</strong>, are primarily <strong>sensitive to decrease in arterial PO<sub>2</sub></strong>, although high PaCO<sub>2</sub> and low pH also stimulates them and enhance their sensitivity to hypoxia.</p>\n<p>Carotid body is more sensitive than aortic body.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Peripheral chemoreceptors are stimulated maximally by____",
    "choices": [
      {
        "id": 1,
        "text": "Acidosis"
      },
      {
        "id": 2,
        "text": "Hypercapnia"
      },
      {
        "id": 3,
        "text": "Carbon monoxide"
      },
      {
        "id": 4,
        "text": "Cyanide"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Cyanide</strong> causes <strong>histotoxic hypoxia</strong>, and thus, by preventing the O<sub>2</sub> utilization at the tissue level;&nbsp;it acts as the powerful stimulus for peripheral chemoreceptors. Even though Po2 level of blood is normal in case of cyanide poisoning the sensors in carotid and aortic bodies are not able to sense oxygen in blood because of blockade<strong> of cellular respiration</strong> and hence, they go in for hypoxic state and gets stimulated.</p>\n<ul>\n<li><strong>Option a: Acidosis </strong>(Increased H<sup>+</sup> ions) stimulates peripheral chemoreceptors.</li>\n<li><strong>Option b: Increased pCO<sub>2</sub> </strong>mainly stimulates central chemoreceptors.</li>\n<li><strong>Option c:</strong> The peripheral chemoreceptors have an <strong>enormous blood flow</strong> per unit tissue (2000mL/100g of tissue/min) because of which the O<sub>2</sub> needs of the cells can be met by dissolved O<sub>2</sub> Therefore, Carbon monoxide poisoning does not stimulate peripheral chemoreceptors because the <strong>amount of dissolved O<sub>2</sub> is generally normal</strong>, even though the combined O<sub>2</sub> in the blood is markedly decreased.</li>\n</ul>\n<div class=\"page\" title=\"Page 672\">&nbsp;</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Carotid body chemoreceptors are stimulated by all of the following types of hypoxia except_____",
    "choices": [
      {
        "id": 1,
        "text": "Anemic"
      },
      {
        "id": 2,
        "text": "Hypoxic"
      },
      {
        "id": 3,
        "text": "Stagnant"
      },
      {
        "id": 4,
        "text": "Histotoxic"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Anemic hypoxia</strong> does not stimulate carotid body chemoreceptors.</p>\n<p>In anemia,</p>\n<ul>\n<li><strong>Amount of dissolved O<sub>2</sub></strong> reaching the receptors is generally <strong>normal</strong>&nbsp;</li>\n<li><strong>Combined O<sub>2</sub></strong> in the blood is <strong>markedly decreased</strong>.</li>\n<li>The blood flow per unit tissue of carotid body chemoreceptors is enormous (2000mL/100g of tissue/min). Hence, <strong>O<sub>2</sub> needs of the tissue</strong> can be <strong>met largely by dissolved O<sub>2 </sub>alone</strong>. Therefore, the receptors are not stimulated by conditions such as <strong>anemia </strong>or<strong> carbon monoxide poisoning</strong>, in which the <strong>amount of dissolved O<sub>2</sub></strong> reaching the receptors is <strong>generally normal</strong>, even though <strong>combined O<sub>2</sub></strong> in the blood is <strong>markedly decreased.</strong> These peripheral chemoreceptors are stimulated when arterial pO<sub>2</sub> is low.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Central chemoreceptors_____",
    "choices": [
      {
        "id": 1,
        "text": "Respond to both pCO2 and pO2 of blood"
      },
      {
        "id": 2,
        "text": "Are activated by changes in pH of the CSF"
      },
      {
        "id": 3,
        "text": "For a given rise in pCO2, the pH of the CSF falls less than that of blood"
      },
      {
        "id": 4,
        "text": "HCO3- concentration in CSF doesnt affect output of central chemoreceptors"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Central chemoreceptors</strong> are <strong>stimulated by changes in pH of the CSF.&nbsp;</strong>They&nbsp;are located on the <strong>ventral surface of medulla</strong></p>\n<p>Option A: Central chemoreceptors&nbsp;<strong>do not respond</strong> to <strong>pO<sub>2</sub></strong> of the blood.</p>\n<p>Option C: For a given rise in pCO<sub>2</sub>, the CSF pH falls <strong>more</strong> than that of the blood because the CSF has less buffering. CO<sub>2</sub> combines with H<sub>2</sub>O to form H<sub>2</sub>CO<sub>3</sub> which dissociates into H<sup>+</sup> and HCO<sub>3</sub><sup>-</sup>. H<sup>+</sup> is buffered by combining with Hb. This buffering is less in CSF and hence pH falls.</p>\n<p>Option D: The HCO<sub>3</sub><sup>-</sup> concentration of the CSF <strong>can affect</strong> the output of the central chemoreceptors by buffering the changes in pH. HCO<sub>3</sub><sup>-</sup> can combine with H<sup>+</sup> and thus neutralise it and alter pH and thus alter output of central chemoreceptors.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Central chemoreceptors are most sensitive to the following change in the blood:",
    "choices": [
      {
        "id": 1,
        "text": "Decreased Po2"
      },
      {
        "id": 2,
        "text": "Increased Pco2"
      },
      {
        "id": 3,
        "text": "Increased H+"
      },
      {
        "id": 4,
        "text": "Decreased Pco2"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Central</strong> chemoreceptors are most sensitive to<strong> increased Pco<sub>2</sub> in the blood</strong>.<strong>&nbsp; </strong></p>\n<p>Central chemoreceptors are most sensitive to increased Pco<sub>2</sub> in the blood because CO<sub>2 </sub>moves into the CSF, where it is promptly hydrated to form H<sub>2</sub>CO<sub>3 </sub>that dissociates to increase the CSF H<sup>+</sup> concentration. This stimulates the central chemoreceptors, which monitor CSF H<sup>+</sup> concentration (not blood&nbsp;H<sup>+</sup> concentration).</p>\n<p>Other options:</p>\n<ul>\n<li>H<sup>+</sup> in arterial blood penetrates the blood-brain barrier very slowly and hence has little effect on central chemoreceptors.</li>\n<li>Arterial Po<sub>2</sub> has no effect on central chemoreceptors.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The primary direct stimulus for excitation of central chemoreceptors which regulate ventilation is______",
    "choices": [
      {
        "id": 1,
        "text": "Increased H+ in CSF"
      },
      {
        "id": 2,
        "text": "Increased arterial PCO2"
      },
      {
        "id": 3,
        "text": "Decreased arterial PO2"
      },
      {
        "id": 4,
        "text": "Increased CO2 in CSF"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The <strong>central chemoreceptors</strong> are <strong>primarily stimulated by an increase in the H<sup>+</sup> in the CSF.</strong></p>\n<p>CO<sub>2</sub> readily penetrates the blood-brain barrier and is promptly hydrated in the CSF to form H<sub>2</sub>CO<sub>3 </sub>that dissociates so that local H<sup>+</sup> concentration rises. The H<sup>+ </sup>concentration in the CSF parallels the arterial Pco<sub>2</sub>. So the effect of arterial Pco<sub>2</sub> and CO<sub>2</sub> in CSF is indirect or secondary.</p>\n<p>Arterial Po<sub>2</sub> has no effect on central chemoreceptors.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Peripheral and central chemoreceptors may both contribute to increased ventilation that occurs as a result of decreased______",
    "choices": [
      {
        "id": 1,
        "text": "Arterial PCO2"
      },
      {
        "id": 2,
        "text": "Arterial PO2"
      },
      {
        "id": 3,
        "text": "Arterial blood pressure"
      },
      {
        "id": 4,
        "text": "H+"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Both peripheral and central chemoreceptors&nbsp;contribute to increased ventilation that occurs as a result of decreased<strong> arterial blood pressure</strong>.</p>\n<ul>\n<li>Decrease in arterial blood pressure &rarr;&nbsp;hypoperfusion&nbsp;&rarr; hypoxia&nbsp;&rarr; stimulation of peripheral chemoreceptors.</li>\n<li>Decrease in arterial blood pressure&nbsp;&rarr;&nbsp;CO<sub>2</sub> retention&nbsp;&rarr; increased arterial P<sub>CO2&nbsp;</sub>&rarr;&nbsp;&uarr; H<sup>+</sup> concentration in the CSF&nbsp;&rarr;<strong>&nbsp;</strong>stimulation of central chemoreceptors</li>\n</ul>\n<p><strong>Option a :</strong> <strong>Decreased</strong>&nbsp;arterial <strong>Pco</strong><sub><strong>2</strong>&nbsp;</sub><strong>doesnt</strong> stimulate chemoreceptors. It is increased Pco<sub>2</sub> that stimulates central chemoreceptors.</p>\n<p><strong>Option b :</strong> <strong>Decreased</strong> arterial <strong>Po<sub>2</sub></strong> stimulates peripheral chemoreceptors but has <strong>no influence</strong> on central chemoreceptors.</p>\n<p><strong>Option d :</strong> <strong>&nbsp;Increased </strong>(not decreased)<strong> H<sup>+</sup></strong> ions stimulate both peripheral and central chemoreceptors.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following do not stimulate either central or peripheral chemoreceptors?",
    "choices": [
      {
        "id": 1,
        "text": "Hypocapnia"
      },
      {
        "id": 2,
        "text": "Hypoxia"
      },
      {
        "id": 3,
        "text": "Acidosis"
      },
      {
        "id": 4,
        "text": "Low perfusion pressure"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Hypercapnia is a stimulus</strong> for central and peripheral chemoreceptors and <strong>not hypocapnia.</strong></p>\n<p><strong>Option b:</strong> The <strong>peripheral chemoreceptors are stimulated</strong>\u00a0by hypoxia (hypoxic, stagnant and histotoxic but NOT anemic hypoxia)and exercise (increased K<sup>+</sup> levels).</p>\n<p><strong>Option c:</strong> The <strong>central chemoreceptors are stimulated</strong> by hypercapnia and resultant acidosis.</p>\n<p><strong>Option d:</strong> Low perfusion pressure produces hypoxia because the amount of O<sub>2 </sub>delivered to the receptors per unit time is decreased. This <strong>stimulates the peripheral chemoreceptors.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The most important stimulus controlling the level of resting ventilation is_____",
    "choices": [
      {
        "id": 1,
        "text": "pH of CSF on central chemoreceptors"
      },
      {
        "id": 2,
        "text": "pH on peripheral chemoreceptors"
      },
      {
        "id": 3,
        "text": "Pco2 on peripheral chemoreceptors"
      },
      {
        "id": 4,
        "text": "Po2 on peripheral chemoreceptors"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The most important stimulus comes from the <strong>pH of the CSF on the central chemoreceptors.&nbsp;</strong>The CO<sub>2</sub> that enters the brain and CSF is hydrated to H<sub>2</sub>CO<sub>3</sub> and dissociates, leading to rising H<sup>+</sup> levels. The CSF H<sup>+</sup> concentration hence <strong>parallels</strong> the arterial CO<sub>2</sub> levels.</p>\n<p>The effect of pO<sub>2</sub> on peripheral chemoreceptors under normoxic conditions is very small. Changes in pCO<sub>2</sub> do affect the peripheral chemoreceptors, but the magnitude is less than that for the central chemoreceptors.</p>\n<p>The effect of changes in the pH on peripheral chemoreceptors under normal conditions is small: and the changes in pO<sub>2</sub> do not affect the central chemoreceptors.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following occurs after hyperventilation with 6% CO2 in inspired air?",
    "choices": [
      {
        "id": 1,
        "text": "Continued hyperventilation"
      },
      {
        "id": 2,
        "text": "Apnoea"
      },
      {
        "id": 3,
        "text": "Cheyne- Stokes breathing"
      },
      {
        "id": 4,
        "text": "Kussmaul\u2019s breathing"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Hyperventilation with 6% CO<sub>2</sub> is followed by <strong>continued hyperventilation till alveolar Pco<sub>2</sub> drops towards normal</strong>.</p>\n<p><strong>Ventilatory responses to CO<sub>2</sub></strong></p>\n<p>There is a linear relationship between increase in % of CO<sub>2</sub>&nbsp;in inspired air and respiratory minute volume.</p>\n<ul>\n<li>The <strong>upper limit for this linearity is 6% of alveolar PCO<sub>2</sub>.</strong></li>\n<li>When the CO<sub>2 </sub>content of the inspired gas is <strong>&gt;7%</strong>, the alveolar and the arterial PCO<sub>2</sub> begin to rise abruptly in spite of hyperventilation leading to hypercapnia.\n<ul>\n<li>Hypercapnia depresses the central nervous system, including respiratory centers leading to <strong>CO<sub>2</sub> narcosis</strong> (a headache, confusion and eventually coma).</li>\n</ul>\n</li>\n</ul>\n<p><strong>Mechanism:</strong></p>\n<p>Increased CO2 in inspired air<strong> &rArr; </strong>Increased Alveolar PCO2<strong>&nbsp;&rArr; </strong>Increased arterial PCO2<strong>&nbsp;&rArr;&nbsp;</strong>Stimulation of central chemoreceptors&nbsp;<strong>&rArr;&nbsp;</strong>&nbsp; Stimulation of ventilation&nbsp;<strong>&rArr;</strong>&nbsp;Alveolar PCO2 drops toward normal</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is true about the ventilatory response?",
    "choices": [
      {
        "id": 1,
        "text": "CO2 major factor controlling the normal level of ventilation"
      },
      {
        "id": 2,
        "text": "Is not related to respiratory minute volume"
      },
      {
        "id": 3,
        "text": "Depends only on central chemoreceptors"
      },
      {
        "id": 4,
        "text": "Is increased if alveolar PO2 is raised"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The <strong>normal level of ventilation</strong> is <strong>controlled by the ventilatory response to CO<sub>2</sub>.</strong></p>\n<p><strong>Option b: </strong>There is linear relationship between respiratory minute volume and the alveolar Pco<sub>2</sub>, i.e. as alveolar Pco<sub>2</sub> increases respiratory minute volume increases.</p>\n<p><strong>Option c:&nbsp;</strong>The ventilatory response depends on peripheral chemoreceptors in addition to central chemoreceptors.</p>\n<p><strong>Option d:&nbsp;</strong>The ventilatory response to CO<sub>2</sub> is increased if the alveolar PO<sub>2</sub> is reduced</p>\n<p>The ventilatory response is reduced also during sleep.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Hering-Breuer reflexes are mediated by ____________ .",
    "choices": [
      {
        "id": 1,
        "text": "Slowly adapting myelinated vagal fibers"
      },
      {
        "id": 2,
        "text": "Rapidly adapting myelinated vagal fibres"
      },
      {
        "id": 3,
        "text": "Unmyelinated pulmonary C fibers"
      },
      {
        "id": 4,
        "text": "Unmyelinated bronchial C fibers"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Hering-Breuer reflexes&nbsp;</strong>are mediated by <strong>slowly adapting</strong> pulmonary stretch receptors and the impulses travel in the <strong>vagus nerve</strong> via <strong>large myelinated fibers.</strong></p>\n<p><strong>Hering-Breuer inflation reflex</strong>: \"Prolonged inspiration inhibits further inspiration\"</p>\n<ul>\n<li>Hyperinflation of lungs stimulates<strong>&nbsp;slowly adapting pulmonary stretch receptors</strong> and the impulses travel in the vagus nerve via <strong>large myelinated fibers.</strong></li>\n<li>This signal <strong>inhibits</strong> the <strong>inspiratory ramp signals</strong> of the <strong>dorsal respiratory group of neurons</strong> (DRG), thus, inspiration is quickly inhibited and expiration follows.</li>\n<li>Advantages of Hering-Breuer inflation reflex: It cuts down the inspiration time, and therefore,\n<ul>\n<li>It prevents overinflation of the lungs.</li>\n<li>Lungs operate at lower lung volumes, thereby preventing wastage of energy.</li>\n</ul>\n</li>\n<li>The Hering-Breuer reflex is activated when the lung volume increases to more than three times the normal tidal volume (tidal volume = 0.5 liters/breath; So, lung volume <strong>&gt; 1.5 liters</strong> per breath activates the reflex).</li>\n<li>It signifies that the reflex plays a protective&nbsp;role preventing the overinflation of the lung rather than regulating the normal ventilation.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "All of the following statements about Hering-Breuer inflation reflex are true except_____",
    "choices": [
      {
        "id": 1,
        "text": "The impulses travel to the brain via vagus nerve"
      },
      {
        "id": 2,
        "text": "It results in further inspiratory efforts if the lung is maintained inflated"
      },
      {
        "id": 3,
        "text": "It is seen in adults at high tidal volumes"
      },
      {
        "id": 4,
        "text": "Abolishing the reflex in many animals causes slow deep breathing"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Hering-Breuer inflation reflex inhibits further inspiratory efforts</strong> if the lungs are maintained inflated.</p>\n<p><strong>Mechanism</strong>- Stretch receptors&nbsp;<strong>&rArr;</strong> Vagus&nbsp;<strong>&rArr;</strong> Inhibit Dorsal Respiratory Group&nbsp;<strong>&rArr;</strong> Phrenic &amp; Intercostal Nerves&nbsp;<strong>&rArr;</strong>&nbsp;Inspiration shortened, Expiration prolonged</p>\n<p><strong>Option a:</strong> The impulses <strong>travel to the brain via the vagus nerve.</strong></p>\n<p><strong>Option c:</strong> HB Reflex activated when TV &gt; 1.5L. The reflex is seen in adults at high tidal volumes.</p>\n<p><strong>Option d:</strong> Abolishing the reflex by cutting the vagal nerves in experimental animals causes slow deep breathing.</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is true about Head\u2019s paradoxical reflex?",
    "choices": [
      {
        "id": 1,
        "text": "Inhibits respiration"
      },
      {
        "id": 2,
        "text": "Stimulated by hyperinflation of lung"
      },
      {
        "id": 3,
        "text": "Plays an important role in normal respiration"
      },
      {
        "id": 4,
        "text": "Mediated by tracheobronchial stretch receptors"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Head&rsquo;s paradoxical reflex</strong>&nbsp;is stimulated by <strong>hyperinflation of lungs</strong>. It refers to <strong>p</strong><strong>rolonged inspiration stimulating further inspiration</strong>. Hyperinflation of the lungs causes strong and long-lasting inspiratory effort (an effect <strong>opposite</strong> to the <strong>Hering-Breuer inflation reflex</strong>).</p>\n<p><strong>Physiological role:</strong></p>\n<ul>\n<li>Occasional deep breaths which are thought to counteract any tendency to atelectasis in quiet breathing and possibly in reinforcing the gasps or inspiratory efforts.</li>\n<li>First cry after birth.</li>\n<li>The possible explanation for this could be the <strong>inhibition of vagus nerve at cold temperatures</strong> (due to the presence of pulmonary fluid in the unaerated newborn lungs).</li>\n<li>Lack of inhibitory impulses from the pulmonary stretch receptors and vagus has an effect opposite to Hering-Breuer&rsquo;s inflation reflex.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The immediate response of J receptor stimulation is",
    "choices": [
      {
        "id": 1,
        "text": "Tachycardia"
      },
      {
        "id": 2,
        "text": "Hypertension"
      },
      {
        "id": 3,
        "text": "Tachypnoea"
      },
      {
        "id": 4,
        "text": "Apnoea"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The <strong>immediate</strong> reflex response of J receptor stimulation is <strong>apnea. </strong>It is <strong>followed by</strong> rapid breathing, bradycardia, and hypotension (pulmonary chemoreflex).</p>\n<p>Juxtacapillary receptors are the C fiber endings located close to the pulmonary vessels in the alveolar interstitium. They are not involved in quiet or normal respiration. They are stimulated by&nbsp;</p>\n<ul>\n<li>Hyperinflation of the lung</li>\n<li>Intravenous or intracardiac administration of chemicals like capsaicin P</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Moderate exercise being one of the most powerful stimulators of ventilation works by the way of_____",
    "choices": [
      {
        "id": 1,
        "text": "Low arterial PO2"
      },
      {
        "id": 2,
        "text": "Low PO2 in mixed venous blood"
      },
      {
        "id": 3,
        "text": "Low arterial pH"
      },
      {
        "id": 4,
        "text": "None of the above"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Moderate exercise does not reduce the arterial Po<sub>2</sub>, increase the arterial Pco<sub>2</sub>, or reduce the arterial pH.&nbsp;</p>\n<p>Option <strong>A:</strong> The brain, upon transmitting motor impulses to the exercising muscles, is believed to transmit collateral impulses into the brainstem at the same time to <strong>excite the respiratory center</strong>. This action is analogous to the stimulation of the vasomotor center of the brain stem during exercise that causes a simultaneous increase in arterial pressure.</p>\n<p>Option<strong> B:&nbsp;</strong>The Po<sub>2</sub> of mixed venous blood does fall, but there are <strong>no known chemoreceptors</strong> that are stimulated as a result.</p>\n<p>Option<strong>&nbsp;C:</strong>&nbsp;</p>\n<p>Two points are important regarding pH during moderate exercise:</p>\n<ul>\n<li><strong>pH = pK+ log ([HCO<sub>3</sub>-)/ [CO<sub>2</sub>])&nbsp;</strong>\n<ul>\n<li>The&nbsp;pH of the blood is dependent only on the <strong>ratio </strong>of the amount of CO<sub>2</sub> to the amount of HCO<sub>3</sub>-. The concentrations of both buffer components (HCO<sub>3</sub>- and CO<sub>2</sub>) are very large compared to the amount of H+ added to the blood during moderate exercise. Thus, any change in HCO<sub>3</sub>- due to the addition of H+ during moderate exercise is very tiny compared to the amount of HCO<sub>3</sub>- already present in the blood. Thus, the pH of blood during moderate exercise remains constant.</li>\n</ul>\n</li>\n</ul>\n<ul>\n<li>&nbsp;When sufficient oxygen&nbsp;is not available during exercise, there is increased accumulation of lactic acid, which initially leads to an increase in PaCO<sub>2</sub>. However, this is counteracted by the stimulation of ventilation and as a result, <strong>PaCO<sub>2</sub> is decreased</strong>. This provides some respiratory compensation for further lactic acid production and prevents a decline in blood&nbsp;pH. Thus, blood<strong> pH remains constant</strong> in moderate exercise.</li>\n</ul>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The exercise-induced hyperventilation during vigorous exercise is produced due to the receptors present in ______",
    "choices": [
      {
        "id": 1,
        "text": "Medulla oblongata"
      },
      {
        "id": 2,
        "text": "Lung parenchyma"
      },
      {
        "id": 3,
        "text": "Carotid bodies"
      },
      {
        "id": 4,
        "text": "Trachea and large bronchi"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The exercise-induced hyperventilation during <strong>vigorous</strong> exercise is produced due to the receptors present in <strong>carotid bodies.</strong></p>\n<div class=\"page\" title=\"Page 679\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<div class=\"page\" title=\"Page 679\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>When exercise becomes more vigorous, buffering of the increased amounts of lactic acid that are produced liberates more CO<sub>2</sub>, and this further increases ventilation. The additional increase in ventilation produced by the acidosis depends on the carotid bodies and does not occur if they are removed.&nbsp;</p>\n</div>\n</div>\n</div>\n</div>\n<p><strong>Note</strong>:&nbsp; The abrupt increase at the<strong> start of exercise</strong> is presumably due to psychic stimuli and afferent impulses from proprioceptors in muscles, tendons, and joints.</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In moderate exercise, the respiratory rate is increased at the beginning due to the response of______",
    "choices": [
      {
        "id": 1,
        "text": "J receptor stimulation"
      },
      {
        "id": 2,
        "text": "Decrease in PO2 in arterial blood"
      },
      {
        "id": 3,
        "text": "Increased PCO2 in arterial blood"
      },
      {
        "id": 4,
        "text": "Joint proprioceptor stimulation"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The <strong>abrupt increase at the start of exercise</strong> is presumably due to</p>\n<ul>\n<li>Psychic stimuli</li>\n<li>Afferent impulses from proprioceptors in muscles, tendons, and joints.</li>\n</ul>\n<p>The <strong>more gradual increase</strong>&nbsp;in ventilation is presumably due to</p>\n<ul>\n<li>Increase in O<sub>2</sub> consumption (Proportional increase)</li>\n<li>Increase in body temperature</li>\n<li>Increases in the plasma K+ level (Stimulate the peripheral chemoreceptors).</li>\n<li>Sensitivity of the neurons controlling the response to CO<sub>2</sub> is increased or that the respiratory fluctuations in arterial PCO<sub>2</sub> increase so that, even though the mean arterial PCO<sub>2</sub> does not rise, it is CO<sub>2</sub> that is responsible for the increase in ventilation.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which among the following is not a function of pneumotaxic centre ?",
    "choices": [
      {
        "id": 1,
        "text": "Limitation of inspiration"
      },
      {
        "id": 2,
        "text": "Increase in the rate of breathing"
      },
      {
        "id": 3,
        "text": "Switching off the inspiratory ramp"
      },
      {
        "id": 4,
        "text": "Generating respiratory rhythm"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Respiratory rhythm generation is a function of <strong>dorsal respiratory group of neurons</strong>&nbsp;(and not pneumotaxic center).</p>\n<p>Pneumotaxic center:</p>\n<ul>\n<li>It is located dorsally in the nucleus parabrachialis of the upper pons and it transmits signals to the inspiratory area.</li>\n<li>Primary effect of this center is to control the switch&shy;off point of the inspiratory ramp, thus controlling the duration of the filing phase of the lung cycle.</li>\n<li>Function of the pneumotaxic center is primarily to limit inspiration, which has a secondary effect of increasing the rate of breathing, because limitation of inspiration also shortens expiration and the entire period of each respiration.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following ions is involved in peripheral oxygen sensing chemoreceptors?",
    "choices": [
      {
        "id": 1,
        "text": "Potassium"
      },
      {
        "id": 2,
        "text": "Calcium"
      },
      {
        "id": 3,
        "text": "Sodium"
      },
      {
        "id": 4,
        "text": "Chlorine"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Potassium</strong> is involved in peripheral oxygen sensing chemoreceptors.</p>\n<p>Type I glomus cells (carotid and aortic body) have <strong>O<sub>2</sub>-sensitive K<sup>+</sup> channels</strong>, whose <strong>conductance is reduced</strong> in proportion to the degree of hypoxia.</p>\n<p>This <strong>reduces the K<sup>+</sup> efflux,</strong> depolarizing the cell and <strong>causing Ca<sup>2+</sup> in\ufb02ux.</strong></p>\n<p>The<strong> Ca<sup>2+</sup> influx</strong> triggers action potentials and consequent<strong> excitation of the afferent nerve endings.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following neurons predominantly fire during forceful expiration?",
    "choices": [
      {
        "id": 1,
        "text": "Dorsal group of neurons"
      },
      {
        "id": 2,
        "text": "Ventral group of neurons"
      },
      {
        "id": 3,
        "text": "Pneumotaxic center"
      },
      {
        "id": 4,
        "text": "Chemoreceptors"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Ventral groups of neurons</strong> fire, when<strong> forceful expiration</strong> is needed like during heavy exercise.</p>\n<p>Dorsal group of neurons control the normal inspiration and expiration.</p>\n<p>Pneumotaxic center limits the duration of inspiration.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '25 Regulation Of Respiration';
        let hierarchy = ["Marrow", "qBank", "Physiology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>