<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>13 Glaucoma - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Ophthalmology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">35</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "What is the normal aqueous production rate?",
    "choices": [
      {
        "id": 1,
        "text": "2 mL/min"
      },
      {
        "id": 2,
        "text": "5 mL/ min"
      },
      {
        "id": 3,
        "text": "2 \u03bcL/ min"
      },
      {
        "id": 4,
        "text": "5 \u03bcL/ min"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The rate of formation of aqueous humor is <strong>2-3 \u03bcL/min</strong>.<strong>\u00a0 </strong></p>\n<p>Formation of aqueous humor involves the following:<strong>\u00a0</strong></p>\n<ul>\n<li><strong>Ultrafiltration</strong></li>\n<li><strong>Secretion-</strong>\u00a0Na/K ATPase of non-pigmented epithelium of the ciliary process</li>\n<li><strong>Diffusion</strong></li>\n</ul>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the critical angle of the air-cornea interface?",
    "choices": [
      {
        "id": 1,
        "text": "46 degrees"
      },
      {
        "id": 2,
        "text": "64 degrees"
      },
      {
        "id": 3,
        "text": "24 degrees"
      },
      {
        "id": 4,
        "text": "36 degrees"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The <strong>critical angle</strong> of the air\u2013cornea interface is <strong>46 degrees.\u00a0</strong><strong>Gonioscopy</strong> is a method of <strong>evaluating</strong> the <strong>anterior chamber (AC) angle.</strong></p>\n<p><strong>Direct goniolenses</strong> include the Koeppe, Medical Workshop, Barkan, and Swan\u2013Jacob.\u00a0<strong>Indirect goniolenses</strong> include Goldmann, Zeiss,\u00a0and Posner.</p>\n<p>Structures seen on gonioscopy from anterior to posterior are:\u00a0</p>\n<ul>\n<li><strong>Schwalbe\u00a0line:</strong>\u00a0represents the\u00a0posterior limit of Descemet's membrane</li>\n<li>Trabecular meshwork</li>\n<li>Scleral spur</li>\n<li>Ciliary body and root of the\u00a0iris</li>\n</ul>\n<p><strong>Shaffers grading</strong> of angle width:</p>\n<p><strong>Grade</strong> <strong>4</strong> (35\u201345\u00b0) is the <strong>widest angle,</strong> characteristic of <strong>myopia</strong> and <strong>pseudophakia;</strong> the ciliary body can be visualized without tilting the lens.<br /><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">Grade 3</strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> (25\u201335\u00b0) is an open-angle in which the </span><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">scleral spur</strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> is visible.<br /></span><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">Grade 2</strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> (20\u00b0) is an angle in which the </span><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">trabeculum</strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> but not the scleral spur can be seen.<br /></span><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">Grade 1</strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> (10\u00b0) is a very narrow-angle in which </span><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">only</strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> the </span><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">Schwalbe line,</strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> and perhaps the top of the trabeculum, can be identified.<br /></span><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">A slit angle</strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> is one in which there is no obvious iridocorneal contact but no angle structures can be identified.<br /></span><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">Grade 0</strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> (0\u00b0) is</span><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> closed</strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> due to </span><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">iridocorneal contact.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/07c64a6436474c13b1f821debddbb30fx1280x1300.JPEG"
    ]
  },
  {
    "text": "Which statement regarding the depth of the anterior chamber is false?",
    "choices": [
      {
        "id": 1,
        "text": "Depth is less in women than men"
      },
      {
        "id": 2,
        "text": "Depth increases with age"
      },
      {
        "id": 3,
        "text": "Depth is more in myopes"
      },
      {
        "id": 4,
        "text": "Depth is less in hypermetropes"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>depth</strong> of the anterior chamber <strong>decreases</strong> with <strong>age.</strong>\u00a0</p>\n<p>Anterior chamber depth</p>\n<ul>\n<li>The anterior chamber is <strong>shallow</strong> in <strong>very young</strong> and in old <strong>age.</strong></li>\n<li>At other periods of life, it is normally about 2.5 mm<strong>\u00a0deep</strong>.</li>\n<li>Depth is <strong>less</strong> in <strong>women</strong> than in men.</li>\n<li>Depth is <strong>more</strong> in <strong>myopes.</strong></li>\n<li>Depth is <strong>less</strong> in <strong>hypermetropia</strong> and in <strong>angle-closure glaucoma</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The child in the picture has large corneas, photophobia, and lacrimation. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Congenital glaucoma"
      },
      {
        "id": 2,
        "text": "Retinoblastoma"
      },
      {
        "id": 3,
        "text": "Congenital hereditary endothelial dystrophy"
      },
      {
        "id": 4,
        "text": "Megalocornea"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<div class=\"page\" title=\"Page 862\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Option C:\u00a0<strong>Congenital hereditary endothelial dystrophy </strong>(CHED) is an inherited corneal dystrophy that manifests since <strong>birth</strong> with <strong>endothelial degeneration</strong>. It appears as diffuse <strong>bilateral corneal edema</strong> in the <strong>absence</strong> of <strong>elevated</strong> IOP. The clinical features of the disease include corneal clouding, visual impairment, and nystagmus.</p>\n<p>Option D:<strong> Megalocornea\u00a0</strong>is a bilateral non-progressive <strong>X-linked</strong> condition that most commonly affects <strong>males</strong>. In this condition, the horizontal <strong>corneal diameter</strong>\u00a0is\u00a0<strong>\u226512mm</strong>(&lt;2 years)\u00a0and\u00a0is <strong>\u226513 mm</strong>(&gt;2 years). It is characterized by a clear\u00a0cornea, normal corneal thickness, and <strong>n</strong><strong>o breaks</strong> in the descemet's membrane. Systemic associations of Megalocornea include Marfan's syndrome, Apert syndrome, Ehlers-Danlos, and Down syndrome.</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/f1a97152fe6549f19cc21f8e764580a6.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/cfce3f20b960443dbba4d7a8b4c3bbc8x720x331.PNG"
    ]
  },
  {
    "text": "A neonate is brought with complaints of photophobia and watering. Clinical examination shows normal tear passages and clear but large cornea. Investigation reveals Haab\u2019s striae seen in the eye. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Buphthalmos"
      },
      {
        "id": 2,
        "text": "Keratoconus"
      },
      {
        "id": 3,
        "text": "Trachoma"
      },
      {
        "id": 4,
        "text": "Keratoglobus"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Note: <strong>Vogt's striae</strong>\u00a0are <strong>vertical</strong>,\u00a0fine, whitish lines (folds/tears) in Descemet's membrane commonly found in patients with <strong>keratoconus</strong>.</p>\n<p>The image given below shows Vogt's striae.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://cdn1.dailyrounds.org/uploads/8c94f464a48143879195b4489a6d0fcfx268x188.JPEG",
      "https://cdn1.dailyrounds.org/uploads/b77dc64f6e124e929988a7a9e807a8a6x638x351.JPEG",
      "https://cdn1.dailyrounds.org/uploads/a6f9a4a76c784bc69dc3947ea936998ex246x205.JPEG"
    ]
  },
  {
    "text": "A patient presents to the clinic for a change of her presbyopic glasses. This is the third time that she is coming in 2 months. What is the likely underlying diagnosis in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Senile cataract"
      },
      {
        "id": 2,
        "text": "Retinal detachment"
      },
      {
        "id": 3,
        "text": "Intumescent cataract"
      },
      {
        "id": 4,
        "text": "Open-angle glaucoma"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Frequent changes</strong> in <strong>presbyopic glasses </strong>in this patient is a symptom of<strong>\u00a0open-angle glaucoma</strong> (OAG).</p>\n<p>This is due to increasing accommodative failure as a result of constant pressure on the ciliary muscle and nerve supply.</p>\n<p>In intumescent cataracts, patients report difficulty with distance vision and frequent change of spectacle prescription. However, it is not associated with frequent changes of presbyopic glasses.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Normal cup-to-disc ratio is up to_______.",
    "choices": [
      {
        "id": 1,
        "text": "0.6"
      },
      {
        "id": 2,
        "text": "0.4"
      },
      {
        "id": 3,
        "text": "0.5"
      },
      {
        "id": 4,
        "text": "0.3"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Normal cup-to-disc ratio is<strong> up to 0.6</strong>. Although the average cup-to-disc ratio is around 0.3 to 0.4, a ratio of up to 0.6 may be found in healthy individuals. This larger ratio is frequently seen in cases of large discs, myopic discs or physiological cupping. A cup-to-disc ratio of &gt; 0.6 is suggestive of&nbsp;<strong data-stringify-type=\"bold\">glaucoma</strong>.<br /><br /><br /></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 61-year-old man, who is a known case of diabetes mellitus, presents with headache and eye pain. He also reports difficulty with driving at night. Examination showed a laminar dot sign. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Uveitis"
      },
      {
        "id": 2,
        "text": "Glaucoma"
      },
      {
        "id": 3,
        "text": "Retinal detachment"
      },
      {
        "id": 4,
        "text": "ARMD"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario of a patient with headache and eye pain along with the finding of a <strong>laminar dot sign</strong> is suggestive of glaucoma.</p>\n<p>The laminar dot sign is an <strong>advanced</strong> <strong>glaucomatous</strong> change in the <strong>optic disc. </strong>This occurs because the pores in the lamina cribrosa are slit-shaped and are visible up to the margin of the disc.</p>\n<p>Glaucomatous changes in the optic disc</p>\n<p><strong>Early</strong> glaucomatous changes:</p>\n<ul>\n<li>Slit defects of the retinal nerve fiber layer</li>\n<li><strong>Splinter</strong> hemorrhages on disc margin</li>\n<li>Large cup - 0.7 or more</li>\n<li>Asymmetry of the cups: A difference equal to or more than 0.2 between two eyes is significant</li>\n<li>Vertically oval cup</li>\n</ul>\n<p><strong>Advanced</strong> glaucomatous changes:</p>\n<ul>\n<li>Marked cupping (<strong>Beanpot</strong> cupping)</li>\n<li>Thinning of neuroretinal rim</li>\n<li><strong>Bayonetting</strong> sign - Sharp angulation of vessel at the margin of the excavated cup</li>\n<li>Laminar dot sign</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the last visual field to be affected in glaucoma?",
    "choices": [
      {
        "id": 1,
        "text": "Nasal"
      },
      {
        "id": 2,
        "text": "Inferior"
      },
      {
        "id": 3,
        "text": "Superior"
      },
      {
        "id": 4,
        "text": "Temporal"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The <strong>temporal visual field</strong> is the <strong>last field</strong> to be affected in glaucoma.</p>\n<p>The <strong>pattern</strong> of <strong>visual field progression</strong> in glaucoma from early to severe is predictable in light of the pattern of thinning of the retinal nerve fiber layer, which usually begins with the <strong>superior</strong> and <strong>inferior arcuate fibers,</strong> then the <strong>papillomacular bundle</strong> and finally, the<strong> nasal fibers</strong>.</p>\n<p>Since the nasal fibers are the last to be involved, the temporal field is the last to be affected in glaucoma.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is a late visual field defect in open-angle glaucoma?",
    "choices": [
      {
        "id": 1,
        "text": "Siedel scotoma"
      },
      {
        "id": 2,
        "text": "Bjerrum scotoma"
      },
      {
        "id": 3,
        "text": "Paracentral scotoma"
      },
      {
        "id": 4,
        "text": "Baring of blind spot"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<table style=\"height: 207px; width: 353px;\">\n<tbody>\n<tr style=\"height: 88px;\">\n<td style=\"width: 102.219px; height: 88px;\">Early non-specific changes</td>\n<td style=\"width: 222.219px; height: 88px;\">\n<ul>\n<li><strong>Isopter contraction</strong></li>\n<li><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">Baring</strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> of a </span><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">blind spot:</strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> Exclusion of blind spot from the central field</span></li>\n</ul>\n</td>\n</tr>\n<tr style=\"height: 118px;\">\n<td style=\"width: 102.219px; height: 118px;\">Early significant changes</td>\n<td style=\"width: 222.219px; height: 118px;\">\n<ul>\n<li><strong>Peripheral nasal step</strong> (may be early or late)</li>\n<li><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">Paracentral scotoma </strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">in Bjerrum's area.</span></li>\n<li><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">Siedel\u2019s\u00a0 scotoma:</strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> Paracentral scotoma joins the blind spot</span></li>\n</ul>\n</td>\n</tr>\n<tr style=\"height: 128px;\">\n<td style=\"width: 102.219px; height: 128px;\">Late significant changes</td>\n<td style=\"width: 222.219px; height: 128px;\">\n<ul>\n<li><strong>Arcuate</strong> or <strong>Bjerrum scotoma</strong></li>\n<li><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">Ring</strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> or </span><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">Double</strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> arcuate scotoma: When 2 arcuate scotomas join together</span></li>\n<li><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">Roenne\u2019s central nasal step</strong></li>\n</ul>\n</td>\n</tr>\n<tr style=\"height: 78px;\">\n<td style=\"width: 102.219px; height: 78px;\">\n<p>Advanced glaucomatous field defects</p>\n</td>\n<td style=\"width: 222.219px; height: 78px;\">\n<ul>\n<li><strong>Tubular vision</strong></li>\n<li>No light perception:\u00a0Complete visual field defect.</li>\n</ul>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 70-year-old patient presents with progressive deterioration of vision. The pupillary reaction is sluggish and the IOP is elevated. Fundoscopy shows a large and deep cup and the visual field reveals paracentral scotoma. What is the first line of treatment for this diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Timolol"
      },
      {
        "id": 2,
        "text": "Pilocarpine"
      },
      {
        "id": 3,
        "text": "Epinephrine"
      },
      {
        "id": 4,
        "text": "Carbonic anhydrase inhibitor"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario of deterioration of vision, sluggish pupils, elevated IOP and <strong>paracentral scotoma\u00a0</strong>is suggestive of <strong>primary open-angle glaucoma</strong> (POAG). <strong>Timolol</strong> is one of the first-line agents used in the treatment of primary open-angle glaucoma.</p>\n<p>First-line agents for the treatment of glaucoma are:</p>\n<ul>\n<li><strong>Prostaglandin</strong> analogs such as latanoprost and bimatoprost</li>\n<li>Topical <strong>beta-blockers</strong>\u00a0such as timolol, betaxolol, and levobunolol\u00a0</li>\n<li>Selective alpha 2 <strong>adrenergic agonist\u00a0</strong>brimonidine</li>\n</ul>\n<p>Adjunctive therapy<strong>:\u00a0</strong>Carbonic anhydrase inhibitors</p>\n<p>Laser trabeculoplasty:\u00a0In cases where intraocular pressure (IOP) is uncontrolled despite maximal tolerated medical therapy.</p>\n<p>Note: Since prostaglandin (PG) analogs are not included in the options, the next best option to choose is timolol.</p>\n<p>Historically, beta-blockers were the most common first-line agents used in the medical treatment of POAG. However, with an increase in our experience with newer agents, specifically the <strong>prostaglandin analogues</strong> that facilitate outflow, they were recognized as being more efficacious in lowering IOP and systemically safer than beta-blockers. As a result, now they are the <strong>first-line agents</strong> in glaucoma treatment.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient with a known case of MI on aspirin comes with shortness of breath. She has an active history of asthma and uses inhalational bronchodilators, her last attack was 7 months ago. She was recently prescribed medications for increased intraocular pressure. What is the likely cause of her current symptoms?",
    "choices": [
      {
        "id": 1,
        "text": "Aspirin"
      },
      {
        "id": 2,
        "text": "Betaxolol"
      },
      {
        "id": 3,
        "text": "Latanoprost"
      },
      {
        "id": 4,
        "text": "Timolol"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<div class=\"ng-scope\">\n<div class=\"ng-scope\">\n<p class=\"ng-binding\">This patient with a history of <strong>asthma</strong> now presenting with <strong>shortness</strong> of <strong>breath</strong> after starting medications for increased intraocular pressure was most likely diagnosed with <strong>glaucoma.</strong> The drug she was likely prescribed was <strong>timolol,</strong> a non-selective beta blocker.</p>\n<p class=\"ng-binding\">Timolol\u00a0is a<strong>\u00a0</strong>non-selective beta-blocker\u00a0that is used in glaucoma<strong>.\u00a0</strong>Non-selective beta-blockers can cause <strong>precipitation</strong> of <strong>bronchial</strong> asthma in susceptible individuals (beta-2 block on bronchi). They cause <strong>bronchospasms</strong> and are therefore\u00a0<strong>contraindicated</strong> in patients with\u00a0<strong>asthma\u00a0</strong>(e.g. timolol, levobunolol). Ocular beta-blockers\u00a0reduce intraocular pressure by\u00a0<strong>decreasing aqueous formation\u00a0</strong>by\u00a0<strong>blockade</strong> of <strong>\u03b2<sub>2</sub> receptors. </strong>Timolol is specifically associated with <strong>allergic blepharoconjunctivitis</strong> and punctal <strong>stenosis</strong></p>\n<p>Side effects: Systemic: Bronchospasm, bradycardia, decreased cardiac output, hypotension, depression, impotence, and altered lipid profile.</p>\n<p>Contraindications: Asthma, chronic obstructive pulmonary disease, congestive heart failure, sinus bradycardia, and atrioventricular blocks</p>\n<p>Other options:</p>\n<p>Option A: The patient has been stable on aspirin for the past three years which is unlikely to be the cause of her current symptoms.\u00a0</p>\n<p>Option B: Betaxolol is a beta 1 selective blocker that is used in glaucoma and has a lower propensity to precipitate bronchial asthma.\u00a0</p>\n<p>Option C: Latanoprost is a prostaglandin (PGF2 alpha) analog and does not precipitate bronchial asthma.\u00a0</p>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "As a first-year ophthalmology resident, you have been referred a case of glaucoma. He complaints that his current medication is causing excessive drowsiness and is interfering with his work. Which of the following anti-glaucoma medications can cause drowsiness?",
    "choices": [
      {
        "id": 1,
        "text": "Latanoprost"
      },
      {
        "id": 2,
        "text": "Brimonidine"
      },
      {
        "id": 3,
        "text": "Timolol"
      },
      {
        "id": 4,
        "text": "Dorzolamide"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Brimonidine</strong>\u00a0is an anti-glaucoma medication that can cause drowsiness.</p>\n<p>It\u00a0is a <strong>selective alpha-2</strong> <strong>agonist</strong>. It can cross the blood-brain barrier and, hence, causes <strong>drowsiness</strong> and <strong>CNS depression</strong>; it is\u00a0<strong>contraindicated</strong> in <strong>infants</strong> and <strong>children</strong>.</p>\n<p>A new class of glaucoma drugs, <strong>Rho kinase (ROCK) inhibitors</strong>, promises to act specifically on the trabecular meshwork, a main outflow and blockage site in glaucoma.\u00a0<span class=\"caps\">ROCK\u00a0</span>inhibitors are not yet approved and available for glaucoma patients. Two US companies, Aerie and Altheos, are currently in early clinical research development with topical\u00a0<span class=\"caps\">ROCK\u00a0</span>inhibitors to lower\u00a0<span class=\"caps\">IOP.</span></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 55-year-old female, who is a known case of sickle cell anemia, comes to the casualty with a history of severe eye pain, redness, and diminution of vision. On examination, the visual acuity is 6/60, and there is circumcorneal congestion, corneal edema, and a shallow anterior chamber. What is the drug of choice from the given options?",
    "choices": [
      {
        "id": 1,
        "text": "Atropine ointment"
      },
      {
        "id": 2,
        "text": "Intravenous mannitol"
      },
      {
        "id": 3,
        "text": "Ciprofloxacin eye drops"
      },
      {
        "id": 4,
        "text": "Oral acetazolamide"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>This patient with complaints of severe headache, corneal congestion, and edema with a shallow anterior chamber most likely has <strong>acute angle closure glaucoma.</strong> Since this patient has a past history of <strong>sickle cell disease,</strong> intravenous <strong>mannitol</strong> is the drug of choice for this patient</p>\n<p>Acetazolamide is contraindicated in cases of sickle-cell anemia since these drugs tend to increase sickling of erythrocytes.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 50-year-old female presents with an acute painful red-eye. An image of her eye is shown below. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Acute retrobulbar neuritis"
      },
      {
        "id": 2,
        "text": "Acute angle-closure glaucoma"
      },
      {
        "id": 3,
        "text": "Acute anterior uveitis"
      },
      {
        "id": 4,
        "text": "Severe keratoconjunctivitis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Acute primary angle-closure glaucoma&nbsp;</strong>refers to the&nbsp;occlusion of the trabecular meshwork by the peripheral iris (iridotrabecular contact [ITC]), obstructing aqueous outflow.</p>\n<p>Angle closure can be <strong>primary,</strong> when it occurs in an <strong>anatomically predisposed eye</strong>&nbsp;or <strong>secondary</strong> to another <strong>ocular</strong> or <strong>systemic factor.</strong></p>\n<p><strong>Classification:</strong></p>\n<table style=\"height: 77px; width: 449px;\">\n<tbody>\n<tr>\n<td style=\"width: 73.1042px;\"><strong>Primary angle-closure suspect (PACS)</strong></td>\n<td style=\"width: 356.896px;\">\n<ul>\n<li>Gonioscopy shows posterior meshwork ITC in three or more quadrants but no peripheral anterior synechiae (PAS).</li>\n<li>Intraocular pressure (IOP), optic disc, and visual field are normal.</li>\n<li>No PAS are seen</li>\n<li>The risk of PACG at 5 years may be around 30%.</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td style=\"width: 73.1042px;\"><strong>Primary angle closure (PAC)</strong></td>\n<td style=\"width: 356.896px;\">\n<ul>\n<li>Gonioscopy shows three or more quadrants of ITC&nbsp;with raised IOP and/or PAS or excessive pigment smudging on the TM.</li>\n<li>Normal optic disc and field.</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td style=\"width: 73.1042px;\"><strong>Primary angle-closure glaucoma (PACG)</strong></td>\n<td style=\"width: 356.896px;\">\n<ul>\n<li>ITC in three or more quadrants, with glaucomatous optic neuropathy.</li>\n<li>Optic nerve damage from an episode of severe IOP elevation, such as acute angle closure, may not appear as typical glaucomatous cupping.</li>\n</ul>\n</td>\n</tr>\n</tbody>\n</table>\n<p><strong>Symptoms:&nbsp;</strong>Pain, redness, photophobia, impaired vision, watering</p>\n<p><strong>Signs:</strong></p>\n<ul>\n<li>Corneal edema- colored halos</li>\n<li>Conjunctiva- congestion, chemosis</li>\n<li>IOP- elevated 40&ndash;70 mm Hg</li>\n<li>AC very shallow</li>\n<li>Pupil- vertically oval, mid-dilated</li>\n<li>Angle- completely closed, Grade 0</li>\n</ul>\n<p><strong>Treatment:</strong></p>\n<ul>\n<li><strong>Immediate-</strong>&nbsp;Intravenous mannitol, intravenous acetazolamide followed by oral dose, topical beta-blockers, brimonidine, latanoprost</li>\n<li><strong>Definitive-</strong>&nbsp;Laser peripheral iridotomy, filtration surgery</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/7189dcfd86cd4d9fafa2ee458f9c3f04.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 36-year-old woman develops pain in the eye after dark-room/prone-provocative test. Which of the following drugs should be avoided?",
    "choices": [
      {
        "id": 1,
        "text": "Atropine"
      },
      {
        "id": 2,
        "text": "Pilocarpine"
      },
      {
        "id": 3,
        "text": "Acetazolamide"
      },
      {
        "id": 4,
        "text": "Timolol"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Pain after dark-room prone-provocative test indicates <strong>occludable angles. </strong>Hence,\u00a0<strong>atropine</strong> is contraindicated as it is a long-acting <strong>mydriatic</strong> and can <strong>precipitate angle closure.</strong></p>\n<p><strong>Dark-room/prone-provocative test </strong>(DRPPT)<strong>-\u00a0</strong>The patient sits in a dark room, face down for <strong>one hour without sleeping</strong> (sleep induces miosis). The intraocular pressure (IOP) is checked (immediately after the test, as IOP can normalize very rapidly), and an IOP rise of <strong>8 mmHg or more </strong>is frequently considered significant.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A young female presents with sudden onset severe pain in the left eye after watching a movie. She rushes to the hospital as there is a progressive loss of vision. She has ciliary injection and a shallow anterior chamber. The pupil is semi dilated and the cornea appears oedematous. What is the procedure of choice for this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Laser iridotomy"
      },
      {
        "id": 2,
        "text": "Trabeculectomy"
      },
      {
        "id": 3,
        "text": "Trabeculotomy"
      },
      {
        "id": 4,
        "text": "Trabeculoplasty"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Various surgical and laser modalities used in glaucoma:</p>\n<p><strong>Angle-closure glaucoma:\u00a0</strong></p>\n<ul>\n<li><strong>Laser iridotomy</strong> by Nd:Yag along with prophylactic iridotomy of the other eye\u00a0\u2192\u00a0<strong>Treatment of choice</strong>.</li>\n<li>Trabeculectomy \u2192 Filtration surgery</li>\n</ul>\n<p><strong>Congenital glaucoma</strong>:\u00a0</p>\n<ul>\n<li>Goniotomy</li>\n<li>Trabeculotomy</li>\n</ul>\n<p><strong>Primary open-angle glaucoma:</strong></p>\n<ul>\n<li><strong>Laser trabeculoplasty:</strong>\u00a0Argon or diode (if not controlled medications)</li>\n<li>Trabeculectomy: Filtration surgery\u00a0(if not controlled medications)</li>\n</ul>\n<p><strong>Absolute glaucoma</strong>:</p>\n<ul>\n<li>Cyclocryotherapy</li>\n<li>Nd:Yag lasercyclo destruction</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 50-year-old male presented with progressive blurred vision, photophobia, and eye pain. On examination, there was conjunctival redness, a mid-dilated pupil, and a shallow anterior chamber in the right eye. He has been treated both medically and surgically for the condition but showed no improvement. The following procedure incorporates a device to aid drainage. Identify the device.",
    "choices": [
      {
        "id": 1,
        "text": "Ex-Press\u2122  implant"
      },
      {
        "id": 2,
        "text": "Ahmed glaucoma valve"
      },
      {
        "id": 3,
        "text": "Molteno implant"
      },
      {
        "id": 4,
        "text": "Baerveldt implant"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p class=\"p1\">The clinical vignette points to a diagnosis of glaucoma not responsive to medical treatment and trabeculectomy and the device used is an <strong>ex-Press\u2122 glaucoma implant</strong> (mini shunt).</p>\n<p class=\"p1\">It is a form of <strong>minimally invasive glaucoma surgery</strong> (MIGS) to increase aqueous drainage.</p>\n<div class=\"page\" title=\"Page 359\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Ex-PRESS glaucoma implant is a small\u00a0<strong>stainless steel</strong> device.\u00a0It is inserted under a scleral flap during a modified trabeculectomy. Complications such as hypotony are lower than with standard trabeculectomy.\u00a0</p>\n<p><strong>Glaucoma drainage devices</strong> are devices that allow aqueous outflow by establishing communication between the anterior chamber and sub-Tennon's space/sub-conjunctival space. While these devices were traditionally reserved for high-risk patients, or after trabeculectomy had failed, they are becoming increasingly popular.\u00a0</p>\n</div>\n</div>\n</div>\n</div>\n<p>The commonly used devices are as follows:</p>\n<p>1. Shunts using episcleral explants</p>\n<ul>\n<li><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">Ahmed glaucoma valve: Silicone</span></li>\n<li>Molteno implant - Polypropylene plate and silicone plate</li>\n<li>Baerveldt implant - Silicone\u00a0</li>\n</ul>\n<p class=\"p1\">2. Mini-shunts\u00a0</p>\n<ul>\n<li class=\"p1\">Ex-Press\u2122 Mini-Shunt: Stainless steel</li>\n<li class=\"p1\">iStent\u00ae - Titanium</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/2299790c723c44bd96aa842fc91ff50f.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "What is Glaukomflecken?",
    "choices": [
      {
        "id": 1,
        "text": "Acute uveitis due to glaucoma"
      },
      {
        "id": 2,
        "text": "Lens opacity due to glaucoma"
      },
      {
        "id": 3,
        "text": "Retinal detachment due to glaucoma"
      },
      {
        "id": 4,
        "text": "Corneal opacity due to glaucoma"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Glaukomflecken is <strong>anterior subcapsular lenticular</strong> opacity and a component of <strong>Vogt's triad</strong> seen in patients after an acute angle closure glaucoma attack.\u00a0</p>\n<p>The Vogt's triad comprises of:</p>\n<ul>\n<li>Glaukomflecken</li>\n<li>Patches of iris atrophy</li>\n<li>Slightly dilated nonreactive pupil</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 25-year-old patient presents with painless white eye with an intraocular pressure of 60 mmHg. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Chronic papilledema"
      },
      {
        "id": 2,
        "text": "Acute angle-closure glaucoma"
      },
      {
        "id": 3,
        "text": "Glaucomatocyclitic crisis"
      },
      {
        "id": 4,
        "text": "Acute anterior uveitis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given scenario fits the description of <strong>glaucomatocyclitic crisis</strong>.</p>\n<p>Glaucomatocyclitic crisis/<strong>Posner\u2013Schlossman</strong> Syndrome [PSS]) describes recurrent attacks of unilateral <strong>acute raised intraocular</strong> pressure (IOP) associated with mild anterior uveitis. The mechanism is thought to be acute trabeculitis, and there is evidence that infection, possibly cytomegalovirus (CMV) or <em>Helicobacter pylori</em>, may play a role.\u00a0PSS typically affects young to middle-aged adults. Males are affected more frequently than females.</p>\n<p>Signs:</p>\n<ul>\n<li>Slit-lamp biomicroscopy typically shows a few anterior chamber cells and one to several fine white central keratic precipitates.</li>\n<li>Mydriasis is common; posterior synechiae are not a feature.</li>\n<li>IOP is typically raised to over 40 mmHg, out of proportion to iritis severity.</li>\n<li>Gonioscopy shows an open-angle.</li>\n</ul>\n<p>Treatment:</p>\n<ul>\n<li>Topical steroids are used to control inflammation, with aqueous suppressants to lower the IOP.</li>\n<li>Topical or oral non-steroidal anti-inflammatory agents may also be beneficial.</li>\n</ul>\n<p><strong>Note:</strong> In PSS, the rise in IOP is out of proportion to the pain felt. There is often a mild discomfort and pain may even be absent.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An ophthalmologist evaluating a patient with glaucoma identifies the following finding on slit-lamp examination. What is the finding?",
    "choices": [
      {
        "id": 1,
        "text": "Ferry line"
      },
      {
        "id": 2,
        "text": "Fleischer ring"
      },
      {
        "id": 3,
        "text": "Hudson-Stahli line"
      },
      {
        "id": 4,
        "text": "Krukenberg spindles"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Pigmentary glaucoma\u00a0is an open-angle glaucoma having the following features:</p>\n<ul>\n<li>Krukenberg spindles</li>\n<li>Gonioscopy shows <strong>pigment accumulation</strong> along the <strong>Schwalbe line</strong> inferiorly, and this accumulation is called the <strong>Sampaolesi line</strong><strong>.</strong></li>\n<li><strong><strong>Radial transillumination defect </strong></strong>in the iris is a pathognomonic feature.</li>\n<li>Pigment granules may be deposited on the anterior surface. There may be a <strong>Scheie</strong> line or <strong>Zentmayer</strong> ring of pigment on the peripheral/equatorial surface around the zonular insertions.</li>\n</ul>\n<p>Other options:</p>\n<p>Option A:<strong> Ferry</strong> <strong>line:</strong> Corneal epithelial iron line at the edge of <strong>filtering blebs</strong> of glaucoma surgery</p>\n<p>Option B: <strong>Fleischer line/ring:\u00a0</strong>Epithelial iron deposits at the base of the cone in <strong>keratoconus</strong></p>\n<p>Option C: <strong>Hudson\u2013Stahli line:\u00a0</strong>Iron deposition line in the corneal epithelium, which is commonly seen in the junction between middle and lower third cornea. This finding is mainly age-related.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a02ae8e565884246a5f40b91cdc80d28.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Malignant glaucoma is seen in __________.",
    "choices": [
      {
        "id": 1,
        "text": "After intra-ocular surgery"
      },
      {
        "id": 2,
        "text": "Intraocular malignancy"
      },
      {
        "id": 3,
        "text": "Trauma"
      },
      {
        "id": 4,
        "text": "Central retinal arterial occlusion"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Malignant glaucoma</strong> is seen after <strong>intra-ocular surgery\u00a0</strong>(usually after trabeculectomy).</p>\n<p><strong>Ciliary block</strong> glaucoma is also called <strong>malignant</strong> glaucoma/inverse glaucoma. It can be seen after any intraocular surgery. Forward flow of the aqueous is blocked as tips of ciliary processes rotate forward and press against the lens/intraocular lens (IOL)/anterior hyaloid of the vitreous. Hence, aqueous humor starts collecting in the vitreous cavity.\u00a0</p>\n<p>Signs:</p>\n<ul>\n<li>High intraocular pressure (IOP) and absent bleb.</li>\n<li>Negative Seidel test.</li>\n<li>Shallow anterior chamber (AC)</li>\n</ul>\n<p>Treatment:</p>\n<ul>\n<li><strong>Initial</strong> treatment is with <strong>cycloplegics</strong> (atropine 1%) to <strong>dilate</strong> the <strong>ciliary ring</strong> and push the vitreous-lens-iris posteriorly.</li>\n<li><strong>Subsequent</strong> treatment if medical therapy fails is with <strong>Nd:YAG laser</strong>\u00a0hyaloidotomy.</li>\n<li>Pars plana vitrectomy can be considered in conditions that don't respond to the above treatment modalities.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is iridocorneal endothelial syndrome associated with?",
    "choices": [
      {
        "id": 1,
        "text": "Progressive atrophy of the iris stroma"
      },
      {
        "id": 2,
        "text": "Bilateral stromal edema of the iris"
      },
      {
        "id": 3,
        "text": "Primary angle-closure glaucoma"
      },
      {
        "id": 4,
        "text": "Deposition of glycosaminoglycans in Descemet's membrane"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Progressive atrophy</strong> of <strong>iris stroma </strong>is a clinical entity of iridocorneal endothelial syndrome (ICE).</p>\n<p>ICE syndrome is a <strong>proliferative endotheliopathy,\u00a0</strong>which leads to <strong>secondary angle-closure glaucoma.</strong></p>\n<p>It includes three clinical entities:</p>\n<ol>\n<li>Progressive iris atrophy</li>\n<li><strong>Chandler\u2019s syndrome -</strong>\u00a0corneal edema</li>\n<li><strong>Cogan\u2013Reese syndrome -</strong>\u00a0nodules and nevus on the iris; hence, it is known as<strong> iris nevus syndrome</strong>.</li>\n</ol>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is seen in hypersecretory glaucoma?",
    "choices": [
      {
        "id": 1,
        "text": "Marfans syndrome"
      },
      {
        "id": 2,
        "text": "Hypertension"
      },
      {
        "id": 3,
        "text": "Diabetes"
      },
      {
        "id": 4,
        "text": "Epidemic dropsy"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Hypersecretory glaucoma</strong> is associated with&nbsp;<strong>epidemic dropsy.</strong></p>\n<p>Epidemic dropsy occurs due to <strong><em>Argemone mexicana</em> </strong>poisoning. Here,&nbsp;glaucoma is due to excessive production of aqueous humor.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "100-day glaucoma is seen in which of the following conditions?",
    "choices": [
      {
        "id": 1,
        "text": "Central retinal vein occlusion"
      },
      {
        "id": 2,
        "text": "Eale's disease"
      },
      {
        "id": 3,
        "text": "Central retinal artery occlusion"
      },
      {
        "id": 4,
        "text": "Steroid-induced glaucoma"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Option D:<strong>Steroid induced glaucoma\u00a0</strong>is a type of secondary open angle glaucoma that usually follows weeks-months of\u00a0<strong>topical steroid therapy.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a93e3c6869d64c888e8ca058355b477ex720x688.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/93df537a43d548da9179ee53b55146fex720x515.JPEG"
    ]
  },
  {
    "text": "Which of the following statements is false regarding the progression of ocular hypertension to primary open-angle glaucoma?",
    "choices": [
      {
        "id": 1,
        "text": "Reducing IOP is effective in delaying the onset of POAG"
      },
      {
        "id": 2,
        "text": "Thin cornea is a risk factor for POAG development"
      },
      {
        "id": 3,
        "text": "Family history is not a risk factor for POAG development"
      },
      {
        "id": 4,
        "text": "Increased cup disc ratio is a risk factor for POAG development"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Family history</strong> is a risk factor for the development of <strong>primary open-angle glaucoma</strong>.</p>\n<p><strong>Ocular hypertension (OHT)</strong> is characterized by <strong>only raised intraocular pressure (IOP)</strong>. Optic disc and normal visual field are normal, with no evidence of angle closure.</p>\n<p><strong>Risk factors</strong> for the progression of ocular hypertension to primary open-angle glaucoma include the following:</p>\n<ul>\n<li>African American race</li>\n<li>Thin cornea</li>\n<li>Increasing age</li>\n<li>Increased cup-disc ratio</li>\n<li>Increased IOP</li>\n<li>Family history of POAG</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Identify the instrument given in the image below.",
    "choices": [
      {
        "id": 1,
        "text": "Express implant"
      },
      {
        "id": 2,
        "text": "Gonioscope"
      },
      {
        "id": 3,
        "text": "Baerveldt implant"
      },
      {
        "id": 4,
        "text": "Ozurdex implant"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given image shows <strong>Baerveldt implant</strong> which is a glaucoma drainage device (GDD)/seton/aqueous shunt.</p>\n<p>It consists of a scleral plate that is sutured to the sclera and a tube connecting it into the anterior chamber. It is valveless, and hence, it carries the risk of postoperative hypotony due to excessive aqueous drainage.</p>\n<p><strong>Glaucoma drainage devices</strong>\u00a0are devices that allow aqueous outflow by establishing a communication between the anterior chamber and sub-Tennon's space/sub-conjunctival space. The glaucoma valve implant is also known as a\u00a0<strong>seton</strong>.</p>\n<p>The commonly used devices are as follows:</p>\n<p>1. Shunts using episcleral explants</p>\n<ul>\n<li class=\"p1\">Ahmed glaucoma valve: Silicone</li>\n<li class=\"p1\">Molteno implant- Polypropelene plate and silicone plate</li>\n<li class=\"p1\">Baerveldt implant- Silicone\u00a0</li>\n</ul>\n<p class=\"p1\">2. Mini-shunts\u00a0</p>\n<ul>\n<li class=\"p1\">Ex-Press\u2122 Mini-Shunt: Stainless steel\u00a0</li>\n<li class=\"p1\">iStent\u00ae- Titanium</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c20249fdcff54aacb7751e3b0770faa7.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "What is the drug of choice for inverse glaucoma?",
    "choices": [
      {
        "id": 1,
        "text": "Pilocarpine"
      },
      {
        "id": 2,
        "text": "Prostaglandin analogues"
      },
      {
        "id": 3,
        "text": "Timolol"
      },
      {
        "id": 4,
        "text": "Atropine"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The drug of choice for <strong>inverse glaucoma</strong> is <strong>atropine.</strong></p>\n<p>Inverse glaucoma is a type of <strong>secondary angle-closure glaucoma</strong> caused by the flow of <strong>aqueous humour</strong> posteriorly to the<strong> posterior segment</strong> instead of the posterior chamber. The increased pressure in the posterior segment pushes the <strong>lens forward</strong> leading to the shallowing of the anterior chamber.</p>\n<p><strong>Miotics </strong>are<strong> contraindicated</strong> as they can cause the ciliary zonules to slack, the lens to move forward and further shallowing of the anterior chamber. So <strong>mydriatic</strong> and <strong>cycloplegic agents</strong> such as atropine are administered.</p>\n<p>Inverse glaucoma is also called:</p>\n<ul>\n<li>Malignant glaucoma</li>\n<li>Ciliary block glaucoma</li>\n<li>Aqueous misdirection.</li>\n</ul>\n<p>Note:</p>\n<p><strong>Pilocarpine</strong> is the drug of choice in <strong>angle-closure glaucoma</strong> but is contraindicated in inverse glaucoma.</p>\n<p>Whereas, <strong>atropine</strong> is the drug of choice in <strong>inverse glaucoma\u00a0</strong>but is\u00a0contraindicated in angle-closure glaucoma.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An elderly male who is a known case of diabetes presents with blurry vision near the center of his field of vision. He also informs that colours appear washed out or faded. His IOP was found to be elevated. Which of the following drugs should not be used to control IOP in this diabetic patient?",
    "choices": [
      {
        "id": 1,
        "text": "Prostaglandin analogue"
      },
      {
        "id": 2,
        "text": "Dorzolamide"
      },
      {
        "id": 3,
        "text": "Pilocarpine"
      },
      {
        "id": 4,
        "text": "Alpha agonists"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>This diabetic patient with new onset central loss of vision and reports of colors appearing faded or washed out most likely has macular edema. <strong>Prostaglandin analogs</strong> have a high propensity to cause and further exacerbate cystoid macular edema and hence are not preferred in this patient.\u00a0</p>\n<p><strong>Drugs associated with cystoid macular edema</strong> (CME):</p>\n<ol>\n<li>Prostaglandin analogues</li>\n<li>Epinephrine</li>\n<li>Dipivefrine (only the non-selective alpha agonists, in aphakic eyes)</li>\n<li>Tamoxifen</li>\n<li>Timolol</li>\n<li>Docetaxel</li>\n<li>Interferons</li>\n<li>Fingolimod</li>\n<li>Thiazolinediones</li>\n<li>Niacin (pseudo-CME)</li>\n</ol>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In a 55-year-old patient presenting with secondary open-angle glaucoma, what is the most likely etiology?",
    "choices": [
      {
        "id": 1,
        "text": "Phacolytic glaucoma"
      },
      {
        "id": 2,
        "text": "Pseudo exfoliation syndrome"
      },
      {
        "id": 3,
        "text": "Pigment dispersion syndrome"
      },
      {
        "id": 4,
        "text": "Inflammatory glaucoma"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Pseudoexfoliation (PEX) syndrome</strong> is the most likely cause of secondary open-angle glaucoma.</p>\n<p>Pseudoexfoliation syndrome is an ocular manifestation of an <strong>age-related systemic disorder</strong> of the <strong>extracellular matrix</strong>, characterized by the production and progressive accumulation of fibrillar extracellular material in many ocular and systemic tissues. The clinical hallmark of PEX syndrome is the<strong> deposition</strong> of <strong>whitish abnormal pseudoexfoliative debris</strong> on the anterior lens capsule.\u00a0</p>\n<p>A deposition is also noted on:</p>\n<ul>\n<li>Zonules (causing zonulolysis and phacodonesis, lens subluxation)</li>\n<li>Pupillary margin</li>\n<li>Trabecular meshwork (causing the secondary open-angle glaucoma)</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following drugs increases the uveoscleral outflow?",
    "choices": [
      {
        "id": 1,
        "text": "Timolol"
      },
      {
        "id": 2,
        "text": "Latanoprost"
      },
      {
        "id": 3,
        "text": "Pilocarpine"
      },
      {
        "id": 4,
        "text": "Carbonic anhydrase inhibitor"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Latanoprost</strong> is a <strong>prostaglandin</strong> drug, which acts by <strong>increasing</strong> the <strong>uveoscleral outflow</strong> and thereby <strong>lowers</strong> the <strong>intraocular pressure.\u00a0</strong></p>\n<p>Mechanism of action: Latanoprost is a prodrug and gets activated during its passage through the cornea. It acts by stimulating the prostanoid receptors on the ciliary muscles<strong>.\u00a0</strong>This leads to the release of matrix metalloproteinases, which increases the uveoscleral outflow.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "True regarding POAG:",
    "choices": [
      {
        "id": 1,
        "text": "A,B, D and E"
      },
      {
        "id": 2,
        "text": "A, B and C"
      },
      {
        "id": 3,
        "text": "B and E only"
      },
      {
        "id": 4,
        "text": "B, C and D"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p class=\"p1\">In<strong>&nbsp;primary open-angle glaucoma (POAG)</strong>, family members are likely to develop steroid responsiveness (statement B) and visual field defect can exist with a normal C:D ratio (statement E).</p>\n<p>Statement A: Gonioscopy <strong>cannot visualize</strong> the <strong>specific abnormalities</strong> that occur in the trabecular meshwork in POAG. Gonioscopy <strong>diagnoses POAG</strong> because of the <strong>visibility of all</strong> the <strong>structures</strong> of the angle of the anterior chamber in contrast to the non-visibility of different structures in angle closure glaucoma.</p>\n<p>Statement C: Primary <strong>angle-closure</strong> glaucoma is&nbsp;associated with exacerbation of IOP with pupillary dilatation and not POAG.</p>\n<p>Statement D: There is a&nbsp;<strong>10% increased risk</strong> of POAG in <strong>siblings</strong> and a <strong>4% increased</strong> risk in <strong>children</strong> of patients with POAG.&nbsp;</p>\n<p class=\"p1\"><strong>POAG</strong>&nbsp;also known as <strong>chronic simple glaucoma</strong> of adult-onset is characterized by the presence of any 2 of the following 3 categories of changes:</p>\n<ul>\n<li class=\"p1\"><strong>Increased intraocular pressure:</strong>\n<ul>\n<li class=\"p1\">IOP &gt;21mmHg on more than one occasion, and/or</li>\n<li class=\"p1\">Circadian variation in IOP of &gt;8 mmHg, or</li>\n<li class=\"p1\">Asymmetry in IOP &gt; 5 mmHg between both eyes</li>\n</ul>\n</li>\n</ul>\n<ul style=\"list-style-type: circle;\">\n<li><strong>Optic nerve head changes</strong> suggestive of glaucomatous damage. These may include one or more of the following changes:<br />\n<ul>\n<li>Vertically oval cup</li>\n<li>Cup-disc (C:D) ratio <strong>&gt; 0.6</strong> (average cup: disc ratio 0.3-0.4)</li>\n<li>Asymmetry in C:D ratio &gt; 0.2 between both eyes.</li>\n<li>Narrowing, notching, or pallor of the neuroretinal rim.</li>\n<li>Disc haemorrhages</li>\n<li>Nasal shifting of retinal vessels-Bayonetting sign</li>\n<li>Lamellar dot sign</li>\n</ul>\n</li>\n<li><strong>Visual field changes -</strong> isopter contraction, barring of blind spot, paracentral scotoma, Seidel's scotoma, Bjerrum's scotoma, double arcuate scotoma, and Roenne's central nasal step.</li>\n</ul>\n<p>A patient presenting with just raised IOP and visual field defects with normal optic nerve head findings such as a normal C:D ratio can still be diagnosed as POAG (statement E).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 48-year-old lady was started on an ocular medication that she was instructed to take daily. She develops redness of the eye. Examination reveals a colour change of the iris and orbital fat atrophy. Which of the following medications was she likely prescribed?",
    "choices": [
      {
        "id": 1,
        "text": "Timolol"
      },
      {
        "id": 2,
        "text": "Pilocarpine"
      },
      {
        "id": 3,
        "text": "Latanoprost"
      },
      {
        "id": 4,
        "text": "Scopolamine"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical history of a patient that has <strong>iris pigmentation</strong> and <strong>redness</strong> of the eye, was most likely started on <strong>latanoprost.</strong></p>\n<table style=\"width: 413px;\">\n<tbody>\n<tr>\n<td style=\"width: 129px;\">Drug</td>\n<td style=\"width: 276px;\">Side Effects</td>\n</tr>\n<tr>\n<td style=\"width: 129px;\">Latanoprost</td>\n<td style=\"width: 276px;\">\n<p>Allergic conjunctival hyperemia, permanent increase in iris pigmentation, orbital fat atrophy.</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 129px;\">Timolol\u00a0</td>\n<td style=\"width: 276px;\">Exacerbation of asthma and chronic obstructive pulmonary disease, bradycardia, depression, impotence\u00a0</td>\n</tr>\n<tr>\n<td style=\"width: 129px;\">Scopolamine</td>\n<td style=\"width: 276px;\">Photosensitivity, blurred vision\u00a0</td>\n</tr>\n<tr>\n<td style=\"width: 129px;\">Pilocarpine</td>\n<td style=\"width: 276px;\">Corneal edema, miosis, induced myopia, decreased vision, brow ache, retinal detachment\u00a0</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "First drug to be given in acute angle-closure glaucoma is _________.",
    "choices": [
      {
        "id": 1,
        "text": "Atropine"
      },
      {
        "id": 2,
        "text": "Timolol"
      },
      {
        "id": 3,
        "text": "Pilocarpine"
      },
      {
        "id": 4,
        "text": "Acetazolamide"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The <strong>first drug</strong> to be given in acute angle-closure glaucoma is <strong>oral acetazolamide</strong> or <strong>intravenous mannitol.</strong></p>\n<p><strong>Acetazolamide</strong> reduces IOP by <strong>decreasing</strong> the production of <strong>aqueous.</strong></p>\n<p>The <strong>definitive drug</strong> is <strong>pilocarpine</strong> as it constricts the pupil and breaks the attack.</p>\n<p>Finally, when the corneal edema resolves, the patient has to undergo laser iridotomy to prevent such attacks in the\u00a0future. So,\u00a0<strong>laser iridotomy</strong> is the <strong>definitive management</strong> for acute angle-closure glaucoma.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The normal extent of the visual field superiorly is ________.",
    "choices": [
      {
        "id": 1,
        "text": "60\u00b0"
      },
      {
        "id": 2,
        "text": "50\u00b0"
      },
      {
        "id": 3,
        "text": "70\u00b0"
      },
      {
        "id": 4,
        "text": "90\u00b0"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The extent of visual field superiorly is <strong>50&deg;</strong></p>\n<p>Normal extent of the visual field:&nbsp;</p>\n<ul>\n<li>Temporal: 90&deg;/100&deg;</li>\n<li>Inferiorly: 70&deg;</li>\n<li>Nasal: 60&deg;</li>\n<li>Superiorly: 50&deg;</li>\n</ul>\n<p><strong>Note:</strong>&nbsp;According to Parson's 22<sup>nd</sup> Ed., Page no. 101, the visual field extends 60<sup>o&nbsp;</sup>superiorly. However, most journals and other standard textbooks consider the answer to be 50<sup>o</sup>. Hence, we choose&nbsp;50<sup>o </sup>as the most appropriate answer.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '13 Glaucoma';
        const quizFilename = '13-glaucoma-1e9df3e3.html';
        let hierarchy = ["Marrow", "qBank", "Ophthalmology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>