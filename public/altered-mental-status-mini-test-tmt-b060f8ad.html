<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Altered Mental Status Mini Test - -Tmt - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2023-24
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A 70-year-old male was found in a disoriented state in his apartment by his son. He has a 20-year history of type 2 diabetes mellitus. He has a dry tongue and appears extremely dehydrated. Serum glucose is found to be 848mg/gl. What is the immediate next step in the management of his condition?",
    "choices": [
      {
        "id": 1,
        "text": "IV Noradrenaline infusion"
      },
      {
        "id": 2,
        "text": "Isotonic saline infusion"
      },
      {
        "id": 3,
        "text": "Correction of potassium deficit"
      },
      {
        "id": 4,
        "text": "Slow infusion of regular insulin"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>This old man with a <strong>serum glucose</strong> of <strong>848mg/dl</strong> and a history of <strong>type</strong> <strong>2 diabetes mellitus</strong> most likely has developed <strong>hyperosmolar hyperglycemic syndrome,</strong> likely secondary to an underlying infection. The patient has signs of <strong>dehydration</strong> like a <strong>dry tongue</strong> - so the immediate next step in his management is to give him <strong>IV isotonic saline.</strong> This allows an overall improvement in his <strong>hydration status</strong> and <strong>reduces</strong> levels of <strong>stress hormones,</strong> which will allow further management of his condition with insulin and potassium infusion(if needed).\u00a0</p>\n<p>HHS is commonly seen in older adults suffering from type 2 diabetes mellitus predominantly. Patients can present with the following features:</p>\n<ul>\n<li>Polyuria</li>\n<li>Polydipsia</li>\n<li><strong>confusion, drowsiness</strong></li>\n<li><strong>Altered sensorium,</strong> coma</li>\n<li><strong>Seizures</strong></li>\n<li><strong>Severe</strong> dehydration</li>\n<li>concomitant infection, MI, stroke</li>\n</ul>\n<p>The following lab values are seen:\u00a0</p>\n<ul>\n<li>Blood glucose of <strong>600-1200</strong> mg/dl</li>\n<li>Serum osmolality &gt; <strong>350</strong> mOsm/L</li>\n<li><strong>Prerenal azotemia</strong> due to <strong>dehydration</strong></li>\n<li><strong>Pseudohyponatremia</strong> may be seen due to <strong>hyperglycemia</strong></li>\n<li>Normal pH and ketones (Some cases can have mild ketonuria).</li>\n</ul>\n<p>The mainstay of <strong>management</strong> is <strong>fluid replacement, IV regular insulin,</strong> along with <strong>potassium</strong> replacement. <strong>Heparin</strong> can be given prophylactically as volume contraction can increase the risk of <strong>venous thrombosis.</strong></p>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 38-year-old chronic alcoholic patient was driving under alcohol influence and met with an accident. He is admitted with a shaft of femur fracture. On the third day of admission,  he develops severe restlessness and altered sensorium. He has visual and tactile hallucinations.  Which of the following drugs should be avoided for the management of this patient's condition?",
    "choices": [
      {
        "id": 1,
        "text": "Thiamine"
      },
      {
        "id": 2,
        "text": "Diazepam"
      },
      {
        "id": 3,
        "text": "Clozapine"
      },
      {
        "id": 4,
        "text": "Chlordiazepoxide"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario of altered sensorium with visual and tactile hallucinations following alcohol withdrawal is suggestive of <strong>delirium tremens.</strong>\u00a0Antipsychotics like <strong>Clozapine</strong> are <strong>avoided</strong> in the management of <strong>delirium tremens </strong>as they <strong>lower the seizure threshold</strong>, placing the patient at a <strong>greater risk</strong> <strong>for</strong> developing <strong>alcohol-withdrawal seizures</strong>.</p>\n<p>Antipsychotics are used to manage the psychotic symptoms in cases of delirium but in cases of <strong>delirium associated with alcohol withdrawal</strong> the use of <strong>antipsychotics</strong> is <strong>not recommended</strong>. All antipsychotics except pimavanserin are associated with an increased risk for seizures, with <strong>clozapine</strong> having a <strong>dose-dependent seizure risk</strong>.</p>\n<p><strong>Delirium tremens</strong>\u00a0is a <strong>medical</strong>\u00a0<strong>emergency</strong>\u00a0that occurs during\u00a0<strong>alcohol withdrawal</strong>. It is an\u00a0<strong>acute </strong>condition and usually <strong>develops</strong> <strong>within 3-4 days</strong> of the last drink. It has symptoms of both delirium and alcohol withdrawal. In the above scenario, delirium tremens precipitated as the patient was admitted into the hospital ward and couldn't consume alcohol for three days. The clinical features of delirium tremens are:</p>\n<ul>\n<li aria-level=\"1\"><strong>Altered sensorium</strong>\u00a0with\u00a0<strong>disorientation</strong></li>\n<li aria-level=\"1\">Perceptual distortions, most frequently <strong>tactile</strong> or\u00a0<strong>visual hallucinations</strong></li>\n<li aria-level=\"1\"><strong>Autonomic hyperactivity</strong> with tachycardia, fever, anxiety, insomnia, hypertension, and sweating</li>\n<li aria-level=\"1\"><strong>Fluctuating</strong> levels of <strong>psychomotor activity</strong>, ranging from\u00a0<strong>agitation</strong>\u00a0to lethargy</li>\n<li aria-level=\"1\"><strong>Altered sleep-wake cycle</strong></li>\n</ul>\n<p>Benzodiazepines such as\u00a0<strong>diazepam</strong>\u00a0(intravenously)\u00a0<strong>or</strong>\u00a0<strong>chlordiazepoxide</strong>\u00a0(orally every 4 hours)<strong>\u00a0</strong>are given in order <strong>to deal with</strong> the<strong> symptoms</strong>. It is also recommended to administer <strong>thiamine</strong>\u00a0in patients with alcohol-related disorders <strong>to prevent</strong>\u00a0<strong>Wernicke-Korsakoff syndrome</strong>. Patients that <strong>do not respond</strong> even<strong> to</strong> high-dose <strong>benzodiazepines</strong>, should be <strong>administered</strong> <strong>Propofol</strong> or <strong>Dexmedetomidine</strong> in closely-monitored doses.</p>\n<p>Note: Haloperidol is the only recommended antipsychotic given in cases of severe psychosis in Delirium tremens.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 65-year-old woman presents with recent confusion and difficulty in doing daily activities of living. She also has recent urinary incontinence and walks with a magnetic gait. She has a past history of meningitis. Which of the following is the definitive management of her condition?",
    "choices": [
      {
        "id": 1,
        "text": "Venticuloperitoneal shunting"
      },
      {
        "id": 2,
        "text": "Periodic lumbar punctures"
      },
      {
        "id": 3,
        "text": "Levodopa-carbidopa"
      },
      {
        "id": 4,
        "text": "Acetylcholinesterase inhibitors"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The classic\u00a0<strong>triad of dementia</strong>(difficulties in activities of daily living and confusion)<strong>, hypokinetic magnetic gait,</strong>\u00a0and<strong> urinary incontinence </strong>seen in this patient suggest\u00a0<strong>normal-pressure hydrocephalus </strong>(NPH). The definitive treatment of this condition is <strong>ventriculoperitoneal shunting</strong> to reduce the intracranial pressure on the surrounding brain tissue.</p>\n<p>Normal-pressure hydrocephalus is a\u00a0<strong>communicating hydrocephalus</strong>\u00a0caused by\u00a0<strong>delayed resorption</strong>\u00a0of cerebrospinal fluid.\u00a0<strong>M</strong><strong>eningeal scarring</strong>\u00a0is seen in some patients, due to previous history of meningitis, subarachnoid hemorrhage, or head trauma.</p>\n<p>It presents with the characteristic triad of</p>\n<ul>\n<li>Dementia (mostly executive function),</li>\n<li>Ataxic or apractic gait, and</li>\n<li>Urinary incontinence (sometimes urgency too).</li>\n</ul>\n<p>It is classified as <strong>idiopathic</strong> (primary) or <strong>symptomatic</strong> (secondary) occurring due to prior brain infection, injury, radiation, or hemorrhage.\u00a0</p>\n<p>The etiology is poorly understood but is thought to be related to the<strong> hyperdynamic flow of CSF</strong> in the aqueduct, reduced compliance of the subarachnoid space, <strong>increased CSF</strong> pulse <strong>pressure</strong>, and <strong>reduced</strong> <strong>reabsorption</strong> of CSF.\u00a0</p>\n<p>Diagnosis:\u00a0</p>\n<ul>\n<li>Neuroimaging reveals\u00a0<strong>enlarged lateral ventricles</strong>\u00a0(hydrocephalus) with little or\u00a0<strong>no cortical atrophy</strong>, although the Sylvian fissures can be mistaken for perisylvian atrophy due to the propped open (so-called \u201c<strong>boxcarring</strong>\u201d) appearance.</li>\n<li>CSF parameters are normal except for the high range of pressure.</li>\n<li>Another confirmatory test performed is the cerebrospinal fluid\u00a0<strong>(</strong><strong>CSF) tap test</strong>,<strong>\u00a0</strong>which shows marked improvement of symptoms with spinal fluid removal.</li>\n</ul>\n<p>Treatment: Ventriculoperitoneal shunting: It\u00a0is done to drain excess\u00a0cerebrospinal fluid (CSF). Complications of the shunting procedure include\u00a0<strong>shunt obstruction</strong>,<strong>\u00a0infection, i</strong><strong>ntracerebral or intraventricular hemorrhage,\u00a0</strong>malposition\u00a0or breakage of the shunt, etc.</p>\n<p>Other options:</p>\n<p>Option B - Periodic lumbar punctures can help reduce the symptoms in pseudotumour cerebri but have no role in the management of NPH.</p>\n<p>Option C - <strong>Levodopa-carbidopa\u00a0</strong>is used in the management of Parkinsons disease which presents with tremors, rigidity, akinesia and postural instability.</p>\n<p><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">Option D - <strong>Acetylcholine esterase inhibitors\u00a0</strong>like rivastigmine, galantamine are used in the management of Alzheimer's disease.</span></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 50-year-old man is brought with complaints of progressive memory deficits and concentration problems. On examination, he is only oriented to person and scores 22 on the mini mental state examination. History reveals unintentional weight loss and arthralgia. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Whipple's disease"
      },
      {
        "id": 2,
        "text": "Celiac disease"
      },
      {
        "id": 3,
        "text": "Pernicious anemia"
      },
      {
        "id": 4,
        "text": "Tropical sprue"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>This patient has progressive <strong>neurological symptoms</strong> with a history of <strong>unintentional weight loss</strong> and <strong>arthralgias.</strong> The probable diagnosis is <strong>Whipple's disease.</strong></p>\n<p>Whipple's disease is a chronic multisystem disorder caused by <strong>Tropheryma whipplei.</strong> It primarily causes <strong>malabsorption</strong> along with the <strong>central nervous</strong> system and cardiac problems.</p>\n<p>The disease has an <strong>insidious</strong> onset, characterized by <strong>arthralgias, weight</strong> loss, <strong>chronic</strong> diarbrhea, <strong>abdominal</strong> pain, and fever. Long term disease can cause <strong>cardiac</strong> and <strong>neurological</strong> complications.</p>\n<p>Important CNS manifestations in Whipple's disease are:</p>\n<ul>\n<li><strong>Personality</strong> and <strong>mood</strong> changes</li>\n<li>Progressive supranuclear ophthalmoplegia</li>\n<li>Focal neurologic presentations</li>\n<li><strong>Oculomasticatory myorrhythmia</strong> - an unusual combination of rhythmic eye and jaw movements which is pathognomonic of Whipple's disease.</li>\n</ul>\n<p>Whipple's disease associated with <strong>CNS</strong> symptoms has a <strong>poor prognosis.</strong></p>\n<p>The diagnosis of Whipple's disease is made through a biopsy which shows PAS-positive macrophages in the small intestine. Fluorescent in situ hybridization (FISH) and polymerase chain reaction are other sensitive investigations.\u00a0</p>\n<p>The treatment regimen includes ceftriaxone or meropenem. It is followed by trimethoprim-sulfamethoxazole for 12 months.</p>\n<p>The <strong>most common CNS</strong> manifestation associated with <strong>Whipple\u2019s</strong> disease is <strong>progressive dementia.</strong></p>\n<p>Other options:</p>\n<p>Option B: Celiac disease is an <strong>autoimmune gluten-induced</strong> enteropathy where there is an excessive <strong>inflammatory</strong> response to gluten and its breakdown product, <strong>gliadin.</strong> This leads to inflammatory infiltration of the lamina propria which subsequently impairs various nutrient absorption. Clinically, it presents as a malabsorption syndrome with <strong>diarrhea, abdominal</strong> pain, and <strong>marked weight</strong> loss.</p>\n<p>Option C:\u00a0<strong>Pernicious anemia</strong> is an autoimmune disease characterized by the presence of <strong>autoantibodies</strong> that <strong>impairs</strong> the production or activity of the <strong>intrinsic factor</strong> (IF) that is released from the parietal cells, which is required for the uptake of vitamin B12. These patients also develop chronic atrophic gastritis, characterized by loss of parietal cells, infiltration of lymphocytes and plasma cells, and megaloblastic changes in mucosal cells.</p>\n<p>Option D: <strong>Tropical sprue</strong> is another malabsorption disorder seen as <strong>diarrhea, steatorrhea, nutritional deficiencies,</strong> and <strong>weight loss.</strong> It is prevalent in some tropical areas hence the name. Though the exact etiology is still unaccounted for, it is mostly attributed to infectious agents considering its response to antibiotics. It is diagnosed by a small intestinal biopsy which shows a close resemblance to that seen in celiac disease. Broad-spectrum antibiotics along with folic acid supplementation forms the mainstay of treatment.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 45-year-old woman is brought with confusion and dizziness since the last 12 hours. Over the last 2-3 days she has had right upper quadrant pain, and fever and now has a yellowish tinge on her conjunctiva. BP is 90/60mmhg. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Subphrenic abscess"
      },
      {
        "id": 2,
        "text": "Cholangiocarcinoma"
      },
      {
        "id": 3,
        "text": "Hydrops gall bladder"
      },
      {
        "id": 4,
        "text": "Ascending cholangitis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>This patient presented with <strong>right upper</strong> quadrant pain, <strong>fever, jaundice</strong> with <strong>altered mental status,</strong> and <strong>hypovolemia</strong> has all the components of the <strong>Reynolds pentad.</strong> This patient most likely has ascending cholangitis, likely secondary to obstruction by a gallstone.\u00a0</p>\n<p><strong>Primary ascending cholangitis</strong> is a life-threatening condition caused by an ascending bacterial infection of the <strong>intra-</strong> and <strong>extrahepatic</strong> ducts with secondary blockage of the biliary tracts. It affects both <strong>men</strong> and <strong>women</strong> aged 50 to 60 years. <strong>Charcot triad</strong> describes cholangitis as clinical findings of <strong>fever, right upper</strong> abdominal pain, and <strong>jaundice.</strong> When the patient also has altered mental status and hypovolemia it is termed as the Reynold's pentad.\u00a0</p>\n<p>A <strong>liver biopsy</strong> shows cholestasis within the <strong>hepatic parenchyma</strong> and <strong>neutrophils</strong> involving the bile duct lumen.\u00a0</p>\n<p>Presence of the Reynold's pentad has a high mortality rate and treatment is urgent surgery to restore bile flow. PAtients are also given concomitant antibiotics and IV fluids.\u00a0</p>\n<p>Other options:</p>\n<p>Option A: <strong>Subphrenic abscesses</strong> occur in the <strong>space</strong> that lies between the right lobe of the <strong>liver</strong> and the <strong>diaphragm.</strong> It is limited <strong>posteriorly</strong> by the <strong>anterior</strong> layer of the <strong>coronary</strong> and the <strong>right triangular</strong> ligaments, and to the <strong>left</strong> by the <strong>falciform</strong> ligament. Common causes of <strong>abscess</strong> here are <strong>perforating cholecystitis,</strong> a <strong>perforated duodenal</strong> ulcer and a duodenal cap \u2018blow-out\u2019 following gastrectomy and appendicitis. This patient has no such history</p>\n<p>Option B: <strong>Cholangiocarcinoma</strong> presents as <strong>painless jaundice</strong> with unintentional weight loss. This patient's presentation is more acute and makes cholangitis more likely.</p>\n<p>Option C: <strong>Hydrops gall bladder</strong> occurs due to an obstruction in the gallbladder leading to <strong>accumulation</strong> of <strong>mucous</strong> and <strong>distension</strong> of the gall bladder. It presents with right <strong>upper quadrant pain</strong> and doesn't present with <strong>acute symptoms</strong> in a short time frame.\u00a0</p>\n<p>\u00a0</p>\n<p>\u00a0</p>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 76-year-old male patient receiving multiple medications in the medicine ward is suddenly fighting with the nurses as he is unaware of where he is and wants to go home. On examination,  the patient is confused, argumentative and is constantly trying to get out of the ward. Which of the following measures should be taken next?",
    "choices": [
      {
        "id": 1,
        "text": "Prescribe a benzodiazepine to calm him down"
      },
      {
        "id": 2,
        "text": "Prescribing the corner bed to reduce disturbances to other patients"
      },
      {
        "id": 3,
        "text": "Using  soft braces to tether him to the bed to prevent fall injury"
      },
      {
        "id": 4,
        "text": "Remind him of his location and get him back into bed"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>This patient in the medicine ward with <strong>sudden onset</strong> of <strong>confusion</strong> and <strong>violent behavior</strong> is likely in <strong>acute delirium</strong> induced by <strong>poly-pharmacy.</strong> The next step in the management of this patient would be to attempt to <strong>reorient</strong> the <strong>patient</strong> and gently try to get him back into bed.\u00a0</p>\n<p><strong>Delirium</strong> is a form of altered mental status manifesting commonly as <strong>inattention</strong> and <strong>confusion.</strong> Sometimes patients can get <strong>violent</strong> due to a <strong>severe</strong> lack of <strong>perception</strong> of their <strong>surroundings.</strong> It is commonly seen in <strong>elderly patients</strong> receiving <strong>multiple medications,</strong> or in <strong>post-op</strong> patients. Delirium is usually secondary to an underlying condition and it should be corrected first. Apart from that, reorientation protocols should be practiced to allow the patients to reorient themselves. This includes:</p>\n<ol>\n<li>Avoiding <strong>polypharmacy</strong> wherever possible. Always monitor a patient's current drugs before adding a new one and eliminate any that can cause delirium. Examples of such drug classes include First <strong>generation histamine blockers, Benzodiazepines,</strong> and drugs for insomnia.</li>\n<li>Correct any underlying electrolyte disorders</li>\n<li>Reorient the patient. Both the family and the healthcare staff should constantly reorient the patient.</li>\n<li>Provide a dark and quiet environment at night to ensure uninterrupted sleep. During the day they should be in well-lit areas to allow them to be aware of the passage of time.</li>\n<li>Patients at risk of delirium are also at risk of falls, so they should be placed directly in the nursing staff's line of sight to allow monitoring. Corner beds or secluded areas are usually away from the line of sight of the nursing station and so that should be avoided. (Option B)</li>\n<li>Avoid <strong>benzodiazepines</strong> as they can further exacerbate delirium. (Option A)</li>\n<li>Restraints must be avoided unless the patient is very uncooperative. The patient must be first attempted to be calmed down. (Option C)</li>\n</ol>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient is brought to the casualty with reduced responsiveness after consuming multiple illicit substances in a party. He only moans in response to painful stimuli and is not oriented to time, place and person. His respiratory rate is 9 breaths per minute and he is not responsive to naloxone administration. Which of the following drugs could he have likely consumed?",
    "choices": [
      {
        "id": 1,
        "text": "3,4,5"
      },
      {
        "id": 2,
        "text": "3,4"
      },
      {
        "id": 3,
        "text": "3,5"
      },
      {
        "id": 4,
        "text": "1,2,4"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>This patient with features of <strong>reduced responsiveness</strong> and low <strong>respiratory rate</strong> with complete <strong>disorientation</strong> to <strong>time, place,</strong> and <strong>person</strong> has consumed a drug that reduces the CNS responsiveness. He is also <strong>not responsive</strong> to <strong>naloxone administration.</strong> Out of the options listed, only <strong>benzodiazepines</strong> and <strong>barbiturates</strong> are likely to be the drugs he might have consumed.</p>\n<p><strong>Benzodiazepines, barbiturates</strong> and <strong>heroin</strong> can all present with reduced responsiveness and respiratory disturbances. However, heroin overdose is reversed by naloxone, which is a opioiod antagonist. Since this patient is not responding to naloxone, heroin can be ruled out as a cause of his symptoms.\u00a0</p>\n<p>The other drugs listed such as <strong>amphetamines</strong> and <strong>phencyclidine</strong> are both <strong>stimulants</strong> and present with symptoms of <strong>increased activity,</strong> sympathetic activation and reduced need for sleep. <strong>Phencyclidine</strong>\u00a0in addition to this also has a characteristic finding of <strong>nystagmus.</strong> As these symptoms are not seen in this patient, they can also be ruled out.\u00a0</p>\n<p><strong>Benzodiazepine</strong> toxicity is treated with <strong>flumazenil, barbiturate</strong> overdoses are however only managed <strong>symptomatically</strong> as there is no antidote for barbiturate toxicity.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient is brought to the casualty with a 10-day history of increasing confusion. Physical examination shows a startle myoclonus. Over the past 12 months, he has had progressive memory deficits. This patient had a VP shunt insertion post meningitis 5 years ago at the same hospital. Lumbar puncture showed normal glucose counts. 4 other patients of this hospital after that procedure have had similar complaints in the past 6 months. What is the likely etiology of his condition?",
    "choices": [
      {
        "id": 1,
        "text": "Chronic bacterial infection"
      },
      {
        "id": 2,
        "text": "Misfolded protein production"
      },
      {
        "id": 3,
        "text": "Faulty shunt equipment"
      },
      {
        "id": 4,
        "text": "Surgical error during the procedure"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>This patient has presented with symptoms of <strong>rapidly progressive neurological</strong> and <strong>memory deficits</strong> with current complaints of <strong>confusion.</strong> 4 other patients with similar complaints make a <strong>nosocomial cause</strong> the likely etiology. The rapid progression of symptoms makes Prion disease caused by accumulation of misfolded protein the likely cause of this condition. The source of the prion infection could have been the <strong>surgical equipment</strong> that was not <strong>adequately</strong> sterilized.\u00a0</p>\n<p>The proteins that make up the <strong>prions</strong> (PrP) are present even normally in the cells. This normal form, <strong>PrPc,</strong> is in a predominantly \u03b1-helical configuration and is sensitive to proteases. However, the prions (infectious form) are in an abnormal <strong>\u03b2-pleated</strong> configuration and are called <strong>PrPSc.</strong> This pathological form is <strong>not degradable</strong> by <strong>proteases</strong> and converts the normal form- PrPc to the abnormal form- PrPSc. This abnormal protein gets deposited as <strong>plaques</strong> and <strong>degeneration</strong> of <strong>surrounding neuronal</strong> and glial tissue occurs characterized by intracellular vacuoles, leading to a characteristic <strong>spongiform encephalopathy.</strong> There is no associated inflammatory response to these agents.\u00a0</p>\n<p>Four types of Creutzfeldt-Jakob disease have been described:</p>\n<ul>\n<li>Sporadic (sCJD): Most common;</li>\n<li>Variant (vCJD): Bovine spongiform encephalopathy (mad cow disease), Kuru;</li>\n<li>Familial (fCJD): These individuals carry a PrPc mutation and include Gerstmann-Stra\u0308ussler- Scheinker syndrome and fatal familial insomnia;</li>\n<li><strong>Iatrogenic</strong> (iCJD): Maybe seen occurring after corneal transplantation, liver transplantation, use of contaminated <strong>neurosurgical instruments,</strong> use of <strong>cadaver-derived hormones,</strong> or <strong>stereotactic depth electrodes.</strong>\u00a0</li>\n</ul>\n<p>Clinically, CJD presents with predominantly CNS manifestations with rapidly progressive <strong>dementia, myoclonus</strong> (startle myoclonus is common), ataxia, <strong>akinetic mutism,</strong> visual disturbances, and pyramidal/extrapyramidal dysfunction. Insomnia, apathy, and other behavioral abnormalities may be seen.\u00a0</p>\n<p>CSF is predominantly normal but may show a positive assay for <strong>14-3-3</strong> protein. EEG may show periodic <strong>triphasic</strong> or <strong>multiphasic</strong> sharp-wave complexes seen as spikes or <strong>spike-wave patterns.</strong> MRI on FLAIR sequencing and diffusion-weighted imaging will show <strong>increased intensity</strong> in the <strong>basal ganglia</strong> region and a characteristic <strong>'cortical ribboning',</strong> in sporadic CJD. Diagnosis of CJD can be established on brain biopsy either by measuring PrPSc or by demonstrating the characteristic neuropathological features of spongiform encephalopathy.</p>\n<p>Management is mainly supportive as the disease is usually fatal within a year of the onset of symptoms.\u00a0</p>\n<p>Other options:</p>\n<p>Option A: <strong>Chronic bacterial meningitis</strong> causes features of raised ICP and is associated with a <strong>decreased glucose</strong> count in the CSF. This patient's <strong>startle myoclonus</strong> with a history of a <strong>neurological</strong> procedure makes a diagnosis of Prion disease more likely.</p>\n<p>Option C: Blockage of the shunt system presents with features of <strong>raised ICP</strong> as there is <strong>no outlet</strong> for drainage of <strong>CSF.</strong> This patient's only symptoms are <strong>progressive memory deficits</strong> with a history of VP shunt insertion. This makes a prion disease the likely etiology.\u00a0</p>\n<p>Option D: Surgical error during the procedure could have presented more acutely and not after 5 years.</p>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 24-year-old man is brought to the casualty with an altered sensorium. He has had a non-remitting fever of 102 degrees Fahrenheit over the last 2 weeks. BP is 100/80mmHg. On 2D echo, vegetations are seen on the mitral valve. What is the likely etiology of his altered sensorium?",
    "choices": [
      {
        "id": 1,
        "text": "Septic shock"
      },
      {
        "id": 2,
        "text": "Septic emboli"
      },
      {
        "id": 3,
        "text": "Cerebral vasospasm"
      },
      {
        "id": 4,
        "text": "Demyelination"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>This patient has altered sensorium in the setting of <strong>fever,</strong> and <strong>vegetations</strong> on 2D ECHO. The most probable diagnosis for this patient would be <strong>infective endocarditis</strong> (IE) with <strong>septic emboli</strong> to the brain leading to infections and the symptoms of altered sensorium.\u00a0</p>\n<p>Cardiac manifestations of IE:</p>\n<ul>\n<li>Presence of new <strong>regurgitant</strong> murmurs</li>\n<li><strong>Congestive heart failure</strong> due to valve dysfunction</li>\n<li><strong>Perivalvular abscesses</strong> and <strong>intracardiac fistulae</strong> - This is caused due to the extension of infection beyond the valves and into the adjacent myocardial tissue</li>\n<li><strong>Conduction</strong> system defects- due to the damage of the interventricular septum by the abscess.</li>\n<li><strong>Embolization</strong> of coronary arteries</li>\n</ul>\n<p>Noncardiac manifestations of IE are:</p>\n<ul>\n<li><strong>Arterial emboli-</strong> causing pain of ischemia of the organs</li>\n<li><strong>Osler's</strong> nodes -are painful, red, nodular lesions usually located in the pads of the fingers and toes</li>\n<li><strong>Roth's</strong> spots- retinal hemorrhages with a pale center</li>\n<li><strong>Janeway</strong> lesions- In contrast to Osler's nodes, these are faint, red, painless macules on palms and soles. They occur as a result of septic embolization and are commonly associated with staphylococcal IE.</li>\n<li><strong>Splenic</strong> abscess</li>\n<li><strong>Cerebral</strong> abscess</li>\n<li>Immune-complex mediated glomerulonephritis</li>\n<li>Positivity for rheumatoid factor</li>\n<li>Petechiae on oral and conjunctival mucosa</li>\n<li>Splinter subungual hemorrhages-painless, dark red lines in the nailbed.</li>\n<li>Mycotic aneurysms</li>\n<li>Splenomegaly</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A middle-aged man with a history of chronic alcohol comsuption presented to the casualty with confusion, ataxia and diplopia. What is the protocol to treat this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Thiamine injection followed by glucose infusion"
      },
      {
        "id": 2,
        "text": "Glucose infusion followed thiamine injection"
      },
      {
        "id": 3,
        "text": "Glucose infusion alone"
      },
      {
        "id": 4,
        "text": "Thiamine injection alone"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Diplopia, ataxia and confusion in a patient with chronic alcohol consumption\u00a0 is suggestive of <strong>Wernicke's\u00a0encephalopathy.\u00a0</strong>The current standard of treatment for patients with symptoms of Wernicke's encephalopathy is to give<strong>\u00a0thiamine 100 mg intravenously before</strong> administering<strong> glucose-containing</strong>\u00a0IV<strong> fluids.</strong></p>\n<p>Thiamine deficiency\u00a0leads to the following:</p>\n<ol>\n<li><strong>Wernicke\u2019s encephalopathy:\u00a0</strong>It is more commonly seen in alcoholics with chronic thiamine deficiency. It is characterized by global confusion, truncal ataxia, ophthalmoplegia and horizontal nystagmus.</li>\n<li><strong>Korsakoff psychosis:</strong> Symptoms in addition to those of Wernicke's encephalopathy include memory loss and <strong>confabulation</strong></li>\n<li><strong>Beriberi:\u00a0</strong>It can be either -\n<ul>\n<li><strong>Dry</strong> beriberi: Sensorimotor peripheral neuropathy, muscle weakness</li>\n<li><strong>Wet</strong> beriberi: Tachycardia, cardiomegaly, high-output cardiac failure</li>\n</ul>\n</li>\n</ol>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the earliest symptom of hepatic encephalopathy?",
    "choices": [
      {
        "id": 1,
        "text": "Mood changes"
      },
      {
        "id": 2,
        "text": "Asterixis"
      },
      {
        "id": 3,
        "text": "Altered sleep pattern"
      },
      {
        "id": 4,
        "text": "Disorientation"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The <strong>earliest symptom</strong> of hepatic encephalopathy is an<strong> alteration in sleep pattern</strong>.</p>\n<p>Other<strong> signs and symptoms</strong> of <strong>hepatic encephalopathy</strong> include:&nbsp;</p>\n<ul>\n<li>Asterixis also called the flapping tremor</li>\n<li>Mood changes and inappropriate behavior</li>\n<li>Disorientation and confusion</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 57 year old male is brought with complaints of progressive loss of cognitive function. His symptoms began 2 years ago, and he had a noticeable worsening again 1 year ago and 6 months ago with progressive worsening of symptoms. He is oriented only to person and place but not time. He has a past history of diabetes and hypertension. Which of the following investigations should be done next?",
    "choices": [
      {
        "id": 1,
        "text": "Serum D-dimer"
      },
      {
        "id": 2,
        "text": "Brain biopsy"
      },
      {
        "id": 3,
        "text": "Lumbar puncture"
      },
      {
        "id": 4,
        "text": "MRI brain"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>In the given patient, who is a known case of <strong>hypertension</strong> and <strong>diabetes mellitus</strong>, now presenting with <strong>stepwise deteriorating cognitive function</strong> with 3 different discrete time periods where he had a noticeable worsening of symptoms, the likely diagnosis is <strong>vascular dementia.</strong> Diagnosis of vascular dementia is usually made by finding <strong>lesions</strong> via an <strong>MRI</strong> of the <strong>brain.</strong></p>\n<p>Vascular dementia is the second most prevalent form of dementia, after Alzheimer disease. It includes any <strong>dementia</strong> which is primarily <strong>caused</strong> <strong>by</strong> a <strong>cerebrovascular disease</strong> or <strong>impaired cerebral blood flow</strong>. Any cause of <strong>ischemic stroke</strong> (like atheroembolism), <strong>intracerebral hemorrhage</strong>, or <strong>subarachnoid hemorrhage</strong> can cause vascular dementia if the underlying injury to the brain is severe enough. Aside from a clinical stroke, cerebral small vessel diseases such as <strong>arteriosclerosis</strong> and <strong>cerebral amyloid angiopathy</strong> can also lead to vascular dementia.</p>\n<p>The patient will likely have a <strong>vascular risk factor</strong> (<strong>hypertension</strong>, <strong>diabetes mellitus</strong>, <strong>dyslipidemia</strong>, tobacco use or <strong>atrial fibrillation</strong>), a history of prior stroke, or transient ischemic attack. There will usually be a <strong>stepwise decline</strong> in the patient's mental state due to a series of unrecognized strokes. <strong>E</strong><strong>xecutive functions</strong> (such as planning and organization) are likely to be <strong>affected</strong> <strong>more</strong> and early in the disease course. This is in contrast to <strong>Alzheimer's disease</strong>, where there's a <strong>slow progression</strong> and <strong>recent episodic memory</strong> is affected first.</p>\n<p>Diagnosis is usually clinical based on the history but lesions in the brain can be visualised by an MRI.\u00a0</p>\n<p>Treatment is mainly aimed at preventing further strokes via pharmacotherapy and supportive therapy.</p>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 64-year-old man with recurrent symptoms of blurred vision now presents with confusion and disorientation. The serum gamma gap is >3 g/dl and the predominant component is IgM. What is the most appropriate treatment for this patient's altered mental status?",
    "choices": [
      {
        "id": 1,
        "text": "Chemotherapy"
      },
      {
        "id": 2,
        "text": "IV Immunoglobulin"
      },
      {
        "id": 3,
        "text": "Plasmapheresis"
      },
      {
        "id": 4,
        "text": "Phlebotomy"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>This patient presents with altered mental status with a history of <strong>recurrent blurriness</strong> of vision. This, combined with the serum <strong>gamma gap</strong> of &gt;3mg/dl and an <strong>IgM predominance</strong> makes <strong>Waldenstorm's Macroglobulinemia(WM)</strong> the likely diagnosis. The next step in the management of this patient's altered mental status is with <strong>plasmapheresis.</strong>\u00a0</p>\n<p>WM is a condition characterized by <strong>monoclonal proliferation</strong> of <strong>Plasma cells</strong> that overproduces <strong>IgM.</strong> These antibodies increase the <strong>viscosity</strong> of the blood. These antibodies also lead to an increase in the serum gamma gap &gt; 3g/dl. The <strong>treatment</strong> of <strong>choice</strong> is <strong>plasmapheresis</strong> which helps in removing the excessive <strong>IgM</strong> in the <strong>plasma</strong> thus relieving the <strong>hyperviscosity</strong> symptoms.\u00a0</p>\n<p>Waldenstr\u00f6m\u2019s macroglobulinemia is a plasma cell disorder that results in <strong>increased proliferation</strong> of <strong>memory</strong> <strong>B</strong> cells. These cells produce large amounts of IgM leading to the <strong>classic hyperviscosity</strong> syndrome. Most commonly, they present with <strong>fatigue, weakness,</strong> and <strong>oozing</strong> of <strong>blood</strong> from the nasal or oral cavity.\u00a0 Patients also present with <strong>anemia, lymphadenopathy, hepatosplenomegaly, hyperviscosity,</strong> or <strong>peripheral neuropathy.</strong> When the hyperviscosity progresses to involve the <strong>CNS,</strong> it can occlude the <strong>vessels</strong> in the <strong>CNS</strong> and can lead to <strong>altered mental status.</strong>\u00a0</p>\n<p>Hematological examination reveals <strong>Coombs\u2019 positive test</strong> and <strong>rouleaux</strong> fobrmation. This condition also has a greater incidence of <strong>normocytic normochromic anemia.</strong></p>\n<p>The <strong>hyperviscosity</strong> state can be treated by <strong>plasmapheresis.</strong> However, most patients do not <strong>require therapy</strong> unless they are <strong>symptomatic</strong> (altered mental status, anemia, lymphadenopathy, <strong>hepatosplenomegaly.)</strong> It can be treated with <strong>ibrutinib</strong> which targets the activated BTK mutation. Rituximab with cyclophosphamide can also be used.\u00a0</p>\n<p>Other options:</p>\n<p>Option A: <strong>Chemotherapy</strong> is usually not indicated in Waldenstrom\u2019s macroglobulinemia if the patient is <strong>asymptomatic.</strong> In <strong>symptomatic</strong> cases, initial treatment should be <strong>attempted</strong> with <strong>plasmapheresis</strong> first.\u00a0</p>\n<p>Option B: IV <strong>immunoglobulin</strong> is used to treat <strong>autoimmune polyneuropathies</strong> like <strong>Guillain Barre</strong> syndrome. It has no role in <strong>Waldenstrom\u2019s macroglobulinemia.</strong></p>\n<p>Option D: <strong>Phlebotomy</strong> is the treatment for <strong>polycythemia vera</strong> and does not have a role in Waldenstrom\u2019s macroglobulinemia.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A known patient of parkinsonism, taking levodopa for the past 2 years, presents to you with disorientation, confusion, and altered sensorium. You try to reduce the dose of levodopa but it worsens the motor symptoms and the presenting symptoms persist despite reducing the dose. Which of the following drugs is best suited for managing this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Clozapine"
      },
      {
        "id": 2,
        "text": "Lorazepam"
      },
      {
        "id": 3,
        "text": "Diazepam"
      },
      {
        "id": 4,
        "text": "Haloperidol"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Clozapine&nbsp;</strong>is&nbsp;recommended in the above given clinical scenario.</p>\n<p>The patient presents with disorientation, confusion and altered sensorium. This is suggestive of delirium. <strong>Antiparkinsonian agents</strong> are frequently implicated in causing delirium because of dopamine increase.</p>\n<p>Decreasing the dosage of the antiparkinsonian agent has to be weighed against a worsening of motor symptoms.</p>\n<p><strong>Clozapine</strong>&nbsp;is recommended when:</p>\n<ul>\n<li>The antiparkinsonian agents cannot be further reduced</li>\n<li>Delirium persists even after reducing the dose of antiparkinsonian agents.</li>\n</ul>\n<p>If a patient is not able to tolerate clozapine, alternative antipsychotic agents should be considered.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 58-year-old man presents to your clinic following seizures. He has had a persistent dry cough for 6 months, and he has smoked one pack of cigarettes daily for 35 years. He is confused and oriented only to person. Laboratory studies show a serum sodium concentration of 119 mEq/L and a glucose concentration of 102 mg/dL. The hilar mass in the x-ray shown below is biopsied and reveals small cell carcinoma. Which of the following laboratory findings will not be seen in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Low urine osmolality"
      },
      {
        "id": 2,
        "text": "Hyponatremia"
      },
      {
        "id": 3,
        "text": "Low serum osmolality"
      },
      {
        "id": 4,
        "text": "Elevated urine sodium"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The clinical vignette of a chronic smoker presenting with <strong>seizures, lethargy,</strong> and<strong> altered mental status</strong> in the setting of <strong>hyponatremia</strong> and the x-ray showing an <strong>irregular, poorly demarcated mass</strong> at the right hilum is suggestive of a<strong> Syndrome of Inappropriate Antidiuretic Hormone Secretion</strong>\u00a0(SIADH) secondary to underlying small cell lung cancer. SIADH results in a <strong>high urine osmolality</strong> (concentrated urine) rather than a low osmolality.</p>\n<p>SIADH can be associated with several different tumors such as that of the lung, ovaries, pancreas, and bladder. In this condition, <strong>ectopic vasopressin</strong> is produced by <strong>small-cell lung cancer</strong>, which is a neuroendocrine tumor.</p>\n<p><strong>Ectopic vasopressin</strong> increases the anti-diuretic property of the kidney,\u00a0<strong>decreasing renal clearance and leading to SIADH.</strong> This causes increased <strong>free water retention</strong>, leading to <strong>hyponatremia </strong>(low serum osmolality) and <strong>concentration of urine,</strong> resulting in elevated urine osmolality.\u00a0Water retention reduces serum osmolality, causing a transient volume expansion. This stimulates a release of ANP and BNP and reduces levels of aldosterone. Together, these processes<strong>\u00a0increase urinary\u00a0sodium</strong>\u00a0and water excretion, thereby causing<strong> euvolemic\u00a0hyponatremia.</strong></p>\n<p><strong>Treatment</strong> involves the administration of <strong>conivaptan</strong> or\u00a0<strong>tolvaptan</strong> (vasopressin receptor V2 antagonist), <strong>demeclocycline,</strong> and <strong>fluid restriction</strong> to less than 500 mL (although this can be difficult).</p>\n<p>In <strong>severe cases</strong>, correction of hyponatremia is done by administering IV fluids with <strong>hypertonic normal saline</strong> along with diuretics such as furosemide (to increase free water clearance). In tumor-associated SAIDH, treatment of the underlying malignancy also helps in resolving hyponatremia.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/8aeb12a579384572b0cb4d13dfdf4437.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 2-year-old boy is brought with new onset irritability and decreased concentration. He has also recently had an ataxic gait. The child is found to have an intra-abdominal mass. Examination findings are shown below. What is the most likely diagnosis in this boy?",
    "choices": [
      {
        "id": 1,
        "text": "Wilm's tumor"
      },
      {
        "id": 2,
        "text": "Neuroblastoma"
      },
      {
        "id": 3,
        "text": "Rhabdomyosarcoma"
      },
      {
        "id": 4,
        "text": "Hepatoblastoma"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">This patient is presenting with a <strong>dancing movement</strong> of the eyes called <strong>Opsoclonus.</strong> This in the presence of an <strong>abdominal mass</strong> should raise suspicions of a syndrome known as <strong>Opsoclonus-myoclonus</strong> syndrome seen in <strong>neuroblastoma.</strong>\u00a0</span></p>\n<p>Neuroblastoma is a <strong>malignant</strong> tumor that is seen in <strong>young children</strong> (&lt;5 years). It is the <strong>most common extracranial tumor </strong>of<strong> childhood</strong>. It is <strong>derived</strong>\u00a0from <strong>neural crest cells </strong>of the adrenal medulla or the paravertebral sympathetic chain\u00a0and is most commonly found in the abdomen. Most children have <strong>metastatic</strong> disease at the <strong>time of diagnosis</strong>.\u00a0</p>\n<p>The common clinical features are:</p>\n<ul>\n<li><strong>intra-abdominal mass </strong>or<strong> paravertebral mass</strong></li>\n<li><strong>proptosis, periorbital bruising</strong> (raccoon eyes) due to orbital metastasis</li>\n<li>painless blue skin lesions (<strong>blueberry muffin syndrome</strong>) due to dissemination to the skin</li>\n<li><strong>opsoclonus-myoclonus syndrome</strong> (rapid nystagmus + involuntary limb spasms)</li>\n</ul>\n<p>This tumor often crosses the spine in the midline, and this can help to differentiate it from a Wilm's tumor which is mostly unilateral in nature.\u00a0</p>\n<p>The diagnosis can be made with a combination of <strong>biochemical tests</strong> (vanillylmandelic acid [<strong>VMA</strong>], homovanillic acid [<strong>HVA</strong>], <strong>dopamine</strong>, noradrenaline) and <strong>imaging studies</strong> (CT/MRI). <strong>Stagin</strong>g of the tumor is done on the basis of the International Neuroblastoma Staging System. <strong>CT, bone scan,\u00a0</strong>meta-iodobenzylguanidine <strong>(MIBG) scan,</strong> and <strong>bone marrow aspiration</strong> are required for accurate staging.\u00a0</p>\n<p>Based on the stage of the tumor it is risk stratified. <strong>Low-risk</strong> patients are managed with <strong>only surgery.</strong> <strong>Intermediate-risk</strong> patients are offered <strong>surgery as well as adjuvant chemotherapy</strong> (carboplatin, cyclophosphamide, etoposide, doxorubicin). <strong>High-risk</strong> patients are managed with<strong> initial high-dose multiagent chemotherapy followed by surgery.</strong></p>\n<p><strong>N-myc amplification </strong>is associated with a <strong>poor prognosis.</strong></p>\n<p>Other options:</p>\n<p>Option (A): Wilm's tumor can present with an intraabdominal mass, but there is usually no involvement of the orbits or opsoclonus myoclonus.</p>\n<p>Option (C): Rhabdomyosarcoma can be seen in the head and neck and genitourinary tract most commonly. It can involve the orbit, but would not present with opsoclonus myoclonus.</p>\n<p>Option (D): Hepatoblastoma usually presents with nonspecific symptoms of abdominal discomfort, weight loss, and anorexia. It can also present as an abdominal mass, but it too will not have features of orbital metastasis or opsoclonus myoclonus syndrome.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/806e325e8138471487ab21fd1f0d4f38.GIF"
    ],
    "explanation_images": []
  },
  {
    "text": "A 25-year-old male was brought in by his parents because their son was speaking to himself and had stopped going outside. At night he locks himself up in his room to do cleansing rituals for the demons. These symptoms have been present for 2 months. What is your diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Schizophrenia"
      },
      {
        "id": 2,
        "text": "Schizoaffective disorder"
      },
      {
        "id": 3,
        "text": "Schizophreniform disorder"
      },
      {
        "id": 4,
        "text": "Schizoid personality disorder"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The patient has an auditory hallucination, reduced affect, and disorganised behaviour <strong>within 6 months,</strong> which is suggestive of\u00a0<strong>Schizophreniform disorder</strong>.</p>\n<p><strong>Diagnostic criteria for schizophrenia (DSM V)</strong>:</p>\n<p class=\"p1\">1. The DSM-5 criteria to diagnose schizophrenia require a total duration of 6 months.</p>\n<p class=\"p1\">2. Within this 6-month period, there must be at least <strong>1 month</strong> of active-phase symptoms (overt psychotic symptoms) where 2 or more of the following have to be present :\u00a0</p>\n<ol style=\"list-style-type: lower-alpha;\">\n<li><strong>Delusion</strong></li>\n<li><strong>Hallucination</strong></li>\n<li><strong>Disorganized</strong> speech (or formal thought disorder)</li>\n<li><strong>Disorganized</strong> behaviour</li>\n<li>Affective flattening or other negative symptoms</li>\n</ol>\n<p>At least one must be among the a, b, or c.</p>\n<p class=\"p1\">3. The rest of the 6-month period may include</p>\n<ul>\n<li class=\"p1\"><strong>continuing</strong> psychotic symptoms</li>\n<li class=\"p1\">prodromal symptoms preceding clear-cut psychosis</li>\n<li class=\"p1\">residual symptoms after the resolution of the psychotic symptoms</li>\n</ul>\n<p>4. Residual symptoms are defined as attenuated forms of psychotic symptoms, such as</p>\n<ul>\n<li><strong>odd beliefs</strong></li>\n<li>magical thinking</li>\n<li>ideas of reference</li>\n<li>odd perceptual experiences</li>\n<li>peculiar or concrete thinking</li>\n<li>vague speech</li>\n<li>odd behaviour</li>\n<li>Negative symptoms may also be included</li>\n</ul>\n<p>5. Exclusion of mood disorder &amp; substance abuse</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient is brought to the casualty due to new onset confusion and agitation for the last 3 days. He takes diuretics for hypertension. On examination, serum sodium is found to be 121mEq/L. What should be done to manage his condition?",
    "choices": [
      {
        "id": 1,
        "text": "Restrict water intake till Na+ levels are normalised"
      },
      {
        "id": 2,
        "text": "Administer 500ml Boluses of hypertonic saline till confusion resolves"
      },
      {
        "id": 3,
        "text": "Infusion of hypertonic saline at 1ml/kg/hr till confusion resolves"
      },
      {
        "id": 4,
        "text": "Administer Tolvaptan thrice daily"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>This patient presenting with <strong>altered mental status</strong> with a <strong>history of diuretic use</strong> now has symptomatic <strong>hyponatremia</strong>. When Na+ levels are less than 125mEq/L, and the patient is symptomatic, the next step in management is to <strong>administer hypertonic saline infusion at 1ml/kg/hr</strong> till the confusion resolves. After this, the patient should be <strong>shifted to a slow infusion of 0.9% Normal saline at 0.5 mEq/hr.</strong>\u00a0</p>\n<p>Hyponatremia is the term used to describe serum sodium levels less than 135mEq/L. It can be classified further based on the etiology and osmotic status of the patient:</p>\n<p>the types of hyponatremia, as classified according to the volume status of the patient, described below:\u00a0</p>\n<ul>\n<li><strong>Hypovolemic hyponatremia,</strong> patients have a <strong>volume deficit</strong> due to loss of fluids rich in sodium. There is volume depletion but the depletion of sodium is relatively more than the depletion of water. This may be due to extra-renal or renal causes.In the case of extra-renal causes, there is hypovolemia due to fluid loss in conditions such as diarrhoea, vomiting, burns, etc. due to which sodium is lost along with the fluid and hence urine sodium concentration will also be low. However, in case of renal loss, the sodium is lost at the nephron level itself, causing increased urine sodium concentration, as seen in adrenal insufficiency.</li>\n<li><strong>Euvolemic hyponatremia,</strong> there is no volume depletion, but low sodium concentration relative to the total body water, as seen in conditions such as hypothyroidism and SIADH.</li>\n<li><strong>Hypervolemic hyponatremia,</strong> patients are in a condition of fluid overload. In case of fluid overload due to acute or chronic renal failure, urine sodium concentration will be high.\u00a0<br />In case of fluid overload due to cirrhosis, CCF and nephrotic syndrome, urine sodium concentration will be low.</li>\n</ul>\n<p>Management of hyponatremia:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8c82cd1c45114b5dae563bc4637721e1x1280x1248.JPEG"
    ]
  },
  {
    "text": "A patient at 34 weeks of gestation is brought with decreased attention, clumsiness while walking, and headache since 12 hours. BP is found to be 190/110 mmHg. MRI of the brain shows areas of hypointensity on T1 flair in the occipital region. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Cerebrovascular accident"
      },
      {
        "id": 2,
        "text": "Posterior reversible encephalopathy syndrome"
      },
      {
        "id": 3,
        "text": "Cerebral venous thrombosis"
      },
      {
        "id": 4,
        "text": "Subarachnoid haemorrhage"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>This patient at 34 <strong>weeks</strong> of <strong>gestation</strong> now presents with altered sensorium and high blood pressure. The presence of <strong>hypointensities</strong> on T1 weighted MRIs in the <strong>occipital region</strong> makes a diagnosis of <strong>Posterior reversible encephalopathy syndrome</strong> the likely diagnosis.\u00a0</p>\n<p><strong>PRES </strong><span style=\"text-decoration: underline;\">(</span>Posterior Reversible Encephalopathy Syndrome)can occur with head injury, migraine, seizures, <strong>eclampsia</strong> and in the <strong>postpartum</strong> period. It is a <strong>hyperperfusion</strong> state with <strong>widespread</strong> segmental <strong>vasoconstriction</strong> and <strong>cerebral edema.</strong> Patients present with headaches and fluctuating neurologic signs and symptoms, especially visual symptoms.</p>\n<p>MRI shows <strong>edema</strong> predominantly in the <strong>occipital lobes,</strong> seen as <strong>hypointensities</strong> on <strong>T1</strong> flair. It can be generalized, but it is not confined to any single vascular territory. Ischaemia reverses completely.</p>\n<p>Treatment is by slowly reducing the high blood pressure with IV drugs.</p>\n<p>Other options:\u00a0</p>\n<p>Option A: A <strong>Cerebrovascular accident</strong> can present with <strong>loss</strong> of <strong>function</strong> or <strong>weakness</strong> of <strong>limbs, </strong>signs of ataxia, or loss of sensory signaling based on the region affected\u00a0due to ischemia or bleeding. However, this patient has no history of weakness, and the findings of the MRI make PRES more likely.\u00a0</p>\n<p>Option C: <strong>Cerebral venous thrombosis</strong> presents with similar symptoms however, <strong>MRI</strong> will show a <strong>clot visible. Hypointensities</strong> in the <strong>posterior lobe</strong> is characteristic of PRES.</p>\n<p>Option D: <strong>Subarachnoid hemorrhage</strong> can present with similar features but <strong>MRI</strong> will show a <strong>hyperintensity</strong> in the <strong>subarachnoid</strong> region on <strong>T1</strong> flair</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You are evaluating a patient post a neurosurgical procedure. The patient opens her eyes in response to a loud voice, localizes pain, and is confused and disoriented. What is the GCS score of this patient?",
    "choices": [
      {
        "id": 1,
        "text": "E3M5V4"
      },
      {
        "id": 2,
        "text": "E3M6V5"
      },
      {
        "id": 3,
        "text": "E4M4V5"
      },
      {
        "id": 4,
        "text": "E3M5V5"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>In this patient, GCS is&nbsp;<strong>E3M5V4</strong></p>\n<ul>\n<li>Eye-opening to loud voice - 3</li>\n<li>Motor response localizes pain - 5</li>\n<li>Verbal response is confused and disoriented - 4</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = 'Altered Mental Status Mini Test - -Tmt';
        const quizFilename = 'altered-mental-status-mini-test-tmt-b060f8ad.html';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2023-24"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>