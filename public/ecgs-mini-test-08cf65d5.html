<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ecgs Mini Test - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2024-25
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A 50-year-old woman with a history of mitral stenosis is brought unconscious to the ER. Her pulse rate is 140 bpm and BP is 80/60 mmHg. An ECG is obtained and is given below. Which of the following is the most appropriate management?",
    "choices": [
      {
        "id": 1,
        "text": "Anticoagulation with warfarin"
      },
      {
        "id": 2,
        "text": "Anticoagulation with novel anticoagulants"
      },
      {
        "id": 3,
        "text": "Transesophageal echocardiography"
      },
      {
        "id": 4,
        "text": "Synchronized cardioversion"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p style=\"text-align: left;\">The given ECG shows an<strong> irregularly irregular rhythm</strong> with <strong>absent P\u00a0waves</strong>, which is consistent with <strong>atrial fibrillation</strong>. Since the patient is <strong>hemodynamically compromised</strong> (hypotension),\u00a0<strong>synchronized cardioversion</strong> is the most appropriate management.</p>\n<p><strong>Urgent</strong> <strong>electrical cardioversion</strong> is indicated if a patient with AF has a <strong>shock</strong> or severe hypotension, pulmonary edema, or ongoing myocardial infarction. Although there is a risk of potential thromboembolism<strong> </strong>if the patient has not been put on anticoagulation before, the need for<strong> </strong>rate control outweighs this risk. In these patients, control of the heart rate is achieved using <strong>IV \u03b2-blockers </strong>or <strong>calcium channel blockers</strong> (like verapamil or diltiazem). Additionally, they are also given <strong>subcutaneous low-molecular-weight heparin </strong>as soon as possible.</p>\n<p>In <strong>hemodynamically stable patients</strong> with <strong>AF of &gt;48 hours duration</strong>\u00a0or\u00a0<strong>unknown</strong>\u00a0<strong>duration</strong>, there is a\u00a0high risk of formation of a<strong> thrombus\u00a0</strong>in the left atrium. If the patients are cardioverted at this stage, this thrombus can\u00a0<strong>embolize </strong>into the systemic circulation, leading to end organ damage, such as\u00a0<strong>stroke</strong>. Therefore, for these patients, any of the following two management strategies can be followed:</p>\n<ul>\n<li>Give\u00a0<strong>anticoagulation</strong>\u00a0for\u00a03 weeks\u00a0\u2192\u00a0<strong>cardioversion</strong>\u00a0(pharmacological or electrical) \u2192 continue\u00a0<strong>anticoagulation</strong>\u00a0for\u00a04 more weeks</li>\n<li>Start\u00a0<strong>anticoagulation</strong>\u00a0and do\u00a0<strong>transesophageal echocardiography</strong> \u2192 if the <strong>thrombus</strong>\u00a0is\u00a0<strong>absent</strong>, do <strong>cardioversion</strong>\u00a0(pharmacological or electrical) \u2192\u00a0<strong>continue anticoagulation</strong>\u00a0for\u00a04\u00a0more\u00a0weeks. If a\u00a0<strong>thrombus</strong>\u00a0is\u00a0<strong>present</strong>, then <strong>cardioversion</strong>\u00a0is\u00a0delayed by 3 weeks</li>\n</ul>\n<p><strong>Direct-acting oral anticoagulants (DOACs</strong>) are\u00a0<strong>preferred</strong>\u00a0over warfarin for anticoagulation. However,\u00a0<strong>warfarin</strong>\u00a0is the\u00a0<strong>preferred</strong>\u00a0drug if the patient has a\u00a0<strong>mechanical prosthetic valve</strong>, advanced CKD, or moderate-severe <strong>mitral stenosis</strong>.</p>\n<p>Apart from anticoagulation, the most important aspect of the treatment of chronic AF is <strong>rate control</strong>. The drugs used for this are\u00a0<strong>\u03b2 blockers (such as metoprolol)</strong>\u00a0and\u00a0<strong>calcium channel blockers</strong>\u00a0(such as\u00a0<strong>diltiazem</strong>\u00a0and\u00a0<strong>verapamil</strong>). Reversion to sinus rhythm can be done electrically or using medications. Pharmacological cardioversion can be done using ibutilide,\u00a0dofetilide\u00a0and\u00a0amiodarone\u00a0(class III antiarryhthmics) or\u00a0flecainide\u00a0and\u00a0propafenone\u00a0(class Ic drugs).</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c1defa8be1334905b646033861ce6c86.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ad6bd76f35344f0591d1cbbe8eaa0445x1280x2221.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8bacdaceda1741cd8c8692cc917d80c7x1280x2207.JPEG"
    ]
  },
  {
    "text": "Which of the following conditions is associated with the abnormality depicted in the given ECG?",
    "choices": [
      {
        "id": 1,
        "text": "Cardiac tamponade"
      },
      {
        "id": 2,
        "text": "Chronic obstructive pulmonary disease"
      },
      {
        "id": 3,
        "text": "Type-1 atrioventricular block"
      },
      {
        "id": 4,
        "text": "Dextrocardia"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given ECG shows inverted P waves, negative QRS in lead I, and reversal of normal r wave progression. The condition associated with these findings is <strong>dextrocardia</strong>.\u00a0</p>\n<p>Dextrocardia is the<strong> </strong>abnormal position of the heart on the right side of the chest or in the midline. It may be seen as an isolated condition\u00a0or as a part of\u00a0<strong>situs inversus</strong>, where the other organs are also inverted in position. Situs inversus is associated with <strong>Kartagener's syndrome </strong>(a triad of situs inversus, chronic sinusitis, and bronchiectasis).\u00a0</p>\n<p>Findings suggestive of dextrocardia:</p>\n<ul>\n<li><strong>Inverted P waves</strong> in Lead I and aVL</li>\n<li><strong>Negative QRS complex</strong> and T wave in Lead I</li>\n<li>Lead I: inversion of all complexes, aka \u2018global negativity\u2019 i.e. inverted P wave, negative QRS, inverted T wave</li>\n<li><strong>Reversal of normal r-wave progression</strong> across the precordium</li>\n</ul>\n<p>Most patients are <strong>asymptomatic</strong>. Some may present with varying symptoms due to other coexisting congenital diseases.\u00a0</p>\n<p>Other options:</p>\n<p>Option A -\u00a0Cardiac tamponade would present with <strong>reduced amplitude </strong>of the<strong> QRS</strong> complexes and <strong>electrical alternans</strong> on the ECG.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/aaafc8e65b7b4c888043ed6bf25503ee.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0b302fa75a094caa993fab04263ec02dx1280x615.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c1a5170536d74c6eaf5467bbbb124efcx765x417.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b64a2f12a3e9488199dc6a12761aa4e1x1280x609.JPEG"
    ]
  },
  {
    "text": "While taking ward rounds, you come across the ECG of a patient, and changes include ST-depression, flat T waves, and prominent U waves. Which of the following can cause such an ECG?",
    "choices": [
      {
        "id": 1,
        "text": "Chronic use of vitamin A"
      },
      {
        "id": 2,
        "text": "Non-anion-gap metabolic acidosis"
      },
      {
        "id": 3,
        "text": "Prolonged use of enalapril"
      },
      {
        "id": 4,
        "text": "Rapid insulin infusion"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Based on the ECG changes described, the likely diagnosis is <strong>hypokalemia</strong>. Hypokalemia may be caused by a rapid infusion of <strong>insulin.</strong> Insulin<strong> promotes Na<sup>+</sup>/K<sup>+</sup>ATPase-mediated cellular uptake</strong> of K<sup>+</sup>, leading to hypokalemia.</p>\n<p>Hypokalemia is defined as a plasma concentration of K<sup>+</sup>\u00a0<strong>&lt;3.5 meq/L</strong>. Common causes include\u00a0metabolic alkalosis,<strong> insulin infusions</strong>, diarrhea, use of\u00a0diuretics, starvation, and\u00a0\u03b22-agonists. It can also be seen after massive blood transfusions and in cystic fibrosis. It affects the cardiac, skeletal, and intestinal cells. It can lead to\u00a0<strong>arrhythmias</strong>\u00a0and<strong>\u00a0intestinal ileus</strong> and increase the risk for rhabdomyolysis.</p>\n<p>ECG changes include\u00a0<strong>ST depression</strong>,<strong>\u00a0prominent U waves</strong>, and prolonged repolarization.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5961454548794066ad7fa15d553e511fx720x356.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/df3d417e55f440e3b006c2ef1dffba00x1280x2207.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b05b52af773f4199880e65d2c3573600x1280x1158.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0e015082b185490da2646d511cc399a9x778x600.JPEG"
    ]
  },
  {
    "text": "A 50-year-old male patient is undergoing perioperative risk assessment for bariatric surgery. His BMI is 42 kg/m2. On physical examination, his pulse rate is 74/minute, blood pressure 150/90 mm Hg, and respiratory rate is 17/minute. He has a history of hypertension on medications, chronic hepatitis C, and a myocardial infarction (MI) 6 months ago. His ECG strip is shown below. What is his American Society of Anaesthesiologists (ASA) classification?",
    "choices": [
      {
        "id": 1,
        "text": "ASA II"
      },
      {
        "id": 2,
        "text": "ASA V"
      },
      {
        "id": 3,
        "text": "ASA IV"
      },
      {
        "id": 4,
        "text": "ASA III"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The image shows an ECG strip taken from a patient with an <strong>implanted ventricular pacemaker.</strong></p>\n<p>The cardinal manifestation of pacing on a surface ECG is the <strong>stimulation artifact.</strong> In ventricular pacing, the <strong>vertical pacing spike will precede the QRS complex</strong>. Ventricular pacing also <strong>yields a wide QRS complex </strong>with an <strong>LBBB pattern</strong>.</p>\n<p>This patient has a BMI &gt;=40 kg/m2, hypertension on medications, chronic hepatitis C, a history of MI 6 months ago (&gt; 3 months), and a pacemaker, which places him in the category of <strong>ASA\u00a0III.</strong><br />ASA grading is a physical status examination that strongly correlates with the perioperative risk.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/8eab8e87388945658825f8267a641d68.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Match the following:",
    "choices": [
      {
        "id": 1,
        "text": "1- a, 2- c, 3- b, 4- d"
      },
      {
        "id": 2,
        "text": "1- c, 2- a, 3- d, 4- b"
      },
      {
        "id": 3,
        "text": "1- b, 2- d, 3- c, 4- a"
      },
      {
        "id": 4,
        "text": "1- d, 2- b, 3- a, 4- c"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The correctly matched pairs are 1-c, 2-a, 3-d, and 4-b.</p>\n<p>The different types of heart blocks are:</p>\n<p><strong>First Degree Heart Block: </strong>It occurs due to <strong>slowing of conduction</strong> through the AV junction.<strong>\u00a0</strong>It is characterized by prolonged <strong>PR &gt; 0.2s</strong> and <strong>equal RR</strong> intervals.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/399c83780a6c4e1cb0ff253b18da81b2.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/bb2b1bf5fccd42d69c29723f44fe0ad7x436x132.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/eeba5011417b4da7a5c8584dc8401b57x436x135.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/fe5f3695d29449e391e74d1f2dd270b5x442x133.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3b00c73226bc4034885522477f638e27x434x125.PNG"
    ]
  },
  {
    "text": "An elderly male patient was brought to the hospital with complaints of palpitations and dizziness. His vitals are stable, and the ECG shows the following. What is the most appropriate next step?",
    "choices": [
      {
        "id": 1,
        "text": "IV esmolol"
      },
      {
        "id": 2,
        "text": "IV adenosine"
      },
      {
        "id": 3,
        "text": "Electrical cardioversion"
      },
      {
        "id": 4,
        "text": "IV nicardipine"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In the given ECG, the presence of\u00a0<strong>narrow-complex regular tachycardia</strong>\u00a0and P-waves occurring after QRS complexes, known as<strong>\u00a0retro P waves</strong>\u00a0or\u00a0<strong>pseudo-r' waves</strong>\u00a0(especially prominent in lead V1) point to a diagnosis of\u00a0<strong>paroxysmal supraventricular tachycardia (PSVT)</strong>. In this patient, the <strong>next step</strong> would be the administration of <strong>IV adenosine</strong>.</p>\n<p>PSVT is an arrhythmia characterized by a sudden onset and offset with rapid ventricular response. It\u00a0includes\u00a0<strong>atrioventricular nodal reentry tachycardia</strong>, junctional tachycardia, and AV reentry tachycardia.</p>\n<p><strong>Initial management</strong>\u00a0of PSVT is by <strong>vagal maneuvers</strong> such as\u00a0<strong>carotid massage, Valsalva maneuver, </strong>and<strong> </strong>breathing against pressure in a syringe. Vagal maneuvers <strong>increase</strong> the <strong>parasympathetic</strong> <strong>discharge</strong>, thus <strong>slowing</strong> <strong>down</strong> the <strong>conduction</strong> <strong>through</strong> the <strong>AV node</strong> and terminating the arrhythmia. <strong>Carotid sinus massage</strong> is <strong>avoided</strong> if the patient has a <strong>carotid bruit</strong>.\u00a0</p>\n<p>If this method is ineffective, intravenous adenosine is used. It can terminate the majority of PSVT\u00a0episodes<strong>\u00a0</strong>by blocking the conduction at the AV node. If adenosine is also ineffective in terminating the arrhythmia, <strong>IV</strong> <strong>\u03b2</strong> <strong>blockers</strong> (esmolol, metoprolol) and <strong>IV non-DHP calcium channel blockers</strong> (verapamil and diltiazem) are used. Note that <strong>IV adenosine </strong>(option B)<strong> </strong>is<strong> preferred</strong> over <strong>\u03b2</strong> <strong>blockers </strong>and<strong> non-DHP CCBs </strong>(options A and D)<strong> </strong>for terminating PSVT because of its rapid onset, excellent success rate, and <strong>minimal negative inotropic effect</strong>.</p>\n<p><strong>Electrical cardioversion </strong>(option C) is done if the patient is <strong>hemodynamically unstable </strong>or if PSVT does not respond to any of the other methods mentioned above.</p>\n<p>The flowchart given below summarizes the treatment of PSVT:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a4ab2a9f9b524e94bf27e63879c505c3.GIF"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7669c98c31db4c5b9ff2cfb4942eeb45x1280x1416.JPEG"
    ]
  },
  {
    "text": "A 46-year-old male patient came to the emergency department with fever and severe constrictive chest pain that worsened with deep inspiration and on lying down. He had a myocardial infarction 2 weeks back. A pericardial friction sound was audible at the lower left sternal border. The electrocardiogram is given below.  Which of the following is not true regarding this condition?",
    "choices": [
      {
        "id": 1,
        "text": "It occurs 1 to 8 weeks post-MI"
      },
      {
        "id": 2,
        "text": "It is due to an infection in the pericardium"
      },
      {
        "id": 3,
        "text": "Aspirin is given as first line treatment"
      },
      {
        "id": 4,
        "text": "Colchicine can be used in treatment"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><span data-preserver-spaces=\"true\">The clinical scenario of a post-myocardial infarction (MI) patient presenting with pleuritic chest pain, fever, malaise, pericardial rub on auscultation, and the ECG given above showing diffuse ST-segment elevation with upward concavity are suggestive of </span><strong><span data-preserver-spaces=\"true\">Dressler syndrome. </span></strong></p>\n<p>Dressler syndrome/post-myocardial infarction syndrome is an <strong>autoimmune</strong> condition (option B) with inflammation of the pericardium. It presents as <strong>pleuritic chest pain</strong>, fever, malaise, and sometimes a pleuritic rub and effusion. The ECG findings include <strong>PR segment depression </strong>or<strong> ST-segment elevation. </strong>It commonly occurs<strong> 1\u20138 weeks</strong> after MI (option A). However, it can recur over months.</p>\n<p>Treatment:</p>\n<ul>\n<li>First-line therapy consists of<strong> aspirin 650 mg </strong>(option C)<strong> </strong>every 4 hours with\u00a0<strong>NSAIDs</strong> like Ibuprofen or Indomethacin</li>\n<li><strong>Colchicine </strong>(option D)<strong> </strong>enhances the response to NSAIDs and prevents recurrence</li>\n<li>Glucocorticosteroids and NSAIDs are best avoided in patients with Dressler syndrome within 4 weeks of STEMI as they may impair infarct healing, cause ventricular rupture, and increase coronary vascular resistance</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://upload.wikimedia.org/wikipedia/commons/thumb/7/7e/Pericarditis10.JPG/800px-Pericarditis10.JPG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 5-year-old patient is undergoing an abdominal laparoscopy under general anesthesia. During the surgery, the anesthetist notices that the monitor shows the findings below when the surgeon is manipulating the peritoneum. The blood pressure is 94/60 mm Hg. Which of the following is not true about this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Parasympathetic response via the vagal nerves is responsible for this condition"
      },
      {
        "id": 2,
        "text": "Intra-abdominal pressure should be 12\u201315 mmHg to avoid this response"
      },
      {
        "id": 3,
        "text": "Anticholinergic agents have no role in management of such cases"
      },
      {
        "id": 4,
        "text": "Same response may be seen while manipulating the extra ocular muscles in strabismus surgery"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><span data-preserver-spaces=\"true\">The given clinical vignette describes a <strong>vagal reflex</strong> that occurs in patients during abdominal laparotomy. The given ECG shows <strong>sinus bradycardia</strong> in this patient with an approximate heart rate of 40 bpm. <strong>Anticholinergics</strong>\u00a0like <strong>glycopyrrolate</strong> may be used in the medical management of this condition.\u00a0</span></p>\n<p><strong><span data-preserver-spaces=\"true\">Vagal responses:</span></strong></p>\n<ul>\n<li><span data-preserver-spaces=\"true\">Surgical manipulation may precipitate vagal responses (option A). Common examples would include bradycardia during <strong>manipulation of extraocular muscles </strong>(option D)\u00a0during strabismus surgery and peritoneal manipulation during laparotomy or laparoscopy</span></li>\n<li><span data-preserver-spaces=\"true\">Bradycardia leading to cardiac arrest has been a recognized complication of laparoscopy since its development</span></li>\n<li><span data-preserver-spaces=\"true\">Peritoneal stretch due to insufflation leads to an increase in vagal tone. This is seen in a large number of gynecological and general surgery cases</span></li>\n<li><span data-preserver-spaces=\"true\">The rate of CO2 insufflation is an important causative factor for the vagal responses. The fast and rapid rate has led to a strong response in many cases. To prevent this, the initial rate of insufflation is recommended to be maintained below <strong>15 L/min</strong></span></li>\n<li><span data-preserver-spaces=\"true\">Certain anesthetic agents, such as <strong>propofol,</strong> can lead to bradycardia and should be avoided on a case-by-case basis</span></li>\n<li><span data-preserver-spaces=\"true\">The\u00a0intra-abdominal pressure should be limited to <strong>12\u201315 mmHg </strong>(option B) to avoid such events</span></li>\n</ul>\n<p><strong><span data-preserver-spaces=\"true\">Management includes:</span></strong></p>\n<ul>\n<li><span data-preserver-spaces=\"true\">Immediately notify the surgeon and ask for temporary cessation of surgery until the heart rate increases</span></li>\n<li><span data-preserver-spaces=\"true\">Providing adequate ventilation, oxygenation, and depth of anesthesia\u00a0</span></li>\n<li><span data-preserver-spaces=\"true\">Administration of\u00a0</span><strong><span data-preserver-spaces=\"true\">IV atropine </span></strong>10 mg<span data-preserver-spaces=\"true\">/kg and\u00a0</span><strong><span data-preserver-spaces=\"true\">mild chest compressions</span></strong><span data-preserver-spaces=\"true\"> can also be done to allow the atropine to circulate</span></li>\n<li><span data-preserver-spaces=\"true\">Transcutaneous/transvenous pacing may be used in refractory cases</span></li>\n</ul>\n<p><span data-preserver-spaces=\"true\">Note:</span><strong><span data-preserver-spaces=\"true\">\u00a0</span></strong>In<strong><span data-preserver-spaces=\"true\"> recalcitrant episodes</span></strong><span data-preserver-spaces=\"true\">, a local anesthetic can be injected into the <strong>rectus muscles.</strong></span></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/9ff66665c0af483f8b871a42d5c2e861.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Osborn J waves are not seen in :",
    "choices": [
      {
        "id": 1,
        "text": "Hypothermia"
      },
      {
        "id": 2,
        "text": "Hypothyroidism"
      },
      {
        "id": 3,
        "text": "Hypercalcemia"
      },
      {
        "id": 4,
        "text": "Hyperkalemia"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Osborn J waves are not seen in hyperkalemia.</p>\n<p>Osborn J waves are the distinctive <strong>convex elevations of the J point</strong> as seen in the image.</p>\n<p>It consists of an<strong> extra deflection </strong>on the ECG<strong> at the terminal junction of the QRS complex </strong><strong>and the beginning of the ST-segment takeoff.</strong></p>\n<ul>\n<li>Usually, it occurs when the core body temperature falls below 90\u00b0F (32\u00b0C), seen in conditions such as <strong>hypothermia </strong>(option A) secondary to severe <strong>hypothyroidism </strong>(option B)</li>\n<li>Results from an exaggerated outward potassium current leading to <strong>repolarization abnormality</strong></li>\n<li>They can also be found in other conditions, such as <strong>hypercalcemia</strong> (option C)</li>\n<li>Other causes include brain injury, subarachnoid hemorrhage, cardiopulmonary arrest from oversedation, vasospastic angina, and idiopathic ventricular fibrillation</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/de9a8c3a7d894cc1a7e67de7dfb19240x481x441.JPEG"
    ]
  },
  {
    "text": "A 28-year-old man presented with a prolonged history of fainting spells and palpitations. He is a known case of Brugada syndrome and has been started on quinidine for the same, after which he developed a cardiac rhythm, as shown in the ECG given below. Which of the following could be the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "WPW syndrome"
      },
      {
        "id": 2,
        "text": "Torsades  de pointes with QT prolongation"
      },
      {
        "id": 3,
        "text": "AVNRT"
      },
      {
        "id": 4,
        "text": "Ventricular fibrillation"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The diagnosis of the given scenario is<strong> torsades de pointes </strong>with<strong> QT interval prolongation</strong>.</p>\n<p><strong>Quinidine </strong>can\u00a0cause\u00a0<strong>polymorphic ventricular tachycardia</strong>, or\u00a0<strong>torsades de pointes</strong>,<strong>\u00a0</strong>which has been shown in the given ECG. Quinidine is often used in the management of patients with Brugada syndrome, as a class I antiarrhythmic agent (Ia).</p>\n<p>Torsades de pointes, which means \u201ctwisting of the points,\u201d\u00a0is a<strong> </strong>polymorphic ventricular tachycardia characterized by the twisting of the QRS axis around the baseline and a polymorphic appearance. This rhythm is most commonly seen in association with <strong>hypomagnesemia</strong> and hypokalemia. There is <strong>QT interval prolongation</strong> in the ECG due to a <strong>non-uniform delay</strong> in repolarization.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a3cb16f0e61f46cd83b839bca3e78f61.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8deab087fe264812b9685d6e412d885ex720x184.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f4fd36f9bb9e4f8b9f603ed3cef90ac6x800x600.PNG"
    ]
  },
  {
    "text": "Identify the rhythm abnormality in the ECG strip:",
    "choices": [
      {
        "id": 1,
        "text": "Torsades de Pointes"
      },
      {
        "id": 2,
        "text": "Monomorphic VT"
      },
      {
        "id": 3,
        "text": "Ventricular fibrillation"
      },
      {
        "id": 4,
        "text": "Premature ventricular complex"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The ECG depicts <strong>monomorphic VT</strong>.</p>\n<p><strong>Monomorphic VT</strong> has the <strong>same QRS complex from beat to beat</strong>, indicating that the activation sequence is the same from beat to beat and that each beat likely originates from the same source. Other features include:</p>\n<ul>\n<li>Rapid heart rate (&gt; 100 bpm)</li>\n<li>Broad QRS complexes (&gt; 120 ms)</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/474be9b5c3f4418d87b4d865260b24f4.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2b09e2105f644fd3bf217bde2a9c3612x1280x1424.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d3ff2eb902cb471687a410ff616ea5b5x1279x654.JPEG"
    ]
  },
  {
    "text": "A student was asked to record ECG by using bipolar limb leads. The below image shows the arrangement of the bipolar electrodes and the potentials recorded across lead I and lead II. What is the potential recorded across lead III?",
    "choices": [
      {
        "id": 1,
        "text": "+1.7 mV"
      },
      {
        "id": 2,
        "text": "-1.7 mV"
      },
      {
        "id": 3,
        "text": "+0.7 mV"
      },
      {
        "id": 4,
        "text": "-0.7 mV"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p class=\"p1\"><span class=\"s1\">According to\u00a0Einthoven\u2019s law, the potential recorded across <strong>lead III</strong> is\u00a0<strong>+0.7 mV.</strong></span></p>\n<p class=\"p1\"><span class=\"s1\"><strong>Einthoven\u2019s Law</strong>:\u00a0</span>Einthoven\u2019s law states that if the ECGs are recorded simultaneously with the three limb leads, the sum of the potentials recorded in leads I and III will equal the potential in lead II.</p>\n<p class=\"p2\"><strong>Lead I potential + Lead III potential = Lead II potential</strong></p>\n<p class=\"p2\">Lead III = Lead II \u2013 Lead I = (1.2-0.5) = <strong>+0.7 mV.</strong></p>\n<p class=\"p2\">Note: Einthoven's triangle is an imaginary triangle drawn around the area of the heart. It is formed by the arrangement of three bipolar limb leads (the two arms and left leg).</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a9b3abfc84f2446cb642b2521cfedbe8.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 50-year-old man is brought to the clinic after he experienced palpitations. He has a history of ischemic heart disease.  His ECG findings are shown in the image below. Which of the following is likely to be seen on physical examination of this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Absent 'a' waves on JVP"
      },
      {
        "id": 2,
        "text": "Cannon 'a' waves on JVP"
      },
      {
        "id": 3,
        "text": "Normal 'a' waves on JVP"
      },
      {
        "id": 4,
        "text": "Prominent 'a' waves on JVP"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The above ECG shows <strong>atrial fibrillation.\u00a0</strong>On physical examination of his jugular venous pressure,\u00a0<strong>absent 'a' waves\u00a0</strong>will be noted.\u00a0</p>\n<p>The following features in the ECG strip suggest the diagnosis of atrial fibrillation:</p>\n<ul>\n<li>Presence of fibrillatory <strong>'f'</strong>\u00a0<strong>waves </strong>is\u00a0indicative of uncoordinated atrial activation. Normal morphology <strong>P waves</strong>\u00a0(indicative of normal atrial contraction)<strong> </strong>are <strong>absent</strong></li>\n<li>The <strong>QRS complex</strong> duration is<strong> &lt;120 ms</strong>, which is normal. A narrow QRS complex indicates that the impulses are originating from the atria</li>\n<li>R waves (QRS complex) occur irregularly, indicative of a\u00a0<strong>variable</strong>\u00a0<strong>RR interval. </strong>The\u00a0rhythm is <strong>irregular\u00a0</strong>(the pace is set by the refractory period of the AV node)</li>\n</ul>\n<p>The <strong>'a' wave</strong> is the first peak on a JVP tracing. It represents the <strong>atrial contraction</strong> (atrial systole).\u00a0The rapid impulses of atrial fibrillation do not allow enough time for atrial filling and atrial contraction, leading to absent 'a' waves on JVP.\u00a0</p>\n<p>In acute atrial fibrillation with hemodynamic instability, electrical or chemical\u00a0<strong>cardioversion</strong> is the first step. The latter is done by intravenous administration of class III antiarrhythmic - ibutilide. In a stable patient,\u00a0<strong>ventricular rate control</strong>\u00a0is the primary aim. This is done by intravenous or oral administration of\u00a0<strong>beta-blockers</strong>.\u00a0<strong>Calcium channel blockers</strong>\u00a0such as verapamil and diltiazem can also be used.\u00a0</p>\n<p>If the current episode duration is\u00a0<strong>&gt;48 hours</strong>, cardioversion can precipitate thromboembolic complications. In such cases, cardioversion should be carried out only after\u00a0<strong>3 weeks</strong>\u00a0of anticoagulation. It has to be continued for 4 weeks after cardioversion. Another option is to evaluate the presence of a thrombus in the left atrial appendage. This can be done either by transesophageal echocardiography (TEE) or high-resolution CT.</p>\n<p>If the duration is &lt;48 hours and there are no high-risk factors, cardioversion can be done. <strong>CHA2DS2-VASc</strong>\u00a0scoring system is used to assess stroke risk.\u00a0</p>\n<p><strong>Warfarin</strong>\u00a0is recommended in patients with rheumatic<strong>\u00a0mitral stenosis</strong>\u00a0or mechanical heart valves who present with atrial fibrillation. In mitral stenosis, thrombi arise frequently from the\u00a0<strong>dilated left atrium</strong>. Atrial fibrillation in the absence of mitral stenosis is known as nonvalvular atrial fibrillation. <strong>Oral factor Xa inhibitors</strong>\u00a0such as apixaban, edoxaban, or rivaroxaban can be used in such cases.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/389f4be9a9c04d468c422340c1fbfb76.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "The given image shows a normal His bundle electrogram. Which of the following options indicates AV nodal conduction time?",
    "choices": [
      {
        "id": 1,
        "text": "From wave 1 to start of wave 3"
      },
      {
        "id": 2,
        "text": "From wave 1 to start of wave 2"
      },
      {
        "id": 3,
        "text": "From wave 2 to start of wave 4"
      },
      {
        "id": 4,
        "text": "From wave 2 to start of wave 3"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The AV nodal conduction time corresponds with the\u00a0<strong>AH interval\u00a0</strong>of HBE, which extends from wave 1 (A wave) to the start of wave 2 (H wave).</p>\n<p><strong>His bundle electrogram (HBE):</strong></p>\n<p>HBE is the record of the electrical activity obtained with the catheter\u00a0passed through a vein to the right side of the heart and placed close to the tricuspid valve.</p>\n<p>It shows 3 deflections, as shown in the figure:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/94e342dd499a4786ad566cfab2cc932c.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/96e457fabf8445a496436784cffc0806x1280x958.JPEG"
    ]
  },
  {
    "text": "A boy presents with breathlessness to the hospital. He gives a history of leg pain over the calf for a few days, for which he sought massaging from his mother, after which he developed breathlessness. Which of the following findings on the ECG would suggest a diagnosis of pulmonary embolism for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "S3 Q3 T1"
      },
      {
        "id": 2,
        "text": "S3 Q1 T3"
      },
      {
        "id": 3,
        "text": "S1 Q3 T1"
      },
      {
        "id": 4,
        "text": "S1 Q3 T3"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The history is suggestive of <strong>deep vein thrombosis</strong> leading to <strong>pulmonary embolism</strong>.</p>\n<p>The specific abnormality in ECG seen in pulmonary embolism is</p>\n<p>The<strong> S1 Q3 T3 sign:</strong></p>\n<ul>\n<li><strong>S wave</strong> in <strong>lead I</strong></li>\n<li><strong>Q wave</strong> in <strong>lead III</strong></li>\n<li><strong>Inverted T wave</strong> in <strong>lead III</strong></li>\n</ul>\n<p>S1Q3T3 is highly <strong>specific</strong> but not sensitive (meaning it is not always present).</p>\n<p>Instead, the most common abnormality in pulmonary embolism is <strong>right ventricular (RV) strain </strong>and<strong> ischemia</strong>, which is depicted on an ECG as<strong> T-wave inversions </strong>in<strong> leads V1-V4.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/9de748a016354da3b9965e65056ee3f3.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a8ee6d2640f04a48b2f547ee59fb1af0x793x414.PNG"
    ]
  },
  {
    "text": "A 47-year-old male patient presents with retrosternal chest pain. On auscultation, a pericardial friction rub is present. Echocardiography reveals a small amount of pericardial fluid. The ECG is shown below. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Myocardial infarction"
      },
      {
        "id": 2,
        "text": "Acute pericarditis"
      },
      {
        "id": 3,
        "text": "Cardiac tamponade"
      },
      {
        "id": 4,
        "text": "Pulmonary embolism"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The most likely diagnosis in this patient with widespread ST elevation is\u00a0<strong>acute pericarditis.</strong></p>\n<p>Acute pericarditis is an inflammation of the pericardium characterized by <strong>retrosternal chest pain</strong> that is aggravated by deep inspiration and supine position and relieved by sitting and leaning forward. It can be attributed to various causes like infections or inflammatory conditions like RA and SLE, or miscellaneous causes like iatrogenic, neoplasms, drugs, etc.</p>\n<p>On auscultation, 85% of patients have a <strong>pericardial friction rub</strong>. This appears as a <strong>rough scratching sound</strong> at end of expiration when the patient is sitting and leaning forward.\u00a0</p>\n<p>ECG findings of acute pericarditis need to be differentiated from those of myocardial infarction as they are similar.</p>\n<p>There are four stages in the development of acute pericarditis ECG changes.</p>\n<ul>\n<li>Stage 1: <strong>Widespread elevation of ST segments</strong>; depression of PR segment below the TP segment</li>\n<li>Stage 2: ST segments return to normal after a few days</li>\n<li>Stage 3: T waves become inverted</li>\n<li>Stage 4: ECG returns to normal after weeks or months</li>\n</ul>\n<p>Echocardiography is diagnostic for acute pericarditis. It would reveal a small amount of pericardial fluid. It can also be confirmed by CT or MRI.\u00a0</p>\n<p>Treatment of acute pericarditis is nonspecific. Non-steroidal anti-inflammatory drugs\u00a0are recommended, along with bed rest.</p>\n<p>Other options:</p>\n<p>Option A - Myocardial infarction would not have a pericardial friction rub. In addition, the <strong>ST changes</strong> would be <strong>localized</strong> to a specific area but in pericarditis, there are widespread changes. They would also be more prominent elevations.</p>\n<p>Option C - Cardiac tamponade is characterized by <strong>Beck's triad</strong> of hypotension, jugulo-venous distension, and muffled heart sounds. None of these are present in this patient.\u00a0</p>\n<p>Option D - Pulmonary embolism would be characterized by <strong>tachycardia, inverted T waves </strong>(right ventricular overload) in leads V1 - V4, and <strong>S1Q3T3</strong> pattern would be seen.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b01b12d3b0644e3c9dbcc3a2d4045d22.JPG"
    ],
    "explanation_images": []
  },
  {
    "text": "All of the following are true about the U wave in an ECG except?",
    "choices": [
      {
        "id": 1,
        "text": "Normally deflection is \u22641 mm and usually has the same polarity as the T wave"
      },
      {
        "id": 2,
        "text": "Prominent U waves are a marker of increased susceptibility to torsades de pointes"
      },
      {
        "id": 3,
        "text": "Abnormal increase in amplitude is seen in hyperkalemia"
      },
      {
        "id": 4,
        "text": "Occurs due to repolarization of ventricular myocytes with long action potential"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>An abnormal <strong>increase in the amplitude</strong> of the<strong> U wave</strong> is seen in <strong>hypokalemia</strong>\u00a0and not hyperkalemia.</p>\n<p>U waves in the ECG represent the ventricular repolarization, particularly of myocytes with long action potentials (option D). The U wave is a small, rounded <strong>deflection\u00a0\u22641 mm</strong> that occurs after the T wave. It usually has the <strong>same polarity</strong> as the T wave (option A). A very <strong>prominent U wave</strong> is considered a marker of increased susceptibility to <strong>torsades de pointes </strong>(option B). Abnormal <strong>increase</strong> in U-wave <strong>amplitude</strong> are most commonly due to <strong>drugs</strong> such as dofetilide, amiodarone, sotalol, and quinidine. It may also be seen in <strong>hypokalemia</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3e338cc5cbbd475e913c20cf595d1907x1280x1081.JPEG"
    ]
  },
  {
    "text": "A 60-year-old male patient is brought to the emergency room with complaints of nausea, muscle weakness, and a sense of extreme fatigue. He is a known case of CKD on treatment with enalapril. His ECG is given below. What is the first step in the management of this patient?",
    "choices": [
      {
        "id": 1,
        "text": "IV potassium chloride"
      },
      {
        "id": 2,
        "text": "IV calcium gluconate"
      },
      {
        "id": 3,
        "text": "IV sodium bicarbonate"
      },
      {
        "id": 4,
        "text": "IV 50% dextrose"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given ECG shows <strong>peaked T waves</strong>,<strong> flattened P waves</strong>, and <strong>broad QRS complexes</strong>, suggesting <strong>hyperkalemia</strong>. This patient also has <strong>chronic kidney disease</strong>\u00a0and is on treatment with an <strong>ACE inhibitor</strong>, enalapril. Both of these factors are independent risk factors for hyperkalemia. The <strong>first step </strong>in the management of <strong>hyperkalemia</strong> is the administration of <strong>IV calcium gluconate</strong>.</p>\n<p>ECG changes seen in hyperkalemia vary with the level of serum K<sup>+ </sup>(normal serum K<sup>+</sup> is 3.5-5.5 mEq/L):</p>\n<ul>\n<li>5.5-6.5 mEq/L- tall, peaked T waves</li>\n<li>6.5-7.5 mEq/L- flattening of P waves</li>\n<li>7.0-8.0 mEq/L - widening of QRS complexes</li>\n<li>&gt;8.0 mEq/L - sine wave pattern of ECG</li>\n</ul>\n<p>The\u00a0<strong>resting membrane potential</strong>\u00a0of excitable cells is\u00a0close to the<strong> resting membrane potential </strong>for<strong> K<sup>+</sup></strong>. In the\u00a0<strong>resting state</strong>, there is a<strong>\u00a0</strong>constant leakage of K<sup>+</sup>\u00a0out of the cell. If the\u00a0K<sup>+</sup>\u00a0is higher in the extracellular environment\u00a0(hyperkalemia),\u00a0less K<sup>+</sup>\u00a0will leak out\u00a0of the cell because the gradient is unfavorable. This\u00a0increases the positive charge inside\u00a0the cell, leading to the membrane potential being pushed more toward the threshold. In other words, the\u00a0cell is now <strong>more excitable.</strong>\u00a0</p>\n<p><strong>Calcium administration</strong>\u00a0counteracts this by\u00a0<strong>reducing </strong>the<strong> excitability of the cells</strong>\u00a0and maintaining the membrane potential at the actual resting value. Calcium is\u00a0administered by<strong> intravenous infusion</strong>\u00a0over 2-3 minutes with cardiac monitoring. The\u00a0effect of the infusion\u00a0lasts for\u00a0up to 60 minutes. During this time, the steps to correct K+ levels can be taken. These steps include:</p>\n<ul>\n<li>10 units of\u00a0<strong>IV insulin </strong>followed\u00a0immediately\u00a0by\u00a050 mL 50%\u00a0<strong>dextrose bolus</strong></li>\n<li><strong>Inhaled</strong>\u00a0<strong>\u03b22 agonists</strong>\u00a0such as\u00a0<strong>albuterol</strong></li>\n<li><strong>Cation exchange resins</strong>\u00a0such as\u00a0<strong>sodium polystyrene sulfonate</strong>\u00a0and\u00a0<strong>patiromer</strong>\u00a0can be used for the management of both acute and chronic hyperkalemia</li>\n<li><strong>Hemodialysis</strong>\u00a0is the\u00a0<strong>most effective</strong>\u00a0method to reduce K+ concentration</li>\n</ul>\n<p>Note that<strong>\u00a0</strong>intravenous bicarbonate administration\u00a0does not have a role\u00a0in the management of acute hyperkalemia.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/81063980ab3e43d8b24113cb1b4d9694.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/60415581506b44a69e0feddac3bdadb7x778x600.JPEG"
    ]
  },
  {
    "text": "The ECG of a 62-year-old hypertensive patient is as given below. What does his ECG show?",
    "choices": [
      {
        "id": 1,
        "text": "Left ventricular hypertrophy"
      },
      {
        "id": 2,
        "text": "Right ventricular hypertrophy"
      },
      {
        "id": 3,
        "text": "Acute myocardial infarction"
      },
      {
        "id": 4,
        "text": "Acute pericarditis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>His ECG shows<strong> left ventricular hypertrophy (LVH).\u00a0</strong></p>\n<p>In this patient, the height of the S wave in V1 is 25 and the R wave in V5 is 21. The sum of the two is 46.\u00a0</p>\n<p>ECG findings suggestive of LVH are as follows:\u00a0</p>\n<ul>\n<li>SV1 + [RV5 or RV6]\u00a0<strong>&gt;35mm</strong></li>\n<li>RaVL + SV3 <strong>&gt;20 mm</strong> in <strong>women</strong> and <strong>&gt;28 mm</strong> in <strong>men</strong></li>\n<li><strong>ST depression</strong> with <strong>T wave inversion\u00a0</strong></li>\n</ul>\n<p>The causes of LVH can be divided into <strong>pressure overload</strong> or <strong>volume overload</strong>. Examples of pressure overload are <strong>hypertension</strong> and <strong>aortic stenosis</strong> leading to <strong>concentric</strong> hypertrophy. Volume overload can occur due to <strong>valvular</strong>\u00a0<strong>regurgitation</strong> leading to <strong>ventricular</strong> <strong>dilation</strong>.\u00a0</p>\n<p>Pathological cardiac conditions leading to increased cardiac workload result in compensatory mechanisms to maintain perfusion and arterial pressure. They include <strong>increasing</strong> <strong>contractility</strong> and <strong>stroke</strong> <strong>volume</strong> (Frank-Starling law), <strong>activation</strong> of <strong>neurohormonal</strong> systems like the renin-angiotensin-aldosterone system, and release of hormones like norepinephrine and atrial natriuretic peptide. Myocardial adaptations can also occur resulting in <strong>cellular</strong> <strong>hypertrophy</strong> of the myocytes.\u00a0</p>\n<p>LVH occurs due to increased mechanical work. However, the increased muscle mass has <strong>increased</strong> <strong>metabolic</strong> <strong>demands</strong> as well leading to a further <strong>increase</strong> in <strong>oxygen</strong> <strong>demand</strong>. This makes patients with LVH susceptible to <strong>ischemia</strong> and <strong>heart</strong> <strong>failure</strong>.\u00a0</p>\n<p>Other options:</p>\n<p>Option B - Right ventricular hypertrophy is characterized by <strong>tall R waves</strong> in <strong>lead V1,</strong> where R is bigger than the S wave, right axis deviation. ST depression and T wave inversion in right to mid-precordial leads can be present.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/2cbaa27a61f8420b94a04edfe1588182.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not a finding you would expect to see in a patient with a left bundle branch block?",
    "choices": [
      {
        "id": 1,
        "text": "RSR\u2019 pattern in V1-V2"
      },
      {
        "id": 2,
        "text": "QRS duration of\u00a0> 120ms"
      },
      {
        "id": 3,
        "text": "Dominant S wave in V1"
      },
      {
        "id": 4,
        "text": "Broad monophasic R wave in V5-V6"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>RSR</strong>\u2019 pattern in\u00a0<strong>V1-3\u00a0</strong>is seen in the case of the right bundle branch block <strong>(RBBB)</strong>, not the left bundle branch block (LBBB).\u00a0</p>\n<p><strong>ECG </strong>findings suggestive of<strong> LBBB:</strong></p>\n<ul>\n<li>QRS duration of &gt;120 ms\u00a0</li>\n<li>Dominant S wave in V1 with loss of R wave</li>\n<li>Notched R wave and no Q wave in V6</li>\n</ul>\n<p>The below image shows the characteristic changes in <strong>LBBB</strong>:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c5416ed160a441af8eca9ffd4d1521c5x222x196.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d044a91a6135485899389f185248b6c5x218x200.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e56c0b5b545e4b3b9afc6c5d0fe2fdb1x1279x594.JPEG"
    ]
  }
];
        let quizName = 'Ecgs Mini Test';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2024-25"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>