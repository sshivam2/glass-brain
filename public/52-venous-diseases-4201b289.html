<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>52 Venous Diseases - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Surgery
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">26</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following is not part of Virchow\u2019s triad?",
    "choices": [
      {
        "id": 1,
        "text": "Venous stasis"
      },
      {
        "id": 2,
        "text": "Injury to veins"
      },
      {
        "id": 3,
        "text": "Blood hypercoagulability"
      },
      {
        "id": 4,
        "text": "Thrombus formation"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Thrombus formation</strong> is <strong>not included</strong> in Virchow&rsquo;s triad.</p>\n<p><strong>Virchow&rsquo;s triad</strong> refers to three primary influences that predispose to thrombus formation:</p>\n<ul>\n<li>Endothelial injury</li>\n<li>Stasis or low turbulence of blood flow</li>\n<li>Blood hypercoagulability</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following patients are not at an increased risk for developing deep vein thrombosis?",
    "choices": [
      {
        "id": 1,
        "text": "Woman on high dose oestrogen therapy for menopausal symptoms"
      },
      {
        "id": 2,
        "text": "Child with nephritic syndrome"
      },
      {
        "id": 3,
        "text": "Middle aged man with polycythemia vera"
      },
      {
        "id": 4,
        "text": "Teenager who has sustained major trauma in an accident"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Nephritic syndrome is <strong>not associated</strong> with an increased risk of DVT. <strong>Nephrotic syndrome</strong> is associated with an <strong>increased risk</strong> of developing deep vein thrombosis.</p>\n<p>Deep vein thrombosis is the presence or formation of a<strong> thrombus</strong> is present in the <strong>deep venous system,&nbsp;</strong>usually in the deep veins lower limbs.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is false regarding deep vein thrombosis (DVT)?",
    "choices": [
      {
        "id": 1,
        "text": "Clinical assessment is unreliable"
      },
      {
        "id": 2,
        "text": "Mostly bilateral"
      },
      {
        "id": 3,
        "text": "Most common clinical presentation is pain and tenderness in calf"
      },
      {
        "id": 4,
        "text": "Some cases may directly present as pulmonary thromboembolism"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Most cases of deep vein thrombosis <strong>(DVT)</strong> are <strong>unilateral</strong>. It is <strong>bilateral</strong> in only <strong>30%</strong> of the individuals.</p>\n<p><strong>DVT</strong> refers to <strong>thrombosis</strong> of the <strong>deep venous system</strong>.</p>\n<p>Caused by:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Postoperative thrombosis </strong>(most common cause)</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Oral contraceptive pills <strong>(OCPs)</strong></li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">After childbirth</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Immobility</strong>\u00a0</li>\n</ul>\n<p>Sites:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Pelvic veins\u2014common</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Leg veins\u2014common in femoral and popliteal veins (common on the left side).</li>\n</ul>\n<p><strong>Fever</strong> is the <strong>earliest</strong> symptom, which is also most commonly accompanied by <strong>pain</strong> and <strong>tenderness</strong> in the <strong>calf</strong> and <strong>thigh</strong> (<strong>option C</strong>).</p>\n<p>The following signs could be elicited:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Positive <strong>Homan's</strong> sign: <strong>Resistance </strong>of calf muscles on passive <strong>foreceful dorsiflexion</strong> of the foot. <strong><br /></strong></li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Mose's</strong> sign: Gentle squeezing of the lower part of the <strong>calf</strong> from <strong>side to side</strong> is painful.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Neuhof's</strong> sign: Thickening and <strong>deep</strong> <strong>tenderness</strong> seen on deep <strong>palpation</strong> of the calf muscles.</li>\n</ul>\n<p>Sometimes, the thrombus may get <strong>dislodged</strong> and present as <strong>pulmonary</strong> <strong>thromboembolism</strong> (<strong>option D</strong>)<strong> </strong>with features of dyspnoea, tachypnoea, and chest pain.</p>\n<p><strong>Clinical features are unreliable</strong> for making a definitive diagnosis (<strong>option A</strong>), and a <strong>venous Doppler</strong> is the <strong>best modality </strong>for confirming DVT. It reveals a non-compressible dilated vein. The likelihood of pulmonary embolism can be predicted using <strong>modified Wells criteria</strong>.</p>\n<p>Patients with <strong>DVT</strong> should be immediately <strong>started</strong> with <strong>subcutaneous</strong> low molecular weight heparin <strong>(LMWH)</strong>. If contraindicated due to renal insufficiency or thrombocytopenia-related conditions, they should be started on fondaparinux (indirect factor Xa inhibitor) or bivalirudin (direct thrombin inhibitor). <strong>Anticoagulants</strong> should be administered for a <strong>minimum</strong> period of <strong>3 months</strong>. Vena cava filters are used in patients with bleeding risks (like hemophilia).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "When performing the test on a patient as shown in the image, you noticed that there was tenderness and resistance on flexion. What is this finding known as?",
    "choices": [
      {
        "id": 1,
        "text": "Pratt\u2019s sign"
      },
      {
        "id": 2,
        "text": "Moses sign"
      },
      {
        "id": 3,
        "text": "Homan\u2019s sign"
      },
      {
        "id": 4,
        "text": "Lowenberg\u2019s sign"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given findings can be seen in a patient with DVT and this is known as <strong>Homan\u2019s sign</strong> i.e. calf <strong>tenderness and resistance</strong> on forced ankle dorsiflexion.</p>\n<p>Moses Sign - calf tenderness on squeezing the calf from sides.</p>\n<p>Lowenberg\u2019s sign- pain when blood pressure cuff placed on the calf is inflated to 80 mm of Hg</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/bb21a2c37cf14af5bfc3802e58bf3b4c.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 30-year-old woman who is in the third trimester of pregnancy started to experience pain in her left leg. She also noticed that her left leg was turning pale and edematous as given in the image below. What is the cause of this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Femoral vein thrombosis and lymphatic obstruction"
      },
      {
        "id": 2,
        "text": "Deep femoral vein thrombosis"
      },
      {
        "id": 3,
        "text": "Lymphatic obstruction only"
      },
      {
        "id": 4,
        "text": "Due to pressure exerted by uterus on the iliac veins"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In <strong>phlegmasia cerulea dolens</strong>, the thrombosis <strong>extends to collateral</strong> veins, resulting in severe venous congestion with massive fluid sequestration and more significant edema.</p>\n<p>Both phlegmasia cerulea dolens and phlegmasia alba dolens results from acute massive deep vein thrombosis and can be complicated by venous gangrene.</p>\n<p>Edema of pregnancy <strong>does not present with pain</strong> in the lower limbs but edema due&nbsp;to pressure exerted by the gravid uterus on the iliac veins.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/7be37d7f033b4b67af146f7e9d253f53.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2cc1b7fdc4374e9f9b41d87d5d0aeebdx1050x1200.JPEG"
    ]
  },
  {
    "text": "You are tasked with giving post-operative care to a patient who just underwent open abdominal surgery. Which of the following is the most effective treatment to prevent the patient from developing deep vein thrombosis?",
    "choices": [
      {
        "id": 1,
        "text": "Early ambulation"
      },
      {
        "id": 2,
        "text": "Physiotherapy"
      },
      {
        "id": 3,
        "text": "Prophylactic heparin"
      },
      {
        "id": 4,
        "text": "Low dose aspirin"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Heparin, especially <strong>low molecular weight heparin</strong> (LMWH) is more effective for prophylaxis of DVT in patients who have undergone major surgeries where early ambulation is not possible.\u00a0</p>\n<p>The choice of prophylaxis depends on the type of surgery, trauma, and duration of postoperative immobilisation.\u00a0<strong>Major trauma</strong>, abdominal and orthopaedic surgeries warrant a <strong>longer duration</strong> of postoperative immobilisation. So, the<strong> pharmacological method</strong> is preferred in these situations.</p>\n<p><strong>Mechanical methods </strong>are advised in patients who are expected to be up and walking within 24 to 48 hours such as after <strong>minor trauma</strong>. The simplest method is for the patient to<strong> ambulate.</strong>\u00a0The activation of the calf pump mechanism is an effective means of prophylaxis.</p>\n<p>Additionally,<strong> compression stockings</strong>\u00a0are advised. It can reduce the risk of DVT by <strong>exerting graduated pressure on the leg</strong>, with the pressure being greatest at the ankle.</p>\n<p>Advantages of LMWH over unfractionated heparin:\u00a0</p>\n<ul>\n<li>LMWH has a <strong>longer plasma half-life</strong> and significantly <strong>higher bioavailability</strong>.</li>\n<li>The consistent bioavail\u00adability and clearance of LMWH <strong>do not require monitoring </strong>of <strong>aPTT </strong>or<strong> anti-factor Xa activity.</strong></li>\n<li>Dosing is merely based on the <strong>patient\u2019s weight.</strong></li>\n<li>There is a more predictable anticoagulant response than with unfractionated heparin.</li>\n</ul>\n<p><strong>LMWH inhibits factor Xa and not IIa activity, </strong>with the ratio of anti-factor Xa to anti-factor IIa activity ranging from 1:1 to 4:1.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "All of the following are risk factors for developing varicose veins, except?",
    "choices": [
      {
        "id": 1,
        "text": "Multiple pregnancies"
      },
      {
        "id": 2,
        "text": "Superficial venous thrombosis"
      },
      {
        "id": 3,
        "text": "AV fistula in lower limb"
      },
      {
        "id": 4,
        "text": "BMI > 40 kg/m2"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Superficial venous thrombosis</strong> is <strong>not a risk factor</strong> for developing<strong>&nbsp;varicose veins</strong> because the deep venous system is not affected and there is no increased stasis of blood. &nbsp;</p>\n<p>Varicose veins are defined as <strong>dilated, usually tortuous, subcutaneous veins &gt;3 mm in diameter</strong> measured in the upright position with demonstrable reflux.</p>\n<p><strong>Important risk factors</strong> for varicose veins are:</p>\n<ul>\n<li>Sex &ndash; Females &gt; Males</li>\n<li>Age &ndash; increases with age</li>\n<li>Pregnancy (especially multiparity)</li>\n<li>Family history</li>\n<li>Body mass and height: Increasing BMI (obesity) and height are associated with a high prevalence of varicose veins.</li>\n</ul>\n<p>There is inconclusive evidence regarding the increased prevalence of varicose veins in <strong>smokers, </strong>patients who suffer<strong> constipation, </strong>and occupations that involve<strong> prolonged standing.</strong></p>\n<p><strong>Primary </strong>varicose veins are due to <strong>genetic or developmental defects in the vein wall</strong> that causes diminished elasticity and valvular incompetence.&nbsp;</p>\n<p><strong>Secondary </strong>varicose veins arise from <strong>destruction or dysfunction of valves</strong> caused by trauma, DVT, <strong>AV fistula</strong>, non-traumatic proximal venous obstruction (pregnancy, pelvic tumor).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A truck driver presents with dilated, tortuous veins of 4 mm in the foot. What is the stage of clinical classification according to CEAP(Clinical-etiology-anatomy-pathophysiology for chronic venous disorders)?",
    "choices": [
      {
        "id": 1,
        "text": "C0"
      },
      {
        "id": 2,
        "text": "C1"
      },
      {
        "id": 3,
        "text": "C2"
      },
      {
        "id": 4,
        "text": "C3"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Dilated tortuous veins of 4 mm indicate varicose veins, so the stage is <strong>C2.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 42-year-old  daily wage laborer comes to you with discoloration of her legs. She was diagnosed with varicose veins 5 years ago which was left untreated. Identify the feature given in the picture.",
    "choices": [
      {
        "id": 1,
        "text": "Atrophie blanche"
      },
      {
        "id": 2,
        "text": "Corona phlebectatica"
      },
      {
        "id": 3,
        "text": "Lipodermatosclerosis"
      },
      {
        "id": 4,
        "text": "Phlegmasia alba dolens"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Corona phlebectatica</strong> are <strong>fan-shaped patterns of small intradermal veins </strong>on the medial or lateral aspects of the ankle or foot. It is also called ankle flare or malleolar flare. It is an early <strong>sign of advanced venous disease.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/66e85a1f54814c739f5c7ed34a19b4ff.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7060532543c64a64a3a7d9ccd5430045x1279x1142.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5e3130175cb0489daf8efbcc4898f3bex720x540.JPEG"
    ]
  },
  {
    "text": "A bus conductor was diagnosed with varicose veins. On examination, skin eczema and lipodermatosclerosis were noted. According to the CEAP classification system, He would be classified as",
    "choices": [
      {
        "id": 1,
        "text": "C1"
      },
      {
        "id": 2,
        "text": "C2"
      },
      {
        "id": 3,
        "text": "C3"
      },
      {
        "id": 4,
        "text": "C4"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p class=\"p1\">According to CEAP classification, varicose veins with skin eczema and lipodermatosclerosis come under the clinical class of <strong>C4</strong>.</p>\n<p>The clinical class of C4 under CEAP includes changes in skin and subcutaneous tissue secondary to chronic venous disease. It is further classified as,</p>\n<ul>\n<li>C4a- pigmentation or eczema</li>\n<li>C4b- lipodermatosclerosis or atrophie blanche</li>\n<li>C4c- corona phlebectatica</li>\n</ul>\n<p class=\"p1\"><strong>Recent 2020 update</strong>&nbsp;on the CEAP system:</p>\n<ul>\n<li class=\"p1\"><strong>C2r&nbsp;</strong>for recurrent varicose veins</li>\n<li class=\"p1\"><strong>C4c</strong>&nbsp;for&nbsp;Corona phlebectatica</li>\n<li class=\"p1\"><strong>C6r</strong>&nbsp;for recurrent active venous ulcer.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is false regarding Klippel-Trenaunay syndrome?",
    "choices": [
      {
        "id": 1,
        "text": "Limb hypertrophy"
      },
      {
        "id": 2,
        "text": "Not familial"
      },
      {
        "id": 3,
        "text": "Surgery is indicated in all cases"
      },
      {
        "id": 4,
        "text": "Increased risk of deep vein thrombosis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>All patients with Klippel&ndash;Trenaunay syndrome should be treated <strong>conservatively </strong>with<strong> elastic compression. </strong>A <strong>s</strong><strong>urgical intervention</strong> is only indicated for <strong>affected large superficial veins</strong> provided the underlying <strong>deep system is normal</strong> and demonstrates only mild-to-moderate reflux.</p>\n<p>Klippel-Trenaunay syndrome is a sporadic <strong>nonhereditary mesodermal abnormality</strong> that usually affects a single lower limb with deep veins which have hypoplastic or aplastic segments. It is characterized by a triad of:</p>\n<ul>\n<li>Haemangioma presenting as nevus flammeus (port-wine stain)</li>\n<li>Varicose veins</li>\n<li>Soft tissue and bone hypertrophy<span class=\"Apple-converted-space\">&nbsp;</span></li>\n</ul>\n<p>Venous stripping, ligation, excision, or sclerotherapy are done in suitable cases.&nbsp;<strong>Low molecular weight heparin </strong>should be given to all patients undergoing surgical procedures as this syndrome is associated with an <strong>increased risk of venous thromboembolism.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient presents to you with dilated, tortuous veins of the legs. Which is the best investigation to perform that will confirm the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Doppler study"
      },
      {
        "id": 2,
        "text": "Duplex ultrasound imaging"
      },
      {
        "id": 3,
        "text": "CT venography"
      },
      {
        "id": 4,
        "text": "MR venography"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>D</strong><strong>uplex ultrasound </strong>is the best investigation to <strong>confirm&nbsp;varicose veins.</strong></p>\n<p>Duplex ultrasound gives information about the presence of <strong>blood flow</strong> in the studied vessels such as its speed, direction and turbulence alongwith<strong> image of surrounding tissues</strong>.</p>\n<p>The aim of the duplex scan in patients with varicose veins is to establish:</p>\n<ul>\n<li>If saphenous junctions are incompetent and the extent of reflux in the saphenous veins and their diameters.</li>\n<li>Number, location, and diameter of incompetent perforating veins</li>\n<li>Source of all superficial varices&nbsp;</li>\n<li>Competence and evidence of previous venous thrombosis in the deep venous system.</li>\n</ul>\n<p>Doppler study only gives information about the presence of blood flow in the studied vessels such as its speed, direction, and turbulence, not the surrounding tissue.</p>\n<p>Very rarely if pelvic and iliac veins are involved then <strong>CT </strong>or&nbsp;<strong>MR venography</strong> might be opted for, when duplex ultrasound fails to visualise properly.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which vessel is not involved in the formation of mickey mouse sign that is seen while performing a duplex ultrasound?",
    "choices": [
      {
        "id": 1,
        "text": "Common femoral artery"
      },
      {
        "id": 2,
        "text": "Common femoral Vein"
      },
      {
        "id": 3,
        "text": "Great saphenous Vein"
      },
      {
        "id": 4,
        "text": "Accessory saphenous vein"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Mickey mouse sign</strong> is seen in transverse B mode image of duplex ultrasound formed by:</p>\n<ul>\n<li>Common Femoral Vein (CFV)</li>\n<li>Common Femoral Artery (CFA)</li>\n<li>Greater Saphenous Vein (GSV) at the Saphenofemoral junction (SFJ).</li>\n</ul>\n<p>It represents the normal anatomy of the femoral vessels as seen in a duplex ultrasound.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4985ef956bf342dc8d29433f497b0ca0x720x912.JPEG"
    ]
  },
  {
    "text": "A duplex ultrasound was done on a patient with varicose veins. It revealed incompetence of the perforator connecting the great saphenous vein to the superficial femoral vein. What is this perforator known as?",
    "choices": [
      {
        "id": 1,
        "text": "Boyd perforator"
      },
      {
        "id": 2,
        "text": "Dodd perforator"
      },
      {
        "id": 3,
        "text": "Kustner perforator"
      },
      {
        "id": 4,
        "text": "Cockett perforator"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Dodd&rsquo;s perforator connects the great saphenous vein to the superficial femoral veins. It is also known as &lsquo;<strong>above knee&rsquo; perforator </strong>and is seen at the <strong>inferior \u2153 of the thigh</strong>.&nbsp;</p>\n<p>Perforating veins connect the superficial venous system to the deep venous system by penetrating the fascial layers of the lower extremity. Although the total number of perforator veins is variable, up to 100 have been documented.</p>\n<p><strong>Named perforators:</strong></p>\n<ul>\n<li>Adductor Canal (thigh) &ndash; Hunter's perforator</li>\n<li>Above Knee &ndash; Dodd's&nbsp; perforator</li>\n<li>Below Knee &ndash; Boyd's perforator</li>\n<li>Medial Calf &ndash; Cockett I, II, and III perforator</li>\n<li>Ankle - May or Kustner perforator</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/dd0dd357a7ec4fd5853e2b5a9e3c5ed8x1280x2348.JPEG"
    ]
  },
  {
    "text": "Presence of which of the following would make a patient with varicose veins unsuitable for sclerotherapy?",
    "choices": [
      {
        "id": 1,
        "text": "Deep vein thrombosis"
      },
      {
        "id": 2,
        "text": "Multiple incompetent perforators"
      },
      {
        "id": 3,
        "text": "Varicose vein with leg ulcer"
      },
      {
        "id": 4,
        "text": "Recurrence of varicose veins after ligation and stripping surgery"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Deep vein thrombosis</strong> is a <strong>contraindication</strong> for <strong>sclerotherapy</strong>&nbsp;in varicose veins.</p>\n<p>This is because, in patients with DVT, the <strong>superficial veins are the only valved venous pathway</strong> carrying blood back to the heart, and <strong>excising</strong> them in the <strong>presence of deep venous thrombosis</strong> will only <strong>aggravate</strong> the <strong>condition.</strong></p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which sclerosant is most commonly used when performing sclerotherapy for varicose veins?",
    "choices": [
      {
        "id": 1,
        "text": "Sodium tetradecyl sulphate"
      },
      {
        "id": 2,
        "text": "Polidocanol"
      },
      {
        "id": 3,
        "text": "Hypertonic saline"
      },
      {
        "id": 4,
        "text": "Sodium morrhuate"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The most commonly used sclerosant is <strong>sodium tetradecyl sulfate.</strong></p>\n<p>In injection sclerotherapy a detergent is injected directly into the superficial veins. The detergent <strong>destroys the lipid membranes of endothelial</strong> cells causing them to shed, leading to thrombosis, fibrosis and obliteration (sclerosis).</p>\n<p>Injection sclerotherapy alone can be successful in <strong>varicose veins &lt;3 mm </strong>in diameter and in telangiectatic vessels.</p>\n<p><strong>Complications </strong>of sclerotherapy:&nbsp;</p>\n<ul>\n<li>Allergic reaction,&nbsp;</li>\n<li>Local hyperpigmentation</li>\n<li>Thrombophlebitis</li>\n<li>DVT</li>\n<li>Skin necrosis</li>\n</ul>\n<p>Patients with symptomatic GSV or SSV reflux may be treated with endovenous ablation techniques or surgical removal of the affected vein.</p>\n<p><strong>Saphenous vein ligation and stripping </strong>is preferred therapy for patients with <strong>GSVs </strong>of very large diameter <strong>(&gt;2 cm).</strong></p>\n<p><strong>Types of sclerosants:</strong></p>\n<p>Detergents</p>\n<ul>\n<li>Sodium tetradecyl sulfate</li>\n<li>Polidocanol</li>\n<li>Sodium morrhuate</li>\n<li>Ethanolamine oleate</li>\n</ul>\n<p>Osmotic agents</p>\n<ul>\n<li>Hypertonic saline</li>\n</ul>\n<p>Chemical irritants</p>\n<ul>\n<li>Chromated glycerin</li>\n<li>Polyiodinated iodine&nbsp;</li>\n<li>Alcoholic solution of zein</li>\n<li>Bleomycin</li>\n</ul>\n<p><strong>Tessari method&nbsp;</strong></p>\n<ul>\n<li>Widely used method to prepare foam for sclerotherapy</li>\n<li><strong>Sclerosant : Air</strong> ratio taken is <strong>1:3 or 1:4</strong>.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is done in Trendelenburg operation?",
    "choices": [
      {
        "id": 1,
        "text": "Stripping of the superficial varicose vein"
      },
      {
        "id": 2,
        "text": "Ligation of the perforators"
      },
      {
        "id": 3,
        "text": "Saphenofemoral flush ligation"
      },
      {
        "id": 4,
        "text": "Ligation of small tributaries at the distal end of superficial varicose vein"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Saphenofemoral flush ligation</strong> is done in&nbsp;<strong>Trendelenburg&rsquo;s procedure.&nbsp;</strong></p>\n<p>The <strong>great saphenous</strong> vein is <strong>stripped</strong> and <strong>tied close to the common femoral vein</strong> at the saphenofemoral junction so that there aren&rsquo;t any branches left that lead to recurrences.</p>\n<p>Procedure:</p>\n<p>An oblique groin incision is made at the level of and lateral to the pubic tubercle. The <strong>great saphenous vein is identified</strong> and <strong>dissected</strong> to the saphenofemoral junction.</p>\n<p><strong>Six great saphenous vein tributaries</strong> are normally encountered close to the saphenofemoral junction:&nbsp;</p>\n<ol>\n<li>The <strong>superficial inferior epigastric vein</strong> and <strong>superficial circumflex iliac vein</strong> laterally</li>\n<li>The deep and <strong>superficial external pudendal veins</strong> medially</li>\n<li>More distally the <strong>anterolateral</strong> and <strong>posteromedial thigh veins</strong></li>\n</ol>\n<p>A<strong> flush saphenofemoral junction ligation</strong> is then performed and the great saphenous vein retrogradely stripped to the knee. Flush ligation is when the great saphenous vein is <strong>stripped</strong> and <strong>tied close to the common femoral vein</strong> at the saphenofemoral junction so that there aren&rsquo;t any tributaries that lead to recurrences.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements regarding complications of varicose vein surgery is false?",
    "choices": [
      {
        "id": 1,
        "text": "Injury to the lymphatic system can cause secondary lymphoedema"
      },
      {
        "id": 2,
        "text": "Saphenous nerve injury causes loss of sensation in the medial aspect of the leg"
      },
      {
        "id": 3,
        "text": "The sural nerve is in danger during stripping of the great saphenous vein"
      },
      {
        "id": 4,
        "text": "Deep vein thrombosis can occur"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The <strong>sural nerve</strong> accompanies the<strong>&nbsp;short saphenous vein</strong>&nbsp;laterally along its course and supplies <strong>cutaneous sensation</strong> to the <strong>lateral malleolar region</strong>. Thus it is more prone to injury during stripping of the short saphenous vein, not the great saphenous vein.</p>\n<p>The <strong>s</strong><strong>aphenous nerve </strong>accompanies the<strong> great saphenous vein</strong>&nbsp;medially from the ankle to the level of the knee and supplies <strong>cutaneous sensation to the medial leg and ankle</strong>. Thus it is more prone to injury during stripping of the great saphenous vein.</p>\n<p><span class=\"ej-keyword\" data-value=\"surgery\">Surgery</span> for the varicose veins extraction may trigger injury of the lymph vessels and may lead to secondary lymphedema.</p>\n<p><strong>Injury and inflammation</strong> to the venous system during varicose vein surgery can cause<strong> slowing and stasis of blood flow</strong> in the lower limb, making them prone to develop deep vein thrombosis postoperatively.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In patients with chronic venous insufficiency, where are venous ulcers most likely to develop?",
    "choices": [
      {
        "id": 1,
        "text": "Medial aspect of the foot"
      },
      {
        "id": 2,
        "text": "Lower 1/3rd of leg"
      },
      {
        "id": 3,
        "text": "Lower 2/3rd of leg"
      },
      {
        "id": 4,
        "text": "Middle 1/3rd of leg"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Venous ulcers&nbsp;due to chronic venous insufficiency are most commonly seen in the lower \u2153 of the leg and foot. They usually lie <strong>just proximal to the medial or lateral malleolus</strong>.</p>\n<p>Venous ulcers are <strong>accompanied by lipodermatosclerosis and hemosiderosis</strong>.&nbsp;</p>\n<table style=\"width: 373px;\">\n<tbody>\n<tr>\n<td style=\"width: 96.6323471069336px;\">Feature&nbsp;</td>\n<td style=\"width: 144.3676528930664px;\">Venous ulcer&nbsp;</td>\n<td style=\"width: 155px;\">Arterial ulcer</td>\n</tr>\n<tr>\n<td style=\"width: 96.6323471069336px;\">Predisposing factors</td>\n<td style=\"width: 144.3676528930664px;\">\n<p>Varicose veins</p>\n<p>Previous DVT</p>\n<p>Recurrent superficial thrombophlebitis</p>\n</td>\n<td style=\"width: 155px;\">\n<p>Peripheral arterial disease</p>\n<p>Diabetes</p>\n<p>Smoking</p>\n<p>Hypertension</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 96.6323471069336px;\">Location</td>\n<td style=\"width: 144.3676528930664px;\"><strong>Lower 1/3 of leg</strong> 'gaiters area'</td>\n<td style=\"width: 155px;\">\n<p>Lateral malleolus and tibial aspect of leg</p>\n<p>Toes and feet</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 96.6323471069336px;\">Ulcer characteristics</td>\n<td style=\"width: 144.3676528930664px;\">\n<p><strong>Shallow</strong> and <strong>flat margins</strong></p>\n<p>Exudate with slough and granulation tissue at base of wound</p>\n</td>\n<td style=\"width: 155px;\">\n<p><strong>Punched out</strong>,&nbsp;<strong>deep,&nbsp;</strong>and irregular in shape</p>\n<p>Necrotic and unhealthy tissue at base of wound</p>\n<p>&nbsp;</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 96.6323471069336px;\">Appearance of &nbsp;the lower limb</td>\n<td style=\"width: 144.3676528930664px;\">\n<p>Lipodermatosclerosis</p>\n<p>Atrophie blanche</p>\n<p>Limb oedema</p>\n<p><strong>Normal</strong> capillary refill time</p>\n</td>\n<td style=\"width: 155px;\">\n<p>Pale, shiny skin</p>\n<p>Absent or weak peripheral pulses</p>\n<p><strong>Delayed</strong> capillary refill time&nbsp;</p>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2fdfa6736d2443a68f3f2e22d512cc25x608x552.JPEG"
    ]
  },
  {
    "text": "A 61-year-old man presented with a recurrent, tender, erythematous rash on the medial aspect of the right forearm and lower limb as shown in the image. He was diagnosed with pancreatic adenocarcinoma 1 year ago.  Blood investigations showed normal eosinophil counts and no signs of infections. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Migratory thrombophlebitis"
      },
      {
        "id": 2,
        "text": "Urticaria"
      },
      {
        "id": 3,
        "text": "Secondary to repeated cannulation of vein"
      },
      {
        "id": 4,
        "text": "Cellulitis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The most likely diagnosis is <strong>migratory thrombophlebitis</strong>.</p>\n<p>It is a <strong>paraneoplastic syndrome&nbsp;</strong>that&nbsp;is also known as <strong>Trousseau&rsquo;s syndrome </strong>or Trousseau's sign of malignancy. It is characterised by <strong>recurrent</strong> episodes of <strong>localised</strong> <strong>thrombosis</strong> of the superficial veins of limbs. It can lead to tender and erythematous rashes.</p>\n<p>Migratory thrombophlebitis is seen in<strong>:&nbsp;</strong></p>\n<ul>\n<li><strong>Pancreatic cancer</strong> (most common)</li>\n<li>Lung cancer</li>\n<li>Gastrointestinal cancer</li>\n<li>Ovarian cancer</li>\n<li>Prostate cancer</li>\n<li>Lymphoma</li>\n</ul>\n<p>Note:&nbsp;Trousseau&rsquo;s sign is seen in hypocalcemia where there is an involuntary contraction of the muscles of the hand and wrist when a blood pressure cuff is placed on the arm and inflated to 20mm of Hg above systolic blood pressure.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/30021ee236d94bce975260bdb351d019.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 60-year-old male patient with sudden onset pain, cyanosis, and edema of the left upper limb. Doppler ultrasound revealed thrombosis of the left subclavian vein. Which of the following is false regarding this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Can be caused by indwelling venous catheters"
      },
      {
        "id": 2,
        "text": "Treated with IV anticoagulants"
      },
      {
        "id": 3,
        "text": "Primary axillary vein thrombosis is seen in hypercoagulable states"
      },
      {
        "id": 4,
        "text": "May occur following excessive arm exercise"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The patient has axillary-subclavian vein thrombosis. Hypercoagulable states lead to <strong>secondary axillary vein thrombosis</strong>.</p>\n<p>Axillary-subclavian vein thrombosis (ASVT) is of 2 types.</p>\n<p><strong>Primary ASVT</strong> occurs as a result of <strong>compression of the subclavian vein</strong> in the <strong>costoclavicular space</strong>\u00a0by repeated contraction of muscles that surround the thoracic outlet. There is repeated compression and traumatization to the vein. This leads to the formation of clots<strong>. </strong>It is also known as:</p>\n<ul>\n<li><strong>Paget-Schrotter Syndrome\u00a0</strong></li>\n<li>Venous thoracic outlet syndrome</li>\n<li>Effort thrombosis</li>\n</ul>\n<p><strong>Secondary ASVT </strong>occurs due to <strong>venous injury</strong> by indwelling central venous catheters, external trauma or pacemaker wires. It is also seen in <strong>hypercoagulable states.</strong></p>\n<p>Symptoms and signs include <strong>pain, edema, and cyanosis of the upper extremity</strong>. Significant <strong>superficial venous distension</strong> can be seen in arm, forearm, shoulder and anterior chest wall.</p>\n<p><strong>Doppler study</strong> is the investigation of choice.\u00a0<strong>Anticoagulation </strong>is initiated once ASVT is diagnosed to prevent pulmonary embolism.In<strong> severe cases, thrombolytic therapy</strong> is done using<strong>\u00a0tissue plasminogen activator</strong> (rtPA) or <strong>s</strong><strong>treptokinase.</strong></p>\n<p>Adjuvant procedures following thrombolytic therapy may include balloon angioplasty for residual venous narrowing and cervical or first rib resection for thoracic outlet abnormalities.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Identify the device given below.",
    "choices": [
      {
        "id": 1,
        "text": "Dialysis port"
      },
      {
        "id": 2,
        "text": "Chemoport"
      },
      {
        "id": 3,
        "text": "Electro-convulsive therapy lead"
      },
      {
        "id": 4,
        "text": "Gamma camera"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given image shows a&nbsp;<strong>chemoport.</strong></p>\n<p>Chemoports are<strong>&nbsp;implantable venous access devices</strong> used to facilitate <strong>chemotherapy</strong> administration.</p>\n<p><strong>Internal jugular veins and subclavian veins</strong> are the commonly used <strong>access veins</strong> for port placement. These devices are usually retained for a period of 1 to 2 years or more after which the device is explanted.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/0e9ad986d9274e58804110db4c577278.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following vessel is affected in May-Thurner syndrome?",
    "choices": [
      {
        "id": 1,
        "text": "left iliac vein"
      },
      {
        "id": 2,
        "text": "Right iliac artery"
      },
      {
        "id": 3,
        "text": "Left iliac artery"
      },
      {
        "id": 4,
        "text": "Right iliac vein"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>May-Thurner syndrome</strong> refers to <strong>iliofemoral venous thrombosis</strong>.</p>\n<p>At the site where the <strong>right iliac artery crosses over the left iliac vein</strong>, the left iliac vein may become chronically narrowed predisposing to iliofemoral venous thrombosis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://cdn1.dailyrounds.org/uploads/5e345d17f0fd44659c7b8899f23c0b18x625x362.PNG"
    ]
  },
  {
    "text": "A 65-year-old woman with a history of varicose vein, presented with a painless lesion on her left leg for the past 1 month. On examination, an ulcer of size 5 \u2715 5 cm with an irregular margin and sloping edge was found on the medial malleolus of the left leg. All the following can be used to manage this patient except?",
    "choices": [
      {
        "id": 1,
        "text": "Oral pentoxifylline"
      },
      {
        "id": 2,
        "text": "Surgical excision and pinch mesh grafting"
      },
      {
        "id": 3,
        "text": "4 layer bandaging system"
      },
      {
        "id": 4,
        "text": "Revascularization"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The likely diagnosis, in this case, is a <strong>venous ulcer secondary to the varicose vein</strong>. <strong>Revascularization</strong> is not a part of the management of venous ulcers.&nbsp;<br />Venous ulcers are due to <strong>chronic venous insufficiency</strong> and are particularly seen in the area between the muscles of the calf and ankle. It has a <strong>sloping edge</strong> and the <strong>floor contains granulation tissue</strong> covered by slough and exudate. <strong>Marjolin&rsquo;s ulcer</strong> is a type of squamous cell carcinoma seen in <strong>chronic long-standing venous ulcers.</strong></p>\n<p>Management of venous ulcers:</p>\n<ul>\n<li><strong>Bisgaard's regimen</strong>\n<ul>\n<li><strong>Education</strong></li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Elevation</strong> of the affected limb to reduce the edema</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Elastic compression stockings - </strong>The ideal interface pressure in venous ulceration is <strong>35-40 mmHg.</strong></li>\n<li><strong>Evaluation</strong></li>\n</ul>\n</li>\n<li><strong>4 layer bandaging system comprising of:</strong>\n<ul>\n<li>Orthopedic wool</li>\n<li>Cotton crepe</li>\n<li style=\"font-weight: 400;\" aria-level=\"2\">Elastic bandage - first compressive layer</li>\n<li style=\"font-weight: 400;\" aria-level=\"2\">Cohesive bandage - second compressive layer</li>\n</ul>\n</li>\n<li><strong>Antibiotics</strong> are given only if the wound is <strong>infected</strong>.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Regular <strong>dressing</strong>.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Medical management by <strong>oral</strong> <strong>pentoxifylline</strong> is considered which helps in reducing the viscosity and improving circulation.&nbsp;</li>\n<li>&nbsp;Surgery -<strong> Ulcer excision</strong> with <strong>pinch mesh grafting</strong> has a good outcome and helps in preventing recurrence.&nbsp;</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://upload.wikimedia.org/wikipedia/commons/5/59/%C3%9Alcera_varicosa_%28RPS_24-08-2020%29_en_pierna_con_insuficiencia_venosa_cr%C3%B3nica.png"
    ],
    "explanation_images": []
  },
  {
    "text": "A 40-year-old hairdresser presented with complaints of swelling, throbbing pain, and heaviness in her left leg for the past 1 year. A duplex scan done showed great saphenous vein incompetence. Which of the following is the treatment of choice?",
    "choices": [
      {
        "id": 1,
        "text": "Trendelenburg\u2019s procedure"
      },
      {
        "id": 2,
        "text": "Dodd and Crockett surgery"
      },
      {
        "id": 3,
        "text": "SEPS"
      },
      {
        "id": 4,
        "text": "Endothermal ablation"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The above clinical scenario is suggestive of <strong>varicose veins</strong> and the treatment of choice in this patient is <strong>endothermal ablation</strong>.<br />Management of varicose veins</p>\n<p>1. Great saphenous vein (GSV) and saphenofemoral incompetence (SFJ)&nbsp;</p>\n<ul>\n<li><strong>Endothermal ablation</strong> - It is the <strong>gold</strong> <strong>standard</strong> method. It includes:\n<ul>\n<li><strong>Endovenous laser ablation (EVLA)</strong></li>\n<li><strong>Radiofrequency ablation (RFA.</strong></li>\n</ul>\n</li>\n<li><strong>Trendelenburg procedure &plusmn; stripping</strong>&nbsp; - <strong>Flush ligation of SFJ</strong> and ligation of 6 tributaries.</li>\n</ul>\n<p>2. Short saphenous vein (SSJ) and saphenopopliteal incompetence (SPJ).&nbsp;</p>\n<ul>\n<li>Flush ligation of SPJ. No stripping is done to prevent nerve injury</li>\n<li>EVLA or RFA.</li>\n</ul>\n<p>3. Perforator incompetence</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Dodd and Crockett surgery</strong> - Multiple subfacial ligations.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Subfascial endoscopic perforator surgery</strong> (<strong>SEPS</strong>)</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">EVLA or RFA</li>\n</ul>\n<p>New treatment modalities</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Foam sclerotherapy&nbsp;</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Endovenous glue therapy</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">TriVex - Transilluminated powered phlebectomy</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 55-year-old locomotive operator presents with complaints of worm-like swelling over his right leg. During clinical examination, a Brodie Trendelenburg test is performed. Which of the following statements is false regarding the test?",
    "choices": [
      {
        "id": 1,
        "text": "A tourniquet can be used for occluding the saphenofemoral junction"
      },
      {
        "id": 2,
        "text": "Rapid filling  from above indicates saphenofemoral incompetence"
      },
      {
        "id": 3,
        "text": "Gradual filling  from below upwards indicates saphenopopliteal incompetence"
      },
      {
        "id": 4,
        "text": "Positive Brodie Trendelenburg test indicates a need for surgery"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The <strong>gradual filling of veins from below upwards</strong> indicates the <strong>perforator</strong>\u00a0<strong>incompetence.</strong>\u00a0<strong>Brodie Trendelenberg test</strong> is performed to test for the incompetence of the saphenofemoral valve and the communicating system.</p>\n<p>1.<strong> Trendelenburg\u2019s test -\u00a0</strong>Lay the patient down and elevate the leg. Empty the vessels and tie a tourniquet below the SFJ. Ask the patient to stand up:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Trendelenburg\u2019s test part ll - Here the tourniquet is <strong>not released</strong>. A <strong>gradual filling</strong> from <strong>below to upwards</strong> indicates <strong>perforator incompetence.</strong></li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Trendelenburg\u2019s test part l - Here the tourniquet is <strong>released</strong>. A <strong>rapid filling</strong> from<strong> above</strong> shows the <strong>saphenofemoral incompetence.</strong></li>\n</ul>\n<p>2.\u00a0<strong>Morrisey\u2019s cough impulse</strong>: the patient is asked to cough. A <strong>cough impulse</strong> at the saphenofemoral junction indicates <strong>SFJ incompetence</strong>.</p>\n<p>3. <strong>Schwartz test</strong>: If a <strong>thrill</strong> is felt at <strong>SFJ</strong> on <strong>tapping</strong> over the incompetent vein, indicates <strong>SFJ incompetence</strong>.</p>\n<p>4. <strong>Modified Perthes test</strong>: A <strong>tourniquet</strong> is tied <strong>below SFJ</strong> and the patient is asked to walk. An <strong>increase in pain</strong> and <strong>prominence</strong> of dilated <strong>veins</strong> indicate <strong>DVT</strong>.</p>\n<p>5. <strong>Fegan\u2019s method</strong> - Mark the places of excessive bulges within the varicosities. Ask the patient to lie down and empty the varicose vessels. <strong>Palpate</strong> along the marked area to look for<strong> gaps and pits</strong> in the deep fascia, which indicates <strong>perforator incompetence</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '52 Venous Diseases';
        let hierarchy = ["Marrow", "qBank", "Surgery"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>