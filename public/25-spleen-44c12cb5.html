<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>25 Spleen - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        PrepLadder / qBank / Surgery
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">10</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "<p>Which of the following statements about the spleen is not true?</p>\n\n<p>\u00a0</p>",
    "choices": [
      {
        "id": 1,
        "text": "Normal adult spleen weights 75\u2013250 g."
      },
      {
        "id": 2,
        "text": "The long axis lies along the 10th rib."
      },
      {
        "id": 3,
        "text": "It develops from the mesenchymal cells of the ventral mesogastrium."
      },
      {
        "id": 4,
        "text": "It is an intraperitoneal organ"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Correct Answer: C)</strong> It develops from the mesenchymal cells of the <span class=\"customMeta\" data-dictid=\"9ccb2fd2f31692777201e231bfda74\">ventral</span> mesogastrium.</p>\n\n<p>\u00a0</p>\n\n<p><strong>Explanation: <span class=\"customMeta\" data-dictid=\"6a4861c8d71692777199aeb1d55c85\">Spleen</span> </strong>develops from mesenchymal cells in the<strong> dorsal</strong> <strong>mesogastrium </strong>during 5th week of embryogenesis.<strong> </strong></p>\n\n<p>\u00a0</p>\n\n<p><strong>Anatomy of spleen:</strong></p>\n\n<ul>\n\t<li>Weight: 75 to 250 gm <strong>(Option A ruled out)</strong></li>\n\t<li>Location: left hypochondrium, along the <span class=\"customMeta\" data-dictid=\"3c28fd47f71692777182efbbaa5f6d\">axis</span> of the 10th rib. <strong>(Option B ruled out)</strong></li>\n\t<li>It is an <span class=\"customMeta\" data-dictid=\"e47e248094169277719000b0ed02ea\">intraperitoneal</span> organ. <strong>(Option D ruled out)</strong><strong> </strong></li>\n\t<li>Largest <span class=\"customMeta\" data-dictid=\"4fb6bd90f016927771918d4a2993ed\">lymphatic</span> organ</li>\n\t<li>In a healthy adult, the <span class=\"customMeta\" data-dictid=\"6a4861c8d71692777199aeb1d55c85\">spleen</span> is not usually palpable.</li>\n\t<li>It becomes <span class=\"customMeta\" data-dictid=\"bd478e4ff816927771949528846af9\">palpable</span> when the size increases by more than 2.5 times.</li>\n\t<li>Suspended by two ligaments: <span class=\"customMeta\" data-dictid=\"7eff3bb8881692777191603994c78f\">lienorenal</span> <span class=\"customMeta\" data-dictid=\"301e3b01f01692777191aced6dc342\">ligament</span> and <span class=\"customMeta\" data-dictid=\"db7888401a1692777188dcecc605ac\">gastrosplenic</span> ligament.</li>\n\t<li>Relations of the spleen:\n\t<ul>\n\t\t<li>Related to the 9th, 10th, and 11th rib, with its long <span class=\"customMeta\" data-dictid=\"3c28fd47f71692777182efbbaa5f6d\">axis</span> along the 10th rib.</li>\n\t\t<li>It is related to the <span class=\"customMeta\" data-dictid=\"67492c42be16927772039f6e37110e\">fundus</span> of the stomach, the tail of the pancreas, the splenic <span class=\"customMeta\" data-dictid=\"13e47cfa68169277720299cd54beb4\">flexure</span> of the colon, and the <span class=\"customMeta\" data-dictid=\"1ba6a9cfe11692777181950edd7a6d\">anterior</span> surface of the left <span class=\"customMeta\" data-dictid=\"4aa6035df41692777190b41d4a1583\">kidney</span> on it\u2019s visceral surface.</li>\n\t\t<li>Two important ligaments that keep it in place are<strong> <span class=\"customMeta\" data-dictid=\"db7888401a1692777188dcecc605ac\">gastrosplenic</span> and <span class=\"customMeta\" data-dictid=\"e244a577831692777199eecf7e9f47\">splenorenal</span> ligaments</strong>.</li>\n\t</ul>\n\t</li>\n</ul>\n\n<p><img alt=\"\" data-author=\"NA\" data-hash=\"\" data-license=\"NA\" data-source=\"NA\" data-tags=\"\" height=\"500\" src=\"https://image.prepladder.com/content/FbBFzOH0VO6uOttdoh8C1740024203.png\" width=\"500\" /></p>\n\n<p><strong>Physiology:</strong></p>\n\n<ul>\n\t<li><strong>Hematopoietic: </strong>During embryonic development.</li>\n\t<li><strong>Reservoir: </strong>It pools in platelets</li>\n\t<li><strong>Filtration:</strong> removal of senescent cells, <span class=\"customMeta\" data-dictid=\"12a6f23332169277718402ca6703e2\">cellular</span> inclusions (RBC nucleoli), and parasites, and the <span class=\"customMeta\" data-dictid=\"dd02fbdad81692777198e605d5fbd2\">sequestration</span> of RBCs (for maturation).</li>\n\t<li><strong>Immunity:</strong> It processes foreign antigens and is the major site of specific <span class=\"customMeta\" data-dictid=\"f8fab286571692777189bdfd087071\">immunoglobulin</span> (IgM) production. <span class=\"customMeta\" data-dictid=\"3fda45538a1692777199ec2a5478a5\">Synthesis</span> of non-specific opsonins, <span class=\"customMeta\" data-dictid=\"c6daf336cd1692777196a8c1d32141\">properdin</span> and <span class=\"customMeta\" data-dictid=\"d991fff13a169277720152521fc07d\">tuftsin</span> takes place.</li>\n</ul>\n\n<p><br />\n\u00a0</p>",
    "question_images": [],
    "explanation_video": null,
    "explanation_images": [
      "https://image.prepladder.com/content/FbBFzOH0VO6uOttdoh8C1740024203.png"
    ],
    "explanation_audio_eng": "https://image.prepladder.com/content/d4egh34udQ0zFoU8AQPC1746106641.mp3",
    "explanation_audio_hin": "https://image.prepladder.com/content/xLwqK1FDsBGGHTThtuR91746106698.mp3"
  },
  {
    "text": "<p>What is the most common indication for a splenectomy?</p>\n\n<p>\u00a0</p>",
    "choices": [
      {
        "id": 1,
        "text": "Hereditary spherocytosis"
      },
      {
        "id": 2,
        "text": "Idiopathic thrombocytopenic purpura (ITP)"
      },
      {
        "id": 3,
        "text": "Trauma"
      },
      {
        "id": 4,
        "text": "Abscess"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>\u00a0</p>\n\n<p><strong>Correct Answer: C) </strong>Trauma</p>\n\n<p>\u00a0</p>\n\n<p><strong>Explanation: </strong>Splenic trauma is the most common indication for splenectomy.</p>\n\n<p>\u00a0</p>\n\n<p><strong>Indications for splenectomy:</strong></p>\n\n<ul>\n\t<li><strong>Trauma: </strong>Accidental, Iatrogenic</li>\n\t<li><strong>Hematological: </strong>Spherocytosis, <span class=\"customMeta\" data-dictid=\"0acd34c758169277719644923511e5\">Purpura</span> (ITP), Hypersplenism</li>\n\t<li><strong>Portal hypertension:</strong> <span class=\"customMeta\" data-dictid=\"d4607865bb1692777201a35341db81\">Variceal</span> bleed, surgery</li>\n\t<li><strong>Oncological: </strong>Part of <span class=\"customMeta\" data-dictid=\"fc695a78ad16927771878f69871998\">en</span> bloc resection, Diagnostic, Therapeutic</li>\n</ul>\n\n<p>\u00a0</p>\n\n<p>Most common indication- <strong>Trauma</strong> <strong>(Option C)</strong></p>\n\n<p>Most common indication of <span class=\"customMeta\" data-dictid=\"37d3e89821169277718799ed0c2a19\">elective</span> splenectomy- <strong>ITP</strong> (Idiopathic thrombocytopenic purpura) <strong> (Option B ruled out)</strong></p>\n\n<p><strong>Always indicated in:</strong></p>\n\n<ul>\n\t<li>Grade V splenic injury</li>\n\t<li>Primary splenic tumor</li>\n\t<li>Hereditary spherocytosis<strong> (Option A ruled out)</strong></li>\n</ul>\n\n<p><strong>Usually indicated in:</strong></p>\n\n<ul>\n\t<li>Chronic ITP</li>\n\t<li>Abscess<strong> </strong><strong> (Option D ruled out)</strong></li>\n\t<li>Splenic <span class=\"customMeta\" data-dictid=\"75ddd4cc7016927772012e0acd424d\">vein</span> <span class=\"customMeta\" data-dictid=\"3e745919391692777200fae21b7251\">thrombosis</span> leading to <span class=\"customMeta\" data-dictid=\"12347b15191692777188bc86d226e1\">gastric</span> varices</li>\n\t<li>Primary hypersplenism</li>\n\t<li>Autoimmune <span class=\"customMeta\" data-dictid=\"d30ae941d516927771889351160b00\">hemolytic</span> <span class=\"customMeta\" data-dictid=\"53bee2a41216927771814d7ec3a67f\">anemia</span> (AIHA)</li>\n</ul>\n\n<p><strong>Low benefit:</strong></p>\n\n<ul>\n\t<li>Thalassaemia</li>\n\t<li>Chronic <span class=\"customMeta\" data-dictid=\"258737f45016927771931e053a03d1\">myelogenous</span> <span class=\"customMeta\" data-dictid=\"4521dbf4b91692777191a73002bf98\">leukemia</span> (CML)</li>\n\t<li>Gaucher's disease</li>\n\t<li>Hodgkin's <span class=\"customMeta\" data-dictid=\"5a31d184f21692777191a2e457d646\">lymphoma</span> for <span class=\"customMeta\" data-dictid=\"8ea2e3870f16927771990a138acbc1\">staging</span> laparotomy</li>\n\t<li>Sickle cell anemia</li>\n</ul>",
    "question_images": [],
    "explanation_video": null,
    "explanation_images": [],
    "explanation_audio_eng": "https://image.prepladder.com/content/WaIt2N0nGzfo1A4e7RCU1746108200.mp3",
    "explanation_audio_hin": "https://image.prepladder.com/content/joRg2ru6CEzsuynMecCL1746108248.mp3"
  },
  {
    "text": "<p>A 45-year-old male is planned for an elective splenectomy due to hereditary spherocytosis. Which of the following vaccination strategies is most appropriate to prevent infections post-splenectomy?</p>",
    "choices": [
      {
        "id": 1,
        "text": "10-12 weeks before surgery"
      },
      {
        "id": 2,
        "text": "Only if the patient shows signs of infection"
      },
      {
        "id": 3,
        "text": "Delay all vaccinations until 6 months after surgery"
      },
      {
        "id": 4,
        "text": "1 week before the surgery"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Correct Answer: A)\u00a010-12 weeks before surgery</strong></p>\n\n<p><strong>Explanation:</strong></p>\n\n<p>For patients planned for <span class=\"customMeta\" data-dictid=\"37d3e89821169277718799ed0c2a19\">elective</span> splenectomy, such as in <span class=\"customMeta\" data-dictid=\"ee5175c06116927771880846d1cbe0\">hereditary</span> spherocytosis, the best strategy to prevent overwhelming post-splenectomy infections (especially from <span class=\"customMeta\" data-dictid=\"e26ba9a1d41692777187d0ad03a8c1\">encapsulated</span> bacteria like Streptococcus pneumoniae, Haemophilus influenzae type b, and Neisseria meningitidis) involves administering vaccines\u00a0<strong>well in advance</strong>\u00a0of surgery.</p>\n\n<ul>\n\t<li>\n\t<p>Vaccinating\u00a0<strong>10-12 weeks before surgery</strong>\u00a0allows enough time for the patient\u2019s immune system to mount an effective response and develop <span class=\"customMeta\" data-dictid=\"208cf74d74169277719486afd05eb3\">optimal</span> protective <span class=\"customMeta\" data-dictid=\"9d7a12cab116927771811a0079086d\">antibody</span> levels before the <span class=\"customMeta\" data-dictid=\"6a4861c8d71692777199aeb1d55c85\">spleen</span> is removed.</p>\n\t</li>\n\t<li>\n\t<p>This vaccine timing provides the best opportunity for <span class=\"customMeta\" data-dictid=\"4f9ee631c21692777189b1e0cdc91c\">immunity</span> to establish, minimizing the risk of severe infections after the <span class=\"customMeta\" data-dictid=\"6a4861c8d71692777199aeb1d55c85\">spleen</span> is removed.</p>\n\t</li>\n</ul>\n\n<p><strong>Key vaccines to administer:</strong></p>\n\n<ul>\n\t<li>\n\t<p><strong>Pneumococcal vaccine</strong> (preferably PCV13 followed by PPSV23)</p>\n\t</li>\n\t<li>\n\t<p><strong>Haemophilus influenzae <span class=\"customMeta\" data-dictid=\"0dddac147b1692777201460ab59600\">type B</span> (Hib) vaccine</strong></p>\n\t</li>\n\t<li>\n\t<p><strong>Meningococcal vaccine</strong> (covering groups A, C, W, and Y; MenB as needed)</p>\n\t</li>\n\t<li>\n\t<p>Annual <strong>influenza vaccination</strong> is also recommended</p>\n\t</li>\n</ul>\n\n<p>\u00a0</p>\n\n<p><strong>Vaccination Recommendations for Asplenic Patients:</strong></p>\n\n<table>\n\t<thead>\n\t\t<tr>\n\t\t\t<th><strong>Vaccine</strong></th>\n\t\t\t<th><strong>Children</strong></th>\n\t\t\t<th><strong>Adults (\u226519 years)</strong></th>\n\t\t</tr>\n\t</thead>\n\t<tbody>\n\t\t<tr>\n\t\t\t<td><strong>Pneumococcal</strong></td>\n\t\t\t<td>PCV13 \u2192 PPSV23 (8 weeks later) \u2192 Repeat PPSV23 after 5 years</td>\n\t\t\t<td>PCV13 \u2192 PPSV23 (8 weeks later) \u2192 Repeat PPSV23 every 5 years</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td><strong>Meningococcal</strong></td>\n\t\t\t<td>MenACWY <strong>series</strong> + MenB <strong>series</strong></td>\n\t\t\t<td>MenACWY or MPSV4 (2 doses, 2 months apart) \u2192 Repeat MenACWY every 5 years<br />\n\t\t\t+ MenB <strong>series once</strong></td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td><strong>Haemophilus influenzae type b</strong></td>\n\t\t\t<td>Single dose if \u226515 months and unvaccinated</td>\n\t\t\t<td>Single dose if not previously vaccinated</td>\n\t\t</tr>\n\t</tbody>\n</table>\n\n<p>\u00a0</p>\n\n<p><strong>Timing of Vaccination:</strong></p>\n\n<table>\n\t<thead>\n\t\t<tr>\n\t\t\t<th><strong>Scenario</strong></th>\n\t\t\t<th><strong>Recommendation</strong></th>\n\t\t</tr>\n\t</thead>\n\t<tbody>\n\t\t<tr>\n\t\t\t<td><strong>Elective <span class=\"customMeta\" data-dictid=\"3c702f2ca816927771998e8ca552e1\">splenectomy</span> (ideal)</strong></td>\n\t\t\t<td>10\u201312 weeks before surgery <em>(optimal for immune response)</em></td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td><strong>Elective <span class=\"customMeta\" data-dictid=\"3c702f2ca816927771998e8ca552e1\">splenectomy</span> (minimum)</strong></td>\n\t\t\t<td><strong>At least 2 weeks before</strong> surgery</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td><strong>Emergency splenectomy</strong></td>\n\t\t\t<td>At hospital <span class=\"customMeta\" data-dictid=\"9dd87431ba1692777186ecfb21d258\">discharge</span> <strong>or</strong> 14 days post-op, <strong>whichever <span class=\"customMeta\" data-dictid=\"89f5610ffd1692777184b03f1f88cc\">comes</span> first</strong></td>\n\t\t</tr>\n\t</tbody>\n</table>\n\n<p>\u00a0</p>\n\n<p><strong>Additional CDC-Recommended Vaccinations:</strong></p>\n\n<p>As per <strong>CDC 2020 guidelines</strong>, the following should also be considered based on age and risk factors:</p>\n\n<ul>\n\t<li>\n\t<p><strong>Influenza</strong> (annually)</p>\n\t</li>\n\t<li>\n\t<p><strong>Tdap or Td</strong></p>\n\t</li>\n\t<li>\n\t<p><strong>HPV</strong></p>\n\t</li>\n\t<li>\n\t<p><strong>MMR</strong></p>\n\t</li>\n\t<li>\n\t<p><strong>Varicella</strong></p>\n\t</li>\n\t<li>\n\t<p><strong>Zoster</strong></p>\n\t</li>\n\t<li>\n\t<p><strong>Hepatitis A and B</strong></p>\n\t</li>\n</ul>\n\n<p><strong>Key Points:</strong></p>\n\n<ul>\n\t<li>\n\t<p><strong>Encapsulated organisms</strong> (e.g., <em>Streptococcus pneumoniae</em>, <em>Neisseria meningitidis</em>, <em>Haemophilus influenzae</em>) pose high infection risk post-splenectomy.</p>\n\t</li>\n\t<li>\n\t<p>Vaccination significantly reduces the risk of <strong>Overwhelming Post-Splenectomy Infection (OPSI)</strong>.</p>\n\t</li>\n\t<li>\n\t<p><strong>Booster doses</strong> and <strong>lifelong follow-up</strong> are essential.</p>\n\t</li>\n</ul>\n\n<p><strong>Only if the patient shows signs of infection (Option B)</strong>\u00a0is incorrect because vaccines are <strong>prophylactic</strong>, not therapeutic. Waiting for infection defeats their <span class=\"customMeta\" data-dictid=\"e684325d851692777196af9e64013b\">preventive</span> purpose.</p>\n\n<p>\u00a0</p>\n\n<p><strong>Delay all vaccinations until 6 months after surgery (Option C)</strong>\u00a0is incorrect because this would leave the patient <strong>highly <span class=\"customMeta\" data-dictid=\"55691242bb1692777199360f64cb67\">susceptible</span> to life-threatening infections</strong>, especially overwhelming post-splenectomy infection (OPSI), during the critical early period post-op.<br />\n<br />\n<strong>1 week before the surgery (Option D):</strong> Vaccinating only 1 week before surgery is too short a window for adequate immune response.</p>",
    "question_images": [],
    "explanation_video": null,
    "explanation_images": [],
    "explanation_audio_eng": "https://image.prepladder.com/content/PLCiisj31yoYUlx6iA4Z1746108351.mp3",
    "explanation_audio_hin": "https://image.prepladder.com/content/z1SF9CpVGgGx9QTWDfy51746108401.mp3"
  },
  {
    "text": "<p>An elderly male undergoes an open splenectomy due to splenic rupture following a car accident. In the postoperative room, he complains of shortness of breath and chest discomfort. What is the MOST common immediate complication after a splenectomy?</p>\n\n<p>\u00a0</p>",
    "choices": [
      {
        "id": 1,
        "text": "Pulmonary embolism"
      },
      {
        "id": 2,
        "text": "Left basal atelectasis"
      },
      {
        "id": 3,
        "text": "Pleural effusion"
      },
      {
        "id": 4,
        "text": "Pneumonia"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Correct Answer: B) </strong> Left <span class=\"customMeta\" data-dictid=\"923af580cf16927771829606bce2a7\">basal</span> atelectasis</p>\n\n<p>\u00a0</p>\n\n<p><strong>Explanation:</strong> Left <span class=\"customMeta\" data-dictid=\"d7dd6ae43c1692777191cf75c0bd58\">lobe</span> <span class=\"customMeta\" data-dictid=\"7a5ca69ddf16927771829cd4e4d464\">atelectasis</span> is the most common <span class=\"customMeta\" data-dictid=\"8a6b09beac1692777184b08a2b5766\">complication</span> after a splenectomy.</p>\n\n<p>\u00a0</p>\n\n<p><strong>Complications after splenectomy:</strong></p>\n\n<p>\u00a0</p>\n\n<p><strong>Short-term complications:</strong></p>\n\n<ul>\n\t<li>Postoperative bleeding: Slipped <span class=\"customMeta\" data-dictid=\"3e0d0648b81692777191eca3015435\">ligature</span> from the hilar vessels or short <span class=\"customMeta\" data-dictid=\"12347b15191692777188bc86d226e1\">gastric</span> vessels.</li>\n\t<li>Pneumonia<strong> (Option D ruled out)</strong></li>\n\t<li>Left-sided pleural effusion<strong> (Option C ruled out)</strong></li>\n\t<li>Pancreatic leak and fistula</li>\n\t<li>Left <span class=\"customMeta\" data-dictid=\"d7dd6ae43c1692777191cf75c0bd58\">lobe</span> <span class=\"customMeta\" data-dictid=\"7a5ca69ddf16927771829cd4e4d464\">atelectasis</span> <strong>(Option B)</strong></li>\n\t<li>Gastric <span class=\"customMeta\" data-dictid=\"23b5d65f051692777195987380382d\">perforation</span> at the greater <span class=\"customMeta\" data-dictid=\"4bd67d54f016927771850c953dadbc\">curvature</span> and <span class=\"customMeta\" data-dictid=\"12347b15191692777188bc86d226e1\">gastric</span> fistula</li>\n\t<li>Post-splenectomy <span class=\"customMeta\" data-dictid=\"3e745919391692777200fae21b7251\">thrombosis</span> of the splenic, mesenteric, and <span class=\"customMeta\" data-dictid=\"a74252404f1692777196d3f24bde2d\">portal</span> veins (PST-SMPv)</li>\n\t<li>Left <span class=\"customMeta\" data-dictid=\"c056c8184b1692777199878ec26571\">subphrenic</span> abscess</li>\n\t<li>Acute <span class=\"customMeta\" data-dictid=\"98ea94d2c01692777194cc5ffee153\">pancreatitis</span> from injury to the tail of the pancreas</li>\n\t<li>Septicemia</li>\n</ul>\n\n<p>\u00a0</p>\n\n<p><strong>Late complications:</strong></p>\n\n<ul>\n\t<li><strong>Post-splenectomy thrombosis</strong> of the splenic, mesenteric, and <span class=\"customMeta\" data-dictid=\"a74252404f1692777196d3f24bde2d\">portal</span> veins (PST-SMPv).</li>\n\t<li><strong>DVT/Pulmonary embolism</strong><strong> (Option A ruled out)</strong>- due to post-splenectomy <span class=\"customMeta\" data-dictid=\"3e745919391692777200fae21b7251\">thrombosis</span> and prolonged immobility.</li>\n\t<li><strong>Overwhelming post-splenectomy infection (OPSI):</strong> Most common and fatal late complication.</li>\n\t<li><strong>Septicemia</strong></li>\n</ul>",
    "question_images": [],
    "explanation_video": null,
    "explanation_images": [],
    "explanation_audio_eng": "https://image.prepladder.com/content/Q26xsW3aSxZmH8XqBcSk1746108494.mp3",
    "explanation_audio_hin": "https://image.prepladder.com/content/UdvnFNu9aWNkCx6aLKOj1746108539.mp3"
  },
  {
    "text": "<p>A 25-year-old woman with thalassemia major undergoes an elective splenectomy. She is informed about potential complications and the need for vaccinations. When is the most common Fatal late complication of splenectomy most likely to occur?</p>\n\n<p>\u00a0</p>",
    "choices": [
      {
        "id": 1,
        "text": "Within the first 6 months"
      },
      {
        "id": 2,
        "text": "1-2 years post-splenectomy"
      },
      {
        "id": 3,
        "text": "2-5 years post-splenectomy"
      },
      {
        "id": 4,
        "text": "5-10 years post-splenectomy"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Correct Answer: C) </strong>2-5 years post-splenectomy</p>\n\n<p>\u00a0</p>\n\n<p><strong>Explanation: </strong>Overwhelming Post-Splenectomy Infection (OPSI) is the most common fatal late <span class=\"customMeta\" data-dictid=\"8a6b09beac1692777184b08a2b5766\">complication</span> usually seen after 2-5 years after splenectomy.</p>\n\n<p>\u00a0</p>\n\n<p><strong>Overwhelming Post-Splenectomy Infection (OPSI):</strong></p>\n\n<ul>\n\t<li>Causative organisms:\n\t<ul>\n\t\t<li>Polysaccharide <span class=\"customMeta\" data-dictid=\"e26ba9a1d41692777187d0ad03a8c1\">encapsulated</span> organisms like S. pneumoniae, N. meningitidis, and H. influenzae.</li>\n\t\t<li>Most common organism is<strong> S. pneumoniae</strong></li>\n\t</ul>\n\t</li>\n\t<li>Risk factors for OPSI:\n\t<ul>\n\t\t<li>Young age</li>\n\t\t<li>Thalassemia major (8.2%)</li>\n\t\t<li>Sickle cell <span class=\"customMeta\" data-dictid=\"53bee2a41216927771814d7ec3a67f\">anemia</span> (7.3%)</li>\n\t\t<li>Idiopathic <span class=\"customMeta\" data-dictid=\"fc28c74bb716927772003aee4aa43c\">thrombocytopenia</span> (2.1%)</li>\n\t\t<li>Lymphoma</li>\n\t\t<li>Immunosuppression</li>\n\t</ul>\n\t</li>\n</ul>\n\n<ul>\n\t<li>Mortality rate: 40% and 50%</li>\n\t<li>OPSI is easier to prevent but difficult to treat.</li>\n\t<li>Prevention: Vaccination</li>\n</ul>\n\n<p>Time for vaccination:</p>\n\n<ul>\n\t<li>Ideally- 10-12 weeks before surgery</li>\n\t<li>At least 2 weeks before an <span class=\"customMeta\" data-dictid=\"37d3e89821169277718799ed0c2a19\">elective</span> surgery</li>\n\t<li>Emergency splenectomy- At <span class=\"customMeta\" data-dictid=\"9dd87431ba1692777186ecfb21d258\">discharge</span> or 14 days after surgery whichever is first.</li>\n</ul>\n\n<p>\u00a0</p>\n\n<ul>\n\t<li><strong>Treatment: </strong>Broad-spectrum antibiotics and supportive care.</li>\n</ul>\n\n<p>\u00a0</p>",
    "question_images": [],
    "explanation_video": null,
    "explanation_images": [],
    "explanation_audio_eng": "https://image.prepladder.com/content/xRpYv7HxuOlJNDjEXqUA1746108639.mp3",
    "explanation_audio_hin": "https://image.prepladder.com/content/x8MRhWwsqFZ8YV5iWGee1746108817.mp3"
  },
  {
    "text": "<p>A 4-year-old boy is brought to the clinic with a history of sudden onset of petechial hemorrhages and purpuric patches on the skin. The mother also reports episodes of spontaneous epistaxis over the past few days. He had a flu-like illness a few weeks ago. Laboratory investigations show isolated thrombocytopenia. Which of the following symptoms is most likely to be seen in this patient?</p>\n\n<p>\u00a0</p>",
    "choices": [
      {
        "id": 1,
        "text": "Equal incidence in both males and females"
      },
      {
        "id": 2,
        "text": "Predominantly seen in females aged 15-50"
      },
      {
        "id": 3,
        "text": "Associated with renal dysfunction"
      },
      {
        "id": 4,
        "text": "Hemolytic anemia and jaundice"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>\u00a0</p>\n\n<p><strong>Correct Answer: A) Equal <span class=\"customMeta\" data-dictid=\"17cd3771bb1692777190950c142dbe\">incidence</span> in both males and females</strong></p>\n\n<p>\u00a0</p>\n\n<p><strong>Explanation:</strong></p>\n\n<p>Acute <span class=\"customMeta\" data-dictid=\"57ddcfb8ec1692777190b76f23c2e5\">ITP</span> typically presents in children under the age of 5 and affects both males and females equally. The sudden onset of petechiae, purpura, and <span class=\"customMeta\" data-dictid=\"f71e485d131692777199151d1076d2\">spontaneous</span> <span class=\"customMeta\" data-dictid=\"41e858bf2816927771836d46c619b9\">bleeding</span> are characteristic features.</p>\n\n<h3><strong>Immune Thrombocytopenic <span class=\"customMeta\" data-dictid=\"0acd34c758169277719644923511e5\">Purpura</span> (ITP)</strong></h3>\n\n<ul>\n\t<li><strong>Definition</strong>: An <span class=\"customMeta\" data-dictid=\"96ab11a06a16927771823151c8e471\">autoimmune</span> disease where antibodies attack <span class=\"customMeta\" data-dictid=\"e7032bae7f1692777195d693722e54\">platelet</span> <span class=\"customMeta\" data-dictid=\"34cd707428169277719272942b7905\">membrane</span> glycoproteins, leading to isolated thrombocytopenia.</li>\n\t<li><strong>Types</strong>:\n\t<ul>\n\t\t<li><strong>Acute ITP</strong>: Occurs in children.</li>\n\t\t<li><strong>Chronic ITP</strong>: Occurs in adults.</li>\n\t</ul>\n\t</li>\n</ul>\n\n<h3><strong>Clinical Features</strong></h3>\n\n<ul>\n\t<li><strong>Chronic ITP</strong>:\n\n\t<ul>\n\t\t<li>More common in women aged 15-50.</li>\n\t\t<li>Can affect any age or sex.</li>\n\t</ul>\n\t</li>\n\t<li><strong>Acute ITP</strong>:\n\t<ul>\n\t\t<li>Typically presents before age 5.</li>\n\t\t<li>Affects males and females equally. <strong>(Option A)</strong></li>\n\t</ul>\n\t</li>\n\t<li><strong>Symptoms</strong>:\n\t<ul>\n\t\t<li><strong>Skin & <span class=\"customMeta\" data-dictid=\"26080f047a169277719334625cadef\">Mucous</span> Membranes</strong>: <span class=\"customMeta\" data-dictid=\"5ebd16bced169277719626d7499114\">Purpuric</span> patches (ecchymoses), petechial hemorrhages.</li>\n\t\t<li><strong>Mucous Membranes</strong>: <span class=\"customMeta\" data-dictid=\"f71e485d131692777199151d1076d2\">Spontaneous</span> <span class=\"customMeta\" data-dictid=\"41e858bf2816927771836d46c619b9\">bleeding</span> (e.g., epistaxis).</li>\n\t\t<li><strong>Women</strong>: Menorrhagia.</li>\n\t\t<li><strong>General</strong>: Prolonged <span class=\"customMeta\" data-dictid=\"41e858bf2816927771836d46c619b9\">bleeding</span> from minor wounds.</li>\n\t</ul>\n\t</li>\n</ul>\n\n<p><strong>Diagnosis of ITP</strong></p>\n\n<p>\u00a0</p>\n\n<table cellspacing=\"0\" style=\"border-collapse:collapse; width:545px\">\n\t<thead>\n\t\t<tr>\n\t\t\t<th scope=\"col\" style=\"vertical-align:top\">\n\t\t\t<p><strong>Diagnostic Feature</strong></p>\n\t\t\t</th>\n\t\t\t<th scope=\"col\" style=\"vertical-align:top\">\n\t\t\t<p><strong>Finding</strong></p>\n\t\t\t</th>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<th scope=\"col\" style=\"vertical-align:top\">\n\t\t\t<p><strong>Palpable Spleen</strong></p>\n\t\t\t</th>\n\t\t\t<th scope=\"col\" style=\"vertical-align:top\">\n\t\t\t<p>Uncommon in ITP; may suggest an alternative diagnosis</p>\n\t\t\t</th>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<th scope=\"col\" style=\"vertical-align:top\">\n\t\t\t<p><strong>Coagulation Studies</strong></p>\n\t\t\t</th>\n\t\t\t<th scope=\"col\" style=\"vertical-align:top\">\n\t\t\t<p>Normal</p>\n\t\t\t</th>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<th scope=\"col\" style=\"vertical-align:top\">\n\t\t\t<p><strong>Bleeding Time Tests</strong></p>\n\t\t\t</th>\n\t\t\t<th scope=\"col\" style=\"vertical-align:top\">\n\t\t\t<p>Not useful in diagnosing ITP</p>\n\t\t\t</th>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<th scope=\"col\" style=\"vertical-align:top\">\n\t\t\t<p><strong>Cutaneous Ecchymoses</strong></p>\n\t\t\t</th>\n\t\t\t<th scope=\"col\" style=\"vertical-align:top\">\n\t\t\t<p>Present</p>\n\t\t\t</th>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<th scope=\"col\" style=\"vertical-align:top\">\n\t\t\t<p><strong>Tourniquet Test</strong></p>\n\t\t\t</th>\n\t\t\t<th scope=\"col\" style=\"vertical-align:top\">\n\t\t\t<p>Positive</p>\n\t\t\t</th>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<th scope=\"col\" style=\"vertical-align:top\">\n\t\t\t<p><strong>Complete Blood Count</strong></p>\n\t\t\t</th>\n\t\t\t<th scope=\"col\" style=\"vertical-align:top\">\n\t\t\t<p>Reduced <span class=\"customMeta\" data-dictid=\"e7032bae7f1692777195d693722e54\">platelet</span> count (< 60 x 10\u2079/L)</p>\n\t\t\t</th>\n\t\t</tr>\n\t</thead>\n\t<tbody>\n\t\t<tr>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p><strong>Bone <span class=\"customMeta\" data-dictid=\"c8a8c935a41692777191610f6aacb4\">Marrow</span> Aspiration</strong></p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p>Increased megakaryocytes</p>\n\t\t\t</td>\n\t\t</tr>\n\t</tbody>\n</table>\n\n<p>\u00a0</p>\n\n<p><strong>Renal dysfunction</strong><strong> (Option C)</strong>: is not a feature of <span class=\"customMeta\" data-dictid=\"57ddcfb8ec1692777190b76f23c2e5\">ITP</span> but is more characteristic of conditions like <span class=\"customMeta\" data-dictid=\"d30ae941d516927771889351160b00\">Hemolytic</span> <span class=\"customMeta\" data-dictid=\"7b92610b86169277720111ae27d1d8\">Uremic</span> Syndrome (HUS) or Thrombotic Thrombocytopenic <span class=\"customMeta\" data-dictid=\"0acd34c758169277719644923511e5\">Purpura</span> (TTP).</p>\n\n<p>\u00a0</p>\n\n<p><strong>Hemolytic <span class=\"customMeta\" data-dictid=\"53bee2a41216927771814d7ec3a67f\">anemia</span> and jaundice</strong><strong> (Option D)</strong>: are associated with conditions like TTP or HUS, not ITP, where isolated <span class=\"customMeta\" data-dictid=\"fc28c74bb716927772003aee4aa43c\">thrombocytopenia</span> is the primary finding.</p>\n\n<p>\u00a0</p>",
    "question_images": [],
    "explanation_video": null,
    "explanation_images": [],
    "explanation_audio_eng": "https://image.prepladder.com/content/JWcc3F28RY9GDJEM1MY81746108958.mp3",
    "explanation_audio_hin": "https://image.prepladder.com/content/eczhLnJ6fE21NTGophw61746109033.mp3"
  },
  {
    "text": "<p>A 45-year-old patient presents with persistent petechiae, frequent nosebleeds, and heavy menstrual bleeding over the past 7 months. She is being considered for splenectomy. Which statement accurately reflects the current approach to this treatment?</p>\n\n<p>\u00a0</p>",
    "choices": [
      {
        "id": 1,
        "text": "Laparoscopic splenectomy is preferred."
      },
      {
        "id": 2,
        "text": "Long-term steroid therapy is the primary approach."
      },
      {
        "id": 3,
        "text": "Approximately 50% of patients will achieve complete remission post-splenectomy."
      },
      {
        "id": 4,
        "text": "All patients receive pre-splenectomy transfusions immediately"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Correct Answer: A) <span class=\"customMeta\" data-dictid=\"b506527af81692777191e0f69912f6\">Laparoscopic</span> <span class=\"customMeta\" data-dictid=\"3c702f2ca816927771998e8ca552e1\">splenectomy</span> is preferred.</strong></p>\n\n<p>\u00a0</p>\n\n<p><strong>Explanation:</strong></p>\n\n<p>\u00a0</p>\n\n<p>The patient's symptoms\u2014persistent petechiae, frequent nosebleeds, and heavy <span class=\"customMeta\" data-dictid=\"3a03cad6c616927771925038b55989\">menstrual</span> bleeding\u2014suggest <strong>chronic <span class=\"customMeta\" data-dictid=\"820847dbe3169277718912e7961028\">immune thrombocytopenic purpura</span> (ITP)</strong>. Chronic <span class=\"customMeta\" data-dictid=\"57ddcfb8ec1692777190b76f23c2e5\">ITP</span> is defined by a <span class=\"customMeta\" data-dictid=\"e7032bae7f1692777195d693722e54\">platelet</span> count below normal for more than 6 months.</p>\n\n<p>\u00a0</p>\n\n<p>Laparoscopic <span class=\"customMeta\" data-dictid=\"3c702f2ca816927771998e8ca552e1\">splenectomy</span> is increasingly preferred due to its minimally <span class=\"customMeta\" data-dictid=\"1c5272ad3d1692777190e71409d07a\">invasive</span> nature. In ITP, the <span class=\"customMeta\" data-dictid=\"6a4861c8d71692777199aeb1d55c85\">spleen</span> is usually normal or slightly enlarged, making <span class=\"customMeta\" data-dictid=\"b506527af81692777191e0f69912f6\">laparoscopic</span> techniques suitable. Important to identify and remove splenunculi (accessory spleens) to prevent recurrence.</p>\n\n<h3><strong>Treatment for ITP</strong></h3>\n\n<ul>\n\t<li><strong>Acute ITP</strong>\n\n\t<ul>\n\t\t<li>Common in children.</li>\n\t\t<li>Often resolves without treatment.</li>\n\t\t<li>Short courses of corticosteroids are effective.</li>\n\t\t<li>Prolonged <span class=\"customMeta\" data-dictid=\"a48ce797cd1692777199efc43b3e4c\">steroid</span> therapy is not recommended.</li>\n\t</ul>\n\t</li>\n\t<li><strong>Chronic ITP(>6 months)</strong>\n\t<ul>\n\t\t<li>Typically affects adults.</li>\n\t\t<li>Corticosteroids are used but prolonged use is not advised.<strong> (Option B ruled out)</strong></li>\n\t\t<li>For <span class=\"customMeta\" data-dictid=\"3790c638ab16927771970a0a41d3ab\">refractory</span> or <span class=\"customMeta\" data-dictid=\"adcb58dd951692777197332b13ebe2\">relapsing</span> cases, <strong>splenectomy</strong> is generally recommended.</li>\n\t</ul>\n\t</li>\n</ul>\n\n<h3><strong>Splenectomy Outcomes</strong></h3>\n\n<ul>\n\t<li>Complete remission~66% (two-thirds) <strong>(Option C ruled out)</strong></li>\n\t<li>Some improvement- 15%</li>\n</ul>\n\n<p><strong>Predictors of Success</strong></p>\n\n<ul>\n\t<li>Response to steroids: Good responders are more likely to benefit from <span class=\"customMeta\" data-dictid=\"3c702f2ca816927771998e8ca552e1\">splenectomy</span> if the disease recurs.</li>\n</ul>\n\n<h3><strong>Pre-Splenectomy Considerations</strong></h3>\n\n<ul>\n\t<li><strong>Transfusions </strong>\n\n\t<ul>\n\t\t<li>May be necessary before a splenectomy.</li>\n\t\t<li>Typically not administered until splenic vessels are controlled. <strong>(Option D ruled out)</strong></li>\n\t</ul>\n\t</li>\n</ul>",
    "question_images": [],
    "explanation_video": null,
    "explanation_images": [],
    "explanation_audio_eng": "https://image.prepladder.com/content/fZ4LVPFR6mZa6cmsgtvi1746109133.mp3",
    "explanation_audio_hin": "https://image.prepladder.com/content/w62n5CuWmbk9LLfWbhXu1746109232.mp3"
  },
  {
    "text": "<p>A 30-year-old patient presents with an abdominal mass. Imaging studies reveal a cystic structure in the spleen. Based on the imaging characteristics and the absence of an epithelial lining, which of the following is the most likely diagnosis?</p>\n\n<p>\u00a0</p>",
    "choices": [
      {
        "id": 1,
        "text": "Cystic hemangioma"
      },
      {
        "id": 2,
        "text": "Mesenchymal Inclusion Cyst"
      },
      {
        "id": 3,
        "text": "Secondary cyst"
      },
      {
        "id": 4,
        "text": "Dermoid cyst"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>\u00a0</p>\n\n<p><strong>Correct Answer: C) Secondary cysts</strong></p>\n\n<p>\u00a0</p>\n\n<p><strong>Explanation:</strong></p>\n\n<p><strong>Secondary cysts</strong> (pseudocysts) lack an epithelial lining and often develop following trauma. They typically contain <span class=\"customMeta\" data-dictid=\"3963a2e0fa169277719874304f5705\">serous</span> or hemorrhagic fluid and may have calcified walls that resemble <span class=\"customMeta\" data-dictid=\"cc96ad6655169277718944f7ffe9ae\">hydatid</span> cysts on imaging.</p>\n\n<p><strong>Categories:</strong></p>\n\n<ul>\n\t<li><strong>Primary (True) Cysts:</strong>\n\n\t<ul>\n\t\t<li><strong>Characteristics:</strong> Presence of an epithelial lining.</li>\n\t\t<li><strong>Types:</strong>\n\t\t<ul>\n\t\t\t<li><strong>Dermoid Cysts:</strong> Derived from embryonal rests. <strong>(Option D ruled out)</strong></li>\n\t\t\t<li><strong>Mesenchymal <span class=\"customMeta\" data-dictid=\"c3b8b9a17416927771906b1bebb13c\">Inclusion</span> Cysts:</strong> Includes <span class=\"customMeta\" data-dictid=\"38c41e122116927771859b63deb0ed\">cystic</span> hemangiomas, <span class=\"customMeta\" data-dictid=\"38c41e122116927771859b63deb0ed\">cystic</span> lymphangiomas, <span class=\"customMeta\" data-dictid=\"1bbfba21481692777187dd3141ea3b\">epidermoid</span> and <span class=\"customMeta\" data-dictid=\"e0723258c816927771864816adc618\">dermoid</span> cysts. <strong>(Option A, Option B ruled out)</strong></li>\n\t\t</ul>\n\t\t</li>\n\t</ul>\n\t</li>\n\t<li><strong>Secondary Cysts (Pseudocysts):</strong>\n\t<ul>\n\t\t<li><strong>Characteristics:</strong> No epithelial lining; often develop post-trauma.</li>\n\t\t<li><strong>Content:</strong> <span class=\"customMeta\" data-dictid=\"3963a2e0fa169277719874304f5705\">Serous</span> or hemorrhagic fluid.</li>\n\t\t<li><strong>Appearance:</strong> May have calcified walls, resembling <span class=\"customMeta\" data-dictid=\"cc96ad6655169277718944f7ffe9ae\">hydatid</span> cysts on imaging.</li>\n\t</ul>\n\t</li>\n</ul>\n\n<p><strong>Management:</strong></p>\n\n<ul>\n\t<li><strong>True Cysts> 5 cm:</strong>\n\n\t<ul>\n\t\t<li><strong>Treatment:</strong> <span class=\"customMeta\" data-dictid=\"3c702f2ca816927771998e8ca552e1\">Splenectomy</span> or partial splenectomy.</li>\n\t</ul>\n\t</li>\n\t<li><strong>Pseudocysts:</strong>\n\t<ul>\n\t\t<li><strong>Diagnosis:</strong> Typically through imaging.</li>\n\t\t<li><strong>Treatment:</strong> Intervention only if <span class=\"customMeta\" data-dictid=\"509310d4411692777199f2ffdb7769\">symptomatic</span> or persistent after observation.</li>\n\t</ul>\n\t</li>\n</ul>\n\n<p><strong>Overall, the most common splenic <span class=\"customMeta\" data-dictid=\"1405ad7b46169277718580acad7562\">cyst</span> is Pseudocyst.</strong></p>\n\n<p>\u00a0</p>",
    "question_images": [],
    "explanation_video": null,
    "explanation_images": [],
    "explanation_audio_eng": "https://image.prepladder.com/content/lUyXf3SCNBGhrKsViG881746109340.mp3",
    "explanation_audio_hin": "https://image.prepladder.com/content/fTkGfY4s2sngOemjYNK41746109407.mp3"
  },
  {
    "text": "<p>A 45-year-old patient undergoes a splenectomy for an incidental finding. Histological examination of the spleen reveals a vascular tumor. Which of the following is the most likely type of tumor identified?</p>",
    "choices": [
      {
        "id": 1,
        "text": "Histiocytic Lymphoma"
      },
      {
        "id": 2,
        "text": "Hemangioendothelioma"
      },
      {
        "id": 3,
        "text": "Non-Hodgkin\u2019s Lymphoma"
      },
      {
        "id": 4,
        "text": "Plasmacytoma"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Correct Answer: B) Hemangioendothelioma</strong></p>\n\n<p>\u00a0</p>\n\n<p><strong>Explanation:</strong></p>\n\n<p>Hemangioendothelioma is a type of <span class=\"customMeta\" data-dictid=\"526ede3fee169277720184378acc5e\">vascular</span> tumor that is commonly found in the spleen. It arises from endothelial cells lining blood vessels, making it a likely candidate for a <span class=\"customMeta\" data-dictid=\"526ede3fee169277720184378acc5e\">vascular</span> tumor found in the spleen.</p>\n\n<h3><strong>Types of Splenic Tumors</strong></h3>\n\n<h4><strong>Non-Lymphoid Tumors</strong></h4>\n\n<ul>\n\t<li><strong>Vascular Tumors</strong> (<strong>most common</strong>):\n\n\t<ul>\n\t\t<li>Benign Hemangiomas</li>\n\t\t<li>Littoral Cell Angiomas</li>\n\t\t<li>Lymphangiomas</li>\n\t\t<li>Hemangioendotheliomas</li>\n\t</ul>\n\t</li>\n\t<li><strong>Other Tumors</strong> (less common):\n\t<ul>\n\t\t<li>Fibrosarcoma</li>\n\t\t<li>Neurinoma</li>\n\t\t<li>Lipoma</li>\n\t</ul>\n\t</li>\n</ul>\n\n<h4><strong>Lymphoid Tumors</strong></h4>\n\n<ul>\n\t<li>Hodgkin\u2019s Lymphoma</li>\n\t<li>Non-Hodgkin\u2019s Lymphoma<strong> (Option C ruled out)</strong></li>\n\t<li>Histiocytic Lymphoma<strong> (Option A ruled out)</strong></li>\n\t<li>Plasmacytoma <strong>(Option D ruled out)</strong></li>\n</ul>\n\n<h4><strong>Metastatic Tumors</strong></h4>\n\n<ul>\n\t<li>Originating from melanoma, breast cancer, and lung cancer (less common compared to other organs)</li>\n</ul>\n\n<h3><strong>Clinical Considerations</strong></h3>\n\n<ul>\n\t<li><strong>Symptoms</strong>: Often asymptomatic, found incidentally</li>\n\t<li><strong>Diagnosis</strong>: <span class=\"customMeta\" data-dictid=\"1e9c8202241692777189dbac6cc062\">Histological</span> examination post-surgery is the most reliable</li>\n\t<li><strong>Management</strong>: Essential due to potential <span class=\"customMeta\" data-dictid=\"0c7efd2b8716927771914c8cb19e54\">malignancy</span> and complications</li>\n</ul>\n\n<p>\u00a0</p>",
    "question_images": [],
    "explanation_video": null,
    "explanation_images": [],
    "explanation_audio_eng": "https://image.prepladder.com/content/2dUr66BM4QRDtFPbLewM1746109486.mp3",
    "explanation_audio_hin": "https://image.prepladder.com/content/0JwSHltdsTG5P8Hd3PcN1746109541.mp3"
  },
  {
    "text": "<p>A 45-year-old patient presents with a one-week history of persistent left upper abdominal pain. The patient exhibits fever, left upper quadrant tenderness, and leukocytosis. Which of the following is the investigation of choice for confirming the diagnosis?</p>\n\n<p>\u00a0</p>",
    "choices": [
      {
        "id": 1,
        "text": "Chest X-ray"
      },
      {
        "id": 2,
        "text": "Abdominal Ultrasound"
      },
      {
        "id": 3,
        "text": "Computed Tomography (CT)"
      },
      {
        "id": 4,
        "text": "Radioisotope Scanning"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Correct Answer: C) <span class=\"customMeta\" data-dictid=\"44b07c254816927771855a12777513\">Computed Tomography</span> (CT)</strong></p>\n\n<p>\u00a0</p>\n\n<p><strong>Explanation:</strong></p>\n\n<p>\u00a0</p>\n\n<p>Based on the clinical presentation of a 45-year-old patient with a one-week history of persistent left upper <span class=\"customMeta\" data-dictid=\"1665a40f1016927771801899eaed5d\">abdominal</span> pain, fever, left upper <span class=\"customMeta\" data-dictid=\"3a757d7c1216927771968223be411d\">quadrant</span> tenderness, and leukocytosis, the most likely diagnosis is a <strong>splenic abscess</strong>.</p>\n\n<p>\u00a0</p>\n\n<p>Computed <span class=\"customMeta\" data-dictid=\"8d4f2a375b1692777200f41db641bc\">Tomography</span> (CT) is the investigation of choice with nearly 100% sensitivity for diagnosing splenic abscesses. It reveals<strong> low-density</strong> lesions that do not enhance with contrast and provides detailed information on size, location, and access routes.</p>\n\n<p>\u00a0</p>\n\n<p><strong>Causes of Splenic Abscess:</strong></p>\n\n<ul>\n\t<li><strong>Infected splenic emboli</strong></li>\n\t<li><strong>Infections:</strong> Typhoid, <span class=\"customMeta\" data-dictid=\"00fe0861e0169277719448fb69bb93\">paratyphoid</span> fever, osteomyelitis, <span class=\"customMeta\" data-dictid=\"b913f965781692777194c867946afe\">otitis</span> media, puerperal sepsis</li>\n\t<li><strong>Complications from pancreatic necrosis</strong> or other <span class=\"customMeta\" data-dictid=\"b02812a466169277719090c2d27868\">intra-abdominal</span> infections</li>\n</ul>\n\n<p><strong>Potential Complications:</strong></p>\n\n<ul>\n\t<li><strong>Rupture:</strong> May lead to\n\n\t<ul>\n\t\t<li>Left <span class=\"customMeta\" data-dictid=\"c056c8184b1692777199878ec26571\">subphrenic</span> abscess</li>\n\t\t<li>Diffuse peritonitis</li>\n\t</ul>\n\t</li>\n</ul>\n\n<p><strong>Laboratory Studies:</strong></p>\n\n<ul>\n\t<li><strong>Complete <span class=\"customMeta\" data-dictid=\"57525e6f6416927771835d0fb0bee5\">Blood Count</span> (CBC):</strong>\n\n\t<ul>\n\t\t<li>Leukocytosis (WBC count >20,000/\u03bcL) with left shift</li>\n\t\t<li>Immunocompromised patients may show different results</li>\n\t</ul>\n\t</li>\n\t<li><strong>Recurrent Positive Blood Cultures</strong></li>\n</ul>\n\n<p><strong>Imaging Studies:</strong></p>\n\n<table cellspacing=\"0\" style=\"border-collapse:collapse; width:614px\">\n\t<tbody>\n\t\t<tr>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p><strong>Type</strong></p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p><strong>Findings</strong></p>\n\t\t\t</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td rowspan=\"6\" style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p><strong>Radiography</strong></p>\n\n\t\t\t<p><strong>(Option A ruled out)</strong></p>\n\t\t\t</td>\n\t\t\t<td rowspan=\"6\" style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p><strong>Chest X-ray:</strong> Non-specific for splenic abscess; may show:</p>\n\n\t\t\t<ul>\n\t\t\t\t<li>Elevated left <span class=\"customMeta\" data-dictid=\"dd7d149ec4169277718822fd0f1841\">hemidiaphragm</span> (>30%)</li>\n\t\t\t\t<li>Pleural <span class=\"customMeta\" data-dictid=\"73909075e71692777187f08d3c9b7e\">effusion</span> (>20%)</li>\n\t\t\t</ul>\n\n\t\t\t<p><strong>Abdominal X-ray</strong>: Non-specific; possible findings include:</p>\n\n\t\t\t<ul>\n\t\t\t\t<li>Abnormal soft-tissue density</li>\n\t\t\t\t<li>Gas collection in the left upper quadrant</li>\n\t\t\t</ul>\n\t\t\t</td>\n\t\t</tr>\n\t\t<tr>\n\t\t</tr>\n\t\t<tr>\n\t\t</tr>\n\t\t<tr>\n\t\t</tr>\n\t\t<tr>\n\t\t</tr>\n\t\t<tr>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p><strong>Nuclear Studies</strong></p>\n\n\t\t\t<p><strong>(Option D ruled out)</strong></p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<ul>\n\t\t\t\t<li>Radioisotope scanning: Limited value due to long test duration</li>\n\t\t\t</ul>\n\t\t\t</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td rowspan=\"2\" style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p><strong>Ultrasonography</strong></p>\n\n\t\t\t<p><strong>(Option B ruled out)</strong></p>\n\t\t\t</td>\n\t\t\t<td rowspan=\"2\" style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<ul>\n\t\t\t\t<li>Cost-effective and non-invasive, but:</li>\n\t\t\t\t<li>Nonspecific and operator-dependent</li>\n\t\t\t</ul>\n\t\t\t</td>\n\t\t</tr>\n\t\t<tr>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td rowspan=\"4\" style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p><strong>Computed <span class=\"customMeta\" data-dictid=\"8d4f2a375b1692777200f41db641bc\">Tomography</span> (CT)</strong></p>\n\n\t\t\t<p><strong>(Option C)</strong></p>\n\t\t\t</td>\n\t\t\t<td rowspan=\"4\" style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<ul>\n\t\t\t\t<li>Criterion standard for diagnosing splenic abscess</li>\n\t\t\t</ul>\n\t\t\t</td>\n\t\t</tr>\n\t\t<tr>\n\t\t</tr>\n\t\t<tr>\n\t\t</tr>\n\t\t<tr>\n\t\t</tr>\n\t</tbody>\n</table>\n\n<p><strong>Procedures:</strong></p>\n\n<ul>\n\t<li><strong>Diagnostic <span class=\"customMeta\" data-dictid=\"b2fb1a3a5416927771953ea4fa15e1\">Percutaneous</span> Aspiration:</strong>\n\n\t<ul>\n\t\t<li>Guided by US or CT to confirm diagnosis and obtain specimens for bacteriology</li>\n\t</ul>\n\t</li>\n\t<li><strong>Differentiation from Primary Splenic Non-Hodgkin <span class=\"customMeta\" data-dictid=\"5a31d184f21692777191a2e457d646\">Lymphoma</span> (NHL):</strong>\n\t<ul>\n\t\t<li>May require splenic <span class=\"customMeta\" data-dictid=\"754ab07a2e1692777183ed178c883d\">biopsy</span> and immunohistochemical <span class=\"customMeta\" data-dictid=\"3b007026bd16927771997ae809b603\">staining</span> for accurate diagnosis</li>\n\t</ul>\n\t</li>\n</ul>\n\n<p><strong>Treatment Approaches:</strong></p>\n\n<ul>\n\t<li><strong>Address underlying cause</strong></li>\n\t<li><strong>Percutaneous drainage</strong> (guided by imaging)</li>\n</ul>\n\n<p><strong>Splenectomy </strong>is reserved for cases where <span class=\"customMeta\" data-dictid=\"b2fb1a3a5416927771953ea4fa15e1\">percutaneous</span> <span class=\"customMeta\" data-dictid=\"dd824a31e71692777186c7f8168998\">drainage</span> is not feasible</p>\n\n<p>\u00a0</p>",
    "question_images": [],
    "explanation_video": null,
    "explanation_images": [],
    "explanation_audio_eng": "https://image.prepladder.com/content/4g9WUclMR6xyWFmV3d521746109612.mp3",
    "explanation_audio_hin": "https://image.prepladder.com/content/I4pSYHtz77ZNHkMNxvmQ1746109663.mp3"
  }
];
        let quizName = '25 Spleen';
        let hierarchy = ["PrepLadder", "qBank", "Surgery"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>