<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>06 Disorders Of Skin Pigmentation - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Dermatology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">30</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following is not responsible for the color of the human skin?",
    "choices": [
      {
        "id": 1,
        "text": "Amount of melanin inside melanocytes"
      },
      {
        "id": 2,
        "text": "Number of melanocytes"
      },
      {
        "id": 3,
        "text": "Number and size of melanosomes"
      },
      {
        "id": 4,
        "text": "Degree of transfer of melanin into keratinocytes"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>color</strong> of the human skin <strong>does not depend</strong> on the&nbsp;<strong>number of melanocytes.</strong></p>\n<p>The <strong>color</strong> of the skin <strong>depends</strong> on the following:</p>\n<ul>\n<li><strong>Amount of melanin</strong> inside melanocytes</li>\n<li>Number and size of <strong>melanosomes</strong></li>\n<li><strong>Degree of transfer</strong> of <strong>melanin</strong> into keratinocytes</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the ratio of the epidermal melanin unit?",
    "choices": [
      {
        "id": 1,
        "text": "28 keratinocytes : 1 melanocyte"
      },
      {
        "id": 2,
        "text": "36 keratinocytes : 2 melanocytes"
      },
      {
        "id": 3,
        "text": "28 keratinocytes : 2 melanocytes"
      },
      {
        "id": 4,
        "text": "36 keratinocytes : 1 melanocyte"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The ratio of the <strong>epidermal melanin unit</strong> is <strong>36 keratinocytes : 1 melanocyte.</strong></p>\n<p>The color of the skin is due to the pigment<strong> melanin</strong> synthesized by <strong>melanocytes</strong>. Melanocytes are <strong>dendritic cells</strong> derived from neural crest cells and are present in the epidermis' stratum basale. Each melanocyte synthesizes melanin and packs it in cell organelles to form <strong>melanosomes.</strong> These melanosomes are transferred through <strong>dendritic processes to 36 keratinocytes</strong> forming the &lsquo;epidermal melanin&rsquo; unit.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is not true regarding piebaldism?",
    "choices": [
      {
        "id": 1,
        "text": "Autosomal dominant inheritance"
      },
      {
        "id": 2,
        "text": "Well-defined hypopigmented macules are seen"
      },
      {
        "id": 3,
        "text": "White forelock is rare"
      },
      {
        "id": 4,
        "text": "Small spots of hyperpigmentation can also be seen"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>White forelock</strong> is quite <strong>common&nbsp;</strong>in <strong>piebaldism.</strong></p>\n<p>Piebaldism is an&nbsp;<strong>autosomal dominant</strong> benign&nbsp;condition. Mutations are in the c\u2010KIT gene.</p>\n<p>Well-defined irregular&nbsp;<strong>hypopigmented macules</strong>&nbsp;with an absence of melanocytes are seen. <strong>Leucotrichia</strong> is associated with the depigmented macules. Small spots of hyperpigmentation are also seen within hypopigmented patches or on normal skin.&nbsp;It is often associated with a <strong>V-shaped leucoderma</strong> on the mid-forehead.&nbsp;</p>\n<p><strong>Epidermal cell</strong> or <strong>skin grafting</strong> is the treatment.</p>\n<p>Piebaldism can be distinguished from vitiligo because of the<strong> neonatal presence of white patches.&nbsp;</strong></p>\n<p>The images below show patients with piebaldism.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/64f6f8375a5844ebbed9f5ce8ccecb18x512x510.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d9349ee959354067b31b655993544b5fx512x310.PNG"
    ]
  },
  {
    "text": "A child with sensorineural hearing loss is brought to the OPD with the following skin findings. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Waardenburg syndrome"
      },
      {
        "id": 2,
        "text": "Hermansky-Pudlak syndrome"
      },
      {
        "id": 3,
        "text": "Chediak-Higashi syndrome"
      },
      {
        "id": 4,
        "text": "Oculocutaneous albinism"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>&nbsp;</p>\n<p>Option B:&nbsp;Hermansky&ndash;Pudlak syndrome is a rare type of oculocutaneous albinism associated with a hemorrhagic diathesis. The disease results from abnormal biogenesis of lysosome-related organelles with impaired melanosome maturation and absent dense bodies in thrombocytes.&nbsp;</p>\n<p>Option C:&nbsp;Ch&eacute;diak&ndash;Higashi syndrome is a rare autosomal recessive disorder characterized by hypopigmentation of the skin and eye, immunodeficiency, and possibly neurological symptoms.</p>\n<p>Option D:&nbsp;Oculocutaneous albinism (OCA) is a rare autosomal recessive genetic disorder characterized by generalized depigmentation of the skin, hair, and eye&nbsp;caused by a deficiency in melanin biosynthesis.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e0ae66b55bfc4c5b9d43d71466a77fbd.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7c6250c2a467440592efb749f53038fcx512x510.PNG"
    ]
  },
  {
    "text": "A patient presented with hypopigmentation of the skin and iris. Peripheral smear done is shown below. Which of the following is false regarding this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Autosomal recessive"
      },
      {
        "id": 2,
        "text": "Neurological abnormalities"
      },
      {
        "id": 3,
        "text": "Pyogenic infections"
      },
      {
        "id": 4,
        "text": "Gain-of-function mutation of LYST"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The peripheral smear shows <strong>giant inclusions</strong> <strong>in</strong> <strong>polymorphonuclear neutrophils,</strong> which along with<strong> oculocutaneous albinism</strong> is suggestive of&nbsp;<strong>Chediak-Higashi syndrome.&nbsp;</strong></p>\n<p>It is an <strong>autosomal recessive</strong> disorder due to <strong>loss-of-function mutation</strong> of the&nbsp;<strong>LYST</strong>&nbsp;gene encoding a protein known as <strong>lysosomal trafficking regulator.&nbsp;</strong></p>\n<p>Clinical features occur due to <strong>defective transport</strong> <strong>of cell products</strong>. These include:</p>\n<ul>\n<li>Significant <strong>pyogenic</strong> infections</li>\n<li><strong>Albinism</strong>&nbsp;(due to abnormalities of melanocytes)</li>\n<li><strong>Neurological</strong> abnormalities\n<ul>\n<li>Progressive intellectual decline</li>\n<li>Cranial nerve palsies</li>\n<li>Decreased deep tendon reflexes</li>\n<li>Tremor</li>\n<li>Abnormal gait (nerve cell dysfunction),</li>\n</ul>\n</li>\n<li><strong>Bleeding</strong><span data-preserver-spaces=\"true\">&nbsp;(due to platelet dysfunction).</span></li>\n</ul>\n<p><strong>Peroxidase\u2010positive</strong> giant inclusions are seen in leukocytes.&nbsp;The<strong> only curative treatment</strong> available for Ch&eacute;diak&ndash;Higashi syndrome is <strong>bone marrow transplantation</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/7683d003428a4203a9f02f0f668e8113.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5889ec3e5327458a8a639ddf15559d7cx510x656.GIF"
    ]
  },
  {
    "text": "The pediatrician refers the child shown below for dermatology and ophthalmology opinions. Oculocutaneous albinism is suspected. Which of the following is false regarding this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Tryptophan deficiency"
      },
      {
        "id": 2,
        "text": "Photophobia present"
      },
      {
        "id": 3,
        "text": "Autosomal recessive"
      },
      {
        "id": 4,
        "text": "Melanocytes are normal"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Oculocutaneous albinism</strong> is not due to tryptophan deficiency but is due to<strong> tyrosinase deficiency.</strong></p>\n<p>It is a rare autosomal recessive disorder characterized by <strong>generalized depigmentation</strong> of the skin, hair, and eye. Ophthalmological anomalies are also noted. It is caused by a <strong>deficiency</strong> in<strong> melanin biosynthesis</strong>, but melanocytes are normally present and distributed.</p>\n<p>It is caused by mutations in TYR, encoding the tyrosinase gene.</p>\n<p>Significant<strong>&nbsp;photophobia </strong>may be present. <strong>Iris translucency</strong> is demonstrable by slit-lamp examination.</p>\n<p>Sun protection is mandatory to avoid skin sunburns and skin cancers with a special emphasis on patients living in high UV risk environments. Early referral to an ophthalmologist is mandatory. Dark glasses are important to protect the eyes and prevent photophobia.</p>",
    "explanation_video": "",
    "question_images": [
      "https://upload.wikimedia.org/wikipedia/commons/d/de/Albino_baby_by_Felipe_Fernandes_03.jpg"
    ],
    "explanation_images": []
  },
  {
    "text": "What is the pathological basis for the given skin finding?",
    "choices": [
      {
        "id": 1,
        "text": "Lack of melanin"
      },
      {
        "id": 2,
        "text": "Loss of melanocytes"
      },
      {
        "id": 3,
        "text": "Loss of melanosomes"
      },
      {
        "id": 4,
        "text": "Melanocyte senescence"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The image is suggestive of <strong>vitiligo.</strong> The pathological basis of vitiligo is the <strong>loss of melanocytes.</strong></p>\n<p>Vitiligo is a common form of <strong>localized depigmentation</strong>.&nbsp;It is characterized by<strong> milky\u2010white sharply demarcated macules.&nbsp;</strong>It is an <strong>acquired</strong> condition resulting from the <strong>autoimmune destruction</strong> of dopa-positive <strong>melanocytes</strong> in the basal layer of the epidermis.</p>\n<p>Vitiligo can begin at any age but in the majority of cases becomes apparent in the third decade.&nbsp;The prevalence is most probably the same in both sexes or a slight female preponderance.</p>\n<p><strong>Electron microscopy</strong> studies confirm the loss of melanocytes.&nbsp;Wood's lamp examination shows<strong>&nbsp;milky-white fluorescence</strong>.</p>\n<p><strong>Koebner phenomenon&nbsp;</strong>defined as the development of lesions at sites of trauma to uninvolved skin of patients with cutaneous diseases is a well\u2010known phenomenon in vitiligo.</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://upload.wikimedia.org/wikipedia/commons/b/b6/Vitiligo.jpg"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/62cadc91564f4f71aab6c6a9da466034x1280x1054.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b2de6dbf7aae4ed5b2638d890761dbcax1280x1432.JPEG"
    ]
  },
  {
    "text": "A lady comes to the clinic with the given findings. Which disease has the strongest association with this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Thyroid disorders"
      },
      {
        "id": 2,
        "text": "Pernicious anemia"
      },
      {
        "id": 3,
        "text": "Diabetes type 1"
      },
      {
        "id": 4,
        "text": "Addison\u2019s disease"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The patient has <strong>vitiligo.</strong> Amongst autoimmune diseases, the <strong>strongest association</strong> of vitiligo is with <strong>thyroid disorders&nbsp;</strong>(hyperthyroidism and hypothyroidism).</p>\n<p>Other disorders associated with vitiligo are:</p>\n<ul>\n<li>Pernicious anemia</li>\n<li>Addison's disease</li>\n<li>Diabetes type I</li>\n<li>Myasthenia gravis</li>\n<li>Alopecia areata</li>\n<li>Uveitis</li>\n<li>Chronic mucocutaneous candidiasis</li>\n<li>Autoimmune polyendocrine syndromes (types I and II)</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://upload.wikimedia.org/wikipedia/commons/5/5a/Acrofacial_Vitiligo.png"
    ],
    "explanation_images": []
  },
  {
    "text": "A 22-year-old college student presented to the OPD with hypopigmentation on his face. The lesions have been stable for the past year. Wood's lamp examination showed milky white fluorescence. Which of the following would you not offer as a treatment option for his condition?",
    "choices": [
      {
        "id": 1,
        "text": "Topical steroids"
      },
      {
        "id": 2,
        "text": "Tacrolimus"
      },
      {
        "id": 3,
        "text": "Cyclosporine"
      },
      {
        "id": 4,
        "text": "Surgical grafting"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The clinical scenario suggests a diagnosis of <strong>vitiligo.</strong> Cyclosporine is not a treatment option for vitiligo. There is not enough evidence of its benefits and more potential side effects.</p>\n<p>Treatment options for vitiligo:</p>\n<ul>\n<li><strong>Topical agents:</strong>\n<ul>\n<li>Topical corticosteroids</li>\n<li>Calcineurin inhibitors - tacrolimus</li>\n<li>Vitamin D analogs - calcitriol</li>\n</ul>\n</li>\n<li><strong>Systemic agents:</strong>\n<ul>\n<li>Corticosteroids</li>\n<li>Azathioprine</li>\n</ul>\n</li>\n<li><strong>Phototherapy:</strong>\n<ul>\n<li>PUVA</li>\n<li>PUVASol - sunlight</li>\n<li>NBUVB - narrow band UV B radiation at 311nm</li>\n<li>Targeted phototherapy using excimer laser 308nm</li>\n</ul>\n</li>\n<li><strong>Surgical treatment</strong>:\n<ul>\n<li>Ultrathin partial thickness skin grafting</li>\n<li>Non-cultured autologous melanocytic transfer</li>\n<li>Cultured autologous melanocytic transfer</li>\n</ul>\n</li>\n</ul>\n<p>Note: Surgical treatment is usually reserved for patients with stable (a period of disease inactivity ranging from six months to two years) vitiligo who failed to respond to non-surgical treatment.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not a mechanism of action of the therapeutic modality shown below?",
    "choices": [
      {
        "id": 1,
        "text": "Cross\u2010linking of DNA by psoralen"
      },
      {
        "id": 2,
        "text": "Langerhans cell depletion"
      },
      {
        "id": 3,
        "text": "Activation of T lymphocytes"
      },
      {
        "id": 4,
        "text": "Stimulation of melanogenesis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The image shows&nbsp;photochemotherapy<strong>&nbsp;</strong>(<strong>PUVA&nbsp;therapy</strong>), used for the treatment of <strong>vitiligo</strong>. It causes<strong> suppression</strong> of <strong>T lymphocyte</strong> action.</p>\n<p>The <strong>UVA spectrum</strong> is <strong>320-400 nm.&nbsp;</strong>When it is used in combination with an oral or topical&nbsp;<strong>psoralen photosensitizer,&nbsp;</strong>it is known as PUVA therapy.&nbsp;The most frequently-used oral psoralens are 8\u2010methoxy psoralen (<strong>8\u2010MOP</strong>) and 5\u2010methoxy psoralen (<strong>5\u2010MOP</strong>).</p>\n<p>The <strong>mechanisms </strong>of action of PUVA:</p>\n<ul>\n<li>Inhibition of DNA replication - DNA cross\u2010linking by psoralen photoadducts</li>\n<li>Langerhans cell depletion</li>\n<li>Immunosuppressive effects on T\u2010lymphocyte function</li>\n<li>Stimulation of melanogenesis</li>\n<li>Migration and the restoration of Th17/regulatory T-cell imbalance in psoriasis</li>\n</ul>\n<p><strong>Indications </strong>of PUVA therapy:</p>\n<ul>\n<li>Psoriasis</li>\n<li>Atopic eczema</li>\n<li>Vitiligo</li>\n<li>Polymorphic light eruption</li>\n<li>Cutaneous T cell lymphoma</li>\n</ul>\n<p>The <strong>UVB</strong> part of the spectrum is&nbsp;<strong>280-320 nm.&nbsp;</strong>Lamps utilizing&nbsp;the&nbsp;<strong>311-313 nm</strong>&nbsp;frequencies are called narrow\u2010band UV&nbsp;<strong>(NBUVB)</strong>. UVB phototherapy has anti\u2010inflammatory, immunosuppressive, and cytotoxic properties.&nbsp;</p>\n<p><strong>Vitiligo</strong> may respond both to NB\u2010UVB and PUVA. <strong>NBUVB</strong> is<strong> more effective</strong> than PUVA but the response is variable and treatment usually has to be prolonged, often over many months to a year or more.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/aa10423b285d4a09ab5bae377e0a0ffe.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following cases of vitiligo are likely to have a poor prognosis?",
    "choices": [
      {
        "id": 1,
        "text": "1, 3, and 5"
      },
      {
        "id": 2,
        "text": "1, 2, and 4"
      },
      {
        "id": 3,
        "text": "3, 4, and 5"
      },
      {
        "id": 4,
        "text": "1, 2, and 5"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Poor prognostic factors for vitiligo:</strong></p>\n<ul>\n<li>Positive family history (patient 2)</li>\n<li>Mucosal vitiligo (patient 1)</li>\n<li>Lesions over bony prominences</li>\n<li>Isomorphic Koebner's phenomenon (patient 5)</li>\n<li>Non-segmental vitiligo</li>\n</ul>\n<p>Leucotrichia, longer duration, and higher age at onset do not correlate significantly with progression.</p>\n<p><strong>Non-segmental</strong> vitiligo is characterized by a <strong>bilateral</strong> and <strong>symmetrical</strong> distribution of depigmented macules.</p>\n<p><strong>Segmental</strong> vitiligo is characterized by macules in a <strong>linear</strong> or flag-like pattern of <strong>mosaicism</strong> with a <strong>dermatomal</strong> distribution<span style=\"font-size: 11.6667px;\">.</span></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A child is brought to the OPD with the following skin finding. Which of the following statements is incorrect regarding this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Eye and skeletal defects are seen"
      },
      {
        "id": 2,
        "text": "Epilepsy can occur"
      },
      {
        "id": 3,
        "text": "Mental retardation is present"
      },
      {
        "id": 4,
        "text": "Lesions corresponds to Langer lines"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The image shows\u00a0<strong>cutaneous macular hypopigmented</strong> whorls,\u00a0streaks,\u00a0and\u00a0patches, corresponding to the<strong>\u00a0lines of Blaschko,\u00a0</strong>suggestive of <strong>hypomelanosis of Ito</strong>.</p>\n<p>It is a\u00a0rare <strong>neuroectodermal</strong> disorder of pigmentation. It is associated with\u00a0<strong>epilepsy</strong> and <strong>mental retardation</strong>.\u00a0Extracutaneous findings include neurological, <strong>ophthalmological,</strong> and <strong>skeletal defects.</strong></p>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/f3842e74d3214980bb9f6004dde7fa2d.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0e26cf087bcc43e793d1db4c2a7d4e57x1280x1734.JPEG"
    ]
  },
  {
    "text": "A girl was brought to the clinic by her parents for treatment of alopecia. They gave a history of erythematous vesicular rashes that evolved into verrucous growths a few months after birth. The lesions gradually resolved and left linear pigmentation as shown below. On examination, dental dystrophy was also noted. What is the inheritance pattern of this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Autosomal dominant"
      },
      {
        "id": 2,
        "text": "Autosomal recessive"
      },
      {
        "id": 3,
        "text": "X-linked recessive"
      },
      {
        "id": 4,
        "text": "X-linked dominant"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical scenario is suggestive of <strong>incontinentia pigmenti.&nbsp;</strong>It&nbsp;is a rare <strong>X-linked dominant</strong> disorder with <strong>multisystemic ectodermal dysplasia</strong> that is usually lethal in males and presents in females with skin lesions, teeth abnormalities, alopecia, nail dystrophy, and ocular and neurological findings.</p>\n<p>The <strong>skin lesions</strong> evolve through the following characteristic stages:</p>\n<ol>\n<li>Vesicular</li>\n<li>Verrucous stage</li>\n<li>Hyperpigmented streaks and whorls</li>\n<li>Linear hypopigmentation&nbsp;</li>\n</ol>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b2e7aca47aff45939d0181318904e4b0.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c1c2c421ece140608ba726b61672a833x1280x2090.JPEG"
    ]
  },
  {
    "text": "In a 6-year-old boy who presented with black stools, the following finding was noted. Endoscopy showed multiple polyps in the GI tract. Which of the following is false about this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Autosomal dominant condition"
      },
      {
        "id": 2,
        "text": "Patients need to undergo lifelong screening"
      },
      {
        "id": 3,
        "text": "Malignant transformation of polyps is common"
      },
      {
        "id": 4,
        "text": "Due to mutation of STK11 gene"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The presence of multiple polyps in the GI tract along with lentigines on the lips is suggestive of&nbsp;<strong>Peutz-Jeghers-Touraine syndrome</strong>.&nbsp;<strong>Malignant transformation&nbsp;</strong>of hamartomatous polyps is <strong>rare.</strong></p>\n<p>It&nbsp;is an <strong>autosomal dominant </strong>disease.<strong>&nbsp;</strong>It is due to the&nbsp;<strong>mutation </strong>of the serine/threonine kinase gene (<strong>STK11</strong>).</p>\n<p>Typical cutaneous features include <strong>lentigines of the lips</strong>&nbsp;(early feature). Associated <strong>melanocytic macules</strong> of buccal mucosa and digits are common. <strong>Hamartomatous polyps</strong> are present mainly in the <strong>jejunum</strong> but can occur throughout the GI tract.</p>\n<p>Patients require&nbsp;<strong>lifelong screening</strong>&nbsp;as they are at high risk for carcinomas of the breast, ovary, colon, and stomach.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c82643652d7e430aa1231ff18397afa6.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "All of the following drugs can cause hyperpigmentation in patients except:",
    "choices": [
      {
        "id": 1,
        "text": "Amiodarone"
      },
      {
        "id": 2,
        "text": "Chloroquine"
      },
      {
        "id": 3,
        "text": "Minocycline"
      },
      {
        "id": 4,
        "text": "Beta-blockers"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Beta-blockers&nbsp;do not cause hyperpigmentation.</p>\n<p><strong>Drugs causing hypermelanosis</strong>:</p>\n<ul>\n<li>Amiodarone</li>\n<li>Tetracyclines</li>\n<li>Chloroquine</li>\n<li>Clofazimine</li>\n<li>Phenytoin</li>\n<li>Cytotoxic drugs like busulfan, cyclophosphamide, bleomycin, etc.</li>\n<li>Psychotropic drugs (e.g., trifluoperazine, imipramine)</li>\n</ul>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient with fever and joint pain developed pigmentation on the nose after a few days of taking NSAIDs as shown below. What is the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Melasma"
      },
      {
        "id": 2,
        "text": "Fixed drug eruption"
      },
      {
        "id": 3,
        "text": "Lichen planus"
      },
      {
        "id": 4,
        "text": "Chikungunya"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical history of <strong>fever</strong> and <strong>joint pain</strong> and the image showing hyperpigmented macules on nose (<strong>chik sign</strong>) is suggestive of Chikungunya.</p>\n<p><strong>Post-chikungunya pigmentation</strong> (PCP) most commonly affects the nose and cheeks. It often appears as the <strong>fever subsides</strong> and may persist for about 3-6 months.</p>\n<p><strong>PCP mimics melasma</strong> and may be misdiagnosed if proper history is not taken.</p>\n<p>Another close differential is<strong> fixed drug eruptions</strong> (FDE). FDE is a type of delayed hypersensitivity reaction. It is characterized by well-defined brown, <strong>hyperpigmented plaques</strong> that may follow <strong>vesiculobullous</strong> lesions. They occur on lips, hands, legs, face, genitalia, and oral mucosa, and can cause a burning sensation.They usually present 30 min to 8 h after drug exposure and <strong>recur at the same location</strong> on re-exposure. NSAIDs, Paracetamol and Co\u2010trimoxazole are the most common drugs causing FDE.</p>\n<p>The image below shows FDE on upper lip area:&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ccc63f8b76cf41dcb9673964c1cb9af3.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3098d25b37fe449b86af318348a2ba2dx1248x714.PNG"
    ]
  },
  {
    "text": "A 40-year-old man presents with the given rash after he had taken NSAIDs for his knee pain. He reported that he developed the same rash in the same location 6 months ago when he took the same drugs for back pain. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Drug hypersensitivity"
      },
      {
        "id": 2,
        "text": "Postinflammatory hyperpigmentation"
      },
      {
        "id": 3,
        "text": "Fixed drug eruption"
      },
      {
        "id": 4,
        "text": "Drug-induced hypermelanosis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Option A:&nbsp;<strong>Drug hypersensitivity</strong> is an immune-mediated reaction to a drug of which symptoms ranging from mild to severe include <strong>rash, anaphylaxis, and serum sickness</strong>.</p>\n<p>Option B: <strong>Postinflammatory hyperpigmentation</strong> (PIH) is an acquired hypermelanosis occurring after cutaneous inflammation or injury e.g.,&nbsp;acne vulgaris, atopic dermatitis, and impetigo.</p>\n<p>Option D:&nbsp;<strong>Drug-induced hypermelanosis&nbsp;</strong>is localized or generalized hyperpigmentation that can be caused by a wide range of medications and chemicals. eg. busulphan.&nbsp; It doesn't necessarily occur at the same site with the reintroduction of drugs.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/66c77bf09cf040749899b370f3ba570e.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A lady developed hypopigmentation on her forehead as shown below. Which of the following chemicals is responsible for this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Mono-benzyl ether of hydroquinone"
      },
      {
        "id": 2,
        "text": "Crocein scarlet MOO and solvent yellow 3"
      },
      {
        "id": 3,
        "text": "p-phenylenediamine"
      },
      {
        "id": 4,
        "text": "Para-tertiary butylphenol"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>&nbsp;</p>\n<p>The image below shows <strong>hair dye depigmentation.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/98b76c87ffc54dce9915e7fc30ffac40.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/503c6e65cf7c46f3b039085b4abee742x512x401.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/83e08200e11349fe8cdd9db1cf1a0e70x512x370.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c9c3641e87d5421fb0b797660714f2d2x512x371.PNG"
    ]
  },
  {
    "text": "During your dermatology posting, you see a case of naevus of Ota in the clinic. Which of the following is false about this condition?",
    "choices": [
      {
        "id": 1,
        "text": "It mostly appears at birth or early childhood"
      },
      {
        "id": 2,
        "text": "It is distributed along trigeminal nerve"
      },
      {
        "id": 3,
        "text": "Bluish patchy dermal melanocytosis"
      },
      {
        "id": 4,
        "text": "It is commonly seen in males"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Naevus of Ota</strong> is more commonly seen in <strong>females.</strong></p>\n<p>It&nbsp;is an extensive, bluish, patchy, dermal melanocytosis. A<strong> large number</strong> of<strong> elongated dendritic melanocytes</strong> can be seen scattered among collagen bundles mainly of the superficial dermis.</p>\n<p>It affects the <strong>sclera</strong> and the <strong>skin </strong>adjacent to the eye. It is distributed along the first and the second branches of the <strong>trigeminal nerve</strong>.</p>\n<p>Most lesions are <strong>present at birth</strong> or <strong>develop </strong>during the<strong> first year of life</strong>, increasing in size and number in subsequent years. Lesions are more common in Asians.&nbsp;</p>\n<p><strong>Pigment targeting Q\u2010switched laser</strong> systems is the treatment of choice.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1b3b386387b54e1abaa6803c06d211dax1280x3117.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b80b27e6039741308cc2f14ddef52fe3x1280x1627.JPEG"
    ]
  },
  {
    "text": "A Chinese woman brought her son to the clinic with the given finding. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Nevus of Ota"
      },
      {
        "id": 2,
        "text": "Nevus of Ito"
      },
      {
        "id": 3,
        "text": "Nevus spilus"
      },
      {
        "id": 4,
        "text": "Becker nevus"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Becker nevus is a large, pigmented hairy patch on the shoulder, chest, or back of young males.</p>\n<p>Nevus spilus is a congenital nevus presenting as a lentiginous macule that develops into multiple macules in a speckled distribution (image below).</p>",
    "explanation_video": "",
    "question_images": [
      "https://upload.wikimedia.org/wikipedia/commons/b/bb/Nevus_of_Ito.jpg"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f338071c098342e8a3ba5333ead9144fx1280x1170.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/803395409abb4d7480c1a67730b97c32x427x599.JPEG"
    ]
  },
  {
    "text": "A mother brought her daughter to the dermatologist with multiple spots on her face. The spots were increased after they came back from a vacation in Hawaii. Which of the following statements is false regarding this condition?",
    "choices": [
      {
        "id": 1,
        "text": "It has an autosomal dominant inheritance"
      },
      {
        "id": 2,
        "text": "Increased number of melanocytes are seen"
      },
      {
        "id": 3,
        "text": "It is associated with xeroderma pigmentosa"
      },
      {
        "id": 4,
        "text": "It is caused by increased melanin"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The patient has <strong>dark brown macules</strong> on her face, that <strong>increase</strong> on<strong>&nbsp;sunlight exposure</strong>.<strong>&nbsp;</strong>This is suggestive of&nbsp;<strong>freckles</strong> or<strong> ephelis,</strong>&nbsp;which<strong>&nbsp;</strong>are produced due to <strong>increased melanin</strong> production by melanocytes on exposure to UV rays<strong>&nbsp;</strong>(with a normal number of melanocytes).</p>\n<p>It is transmitted in an <strong>autosomal dominant</strong> pattern.&nbsp;They are seen in a number of inherited and acquired disorders including <strong>xeroderma pigmentosum</strong>, neurofibromatosis, and progeria. Freckles are common in <strong>type 1</strong> and<strong> type 2 skin types</strong> of Fitzpatrick Classification.</p>\n<p>First-line treatment is the use of a <strong>high SPF sunscreen</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/5388f52d8da749b1b56e73802de16cca.jpg"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ab9122ec7c2145fabe85f0ba597d4838x1199x1065.JPEG"
    ]
  },
  {
    "text": "A child is brought to the clinic with the following pigmented lesion. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Junctional naevus"
      },
      {
        "id": 2,
        "text": "Compound naevus"
      },
      {
        "id": 3,
        "text": "Dermal naevus"
      },
      {
        "id": 4,
        "text": "Nevus spilus"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given image suggests the most likely diagnosis to be&nbsp;<strong>compound naevus</strong>. It is characterized by a <strong>hyperpigmented papule</strong> surrounded by a symmetrical<strong>, lighter</strong> brown, macular area.</p>\n<p>A compound naevus is a slightly raised, oval, or round papule with a <strong>symmetrical shape</strong>. This naevus is also pigmented, with shades of brown according to the patient&rsquo;s skin color.</p>\n<p>Based on the position of melanocyte aggregates, the acquired melanocytic naevi can be classified into:</p>\n<ol>\n<li><strong>Junctional&nbsp;</strong>- melanocytes in the dermo-epidermal junction</li>\n<li><strong>Compound&nbsp;</strong>- melanocytes in the dermo-epidermal junction and dermis</li>\n<li><strong>Dermal&nbsp;</strong>- melanocytes in the dermis</li>\n</ol>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/243038ff00d04521b66434e511a3df69.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7ea82346dba448c2ac285a3e42cffef6x1279x1096.JPEG"
    ]
  },
  {
    "text": "Identify the pigmentation abnormality in the image shown below.",
    "choices": [
      {
        "id": 1,
        "text": "Mongolian spot"
      },
      {
        "id": 2,
        "text": "Naevus of Ito"
      },
      {
        "id": 3,
        "text": "Congenital melanocytic naevus"
      },
      {
        "id": 4,
        "text": "Becker's naevus"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Option C:&nbsp;<strong>Congenital melanocytic nevi</strong>&nbsp;are common moles that become raised and have a cerebriform appearance and can be <strong>hairy</strong>. They can occur anywhere. The onset is at <strong>birth</strong> or <strong>soon after birth</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3c8c9490c0094c26a5c3c8e4cafbd630.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/01c65dbb0d284a71940d45d91e0c6f3fx720x550.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/cde601104b324f08a91a4c898025d5c8x720x449.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/cafcfe01ebaa4e3a9507daab58cabb00x720x784.JPEG"
    ]
  },
  {
    "text": "A patient who presented with the given skin finding was diagnosed with nevus anemicus. Which of the following statements is incorrect regarding this condition?",
    "choices": [
      {
        "id": 1,
        "text": "A congenital vascular anomaly"
      },
      {
        "id": 2,
        "text": "Results from defective transfer of melanosomes"
      },
      {
        "id": 3,
        "text": "Rubbing the lesion induces no change"
      },
      {
        "id": 4,
        "text": "Also known as pharmacologic nevus"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Nevus anemicus occurs due to&nbsp;<strong>increased sensitivity</strong> of local&nbsp;<strong>cutaneous blood vessels to catecholamines</strong> such as epinephrine (adrenaline) and norepinephrine (noradrenaline).&nbsp;This hypersensitivity results in persistent vasoconstriction leading to hypopigmentation.&nbsp;Hence, it is also known as a&nbsp;<strong>pharmacologic nevus</strong>.</p>\n<p>It is a <strong>congenital</strong>, localized, <strong>cutaneous vascular anomaly</strong> presenting as a pale, irregularly shaped patch on otherwise normal skin. Histology and electron microscopic examination show&nbsp;<strong>no abnormality in melanocytes</strong> or melanization.</p>\n<div class=\"page\" title=\"Page 833\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<table style=\"width: 440px; height: 153px;\">\n<tbody>\n<tr style=\"height: 51.1146px;\">\n<td style=\"width: 102.094px; height: 51.1146px;\">&nbsp;</td>\n<td style=\"width: 158.922px; height: 51.1146px; text-align: center;\"><strong>Nevus anemicus</strong></td>\n<td style=\"width: 156.984px; height: 51.1146px; text-align: center;\"><strong>Nevus depigmentosus</strong></td>\n</tr>\n<tr style=\"height: 41px;\">\n<td style=\"width: 102.094px; height: 41px;\">Rubbing the lesion</td>\n<td style=\"width: 158.922px; height: 41px;\">No change</td>\n<td style=\"width: 156.984px; height: 41px;\">Lesion becomes red</td>\n</tr>\n<tr style=\"height: 42px;\">\n<td style=\"width: 102.094px; height: 42px;\">Diascopy at the border of the lesion</td>\n<td style=\"width: 158.922px; height: 42px;\">The border between the lesion and the normal skin disappears due to the blanching of the normal skin</td>\n<td style=\"width: 156.984px; height: 42px;\">No change</td>\n</tr>\n</tbody>\n</table>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://upload.wikimedia.org/wikipedia/commons/0/0f/Nevus_anemicus.jpg"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following is the reason for the development of a simple lentigo?",
    "choices": [
      {
        "id": 1,
        "text": "Increased melanin"
      },
      {
        "id": 2,
        "text": "Increased melanocytes"
      },
      {
        "id": 3,
        "text": "Increased melanosomes"
      },
      {
        "id": 4,
        "text": "Decreased melanophages"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Simple lentigo</strong> occurs due to an <strong>increase in melanocytes</strong> at the&nbsp;<strong>dermal-epidermal junction.</strong></p>\n<p>Simple lentigo or <strong>lentigo simplex</strong> is a light to dark-brown or black <strong>macule</strong> that <strong>does not fade away</strong> once it appears. They usually <strong>appear during childhood</strong> and increase in number until the age of 40. It is more common in individuals with red hair and fair skin.</p>\n<p>The image shows lentigo simplex- hyperpigmentation is evident in the basal and squamous epidermal cells.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e82657c53e21481db426a43fb422413ax1280x1282.JPEG"
    ]
  },
  {
    "text": "A 30-year-old pregnant lady is referred to the dermatology OPD with the given condition. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Systemic lupus erythematosus"
      },
      {
        "id": 2,
        "text": "Melasma"
      },
      {
        "id": 3,
        "text": "Vitiligo"
      },
      {
        "id": 4,
        "text": "Chloasma"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>This pregnant lady has&nbsp;<strong>chloasma</strong> or a&nbsp;<strong>mask of pregnancy</strong>. In non-pregnant women, it is called melasma.&nbsp;</p>\n<p>Chloasma is very common in the&nbsp;<strong>3rd trimester</strong> of pregnancy and is most marked in brunettes.</p>\n<p>It&nbsp;is due to increased levels of<strong>&nbsp;estrogen</strong> and<strong> progesterone,</strong> stimulating the activity of melanocytes. Histopathology shows no increase in number but&nbsp;<strong>hyper-functional melanocytes</strong>.&nbsp;It&nbsp;resolves&nbsp;on its own after pregnancy.</p>\n<p><strong>Melasma</strong> is the most common cause of&nbsp;<strong>chronic facial melanosis.&nbsp;</strong>It&nbsp;is manifested by hyperpigmented macules that&nbsp;become more pronounced <strong>after sun</strong> exposure. Hypermelanosis affects mainly the upper lip, the malar regions, forehead, and chin.&nbsp;It is more common in women between 20-40 years.&nbsp;It&nbsp;is frequently seen in women on oral contraceptives.</p>\n<p><strong>Wood's lamp </strong>examination is useful to differentiate the&nbsp;level of pigmentation and treatment&nbsp;<strong>response:&nbsp;</strong>&nbsp;</p>\n<ul>\n<li><strong>Epidermal</strong> melasma-&nbsp;shows enhanced color contrast&nbsp;</li>\n<li><strong>Dermal</strong> melasma<strong>-</strong> shows <strong>less color contrast</strong>&nbsp;(more resistant to treatment)</li>\n<li><strong>Mixed melasma.</strong></li>\n</ul>\n<p>Melasma is more chronic and requires treatment with depigmenting agents like:</p>\n<ul>\n<li><strong>Kligman's triple combination&nbsp;</strong>- topical hydroquinone + tretinoin + corticosteroid compound cream<strong>&nbsp;</strong>(first line)</li>\n<li>Hydroquinone (reduces tyrosinase activity)</li>\n<li>Kojic acid (tyrosinase inhibitor)</li>\n<li>Chemical peels</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/532bd5fb29ab475fa1df743a4517236e.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is incorrect regarding the condition this baby suffers from?",
    "choices": [
      {
        "id": 1,
        "text": "Associated with leptomeningeal melanocytosis"
      },
      {
        "id": 2,
        "text": "Coarse hair can develop on the lesion"
      },
      {
        "id": 3,
        "text": "No malignant potential"
      },
      {
        "id": 4,
        "text": "Treatment is surgical excision"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given image is suggestive of&nbsp;<strong>giant congenital melanocytic naevus</strong> or bathing trunk naevus. It has an <strong>increased malignant potential</strong>.</p>\n<p>It is a very rare condition present in 1:20,000 births. This lesion is usually brown to black in color with a <strong>rough, warty, rugose,</strong> or<strong> cerebriform</strong> surface.&nbsp;To classify it as giant naevi, it should be <strong>&gt;20cm</strong> in size.&nbsp;<strong>Coarse hairs</strong>&nbsp;can develop on it in due course.</p>\n<p>These naevi are&nbsp;<strong>associated</strong>&nbsp;with leptomeningeal melanocytosis or <strong>neurofibromatosis.</strong></p>\n<p><strong>Surgical excision</strong> is the mainstay of treatment and a cultured epidermal <strong>autograft</strong>&nbsp;is used to cover large postoperative surface area defects.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a71b577382884ce2af4b0ad6917ec37c.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Identify the condition shown below:",
    "choices": [
      {
        "id": 1,
        "text": "Epidermal verrucous nevus"
      },
      {
        "id": 2,
        "text": "Congenital melanocytic nevus"
      },
      {
        "id": 3,
        "text": "Melanoacanthoma"
      },
      {
        "id": 4,
        "text": "Malignant melanoma"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The images below show different melanotic skin lesions:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/4ce757da47ca448190bb7cf342a5318a.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6d3584e078a943baacc5d17c44dddf1fx1280x1255.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/40155b7532ed40a2a93ca6fabfd39223x1280x1023.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1c19fbc8e62b49a79c636aa0aa549726x1280x992.JPEG"
    ]
  },
  {
    "text": "A new mother brings her 2-day-old baby to the pediatric OPD with the following skin findings on his back. Which of the following statements is false regarding this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Lesions develop in utero"
      },
      {
        "id": 2,
        "text": "Due to increased melanocytes"
      },
      {
        "id": 3,
        "text": "Associated with Down syndrome"
      },
      {
        "id": 4,
        "text": "Spontaneous regression usually occurs"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given image shows <strong>Mongolian spots</strong>. The coloration is due to the&nbsp;<strong>arrested migration</strong> of<strong> melanocytes within</strong> the deep<strong> dermis</strong> and <strong>to</strong> the <strong>epidermis.</strong> It is not due to increased melanocytes.</p>\n<p>These are <strong>congenital</strong> macular areas of <strong>blue\u2010grey</strong> pigmentation of varying size and shape located on the <strong>lumbosacral area</strong> in normal infants. The lesion <strong>develops in-utero</strong>, increases during infancy, and then diminishes. Sometimes may occasionally persist into adult life.</p>\n<p>These are associated with <strong>Down syndrome</strong> and congenital hemangioma. Extensive Mongolian spots have been associated with Hurler syndrome and GM1 gangliosidosis type 1.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c2db7af019d14f46a6c2f572940bf971.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not a systemic cause of generalized hyperpigmentation?",
    "choices": [
      {
        "id": 1,
        "text": "Addison's disease"
      },
      {
        "id": 2,
        "text": "Hemochromatosis"
      },
      {
        "id": 3,
        "text": "Hypothyroidism"
      },
      {
        "id": 4,
        "text": "Vit B12 deficiency"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Hyperthyroidism</strong> may cause generalized <strong>hyperpigmentation,</strong> not hypothyroidism.</p>\n<p>Generalized hypermelanosis or hyperpigmentation can be due to a variety of systemic diseases. A few common diseases are mentioned below:</p>\n<ul>\n<li>Addison's disease</li>\n<li>Cushing&nbsp;disease</li>\n<li>Hyperthyroidism</li>\n<li>Solid malignant tumor</li>\n<li>Pheochromocytoma</li>\n<li>Systemic sclerosis</li>\n<li>Renal Failure</li>\n<li>Hemochromatosis</li>\n<li>Folate and vitamin B12 deficiency</li>\n<li>Vitamin A deficiency</li>\n<li>Pellagra&nbsp;</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '06 Disorders Of Skin Pigmentation';
        let hierarchy = ["Marrow", "qBank", "Dermatology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>