<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>075 Brainstem Syndromes And Hemorrhagic Stroke - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Medicine
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">26</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A patient has developed confusion and keeps bumping into objects. He can speak fluently. But on examination, he cannot differentiate between fingers and cannot write. He also gets confused with the examiner's right and left sides. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Gerstmann syndrome"
      },
      {
        "id": 2,
        "text": "Anton syndrome"
      },
      {
        "id": 3,
        "text": "Millard Gubler syndrome"
      },
      {
        "id": 4,
        "text": "Dejerine Roussy syndrome"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The most likely diagnosis for this patient is<strong> Gerstmann syndrome</strong>.&nbsp;It is commonly associated with damage to the <strong>left (dominant) inferior parietal lobule</strong>.</p>\n<p>Gerstmann syndrome consists of:</p>\n<ul>\n<li><strong>Acalculia -&nbsp;</strong>impairment of simple arithmetic</li>\n<li><strong>Dysgraphia -&nbsp;</strong>impaired writing</li>\n<li><strong>Finger anomia -&nbsp;</strong>an inability to name individual fingers&nbsp;</li>\n<li><strong>Right-left confusion -&nbsp;</strong>an inability to tell whether a hand, foot, or arm of the patient or examiner is on the right or left side of the body</li>\n</ul>\n<p>Option B: Anton syndrome also known as <strong>visual anosognosia</strong> occurs due to bilateral infarction in the distal PCAs. It produces cortical blindness and the patients are unaware of the blindness or may even deny it.</p>\n<p>Option C: Millard-Gubler syndrome occurs due to ventral pontine injury. It&nbsp;causes functional loss of the <strong>6<sup>th</sup> and 7<sup>th</sup></strong> cranial nerves and <strong>corticospinal</strong> tract. This presents as diplopia, ipsilateral facial palsy, ipsilateral loss of corneal reflex, contralateral hemiparesis.</p>\n<p>Option D: Dejerine-Roussy syndrome<strong>&nbsp;</strong>is associated with<strong>&nbsp;</strong>hemisensory loss and severe burning pain in the affected region. It is also known as <strong>thalamic pain syndrome.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 78-year-old woman presents with right hemisensory loss followed by agonizing, burning pain in the affected regions. The pain responds poorly to analgesics. These features are classically seen in which of the following conditions?",
    "choices": [
      {
        "id": 1,
        "text": "Weber\u2019s syndrome"
      },
      {
        "id": 2,
        "text": "Parinaud\u2019s syndrome"
      },
      {
        "id": 3,
        "text": "Dejerine-Roussy syndrome"
      },
      {
        "id": 4,
        "text": "Millard-Gubler syndrome"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Hemisensory loss</strong> and <strong>severe burning pain</strong>&nbsp;in the affected regions is classically seen in <strong>Dejerine-Roussy syndrome</strong>, also known as&nbsp;thalamic pain syndrome.</p>\n<p>Dejerine- Roussy syndrome occurs due to occlusion of the&nbsp;<strong>thalamic </strong>and<strong> thalamogeniculate branches</strong> arising from the <strong>P1</strong> segment resulting in contralateral hemisensory loss and severe burning pain in the affected regions.</p>\n<p>The P1 segment of the <strong>posterior cerebral artery</strong> extends from the basilar bifurcation to the junction with the posterior communicating artery.</p>\n<p>This pain responds poorly to analgesics. Anticonvulsants such as&nbsp;<strong>carbamazepine</strong> or <strong>gabapentin</strong> or tricyclic antidepressants may be beneficial.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 73-year-old woman was brought to the OPD since she has been tripping over things at home. On entering, she complimented the doctor\u2019s tie even though he was not wearing one and continued to insist that she could see normally. On examination, bilateral blindness was present but pupillary light reflex was normal. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Anton's syndrome"
      },
      {
        "id": 2,
        "text": "Balint\u2019s syndrome"
      },
      {
        "id": 3,
        "text": "Parinaud\u2019s syndrome"
      },
      {
        "id": 4,
        "text": "Riddoch phenomenon"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given scenario is suggestive of <strong>Anton's syndrome</strong>. It occurs due to bilateral&nbsp;infarction in the distal<strong> posterior cerebral artery&nbsp;</strong>(P2 segment) and is associated with the following features:</p>\n<ul>\n<li><strong>Cortical blindness</strong> with preserved pupillary light reaction</li>\n<li><strong>Visual anosognosia</strong> - denial of loss of vision</li>\n<li><strong>Confabulation</strong> in the setting of obvious visual loss</li>\n</ul>\n<p>Option D: Riddoch phenomenon is a condition where cortical blindness is associated with the perception of only moving targets.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient with a history of ischemic heart disease now comes to the hospital due to problems with vision. She complains that while turning her head, the image of the previous target still persists for a few seconds before she can see the new target. This phenomenon is seen in which of the following conditions?",
    "choices": [
      {
        "id": 1,
        "text": "Anton's syndrome"
      },
      {
        "id": 2,
        "text": "Balint's syndrome"
      },
      {
        "id": 3,
        "text": "Parinaud's syndrome"
      },
      {
        "id": 4,
        "text": "Claude's syndrome"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The persistence of visual image even after shifting gaze is called<strong> palinopsia</strong>. It is seen in <strong>Balint&rsquo;s syndrome</strong>.</p>\n<p>Balint&rsquo;s syndrome results due to low flow in the watershed areas between <strong>distal PCA</strong> and <strong>MCA</strong> territories. It is characterized by the following:</p>\n<ul>\n<li><strong>Palinopsia -</strong>&nbsp;persistence of a visual image despite gazing at another scene</li>\n<li><strong>Asimultagnosia -</strong>&nbsp;difficulty to focus on more than one item in the visual field</li>\n<li><strong>Optic ataxia -</strong>&nbsp;Inability to reach accurately under visual guidance</li>\n<li><strong>Ocular apraxia -</strong>&nbsp;Inability to direct gaze accurately to a new target</li>\n</ul>\n<p><strong>Claude's</strong> syndrome is a distinctive brainstem syndrome characterized by <strong>ipsilateral third</strong>&nbsp;<strong>nerve</strong> palsy with <strong>contralateral hemiataxia.</strong> It is due to an intrinsic or extrinsic lesion in the midbrain.</p>\n<p>Note: While some authors use the term simultanagnosia, others use asimultanagnosia instead. A few authors also use these two terminologies interchangeably.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following features do you not expect to see in a patient with Balint's syndrome?",
    "choices": [
      {
        "id": 1,
        "text": "Opsoclonus"
      },
      {
        "id": 2,
        "text": "Optic ataxia"
      },
      {
        "id": 3,
        "text": "Simultanagnosia"
      },
      {
        "id": 4,
        "text": "Ocular apraxia"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Opsoclonus is not seen in Balint's syndrome.</p>\n<p>The features of <strong>Balint&rsquo;s syndrome </strong>are:</p>\n<ul>\n<li><strong>Optic ataxia</strong> - the inability to guide the arm to reach a certain object in the visual field</li>\n<li><strong>Simultanagnosia</strong> - the <strong>inability to perceive more than one </strong>object at a time. In other words, it is the inability to recognize multiple elements in a visual presentation, one object or some elements of a scene can be appreciated but not the display as a whole.</li>\n<li><strong>Ocular apraxia</strong> - the inability to control voluntary purposeful eye movements</li>\n<li><strong>Palinopsia</strong> - the persistence of a visual image even after the stimulus has been removed</li>\n</ul>\n<p>Note: While some authors use the term simultanagnosia, others use asimultanagnosia instead. A few authors also use these two terminologies interchangeably.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient presents with ipsilateral oculomotor palsy and contralateral hemiplegia. What is the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Anton\u2019s syndrome"
      },
      {
        "id": 2,
        "text": "Benedikt syndrome"
      },
      {
        "id": 3,
        "text": "Claude's syndrome"
      },
      {
        "id": 4,
        "text": "Weber's syndrome"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Ipsilateral oculomotor palsy and contralateral hemiplegia is seen in <strong>Weber&rsquo;s syndrome</strong>.</p>\n<p><strong>Weber&rsquo;s syndrome</strong> occurs due to infarction in the distribution of the penetrating branches of the <strong>PCA.</strong> It affects the cerebral peduncle, especially medially, and damages III cranial nerve and the pyramidal fibers. It results in <strong>contralateral&nbsp;hemiplegia</strong> and <strong>ipsilateral&nbsp;oculomotor palsy</strong>.</p>\n<p><strong>Claude's</strong> syndrome is a distinctive brainstem syndrome characterized by ipsilateral third cranial nerve palsy with contralateral <strong>hemiataxia.</strong> This is due to an intrinsic or extrinsic lesion in the midbrain.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which among the following is wrong regarding Weber\u2019s syndrome?",
    "choices": [
      {
        "id": 1,
        "text": "Contralateral hemiplegia"
      },
      {
        "id": 2,
        "text": "Ipsilateral oculomotor nerve palsy"
      },
      {
        "id": 3,
        "text": "Contralateral Parkinsonism"
      },
      {
        "id": 4,
        "text": "Ipsilateral paralysis of lower face"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p class=\"p1\"><strong>Ipsilateral paralysis</strong> of the <strong>lower face</strong> is <strong>not</strong> seen in <strong>Weber's syndrome</strong>. However, there is <strong>contralateral paralysis</strong> of the <strong>lower face</strong>.</p>\n<p class=\"p1\">Weber syndrome is caused by <strong>infarction</strong> in the distribution of the penetrating branches of the <strong>posterior cerebral artery</strong> (PCA). It affects the <strong>cerebral peduncle</strong>, especially medially, with damage to the fascicle of cranial nerve III and the pyramidal fibers.</p>\n<p class=\"p1\">The resultant clinical findings are <strong>contralateral hemiplegia</strong> of the <strong>face</strong>, <strong>arm</strong>, and <strong>leg</strong> secondary to corticospinal and corticobulbar tract involvement, and <strong>ipsilateral</strong> <strong>oculomotor paresis</strong> including a <strong>dilated pupil</strong>.</p>\n<p class=\"p1\">\u00a0</p>\n<table class=\"t1\" style=\"width: 474px; height: 463.781px;\" cellspacing=\"0\" cellpadding=\"0\">\n<tbody>\n<tr style=\"height: 54.3984px;\">\n<td class=\"td1\" style=\"width: 195.762px; text-align: center; height: 54.3984px;\" valign=\"top\">\n<p class=\"p1\"><strong>Structure damaged</strong></p>\n</td>\n<td class=\"td1\" style=\"width: 272.237px; text-align: center; height: 54.3984px;\" valign=\"top\">\n<p class=\"p1\"><strong>Effect</strong></p>\n</td>\n</tr>\n<tr style=\"height: 121.594px;\">\n<td class=\"td1\" style=\"width: 195.762px; text-align: left; height: 121.594px;\" valign=\"top\">\n<p class=\"p1\">Cranial nerve III fibres</p>\n</td>\n<td class=\"td1\" style=\"width: 272.237px; text-align: left; height: 121.594px;\" valign=\"top\">\n<ul>\n<li class=\"p1\">Ipsilateral ptosis</li>\n<li class=\"p1\">Ipsilateral divergent squint</li>\n<li class=\"p1\">Loss of accommodation reflex</li>\n<li class=\"p1\">Loss of light reflex</li>\n</ul>\n</td>\n</tr>\n<tr style=\"height: 76.7969px;\">\n<td class=\"td1\" style=\"width: 195.762px; text-align: left; height: 76.7969px;\" valign=\"top\">\n<p class=\"p1\">Corticobulbar tract</p>\n</td>\n<td class=\"td1\" style=\"width: 272.237px; text-align: left; height: 76.7969px;\" valign=\"top\">\n<p class=\"p1\">UMN lesion leading to contralateral paralysis of the lower face</p>\n</td>\n</tr>\n<tr style=\"height: 54.3984px;\">\n<td class=\"td1\" style=\"width: 195.762px; text-align: left; height: 54.3984px;\" valign=\"top\">\n<p class=\"p1\">Corticospinal tract</p>\n</td>\n<td class=\"td1\" style=\"width: 272.237px; text-align: left; height: 54.3984px;\" valign=\"top\">\n<p class=\"p1\">Contralateral hemiplegia</p>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d63fecab667c4879933074b5ce214f69x1280x1287.JPEG"
    ]
  },
  {
    "text": "A patient presented with loss of upgaze and convergence-retraction nystagmus. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Nothnagel's syndrome"
      },
      {
        "id": 2,
        "text": "Balint\u2019s syndrome"
      },
      {
        "id": 3,
        "text": "Weber\u2019s syndrome"
      },
      {
        "id": 4,
        "text": "Parinaud\u2019s syndrome"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The presence of convergence-retraction nystagmus and loss of upgaze is seen in <strong>Parinaud's syndrome</strong>. It is caused by a lesion in the <strong>dorsal midbrain</strong>.</p>\n<p>The following <strong>tetrad</strong> of symptoms are seen:</p>\n<ol>\n<li>Loss of upgaze</li>\n<li>Light-near dissociation</li>\n<li>Convergence-retraction nystagmus</li>\n<li>Lid retraction</li>\n</ol>\n<p>Convergence\u2010retraction nystagmus is irregular, jerky nystagmus in which both eyeballs rhythmically converge and retract into the orbit, particularly on attempting an upward gaze.</p>\n<p><strong>Nothnagel</strong> syndrome is associated with <strong>oculomotor</strong> palsy and <strong>contralateral\u00a0limb ataxia.</strong> Underlying structures involved are the superior cerebellar peduncle and tectum of the midbrain.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient presented with left-sided hemiplegia and examination revealed right-sided abducens nerve palsy and facial nerve palsy. Further investigation revealed a right-sided pontine haemorrhage. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Marie-Foix syndrome"
      },
      {
        "id": 2,
        "text": "Raymond\u2019s syndrome"
      },
      {
        "id": 3,
        "text": "Millard\u2013Gubler syndrome"
      },
      {
        "id": 4,
        "text": "Foville's syndrome"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Ipsilateral abducens and facial nerve palsy with contralateral hemiplegia are seen in <strong>Millard&ndash;Gubler syndrome</strong>.</p>\n<p>In this syndrome, there is a<strong>&nbsp;ventral pontine injury</strong> (lesion in abducens fascicle) that causes <strong>lateral rectus palsy</strong>.</p>\n<table style=\"width: 520px;\">\n<tbody>\n<tr>\n<td style=\"width: 200px;\">\n<p style=\"text-align: center;\"><strong>CNS lesion&nbsp;&nbsp;</strong></p>\n</td>\n<td style=\"width: 304px; text-align: center;\">&nbsp;<strong>Effects</strong></td>\n</tr>\n<tr>\n<td style=\"width: 200px;\">\n<p>Millard&ndash;Gubler Syndrome</p>\n</td>\n<td style=\"width: 304px;\">\n<ul>\n<li>Ipsilateral abducens nerve weakness</li>\n<li>Ipsilateral facial nerve palsy</li>\n<li>Contralateral hemiplegia</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td style=\"width: 200px;\">\n<p>Raymond&rsquo;s Syndrome</p>\n</td>\n<td style=\"width: 304px;\">\n<ul>\n<li>Ipsilateral abducens nerve palsy</li>\n<li>Contralateral hemiplegia</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td style=\"width: 200px;\">\n<p>Foville&rsquo;s Syndrome</p>\n<p>&nbsp;</p>\n</td>\n<td style=\"width: 304px;\">\n<ul>\n<li>Lateral gaze palsy</li>\n<li style=\"background-color: transparent; color: #000000; cursor: text; font-family: Verdana,Arial,Helvetica,sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: 400; letter-spacing: normal; orphans: 2; outline-color: transparent; outline-style: none; outline-width: 0px; text-align: left; text-decoration: none; text-indent: 0px; text-transform: none; -webkit-text-stroke-width: 0px; white-space: normal; word-spacing: 0px;\">Ipsilateral facial nerve palsy</li>\n<li>Contralateral hemiplegia</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td style=\"width: 200px;\">\n<p>Balint's syndrome</p>\n</td>\n<td style=\"width: 304px;\">\n<ul>\n<li style=\"background-color: transparent; color: #000000; cursor: text; font-family: Verdana,Arial,Helvetica,sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: 400; letter-spacing: normal; orphans: 2; outline-color: transparent; outline-style: none; outline-width: 0px; text-align: left; text-decoration: none; text-indent: 0px; text-transform: none; -webkit-text-stroke-width: 0px; white-space: normal; word-spacing: 0px;\">Optic ataxia</li>\n<li style=\"background-color: transparent; color: #000000; cursor: text; font-family: Verdana,Arial,Helvetica,sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: 400; letter-spacing: normal; orphans: 2; outline-color: transparent; outline-style: none; outline-width: 0px; text-align: left; text-decoration: none; text-indent: 0px; text-transform: none; -webkit-text-stroke-width: 0px; white-space: normal; word-spacing: 0px;\">Ocular apraxia</li>\n<li style=\"background-color: transparent; color: #000000; cursor: text; font-family: Verdana,Arial,Helvetica,sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: 400; letter-spacing: normal; orphans: 2; outline-color: transparent; outline-style: none; outline-width: 0px; text-align: left; text-decoration: none; text-indent: 0px; text-transform: none; -webkit-text-stroke-width: 0px; white-space: normal; word-spacing: 0px;\">Visuospatial disorientation</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td style=\"width: 200px;\">\n<p>Lateral pontine syndrome (Marie-Foix syndrome)</p>\n</td>\n<td style=\"width: 304px;\">\n<ul>\n<li>Contralateral hemiparesis</li>\n<li>Contralateral loss of proprioception &amp; vibration</li>\n<li>Ipsilateral limb ataxia</li>\n<li>Ipsilateral facial palsy</li>\n<li>Lateral hearing loss</li>\n<li>Vertigo</li>\n<li>Nystagmus</li>\n</ul>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following differentiates Foville\u2019s syndrome from Millard-Gubler syndrome?",
    "choices": [
      {
        "id": 1,
        "text": "Contralateral hemiplegia"
      },
      {
        "id": 2,
        "text": "Ipsilateral hemiplegia"
      },
      {
        "id": 3,
        "text": "Ipsilateral facial palsy"
      },
      {
        "id": 4,
        "text": "Lateral gaze palsy"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong> Lateral gaze palsy</strong> is a feature of <strong>Foville\u2019s Syndrome</strong> which is a result of dorsal pontine injury.</p>\n<p><strong>Millard-Gubler</strong> syndrome occurs due to ventral pontine injury.\u00a0Lateral gaze palsy does not occur in this condition because the <strong>abducens fascicle</strong> is <strong>injured</strong> rather than the nucleus.</p>\n<table style=\"width: 520px;\">\n<tbody>\n<tr>\n<td style=\"width: 200px;\">\n<p style=\"text-align: center;\"><strong>CNS lesion\u00a0\u00a0</strong></p>\n</td>\n<td style=\"width: 304px; text-align: center;\">\u00a0<strong>Effects</strong></td>\n</tr>\n<tr>\n<td style=\"width: 200px;\">\n<p>Millard\u2013Gubler Syndrome</p>\n</td>\n<td style=\"width: 304px;\">\n<ul>\n<li>Ipsilateral abducens nerve weakness</li>\n<li>Ipsilateral facial nerve palsy</li>\n<li>Contralateral hemiplegia</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td style=\"width: 200px;\">\n<p>Raymond\u2019s Syndrome</p>\n</td>\n<td style=\"width: 304px;\">\n<ul>\n<li>Ipsilateral abducens nerve palsy</li>\n<li>Contralateral hemiplegia</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td style=\"width: 200px;\">\n<p>Foville\u2019s Syndrome</p>\n<p>\u00a0</p>\n</td>\n<td style=\"width: 304px;\">\n<ul>\n<li>Lateral gaze palsy</li>\n<li style=\"background-color: transparent; color: #000000; cursor: text; font-family: Verdana,Arial,Helvetica,sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: 400; letter-spacing: normal; orphans: 2; outline-color: transparent; outline-style: none; outline-width: 0px; text-align: left; text-decoration: none; text-indent: 0px; text-transform: none; -webkit-text-stroke-width: 0px; white-space: normal; word-spacing: 0px;\">Ipsilateral facial nerve palsy</li>\n<li>Contralateral hemiplegia</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td style=\"width: 200px;\">\n<p>Balint's syndrome</p>\n</td>\n<td style=\"width: 304px;\">\n<ul>\n<li style=\"background-color: transparent; color: #000000; cursor: text; font-family: Verdana,Arial,Helvetica,sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: 400; letter-spacing: normal; orphans: 2; outline-color: transparent; outline-style: none; outline-width: 0px; text-align: left; text-decoration: none; text-indent: 0px; text-transform: none; -webkit-text-stroke-width: 0px; white-space: normal; word-spacing: 0px;\">Optic ataxia</li>\n<li style=\"background-color: transparent; color: #000000; cursor: text; font-family: Verdana,Arial,Helvetica,sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: 400; letter-spacing: normal; orphans: 2; outline-color: transparent; outline-style: none; outline-width: 0px; text-align: left; text-decoration: none; text-indent: 0px; text-transform: none; -webkit-text-stroke-width: 0px; white-space: normal; word-spacing: 0px;\">Ocular apraxia</li>\n<li style=\"background-color: transparent; color: #000000; cursor: text; font-family: Verdana,Arial,Helvetica,sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: 400; letter-spacing: normal; orphans: 2; outline-color: transparent; outline-style: none; outline-width: 0px; text-align: left; text-decoration: none; text-indent: 0px; text-transform: none; -webkit-text-stroke-width: 0px; white-space: normal; word-spacing: 0px;\">Visuospatial disorientation</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td style=\"width: 200px;\">\n<p>Lateral pontine syndrome (Marie-Foix syndrome)</p>\n</td>\n<td style=\"width: 304px;\">\n<ul>\n<li>Contralateral hemiparesis</li>\n<li>Contralateral loss of proprioception &amp; vibration</li>\n<li>Ipsilateral limb ataxia</li>\n<li>Ipsilateral facial palsy</li>\n<li>Lateral hearing loss</li>\n<li>Vertigo</li>\n<li>Nystagmus</li>\n<li>Contralateral loss of pain and temperature</li>\n</ul>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Thrombosis of posterior inferior cerebellar artery causes _______.",
    "choices": [
      {
        "id": 1,
        "text": "Lateral medullary syndrome"
      },
      {
        "id": 2,
        "text": "Weber syndrome"
      },
      {
        "id": 3,
        "text": "Medial medullary syndrome"
      },
      {
        "id": 4,
        "text": "Millard Gubler syndrome"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p class=\"p1\">Thrombosis of the <strong>posterior inferior cerebellar artery</strong> (PICA) causes <strong>lateral medullary syndrome</strong> or <strong>Wallenberg syndrome</strong>.</p>\n<p class=\"p1\"><strong>PICA</strong> is a branch of the fourth part of the <strong>vertebral artery</strong>, which is a branch of the first part of <strong>subclavian artery</strong>.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/40ef020f58e54dd99bd2f163755f47c2x684x680.PNG"
    ]
  },
  {
    "text": "Wallenberg syndrome is most commonly caused by thrombosis of which of the following arteries?",
    "choices": [
      {
        "id": 1,
        "text": "Vertebral artery"
      },
      {
        "id": 2,
        "text": "Posterior inferior cerebellar artery"
      },
      {
        "id": 3,
        "text": "Anterior inferior cerebellar artery"
      },
      {
        "id": 4,
        "text": "Basilar artery"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Thrombosis of the <strong>vertebral artery</strong> is most commonly implicated in <strong>Wallenberg syndrome.</strong></p>\n<p>Wallenberg syndrome, also called<strong> lateral medullary syndrome</strong>, is due to occlusion of the ipsilateral vertebral artery in most cases. In the remainder, posterior inferior cerebellar artery occlusion is responsible.</p>\n<p>Wallenberg / lateral medullary syndrome affects the following structures:<strong><br /></strong></p>\n<ul>\n<li>Descending tract and nucleus of <strong>cranial nerve&nbsp;V -</strong>&nbsp;Ipsilateral impaired sensation over half of the face</li>\n<li><strong>IX and X cranial nerves -</strong>&nbsp;Ipsilateral paralysis of palate, vocal cord, diminished gag reflex</li>\n<li><strong>Nucleus of tractus solitarius -</strong>&nbsp;Ipsilateral loss of taste</li>\n<li><strong>Vestibular nucleus -</strong>&nbsp;Nystagmus, diplopia, vertigo, nausea</li>\n<li>Spinocerebellar tract - Ipsilateral ataxia</li>\n<li>Descending sympathetic tract - Ipsilateral Horner&rsquo;s syndrome</li>\n<li>Lateral spinothalamic tract - Contralateral impaired pain and thermal sensation over half of the body.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following features do you not expect to see in a patient with Wallenberg syndrome?",
    "choices": [
      {
        "id": 1,
        "text": "Ipsilateral ataxia"
      },
      {
        "id": 2,
        "text": "Contralateral hemiplegia"
      },
      {
        "id": 3,
        "text": "Vertigo"
      },
      {
        "id": 4,
        "text": "Impaired sensation on ipsilateral half of face"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The pyramidal tracts are not affected in Wallenberg syndrome and therefore hemiplegia is not seen.</p>\n<p>Wallenberg / lateral medullary syndrome affects the following structures:<strong><br /></strong></p>\n<ul>\n<li>Descending tract and nucleus of <strong>CN V </strong>- I/L impaired sensation over half of face</li>\n<li><strong>IX and X CN</strong> - I/L paralysis of palate, vocal cord, diminished gag reflex</li>\n<li><strong>Nucleus of Tractus Solitarius</strong>\u00a0\u2013 I/L loss of taste</li>\n<li><strong>Vestibular nucleus - </strong>Nystagmus, diplopia, vertigo, nausea</li>\n<li>Spinocerebellar tract \u2013 I/L ataxia</li>\n<li>Descending sympathetic tract\u00a0\u2013 I/L Horner\u2019s syndrome</li>\n<li>Lateral spinothalamic tract \u2013 C/L impaired pain and thermal sensation over half of the body.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following features would you not expect to see in a patient with medial medullary syndrome?",
    "choices": [
      {
        "id": 1,
        "text": "Contralateral hemiparesis"
      },
      {
        "id": 2,
        "text": "Ipsilateral paralysis of tongue"
      },
      {
        "id": 3,
        "text": "Contralateral loss of proprioception"
      },
      {
        "id": 4,
        "text": "Horner's sydrome"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Horner&rsquo;s syndrome is not a feature of medial medullary syndrome. &nbsp;</p>\n<p><strong>Medial medullary syndrome</strong> occurs due to the occlusion of the <strong>vertebral</strong> artery or a <strong>branch</strong> of the <strong>vertebral</strong> <strong>or</strong> <strong>basilar</strong> artery. The features of medial medullary syndrome are</p>\n<ul>\n<li><strong>CN XII -</strong>&nbsp;Ipsilateral paralysis of the tongue</li>\n<li><strong>Pyramidal tract -</strong>&nbsp;Contralateral hemiplegia</li>\n<li><strong>Medial lemniscus -&nbsp;</strong>Impaired tactile and proprioception over the contralateral half of the body</li>\n</ul>\n<p>Horner&rsquo;s syndrome occurs due to a lesion involving the sympathetic fibres. It is seen in lateral medullary syndrome.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which is the most common site of bleed in patients with intracerebral hypertensive haemorrhage?",
    "choices": [
      {
        "id": 1,
        "text": "Thalamus"
      },
      {
        "id": 2,
        "text": "Subcortical white matter"
      },
      {
        "id": 3,
        "text": "Pons"
      },
      {
        "id": 4,
        "text": "Putamen"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The most common site for intracerebral hypertensive hemorrhage is the <strong>putamen</strong>.</p>\n<p>The most common type of intracranial haemorrhage is an <strong>intraparenchymal</strong> i.e., intracerebral haemorrhage. It is most often caused by a <strong>hypertensive bleed.</strong></p>\n<p>Most common sites of intracerebral hypertensive bleed:</p>\n<ul>\n<li>Putamen (basal ganglia)</li>\n<li>Thalamus</li>\n<li>Cerebellum</li>\n<li>Pons.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Raised intracranial tension is not associated with which of the following manifestations?",
    "choices": [
      {
        "id": 1,
        "text": "Seizures"
      },
      {
        "id": 2,
        "text": "Blurring of vision"
      },
      {
        "id": 3,
        "text": "Paraparesis"
      },
      {
        "id": 4,
        "text": "Abducent paralysis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Raised ICT is not associated with paraparesis.</p>\n<p>Manifestations of raised ICT&nbsp;include:</p>\n<ul>\n<li>Hypertension</li>\n<li>Bradycardia</li>\n<li>Respiratory depression</li>\n<li>Headache, visual blurring due to papilloedema and abducent nerve palsy</li>\n<li>Seizures</li>\n</ul>\n<p><strong>Paraparesis</strong> is usually caused by a <strong>spinal lesion</strong> such as thoracic myelopathy and neoplasms causing compression of the spinal cord.&nbsp; &nbsp;</p>\n<p><strong>Rare intracranial causes</strong> of paraparesis are:</p>\n<ul>\n<li>Parasagittal meningioma</li>\n<li>Occlusion of unpaired anterior cerebral artery</li>\n<li>Cerebral venous thrombosis affecting the sagittal sinus.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is a component of Cushing\u2019s triad?",
    "choices": [
      {
        "id": 1,
        "text": "Bradycardia"
      },
      {
        "id": 2,
        "text": "Hypotension"
      },
      {
        "id": 3,
        "text": "Loss of consciousness"
      },
      {
        "id": 4,
        "text": "Papilledema"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Bradycardia</strong> is a component of Cushing's triad.</p>\n<p><strong>Cushing&rsquo;s triad</strong> is characteristically seen in <strong>raised ICT</strong>. Its components are as follows:</p>\n<ul>\n<li>Hypertension</li>\n<li>Bradycardia</li>\n<li>Respiratory depression.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 62-year-old man presents to the casualty with a severe headache, fever, and vomiting for the past 5 hours. There is no history of trauma. CT head is shown below. What is the most common cause for his presentation?",
    "choices": [
      {
        "id": 1,
        "text": "Saccular aneurysms"
      },
      {
        "id": 2,
        "text": "Hypertension"
      },
      {
        "id": 3,
        "text": "Microaneurysms"
      },
      {
        "id": 4,
        "text": "Atherosclerosis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given scenario is suggestive of<strong> non-traumatic</strong> <strong>subarachnoid haemorrhage.</strong>&nbsp;The most common cause for this condition<strong>&nbsp;</strong>is the <strong>rupture</strong> of a <strong>berry aneurysm,&nbsp;</strong>also known as a&nbsp;<strong>saccular aneurysm</strong>.</p>\n<p>CT shows&nbsp;hyperattenuating material filling the subarachnoid space, which&nbsp;is suggestive of&nbsp;SAH. Most commonly, it&nbsp;occurs around the<strong> circle of Willis</strong>&nbsp;due to the&nbsp;rupture of a berry aneurysm&nbsp;at this location.</p>\n<p>Most <strong>unruptured</strong> intracranial aneurysms are completely <strong>asymptomatic</strong>.&nbsp;Prodromal symptoms occasionally suggest the site of the enlarging unruptured aneurysm. For example, cranial nerve III palsy with loss of ipsilateral light reflex and focal pain above or behind the eye suggests an expanding aneurysm at the junction of the posterior communicating artery and internal carotid artery.</p>\n<p><strong>Ruptured aneurysms</strong> cause an excruciating<strong>&nbsp;thunderclap headache </strong>followed by a<strong> transient loss of consciousness.</strong></p>\n<p>Non-contrast CT&nbsp;scan is the investigation of choice for SAH. LP shows&nbsp;xanthochromatic CSF.</p>\n<p>Treatment involves <strong>clipping or coiling</strong> the aneurysm to eliminate the risk of rebleeding.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/7c6a04685bcb4f1d96afbb6526dff508.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following structures is most likely to be compressed by an aneurysm of the posterior communicating artery?",
    "choices": [
      {
        "id": 1,
        "text": "Oculomotor nerve"
      },
      {
        "id": 2,
        "text": "Optic  nerve"
      },
      {
        "id": 3,
        "text": "Trochlear nerve"
      },
      {
        "id": 4,
        "text": "Abducens nerve"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Aneurysm of the <strong>posterior communicating artery</strong> will most likely compress the <strong>oculomotor nerve</strong>.&nbsp;This is because the posterior communicating artery is anatomically located very close to the oculomotor nerve.</p>\n<p>Patients with an aneurysm of the posterior communicating artery can present with symptoms of oculomotor nerve palsy such as:</p>\n<ul>\n<li>Unilateral ptosis (LPS)</li>\n<li>Outward eye deviation (MR)</li>\n<li>Dilated pupil.</li>\n</ul>\n<p>The nerves controlling the pupils are located very superficially and these are always affected due to the mass effect of the aneurysm. Therefore the pupil sparing third nerve palsies are unlikely to be due to an aneurysm.&nbsp;</p>\n<p><strong>Pupil-sparing</strong> oculomotor nerve palsy is often assumed to be caused by <strong>ischemic injuries</strong> such as <strong>hypertension</strong> and <strong>diabetes</strong> mellitus.</p>\n<p>Expanding unruptured aneurysms can occasionally lead to prodromal symptoms which suggest the location of the aneurysm.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "At which of the following locations does a Berry aneurysm have the highest risk of rupture?",
    "choices": [
      {
        "id": 1,
        "text": "Origin of posterior communicating artery"
      },
      {
        "id": 2,
        "text": "Origin of anterior cerebral artery"
      },
      {
        "id": 3,
        "text": "Middle cerebral artery"
      },
      {
        "id": 4,
        "text": "Anterior communicating artery"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The size and site of aneurysm are important in predicting the risk of rupture. Aneurysms with the following features have a greater risk of rupture:</p>\n<ul>\n<li>Size&nbsp;<strong>&gt;7 mm</strong> in diameter&nbsp;</li>\n<li>Located at the <strong>top </strong>of the<strong> basilar artery&nbsp;</strong>(i.e origin of the posterior cerebral artery)</li>\n<li>Located near the<strong> origin </strong>of the<strong> posterior communicating</strong> <strong>artery.</strong></li>\n</ul>\n<p>The most common location&nbsp;of Berry aneurysm is the&nbsp;anterior communicating artery.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The CT finding of a patient is shown below. What is the most common cause for this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Rupture of berry aneurysm"
      },
      {
        "id": 2,
        "text": "Injury to bridging dural veins"
      },
      {
        "id": 3,
        "text": "Rupture of cerebral AV malformation"
      },
      {
        "id": 4,
        "text": "Injury to middle meningeal artery"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given image is suggestive of a <strong>subdural hematoma</strong> and it most commonly results from <strong>injury</strong> to the <strong>bridging dural veins</strong>.&nbsp;</p>\n<p>Subdural hematoma refers to the haemorrhage <strong>between</strong> the <strong>dura and arachnoid&nbsp;mater</strong>.&nbsp;The image of the CT scan reveals a hyperdense <strong>crescentic lesion</strong>. Mass effect with midline displacement can also be seen.</p>\n<p>Causes of SDH are:</p>\n<ul>\n<li>Trauma</li>\n<li>Anticoagulants</li>\n<li>Antiplatelets</li>\n<li>Alcohol abuse</li>\n<li>Shaken baby syndrome.</li>\n</ul>\n<p><strong>Non-contrast CT</strong> is the <strong>investigation of choice</strong>. Radiographic features of subdural hemorrhage are:</p>\n<ul>\n<li>Typically unilateral</li>\n<li>Crescent-like distribution (<strong>concavo-convex</strong>) around the periphery of the brain</li>\n<li>Not limited by sutures and can fill dural reflections</li>\n<li><strong>Chronic </strong>subdural hemorrhage: Crescent-shaped<strong> hypodense </strong>lesion<strong>&nbsp;</strong>on axial CT</li>\n<li><strong>Acute </strong>subdural hemorrhage:<strong> Hyperdense </strong>collections on CT</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3cf52742ee2047eb97da4bd2ea6397ea.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "The CT scan of a patient who was brought to the casualty after a road traffic accident is shown below. Between what structures does blood accumulate in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Outer table and inner table of the skull"
      },
      {
        "id": 2,
        "text": "Outer table and dura mater"
      },
      {
        "id": 3,
        "text": "Inner table and dura mater"
      },
      {
        "id": 4,
        "text": "Periosteum and aponeurotic layer of scalp"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given CT image is suggestive of <strong>extradural haemorrhage</strong> (EDH). In this condition, blood accumulates between the <strong>inner table of the skull and the dura mater</strong>.</p>\n<p>The typical presentation is an initial loss of consciousness following trauma, a complete transient recovery (<strong>lucid interval</strong>), and a rapid progression of neurological deterioration.</p>\n<p>This condition is treated by rapid <strong>surgical evacuation</strong> and ligation or <strong>cautery</strong> of the damaged vessel.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/6eb53136919445c19fed5d467bbd074e.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is false regarding extradural hemorrhage?",
    "choices": [
      {
        "id": 1,
        "text": "CT shows crescentic opacity"
      },
      {
        "id": 2,
        "text": "Lucid interval is characteristic"
      },
      {
        "id": 3,
        "text": "Middle meningeal artery bleed is the most common source"
      },
      {
        "id": 4,
        "text": "Most common cause is trauma"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>In <strong>extradural hemorrhage</strong> (EDH), CT brain does not show a crescentric opacity. It shows a <strong>lentiform opacity</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 50-year-old hypertensive man presented with an acute-onset headache for the past 2 hours, neck stiffness, nausea, and vomiting. He claims it is the worst headache of his life. There are no focal neurological deficits and his CT scan shows blood in the Sylvian fissure. What is the most probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Extradural hemorrhage"
      },
      {
        "id": 2,
        "text": "Subarachnoid hemorrhage"
      },
      {
        "id": 3,
        "text": "Subdural haemorrhage"
      },
      {
        "id": 4,
        "text": "Hypertensive bleed"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>This patient's clinical features of sudden-onset headache with neck stiffness, nausea, and vomiting with no neurological deficits is suggestive of a diagnosis of <strong>subarachnoid haemorrhage</strong>. The presence of blood in the Sylvian fissure confirms this diagnosis.</p>\n<p><strong>Trauma</strong> is the most common cause. However, spontaneous sub-arachnoid&nbsp;bleeding occurs most often due to the rupture of a berry aneurysm. Most of them are found in the <strong>anterior circulation</strong>, mostly on the circle of Willis. The three most common locations are:</p>\n<ul>\n<li>Terminal ICA</li>\n<li>MCA bifurcation</li>\n<li>Top of the basilar artery.</li>\n</ul>\n<p>A non-contrast CT scan is the investigation of choice. LP shows xanthochromatic CSF.</p>\n<p>Treatment involves<strong> clipping or coiling</strong> the aneurysm to eliminate the risk of rebleeding.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 53-year-old man was admitted with a history of a cerebrovascular accident. On the second day, he becomes drowsy with minimal response. CT finding is shown in the image below. What will be your next line of management?",
    "choices": [
      {
        "id": 1,
        "text": "Aspirin and clopidogrel"
      },
      {
        "id": 2,
        "text": "Mannitol"
      },
      {
        "id": 3,
        "text": "Decompressive surgery"
      },
      {
        "id": 4,
        "text": "Mechanical thrombectomy"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The clinical scenario describes a 53 year old patient admitted in view of a <strong>cerebrovascular accident</strong> developing <strong>neurologic deterioration</strong> (drowsy with minimal response) on the <strong>second day</strong>, and <strong>CT brain</strong> showing significant <strong>edema of MCA territory</strong> with <strong>midline shift</strong>. The next line of management is <strong>decompressive surgery</strong>.</p>\n<p><strong>Cerebral edema</strong> is a potential <strong>complication in 5-10%</strong> of patients with <strong>strokes</strong>, leading to obtundation and brain herniation. The severity of edema is highest on the second or third day after the stroke and can last for around 10 days.\u00a0</p>\n<p>Medical management may not be successful in case of significant edema or infarcts involving the cerebellum.\u00a0</p>\n<p><strong>Decompressive surgery</strong> is recommended for patients who are <strong>less than 60 years</strong> old and experience <strong>deterioration \u2264 48 hours</strong>, despite receiving medical therapy. <strong>Hypodensity</strong> on <strong>head CT</strong> within the <strong>first 6 hours</strong> of stroke onset, involving <strong>\u2265 one-third of the MCA territory</strong>, early <strong>midline shift</strong>, and a diffusion-weighted imaging volume on MRI within 6 hours \u2265 80 mL are predictors of <strong>severe cerebral edema</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/5a0119c357cf4c85a06e09ed00c0843e.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 62-year-old man presents to the ER with headache, fever, and vomiting for the past 5 hours. A CT image is shown below. Physical examination shows positive Kernig\u2019s and Brudzinski\u2019s signs. Vitals: Temp - 101 F, BP - 120/88 mmHg, PR - 110 beats/min, pupils reactive. What is the next best step?",
    "choices": [
      {
        "id": 1,
        "text": "Administer IV ceftriaxone"
      },
      {
        "id": 2,
        "text": "Administer IV tenecteplase"
      },
      {
        "id": 3,
        "text": "Craniotomy"
      },
      {
        "id": 4,
        "text": "Surgical clipping"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The scenario is suggestive of <strong>subarachnoid hemorrhage (</strong><strong>SAH)&nbsp;</strong>and the treatment of choice for this condition&nbsp;is <strong>surgical clipping.&nbsp;</strong></p>\n<p>CT shows <strong>hyperattenuating material </strong>filling the<strong> subarachnoid space,&nbsp;</strong>which&nbsp;is suggestive of SAH. Most commonly, it occurs around the circle of Willis due to the&nbsp;rupture of a berry aneurysm at this location.</p>\n<p><strong>SAH</strong> can present with fever, positive Kernig&rsquo;s sign, and Brudzinski&rsquo;s sign, as well as <strong>mimic meningitis or encephalitis.</strong></p>\n<p>Treatment with the calcium channel antagonist nimodipine (60 mg PO every 4 h) improves outcome, by preventing ischemic injury.</p>\n<p>Option A: Vancomycin + ceftriaxone is the recommended therapy for <strong>bacterial meningitis</strong>. Meningitis does not show hyper-attenuated subarachnoid space.</p>\n<p>Option B: IV Tenecteplase is used for <strong>ischemic stroke</strong> without bleeding complications.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/37ddcc745fff48979226f4b960c281e9.PNG"
    ],
    "explanation_images": []
  }
];
        let quizName = '075 Brainstem Syndromes And Hemorrhagic Stroke';
        const quizFilename = '075-brainstem-syndromes-and-hemorrhagic-stroke-ecf21684.html';
        let hierarchy = ["Marrow", "qBank", "Medicine"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>