<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fmge Mini Test - 3 - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / FMGE Mini Test Series / 2024
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">30</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A 34 year old construction worker with no comorbidities presents with exertional pain in both forearms and hands. He smokes 1 pack of cigarettes per day. On examination, brachial pulses are palpable but radial and ulnar pulses are feeble. Image  of his hand is shown. Angiography of his upper extremity shows smooth tapering segmental lesions in the distal arterial vessels. Which of the following treatments has the greatest chances of success?",
    "choices": [
      {
        "id": 1,
        "text": "Cilostazol"
      },
      {
        "id": 2,
        "text": "Heparin"
      },
      {
        "id": 3,
        "text": "Prednisone"
      },
      {
        "id": 4,
        "text": "Smoking cessation"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>This is a classical clinical scenario of <strong>thromboangiitis obliterans</strong>. There is no specific treatment except abstinence from tobacco.</p>\n<p>Key points in the question:</p>\n<ul>\n<li>Male &lt; 40years</li>\n<li>Smoker</li>\n<li>Involvement of upper extremity</li>\n<li>Raynauds phenomenon</li>\n</ul>\n<p><strong>Thromboangiitis Obliterans (Buerger&rsquo;s disease):</strong></p>\n<ul>\n<li>An inflammatory occlusive vascular disorder involving small and medium-sized arteries and veins in the distal upper and lower extremities.</li>\n<li>Most common in men &lt;40 years of age.</li>\n<li>Although the cause of thromboangiitis obliterans is not known, there<strong> is a definite relationship to cigarette smoking in patients with this disorder</strong>.</li>\n<li>MRA, CTA, and conventional arteriography show smooth, tapering segmental lesions in the distal vessels with collateral vessels at sites of vascular occlusion.</li>\n<li>There is no specific treatment except abstention from tobacco.</li>\n<li>The prognosis is worse in individuals who continue to smoke, but results are discouraging even in those who stop smoking.</li>\n<li>Antibiotics may be useful.</li>\n<li>Anticoagulants and glucocorticoids are not helpful.</li>\n<li>If these measures fail, amputation may be required.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/bfbb22616e1c41bb8b6afe670336dc0a.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 27-year-old woman presents with irregular periods, acne & excessive hair growth. What is the first line management?",
    "choices": [
      {
        "id": 1,
        "text": "Lifestyle modification"
      },
      {
        "id": 2,
        "text": "Clomiphene"
      },
      {
        "id": 3,
        "text": "Metformin"
      },
      {
        "id": 4,
        "text": "OCPs"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The first line of treatment for this woman with signs and symptoms of polycystic ovary syndrome <strong>(PCOS) </strong>such as<strong> irregular periods, acne &amp; excessive hair growth (hirsutism) </strong>is<strong> lifestyle modification.</strong></p>\n<p>PCOS is an endocrinopathy seen in women of reproductive age, affecting multiple systems. A <strong>weight loss of 10%</strong> through lifestyle modifications such as <strong>diet and exercise are considered first-line</strong>.</p>\n<p>The\u00a0<strong>Rotterdam criteria</strong>\u00a0are used to diagnose PCOS. The presence of\u00a0<strong>any two of the three</strong>\u00a0components of this criteria establishes the diagnosis of PCOS:</p>\n<ul>\n<li>Clinical/biochemical hyperandrogenism (<strong>hirsutism</strong>, acne)</li>\n<li>Menstrual abnormalities (oligomenorrhea/amenorrhea), anovulation, infertility</li>\n<li><strong>Polycystic ovaries\u00a0</strong>on ultrasonography.</li>\n</ul>\n<div class=\"page\" title=\"Page 424\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Sonographic criteria for polycystic ovaries include \u2265 12 small cysts or an increased ovarian volume (&gt; 10 mL) or both.\u00a0</p>\n</div>\n</div>\n</div>\n</div>\n<p><span data-preserver-spaces=\"true\">Management:</span></p>\n<ul>\n<li><strong>Weight reduction\u00a0<span data-preserver-spaces=\"true\">and\u00a0lifestyle changes </span></strong>are\u00a0considered the first-line treatment for infertility in obese women with PCOS.</li>\n<li><strong>Clomiphene citrate</strong> is the first-line pharmacological choice for ovulation induction in PCOS <strong>(Option B)</strong>.</li>\n<li>Gonadotropins are\u00a0second-line.(Aromatase inhibitors like <strong>letrozole</strong> are now\u00a0<strong>not used</strong> to treat infertility in these patients)</li>\n<li><span data-preserver-spaces=\"true\">Patients with PCOD are more prone to developing\u00a0</span><strong><span data-preserver-spaces=\"true\">insulin resistance\u00a0</span></strong><span data-preserver-spaces=\"true\">which can be controlled with</span><strong><span data-preserver-spaces=\"true\"> metformin (Option C).</span></strong><span data-preserver-spaces=\"true\">\u00a0</span></li>\n<li><strong><span data-preserver-spaces=\"true\">Oral contraceptive pills</span></strong><span data-preserver-spaces=\"true\">\u00a0(OCP), preferably fourth-generation are used to treat\u00a0</span><strong><span data-preserver-spaces=\"true\">menstrual abnormalities</span></strong><span data-preserver-spaces=\"true\">. It also reduces acne and further hirsutism <strong>(Option D)</strong>.</span></li>\n<li><span data-preserver-spaces=\"true\"><strong>Anti-androgens</strong>\u00a0are useful in treating hirsutism.\u00a0OCP with cyproterone acetate\u00a0is prescribed for PCOS patients with hirsutism.</span><span data-preserver-spaces=\"true\">\u00a0</span></li>\n</ul>\n<p>Surgical options include\u00a0<strong>laparoscopic ovarian drilling</strong>\u00a0or puncture of not more than four cysts in each ovary. It restores endocrine levels and improves fertility.\u00a0Surgery\u00a0is <strong>indicated</strong> only in the case of</p>\n<ul>\n<li class=\"p3\"><strong>Failure of medical therapy</strong></li>\n<li class=\"p3\">Hyperstimulation</li>\n<li class=\"p3\">Infertile women</li>\n<li class=\"p3\">Previous pregnancy losses</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "After a surgery, the surgeon asked the intern to remove the Foley's catheter but he/she could not do it. The surgeon himself tried to remove it but he was unsuccessful as well. What should be the next step of action?",
    "choices": [
      {
        "id": 1,
        "text": "CT-guided rupture of bulb of Foley's"
      },
      {
        "id": 2,
        "text": "Inject ether to dissolve the balloon and pull it out"
      },
      {
        "id": 3,
        "text": "Inject water to overdistend the balloon until it bursts and Foley's can be removed"
      },
      {
        "id": 4,
        "text": "Use ultrasound guidance to locate and prick the balloon after inflating with 20ml water"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The best technique in this situation is ultrasound-guided rupture of the balloon percutaneously after inflating it with 20ml water. It is important subsequently to cystoscope the patient to ensure that any fragments are removed before they can form a foreign body calculus.</p>\n<div class=\"page\" title=\"Page 1457\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>A retained Foley catheter is usually caused by blockage of the channel that connects the balloon to the side arm. Cutting off the side arm and attempting to clear the channel with a wire is only occasionally successful.</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Demographic gap starts contracting in the _________ phase.",
    "choices": [
      {
        "id": 1,
        "text": "Low stationary"
      },
      {
        "id": 2,
        "text": "Early expanding"
      },
      {
        "id": 3,
        "text": "Late expanding"
      },
      {
        "id": 4,
        "text": "Declining"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Demographic gap starts contracting</strong> in the <strong>late expanding</strong> phase\u00a0<strong>(STAGE 3).</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Iron absorption takes place in the _____.",
    "choices": [
      {
        "id": 1,
        "text": "Proximal small intestine under basic condition"
      },
      {
        "id": 2,
        "text": "Proximal small intestine under acidic condition"
      },
      {
        "id": 3,
        "text": "Distal small intestine under basic condition"
      },
      {
        "id": 4,
        "text": "Distal small intestine under acidic condition"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Iron absorption takes place in the&nbsp;<strong>proximal small intestine under acidic conditions</strong>.</p>\n<ul>\n<li>Dietary iron present as heme is efficiently absorbed; but non-heme iron is less efficiently absorbed mainly because of interference by phosphates, tannins, oxalates and other food constituents.</li>\n<li>Iron is absorbed into the luminal cell in the ferrous form by&nbsp;<strong>DMT-1&nbsp;</strong>also known as natural resistance-associated macrophage protein type 2 (<strong>Nramp2</strong>)</li>\n<li>The acidic contents of the stomach facilitate the conversion of ferric (Fe<sup>3+</sup>) iron to ferrous (Fe<sup>2+</sup>) iron by an enzyme called&nbsp;<strong>ferrireductase</strong>.</li>\n<li>Once inside the cell, the iron can be stored as&nbsp;<strong>ferritin</strong>, or be released at the basolateral surface through&nbsp;<strong>ferroportin</strong>.&nbsp;</li>\n<li><strong>Hephaestin&nbsp;</strong>is a ferroxidase that converts ferrous (Fe<sup>2+</sup>)&nbsp;iron into ferric (Fe<sup>3+</sup>)&nbsp;form for binding to transferrin in the plasma.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/acda5fdbd5dd4d02a24ce182a3060cabx1279x1210.JPEG"
    ]
  },
  {
    "text": "Which of the following is used to estimate the visual field?",
    "choices": [
      {
        "id": 1,
        "text": "Confrontation method"
      },
      {
        "id": 2,
        "text": "Campimetry"
      },
      {
        "id": 3,
        "text": "Octopus Fieldmaster"
      },
      {
        "id": 4,
        "text": "All the above"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<ul>\n<li>All the options are used to estimate the visual field.</li>\n<li><strong>Types:</strong>\n<ul>\n<li>Manual perimetry:<strong>&nbsp;Confrontation method, Lister&rsquo;s perimeter, Campimetry (Scotometry), Goldmann&rsquo;s perimeter</strong></li>\n<li>Automated perimetry:<strong>&nbsp;Octopus Fieldmaster, Humphrey Field Analyzer</strong></li>\n</ul>\n</li>\n</ul>\n<p>The image given below shows Lister's perimeter.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5d3425a4c368461f87164bdd477f4ca8x1280x1707.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0c84e667bdbd48ac909f1b4dc06226e9x500x390.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/cddd387ab1e84a9f9be9829352d3c7abx311x244.JPEG"
    ]
  },
  {
    "text": "Suitable cases for expectant management in case of placenta previa include all except:",
    "choices": [
      {
        "id": 1,
        "text": "Assured fetal well-being"
      },
      {
        "id": 2,
        "text": "Duration of pregnancy >37 weeks"
      },
      {
        "id": 3,
        "text": "Mother in good health"
      },
      {
        "id": 4,
        "text": "No active vaginal bleeding"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The duration of pregnancy must be <strong>less than 37 weeks </strong>for expectant management which was advocated&nbsp;by&nbsp;<strong>McAfee</strong>&nbsp;and <strong>Johnson.</strong>&nbsp;</p>\n<p>The <strong>aim</strong> of conservative management is to continue the pregnancy for fetal maturity without compromising maternal health.</p>\n<p><strong>Prerequisites:</strong></p>\n<ul>\n<li>Availability of blood for transfusion&nbsp;</li>\n<li>Facilities for cesarean section available&nbsp;</li>\n</ul>\n<p><strong>Selection</strong> of cases for expectant management for placenta&nbsp;previa:&nbsp;</p>\n<ol>\n<li>Mother is hemodynamically <strong>stable</strong> (Hb&nbsp;<span style=\"text-decoration: underline;\">&gt;</span>10 g% and/or hematocrit&nbsp;<span style=\"text-decoration: underline;\">&gt;&nbsp;</span>30%)&nbsp;</li>\n<li>Duration of pregnancy <strong>&lt;37 weeks</strong>&nbsp;</li>\n<li>No active vaginal bleeding&nbsp;</li>\n<li>Fetus normal on USG and reactive on CTG</li>\n</ol>\n<p><strong>Conduct</strong> of expectant treatment:&nbsp;</p>\n<ul>\n<li><strong>Corticosteroids</strong>&nbsp;for fetal lung maturity&nbsp;</li>\n<li>Bed rest or pelvic rest</li>\n<li>Periodic monitoring of mother for bleeding pv</li>\n<li>Fetal surveillance with USG&nbsp;&nbsp;</li>\n<li><strong>Tocolytics</strong> if contractions are present</li>\n<li><strong>Anti-D</strong> to all&nbsp;Rh-negative (unsensitized) women.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A man presents to the ER with a gunshot wound to the abdomen as shown below. On examination, the peritoneum is breached. BP is 114/78 mmHg and HR is 80 bpm. Which of the following is the most appropriate next step?",
    "choices": [
      {
        "id": 1,
        "text": "Laparotomy"
      },
      {
        "id": 2,
        "text": "CT scan of the abdomen"
      },
      {
        "id": 3,
        "text": "FAST"
      },
      {
        "id": 4,
        "text": "Observation for the next 24 hours"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The most appropriate management for a patient with a <strong>gunshot wound</strong> to the <strong>anterior abdominal wall</strong> with a <strong>breach of the peritoneum</strong> is <strong>laparotomy</strong>.</p>\n<p>The incidence of significant injury to the intraperitoneal organs increases manifold when there is a breach of the peritoneum due to any penetrating trauma injury.\u00a0The <strong>indications for doing laparotomy</strong> in patients with penetrating abdominal wounds include:</p>\n<ul>\n<li><strong>Hemodynamic instability</strong></li>\n<li><strong>Gunshot wound</strong> which breaches the peritoneum</li>\n<li><strong>Evisceration</strong></li>\n<li>Bleeding from the stomach, rectum, or genitourinary tract following penetrating trauma</li>\n<li><strong>Peritonitis</strong></li>\n<li><strong>Free air in the peritoneal cavity</strong></li>\n<li><strong>Diagnostic peritoneal lavage</strong> has\u00a0bile, gastrointestinal contents or\u00a0<strong>\u226510 cc of blood</strong></li>\n</ul>\n<p><strong>CT scan</strong> of the abdomen (option B) should be performed in patients with <strong>blunt or penetrating abdominal trauma</strong>, provided they are <strong>hemodynamically stable</strong> and have <strong>no indication for immediate laparotomy</strong>. The patient in question has a gunshot wound to the anterior abdominal wall with a peritoneal breach, which is an indication for exploratory laparotomy as it carries a high risk of organ injury. <strong>FAST</strong> (option C) is primarily indicated in patients with <strong>blunt abdominal trauma</strong> <strong>with or without hemodynamic instability</strong>. It is <strong>not a sensitive investigation</strong> to detect hollow visceral injury in patients with <strong>penetrating abdominal trauma</strong>. There is no role for observation (option D) in this patient.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/f5a11d21b6584496a9818207acc6178a.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A patient with acute pancreatitis was admitted following an episode of binge drinking. 7-days post-admission, he complains of fever with chills and rigor. Blood investigation shows a WBC count of 21,450. CT scan reveals the presence of extraluminal gas in the pancreatic tissue. How will you manage this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Cystogastrostomy"
      },
      {
        "id": 2,
        "text": "Cystojejunostomy"
      },
      {
        "id": 3,
        "text": "Percutaneous catheter drainage"
      },
      {
        "id": 4,
        "text": "IV antibiotics alone"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario with a history of pancreatitis, elevated WBC, and CT scan findings are suggestive of <strong>pancreatic abscess. </strong>It is treated by <strong>percutaneous drainage.</strong></p>\n<p>A pancreatic abscess is a circumscribed intra-abdominal collection of pus, usually in proximity to the pancreas. It may be an acute fluid collection or walled-off <strong>necrosis<strong><strong>&nbsp;</strong></strong></strong>that has become <strong>infected</strong>.</p>\n<p>Clinical features include:</p>\n<ul>\n<li>Fever with chills</li>\n<li>Elevated white blood cell count</li>\n<li>Abdominal pain</li>\n</ul>\n<p><strong>Contrast-enhanced CT </strong>and <strong>MRI</strong> are both options for the assessment of pancreatic necrosis and abscesses. On imaging, the presence of <strong>extraluminal gas</strong> in the pancreatic and/or peripancreatic tissues is consistent with an underlying infection.</p>\n<article class=\"single-article\"></article>\n<p>Treatment is by <strong>percutaneous drainage with the widest possible drains</strong> placed under imaging guidance, along with appropriate antibiotics and supportive care.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A woman diagnosed with DCIS underwent surgery and is now posted for adjuvant radiotherapy with external beam radiotherapy. Which of the following isotopes is commonly used for the same?",
    "choices": [
      {
        "id": 1,
        "text": "Cobalt-59"
      },
      {
        "id": 2,
        "text": "Cobalt -60"
      },
      {
        "id": 3,
        "text": "Radium-226"
      },
      {
        "id": 4,
        "text": "Strontium-89"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Cobalt-60</strong> isotope is used for <strong>external beam radiotherapy</strong> (EBRT).</p>\n<p>External beam radiotherapy is given as follows:</p>\n<ul>\n<li>Cobalt machine - Co-60 produces gamma rays. It emits radiation of energy 1.25 MeV.</li>\n<li>LINAC (linear accelator) - X-ray beams are generated to provide ionising radiation.</li>\n</ul>\n<p>The energy spectrum used in radiotehrapy is classified as follows:</p>\n<ul>\n<li>Orthovoltage - 200-500kV x-rays are produced. It is used to treat skin conditions.&nbsp;</li>\n<li>Megavoltage - 1-25 MV x-rays are produced. These are used in modern radiotherapy.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is not true regarding piebaldism?",
    "choices": [
      {
        "id": 1,
        "text": "It is autosomal dominant"
      },
      {
        "id": 2,
        "text": "Well-defined hypopigmented macules are seen"
      },
      {
        "id": 3,
        "text": "White forelock is rare"
      },
      {
        "id": 4,
        "text": "Small spots of hyperpigmentation can also be seen"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>White forelock</strong> is quite common<strong>&nbsp;</strong>in Piebaldism.</p>\n<p><strong>Piebaldism:</strong></p>\n<ul>\n<li><strong>Autosomal dominant</strong> benign&nbsp;condition, it has&nbsp;mutations in c\u2010KIT.</li>\n<li>Well-defined irregular&nbsp;<strong>hypopigmented macules</strong>&nbsp;with an absence of melnocytes.</li>\n<li>Small spots of hyperpigmentation are also seen within hypopigmented patches or on normal skin.&nbsp;</li>\n<li>It is often associated with a <strong>V-shaped leucoderma</strong> on mid-forehead.</li>\n<li><strong>Both sexes</strong> are equally affected.</li>\n<li>Piebaldism can be distinguished from vitiligo because of the<strong> neonatal presence of white patches.</strong></li>\n<li>Epidermal cell or skin grafting is the treatment.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/64f6f8375a5844ebbed9f5ce8ccecb18x512x510.PNG"
    ]
  },
  {
    "text": "A patient is diagnosed with hepatitis B infection. Which of the following markers will always be present in his serum, even during recurrences, or if he develops chronic hepatitis?",
    "choices": [
      {
        "id": 1,
        "text": "HBc Ag"
      },
      {
        "id": 2,
        "text": "Anti HBs Ab"
      },
      {
        "id": 3,
        "text": "Anti HBc Ab"
      },
      {
        "id": 4,
        "text": "HBe Ag"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>A patient who has had exposure to HBV will have <strong>Anti HBc antibodies&nbsp;</strong>even when he has moved into the chronic or recurrent stages.&nbsp;<strong>IgM</strong> anti-HBc reappears during acute&nbsp;<strong>recurrences</strong> while <strong>IgG</strong> Anti HBc is found in <strong>chronic</strong> states.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 71-year-old man presents to the OPD with high-grade fever, productive cough. On examination, the respiratory rate was found to be 32/ min, heart rate of 102/ min, and blood pressure of 90/60 mmHg. How will you manage this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Admit to ICU and treat with azithromycin and ceftriaxone"
      },
      {
        "id": 2,
        "text": "Admit to the ward and treat with levofloxacin and doxycycline"
      },
      {
        "id": 3,
        "text": "Treat him on OP basis with azithromycin and ceftriaxone"
      },
      {
        "id": 4,
        "text": "Admit to the ward and treat with azithromycin and levofloxacin"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario is highly suggestive of lobar pneumonia and the patient belongs to a <strong>CURB-65 score </strong>of <strong>3</strong>. The patient can be best managed by a <strong>combination of azithromycin and ceftriaxone </strong>in an <strong>ICU setting</strong>.\u00a0After culture sensitivity, specific management is done.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following vaccine vials can be used based on the vaccine vial monitor (VVM) color changes shown?",
    "choices": [
      {
        "id": 1,
        "text": "Only vial 1 can be used"
      },
      {
        "id": 2,
        "text": "Vials 1 and 2 can be used"
      },
      {
        "id": 3,
        "text": "Vials 1, 2, and 3 can be used"
      },
      {
        "id": 4,
        "text": "All vials can be used"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<ul>\n<li>From the above image, only <strong>vials 1 and 2</strong> can be used as the inner squares of the VVMs are lighter than the outer circles.</li>\n<li>Vial 3 has crossed the <strong>discard point</strong> as the inner square and outer circle are the same color (if not, the inner square is a little darker than the outer circle) and thus cannot be used.</li>\n<li><strong>Vial 4 cannot</strong> be used as the VVM shows a <strong>darker inner square.</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/fba1c8e570c54f72ab5721cec83805c3.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e2aa7caaf3bb416c8ecf95dae86ed28ax600x1199.JPEG"
    ]
  },
  {
    "text": "The knee deformity shown below is called as _____",
    "choices": [
      {
        "id": 1,
        "text": "Genu recurvatum"
      },
      {
        "id": 2,
        "text": "Genu varus"
      },
      {
        "id": 3,
        "text": "Genu valgum"
      },
      {
        "id": 4,
        "text": "Windswept deformity"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The deformity shown is <strong>genu valgum</strong>.</p>\n<p>A normal knee has 5-7 degrees physiological outward deviation. Any increase or decrease in angle can result in knee deformities.&nbsp;</p>\n<p>Knee deformities are:</p>\n<ul>\n<li><strong>Genu valgus (valgum)</strong>&nbsp;or <strong>knock knee</strong> - Knees are abnormally approximated and the ankles are divergent.</li>\n<li><strong>Genu varus (varum)</strong>&nbsp;or <strong>bow knee</strong> -&nbsp;Knees are abnormally divergent &nbsp;and the ankles are approximated.</li>\n<li><strong>Windswept deformity</strong> - Abnormal valgus deformity of one knee with varus of the other.</li>\n<li><strong>Genu recurvatum</strong> - Hyperextension at knee joint, knee bends backwards.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/80dd2709b89145b6befd99162f8c64de.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/cf09b0be7dd94b558cde45468ebf3944x1280x2560.JPEG"
    ]
  },
  {
    "text": "ECG of a patient who presented with palpitations to the ER is shown below. Which of the following is a likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Sinus tachycardia"
      },
      {
        "id": 2,
        "text": "Ventricular tachycardia"
      },
      {
        "id": 3,
        "text": "Junctional tachycardia"
      },
      {
        "id": 4,
        "text": "Atrial flutter"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The above ECG shows increased heart rate with <strong>wide QRS complexes</strong> (&gt; 0.12s). This is suggestive of<strong> ventricular tachycardia </strong>(VT).<strong>&nbsp;</strong></p>\n<p>Types of ventricular tachycardia based on QRS morphology:</p>\n<ul>\n<li><strong>Monomorphic</strong><span class=\"term-highlight\">-</span>&nbsp;a stable QRS morphology from beat to beat</li>\n<li><strong>Polymorphic</strong><span class=\"term-highlight\">-</span>&nbsp;changing or multiform QRS variance from beat to beat. Torsades de pointes is an example of polymorphic&nbsp;<span class=\"term-highlight\">ventricular</span>&nbsp;<span class=\"term-highlight\">tachycardia.</span></li>\n<li><strong>Bidirectional</strong>-&nbsp;has a beat-to-beat alternation in the QRS frontal plane axis.&nbsp;It is associated with digitalis toxicity or catecholaminergic polymorphic VT.</li>\n</ul>\n<p>The most common cause of VT is <strong>ischemic heart disease</strong>.</p>\n<p><strong>Ventricular tachyarrhythmias&nbsp;</strong>occur due to impulses that originate within the ventricles. These impulses&nbsp;are conducted through the normal ventricular myocardial cells instead of the fast conducting Purkinje system. Hence, they present with wide QRS complexes ( &gt;0.12 sec) on the ECG.</p>\n<p><strong>Supraventricular tachyarrhythmias</strong>&nbsp;occur due to impulses originating above the ventricles. These impulses reach the ventricles through the proper fast conduction pathway resulting in a narrow QRS complex. SVTs are associated with wide QRS in few exceptional conditions like:</p>\n<ul>\n<li style=\"font-weight: 400;\">Conduction block in the left or right bundle branch</li>\n<li style=\"font-weight: 400;\">Activation of ventricles from an accessory pathway- antidromic AVRT</li>\n</ul>\n<p>The given ECG shows wide stable QRS complexes in monomorphic ventricular tachycardia:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/339c7338dd394f2b89d34c19f752bf50.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1666033aa7a642a3affcca26e2a304a1x536x141.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6ceb2466b8dc4f27816de7b23394db97x1280x2006.JPEG"
    ]
  },
  {
    "text": "All of the following are used to assess difficult airway except_____",
    "choices": [
      {
        "id": 1,
        "text": "Thyromental distance"
      },
      {
        "id": 2,
        "text": "ASA classification"
      },
      {
        "id": 3,
        "text": "Mallampati classification"
      },
      {
        "id": 4,
        "text": "Neck circumference"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>ASA classification</strong>&nbsp;is used to <strong>quantify patient risk for anesthesia </strong>and not difficult airway</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The spinal cord develops from the______.",
    "choices": [
      {
        "id": 1,
        "text": "Neural tube"
      },
      {
        "id": 2,
        "text": "Notochord"
      },
      {
        "id": 3,
        "text": "Primitive streak"
      },
      {
        "id": 4,
        "text": "Rhombencephalon"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The<strong> spinal cord</strong> develops from the <strong>caudal part</strong> of the <strong>neural tube</strong>.</p>\n<p>The nervous system develops from the neurectoderm, the specialized ectoderm overlying the notochord. The neuroectoderm initially thickens to form the neural plate. The neural plate is then converted to a neural groove, followed by a neural tube.</p>\n<ul>\n<li>The <strong>enlarged cranial part</strong> of <strong>neural tube</strong> forms the&nbsp;<strong>brain</strong>. It has 3 primary vesicles that form forebrain (<strong>prosencephalon</strong>), midbrain (<strong>mesencephalon</strong>), and hindbrain (<strong>rhombencephalon</strong>).&nbsp;</li>\n<li>The <strong>narrow caudal part</strong> of the <strong>neural tube</strong> forms the&nbsp;<strong>spinal cord</strong>.&nbsp;&nbsp;</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://cdn1.dailyrounds.org/uploads/feed6fb23fa3410ebf3facb5d7b05954x651x525.JPEG"
    ]
  },
  {
    "text": "Dutcher bodies are seen in_____.",
    "choices": [
      {
        "id": 1,
        "text": "CML"
      },
      {
        "id": 2,
        "text": "AML"
      },
      {
        "id": 3,
        "text": "Multiple Myeloma"
      },
      {
        "id": 4,
        "text": "Hodgkin lymphoma"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Dutcher bodies are pale-staining intranuclear inclusions within plasma cells containing Ig, which are more common in IgA myeloma.</p>\n<ul>\n<li><strong>Russell bodies</strong>: Hyaline intracytoplasmic inclusions containing Ig.</li>\n<li><strong>Mott cells/morula cells</strong>: Plasma cells containing multiple grape-like cytoplasmic inclusions comprised of Ig</li>\n<li><strong>Flame cells</strong>: Vermillion-staining, glycogen-rich IgA in cytoplasmic projections</li>\n<li><strong>Thesaurocytes</strong>: Dilated endoplasmic reticulum cisternae</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://cdn1.dailyrounds.org/uploads/6649bdfd86a64c3f9b04adec3b196063x387x272.PNG"
    ]
  },
  {
    "text": "Wernicke-Korsakoff psychosis is seen due to the deficiency of ______.",
    "choices": [
      {
        "id": 1,
        "text": "Pyridoxine"
      },
      {
        "id": 2,
        "text": "Riboflavin"
      },
      {
        "id": 3,
        "text": "Thiamine"
      },
      {
        "id": 4,
        "text": "Biotin"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p class=\"p1\">Wernicke-Korsakoff psychosis is seen due to the deficiency of <strong>thiamine</strong>. Thiamine is a cofactor for several important enzymes and is also involved in the conduction of the axon potential and synaptic transmission.</p>\n<p class=\"p1\"><strong>Wernicke's encephalopathy/</strong><span class=\"s1\"><strong>alcoholic encephalopathy</strong> </span>is an <strong>acute</strong> neurological disorder.</p>\n<p class=\"p1\">The triad of symptoms seen is (GOA):</p>\n<ul>\n<li><strong>G</strong>lobal Confusion</li>\n<li><strong>O</strong>phthalmoplegia ( first symptom to improve with thiamine +dextrose infusion)</li>\n<li><strong>A</strong>taxia</li>\n</ul>\n<p><strong>Treatment</strong></p>\n<p>It is a <strong>medical emergency</strong> and requires immediate administration of<strong> thiamine 100 mg IV or IM</strong> for 3 days followed by two to three times a day orally for 1 to 2 weeks.</p>\n<div class=\"page\" title=\"Page 2127\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Glucose infusions may precipitate Wernicke&rsquo;s disease in a previously unaffected patient or cause a rapid worsening of an early form of the disease. For this reason, thiamine should be administered to all alcoholic patients requiring parenteral glucose.</p>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is seen in marasmus and not in kwashiorkor?",
    "choices": [
      {
        "id": 1,
        "text": "Fatty change in liver"
      },
      {
        "id": 2,
        "text": "Voracious appetite"
      },
      {
        "id": 3,
        "text": "Hypoalbuminemia"
      },
      {
        "id": 4,
        "text": "Edema"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<ul>\n<li>Children with <strong>marasmus</strong>&nbsp;have<strong>&nbsp;a&nbsp;voracious&nbsp;appetite,</strong> whereas children with <strong>kwashiorkor</strong> often <strong>refuse to eat</strong>.</li>\n<li><strong>Hypoalbuminemia</strong> is seen in&nbsp;<strong>kwashiorkor,</strong> which leads&nbsp;to edema.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 45-year-old male patient who presented with a scrotal swelling underwent an orchidectomy. The image below shows the histopathology findings. What is your diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Seminoma"
      },
      {
        "id": 2,
        "text": "Yolk-sac tumor"
      },
      {
        "id": 3,
        "text": "Embryonal cell carcinoma"
      },
      {
        "id": 4,
        "text": "Teratoma"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Based on the gross and microscopic appearance of the specimen, the diagnosis is <strong>seminoma</strong>.</p>\n<p>The gross specimen shows a well-circumscribed, pale, <strong>gray-white, fleshy</strong>, homogenous mass, with a&nbsp;<strong>lobulated cut surface</strong>, usually devoid of hemorrhage or necrosis.&nbsp;Histopathology shows <strong>uniform tumor cells</strong> with abundant <strong>clear cytoplasm</strong>, distinct cell borders, and <strong>large central nuclei</strong>.&nbsp;There is a sparse lymphocytic infiltrate. Classically, they have a fried egg appearance.</p>\n<p>Option B: <strong>Yolk-sac tumor</strong> has a <strong>yellowish-white, mucinous</strong> appearance.</p>\n<p>Option C: <strong>Embryonal cell carcinoma</strong> appears <strong>variegated</strong> with foci of <strong>hemorrhage</strong> or <strong>necrosis.</strong></p>\n<p>Option D: <strong>Teratomas</strong> also have a <strong>variegated</strong> appearance but have <strong>cysts</strong> reflecting the<strong> multiplicity of tissue types</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/5130cfe866aa458ab55ba0efeb8fb393.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "What is the single most important galactopoetic hormone in post-natal women?",
    "choices": [
      {
        "id": 1,
        "text": "Oxytocin"
      },
      {
        "id": 2,
        "text": "Prolactin"
      },
      {
        "id": 3,
        "text": "Estrogen"
      },
      {
        "id": 4,
        "text": "Progesterone"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Prolactin </strong>is the&nbsp;single most important galactopoietic hormone in postnatal women.</p>\n<table style=\"height: 321px;\" width=\"393\">\n<tbody>\n<tr>\n<td style=\"width: 108.640625px;\"><strong>Function</strong></td>\n<td style=\"width: 132.984375px;\"><strong>Definition</strong></td>\n<td style=\"width: 129.390625px;\"><strong>Hormone</strong></td>\n</tr>\n<tr>\n<td style=\"width: 108.640625px;\">Mammogenesis</td>\n<td style=\"width: 132.984375px;\">Breast growth and development</td>\n<td style=\"width: 129.390625px;\">\n<p>Estrogen (ductal growth)</p>\n<p>Progesterone (alveolar growth)</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 108.640625px;\">Lactogenesis</td>\n<td style=\"width: 132.984375px;\">Initiation of milk secretion</td>\n<td style=\"width: 129.390625px;\">Prolactin</td>\n</tr>\n<tr>\n<td style=\"width: 108.640625px;\">Galactokinesis</td>\n<td style=\"width: 132.984375px;\">Ejection of milk</td>\n<td style=\"width: 129.390625px;\">Oxytocin</td>\n</tr>\n<tr>\n<td style=\"width: 108.640625px;\">Galactopoiesis</td>\n<td style=\"width: 132.984375px;\">Maintainence of lactation</td>\n<td style=\"width: 129.390625px;\">Prolactin</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A child on beta 2 agonists for the treatment of bronchial asthma may exhibit all of the following except:",
    "choices": [
      {
        "id": 1,
        "text": "Tremors"
      },
      {
        "id": 2,
        "text": "Hypoglycemia"
      },
      {
        "id": 3,
        "text": "Hypokalemia"
      },
      {
        "id": 4,
        "text": "Tachycardia"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>\u03b2<sub>2</sub> agonists </strong>are associated with <strong>hyperglycemia </strong>probably due to \u03b2<sub>2</sub> receptor-mediated <strong>glycogenolysis and glucagon release.</strong></p>\n<p>Adverse effects of beta 2 agonists are</p>\n<ul>\n<li><strong>Muscle tremors</strong>: Direct effect on beta 2 receptors in skeletal muscles and due to hypokalemia</li>\n<li><strong>Tachycardia</strong>: Direct effect on cardiac beta 2 receptors, indirect sympathetic stimulation due to vasodilator action on beta 2 receptors</li>\n<li><strong>Hypokalemia</strong>: Direct effect on skeletal muscle uptake of K<sup>+</sup>\u00a0ions</li>\n<li>Hypoxemia</li>\n<li>Hyperglycaemia</li>\n<li>Hyperlipidemia</li>\n<li>Tolerance: Desensitization on long-term use</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 30-year-old woman has a resting heart rate of 70-beats/min. The pressure-volume diagram of her left ventricle is given below. What is her cardiac output (in mL/min)? (Point 2 corresponds to 120 ml)",
    "choices": [
      {
        "id": 1,
        "text": "2000"
      },
      {
        "id": 2,
        "text": "3000"
      },
      {
        "id": 3,
        "text": "4900"
      },
      {
        "id": 4,
        "text": "7000"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In this case, the patient has a heart rate of 70-beats/min and the stroke volume can be determined from the given pressure-volume diagram.</p>\n<p>Point 2 corresponds to the EDV(End diastolic volume) = 120 mL<br />Point 1 corresponds to the ESV(End systolic volume) = 50 mL</p>\n<p>Thus, stroke volume (SV) = EDV &ndash; ESV = 120 &ndash; 50 = 70 mL</p>\n<p>Therefore, Cardiac output = HR X SV = 70 X 70 = <strong>4900 mL/min.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b7e4d1cf77aa47d0bf488cdb7a12bead.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/415139051d4247749f1718b3aae342ccx1280x1425.JPEG"
    ]
  },
  {
    "text": "Best investigation for pulmonary embolism _____",
    "choices": [
      {
        "id": 1,
        "text": "MRI"
      },
      {
        "id": 2,
        "text": "V/Q scan"
      },
      {
        "id": 3,
        "text": "Plain CT"
      },
      {
        "id": 4,
        "text": "CT angiography"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Pulmonary CT angiography /MDCT is the best investigation for pulmonary embolism. The dye is injected through the intravenous route.</p>\n<p>The below figure is a&nbsp;CT angiography demonstrating multiple filling defects both at the bifurcation (<strong>saddle pulmonary embolism</strong>) and in the pulmonary arteries.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/509754532eee4cf8850c57e0593602d3x1024x806.PNG"
    ]
  },
  {
    "text": "The external validity of a screening test is related to?",
    "choices": [
      {
        "id": 1,
        "text": "Stability"
      },
      {
        "id": 2,
        "text": "Objectivity"
      },
      {
        "id": 3,
        "text": "Generalizability"
      },
      {
        "id": 4,
        "text": "Repeatability"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>External validity</strong> of a screening test is related to <strong>generalizability</strong>.</p>\n<p><strong>Validity (accuracy)&nbsp;</strong>refers to what extent the test accurately measures which it sets out to measure.&nbsp;It refers to the<strong>&nbsp;closeness</strong>&nbsp;with which measured values agree with&nbsp;<strong>\"true\" values.&nbsp;</strong></p>\n<p class=\"p1\">While assessing the validity of a research study, two kinds of validity are involved:</p>\n<ul>\n<li class=\"p1\"><strong>External validity</strong>: If the study sample is truly representative of the population from which it was drawn, then the study is said to have external validity. Its findings can be applied to the entire population&nbsp;as well and therefore it is said to be <strong>generalizable.</strong></li>\n<li><strong>Internal validity</strong>: Here the results of the study are valid&nbsp;for the sample of patients who were actually studied.</li>\n</ul>\n<p>Note:<strong>&nbsp;</strong><strong>Precision</strong>&nbsp;(reliability or reproducibility) is a measure of the&nbsp;<strong>repeatability</strong>&nbsp;of a test. That is, the test must give consistent results when repeated more than once on the same individual or material, under the same conditions.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 56-year-old man chronic smoker presented with flecks of blood in his sputum. He is currently on treatment for COPD and hypertension. His BMI is 31 kg/m\u00b2 and he has central obesity. His RBS is 261 mg/dl. During further evaluation, he is found to have high ACTH levels that remained high even after administration of high-dose dexamethasone. What is the underlying cause of this patient's symptoms?",
    "choices": [
      {
        "id": 1,
        "text": "Exogenous steroid intake"
      },
      {
        "id": 2,
        "text": "Pituitary adenoma"
      },
      {
        "id": 3,
        "text": "Adrenal cortical adenoma"
      },
      {
        "id": 4,
        "text": "Ectopic ACTH-secreting tumor"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Elevated ACTH levels that do not get suppressed by a high-dose dexamethasone test are suggestive of <strong>Cushing&rsquo;s</strong> <strong>syndrome</strong> secondary to an <strong>ectopic</strong> <strong>ACTH-secreting</strong>&nbsp;tumor. Considering the patient's smoking history and presentation with hemoptysis, it is likely to be a lung tumor.</p>\n<table style=\"height: 478px; width: 272px;\">\n<tbody>\n<tr style=\"height: 20px;\">\n<td style=\"width: 298.141px; text-align: center; height: 20px;\" colspan=\"3\"><strong>Dynamic testing for Cushing&rsquo;s syndrome</strong></td>\n</tr>\n<tr style=\"height: 54px;\">\n<td style=\"width: 72.1875px; height: 54px;\">&nbsp;</td>\n<td style=\"width: 124.812px; height: 54px;\"><strong>High dose dexamethasone suppression test</strong></td>\n<td style=\"width: 89.1406px; height: 54px;\"><strong>CRH stimulation test</strong></td>\n</tr>\n<tr style=\"height: 54px;\">\n<td style=\"width: 72.1875px; height: 54px;\"><strong>Pituitary adenoma</strong></td>\n<td style=\"width: 124.812px; height: 54px;\">Positive (suppressed cortisol)</td>\n<td style=\"width: 89.1406px; height: 54px;\">Positive (increase in ACTH and cortisol)</td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 72.1875px; height: 18px;\"><strong>Ectopic ACTH</strong></td>\n<td style=\"width: 124.812px; height: 18px;\"><strong>Negative</strong></td>\n<td style=\"width: 89.1406px; height: 18px;\"><strong>Negative</strong></td>\n</tr>\n<tr style=\"height: 36px;\">\n<td style=\"width: 298.141px; height: 36px;\" colspan=\"3\"><strong>Iatrogenic</strong>: Suppressed ACTH levels that are not affected by dynamic testing</td>\n</tr>\n<tr style=\"height: 36px;\">\n<td style=\"width: 298.141px; height: 36px;\" colspan=\"3\"><strong>Adrenal</strong> mass or hyperplasia:&nbsp; Suppressed ACTH levels that are not affected by dynamic testing</td>\n</tr>\n</tbody>\n</table>\n<p>Ectopic sources of ACTH include <strong>small cell lung cancers </strong>and<strong> pulmonary carcinoid&nbsp;</strong>tumors. The most effective treatment strategy is the management of the underlying SCLC or carcinoid.&nbsp;</p>\n<p>Option A: <strong>Exogenous steroid</strong> administration&nbsp;presents with suppressed ACTH levels.</p>\n<p>Option B: <strong>Pituitary adenoma</strong> presents with elevated ACTH but a high-dose dexamethasone suppression test is positive (suppressed).</p>\n<p>Option C: <strong>Adrenal adenoma</strong> presents with suppressed ACTH levels.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Symptoms of sinusitis includes all except",
    "choices": [
      {
        "id": 1,
        "text": "Headache"
      },
      {
        "id": 2,
        "text": "Nasal blockage"
      },
      {
        "id": 3,
        "text": "Diplopia"
      },
      {
        "id": 4,
        "text": "Nasal discharge"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Diplopia</strong> is <strong>not seen</strong> in sinusitis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An 8 month-old baby is brought to the pediatric clinic with symptoms of diarrhea, hair loss and failure to thrive. On clinical examination, there is inflammation of the skin around the mouth and the perianal region. The mineral deficiency responsible for this disease is?",
    "choices": [
      {
        "id": 1,
        "text": "Zinc"
      },
      {
        "id": 2,
        "text": "Selenium"
      },
      {
        "id": 3,
        "text": "Chromium"
      },
      {
        "id": 4,
        "text": "Copper"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The symptoms and clinical findings, strongly suggest a diagnosis of&nbsp;<strong>Acrodermatitis enteropathica</strong> which is due to the <strong>deficiency of zinc.</strong></p>\n<p>It is an autosomal recessive disease due to a defect in <strong>zinc absorbing transmembrane protein.</strong></p>\n<p><strong>Symptoms:</strong></p>\n<ul>\n<li>Growth retardation</li>\n<li>Diarrhea</li>\n<li>Alopecia</li>\n<li>Rash involving the extremities, face, and perineum(rash is characterized by <strong>vesicular</strong> and <strong>pustular crusting </strong>with scaling and erythema)</li>\n<li>Gonadal atrophy</li>\n<li>Muscle wasting</li>\n<li>Impaired wound healing</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/31b2498bd4ef4579a913c4cd72c86a30x428x521.PNG"
    ]
  }
];
        let quizName = 'Fmge Mini Test - 3';
        const quizFilename = 'fmge-mini-test-3-04b7518f.html';
        let hierarchy = ["Marrow", "FMGE Mini Test Series", "2024"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>