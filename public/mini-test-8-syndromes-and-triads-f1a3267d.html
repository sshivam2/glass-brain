<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini Test- 8 (Syndromes And Triads) - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / FMGE Mini Test Series / 2024
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following statements about the chromosomal abnormality identified in the karyotype is incorrect?",
    "choices": [
      {
        "id": 1,
        "text": "Low set ears"
      },
      {
        "id": 2,
        "text": "Closed fist with overlapping of fingers"
      },
      {
        "id": 3,
        "text": "AFP and uE3 are increased and Beta hCG is reduced"
      },
      {
        "id": 4,
        "text": "AFP, uE3 and Beta hCG are reduced"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The chromosomal abnormality based on the given karyotype is <strong>Edward's syndrome</strong>.</p>\n<p>The karyotype given is <strong>trisomy 18</strong> and is suggestive of <strong>Edward's syndrome</strong>. The clinical features include micrognathia,<strong> low-set ears</strong> (Option A), prominent occiput, and<strong> rocker bottom feet. </strong>Prenatal ultrasound reveals fetal growth restriction and all the 3 markers, <strong>AFP, uE3</strong> and<strong> BetahCG</strong> are <strong>reduced </strong>(Option D) in Edward's syndrome.</p>\n<p>Other features include a <strong>clenched fist with overriding fingers </strong>(Option B), i.e. index finger overlapping the third and 5th finger overlapping the 4th, small fingernails, underdeveloped thumbs, short sternum, and club feet.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c9c859de807b4b3993d0d4c3dc2719ad.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a569431e985149fcb0b9f0df821c4e2fx1200x1751.JPEG"
    ]
  },
  {
    "text": "A 3-year-old female is brought to OPD with features of hand wringing stereotyped movements, impaired language and communication development, breath-holding spells and deceleration of head growth after 6 months of age. Which of the following genes is associated with the above disease?",
    "choices": [
      {
        "id": 1,
        "text": "AST-1 gene"
      },
      {
        "id": 2,
        "text": "MRCP-9 gene"
      },
      {
        "id": 3,
        "text": "MECP-2  gene"
      },
      {
        "id": 4,
        "text": "RET- 2 gene"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario of a 3-year-old female with normal psychomotor development until 6 months followed by <strong>regression</strong> in development, <strong>stereotyped movements</strong> and <strong>microcephaly</strong> is suggestive of <strong>Rett syndrome.</strong> The gene associated with Rett syndrome is the\u00a0<strong>MECP-2 gene</strong>.</p>\n<p><strong>Rett syndrome</strong> is a progressive condition predominantly seen in <strong>girls</strong>. It has an <strong>X-linked dominant</strong> pattern of inheritance. The onset is <strong>after a few months</strong> of apparently normal development. Under the international classification of diseases, the tenth revision it falls under pervasive development disorder. The Diagnostic and statistical manual, 5th Edition (DSM-5) considers it an <strong>autism spectrum disorder,</strong> though there are marked differences between them.</p>\n<p>Between the ages of <strong>6 months to 2 years</strong>, affected children develop progressive encephalopathy. Other clinical features include <strong>stereotypic hand movements</strong> such as hand wringing, biting, or licking the fingers, and poor muscle coordination. Marked regression of all language skills and plateaued communicative and social skills can also be seen. <strong>Microcephaly </strong>develops as age progresses. Head circumference is normal at birth, but between the age of 6 months to 1 year, growth begins to decelerate. Seizures are an associated feature in a large number of cases.\u00a0</p>\n<p>Supportive treatment is given. Physiotherapy is beneficial for muscular dysfunction. Anticonvulsants may be required to control seizures.</p>\n<p><strong>Trofinetide</strong> is a synthetic analogue of the amino\u2010terminal tripeptide of insulin-like growth factor (IGF-1) designed to treat the core symptoms of Rett syndrome by potentially reducing neuroinflammation and supporting the synaptic function of the protein fragment glypromate (GPE). IGF-1 is produced by both major types of brain cells \u2013 neurons and glia; IGF-1 in the brain is critical for both normal development and response to injury and disease. Trofinetide has been shown to inhibit the production of inflammatory cytokines, inhibit overactivation of microglia and astrocytes, and increase the amount of available IGF-1 that can bind to IGF-1 receptors.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 60-year-old woman with a history of cholelithiasis was rushed to the casualty with complaints of vomiting, abdominal distension, and obstipation. Her erect abdomen X-ray is shown below. Which of the following is seen in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Reynold's pentad"
      },
      {
        "id": 2,
        "text": "Rigler's triad"
      },
      {
        "id": 3,
        "text": "Saint's triad"
      },
      {
        "id": 4,
        "text": "Charcot's triad"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario of a 60-year-old female presenting with features of intestinal obstruction with an X-ray showing gas in the biliary tract (<strong>pneumobilia</strong>) and multiple air-fluid levels indicating small bowel obstruction is suggestive of <strong>gallstone ileus. Rigler's triad</strong> is seen in gallstone ileus.</p>\n<p><strong>Gallstone ileus</strong>\u00a0is caused by the obstruction of the intestinal lumen\u00a0by a gallstone, leading to a <strong>mechanical blockage</strong>. Big gallstones will not be able to pass through the normal cystic duct. This causes inflammation of the gallbladder and results in <strong>pressure necrosis</strong>. This in turn leads to <strong>biliary-enteric fistula</strong> formation.</p>\n<p>Plain radiographs demonstrate <strong>air-fluid levels</strong> consistent with a small bowel obstruction.\u00a0<strong>Rigler's triad</strong> is seen in gallstone ileus. It includes:</p>\n<ul>\n<li>Intestinal obstruction</li>\n<li>Gas in the biliary tract (pneumobilia)</li>\n<li>Ectopic gallstone (Radio-opaque shadow in the right iliac fossa)</li>\n</ul>\n<p>The presence of 2/3 of these radiological signs is pathognomonic of gallstone ileus. <strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">Pneumobilia </strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">is seen because the fistula that permitted a stone to pass into the duodenum allows air into the gallbladder and the biliary tree and i</span>s also a common finding following ERCP.</p>\n<p>The investigation of choice is the\u00a0<strong>CT scan. </strong></p>\n<p>Initial management involves keeping the patient nil per-oral, IV fluids, IV antibiotics, and analgesics.\u00a0</p>\n<p>If there is no strangulation or peritonitis, it can be managed by:</p>\n<ul>\n<li><strong>Milking the stone</strong> beyond the ileocaecal junction</li>\n<li>Crushing the stone</li>\n<li><strong>Enterotomy</strong> to remove the stone</li>\n</ul>\n<p>If there is perforation or strangulation, <strong>resection and anastomosis</strong> are done.</p>\n<div class=\"page\" title=\"Page 1533\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Cholecystectomy</strong> and fistula closure is done after 4-6 weeks as the second procedure to avoid future complications.<strong>\u00a0</strong></p>\n</div>\n</div>\n</div>\n</div>\n<p>Given below is a plain X-ray of the erect abdomen showing air in the biliary tract (pneumobilia).</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/bac8b98408cb408abc7eda455d17c257.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1b451cba77094f738f78b2a0e6caa663x527x630.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2c754ee0e6754e3cab693595a2a07819x1280x427.PNG"
    ]
  },
  {
    "text": "A 42-year-old male presents to the surgery OPD with a constellation of features like impotence, buttock claudication, and absence of the femoral pulses. These features are seen in __________",
    "choices": [
      {
        "id": 1,
        "text": "Leigh syndrome"
      },
      {
        "id": 2,
        "text": "Lhermitte's syndrome"
      },
      {
        "id": 3,
        "text": "Lemierre\u2019s syndrome"
      },
      {
        "id": 4,
        "text": "Leriche syndrome"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical scenario is suggestive of\u00a0<strong>Leriche syndrome.</strong></p>\n<p>Leriche syndrome is a rare form of aorto-iliac Occlusive Disease (AIOD) which presents with a triad of <strong>intermittent claudication, erectile dysfunction, and absent femoral pulses. </strong>Obstruction of the<strong>\u00a0superficial femoral artery\u00a0</strong>will cause\u00a0<strong>claudication of the buttock or thigh</strong>. Associated or isolated discomfort of the calf can also be seen because the calf is the most distal large muscle group and is used extensively in walking.</p>\n<p>The other options correspond to sound alike signs/syndromes.</p>\n<p>Option A: <strong>Leigh syndrome: </strong>is an inherited <strong>neurodegenerative</strong> condition. It usually becomes apparent in infancy, often after a viral infection. Early symptoms may include <strong>poor sucking ability;</strong> loss of head control and motor skills; loss of appetite; vomiting; and seizures. As the condition progresses, symptoms may include weakness and lack of muscle tone, spasticity, movement disorders, cerebellar ataxia and peripheral neuropathy.</p>\n<p>Option B:<strong> Lhermitte's sign: Shooting electric shock-like sensations</strong> in the lower extremities when the neck is maximally flexed in patients with <strong>cervical radiculopathy.</strong></p>\n<p>Option C: <strong>Lemierre\u2019s syndrome</strong> is septic <strong>thrombophlebitis</strong> in the internal jugular vein. This is a rare and potentially <strong>fatal</strong> complication of an <strong>oropharyngeal infection.</strong> The organism is typically a fusiform bacillus. Presents with severe neck pain, septicemia, or a prolonged fulminant course in a patient with infection in the upper aerodigestive tract.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 36-year-old female patient presents with symptoms of hyperparathyroidism, pituitary adenoma, and gastrinoma with cutaneous angiofibromas. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "MEN 1"
      },
      {
        "id": 2,
        "text": "MEN 2"
      },
      {
        "id": 3,
        "text": "MEN 3"
      },
      {
        "id": 4,
        "text": "MEN 4"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario suggests a diagnosis of <strong>MEN 1 syndrome</strong>.</p>\n<p><strong>Multiple endocrine neoplasia</strong> (MEN) syndromes are characterized by tumors of two or more endocrine glands. There are <strong>four major types</strong> of MEN (MEN 1&ndash;4), and they either show an <strong>autosomal dominant</strong> pattern of inheritance or occur sporadically.&nbsp;</p>\n<p><strong>MEN 1</strong>,&nbsp;also known as <strong>Wermer&rsquo;s syndrome</strong>,&nbsp;is characterized by the triad of <strong>parathyroid</strong>, <strong>pancreatic islet cell</strong>, and <strong>anterior pituitary&nbsp;</strong><strong>tumors</strong>. Adrenal cortical tumors, carcinoid tumors, facial angiofibromas, collagenomas, thyroid tumors, and lipomas may also occur. MEN 1-associated tumors are usually multiple, larger, and more aggressive, resulting in resistance to treatment and poor patient outcomes.</p>\n<ol>\n<li><strong>Parathyroid tumors-</strong>&nbsp;<strong>primary hyperparathyroidism</strong> is the <strong>most common</strong> feature of MEN 1. <strong>Hypercalcemia</strong> with or without symptoms (polyuria, polydipsia, constipation, dyspepsia), nephrolithiasis, and osteitis fibrosa cystica may also occur.&nbsp;All four parathyroid glands are usually affected with multiple adenomas or hyperplasia.&nbsp;</li>\n<li><strong>Pancreatic islet cell tumors-</strong>&nbsp;these are <strong>neuroendocrine tumors</strong>, including:\n<ul>\n<li><strong>Gastrinoma</strong> (gastrin-secreting tumors)- associated with increased gastric acid secretion and multiple peptic ulcers (Zollinger-Ellison syndrome). Patients may present with diarrhea and steatorrhea. Gastrinomas are the<strong> major cause</strong> of <strong>mortality</strong> and morbidity.&nbsp;</li>\n<li><strong>Insulinoma</strong>&nbsp;(insulin-secreting tumors)- patients present with <strong>hypoglycemic symptoms</strong> (weakness, headaches, sweating, seizures, weight gain) that develop after fasting or exertion and improve after glucose intake. Along with increased plasma insulin levels and hypoglycemia, increased C peptide and proinsulin levels help in diagnosing the condition.</li>\n<li><strong>Glucagonoma</strong>&nbsp;(glucagon-secreting tumors)- may be associated with necrolytic migratory erythema, weight loss, anemia, and stomatitis.&nbsp;</li>\n<li><strong>VIPomas</strong> (Vasoactive intestinal peptide [VIP]-secreting tumors): The VIPoma syndrome, also known as Verner-Morrison syndrome, is characterized by watery diarrhea, hypokalemia, and achlorhydria. These are mostly located in the <strong>tail</strong> of the <strong>pancreas</strong>.</li>\n<li><strong>PPomas</strong> (Pancreatic polypeptide-secreting tumors) and <strong>nonfunctioning pancreatic tumors-</strong>&nbsp;are associated with a <strong>worse prognosis</strong> as they often go undiagnosed due to the absence of both clinical features and biochemical abnormalities.</li>\n</ul>\n</li>\n<li><strong>Pituitary tumors-</strong>&nbsp;manifestations depend on the hormone secreted (symptoms of&nbsp;hyperprolactinemia, acromegaly, or Cushing&rsquo;s disease) and tumor size (visual disturbances or hypopituitarism due to compression of the optic chiasm or normal pituitary tissue).&nbsp;</li>\n</ol>\n<p><strong>Surgical excision</strong> of the nonmetastatic tumor after localization is the <strong>curative treatment</strong>. Appropriate medical therapy can be used for some tumors when surgery is contraindicated or unsuccessful (calcimemetics for parathyroid tumors, parietal cell H<sup>+</sup>-K<sup>+</sup>-ATPase inhibitors for gastrinomas). In case of metastasis, chemotherapy, hormonal therapy, radiation therapy, and artery embolization may be successful.</p>\n<p>MEN 1 occurs due to a mutation in the <em>MEN1&nbsp;</em>gene located on <strong>chromosome 11q13</strong>. Mutational genetic analysis is necessary to confirm the clinical diagnosis and identify family members who harbor the mutation and require screening for tumor detection and early treatment.</p>\n<p>Other options:</p>\n<p>Options B and C: <strong>MEN 2</strong>, also called <strong>Sipple&rsquo;s syndrome</strong>, is characterized by medullary thyroid carcinoma (MTC), pheochromocytomas, and parathyroid tumors. This occurs due to mutations of the <strong>rearranged during transfection (RET) protooncogene</strong>. There are three clinical variants -</p>\n<ol>\n<li><strong>MEN 2A</strong> (most common): MTC is associated with pheochromocytomas in 50% of patients and parathyroid tumors in 20% of patients. MEN 2A may also be associated with Hirschsprung&rsquo;s disease and cutaneous lichen amyloidosis.</li>\n<li>MEN 2B<strong>&nbsp;(MEN</strong> <strong>3</strong>): MTC is associated with pheochromocytoma, along with Marfanoid habitus; mucosal neuromas of the lips, tongue, and eyelids; medullated corneal fibers; and intestinal autonomic ganglion dysfunction leading to multiple diverticulae and megacolon. Parathyroid tumors are usually absent.</li>\n<li><strong>MTC only </strong>(FMTC): MTC is the only manifestation.</li>\n</ol>\n<p>Option D:&nbsp;<strong>MEN 4&nbsp;</strong>is characterized by a combination of&nbsp;<strong>MEN 1&ndash;associated tumors</strong> and&nbsp;<strong><em>CDKN1B</em> mutation-related tumors</strong>&nbsp;(gonadal, adrenal, renal, and thyroid tumors).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A newborn presents with anuria, and further evaluation reveals renal agenesis and pulmonary hypoplasia. There is also a history of oligohydramnios. The most probable diagnosis is _________",
    "choices": [
      {
        "id": 1,
        "text": "Potter syndrome"
      },
      {
        "id": 2,
        "text": "Pierre robin syndrome"
      },
      {
        "id": 3,
        "text": "Downs syndrome"
      },
      {
        "id": 4,
        "text": "CHARGE syndrome"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario is suggestive of <strong>Potter syndrome.</strong></p>\n<p><strong>Potter syndrome</strong> is characterized by the triad of :</p>\n<ul>\n<li><strong>Renal agenesis</strong></li>\n<li><strong>Oligohydramnios</strong></li>\n<li><strong>Pulmonary hypoplasia</strong></li>\n</ul>\n<p>Due to oligohydramnios and small uterine cavity, they also have facial dysmorphisms and limb deformities.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://cdn1.dailyrounds.org/uploads/b8da2ec06ab241f1a1da49411aacf3c8x579x366.PNG"
    ]
  },
  {
    "text": "A 3-day-old infant is brought with a rash. On examination, chorioretinitis, hepatosplenomegaly, and hemorrhagic purpuric eruptions are noted, with no cardiovascular abnormality. CT head shows the following image. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Congenital rubella syndrome"
      },
      {
        "id": 2,
        "text": "Congenital syphilis"
      },
      {
        "id": 3,
        "text": "Congenital toxoplasmosis"
      },
      {
        "id": 4,
        "text": "Congenital cytomegalovirus infection"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The most likely diagnosis in this infant with <strong>periventricular calcifications </strong>and&nbsp;<strong>ventriculomegaly</strong>&nbsp;is <strong>congenital cytomegalovirus</strong>&nbsp;(<strong>CMV</strong>) <strong>infection.</strong></p>\n<p>CMV is the most common congenital infection. The clinical manifestations are hepatosplenomegaly, <strong>petechial</strong> <strong>rashes</strong>, <strong>jaundice</strong>, <strong>chorioretinitis</strong>, and microcephaly. One of the long-term sequelae is <strong>sensorineural hearing loss.</strong></p>\n<p>Diagnosis can be made by&nbsp;the presence of <strong>IgM antibodies</strong> in the fetal blood. Isolation of the virus from the <strong>urine</strong> or<strong> blood</strong>&nbsp;by&nbsp;<strong>PCR</strong>&nbsp;is more sensitive.</p>\n<p>There is no definitive treatment for congenital CMV infection. Treatment with<strong>&nbsp;ganciclovir </strong>is<strong>&nbsp;</strong>indicated only in patients with progressive neurologic disease and deafness.&nbsp;Below is the image showing the <strong>blueberry muffin baby.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/de7b23fb05b14324ae8f70a4bdf78e29.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8190e65c717840348c7b48bad4f5ed3ex237x212.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/16aac49f53864dde8b4d6c119c4619b2x324x256.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a4a2e973c2fd4b7ca21b1c5df3f75031x640x488.JPEG"
    ]
  },
  {
    "text": "A patient with a history of viral fever presents with symptoms and is diagnosed with an acquired nerve disease, which is a variant of Guillain-Barr\u00e9 syndrome. All of the following symptoms are part of its triad except?",
    "choices": [
      {
        "id": 1,
        "text": "Ataxia"
      },
      {
        "id": 2,
        "text": "Weakness"
      },
      {
        "id": 3,
        "text": "Areflexia"
      },
      {
        "id": 4,
        "text": "Ophthalmoplegia"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Weakness is not seen in the triad of <strong>Miller-Fisher syndrome</strong> (MFS)</p>\n<p><strong>Miller Fisher syndrome </strong>is an acquired nerve disease that is considered to be a <strong>variant of Guillain-Barr\u00e9 syndrome</strong>. Like Guillain-Barr\u00e9 syndrome, symptoms may be preceded by a viral illness.</p>\n<p>Classically presents as a <strong>triad</strong> of: <strong>Ataxia, Areflexia </strong>and<strong> Ophthalmoplegia. </strong>The condition is usually <strong>not associated with weakness</strong>, if present, is very mild. It is strongly associated with antibodies to the ganglioside.</p>\n<p>The <strong>prognosis</strong> for most individuals with Miller Fisher syndrome is <strong>good</strong>. In most cases, recovery begins within <strong>2 to 4 weeks</strong> of the onset of symptoms, and may be almost complete within 6 months. Some individuals are left with residual deficits. Relapses may occur rarely.</p>\n<p><strong>Treatment</strong> for Miller Fisher syndrome is identical to treatment for Guillain-Barr\u00e9 syndrome: <strong>intravenous immunoglobulin (IVIg) or plasmapheresis</strong> and supportive care.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 39-year-old woman presents with severe chest pain that began the previous night. She reports binge drinking at a party, followed by several episodes of vomiting, some of which were mixed with blood. On examination, she appears unwell, has rapid breathing, a blood pressure of 90/50 mm Hg, a heart rate of 112/min, and palpable crepitus. An X-ray was performed and is shown below. What is the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Pneumothorax"
      },
      {
        "id": 2,
        "text": "Boerhaave's syndrome"
      },
      {
        "id": 3,
        "text": "Acute chest syndrome"
      },
      {
        "id": 4,
        "text": "Mallory-Weiss tear"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The clinical scenario described, featuring a <strong>triad </strong>of symptoms including recurrent episodes of <strong>vomiting</strong> with blood, along with new onset<strong> chest pain</strong> and <strong>palpable crepitus</strong>, and an X-ray revealing pneumomediastinum, is indicative of <strong>Boerhaave\u2019s Syndrome</strong>.<br />\u00a0<br /><strong>Boerhaave's syndrome</strong> is a transmural perforation of the esophagus (while Mallory Weiss's tear is a mucosal tear). It generally occurs due to forceful vomiting against a closed glottis. It clinically presents with classical<strong> Mackler's triad </strong>of <strong>vomiting, chest pain </strong>and<strong> subcutaneous emphysema</strong>. The lower esophagus towards the left pleural cavity is the most common perforation site. A crunching sound is heard during the auscultation of the chest <strong>(Hamman's sign)</strong> due to <strong>subcutaneous emphysema.</strong></p>\n<p>The diagnosis is made by <strong>contrast esophagogram(iohexol</strong>) in <strong>unstable</strong> patients or <strong>contrast-enhanced CT scan</strong>, in <strong>stable</strong> patients.</p>\n<p><strong>Treatment</strong> includes <strong>primary closure within 12 hours</strong> of the injury for a better prognosis. If the patient is unstable or presents late, the perforated part is resected, and a<strong> cervical</strong> <strong>esophagostomy</strong> is performed. A T-tube is placed into the esophagus along with appropriately located drains and a feeding jejunostomy or gastrostomy is performed for nutrition.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/57c5f06115e4442b89b7a26e2c2f36a2.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/14180bb7857646e7b5d61e144d928d18x720x557.JPEG"
    ]
  },
  {
    "text": "A patient presented with weakness of the right side of the face with the loss of pain and temperature. Pain and temperature sensation of the left leg is also lost. The lesion is most likely located at?",
    "choices": [
      {
        "id": 1,
        "text": "Medial medulla"
      },
      {
        "id": 2,
        "text": "Lateral pons"
      },
      {
        "id": 3,
        "text": "Medial pons"
      },
      {
        "id": 4,
        "text": "Lateral medulla"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The above clinical scenario is suggestive of <strong>lateral pontine syndrome</strong> which occurs due to a lesion located at<strong> lateral pons.</strong></p>\n<p><strong>Lateral pontine syndrome</strong> occurs due to the involvement of the <strong>anterior inferior cerebellar artery.</strong></p>\n<ul>\n<li>Ipsilateral manifestations include:\n<ul>\n<li>CN VII: Facial paralysis\u00a0</li>\n<li>CN V:\u00a0loss of pain and temperature sensation over the face.</li>\n<li>Vestibular nerve or nucleus:\u00a0Horizontal and vertical nystagmus, vertigo, nausea, vomiting, oscillopsia.</li>\n<li>Auditory nerve or cochlear nucleus:\u00a0Deafness, tinnitus.</li>\n<li>Middle cerebellar peduncle:\u00a0Ataxia of limb and gait.</li>\n</ul>\n</li>\n</ul>\n<ul>\n<li>Contralateral manifestations include:\n<ul>\n<li>Spinothalamic tract: Loss of\u00a0pain and temperature sensation over the body.</li>\n</ul>\n</li>\n</ul>\n<p>\u00a0Note:</p>\n<p>In this clinical vignette, due to the absence of characteristic features specific to lateral medullary syndrome, like <strong>dysphagia</strong> and<strong> hoarseness of voice</strong> (involvement of <strong>9<sup>th</sup></strong> and <strong>10<sup>th</sup> cranial nerves</strong>), the lesion is most likely to be located at <strong>lateral pons (lateral pontine syndrome)</strong> and not lateral medulla.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 10-month-old female baby with an abdominal mass is diagnosed with Wilm's tumor. On examination, the following findings are seen in the baby. What is the possible diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "WAGR syndrome"
      },
      {
        "id": 2,
        "text": "Sturge-Weber syndrome"
      },
      {
        "id": 3,
        "text": "Denys\u2013Drash syndrome"
      },
      {
        "id": 4,
        "text": "Beckwith-Wiedemann syndrome"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given images <strong>\u00a0</strong>show <strong>macroglossia</strong> and <strong>omphalocele </strong>which when considered with the<strong> Wilm's tumor </strong>points to the diagnosis of <strong>Beckwith-Wiedemann syndrome.</strong></p>\n<p>Beckwith-Wiedemann syndrome<strong>\u00a0</strong>is an example of a\u00a0disorder of genomic imprinting. The genetic locus that is involved in these patients is in <strong>chromosome 11</strong> (band p15.5) distal to the <strong>WT1 locus</strong>.<strong>\u00a0</strong>It is\u00a0characterized by-</p>\n<ul>\n<li>Neonatal hypoglycemia</li>\n<li>Macrosomia</li>\n<li><strong>Macroglossia</strong></li>\n<li><strong>Hemihyperplasia</strong></li>\n<li><strong>Omphalocele</strong></li>\n<li>Visceromegaly</li>\n<li>Embryonal tumors such as <strong>Wilms tumor</strong>, hepatoblastoma, rhabdomyosarcoma, and neuroblastoma.</li>\n</ul>\n<p><strong>Wilm's tumor</strong>\u00a0is the most common renal neoplasm of childhood. Clinically, the most common finding is an <strong>asymptomatic abdominal mass</strong>. Other presentations of Wilm's tumor include <strong>hematuria</strong>, <strong>hypertension,</strong> fever, weight loss, and tumor rupture causing acute abdomen. The most common site of metastasis of Wilms tumor is the <strong>lungs</strong>.</p>\n<p>On microscopy, the classic triphasic combination of <strong>blastemal</strong> (small, round blue cells), <strong>stromal</strong>, and <strong>epithelial</strong> cell types is observed in most lesions, although the percentage of each component is variable. Nephrogenic rests are precursor lesions of Wilms tumors.\u00a0</p>\n<p>The below image shows<strong> macroglossia </strong>seen in a baby diagnosed with\u00a0Beckwith-Wiedemann syndrome.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/768ee426e5434d04ac7c388927afe9f7.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/29a541d20c3649e0889fa3eda2a39ecax720x498.JPEG"
    ]
  },
  {
    "text": "Which of the following structures are involved in the unhappy triad?",
    "choices": [
      {
        "id": 1,
        "text": "A, D, E"
      },
      {
        "id": 2,
        "text": "D, E, F"
      },
      {
        "id": 3,
        "text": "A, B, C"
      },
      {
        "id": 4,
        "text": "C, D, E"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The <strong>unhappy triad of O&rsquo;Donoghue </strong>consists of<strong>&nbsp;</strong>injury to</p>\n<ul>\n<li><strong>Anterior cruciate ligament (A)</strong></li>\n<li><strong>Medial collateral ligament (B)</strong></li>\n<li><strong>Medial meniscus (C)</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/1987a6f22e0240deb4142c565b0ec9f0.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/87dabdf789f04fb7b2605b7c7bd5649cx600x688.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3a26050a1a0b4eda9f47b902a8796838x1280x1354.JPEG"
    ]
  },
  {
    "text": "A 4-year-old female child is currently under evaluation for supra-valvular aortic stenosis and mental retardation. A characteristic facies is present as shown in the image below. Her karyotype reveals 46XX and her blood investigations reveal hypercalcemia. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "DiGeorge syndrome"
      },
      {
        "id": 2,
        "text": "Williams syndrome"
      },
      {
        "id": 3,
        "text": "Down syndrome"
      },
      {
        "id": 4,
        "text": "Edward syndrome"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>This clinical vignette of mental retardation, elfin facies, hypercalcemia, and supravalvular aortic stenosis is strongly suggestive of <strong>Williams\u00a0syndrome.</strong></p>\n<p>The image shows a young girl with an <strong>elfin face</strong> with a round face, full cheeks, broad nasal bridge, anteverted nares, thick lips, and a large mouth that is usually left open. They also have short palpebral fissures, prominent ears, and a small mandible.\u00a0</p>\n<p>It is an <strong>autosomal dominant</strong> disorder characterized by multiple congenital development defects, including <strong>supra-valvular aortic stenosis,</strong> mental retardation, and an elfin facies, in association with <strong>hypercalcemia</strong> due to abnormal sensitivity to vitamin D with elevated levels of 1,25(OH)2D ranging from 150 to 500 pg/mL. It is caused by genetic mutations involving microdeletions at the elastin locus on <strong>chromosome 7.\u00a0</strong></p>\n<p>Other options:</p>\n<p>Option A: <strong>DiGeorge syndrome</strong>\u00a0is caused due to<strong> deletion of chromosome\u00a022q11.2</strong>. The characteristic features are (Mnemonic\u00a0<strong>CATCH-22</strong>) Cardiac abnormality, abnormal facies, thymic aplasia, cleft palate, hypocalcemia.</p>\n<p>The following image shows a child with <strong>DiGeorge syndrome:</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3427ccf8de484b9880f21d7b8efe848e.jpeg"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/597006234c6440de830aee28e50627bbx233x313.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c247d2300e1c4d1caea1a8da0279cf18x1280x1762.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5262579c4cdd4e8884481a1b1a351a90x292x432.PNG"
    ]
  },
  {
    "text": "After an acute attack of angle closure glaucoma the patient develops the following triad of symptoms except?",
    "choices": [
      {
        "id": 1,
        "text": "Non reactive pupil"
      },
      {
        "id": 2,
        "text": "Reactive pupil"
      },
      {
        "id": 3,
        "text": "Glaucomafleckens"
      },
      {
        "id": 4,
        "text": "Iris atrophy"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Vogt's triad</strong> is seen after an <strong>acute</strong> attack of <strong>primary angle-closure Glaucoma</strong>. It includes <strong>glaukomflecken, patches of iris atrophy</strong>, and a slightly dilated <strong>nonreactive pupil.</strong> Glaukomflecken is used to describe an <strong>anterior subcapsular lenticular opacity</strong>. The slightly dilated pupil is attributed to sphincter atrophy.</p>\n<p><strong>Glaucoma</strong> is used to describe a group of conditions where there is progressive optic neuropathy with<strong> irreversible </strong>visual field defects associated with<strong> raised intraocular pressure</strong>. It can be classified into <strong>congenital/developmental </strong>glaucomas,<strong> primary adult </strong>glaucomas, and <strong>secondary adult </strong>glaucomas.</p>\n<p><strong>Primary adult glaucomas</strong> are of three types:</p>\n<ul>\n<li>Primary open-angle glaucoma (POAG)</li>\n<li>Primary angle-closure glaucoma (PACG)</li>\n<li>Primary mixed mechanism glaucoma.\u00a0</li>\n</ul>\n<p>\u00a0In <strong>primary angle-closure disease</strong>, there is apposition of the peripheral iris with the trabecular meshwork. This interferes with the drainage of aqueous humor. It is seen more commonly in elderly females. Anatomical risk factors include hypermetropic eyes, anteriorly placed iris-lens diaphragm, and a <strong>narrow-angle of the anterior chamber.</strong> The international society of geographical and epidemiological opthalmology (ISGEO) has classified primary angle-closure disease into three types.</p>\n<p>PACS and PAC are seen before the development of PACG. <strong>Vogt triad</strong> is seen after an acute attack of PAC.</p>\n<p>PAC includes irido-trabecular contact on gonioscopy and elevated intraocular pressure (IOP) and/or peripheral anterior synechiae. The optic disc and visual fields are usually normal. Due to any reason, there can be an acute rise of IOP in patients with PAC. It is a <strong>vision-threatening emergency</strong> and the sequelae of which can be ciliary body shut down, Vogt's triad, and rarely spontaneous angle reopening.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 35-year-old  woman takes aspirin for a headache, later she presented with wheezing and breathlessness. These symptoms are likely to be associated with which of the following conditions?",
    "choices": [
      {
        "id": 1,
        "text": "IgE release"
      },
      {
        "id": 2,
        "text": "Nasal polyp"
      },
      {
        "id": 3,
        "text": "Extrinsic asthma"
      },
      {
        "id": 4,
        "text": "Drug interaction"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>This clinical vignette is suggestive of <strong>aspirin intolerance</strong>. It is most likely to be associated with <strong>nasal polyps</strong>.\u00a0</p>\n<p>In a patient with\u00a0<strong>Samter's triad, aspirin\u00a0</strong>should be<strong>\u00a0avoided</strong>\u00a0due to the risk of the development of\u00a0<strong>aspirin intolerance</strong>.</p>\n<p>Samter triad is a <strong>non-IgE mediated</strong> hypersensitivity reaction associated with the intake of aspirin or other cyclooxygenase inhibitors. Samter's triad is also known as\u00a0<strong>aspirin-induced asthma</strong> or <strong>aspirin-sensitive asthma.</strong>\u00a0It consists of:</p>\n<ul>\n<li><strong>Nasal polyposis</strong></li>\n<li><strong>Bronchial asthma</strong></li>\n<li><strong>Aspirin intolerance</strong></li>\n</ul>\n<p>Patients with Samter's triad will have persistent nasal congestion, rhinorrhea, anosmia, nasal polyps, and recurrent chronic rhinosinusitis.\u00a0<strong>Asthma</strong> and\u00a0<strong>aspirin intolerance</strong>\u00a0develop later.</p>\n<p>Acute asthma attacks usually occur 3 hours after intake of aspirin or NSAIDs. Severe rhinorrhea, conjunctival injection, facial flushing, and periorbital edema are also seen. Aspirin-induced hypersensitivity reactions also may occur.\u00a0</p>\n<p>Patients should <strong>avoid aspirin</strong> and NSAIDs that inhibit COX-1. Treatment may involve aspirin desensitization and endoscopic sinus surgery.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 48-year-old male presents with complaints of urinary incontinence. His history is notable for increasing forgetfulness and the physical examination reveals an abnormal gait. His fundus looks normal, he has no tremors.  Which of the following conditions is it most likely to be?",
    "choices": [
      {
        "id": 1,
        "text": "Creutzfeldt-Jakob disease"
      },
      {
        "id": 2,
        "text": "Dementia with Lewy bodies"
      },
      {
        "id": 3,
        "text": "Normal Pressure Hydrocephalus"
      },
      {
        "id": 4,
        "text": "Pick\u2019s disease"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Based on the given clinical scenario the probable diagnosis is<strong> normal pressure hydrocephalus.\u00a0</strong></p>\n<p><strong>Normal pressure hydrocephalus</strong> (NPH) is a <strong>reversible </strong>cause of dementia, typically presenting with the classic triad of <strong>dementia, ataxia,</strong> and <strong>urinary incontinence</strong>. With early diagnosis and prompt treatment, symptoms can often be reversed.</p>\n<p>NPH occurs due to i<strong>mpaired cerebrospinal fluid</strong> (CSF) flow and delayed absorption, often resulting from<strong> scarring</strong> of the<strong> basilar meninges.</strong> It is characterized by communicating hydrocephalus and the hallmark triad (dementia, ataxia, and urinary incontinence). <strong>Papilledema </strong>is not observed. Neuroimaging typically reveals <strong>enlarged lateral ventricles</strong> with little or no cortical atrophy, while the Sylvian fissures may appear enlarged, a phenomenon known as <strong>\"boxcarring,\"</strong> which can be confused with perisylvian atrophy. The preferred treatment is ventriculoperitoneal shunting, and CSF parameters are generally normal.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You are following up on a patient who is suspected to have Gradenigo's syndrome. Which of the following will not constitute a component of the classical triad of this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Ipsilateral abducens nerve palsy"
      },
      {
        "id": 2,
        "text": "Immobility of homolateral soft palate"
      },
      {
        "id": 3,
        "text": "Deep seated retro-orbital pain"
      },
      {
        "id": 4,
        "text": "Persistent ear discharge"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Gradenigo\u2019s Syndrome\u00a0</strong>generally\u00a0occurs secondary to\u00a0<strong>petrous apicitis.</strong>\u00a0It is\u00a0a complication of the attico-antral type of otitis media.\u00a0<strong>Immobility of the homolateral soft palate\u00a0</strong>(generally due to X cranial nerve palsy)\u00a0is not a component of its classical triad of symptoms.\u00a0</p>\n<p>Gradenigo\u2019s syndrome is a triad that consists of:</p>\n<ul>\n<li>Ipsilateral abducens nerve palsy (VI nerve palsy) - lateral rectus palsy</li>\n<li>Deep ear/facial pain (V nerve involvement)</li>\n<li>Persistent ear discharge (otitis media)</li>\n</ul>\n<p>Fever, headache, vomiting and sometimes neck rigidity may also be associated. Some patients may get facial paralysis and recurrent vertigo due to the involvement of facial and statoacoustic nerves.</p>\n<p>Diagnosis of petrous apicitis requires both a <strong>CT scan and an MRI.</strong> CT scan of temporal bone will show bony details of the petrous apex and the air cells while MRI helps to differentiate diploic marrow-containing apex from the fluid or pus.</p>\n<p>Treatment with suitable intravenous antibacterial therapy should precede and follow surgical intervention. Definitive management would include\u00a0<strong>mastoidectomy.\u00a0</strong></p>\n<p>Other options:<br />Option B:<strong> Trotter\u2019s Triad </strong>is seen in nasopharyngeal carcinoma. It consists of:</p>\n<ol>\n<li>Conductive hearing loss</li>\n<li><strong>Immobility of homolateral soft palate</strong></li>\n<li>Trigeminal neuralgia</li>\n</ol>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 24-year-old female patient presents to the emergency department with recurrent episodes of palpitations, headache, and sweating. Her blood pressure is 155/95 mm Hg, heart rate is 135/min. CT abdomen shows a suprarenal mass. A 24-hour urinary metanephrine is elevated. Her mother had renal cell carcinoma. What is the most likely diagnosis in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Von Recklinghausen\u00a0syndrome"
      },
      {
        "id": 2,
        "text": "Sturge weber syndrome"
      },
      {
        "id": 3,
        "text": "MEN IIA"
      },
      {
        "id": 4,
        "text": "Von Hippel-Lindau"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical picture is suggestive of <strong>pheochromocytoma\u00a0</strong>along with the h/o renal cell carcinoma is suggestive of\u00a0<strong>Von Hippel-Lindau (VHL) disease.</strong></p>\n<p>The given clinical picture is suggestive of <strong>pheochromocytoma</strong>\u00a0and it may be associated with all the listed syndromes: MEN 2B(Marfanoid habitus), von Hippel Lindau syndrome (renal cell carcinoma), and medullary carcinoma thyroid (MEN 2A and 2B).</p>\n<p><strong>Von Hippel-Lindau (VHL) disease:</strong></p>\n<ul>\n<li>It is an inherited,\u00a0<strong>autosomal dominant syndrome(chromosome 3).</strong></li>\n<li>It is manifested by a\u00a0<strong>variety of benign and malignant tumors</strong>\u00a0which include hemangioblastomas, clear cell renal cell carcinomas (RCCs), and pheochromocytomas.</li>\n</ul>\n<p>Familial syndromes associated with pheochromocytoma</p>\n<table border=\"1\">\n<tbody>\n<tr>\n<td><strong>MEN IIA</strong></td>\n<td><strong>ENDEMIC AFRICAN</strong></td>\n<td><strong>Sturge weber syndrome</strong></td>\n<td><strong>Von Hippel Linda\u00a0syndrome</strong></td>\n<td><strong>Von Recklinghausen\u00a0syndrome</strong></td>\n</tr>\n<tr>\n<td>\n<ul>\n<li>Medullary thyroid cancer</li>\n<li>Pheochromocytoma</li>\n</ul>\n<ul>\n<li>Parathyroid hyperplasia</li>\n</ul>\n</td>\n<td>\n<ul>\n<li>Medullary thyroid cancer</li>\n<li>Pheochromocytoma</li>\n<li>Mucosal neuroma</li>\n<li>Marfanoid featured</li>\n</ul>\n</td>\n<td>\n<ul>\n<li>Pheochromocytoma</li>\n<li>cavernous hemangioma of Vth cranial nerve distribution</li>\n</ul>\n</td>\n<td>\n<ul>\n<li>Pheochromocytoma</li>\n<li>Renal cell carcinoma</li>\n<li>cerebellar hemangioblastoma</li>\n<li>Angiomatosis</li>\n<li>Renal hepatic pancreatic &amp; epididymal cyst\u00a0</li>\n</ul>\n</td>\n<td>\n<ul>\n<li>Pheochromocytoma</li>\n<li>Neurofibromatosis</li>\n<li>cafe au late spots</li>\n<li>Schwannoma,glioma,meningiomas</li>\n</ul>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient presents to the outpatient department with complaints of fever and calf pain for the past 2 months. He had undergone knee replacement surgery 3 months ago, and a diagnosis of deep venous thrombosis (DVT) is confirmed with duplex scan. Regarding the disease\u2019s pathophysiology, Virchow\u2019s triad includes all of the following except _________.",
    "choices": [
      {
        "id": 1,
        "text": "Endothelial injury"
      },
      {
        "id": 2,
        "text": "Turbulent blood flow"
      },
      {
        "id": 3,
        "text": "Hyperviscosity"
      },
      {
        "id": 4,
        "text": "Hypercoagulability"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario is suggestive of <strong>deep venous thrombosis</strong>(DVT) and the <strong>Virchows triad</strong> includes all except, <strong>hyperviscosity.</strong></p>\n<p>In the given clinical scenario, a patient with a history of knee replacement surgery presents with fever and calf pain for 2 months, leading to a diagnosis of<strong> DVT,</strong> confirmed by a <strong>duplex scan</strong>. The <strong>pathophysiology</strong> of the disease involves <strong>Virchow\u2019s triad,</strong> which includes <strong>endothelial injury, hypercoagulability </strong>and <strong>abnormal blood flow</strong>. <strong>Hyperviscosity</strong> is not part of Virchow\u2019s triad; however, hyperviscosity conditions, such as polycythemia vera, can lead to small vessel stasis, which may contribute to thrombosis.</p>\n<p><strong>Virchow's triad in thrombosis:</strong></p>\n<ol>\n<li>Endothelial integrity is the most important factor.\u00a0<strong>Injury to endothelial cells</strong> can alter local blood flow and affect coagulability.</li>\n<li>Abnormal blood flow (<strong>stasis or turbulence</strong>), in turn, can cause endothelial injury.</li>\n<li><strong>Hypercoagulability of blood</strong></li>\n</ol>\n<p>DVT most commonly occurs in the calf veins and less often in the proximal veins of the thigh and pelvis. Causes include:</p>\n<ul>\n<li>Postoperative thrombosis- (Most common cause)Following childbirth</li>\n<li>Trauma- to leg, ankle, thigh, pelvis</li>\n<li>Muscular violence</li>\n<li>Immobility \u2013 Bed-ridden patients, individuals on long-duration air or bus travel (Traveller\u2019s thrombosis).</li>\n<li>Debilitating illness, obesity, immobility, bed rest, pregnancy, puerperium, oral contraceptives, estrogens.</li>\n</ul>\n<p><strong>Features</strong> of DVT</p>\n<ul>\n<li><strong>Fever- commonest</strong></li>\n<li>Tense, tender, warm, pale/bluish, shiny swelling calf</li>\n<li>Positive <strong>Homan\u2019s, Mose\u2019s sign</strong></li>\n<li><strong>Inverted champagne</strong> bottle sign</li>\n</ul>\n<p>Moses sign - <strong>Squeezing of the relaxed calf muscles</strong> from side to side is also <strong>painful</strong> as the thrombosed deep veins in the calf are always tender and this test is known as Moses sign.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/75522d1b0a954e49b0e7445356ef34e9x720x695.GIF",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/71cae48cc586414893a9e3be6b9f80eax1279x1496.JPEG"
    ]
  },
  {
    "text": "In which hamartoneoplastic syndrome is the following condition seen?",
    "choices": [
      {
        "id": 1,
        "text": "Tuberous sclerosis"
      },
      {
        "id": 2,
        "text": "Lynch syndrome"
      },
      {
        "id": 3,
        "text": "Cowden syndrome"
      },
      {
        "id": 4,
        "text": "Gardner syndrome"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The image shows a <strong>periungual fibroma</strong> or <strong>Koenen tumor</strong>, which is characteristic of <strong>tuberous sclerosis </strong>(autosomal dominant inheritance).\u00a0They appear at or after puberty as smooth, firm, <strong>flesh-colored excrescences emerging from the nail folds</strong>.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b5b5d156abaa4353be3f088d5cf3805b.GIF"
    ],
    "explanation_images": []
  }
];
        let quizName = 'Mini Test- 8 (Syndromes And Triads)';
        const quizFilename = 'mini-test-8-syndromes-and-triads-f1a3267d.html';
        let hierarchy = ["Marrow", "FMGE Mini Test Series", "2024"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>