<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>04 Acute Inflammation - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Pathology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">26</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Who listed the four cardinal signs of inflammation?",
    "choices": [
      {
        "id": 1,
        "text": "Joseph Lister"
      },
      {
        "id": 2,
        "text": "Claudius Galen"
      },
      {
        "id": 3,
        "text": "Aulus Celsus"
      },
      {
        "id": 4,
        "text": "Rudolph Virchow"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The four cardinal signs of inflammation were first listed by&nbsp;<strong>Aulus Celsus</strong>. He was&nbsp;a Roman medical writer of the first century AD. These are:</p>\n<ol>\n<li>Rubor - redness</li>\n<li>Tumour - swelling</li>\n<li>Calor - heat</li>\n<li>Dolor - pain</li>\n</ol>\n<p>These signs are the hallmarks of acute inflammation.</p>\n<p><strong>Rudolf Virchow</strong>&nbsp;added the <strong>fifth</strong> clinical <strong>sign</strong> of inflammation, <strong>loss of function, functio laesa.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following stimuli can trigger an inflammatory response?",
    "choices": [
      {
        "id": 1,
        "text": "1, 2, 3, 5"
      },
      {
        "id": 2,
        "text": "1, 4"
      },
      {
        "id": 3,
        "text": "2, 3, 5"
      },
      {
        "id": 4,
        "text": "1, 2, 3, 4, 5"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The <strong>complement system</strong> does not trigger an inflammatory response. It reacts against microbes and results in the&nbsp;<strong>production&nbsp;</strong>of&nbsp;<strong>mediators</strong> of <strong>inflammation</strong>.</p>\n<p>The major <strong>triggers of inflammation</strong> include:</p>\n<ul>\n<li><strong>Infections</strong>&nbsp;- bacteria, viruses, fungi, parasites, toxins</li>\n<li>Tissue necrosis - due to ischemia, trauma, physical or chemical injuries</li>\n<li><strong>Foreign bodies</strong>&nbsp;-&nbsp;\n<ul>\n<li><strong>Endogenous</strong> -&nbsp;<strong>DNA breakdown</strong>&nbsp;products (uric acid), cholesterol crystals, lipids</li>\n<li>Exogenous -&nbsp;splinters, dirt, sutures, etc</li>\n</ul>\n</li>\n<li><strong>Trauma</strong></li>\n<li>Immune reactions -&nbsp;against microbes, self-antigens, or environmental substances&nbsp;</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following are cytosolic pattern-recognition receptors?",
    "choices": [
      {
        "id": 1,
        "text": "2, 4, 5"
      },
      {
        "id": 2,
        "text": "1, 3, 4"
      },
      {
        "id": 3,
        "text": "1, 3, 5"
      },
      {
        "id": 4,
        "text": "2, 4"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>NOD-like</strong> receptors and <strong>RIG-like</strong> receptors&nbsp;are <strong>cytosolic</strong> <strong>pattern</strong>-<strong>recognition</strong> <strong>receptors</strong>.</p>\n<p>Pattern-recognition receptors&nbsp;are the cellular receptors that <strong>recognize&nbsp;</strong><strong>microbes </strong>and <strong>damaged cells.</strong></p>\n<p>Types of pattern-recognition receptors:</p>\n<ul>\n<li><strong>Cellular</strong> receptors for microbes -&nbsp;\n<ul>\n<li><strong>Toll-like</strong> receptors on the&nbsp;plasma membrane and endosomal vesicles</li>\n<li>&nbsp;<strong>C-type lectin</strong> receptors on the plasma membrane of macrophages and dendritic cells</li>\n</ul>\n</li>\n<li>Cytosolic receptors -\n<ul>\n<li>NOD-like receptors detect&nbsp;bacterial peptidoglycan</li>\n<li>RIG-like receptors detect viral RNA</li>\n</ul>\n</li>\n<li><strong>Circulating</strong> proteins:<strong> Mannose-binding lectin</strong>&nbsp;and&nbsp;<strong>collectins</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is false about the acute inflammatory process?",
    "choices": [
      {
        "id": 1,
        "text": "It is a mechanism of innate immunity"
      },
      {
        "id": 2,
        "text": "Monocytes and macrophages are mainly involved"
      },
      {
        "id": 3,
        "text": "Tissue injury is usually mild and self-limited"
      },
      {
        "id": 4,
        "text": "Local and systemic signs are prominent"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The prominent cells in <strong>acute inflammation</strong> are <strong>neutrophils.</strong></p>\n<p>The initial, rapid response to infections agents and tissue damage is called acute inflammation. It is a mechanism of <strong>innate immunity</strong>&nbsp;that occurs in response to&nbsp;<strong>mild</strong> and <strong>self-limited tissue injury.</strong><strong>&nbsp;</strong>It is associated with <strong>prominent</strong> <strong>local</strong> and <strong>systemic signs</strong>.</p>\n<p>The major components of acute inflammation are:</p>\n<ul>\n<li><strong>Vasodilation</strong>&nbsp;and increased<strong> permeability</strong>&nbsp;of small blood vessels&nbsp;</li>\n<li>Changes in the <strong>leukocytes</strong> -\n<ul>\n<li>Migration from the microcirculation</li>\n<li>Accumulation at the site of inflammation</li>\n<li>Activation to eliminate the offending agent</li>\n</ul>\n</li>\n</ul>\n<p><strong>Chronic</strong> inflammation is a mechanism of <strong>adaptive immunity&nbsp;</strong>and is&nbsp;of longer duration. It is associated with</p>\n<ul>\n<li>Presence of<strong> lymphocytes and macrophages</strong></li>\n<li>Proliferation of blood vessels</li>\n<li>Deposition of connective tissue</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the most common mechanism of vascular leakage in acute inflammation?",
    "choices": [
      {
        "id": 1,
        "text": "Contraction of endothelial cells"
      },
      {
        "id": 2,
        "text": "Direct endothelial injury"
      },
      {
        "id": 3,
        "text": "Complement mediated endothelial injury"
      },
      {
        "id": 4,
        "text": "Leukocyte-dependent endothelial injury"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The <strong>most common</strong> mechanism of vascular leakage in acute inflammation is the <strong>contraction of endothelial</strong> cells.</p>\n<p>This is an immediate, transient response mediated by <strong>histamine, bradykinin</strong>, and <strong>leukotrienes</strong>. The contraction of the endothelial cells results in an&nbsp;<strong>increase</strong>&nbsp;in the<strong>&nbsp;interendothelial spaces</strong>.&nbsp;</p>\n<p>Other mechanisms of vascular leakage include:</p>\n<ul>\n<li><strong>Endothelial injury</strong>&nbsp;- results in endothelial cell necrosis and detachment</li>\n<li><strong>Transcytosis</strong>&nbsp;- increased transport of fluids and proteins</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A man is brought to the casualty with swelling after sustaining a bee sting over his face. Which of the following vascular changes is not observed in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Increased hydrostatic pressure"
      },
      {
        "id": 2,
        "text": "Stasis of blood"
      },
      {
        "id": 3,
        "text": "Transcytosis"
      },
      {
        "id": 4,
        "text": "Increased oncotic pressure"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Bee stings result in <strong>acute inflammation</strong>&nbsp;at the site of the sting. In this condition, there is <strong>decreased oncotic pressure</strong> due to protein leakage.</p>\n<p>There is a release of inflammatory mediators like <strong>histamine</strong> which result in the following&nbsp;<strong>vascular changes:</strong>&nbsp;</p>\n<ul>\n<li><strong>Vasodilation&nbsp;</strong>- results in erythema and <strong>stasis </strong>of blood flow</li>\n<li>Increased<strong> vascular permeability </strong>-\n<ul>\n<li>Due to mediators like histamine, kinins, or&nbsp;endothelial injury (direct or leukocyte-induced ), or <strong>transcytosis</strong></li>\n<li>Results in leakage of proteins (reduced vascular oncotic pressure) and leukocyte migration&nbsp;</li>\n</ul>\n</li>\n<li><strong>Increased hydrostatic pressure </strong>-&nbsp;results in fluid leakage&nbsp;from blood vessels resulting in edema</li>\n</ul>\n<p>The image below shows the changes seen during acute inflammation.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/eb0846b5751a4744a385d5073bf78512x1280x1723.JPEG"
    ]
  },
  {
    "text": "During normal blood flow in venules, which cells occupy the central axial column?",
    "choices": [
      {
        "id": 1,
        "text": "RBCs"
      },
      {
        "id": 2,
        "text": "Neutrophils"
      },
      {
        "id": 3,
        "text": "Platelets"
      },
      {
        "id": 4,
        "text": "Lymphocytes"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Blood flows in blood vessels as central axial/laminar column and peripheral chaotic columns. During <strong>normal</strong> blood flow in <strong>venules</strong>, the <strong>central axial</strong> column is occupied by the<strong>&nbsp;</strong><strong>red blood cells</strong> (RBCs).&nbsp;</p>\n<p>These RBCs<strong>&nbsp;</strong>displace the leukocytes toward the wall of the vessel (chaotic column). During&nbsp;<strong>inflammation</strong>, stasis leads to<strong> slow blood flow</strong> and reduced&nbsp;wall shear stress. This further <strong>pushes</strong> the <strong>WBCs</strong> towards a <strong>peripheral</strong> position along the endothelial surface. This is called <strong>margination</strong>.</p>\n<p>Subsequently, leukocytes adhere to the endothelium, then detach and bind again. This is referred to as <strong>rolling</strong> on the vessel wall. The cells finally come to rest and&nbsp;<strong>adhere</strong> firmly to the endothelial wall.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not true with regard to selectins?",
    "choices": [
      {
        "id": 1,
        "text": "Involved in initial rolling interactions"
      },
      {
        "id": 2,
        "text": "There are L, E and P types of selectins"
      },
      {
        "id": 3,
        "text": "P-selectins are expressed on the endothelium"
      },
      {
        "id": 4,
        "text": "Selectins mediate high-affinity interactions"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Selectins are a group of molecules that mediate&nbsp;<strong>low-affinity interactions</strong>&nbsp;between the leukocytes and the endothelium.</p>\n<p>Due to the low-affinity nature of these interactions, they are easily disrupted by the flowing blood. They play a major role in the&nbsp;<strong>initial</strong> <strong>rolling</strong> <strong>interactions</strong> of leukocytes with the vascular endothelium.&nbsp;The expression of selectins and their ligands is regulated by cytokines produced in response to infection and injury.</p>\n<p>There are 3 types of selectins:</p>\n<ol>\n<li><strong>L</strong>-selectin - expressed on <strong>leukocytes</strong></li>\n<li><strong>E</strong>-selectin - expressed on <strong>endothelium</strong></li>\n<li><strong>P</strong>-selectin - expressed on <strong>activated</strong> <strong>platelets</strong> and&nbsp;<strong>endothelium</strong></li>\n</ol>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not an integrin molecule?",
    "choices": [
      {
        "id": 1,
        "text": "LFA-1"
      },
      {
        "id": 2,
        "text": "MAC-1"
      },
      {
        "id": 3,
        "text": "VLA-4"
      },
      {
        "id": 4,
        "text": "CD31"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>CD 31</strong> or platelet endothelial cell-adhesion molecule 1 <strong>(PECAM-1)</strong>&nbsp;is a member of the <strong>immunoglobulin</strong> superfamily. It is not an integrin molecule.</p>\n<p>The various endothelial and leukocyte adhesion molecules include:</p>\n<ul>\n<li><strong>Selectin</strong> family<strong> -</strong>&nbsp;mediates initial rolling interactions between leukocytes and endothelium</li>\n<li><strong>Integrin </strong>family<strong> -&nbsp;</strong>\n<ul>\n<li>Involved in&nbsp;migration and&nbsp;firm adhesion of leukocytes to the endothelium</li>\n<li>Includes&nbsp;<strong>LFA-1</strong>, <strong>MAC-1</strong>, and <strong>VLA-4</strong></li>\n</ul>\n</li>\n<li><strong>Immunoglobulin&nbsp;</strong>family -\n<ul>\n<li>PECAM (CD31) - most important adhesion molecule for diapedesis</li>\n<li>ICAM-1 - binds to&nbsp;&beta;2 integrins on leukocytes</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not a ligand for integrins?",
    "choices": [
      {
        "id": 1,
        "text": "CD 54"
      },
      {
        "id": 2,
        "text": "CD 102"
      },
      {
        "id": 3,
        "text": "CD 106"
      },
      {
        "id": 4,
        "text": "CD 34"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The&nbsp;<strong>ligands</strong> for <strong>integrins&nbsp;</strong>include:</p>\n<ul>\n<li>ICAM-1 (<strong>CD54</strong>)</li>\n<li>ICAM-2 (<strong>CD102</strong>)</li>\n<li>VCAM-1 (<strong>CD106</strong>)</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Sialyl-Lewis X is linked to which of the following?",
    "choices": [
      {
        "id": 1,
        "text": "Selectin"
      },
      {
        "id": 2,
        "text": "ICAM"
      },
      {
        "id": 3,
        "text": "CD31"
      },
      {
        "id": 4,
        "text": "LFA-1"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Sialyl-Lewis X </strong>refers to sialylated oligosaccharides bound to mucin-like glycoprotein. These molecules function as<strong>&nbsp;ligands</strong> for <strong>selectins</strong>.</p>\n<p>The expression of selectins and their ligands is regulated by cytokines produced in response to infection and injury.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which molecule plays a major role in the following phenomenon seen in leukocytes?",
    "choices": [
      {
        "id": 1,
        "text": "CD31"
      },
      {
        "id": 2,
        "text": "CD62"
      },
      {
        "id": 3,
        "text": "CD102"
      },
      {
        "id": 4,
        "text": "CD54"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The image shows <strong>diapedesis</strong> by leukocytes<strong>. CD31</strong> or platelet endothelial cell adhesion molecule (<strong>PECAM-1</strong>) plays a major role in diapedesis.<strong>&nbsp;</strong></p>\n<p>Diapedesis or transmigration refers to the <strong>migration</strong> of the <strong>leukocytes</strong> through the <strong>endothelium</strong>. It mainly occurs in <strong>postcapillary venules</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/efb0fdbdfd144aaea15c86e66709d6a8.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "In patients with acute respiratory distress syndrome, which of the following cells are the major cause of tissue injury?",
    "choices": [
      {
        "id": 1,
        "text": "Neutrophils"
      },
      {
        "id": 2,
        "text": "Eosinophils"
      },
      {
        "id": 3,
        "text": "Macrophages"
      },
      {
        "id": 4,
        "text": "Plasma cells"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>In acute respiratory distress syndrome <strong>(ARDS), </strong>acute<strong>&nbsp;</strong>tissue injury is caused mainly by<strong> neutrophils.</strong></p>\n<p>ARDS is a clinical syndrome manifested as a result of <strong>severe lung injury.</strong>&nbsp;The initiating event is alveolar epithelial cell damage. It is characterized by <strong>acute inflammation</strong>, causing increased pulmonary vascular permeability and&nbsp;<strong>edema</strong>.&nbsp;</p>\n<p>Neutrophils adhere to the activated endothelium and migrate into the interstitium and the alveoli. Here, they degranulate and release inflammatory mediators. These include:</p>\n<ul>\n<li>Proteases</li>\n<li>Reactive oxygen species</li>\n<li>Cytokines</li>\n</ul>\n<p><strong>Macrophages </strong>are involved in the stage of <strong>resolution.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Infection with which of the following organisms would produce an inflammatory infiltrate with neutrophilic predominance beyond 48 hours?",
    "choices": [
      {
        "id": 1,
        "text": "Pseudomonas"
      },
      {
        "id": 2,
        "text": "Staphylococci"
      },
      {
        "id": 3,
        "text": "Fungi"
      },
      {
        "id": 4,
        "text": "Virus"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>In&nbsp;<em><strong>P</strong><strong>seudomonas</strong></em> infection,&nbsp;the inflammatory infiltrate has a <strong>neutrophilic predominance</strong>&nbsp;for <strong>several days</strong>.</p>\n<p><strong>Normally</strong>, in acute inflammation, <strong>neutrophils</strong> predominate the inflammatory infiltrate during the first 6 to 24 hours.&nbsp;However, they are short-lived, and <strong>disappear</strong> within <strong>24 to 48 hours</strong>, following which they are replaced by monocytes.</p>\n<p><strong>Monocytes</strong>&nbsp;survive longer and also proliferate in the tissues. Thus, they become the dominant population in <strong>prolonged</strong> <strong>inflammatory</strong> reactions.</p>\n<p>The <strong>exceptions</strong> to this pattern include:</p>\n<ol>\n<li class=\"p1\" style=\"text-align: left;\"><em>Pseudomonas</em> infections - neutrophilic dominance in the infiltrate for several days</li>\n<li class=\"p1\" style=\"text-align: left;\"><strong>Viral</strong> infections - <strong>lymphocytes</strong> are the initial cells</li>\n<li><strong>Allergic</strong> reactions - <strong>eosinophils</strong> are the main cell type</li>\n<li class=\"p1\" style=\"text-align: left;\">Some types of hypersensitivity - dominated by activated lymphocytes, macrophages, and plasma cells&nbsp;</li>\n</ol>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is involved in inducing the migration of leukocytes to sites of injury?",
    "choices": [
      {
        "id": 1,
        "text": "C5a"
      },
      {
        "id": 2,
        "text": "C3b"
      },
      {
        "id": 3,
        "text": "C3a"
      },
      {
        "id": 4,
        "text": "C5b"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>C5a</strong>&nbsp;induces the <strong>migration </strong>of<strong> leukocytes</strong> to the site of injury. It functions as an<strong>&nbsp;endogenous chemoattractant.</strong></p>\n<p>Both exogenous and endogenous substances can act as chemoattractants. The most common<strong> exogenous</strong> agents include&nbsp;<strong>bacterial products</strong>&nbsp;like peptides with&nbsp;N-formylmethionine terminal amino acids and certain lipids.&nbsp;</p>\n<p><strong>Endogenous</strong> chemoattractants include several chemical mediators:</p>\n<ol>\n<li>Cytokines - particularly those of the chemokine family (<strong>IL-8</strong>)</li>\n<li>Complement system components - particularly <strong>C5a</strong></li>\n<li>Arachidonic acid metabolites - mainly <strong>leukotriene B4&nbsp;</strong></li>\n</ol>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is an opsonin?",
    "choices": [
      {
        "id": 1,
        "text": "C3a"
      },
      {
        "id": 2,
        "text": "C3b"
      },
      {
        "id": 3,
        "text": "C5a"
      },
      {
        "id": 4,
        "text": "C6"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p class=\"p1\"><strong>C3b</strong> functions as an <strong>opsonin</strong>.</p>\n<p class=\"p1\"><strong>Opsonization</strong> is the process of <strong>coating</strong> a <strong>foreign particle</strong> and preparing it for <strong>phagocytosis.</strong>&nbsp;The substances involved in this process are called opsonins and include:&nbsp;</p>\n<ul>\n<li class=\"p1\">Mannose-binding lectin</li>\n<li class=\"p1\">C3b, C4b, C5b</li>\n<li class=\"p1\">IgM and Fc receptor of IgG</li>\n<li class=\"p1\">CRP</li>\n<li class=\"p1\">Fibrinogen</li>\n</ul>\n<p><strong>Elie Metchnikoff</strong> was the first person to describe the process of phagocytosis, and is hence known as the <strong>Father of Innate Immunity.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following does not have antioxidant action?",
    "choices": [
      {
        "id": 1,
        "text": "Myeloperoxidase"
      },
      {
        "id": 2,
        "text": "Ceruloplasmin"
      },
      {
        "id": 3,
        "text": "Catalase"
      },
      {
        "id": 4,
        "text": "Glutathione peroxidase"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Myeloperoxidase</strong>\u00a0is an <strong>oxidative</strong> <strong>enzyme</strong>, not an<strong>\u00a0</strong>antioxidant.</p>\n<p><strong>Antioxidants</strong> provide <strong>protection</strong> against\u00a0potentially harmful\u00a0<strong>oxygen-derived radicals</strong>.\u00a0Serum, tissue fluids, and host cells possess antioxidant mechanisms.\u00a0These include:</p>\n<ul>\n<li><strong>Catalase</strong></li>\n<li>Superoxide dismutase</li>\n<li><strong>Glutathione peroxidase\u00a0</strong></li>\n<li>Iron-free fraction of transferrin</li>\n<li>Carotenoids</li>\n<li><strong>Ceruloplasmin</strong></li>\n</ul>\n<p>Myeloperoxidase is an<strong> oxidative enzyme </strong>with<strong> antimicrobial activity.</strong>\u00a0It is seen in azurophil (primary) granules of neutrophils. It is involved in the\u00a0production of hypochlorous acid and destroys microbes by means of halogenation and lipid peroxidation.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Oxygen-dependent killing is done through which of the following?",
    "choices": [
      {
        "id": 1,
        "text": "NADPH oxidase"
      },
      {
        "id": 2,
        "text": "Carotenoids"
      },
      {
        "id": 3,
        "text": "Transferrin"
      },
      {
        "id": 4,
        "text": "Glutathione peroxidise"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Carotenoids</strong>, <strong>glutathione peroxidase</strong>, and the iron-free fraction of <strong>transferrin</strong> are <strong>antioxidants</strong> or free radical scavengers that prevent oxygen-mediated injury.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c9b67774a8f04a109415bdbe73b64a4fx1280x1775.JPEG"
    ]
  },
  {
    "text": "A 7-month-old male infant was brought with a 2-day history of fever and abscess over the neck. The mother reveals that the child has had similar recurrent infections in the past. The result of the nitroblue tetrazolium dye reduction test was found to be abnormal. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Leukocyte adhesion deficiency"
      },
      {
        "id": 2,
        "text": "Chronic granulomatous disease"
      },
      {
        "id": 3,
        "text": "Severe combined Immunodeficiency"
      },
      {
        "id": 4,
        "text": "Chediak Higashi syndrome"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario and abnormal<strong>&nbsp;nitroblue tetrazolium dye reduction </strong>test&nbsp;are suggestive of&nbsp;<strong>c</strong><strong>hronic granulomatous disease</strong>&nbsp;(CGD).</p>\n<p>CGD is a rare primary immunodeficiency of phagocytes. It is an&nbsp;<strong>X-linked recessive </strong>disorder due to the <strong>d</strong><strong>eficiency </strong>in the<strong> NADPH oxidase </strong>enzyme. This is important in the respiratory&nbsp;or oxidative burst.&nbsp;</p>\n<p>It usually manifests in the first year of life with <strong>recurrent</strong> <strong>pyogenic</strong> <strong>infections</strong> with <strong>catalase</strong>-<strong>positive</strong> organisms, including:&nbsp;</p>\n<ul>\n<li><em>Staphylococcus aureus</em></li>\n<li><em>Escherichia&nbsp;coli</em></li>\n<li><em>Aspergillus</em> species</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A nitroblue tetrazolium test is performed in a child with recurrent infections. Functions of which of the following are assessed by this test?",
    "choices": [
      {
        "id": 1,
        "text": "Phagocytes"
      },
      {
        "id": 2,
        "text": "Complement"
      },
      {
        "id": 3,
        "text": "T-cells"
      },
      {
        "id": 4,
        "text": "Neutrophils"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Nitroblue tetrazolium test</strong>&nbsp;(NBT) is done to assess the function of&nbsp;<strong>phagocytes</strong>.</p>\n<p>The principle is based on the color change of the&nbsp;<strong>colorless</strong> nitroblue tetrazolium compound to a <strong>deep blue</strong>&nbsp;when exposed to reactive oxygen species (ROS).&nbsp;The <strong>higher</strong> the <strong>nitroblue</strong> <strong>test score</strong>, the <strong>better</strong> the cell is at producing <strong>ROS.</strong></p>\n<p>In chronic granulomatous disease, there is an NADPH oxidase defect. Hence, the phagocyte is unable to produce reactive oxygen species or radicals required for bacterial killing, which results in recurrent infections. Hence, there is a reduced color change with the NBT test.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Patients with which of the following conditions have defective phagolysosome formation?",
    "choices": [
      {
        "id": 1,
        "text": "Chronic granulomatous disease"
      },
      {
        "id": 2,
        "text": "Chediak\u2013Higashi syndrome"
      },
      {
        "id": 3,
        "text": "Mannose-binding lectin deficiency"
      },
      {
        "id": 4,
        "text": "Glanzmann-Rinicker syndrome"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Defective phagolysosome</strong> <strong>formation</strong> is seen in patients with <strong>Chediak&ndash;Higashi syndrome</strong> (CHS).&nbsp;It&nbsp;is a rare <strong>autosomal recessive</strong> defect.</p>\n<p>There is an abnormal fusion of azurophilic lysosomes of neutrophils and cytoplasmic granules of monocytes and lymphocytes, which leads to the presence of&nbsp;<strong>giant lysosomal granules</strong>.&nbsp;Hence, there is<strong>&nbsp;</strong>abnormal post-phagocytic phagolysosomal fusion,&nbsp;degranulation, and impaired microbicidal activity. There is rapid&nbsp;neutrophil turnover leading to low counts.&nbsp;</p>\n<p>Clinical features include:</p>\n<ul>\n<li><strong>Recurrent infections</strong> -\n<ul>\n<li>Commonly affect the skin, upper and lower respiratory tract</li>\n<li>Common organisms -&nbsp;<em>Staphylococcus aureus</em>,&nbsp;<em>Haemophilus influenzae</em>,&nbsp;Group A <em>Streptococcus</em>,&nbsp;Gram-negative enteric (<em>Klebsiella</em>, <em>Proteus</em>, <em>Shigella</em>, <em>Pseudomonas</em>)</li>\n</ul>\n</li>\n<li>Accelerated phase in some patients -<strong>&nbsp;</strong>\n<ul>\n<li><strong>Hemophagocytic</strong> <strong>syndrome</strong> and aggressive <strong>lymphoma</strong></li>\n<li>These patients require bone marrow transplantation</li>\n</ul>\n</li>\n<li><strong>Albinism</strong> with neurological defects&nbsp;</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is frustrated phagocytosis?",
    "choices": [
      {
        "id": 1,
        "text": "Release of lysosomal contents due to damaged membrane"
      },
      {
        "id": 2,
        "text": "Engulfment of infectious pathogens and degradation by phagolysosome"
      },
      {
        "id": 3,
        "text": "Release of lysosomal enzymes when phagocytes cannot engulf targets"
      },
      {
        "id": 4,
        "text": "Defective phagolysosome formation"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The term <strong>frustrated phagocytosis</strong> refers to the <strong>release</strong> of large amounts of <strong>lysosomal contents</strong> into the&nbsp;external environment due the <strong>inability</strong> of the <strong>phagocytes</strong> to <strong>engulf</strong>.</p>\n<p>When&nbsp;<strong>immune complexes</strong> are deposited on relatively <strong>flat</strong> <strong>immovable</strong> <strong>surfaces</strong>, the <strong>phagocytes</strong> are <strong>unable</strong> to <strong>surround</strong> and ingest them. In this case, the activation signals lead to an uncontrolled release of the lysosomal contents, despite lack of phagocytosis.&nbsp;This is known as frustrated phagocytosis.&nbsp;</p>\n<p>Other processes may lead to the release of lysosomal contents into the external environment:</p>\n<ul>\n<li><strong>Controlled secretion</strong> of granule contents - <strong>normal </strong>response of activated leukocytes</li>\n<li><strong>Damage</strong>&nbsp;to the<strong>&nbsp;phagolysosome membrane</strong> by certain<strong>&nbsp;</strong>phagocytosed substances like <strong>urate crystals</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What does the following image show?",
    "choices": [
      {
        "id": 1,
        "text": "Autophagy"
      },
      {
        "id": 2,
        "text": "Emperipolesis"
      },
      {
        "id": 3,
        "text": "Phagocytosis"
      },
      {
        "id": 4,
        "text": "Amoebic autophagy"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The image shows the phenomenon of&nbsp;<strong>emperipolesis</strong>. Here, <strong>intact</strong> <strong>hematopoietic</strong> <strong>cells</strong> are seen <strong>within</strong> the <strong>cytoplasm</strong> of the host cell without any damage.</p>\n<p>The cells frequently involved are neutrophils, lymphocytes, and plasma cells. Both the cells are viable<strong>&nbsp;</strong>and there are no physiological and morphological consequences to either of them.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/8ffd4fc659514f4187528cf9542adda6.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f86c5e503fe04fdf9786d062694e5709x1280x1336.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c3d52dc4a86b41f58b7efdb3ed54a890x1280x1336.JPEG"
    ]
  },
  {
    "text": "Which of the following is not present in the primary granules of neutrophils?",
    "choices": [
      {
        "id": 1,
        "text": "Myeloperoxidase"
      },
      {
        "id": 2,
        "text": "Defensin"
      },
      {
        "id": 3,
        "text": "Acid hydrolases"
      },
      {
        "id": 4,
        "text": "Lactoferrin"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Lactoferrin</strong> is present in the <strong>secondary granules</strong> of neutrophils, not primary.</p>\n<p>The types of granules present in neutrophils are:</p>\n<table style=\"height: 258px; width: 550.75px;\">\n<tbody>\n<tr style=\"height: 12px;\">\n<td style=\"width: 147px; height: 12px;\"><strong>Azurophil (Primary) granules</strong></td>\n<td style=\"width: 127px; height: 12px;\"><strong>Specific (Secondary) granules</strong></td>\n<td style=\"width: 154.75px; height: 12px;\"><strong>Small storage granules</strong></td>\n</tr>\n<tr style=\"height: 12px;\">\n<td style=\"width: 147px; height: 12px; text-align: center;\" colspan=\"3\">Antimicrobial molecules</td>\n</tr>\n<tr style=\"height: 128px;\">\n<td style=\"width: 147px; height: 128px;\">\n<p>Lysozyme</p>\n<p><strong>Myeloperoxidase</strong>, <strong>defensins</strong>,&nbsp;BPI</p>\n</td>\n<td style=\"width: 127px; height: 128px;\">\n<p>Lysozyme</p>\n<p><strong>Lactoferrin</strong>&nbsp;</p>\n</td>\n<td style=\"width: 154.75px; height: 128px; text-align: center;\">---&nbsp;</td>\n</tr>\n<tr style=\"height: 12px;\">\n<td style=\"width: 147px; height: 12px; text-align: center;\" colspan=\"3\">Neutral proteinases</td>\n</tr>\n<tr style=\"height: 64px;\">\n<td style=\"width: 147px; height: 64px;\">\n<p>Elastase</p>\n<p>Cathepsin G</p>\n<p>Proteinase 3</p>\n</td>\n<td style=\"width: 127px; height: 64px;\">\n<p>Collagenase complement&nbsp;activator</p>\n</td>\n<td style=\"width: 154.75px; height: 64px;\">\n<p>Gelatinase</p>\n<p>Plasminogen activator</p>\n</td>\n</tr>\n<tr style=\"height: 12px;\">\n<td style=\"width: 147px; height: 12px; text-align: center;\" colspan=\"3\"><strong>Acid hydrolases</strong></td>\n</tr>\n<tr style=\"height: 21px;\">\n<td style=\"width: 147px; height: 21px;\">\n<p>Cathepsins B, D</p>\n<p>&beta;-D-Glucuronidase</p>\n<p>&alpha;-Mannosidase</p>\n<p>Phospholipase A<sub>2</sub></p>\n</td>\n<td style=\"width: 127px; height: 21px;\">\n<p>Phospholipase A<sub>2</sub></p>\n</td>\n<td style=\"width: 154.75px; height: 21px;\">\n<p>Cathepsins B, D</p>\n<p>&beta;-D-Glucuronidase</p>\n<p>&alpha;-Mannosidase</p>\n</td>\n</tr>\n<tr style=\"height: 12px;\">\n<td style=\"width: 147px; height: 12px; text-align: center;\" colspan=\"3\">Cytoplasmic membrane receptors</td>\n</tr>\n<tr style=\"height: 32px;\">\n<td style=\"width: 147px; height: 32px; text-align: center;\">&nbsp;---</td>\n<td style=\"width: 127px; height: 32px;\">\n<p>CR3, CR4&nbsp;</p>\n<p>FMLP receptors</p>\n<p>Laminin receptors</p>\n</td>\n<td style=\"width: 154.75px; height: 32px; text-align: center;\">&nbsp;---</td>\n</tr>\n<tr style=\"height: 12px;\">\n<td style=\"width: 147px; height: 12px; text-align: center;\" colspan=\"3\">Other molecules</td>\n</tr>\n<tr style=\"height: 32px;\">\n<td style=\"width: 147px; height: 32px;\">\n<p>Chondroitin-4-sulfate&nbsp;</p>\n</td>\n<td style=\"width: 127px; height: 32px;\">\n<p>Cytochrome B558</p>\n<p>Monocyte-chemotactic factor</p>\n<p>Histaminase</p>\n<p>Vitamin B<sub>12<sup>-</sup></sub> binding protein</p>\n</td>\n<td style=\"width: 154.75px; height: 32px;\">Cytochrome B558</td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 562.75px; height: 18px;\" colspan=\"3\">\n<p>&nbsp;BPI: bactericidal permeability-increasing protein</p>\n<p>FMLP: N-formyl methionyl-leucyl-phenylalanine&nbsp;</p>\n</td>\n</tr>\n</tbody>\n</table>\n<p>Primary and secondary granules can fuse with phagocytic vacuoles containing engulfed material. Otherwise, the granule contents can be released into the extracellular space.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In which of the following is major basic protein seen?",
    "choices": [
      {
        "id": 1,
        "text": "Neutrophils"
      },
      {
        "id": 2,
        "text": "Eosinophils"
      },
      {
        "id": 3,
        "text": "Basophils"
      },
      {
        "id": 4,
        "text": "Macrophage"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The<strong> major basic protein</strong>&nbsp;is the predominant constituent of the crystalline core of the <strong>eosinophil </strong>granule.</p>\n<p>It is&nbsp;also called <strong>proteoglycan-2 </strong>and is&nbsp;encoded by the<strong> PRG2</strong> gene.&nbsp;This protein is involved in:&nbsp;</p>\n<ul>\n<li><strong>Antiparasitic </strong>defense mechanisms - functions as a&nbsp;cytotoxin and helminthotoxin&nbsp;</li>\n<li>Immune<strong> hypersensitivity </strong>reactions</li>\n<li>Lysis of epithelial cells</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is incorrect regarding neutrophil extracellular traps (NETs)?",
    "choices": [
      {
        "id": 1,
        "text": "They prevent the spread of the microbes by trapping them in the fibrils"
      },
      {
        "id": 2,
        "text": "Nuclear chromatin in the NETs are the source of nuclear antigens in SLE"
      },
      {
        "id": 3,
        "text": "In sepsis, platelet activation is involved in NET formation"
      },
      {
        "id": 4,
        "text": "NETs play a major role in phagocytosis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p class=\"p1\">Neutrophil extracellular traps (<strong>NETs</strong>) are <strong>not involved</strong> in <strong>phagocytosis</strong>. This is because the nuclei of the neutrophils are lost during NET&nbsp;formation, leading to their death. Hence, they cannot phagocytose pathogens.</p>\n<p>NETs&nbsp;are <strong>networks </strong>of <strong>extracellular fibers</strong>&nbsp;that consist of a viscous meshwork of nuclear chromatin. They&nbsp;<strong>trap microbes</strong> at sites of infection, preventing their further spread. They also&nbsp;contain a high concentration of <strong>antimicrobial proteins</strong> like neutrophil elastase, cathepsin G, and histones that have a high affinity for DNA.</p>\n<p>They are <strong>produced by neutrophils</strong> in response to the following triggers:</p>\n<ul>\n<li>Pathogens<strong>&nbsp;</strong>- Mainly bacteria and fungi</li>\n<li>Inflammatory mediators<strong> -</strong>\n<ul>\n<li>Chemokines</li>\n<li>Cytokines (mainly interferons)</li>\n<li>Complement proteins</li>\n<li>Reactive oxygen species</li>\n</ul>\n</li>\n</ul>\n<p>NETs have also been detected in the blood during <strong>sepsis.</strong> In this condition,<strong> platelet activation</strong> is involved in NET formation</p>\n<p>The <strong>nuclear chromatin</strong> in the <strong>NETs</strong> is a <strong>source</strong> of <strong>nuclear antigens</strong>&nbsp;(histones and associated DNA) in systemic autoimmune diseases, particularly systemic lupus erythematosus (<strong>SLE</strong>). This triggers autoantibody production and further clinical manifestations.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '04 Acute Inflammation';
        const quizFilename = '04-acute-inflammation-f10bde3e.html';
        let hierarchy = ["Marrow", "qBank", "Pathology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>