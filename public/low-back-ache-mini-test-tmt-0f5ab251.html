<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Low Back Ache Mini Test - -Tmt - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2023-24
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A 25-year-old man presents with back pain that is unresponsive to aspirin. Radiographs show a well-demarcated lesion in the posterior spine and the size is estimated to be 3cm. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Osteosarcoma"
      },
      {
        "id": 2,
        "text": "Osteoid osteoma"
      },
      {
        "id": 3,
        "text": "Osteoblastoma"
      },
      {
        "id": 4,
        "text": "Chondroblastoma"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>This patient has back pain unresponsive to aspirin. CT scan shows a mass in the posterior spine of the vertebra. The given clinical scenario is suggestive of <strong>osteoblastoma</strong>.</p>\n<p>Osteoblastoma is a benign tumour of the bone that mainly involves the axial skeleton. It is differentiated from an osteoid osteoma by responsiveness to aspirin.\u00a0</p>\n<p>Histopathology shows well-circumscribed lesions composed of randomly <strong>interconnecting</strong> <strong>trabeculae</strong> of woven bone that are prominently <strong>rimmed</strong> by a single layer of osteoblasts.\u00a0Stroma surrounding the neoplastic bone consists of loose connective tissue that contains many <strong>dilated and congested capillaries</strong>.\u00a0</p>\n<p>The image below shows the histopathological findings in osteoblastoma.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/37f757dc241f45fe8868eedd9422c953.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6164edb71bed4728a7bd0b2d97285228x1280x2018.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2c59a1839deb469587252689465e3e29x1280x2018.JPEG"
    ]
  },
  {
    "text": "A patient comes with complaints of low back pain after lifting some heavy boxes. He has no neurological deficits. Which of the following will have no benefit for his symptoms?",
    "choices": [
      {
        "id": 1,
        "text": "Local diclofenac application"
      },
      {
        "id": 2,
        "text": "Spinal manipulation"
      },
      {
        "id": 3,
        "text": "Lumbar brace"
      },
      {
        "id": 4,
        "text": "Supervised exercises"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>This patient is presenting with <strong>acute low back pain</strong> after lifting heavy boxes. The likely etiology is a spasm of his paraspinal muscles. Out of the options listed, <strong>lumbar braces</strong> have been found to have no efficacy in ameliorating the symptoms of acute low back pain.</p>\n<p>Most cases of low back pain can be managed <strong>conservatively</strong> with <strong>NSAIDs</strong> and <strong>physical therapy</strong> and imaging is usually not required. However, there are certain indications that require <strong>urgent imaging</strong> and surgical management.\u00a0</p>\n<p>Indications for surgical management:\u00a0</p>\n<p>Absolute indications:</p>\n<ul>\n<li><strong>Failed conservative</strong> management.</li>\n<li>Marked progressive <strong>weakness</strong> of muscles.</li>\n<li><strong>Progressive</strong> neurological deficit.</li>\n<li>Cauda equina paralysis.</li>\n</ul>\n<p><br />Relative Indications:</p>\n<ul>\n<li><strong>Recurrent</strong> episodes of <strong>incapacitating</strong> sciatica</li>\n<li>Pain <strong>unrelieved</strong> by <strong>complete rest</strong> from activity.</li>\n</ul>\n<p>Conservative measures for management of low back ache include:</p>\n<ul>\n<li>Reassurance</li>\n<li><strong>NSAIDs</strong> and <strong>local diclofenac</strong> application(Option A)</li>\n<li><strong>Modifying activities</strong> to prevent future episodes</li>\n<li>Physical therapy under supervision (Option D)</li>\n<li><strong>Massages</strong> and <strong>heat therapy</strong> have been found to have <strong>moderate efficacy</strong> so they can be prescribed as per patient needs but should supplement the measures mentioned previously.\u00a0</li>\n<li>Spinal manipulation (Option B)</li>\n</ul>\n<p>Measures that have no proven efficacy in acute low back pain:</p>\n<ul>\n<li>Injection therapy</li>\n<li>Cold application</li>\n<li>Lumbar support\u00a0</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 65-year-old female patient comes with persistent backache not responding to conservative treatment. The pain starts radiating down her legs after walking for a distance of around 100 m. However, she feels no pain on walking uphill or when she bends on her cane. Which of the following would you consider in your differential diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "1,2,3"
      },
      {
        "id": 2,
        "text": "1,2,4"
      },
      {
        "id": 3,
        "text": "3,4,5"
      },
      {
        "id": 4,
        "text": "2,4,5"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario of an old woman with <strong>back pain</strong>\u00a0that <strong>worsens on walking</strong> and <strong>relieves walking uphill\u00a0</strong>or\u00a0<strong>on bending forward</strong> points to the diagnosis of<strong> neurogenic claudication</strong>. Out of the given conditions, <strong>Leriche syndrome</strong> and<strong> Chronic demyelinating polyneuropathy</strong> do not cause symptoms of neurogenic claudication. <strong>Walking uphill</strong> or <strong>bending forward </strong>may be <strong>preferred</strong> as it flexes the spine and <strong>maximizes the spinal canal capacity</strong>,\u00a0relieving the pain.\u00a0</p>\n<p><strong>Spinal stenosis</strong> is the narrowing of the spinal canal, causing nerve compression. It can be congenital or acquired, with<strong> degeneration</strong> being the <strong>most common cause</strong>. Other factors include conditions like spondylolysis, trauma, infection, and metabolic disorders.\u00a0</p>\n<p>Degenerative spinal stenosis involves\u00a0disc degeneration, facet joint hypertrophy, and ligamentum flavum calcification. These changes lead to <strong>reduced</strong> spinal canal dimensions and <strong>compression</strong> of the nerves resulting in <strong>neurogenic claudication</strong>.\u00a0</p>\n<p>Conditions that can present with neurogenic claudication:</p>\n<ul>\n<li>Osteoarthritis of the spine</li>\n<li>Ligamentum flavum fibrosis</li>\n<li>intervertebral disc prolapse</li>\n<li>Space occupying lesions in the spinal canals</li>\n<li>Paget's disease of the bone</li>\n<li>Rheumatoid arthritis</li>\n<li>Ankylosing spondylitis</li>\n<li>Trauma</li>\n</ul>\n<p>They present with symptoms such as <strong>back pain</strong> (most common), <strong>sciatica</strong>, sensory disturbances in the legs, motor weakness, and sometimes urinary disturbances. <strong>Pain</strong> typically occurs after <strong>standing or walking</strong> for a few minutes and is <strong>relieved by sitting, squatting</strong>, or <strong>flexing the spine</strong>.\u00a0</p>\n<p><strong>MRI</strong> is the imaging method of choice for the investigation of spinal stenosis.\u00a0<strong>Conservative treatment</strong> is the<strong> first line</strong> for spinal stenosis, including reassurance, pain relief, exercise, and activity modification.</p>\n<p><strong>Surgery</strong> is considered if conservative measures fail and there is significant functional impairment and severe neurological symptoms. <strong>Posterior</strong> <strong>decompression</strong> is the surgical method. <strong>Laminectomy</strong> is performed for central stenosis.\u00a0</p>\n<p>Other options:\u00a0</p>\n<p><strong>Leriche syndrome</strong> is a rare form of the <strong>aortoiliac occlusive disease</strong> (AIOD) that presents with the triad of <strong>intermittent claudication, erectile dysfunction,</strong> and <strong>absent femoral</strong> pulses. Obstruction of the superficial femoral artery causes claudication of the buttock or thigh. <strong>Absent distal pulses,</strong> bruit over the aortoiliac region, and associated or isolated discomfort of the calf can also be seen. There is however no relation to posture and pain in this condition.\u00a0</p>\n<p><strong>Chronic demyelination</strong> can cause involve the lumbosacral roots and cause pain, however there will be no pain with postural changes either.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient is being evaluated for new-onset low back pain 3 days after a hernia surgery. He has shooting pain that radiates to his legs from the back. He also hasn't been able to walk without support for the last 10 hours. Vitals are: Temp: 100 F, BP: 120/70mmhg, Pulse rate 115/min. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Exacerbation of disc prolapse"
      },
      {
        "id": 2,
        "text": "Spinal epidural abscess"
      },
      {
        "id": 3,
        "text": "Prolonged effect of anesthesia"
      },
      {
        "id": 4,
        "text": "Embolic stroke"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>This patient presents with <strong>low back pain</strong> with <strong>fever</strong> and <strong>decreased strength</strong> while walking. This after a surgery that requires <strong>spinal anesthesia(hernia</strong> surgery) should raise concerns for a <strong>spinal epidural abscess(SEA).</strong>\u00a0</p>\n<p>A spinal epidural abscess occurs when there is <strong>inoculation</strong> of an <strong>infectious agent</strong> in the <strong>epidural space,</strong> usually after a <strong>lumbar puncture</strong> or <strong>spinal anesthesia.</strong> It presents with the classic triad of <strong>low back</strong> pain, <strong>neurological deficits</strong> and <strong>fever,</strong> although not every patient may present with these symptoms. Occasionally, septic emboli from other parts of the body can also get entrapped in the epidural space and can cause abscess formation.\u00a0</p>\n<p>Diagnosis: Spinal imaging is required for suspected cases, and an <strong>MRI</strong> is the preferred mode of diagnosis. MRI can show the liquid part of the abscess surrounded by edema as an enhancement with T2 flair.\u00a0</p>\n<p>Treatment: Once diagnosis is established by imaging, <strong>urgent surgical debridement</strong> should be conducted, failing to do so can lead to permanent neurological deficits</p>\n<p><strong>Broad-spectrum</strong> antibiotics should be started and should be tailored to the organism once culture and sensitivity results are obtained.\u00a0</p>\n<p>Other options:<br />Option A: An exacerbation of disc prolapse would present with neurogenic claudication, but the presence of fever and a history of a possible lumbar puncture makes SEA more likely.\u00a0</p>\n<p>Option B: Prolonged anesthesia effect would be unlikely in this patient as it would not present with fever and low back ache.</p>\n<p>Option C: An embolus from the veins in the leg can cause an embolic stroke however, fever and low back ache would be unlikely.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A male patient, aged 60 years comes to the casualty with complaints of severe low back and flank pain. He has a past history of gout and a 30-pack-year smoking history. His BP is 100/60mmhg and his pulse is 120/minute. What is his likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Psoas abscess"
      },
      {
        "id": 2,
        "text": "Renal calculi impaction"
      },
      {
        "id": 3,
        "text": "Aortic aneurysm rupture"
      },
      {
        "id": 4,
        "text": "Mesenteric ischemia"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">This patient </span><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">w</span><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">ith a <strong>30-pack-year</strong> history of <strong>smoking</strong> presenting with <strong>severe abdominal</strong> and <strong>flank pain</strong> and unstable vitals(Low BP and increased pulse indicating hypovolemia) most likely has a <strong>ruptured abdominal aneurysm</strong>. As the abdominal aorta is <strong>retroperitoneal,</strong> when it ruptures, there can be irritation to the <strong>lumbar nerves</strong> which presents as <strong>abdominal</strong> and <strong>flank</strong> pain.\u00a0</span></p>\n<p><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">Abdominal aortic aneurysms</strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> are mostly asymptomatic and are detected as incidental findings on investigations for other complaints. Sometimes, they present with pain and pulsatile abdominal mass. Rupture of aneurysm presents with acute pain and hypotension.</span></p>\n<p>Management of <strong>stable</strong> abdominal aortic aneurysms:</p>\n<ul>\n<li><strong>Statins</strong>- atherosclerosis is the most common pathology associated with abdominal aortic aneurysms. Hence, statins are prescribed to reduce the risk of cardiovascular events.</li>\n<li><strong>Asymptomatic aneurysms &lt;5.5 cm in diameter</strong>- serial abdominal ultrasound to monitor the rate of expansion of the aneurysm.</li>\n<li><strong>Operative repair</strong> is indicated for:\n<ul>\n<li>Aneurysm of any size associated with symptoms</li>\n<li>Rapidly growing aneurysms</li>\n<li>Aneurysms\u00a0\u22655.5 cm in diameter</li>\n</ul>\n</li>\n</ul>\n<p>Note: Medical management with beta-blockers though helps in BP control, it is not effective in reducing the rate of growth of abdominal aortic aneurysms.</p>\n<p>The given image shows an <strong>unruptured</strong> abdominal aortic aneurysm on CT:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/bc63864be699443db27a6ea30ce078f5x1007x844.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f2d56b82c3f640bcb029f11e56a2a70ex630x539.JPEG"
    ]
  },
  {
    "text": "A lady at 35 weeks of gestation comes with complaints of low backache and a pressure-like sensation in her vagina. She has had Braxton-Hicks contractions since 32 weeks of gestation which have been managed conservatively. Which of the following will be your next step in management?",
    "choices": [
      {
        "id": 1,
        "text": "Reassure the patient and discharge"
      },
      {
        "id": 2,
        "text": "Do a fetal fibronectin test"
      },
      {
        "id": 3,
        "text": "Give indomethacin to reduce her pain"
      },
      {
        "id": 4,
        "text": "Advise complete bed rest"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>This patient at 35 weeks of <strong>gestation</strong> presents with <strong>low back ache</strong> and a <strong>pressure sensation</strong> in her vagina. This makes the likelihood of her having developed preterm labor high as low back ache is one of the <strong>signs</strong> of true labor. Thus a <strong>fetal fibronectin test</strong> should be done to rule out true labor pains to guide further management.\u00a0</p>\n<table style=\"width: 657px; height: 248px;\">\n<tbody>\n<tr>\n<td style=\"width: 219.21875px;\"><strong>Features</strong></td>\n<td style=\"width: 235.171875px;\"><strong>True labour pains</strong></td>\n<td style=\"width: 180.640625px;\"><strong>False labour pains</strong></td>\n</tr>\n<tr>\n<td style=\"width: 219.21875px;\">Cervical dilatation and effacement</td>\n<td style=\"width: 235.171875px;\">Present</td>\n<td style=\"width: 180.640625px;\">Absent</td>\n</tr>\n<tr>\n<td style=\"width: 219.21875px;\">Pain</td>\n<td style=\"width: 235.171875px;\">Lower abdomen and back, radiating to thighs</td>\n<td style=\"width: 180.640625px;\">Lower abdomen only</td>\n</tr>\n<tr>\n<td style=\"width: 219.21875px;\">Show</td>\n<td style=\"width: 235.171875px;\">Present</td>\n<td style=\"width: 180.640625px;\">Absent</td>\n</tr>\n<tr>\n<td style=\"width: 219.21875px;\">Bag of water</td>\n<td style=\"width: 235.171875px;\">Formed</td>\n<td style=\"width: 180.640625px;\">Absent</td>\n</tr>\n<tr>\n<td style=\"width: 219.21875px;\">Relief with enema</td>\n<td style=\"width: 235.171875px;\">No</td>\n<td style=\"width: 180.640625px;\">Yes</td>\n</tr>\n</tbody>\n</table>\n<p><strong>False labour pain</strong>\u00a0is\u00a0more in primigravidae than in parous women. It usually appears <strong>prior</strong> to the onset of <strong>true labor pain</strong> by 1 or 2 weeks in primigravidae and by a few days in multiparae.</p>\n<p>Such pains are probably due to stretching of the cervix and lower uterine segment with consequent irritation of the neighboring ganglia.</p>\n<p><strong>Fetal fibronectin</strong> in <strong>cervicovaginal secretions</strong> is used as a marker for impending preterm labor before membrane rupture. Qualitative and quantitative fetal fibronectin levels are measured using ELISA, and levels <strong>&gt;50 ng/mL</strong> is considered <strong>positive. </strong>Fetal fibronectin is a <strong>glycoprotein</strong> present in <strong>high concentrations</strong> in <strong>maternal blood</strong> and in <strong>amnionic fluid,</strong> however, sample contamination by amnionic fluid and mater\u00adnal blood should be avoided. It aids in <strong>intercellular adhesion</strong> during implantation and in the maintenance of placental adherence to uterine decidua. It <strong>reflects stromal remodeling</strong> of the <strong>cervix</strong> before labor.</p>\n<p>Preterm labor (PTL) refers to the onset of labor before the 37th completed week, counting from the first day of the last menstrual period.</p>\n<p>Other options:</p>\n<p>Option A: Reassurance would be appropriate in case of Braxton Hicks contractions which are false labor pains. They cause lower abdomen pain only so true labor should be ruled out first in this patient.</p>\n<p>Option C: Indomethacin can be used as a tocolytic before 32 weeks but should be avoided beyond that due to risk of PDA closure.</p>\n<p>Option D: Complete bed rest is seldom recommended(such as in conditions like placenta previa) in pregnancy due to increased risk of DVT.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 49-year-old man suffering complains of low back pain. He has a past history of prostate adenocarcinoma which was treated with resection. An abdominal radiograph showed osteoblastic changes in the spine. What is the most likely route of spread in this scenario?",
    "choices": [
      {
        "id": 1,
        "text": "Sacral canal"
      },
      {
        "id": 2,
        "text": "Lymphatic vessels"
      },
      {
        "id": 3,
        "text": "Internal vertebral plexus of veins"
      },
      {
        "id": 4,
        "text": "Superior rectal vein"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Carcinoma</strong> of the <strong>prostate</strong> spreads via the <strong>internal vertebral plexus</strong> of veins to the <strong>spine.</strong>\u00a0</p>\n<p>Hematogenous spread of carcinoma prostate occurs<strong>\u00a0predominantly\u00a0</strong>in the<strong>\u00a0bones</strong>\u00a0and is\u00a0typically<strong>\u00a0osteoblastic.</strong></p>\n<p>The commonly involved\u00a0bones in decreasing order of frequency: \u00a0</p>\n<ul>\n<li>Lumbar spine</li>\n<li>Proximal femur</li>\n<li>Pelvis</li>\n<li>Thoracic spine</li>\n<li>Ribs</li>\n</ul>\n<p>The abdominal radiograph below shows osteoblastic changes in the spine, pelvic, and femoral bones due to metastasis from prostate carcinoma (arrows).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/afaef4e959494a2f9056f4ef177540e2x633x766.JPEG"
    ]
  },
  {
    "text": "You are in the low back pain clinic. Which of these patients with low back pain will you evaluate further?",
    "choices": [
      {
        "id": 1,
        "text": "1,3,4"
      },
      {
        "id": 2,
        "text": "2,3,5"
      },
      {
        "id": 3,
        "text": "2,4,5"
      },
      {
        "id": 4,
        "text": "1,3,5"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Low back pain should be evaluated further in patients with an <strong>increased</strong> risk of <strong>fractures.</strong> In the conditions mentioned above, a past history of <strong>anorexia</strong> with a <strong>current low body weight, rheumatoid arthritis,</strong> and a <strong>previous history</strong> of <strong>fractures</strong> are a current risk for fractures. Hence these patients should be further evaluated for <strong>vertebral compression</strong> fractures and danger signs like neurologic deficits.</p>\n<p>Factors that indicate increased risk of a <strong>fracture independent</strong> of <strong>bone mineral</strong> density:</p>\n<ul>\n<li><strong>Advancing</strong> age</li>\n<li>History of eating disorders and low body weight</li>\n<li>A <strong>previous history</strong> of fracture</li>\n<li>Ongoing <strong>glucocorticoid</strong> therapy</li>\n<li>Current <strong>cigarette</strong> smoking( If a patient has stopped smoking for more than 5 years he is at the same risk as the general population)</li>\n<li>Excessive <strong>alcohol</strong> consumption(8 drinks a week for women, 15 drinks a week for men)</li>\n<li><strong>Rheumatoid arthritis</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 10-year-old boy is brought with complaints of low back pain after playing that has been progressively increasing and is not responding to analgesia.  He is also having urinary incontinence and occasional gait abnormalities. His mother is a known case of rheumatoid arthritis and hadn't stopped taking her medication till the 2nd month of gestation as it was an unplanned pregnancy. What is the likely diagnosis of this child?",
    "choices": [
      {
        "id": 1,
        "text": "Caudal regression syndrome"
      },
      {
        "id": 2,
        "text": "Tethered cord syndrome"
      },
      {
        "id": 3,
        "text": "Subacute combined degeneration of the spinal cord"
      },
      {
        "id": 4,
        "text": "Transverse myelitis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>This child presents with complaints of <strong>low back pain</strong> with additional features of <strong>urinary incontinence</strong> and <strong>gait abnormalities.</strong> This combined with the history of <strong>rheumatoid arthritis</strong> in his <strong>mother(</strong>probable methotrexate intake) raises concerns of a <strong>closed spinal dysraphism</strong> called <strong>Tethered cord syndrome.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/903c8c57b514439a884403972b4ac8c7x1280x1139.JPEG"
    ]
  },
  {
    "text": "A young male patient presented to the OPD with complaints of early morning backache and stiffness which improves on exercise. The physician orders an x-ray spine which is given below. Which joint is affected the earliest in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Intervertebral joint"
      },
      {
        "id": 2,
        "text": "Hip joint"
      },
      {
        "id": 3,
        "text": "Metacarpophalangeal joint"
      },
      {
        "id": 4,
        "text": "Sacroiliac joint"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The <strong>sacroiliac joint</strong> is the <strong>most common</strong> and <strong>earliest</strong> joint affected by this condition.</p>\n<p>The clinical history and x-ray are suggestive of <strong>ankylosing spondylitis</strong>. It is a type of <strong>seronegative spondyloarthritis</strong> (Rheumatoid factor negative) characterized by <strong>early morning stiffness</strong> and<strong> backache</strong> which<strong> improves with exercise</strong>. The majority of the patients who suffer from ankylosing spondylitis are <strong>HLA-B27 positive</strong>.</p>\n<p>X-ray spine shows fused vertebrae looking like a bamboo tree (<strong>bamboo spine</strong>) which is characteristic of ankylosing spondylitis. Other clinical features are <strong>loss of lumbar lordosis</strong>, increased thoracic kyphosis, diminished spinal movements, and</p>\n<p>X-ray findings:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Erosion of sacroiliac joints-&nbsp;<strong>earliest sign</strong></li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Periarticular sclerosis in later stages&nbsp;</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Squaring of vertebrae</strong> due to the flattening of normal anterior concavity of the vertebral body is the earliest vertebral change</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Bamboo spine appearance due to bridging of adjacent vertebrae</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Wedging of the vertebra leading to hyperkyphosis</li>\n</ul>\n<p>Complications of ankylosing spondylitis include</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Spinal fractures&nbsp;</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Hyperkyphosis</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Spinal cord compression</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Lumbosacral nerve root compression</li>\n</ul>\n<p>Extra-articular manifestations include <strong>anterior uveitis</strong>, aortic incompetence, carditis, and apical lobe fibrosis.</p>\n<p>Treatment consists of maintaining posture and preserving mobility. Pain and stiffness can be controlled with anti-inflammatory drugs. In severe cases, TNF inhibitors are used. Surgery can be considered to correct the deformity.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a67eff9b49e543d2b10fa1d30fef0e00.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/30e932a5485244a6b3dde553cc25f522x600x2086.JPEG"
    ]
  },
  {
    "text": "A 35-year-old woman presents with new onset low back pain associated with neurological deficits. She has muted knee jerk and exaggerated ankle jerk reflexes and urge incontinence of the bladder. SLRT is negative. She has had episodes of a shock-like sensation along her back in the past but didn't seek medical help. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Transverse myelitis"
      },
      {
        "id": 2,
        "text": "Guillain barre syndrome"
      },
      {
        "id": 3,
        "text": "Ankylosing spondylitis"
      },
      {
        "id": 4,
        "text": "Systemic lupus erythematosus"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>This patient presents with new onset low back pain with a <strong>muted knee jerk</strong> reflex(flaccid paralysis) and an <strong>exaggerated ankle jerk</strong> reflex indicating a <strong>lesion</strong> at the <strong>L3</strong> and <strong>L4</strong> spinal levels. The presence of an <strong>electric shock-like</strong> sensation in a <strong>middle-aged</strong> woman makes a diagnosis of transverse myelitis the likely diagnosis. The shock-like sensation indicate an undiagnosed case of <strong>multiple sclerosis.</strong>\u00a0</p>\n<p><strong>Transverse myelitis</strong> is a condition characterized by inflammation of a discrete spinal level which presents with upper motor neuron symptoms below the level of the lesion and lower motor neuron lesions at the level of the lesion. There can also be additional loss of sensation and proprioception based on the degree of inflammation.\u00a0</p>\n<p>TM is associated with other <strong>autoimmune</strong> conditions like <strong>multiple sclerosis</strong> and <strong>neuromyelitis optica.</strong></p>\n<p><strong>Diagnosis:</strong> TM usually has a <strong>clearly defined</strong> sensory loss at a particular <strong>level. MRI</strong> shows a <strong>T2 hyperintense</strong> signal.</p>\n<p>There should be no <strong>compressive</strong> lesion in the MRI.\u00a0</p>\n<p><strong>Treatment:</strong> IV <strong>Glucocorticoids</strong> and plasma exchange therapy if it is unresponsive to glucocorticoids.\u00a0</p>\n<p>Other options:</p>\n<p>Option B: <strong>Guillian-Barr\u00e9</strong> syndrome (GBS) is an acute, <strong>autoimmune</strong> polyneuropathy. The usual presentation is <strong>symmetrical, ascending paralysis</strong> evolving over hours to a few days. The legs are usually more affected than the arms. <strong>Lower cranial</strong> nerves are also frequently involved, causing <strong>bulbar</strong> weakness and difficulty in <strong>maintaining</strong> an <strong>airway</strong> and handling secretions. <strong>Deep tendon</strong> reflexes also <strong>attenuate</strong> or <strong>disappear</strong> within a few days of onset.\u00a0</p>\n<p>Option C: <strong>Ankylosing spondylitis</strong> is a type of <strong>seronegative spondyloarthritis</strong> (Rheumatoid factor negative) characterized by <strong>early morning stiffness</strong> and <strong>backache</strong> which improves with exercise. The majority of the patients who suffer from ankylosing spondylitis are <strong>HLA-B27</strong> positive. Other clinical features are loss of <strong>lumbar lordosis, increased</strong> thoracic <strong>kyphosis</strong> and diminished spinal movements.</p>\n<p>\u00a0Option D: <strong>Systemic lupus erythematosus</strong> (SLE) is an autoimmune disorder that results in damage to <strong>multiple organs</strong> and organ systems in the body most commonly seen in women of <strong>reproductive age.</strong> It is associated with the presence of elevated antinuclear antibodies. Neurologic manifestations include <strong>distal polyneuropathies.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following patients with low back pain will you advise conservative management for?",
    "choices": [
      {
        "id": 1,
        "text": "A 23-year-old man with a history of IV drug abuse"
      },
      {
        "id": 2,
        "text": "A 45-year-old man with a past history of IV corticosteroids use"
      },
      {
        "id": 3,
        "text": "A 65-year-old woman with breast cancer in remission"
      },
      {
        "id": 4,
        "text": "A 34-year-old woman with new onset fever"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Out of the 4 options listed, a male with a <strong>past history</strong> of <strong>corticosteroid</strong> use with no <strong>current use</strong> is least likely to have any serious underlying etiology and will thus be <strong>managed conservatively.</strong> All the other scenarios are patients who have red flag signs for low back ache and should be evaluated further.\u00a0</p>\n<p><strong>Red flag</strong> signs for serious underlying conditions in low back pain:\u00a0</p>\n<ol>\n<li>Age less than 20 years or more than 55 years\u00a0</li>\n<li>Recent <strong>trauma</strong></li>\n<li><strong>No relief</strong> even after <strong>conservative</strong> management</li>\n<li><strong>Past</strong> history of <strong>malignancy</strong></li>\n<li><strong>IV drug</strong> use\u00a0</li>\n<li><strong>Immunosuppression, corticosteroid use</strong></li>\n<li>HIV</li>\n<li><strong>Neurological deficits</strong>\u00a0</li>\n<li>Fever</li>\n</ol>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d6cde8c273934eb8b4a2dc4970eaf4f6x1280x1102.JPEG"
    ]
  },
  {
    "text": "A patient presents to you with severe low back pain that radiates to the groin since 4 hours. An abdominal X-ray is shown below. Which of the following will not be used in his management?",
    "choices": [
      {
        "id": 1,
        "text": "Ibuprofen"
      },
      {
        "id": 2,
        "text": "Phenylephrine"
      },
      {
        "id": 3,
        "text": "Tamsulosin"
      },
      {
        "id": 4,
        "text": "Nifedipine"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>This patient with <strong>complaints</strong> of <strong>low back pain</strong> radiating to the groin with radiopaque masses on X-ray in the <strong>ureters</strong> likely has <strong>ureterolithiasis.</strong> This can cause <strong>flank</strong> and <strong>low back pain</strong> and <strong>radiate</strong> to the <strong>groin. Phenylephrine</strong> has no role in the management of ureterolithiasis as it increases the <strong>spasmodic</strong> effect of the <strong>smooth muscles</strong> and can worsen the colic.</p>\n<p>For the management of a patient with an <strong>impacted renal stone,</strong> first the size of the stone should be ascertained and if it is less than 6mm, then it can pass through the ureters and the bladders.\u00a0</p>\n<ul>\n<li>Patients should be given adequate pain control with NSAIDs and if required, opioids.</li>\n<li>Alpha blockers like <strong>tamsulosin</strong> and <strong>nifedipine</strong> which is a calcium channel blocker causes relaxation of the ureteric smooth muscles and allow the stone to pass easily.</li>\n</ul>\n<p><strong>Percutaneous nephrolithotomy</strong> is the preferred treatment for large renal stones of a diameter of more than 1.5-2.5 cm, in the presence of multiple stones</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ade73470e68a41419f0856edc63c8277.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A patient with a history of IV drug abuse comes with complaints of low back pain for 6 weeks. Physical examination shows point tenderness at the L2 vertebra. His temperature is 102 F. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Tuberculosis spine"
      },
      {
        "id": 2,
        "text": "Vertebral osteomyelitis"
      },
      {
        "id": 3,
        "text": "Spinal epidural abscess"
      },
      {
        "id": 4,
        "text": "Vertebral compression fracture"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>This patient with a history of <strong>IV drug abuse</strong> with <strong>point tenderness</strong> at the <strong>L2 vertebra</strong> and a <strong>fever</strong> likely has developed <strong>vertebral osteomyelitis.</strong>\u00a0</p>\n<p><strong>Vertebral osteomyelitis</strong> is an infection of the vertebrae that occurs due to <strong>inoculation</strong> of <strong>bacterial microthrombi</strong> from an external source or due to a <strong>pricking injury</strong> to the <strong>spine.</strong> Here, IV drug abuse increases the risk of bacterial spread. Once there is bacterial inoculation, the infection follows the same course as <strong>osteomyelitis</strong> in any other bone in the body. This can present as <strong>bone pain</strong> and increases the risk of <strong>pathological fractures.</strong>\u00a0</p>\n<p><strong>Diagnosis</strong> is established by <strong>imaging,</strong> mainly by <strong>MRI,</strong> which shows a <strong>decreased T1 signaling</strong> and an <strong>increased T2 signaling.</strong>\u00a0</p>\n<p>Treatment is via <strong>antibiotics</strong> for up to <strong>6 weeks. Surgical debridement</strong> is indicated only in cases of <strong>neurological deficits.</strong></p>\n<p>Other options:\u00a0</p>\n<p>Option A: TB spine(Pott's spine) occurs secondary to a <strong>pulmonary</strong> or <strong>gastrointestinal primary</strong> and spreads through the <strong>Batson's plexus</strong> of <strong>veins</strong> (paravertebral plexus). It most commonly involves the <strong>dorso-lumbar</strong> region. It can present with back pain and fever, but this patients IV drug abuse makes vertebral osteomyelitis more likely.</p>\n<p>Option C: A spinal epidural abscess occurs when there is <strong>inoculation</strong> of an <strong>infectious agent</strong> in the epidural space, usually after a <strong>lumbar puncture</strong> or <strong>spinal anesthesia.</strong> It presents with the classic triad of <strong>low back pain, neurological deficits</strong> and <strong>fever,</strong> although not every patient may present with these symptoms. Occasionally, <strong>septic emboli</strong> from other parts of the body can also get entrapped in the epidural space and can cause <strong>abscess</strong> formation. This patient has no risk factors for developing an <strong>epidural abscess.</strong></p>\n<p>Option D: A <strong>vertebral fracture</strong> can present with a <strong>tender spine</strong> but there is usually no fever thus making osteomyelitis the likely diagnosis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 10-year-old child came with complaints of pain abdomen over the lower back and lower right quadrant pain. He has a past history of  untreated osteomyelitis of the tibia. On examination, the patient had pain on passive extension of the hip over the right side with a mass in the right lumbar region pointing towards the groin. What is the most probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Pyelonephritis"
      },
      {
        "id": 2,
        "text": "Psoas Abscess"
      },
      {
        "id": 3,
        "text": "Appendicitis"
      },
      {
        "id": 4,
        "text": "Torsion of Right undescended testis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>This patient has a history of <strong>abdominal pain</strong> and a mass in the right <strong>lumbar</strong> region, with pain on <strong>passive extension</strong> of<strong> </strong>the<strong>\u00a0right hip. </strong>This, combined with the past history of <strong>osteomyelitis</strong>\u00a0suggests the diagnosis of psoas abscess.\u00a0</p>\n<p><strong>Psoas abscess</strong> occurs due to a <strong>collection</strong> of <strong>pus</strong> in the <strong>iliopsoas compartment.</strong> The compartment is <strong>retroperitoneal</strong> and hence, the abscess is also called a <strong>retroperitoneal</strong> abscess. The compartment contains <strong>iliacus</strong> and <strong>iliopsoas</strong> muscles. The psoas compartment muscles lie in <strong>close proximity</strong> to <strong>major abdominal organs</strong> and is richly supplied by iliolumbar, external iliac and common femoral arteries. Owing to these reasons, there is <strong>hematogenous</strong> spread of infections like <strong>tuberculosis</strong> or <strong>osteomyelitis</strong> leading to abscess. The abscess can present with a <strong>mass pointing towards</strong> the <strong>groin,</strong> which indicates the <strong>tracking</strong> of the <strong>infection</strong> into the <strong>iliopsoas</strong> muscle.\u00a0</p>\n<p>Clinical presentation is with <strong>back pain, fever,</strong> and lassitude. The hip may be in fixed flexion or there may be pain on passive extension.<br />CT is performed for diagnosis. Treatment is with percutaneous CT-guided drainage and antibiotic therapy.</p>\n<p><strong>Option</strong> <strong>A</strong>: <strong>Pyelonephritis</strong> usually associated with <strong>sudden onset</strong> pain in the <strong>flank</strong> and <strong>hypochondria</strong> (not in l<strong>umbar</strong> region).</p>\n<p><strong>Option C</strong>: <strong>Appendicitis</strong> is a close differential and often presents with <strong>pain</strong> on passive <strong>extension</strong> of <strong>right thigh</strong> (Psoas Sign). The presence of a mass in the <strong>right lumbar</strong> region that <strong>points towards</strong> the <strong>groin</strong> makes appendicitis less likely.</p>\n<p><strong>\u00a0Option D</strong>: Testicular torsion is estimated to be 10 times more common in undescended than in normal. Testicular torsion can occur at any age. Torsion of an undescended testis may occur in the setting of <strong>testicular</strong> tumor, presumably caused by increased size presenting as inguinal awelling and<strong> empty scrotum</strong> which is not defined in this case.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 25-year-old female presents with cyclical low back pain that occurs a few days prior to her menses and reduces after her menses terminate. She also has severe abdominal cramps during menses. Pelvic examination shows an immobile uterus. What is the likely cause of her symptoms?",
    "choices": [
      {
        "id": 1,
        "text": "Enlarged ovarian cyst"
      },
      {
        "id": 2,
        "text": "Rupture of the Graafian follicle"
      },
      {
        "id": 3,
        "text": "Premenstrual syndrome"
      },
      {
        "id": 4,
        "text": "Ectopic endometrial tissue"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>This patient presenting with symptoms of cyclical low back pain<strong>\u00a0</strong>and<strong> dysmenorrhea</strong> with an <strong>immobile uterus </strong>most likely has <strong>endometriosis</strong>. The likely etiology of her symptoms is the presence of <strong>ectopic endometrial tissue</strong> in her vertebrae.</p>\n<p><strong>Endometriosis\u00a0</strong>is a condition that is characterized by the presence of endometrial tissue in ectopic sites such as:</p>\n<ul>\n<li>Ovary (chocolate cysts- left/right lower quadrant pain)</li>\n<li>Pouch of Douglas (pain during defecation)</li>\n<li>Uterosacral ligaments (chronic pelvic pain &amp; infertility)</li>\n<li>Appendix (right lower quadrant pain)</li>\n<li>Lower segment cesarean section (LSCS) scar endometriosis</li>\n<li>Umbilicus</li>\n<li>Lung (cyclical hemoptysis)</li>\n<li>Vertebrae(Rare)</li>\n</ul>\n<p>These <strong>extra-uterine</strong> sites of <strong>endometrial</strong> tissue are influenced by <strong>cyclical changes</strong> in the hormone levels which give rise to <strong>location-specific symptoms</strong> as mentioned above.</p>\n<p>Management:</p>\n<p>Investigations include:</p>\n<ul>\n<li>USG: <strong>TVS</strong> will show a chocolate cyst.</li>\n<li>MRI</li>\n<li>CA-125 more than 35 U/mL</li>\n<li><strong>Laparoscopy</strong>: <strong>Gold standard</strong> for the diagnosis and treatment of endometriosis. It is used to locate the sites, take a biopsy and surgically remove the deposits.</li>\n</ul>\n<p>Drugs used for symptom control include the following:</p>\n<ul>\n<li>Oral contraceptive pills</li>\n<li>Mirena IUD</li>\n<li>GnRH analogs</li>\n<li>Letrozole</li>\n</ul>\n<p>Surgical management includes:</p>\n<p><strong>Minimally invasive surgery</strong> may be used to destroy the tissue by cautery, laser vaporization, and lyse adhesions that have formed as a complication of endometriosis.</p>\n<p><strong>Major surgical measures</strong> include incision of chocolate cyst and removal of lining, salpingo-oophorectomy, hysterectomy, and unilateral or bilateral salpingo-oophorectomy.</p>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 40-year-old male presents with low back pain for 1 month. He was laid off 5 months ago, and since then he's had increased sleep, sadness, and a decreased appetite. He spends his whole day in bed due to fatigue. He worries about his future. Physical examination reveals no abnormalities and his affect shows sadness. What is the likely etiology of his back pain?",
    "choices": [
      {
        "id": 1,
        "text": "Postural back pain"
      },
      {
        "id": 2,
        "text": "Depression"
      },
      {
        "id": 3,
        "text": "Malingering"
      },
      {
        "id": 4,
        "text": "Fusion of the vertebrae"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>This patient who lost his job 5 months ago is now presenting with <strong>low back pain.</strong> His past history of decreased appetite, sleep changes, sadness and fatigue suggests that he has major depressive disorder.\u00a0 Physical examination is however normal. The likely <strong>etiology</strong> of his <strong>back pain</strong> is his <strong>depression disorder,</strong> with the depression contributing as a <strong>stressor</strong> leading to <strong>physical manifestations.</strong>\u00a0</p>\n<p>The diagnostic criteria for major depressive disorder are:</p>\n<p>A. Five or more of the following symptoms have been present during the same 2-week period. Atleast one of the symptoms is either depressed mood or loss of interest or pleasure.</p>\n<ul>\n<li><strong>Depressed</strong> mood most of the day</li>\n<li>Markedly diminished interest or pleasure in activities (anhedonia)</li>\n<li>Significant weight loss when not dieting or weight gain, <strong>decrease</strong> or <strong>increase</strong> in <strong>appetite</strong></li>\n<li><strong>Insomnia</strong> or hypersomnia</li>\n<li><strong>Psychomotor agitation</strong> or <strong>retardation</strong></li>\n<li><strong>Fatigue</strong> or loss of energy</li>\n<li>Feelings of worthlessness or excessive or inappropriate guilt</li>\n<li><strong>Diminished</strong> ability to think or concentrate, or indecisiveness</li>\n<li>Recurrent thoughts of death, recurrent suicidal ideation</li>\n</ul>\n<p>B. The symptoms cause clinically significant distress or impairment in social, occupa\u00adtional, or other important areas of functioning.</p>\n<p>C. The episode is not attributable to the physiological effects of a substance or to another medical condition.</p>\n<p>D. The occurrence of the major depressive episode is not better explained by schizoaf\u00adfective disorder, schizophrenia, schizophreniform disorder, delusional disorder, or other specified and unspecified schizophrenia spectrum and other psychotic disorders.</p>\n<p>E. There has never been a manic episode or a hypomanic episode.</p>\n<p>Many mental conditions can have physical manifestations and in the absence of any organic lesions, the patient must be counselled further regarding the same.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 63-year-old woman presented with low back pain and back stiffness. An X-ray spine was done which is shown below. Which of the following statements is true regarding the condition she is suffering from?",
    "choices": [
      {
        "id": 1,
        "text": "It does not require medical intervention"
      },
      {
        "id": 2,
        "text": "Lateral curve >10 degrees is seen in this condition"
      },
      {
        "id": 3,
        "text": "It does not affect the functioning of vital organs"
      },
      {
        "id": 4,
        "text": "It is rarely idiopathic"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario and X-ray are suggestive of&nbsp;<strong>scoliosis</strong>.&nbsp;In this condition, the<strong> lateral curvature</strong> of the spine is&nbsp;<strong>&gt; 10 degrees&nbsp;</strong>in the coronal plane, in the upright position.</p>\n<p>Scoliosis deranges the load and force transmission mechanism through the spine. It is most <strong>commonly</strong> an <strong>idiopathic</strong> condition. It <strong>jeopardizes</strong> the functioning of <strong>vital organs</strong> like the lungs and heart through overcrowding of ribs.</p>\n<p><strong>Medical intervention</strong> is indicated if the <strong>lateral curvature</strong> is <strong>&gt;25 degrees</strong>. Various modalities include <strong>brace</strong> application and <strong>surgical correction</strong>.&nbsp;</p>\n<p>Note: If the&nbsp;<strong>lateral curve</strong> of the spine&nbsp;is <strong>&lt;</strong>&nbsp;<strong>10</strong> <strong>degrees</strong> then it is known as<strong> spinal asymmetry</strong>. &nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/4c6979ea10134809a38a3b7f406290ef.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "The oblique spinal X-ray of a patient having chronic low-back ache is given below.  What is the sign seen here called?",
    "choices": [
      {
        "id": 1,
        "text": "Spur sign"
      },
      {
        "id": 2,
        "text": "Beheaded\u00a0Scottish terrier sign"
      },
      {
        "id": 3,
        "text": "Corduroy sign"
      },
      {
        "id": 4,
        "text": "Polka dot sign"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In the X-ray given, there is a <strong>break in</strong> the <strong>pars interarticularlis</strong> of the L4 vertebra, which appears like a beheaded&nbsp;Scottish terrier. Hence, it is known as<strong> beheaded&nbsp;Scottish terrier sign</strong>&nbsp;and it is diagnostic of <strong>spondylolisthesis</strong>.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/036eb0f315bb480bb47bda36596d2838.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b2e117da7ba14b1d84b4f94f2626c13ex319x356.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/bc396e7dc6994218ae352d9f143d045fx934x606.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9f69de3e47914535899a2054dbe51fe7x1280x1361.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c8b163367cc447b68425ea6eb273497bx1280x1361.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1a4ffed8b99442a1b1d1df37402e7c49x1280x1360.JPEG"
    ]
  },
  {
    "text": "A patient with low back pain is diagnosed to have intervertebral disc prolapse between L3 and L4. Which of the following findings is least likely to be seen in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Sensory loss on the medial shin"
      },
      {
        "id": 2,
        "text": "Diminished ankle jerk"
      },
      {
        "id": 3,
        "text": "Pain along anterior thigh"
      },
      {
        "id": 4,
        "text": "Diminished knee jerk"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Diminished ankle jerk</strong>&nbsp;corresponds to <strong>S1</strong> nerve root involvement, which is suggestive of&nbsp;<strong>disc prolapse</strong> between <strong>L5-S1</strong>.&nbsp;</p>\n<p>When there is an <strong>L3-L4</strong> <strong>prolapse</strong>, the <strong>L4 nerve root</strong> is involved. <strong>Pain</strong> is felt in the lumbar region and radiates along the<strong> anteromedial</strong> aspect of the<strong> thigh</strong>.</p>\n<p>There is a <strong>sensory loss</strong> on the posterolateral thigh, anterior knee, medial malleolus, medial foot, and&nbsp;<strong>medial shin</strong>. There is&nbsp;<strong>weakness</strong> of the<strong> quadriceps</strong> muscles leading to reduced to <strong>absent</strong>&nbsp;<strong>knee jerk</strong>. This is known as <strong>Westphal's sign</strong>.<strong><br /></strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = 'Low Back Ache Mini Test - -Tmt';
        const quizFilename = 'low-back-ache-mini-test-tmt-0f5ab251.html';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2023-24"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>