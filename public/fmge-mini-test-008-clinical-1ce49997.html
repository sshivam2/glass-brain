<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fmge Mini Test - 008 (Clinical) - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / FMGE Mini Test Series / 2023
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">30</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A 55-year-old male presented with angina. Coronary angiography revealed a block in the right coronary artery. The condition is likely to cause a \u200bdecrease in blood supply through all of the following blood vessels except:",
    "choices": [
      {
        "id": 1,
        "text": "Acute marginal"
      },
      {
        "id": 2,
        "text": "Posterior interventricular artery"
      },
      {
        "id": 3,
        "text": "Artery to SA node"
      },
      {
        "id": 4,
        "text": "Circumflex artery"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Circumflex artery </strong>is<strong> not a branch </strong>of the <strong>right coronary artery.&nbsp;</strong>It is a branch of the left coronary artery.</p>\n<p>The branches of the right coronary artery are:</p>\n<ul>\n<li><strong>Right conal artery</strong> - It is the first branch of the right coronary artery.</li>\n<li><strong>Artery of the SA node&nbsp;</strong></li>\n<li><strong>Acute right marginal artery&nbsp;</strong></li>\n<li><strong>Posterior interventricular artery</strong> (in 65% population)</li>\n<li>Atrial and anterior and posterior ventricular branches</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/76895c44dd884e8da76d1d984b81bad5x1280x2059.JPEG"
    ]
  },
  {
    "text": "A patient with parathyroid deficiency 10 days after inadvertent damage to the parathyroid glands during thyroid surgery would probably have",
    "choices": [
      {
        "id": 1,
        "text": "Low plasma phosphate and Ca2+ levels and tetanus."
      },
      {
        "id": 2,
        "text": "Low plasma Ca2+ level, increased muscular excitability, and upper extremity muscle spasms."
      },
      {
        "id": 3,
        "text": "High plasma phosphate and Ca2+ levels and bone demineralization."
      },
      {
        "id": 4,
        "text": "Increased muscular excitability, a high plasma Ca2+ level, and bone demineralization"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<div class=\"page\" title=\"Page 966\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Parathyroid hormone deficiency leads to<strong> low Ca+2 levels and tetany.</strong> (Not tetanus, caused by an infection of bacteria&nbsp;<em>Clostridium tetani</em>)</p>\n<p>Actions of PTH include</p>\n<ul>\n<li>PTH stimulates bone resorption, causing the release of calcium into the extracel&shy;lular fluid;</li>\n<li>PTH <strong>increases</strong> reabsorption of <strong>calcium</strong> and <strong>decreases</strong> <strong>phosphate</strong> reabsorption by the renal tubules, leading to decreased excretion of calcium and increased excretion of phosphate; and</li>\n<li>PTH is necessary for the conversion of 25&shy;-hydroxycholecalciferol to 1,25&shy; dihydroxycholecalciferol, which, in turn, increases calcium absorption by the intestines.&nbsp;</li>\n</ul>\n<p>So, a <strong>deficiency</strong> of PTH would lead to <strong>low Ca+2</strong> levels and <strong>high phosphate</strong> levels.&nbsp;</p>\n<div class=\"page\" title=\"Page 393\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>The signs of tetany in humans include <strong>Chvostek sign</strong>, a quick contraction of the ipsilateral facial muscles elicited by tapping over the facial nerve at the angle of the jaw, and <strong>Trousseau sign</strong>, a spasm of the muscles of the upper extremity that causes flexion of the wrist and thumb.</p>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://cdn1.dailyrounds.org/uploads/f4c16818d8364ff1b989df4411075b41x330x389.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/740cce11a46044db98e3e9cde3d86238x518x390.JPEG"
    ]
  },
  {
    "text": "A 6-month-old boy was admitted with failure to thrive. Laboratory tests showed hypoglycemia and high glutamine and uracil levels in urine. Gastric tube feeding was not tolerated. The child became comatose and then parenteral dextrose was given. The child recovered from coma within 24 hours. What is the likely enzyme defect?",
    "choices": [
      {
        "id": 1,
        "text": "Carbamoyl phosphate synthase I"
      },
      {
        "id": 2,
        "text": "Ornithine transcarbamoylase"
      },
      {
        "id": 3,
        "text": "Argininosuccinate synthase"
      },
      {
        "id": 4,
        "text": "Argininosuccinate lyase"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>From the given clinical scenario, the diagnosis is <strong>hyperammonemia type 2,&nbsp;</strong>which is&nbsp;due to the&nbsp;<strong>deficiency </strong>of the enzyme <strong>ornithine transcarbamoylase.</strong></p>\n<p>There is an accumulation of carbamoyl phosphate, which&nbsp;then enters into <strong>pyrimidine synthesis</strong>&nbsp;producing orotic acid and uracil&nbsp;and leading to <strong>orotic aciduria</strong> and <strong>high uracil</strong> in blood and urine.</p>\n<p><strong>High glutamine:</strong> Since the ammonia from glutamine is not converted into urea, its level increases. Glutamate is not regenerated.</p>\n<p><strong>Hypoglycemia:</strong>&nbsp;Since glutamate is not available for transamination, amino acids cannot be used for gluconeogenesis. Hence, the glucose level drops in blood.</p>\n<p><strong>Treatment:</strong></p>\n<p>Limiting intake of ammonia and increasing its excretion. Dietary protein, a metabolic source of ammonium, is restricted and caloric intake is provided by glucose and fat.</p>\n<p>Addition of <strong>Phenylbutyrate</strong> which scavenges nitrogen.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 20-year-old woman presenting with fatigue and weakness shows the following laboratory values: Hemoglobin 9 gm%; MCV  70 fl; MCH 22 pg/cell; and RDW 28. There is no history of blood transfusion. The peripheral smear is as seen below. What is the most likely diagnosis of the patient?",
    "choices": [
      {
        "id": 1,
        "text": "Thalassemia major"
      },
      {
        "id": 2,
        "text": "Thalassemia minor"
      },
      {
        "id": 3,
        "text": "Iron-deficiency anemia"
      },
      {
        "id": 4,
        "text": "Anemia of chronic disease"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The above peripheral smear showing microcytic, hypochromic blood picture with pencil cells implies that the most likely diagnosis for the patient is iron-deficiency anemia.&nbsp;</p>\n<p><strong>Hemogram:</strong></p>\n<ul>\n<li>MCV of 70 fl is suggestive of&nbsp;<strong>microcytosis&nbsp;</strong>(normal MCV is 82&ndash;96 fl)</li>\n<li>MCH of 22 pg is suggestive of<strong> hypochromia&nbsp;</strong>(normal MCH is 27&ndash;33 pg/cell)</li>\n<li>Red cell distribution width (RDW) of 28 is suggestive of <strong>anisocytosis</strong> (normal RDW is 11.5-14.5%).</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a0892ca296234fa8b244d3e13f56f757.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 22-year-old male presented with high-grade fever, and purpuric rash as shown in the image below. CSF sample showed gram-negative diplococci. Which of the following is the most likely aetiology?",
    "choices": [
      {
        "id": 1,
        "text": "Neisseria meningitidis"
      },
      {
        "id": 2,
        "text": "Pseudomonas aeruginosa"
      },
      {
        "id": 3,
        "text": "Streptococcus pneumoniae"
      },
      {
        "id": 4,
        "text": "E.coli"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The above image shows a <strong>purpuric rash</strong> seen in meningococcemia caused by <strong>Neisseria meningitidis,</strong> which are gram-negative diplococci.&nbsp;</p>\n<p>Pathogenesis &amp; clinical features:</p>\n<ul>\n<li>The organism enters the body through the nasopharynx. From nasopharynx, they enter the bloodstream producing bacteremia, and the symptoms may resemble upper respiratory tract infection.</li>\n<li>Fulminant meningococcemia is the severe form, where the patient presents with high-grade fever and <strong>hemorrhagic</strong>&nbsp;<strong>rash.</strong> There is thrombosis of several small blood vessels in various organs with perivascular infiltration and <strong>petechial haemorrhages.&nbsp;</strong></li>\n<li>Some patients with fulminant meningococcemia may also develop disseminated intravascular coagulation, and circulatory collapse,&nbsp;a condition known as&nbsp;Waterhouse&ndash;Friderichsen syndrome.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a2bdb1ee34214aea9657c7a2e5d49e98.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A child who is a victim under POCSO act is brought to the department forensic medicine for age estimation. The X-ray image of the hand is shown below. What is the likely age of the child?",
    "choices": [
      {
        "id": 1,
        "text": "4 years"
      },
      {
        "id": 2,
        "text": "7 years"
      },
      {
        "id": 3,
        "text": "10 years"
      },
      {
        "id": 4,
        "text": "13 years"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The child's age is likely to be&nbsp;<strong>13 years.</strong></p>\n<p>In the above X-ray image of the wrist and hand,&nbsp;<strong>all</strong>&nbsp;the&nbsp;<strong>carpal</strong>&nbsp;<strong>bones</strong>&nbsp;are&nbsp;<strong>seen</strong>. The&nbsp;<strong>lower epiphysis</strong>&nbsp;of the&nbsp;<strong>first metacarpal</strong>&nbsp;has&nbsp;<strong>not united</strong>&nbsp;with the shaft. This suggests that the age of the child is 12 to 15 years.</p>\n<p>The age of ossification of the carpal bones:</p>\n<table width=\"257\">\n<tbody>\n<tr>\n<td><strong>Carpal bone</strong></td>\n<td><strong>Age of ossification</strong></td>\n</tr>\n<tr>\n<td>Capitate</td>\n<td>1-3 months</td>\n</tr>\n<tr>\n<td>Hamate</td>\n<td>\n<p>2-4 months</p>\n</td>\n</tr>\n<tr>\n<td>Triquetrum</td>\n<td>\n<p>2-3 years</p>\n</td>\n</tr>\n<tr>\n<td>Lunate</td>\n<td>2-4 years</td>\n</tr>\n<tr>\n<td>Scaphoid</td>\n<td>4-6 years</td>\n</tr>\n<tr>\n<td>Trapezium</td>\n<td>4-6 years</td>\n</tr>\n<tr>\n<td>Trapezoid</td>\n<td>4-6 years &nbsp;</td>\n</tr>\n<tr>\n<td>Pisiform</td>\n<td>8-12 years &nbsp;</td>\n</tr>\n</tbody>\n</table>\n<p>The age of fusion of joints:</p>\n<table>\n<tbody>\n<tr>\n<td><strong>Bone/ joint</strong></td>\n<td><strong>Maximum age at fusion</strong></td>\n</tr>\n<tr>\n<td>\n<p>Elbow joint centers</p>\n<p>Metacarpals</p>\n</td>\n<td>16 years</td>\n</tr>\n<tr>\n<td>Wrist joint centers</td>\n<td>19 years</td>\n</tr>\n<tr>\n<td>Hip bone centers</td>\n<td>22 years</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/fdcee39b4f094628a14d633ebbf5852e.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "You are counseling a patient with gastroesophageal reflux disease about the need for long-term therapy with proton-pump inhibitors. All of the following are complications of this therapy, except:",
    "choices": [
      {
        "id": 1,
        "text": "Decreased vitamin B12 absorption"
      },
      {
        "id": 2,
        "text": "Increased susceptibility to infections"
      },
      {
        "id": 3,
        "text": "Hypogastrinemia"
      },
      {
        "id": 4,
        "text": "Increased risk of bone fracture"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Long-term PPI therapy</strong> is not associated with hypogastrinemia but is associated with <strong>hypergastrinemia</strong>. This hypergastrinemia contributes to <strong>rebound gastric acid hypersecretion</strong> if PPI therapy is discontinued.</p>\n<p>Chronic PPI therapy is associated with:&nbsp;</p>\n<ul>\n<li>Decreased vitamin B12 absorption</li>\n<li>Increased susceptibility to infections-&nbsp;hospital-acquired pneumonia, pseudomembranous enterocolitis</li>\n<li>Reduced calcium absorption increases the risk of fractures</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "65 year old male presents with painless cervical lymphadenopathy and right sided deafness. On examination, dull tympanic membrane on right side and tympanometry shows curve B. Most probable diagnosis is",
    "choices": [
      {
        "id": 1,
        "text": "Adenoid hypertrophy"
      },
      {
        "id": 2,
        "text": "Nasopharyngeal carcinoma"
      },
      {
        "id": 3,
        "text": "Pyriform fossa carcinoma"
      },
      {
        "id": 4,
        "text": "Tumor in inner ear"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<ul>\n<li><strong>Painless cervical lymphadenopathy</strong> is the most common presenting feature of nasopharyngeal carcinoma.</li>\n<li>Presence of <strong>unilateral serous otitis media in an adult should raise suspicion of nasopharyngeal growth</strong>. (Eustachian tube obstruction leads to serous otitis media which causes deafness)</li>\n<li>\n<p><strong>Painless cervical lymphadenopathy</strong>&nbsp;is the most common (60-90%) presenting feature of&nbsp;<strong>nasopharyngeal carcinoma</strong>&nbsp;followed by-&nbsp;</p>\n<ul>\n<li><strong>Hearing loss</strong></li>\n<li><strong>Nasal obstruction</strong></li>\n<li>Epistaxis</li>\n<li><strong>Cranial nerve palsies</strong>&nbsp;-Cranial nerves V and VI are the most commonly involved among all the cranial nerves.&nbsp;</li>\n<li>Headache</li>\n<li>Earache</li>\n<li>Neck pain</li>\n<li>Weight loss</li>\n</ul>\n</li>\n<li><strong>Dull tympanic membrane and type B curve</strong> on tympanometry are features of <strong>serous otitis media</strong>.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 55-year-old woman is being counseled for surgery for her long-standing dacryocystitis. Which of the following is the surgery of choice?",
    "choices": [
      {
        "id": 1,
        "text": "Dacryocystorhinostomy"
      },
      {
        "id": 2,
        "text": "Dacryocystectomy"
      },
      {
        "id": 3,
        "text": "Conjunctivo-cystorhinostomy"
      },
      {
        "id": 4,
        "text": "Balloon cathetor dilation"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The treatment of choice for&nbsp;<strong>chronic dacryocystitis</strong> is dacryocystorhinostomy (<strong>DCR</strong>) as it re-establishes the lacrimal drainage.</p>\n<p>One of the sequelae of chronic dacryocystitis is <strong>mucocele</strong> formation, which when infected, leads to <strong>pyocele</strong> formation and finally lacrimal fibrosis. Treatment of lacrimal sac <strong>fibrosis</strong> is&nbsp;<strong>dacryocystectomy.</strong>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 15 years old girl has received complete immunization against tetanus 7 years ago. Now she presents with a contaminated wound sustained 6 hours ago. She should now be given?",
    "choices": [
      {
        "id": 1,
        "text": "Full course tetanus toxoid"
      },
      {
        "id": 2,
        "text": "Single dose tetanus toxoid"
      },
      {
        "id": 3,
        "text": "Human tetanus immunoglobulin"
      },
      {
        "id": 4,
        "text": "Human tetanus immunoglobulin and single dose of toxoid"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The girl should be given <strong>a single dose of tetanus toxoid </strong>alone</p>\n<p>She presented with a contaminated wound sustained 6 hours ago and she has received complete immunization against tetanus 7 years back, which comes under Category B of Tetanus Immunization.</p>\n<p>According to the recommendations of the CDC:</p>\n<table style=\"height: 151px;\" width=\"626\">\n<tbody>\n<tr>\n<td style=\"width: 118px;\">Vaccination History</td>\n<td style=\"width: 118px;\">Clean Minor Wounds</td>\n<td style=\"width: 118px;\">All other wounds</td>\n</tr>\n<tr>\n<td style=\"width: 118px;\">Unknown or fewer than 3 doses</td>\n<td style=\"width: 118px;\">Tdap/Td</td>\n<td style=\"width: 118px;\">Tdap/TD + TIG</td>\n</tr>\n<tr>\n<td style=\"width: 118px;\">3 or more doses</td>\n<td style=\"width: 118px;\">Tdap/ Td Only if &gt; 10 years</td>\n<td style=\"width: 118px;\">Tdap/TD Only if &gt; 5 years</td>\n</tr>\n</tbody>\n</table>\n<p>Tdap - Tetanus, Diptheria, and Pertussis</p>\n<p>Td - Tetanus and Diptheria</p>\n<p>Tdap for children and Td for adults but Tdap is preferred to Td for adults who have never received Tdap.</p>\n<p>&nbsp;</p>\n<p><strong>Categories of Tetanus immunization:</strong></p>\n<ul>\n<li><strong>Category A</strong>&nbsp;- Taken a complete course of TT/booster within past 5 years</li>\n<li><strong>Category B</strong>&nbsp;- Taken a complete course of TT/booster within the past &gt; 5 years &lt; 10 years.</li>\n<li><strong>Category C</strong> - Taken a complete course of TT/booster within the past &gt;10 years</li>\n<li><strong>Category D</strong>&nbsp;- Not taken a complete course of TT/booster or immunity status not known.</li>\n</ul>\n<p>&nbsp;</p>\n<p>Note:</p>\n<p>WHO recommends a 3-dose primary vaccination series with tetanus-diphtheria containing vaccine followed by 3 booster doses.&nbsp;Ideally, there should be at least 4 years between booster doses.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7072435aef93478683f601da12a14192x610x458.PNG"
    ]
  },
  {
    "text": "A study was conducted on a group of 500 patients having carcinoma lung and another group of 300 was chosen from the general population. Both these groups were questioned on their exposure to smoking. What kind of study is this?",
    "choices": [
      {
        "id": 1,
        "text": "Cohort study"
      },
      {
        "id": 2,
        "text": "Cross-sectional study"
      },
      {
        "id": 3,
        "text": "Ecological study"
      },
      {
        "id": 4,
        "text": "Case-control study"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>This is a case&ndash;control study. In this scenario, <strong>500 patients</strong>&nbsp;constitute the <strong>cases</strong> and <strong>300 people</strong>&nbsp;constitute the <strong>controls,&nbsp;</strong>and the study is done from <strong>effect to cause as the disease has already occurred.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "If  the sensitivity and specificity  of a screening test are 90% and 95% respectively, calculate the positive likelihood ratio:",
    "choices": [
      {
        "id": 1,
        "text": "14"
      },
      {
        "id": 2,
        "text": "16"
      },
      {
        "id": 3,
        "text": "18"
      },
      {
        "id": 4,
        "text": "20"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The positive likelihood ratio of this screening test is <strong>18.</strong></p>\n<p>A positive likelihood ratio, or LR+, is the probability that a positive test would be expected in a patient with a disease divided by the probability that a positive test would be expected in a patient without a disease. In other words, an LR+ is the true positivity rate divided by the false positivity rate.</p>\n<p><strong>Positive Likelihood Ratio= Sensitivity/(1-Specificity)&nbsp;</strong></p>\n<p>LR+= 0.9/1-0.95= 0.9/0.05 = 18.</p>\n<p>Similarly , <strong>Negative Likelihood Ratio= (1- Sensitivity)/Specificity</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Mr. Ramesh presented with a 3-week history of crampy abdominal pain associated with diarrhoea. Which of the following features supports a diagnosis of irritable bowel syndrome?",
    "choices": [
      {
        "id": 1,
        "text": "Steatorrhea"
      },
      {
        "id": 2,
        "text": "Nocturnal diarrhoea"
      },
      {
        "id": 3,
        "text": "Persistent diarrhoea after a 48 hour fast"
      },
      {
        "id": 4,
        "text": "Onset of symptoms during a period of stress"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The <strong>onset</strong> of symptoms during a period of <strong>stress </strong>or emotional upset is a feature that supports a diagnosis of irritable bowel syndrome (IBS).</p>\n<p>Features in favour of IBS:</p>\n<ul>\n<li style=\"font-weight: 400;\">Abdominal pain that improves/worsens with defecation</li>\n<li style=\"font-weight: 400;\">Association with stress or emotional symptoms</li>\n<li style=\"font-weight: 400;\">Small volume of stools</li>\n</ul>\n<p>Features not in favour of IBS:</p>\n<ul>\n<li>Onset of symptoms in old age</li>\n<li style=\"font-weight: 400;\">Presence of fever and weight loss</li>\n<li style=\"font-weight: 400;\">Persistent diarrhoea after a 48h fast</li>\n<li style=\"font-weight: 400;\">Nocturnal diarrhoea</li>\n<li style=\"font-weight: 400;\">Steatorrhoea</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 27-year-old woman presents with urinary frequency, urgency, and burning during urination of two days duration. She has also noticed a scant vaginal discharge. Which of the following additional findings would be most suggestive of pyelonephritis in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Fever"
      },
      {
        "id": 2,
        "text": "Bacteriuria"
      },
      {
        "id": 3,
        "text": "White blood cell casts"
      },
      {
        "id": 4,
        "text": "Sterile pyuria"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In the given case scenario, WBC casts are most suggestive of pyelonephritis.&nbsp;</p>\n<p>The urine contains many leukocytes (pyuria) derived from the inflammatory infiltrate, but pyuria does not differentiate upper from lower urinary tract infection. The finding of leukocyte casts, typically rich in neutrophils (pus casts), indicates renal involvement&nbsp;because casts are formed only in tubules.</p>\n<p>Note:Ascending infection is the most common cause of clinical pyelonephritis.</p>\n<p>Note: Sterile pyuria is defined as white cells in the urine in the absence of significant bacterial growth.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A postgraduate student is assisting in the emergency trauma surgery of an HIV-infected person noted to have severe oropharyngeal candidiasis. He suffers a bleeding puncture wound on his right index finger, through the glove. Which of the following is correct regarding post-exposure prophylaxis for HIV in this situation?",
    "choices": [
      {
        "id": 1,
        "text": "Zidovudine + Lamivudine for 4 weeks"
      },
      {
        "id": 2,
        "text": "Lamivudine + Tenofovir + Efavirenz for 4 weeks"
      },
      {
        "id": 3,
        "text": "Lamivudine + Tenofovir + Dolutegravir for 4 weeks"
      },
      {
        "id": 4,
        "text": "Tenofovir + Lamivudine + Nevirapine for 4 weeks"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Recommended Post-exposure prophylaxis(PEP) is a three drug regimen which includes<strong> Lamivudine 300mg ,&nbsp;</strong><strong>Tenofovir 300mg and Dolutegravir 50mg</strong>. A regimen for post-exposure prophylaxis for HIV with two ARV drugs is effective, but three drugs are preferred. The PEP must be initiated ideally within 2 hours and certainly within 72 hours.&nbsp;WHO recommended PEP regimen:</p>\n<table style=\"height: 154px; width: 370px;\">\n<tbody>\n<tr>\n<td style=\"width: 389.863px;\">Drug combination</td>\n<td style=\"width: 10px;\">Recommendation for PEP</td>\n<td style=\"width: 104px;\">Duration</td>\n</tr>\n<tr>\n<td style=\"width: 389.863px;\">Tenofovir (TDF) 300mg + Lamivudine(3TC) 300mg + Dolutegravir (DTG) 50mg</td>\n<td style=\"width: 10px; text-align: left;\">&nbsp; &nbsp;Once daily</td>\n<td style=\"width: 104px;\">4 weeks</td>\n</tr>\n</tbody>\n</table>\n<div class=\"page\" title=\"Page 39\">&nbsp;</div>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 25-year-old woman presented with persistent headaches over the last 1 month. Her father and paternal uncle suffered from kidney disease and both died in their 50's of a 'brain bleed'. Her blood pressure is 160/110 mm Hg and had also been elevated during a previous visit. Which of the following investigations should be avoided in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Ultrasonography of the abdomen"
      },
      {
        "id": 2,
        "text": "Contrast enhanced CT of the abdomen"
      },
      {
        "id": 3,
        "text": "Non-contrast CT scan of the abdomen"
      },
      {
        "id": 4,
        "text": "MR angiography of the cerebral vasculature"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>This clinical scenario is suggestive of autosomal dominant polycystic kidney disease <strong>(ADPKD).</strong>&nbsp;These patients usually have impaired renal function. Hence, contrast-enhanced CT (<strong>CECT</strong>) would usually be <strong>avoided</strong> due to the risk of&nbsp;<strong>contrast&nbsp;nephrotoxicity.</strong></p>\n<p>The following investigations are done in patients with ADPKD:</p>\n<ul>\n<li><strong>USG abdomen - </strong>for&nbsp;screening and diagnosis</li>\n<li><strong>Non-contrast CT</strong>&nbsp;abdomen - more sensitive and picks up cysts of smaller size</li>\n<li><strong>MR-angiography</strong>&nbsp;of brain -&nbsp;pre-symptomatic <strong>screening&nbsp;</strong>for&nbsp;intracerebral<strong> aneurysms</strong>&nbsp;</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 35-year-old woman presents to the clinic with a history of greenish discharge from the nipple for the past 1 month. Personal history is significant for cigarette smoking. On compression of her breast, greenish discharge from multiple ducts was observed. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Duct ectasia"
      },
      {
        "id": 2,
        "text": "Intraductal papilloma"
      },
      {
        "id": 3,
        "text": "Intraductal carcinoma"
      },
      {
        "id": 4,
        "text": "Paget's disease"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The most likely diagnosis of a patient with greenish discharge from multiple ducts is<strong> duct ectasia.&nbsp;</strong></p>\n<p>Duct ectasia is the dilatation of breast ducts. It is the most common cause of nipple discharge in nonlactating women. This condition is associated with <strong>smoking</strong> and diabetes.</p>\n<p>The initial stage of this disease consists of dilatation of one or more lactiferous ducts. These ducts get filled with stagnant brown or <strong>green colored</strong> secretions. In the later stages, the accumulation of fluid in the lactiferous ducts leads to infection and inflammation, causing <strong>periductal mastitis</strong>. The infections are most often mixed infections of aerobic and anaerobic flora of the skin.</p>\n<p>Patients may present with nipple discharge, abscess, fistula or nipple retraction.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 9-year-old girl is brought to the casualty with a history of abdominal pain and vomiting for the past 4 hours. On examination, the patient is febrile. Rebound tenderness in the right iliac fossa is seen. Which among the following is the preferred imaging modality in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Contrast-enhanced CT scan"
      },
      {
        "id": 2,
        "text": "Ultrasound of the abdomen"
      },
      {
        "id": 3,
        "text": "Non-contrast enhanced CT"
      },
      {
        "id": 4,
        "text": "Erect X Ray of the abdomen"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The clinical scenario is suggestive of acute appendicitis. In the pediatric population, <strong>ultrasound of the abdomen</strong> is the preferred imaging modality to identify the presence of an inflamed appendix. It avoids the risk of radiation exposure.&nbsp;</p>\n<p>In<strong> adults</strong>, the best imaging modality is a <strong>CT scan</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 30 years old male presents with continuous discomfort in the right hypochondrium and on examination shows presence of enlarged liver 8cm below the costal margins. The image below shows CT radiograph. The probable diagnosis is",
    "choices": [
      {
        "id": 1,
        "text": "Amoebic liver abscess"
      },
      {
        "id": 2,
        "text": "Pyogenic Liver abscess"
      },
      {
        "id": 3,
        "text": "Hydatid cyst"
      },
      {
        "id": 4,
        "text": "Hepatic adenoma"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The above image shows <strong>CT scan of the liver</strong> with <strong>hydatid cyst&nbsp;seen as a&nbsp;hypodense lesion with internal septation</strong>.</p>\n<p>Hydatid cysts result from infection by the Echinococcus, and can result in cyst formation anywhere in the body.</p>\n<p><strong>Causative agent:</strong></p>\n<p>There are two main <strong>strains</strong> which include:</p>\n<ol>\n<li>Echinococcus granulosus: more common\n<ul>\n<li>pastoral: dog is a main host; most common form</li>\n<li>sylvatic: wolf is a main host</li>\n</ul>\n</li>\n<li>Echinococcus alveolaris/multilocularis: less common but more invasive; fox is a main host</li>\n</ol>\n<p><strong>Investigation:</strong></p>\n<ul>\n<li>CT examination reveals fluid density cyst, with frequent peripheral focal areas of calcification, usually indicates no active infection if completely circumferential.</li>\n<li>Septation and daughter cysts may be visualised. The water-lily sign indicates a cyst with floating, undulating membrane, caused by a detached endocyst.</li>\n<li>May also show hyperdense internal septa representing a spoke wheel pattern within a cyst.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/2380bbb68fa4431fa417fff061397923.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Identify the imaging modality.",
    "choices": [
      {
        "id": 1,
        "text": "Retrograde pyelogram"
      },
      {
        "id": 2,
        "text": "Retrograde urethrogram"
      },
      {
        "id": 3,
        "text": "Intravenous pyelography"
      },
      {
        "id": 4,
        "text": "Antegrade pyelography"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The image depicts a <strong>retrograde pyelogram. </strong></p>\n<p>Retrograde Pyelogram is particularly valuable when<strong> IVP/CT is contraindicated </strong>and excels at providing detailed imaging of the <strong>collecting system, especially for evaluating ureteral strictures</strong> and <strong>filling defects</strong>, making it especially useful in surgical planning.\u00a0</p>\n<p>Other Options:</p>\n<p>Option B: In <strong>Retrograde urethrogram,</strong> the urethra is visualized with the instillation of contrast into the anterior urethra (penile urethra and bulbar urethra). It helps diagnose <strong>anterior urethral abnormalities.</strong> The following image shows an image of retrograde urethrogram contrast leakage at the <strong>membranous urethra.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/332be08ddd9940b6bd594e4a745b0603.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3c0107c7e17146ceb791c463d277f57ax720x720.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/bd6beebe22594cdfb4908f7b74a1b670x720x964.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/67031746ef214b3ca5e3fd541b607d41x452x547.JPEG"
    ]
  },
  {
    "text": "A 33-year-old female patient comes with complaints of menorrhagia for the past 3 months. The duration and regularity of her menstrual cycles are normal. Non-hormonal management has been tried without success. What is the most appropriate next step?",
    "choices": [
      {
        "id": 1,
        "text": "Uterine artery embolisation"
      },
      {
        "id": 2,
        "text": "Endometrial ablation"
      },
      {
        "id": 3,
        "text": "Hormonal therapy"
      },
      {
        "id": 4,
        "text": "Hysterectomy"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Hormonal therapy</strong> is the next best step in the given scenario of <strong>menorrhagia</strong> that is <strong>unresponsive to non-hormonal</strong> therapy.&nbsp;</p>\n<p><strong>Menorrhagia</strong>&nbsp;is defined as&nbsp;<strong>heavy</strong>&nbsp;but&nbsp;<strong>regular</strong>&nbsp;menstrual bleeding. It&nbsp;can be acute (&lt;6 months) or chronic (&gt;6 months).</p>\n<p>It is managed as follows:</p>\n<ul>\n<li><strong>Medical</strong> - <strong>first line</strong> of treatment.&nbsp;&nbsp;\n<ul>\n<li>NSAIDs</li>\n<li>Tranexamic acid&nbsp;&nbsp;</li>\n<li><strong>OCPs/progestogens</strong> - if non-hormonal management fails&nbsp;</li>\n<li>Mirena IUCD</li>\n<li>Blood transfusion, if required&nbsp;</li>\n</ul>\n</li>\n<li><strong>Surgical</strong> - if medical management fails, depending on the diagnosis:\n<ul>\n<li><strong>Endometrial ablation</strong>&nbsp;- hysteroscopic, TCRE, RITEA, microwave, NovaSure, etc</li>\n<li><strong>Uterine artery embolization</strong></li>\n<li>Uterine tamponade</li>\n<li><strong>Hysterectomy</strong> - if all minimally invasive methods fail</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A woman recently became pregnant following a history of repeated abortions. She was anxious and wanted to undergo karyotyping this time to detect chromosomal disorders pre-natally. Barr body was found to be absent in her report. Which of the following is associated with an absent Barr body?",
    "choices": [
      {
        "id": 1,
        "text": "46 XX"
      },
      {
        "id": 2,
        "text": "45 X0"
      },
      {
        "id": 3,
        "text": "47 XXX"
      },
      {
        "id": 4,
        "text": "47 XXY"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Barr body is absent in female having <strong>45 X0 genome</strong>.</p>\n<p><strong>Barr body</strong></p>\n<ul>\n<li>Densely staining inactivated condensed X chromosome present in each somatic cell of a female is found in the nucleus.</li>\n<li>Chromatid body (Barr body or sex chromatin) is derived from one of the two X chromosomes which become inactivated.</li>\n<li>The number of Barr bodies is thus one less than the number of X chromosomes.</li>\n</ul>\n<p><strong>Turner's syndrome </strong>is female without Barr body.</p>\n<p><strong>Klinefelter's syndrome </strong>is male with Barr body.</p>\n<p><strong>Note: </strong></p>\n<ul>\n<li><span style=\"color: #000000;\"><strong>Lyon hypothesis</strong> states that only one of the two X chromosomes in a female is functional, the other becomes inactive during embryogenesis.</span></li>\n<li><span style=\"color: #000000;\"><strong>Davidson bodies</strong> are small nuclear buds of chromatin shaped like a drumstick found in neutrophils of females.</span></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 33-week-pregnant lady with pre-eclampsia presenting with features suggestive of HELLP syndrome should be best managed by _______",
    "choices": [
      {
        "id": 1,
        "text": "Termination of pregnancy"
      },
      {
        "id": 2,
        "text": "Give steroids and wait till 37 weeks"
      },
      {
        "id": 3,
        "text": "Give MgSo4 and deliver at 36 weeks"
      },
      {
        "id": 4,
        "text": "None of the above"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The definitive management of PIH/eclampsia is <strong>termination of pregnancy</strong> only.</p>\n<p>Indications for termination of pregnancy, irrespective of gestational age, in cases of pre-eclampsia are as follows:</p>\n<ul>\n<li>Severe pre-eclampsia</li>\n<li>Eclampsia (give MgSO<sub>4 </sub>followed by induction of labor)</li>\n<li>HELLP syndrome</li>\n<li>Pulmonary edema</li>\n<li>Significant renal dysfunction, coagulopathy</li>\n<li>Fetal compromise</li>\n</ul>\n<p>Management of severe pre-eclampsia is outlined in the following flow chart:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f22093d827f043349948f7d52e01eb7bx1200x1913.JPEG"
    ]
  },
  {
    "text": "A 5-year-old boy presents with a short history of facial oedema that has now progressed to total body swelling involving the face, abdomen, scrotum, and feet. Urinalysis revealed protein 4+ with no hematuria and a urine protein:creatinine ratio of 3. What is the initial treatment of choice for this child?",
    "choices": [
      {
        "id": 1,
        "text": "Prednisolone"
      },
      {
        "id": 2,
        "text": "Cyclophosphamide"
      },
      {
        "id": 3,
        "text": "Levamisole"
      },
      {
        "id": 4,
        "text": "Cyclosporine"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The clinical picture and investigations are suggestive of <strong>minimal change nephrotic syndrome</strong> and the initial treatment of choice is corticosteroids such as <strong>prednisolone.</strong></p>\n<p>Minimal change nephrotic syndrome is the <strong>most common cause of nephrotic syndrome</strong>. It is seen in <strong>ages 2-6 years</strong> with a clinical picture of nephrotic syndrome with</p>\n<ul>\n<li>heavy proteinuria</li>\n<li>oedema</li>\n<li>hypoalbuminemia</li>\n<li>hyperlipidemia.</li>\n</ul>\n<p>They show <strong>excellent response to steroid</strong> therapy. A daily dose of 2mg/kg (max 60mg) for 6 weeks followed by an alternate day dose of 1.5mg/kg (max 40mg) for the next 6-8 weeks is recommended.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A construction worker got entrapped in a collapsed building. He sustained severe injury over his legs. Which of the following features is unlikely to be seen in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Metabolic acidosis"
      },
      {
        "id": 2,
        "text": "Hypokalemia"
      },
      {
        "id": 3,
        "text": "Acute tubular necrosis"
      },
      {
        "id": 4,
        "text": "Coagulopathy"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario of a worker sustaining severe injury over his leg following entrapment is suggestive of <strong>crush syndrome.</strong> In this condition,<strong> hypokalemia</strong> is not seen.</p>\n<p><strong>Crush syndrom</strong>e can result when a <strong>limb is compressed</strong> for a prolonged period. For e.g. getting crushed or entrapped in a vehicle or rubble and after extended use of a <strong>pneumatic antishock garment</strong>. This results in hypoperfusion and <strong>myonecrosis</strong> in the crushed limb. When the limb is released from the compression, toxic metabolites get released to cause reperfusion injury.\u00a0</p>\n<p>Crush syndrome can result in a <strong>systemic reaction</strong> due to tissue necrosis. Free myoglobin can lead to <strong>acute tubular necrosis</strong> and renal failure. Myonecrosis can lead to <strong>metabolic acidosis</strong> with <strong>hyperkalemia</strong> and <strong>hypocalcemia</strong>. The procoagulants escaped into the systemic circulation can produce systemic <strong>coagulopathy</strong>.\u00a0</p>\n<p><strong>Management of crush syndrome:</strong></p>\n<ul>\n<li>Encouraging high urine flow, along with<strong> alkalization of urine</strong> with sodium bicarbonate to prevent precipitation of myoglobin in the renal tubules</li>\n<li>Renal hemofiltration if there is oliguria or renal failure</li>\n<li>If compartment syndrome is confirmed, then <strong>fasciotomy</strong> is performed</li>\n<li>Radical<strong> excision</strong> of necrosed muscle to avoid sepsis</li>\n<li>Aggressive management of the open wound</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 72-year-old woman is admitted with complaints of fever with dysuria for 5 days. Her husband reports that she now appears withdrawn and apathetic. She had complained of seeing bugs crawling on her hand. She is drowsy on examination. What is the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Dementia"
      },
      {
        "id": 2,
        "text": "Schizophrenia"
      },
      {
        "id": 3,
        "text": "Depression"
      },
      {
        "id": 4,
        "text": "Delirium"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p class=\"p1\">The given clinical scenario of an acute decline in the level of awareness and visual hallucinations (seeing bugs crawling on hand) in an elderly female admitted with fever and dysuria suggests a diagnosis of <strong>delirium</strong>.</p>\n<p class=\"p1\">Delirium is characterized by:</p>\n<ul>\n<li class=\"p1\">Acute decline in the level of awareness&nbsp;</li>\n<li class=\"p1\">Global impairment of cognitive functions (particularly attention)</li>\n</ul>\n<p>It also involves:</p>\n<ul>\n<li class=\"p1\">Perceptual disturbances like illusions and hallucinations</li>\n<li class=\"p1\">Abnormal psychomotor activity</li>\n<li class=\"p1\">Sleep cycle impairment.</li>\n</ul>\n<p>The&nbsp;<strong>Confusion Assessment Method (CAM)</strong>&nbsp;is a diagnostic algorithm for delirium. The diagnosis of delirium requires the presence of features 1 and 2 and either feature 3 or 4.</p>\n<div class=\"page\" title=\"Page 194\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<div class=\"page\" title=\"Page 194\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<ul>\n<li>Feature 1:&nbsp;<strong>Acute</strong>&nbsp;onset and&nbsp;<strong>fluctuating</strong>&nbsp;course\n<ul>\n<li>Positive responses to the following questions satisfy this feature:<br />Is there evidence of an acute change in mental status from the patient&rsquo;s baseline? Does it fluctuate during the day, or does it increase and decrease in severity?</li>\n</ul>\n</li>\n<li>Feature 2:&nbsp;<strong>Inattention</strong>\n<ul>\n<li>Positive response to the following question satisfies this feature: Is there difficulty focusing attention, easily distractibility, or difficulty keeping track of what was being said?</li>\n</ul>\n</li>\n<li>Feature 3:&nbsp;<strong>Disorganized thinking</strong>\n<ul>\n<li>A positive response to the following question satisfies this feature: Was the patient&rsquo;s thinking disorganized or incoherent. Was there rambling or irrelevant conversation, an unclear or illogical flow of ideas, or unpredictable switching from subject to subject?</li>\n</ul>\n</li>\n<li>Feature 4:&nbsp;<strong>Altered level of consciousness</strong>\n<ul>\n<li>This feature is satisfied by any answer other than &ldquo;alert&rdquo; to the following question: Rate the patient&rsquo;s level of consciousness: alert (normal), vigilant (hyperalert), lethargic (drowsy, easily aroused), stupor (difficult to arouse), or coma (unarousable)?</li>\n</ul>\n</li>\n</ul>\n<p>The scale may not identify the full spectrum of patients with delirium, but all patients who are acutely confused should be presumed delirious. A course that fluctuates over hours or days and may worsen at night&nbsp;is known as&nbsp;<strong>sundowning</strong>. It is typically seen in delirium, but is not essential for the diagnosis.</p>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n<p>Other screening tools that can aid in identifying patients with delirium are:</p>\n<ul>\n<li>Nursing Delirium Screening Scale (NuDESC)</li>\n<li>Organic Brain Syndrome Scale</li>\n<li>Delirium Rating Scale</li>\n<li>ICU version of the CAM</li>\n<li>Delirium Detection Score</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A young woman presented with a rash as shown in the image below. She also complains of recurrent oral ulcers and pain in multiple joints. Investigations revealed antibodies to double-stranded DNA. What is her diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Dermatomyositis"
      },
      {
        "id": 2,
        "text": "Behcet's disease"
      },
      {
        "id": 3,
        "text": "Rheumatoid arthritis"
      },
      {
        "id": 4,
        "text": "Systemic lupus erythematosus"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>A young woman with a <strong>butterfly-shaped malar rash</strong>, a history of <strong>recurrent oral ulcers</strong>, pain in multiple joints, and antibodies to <strong>double-stranded DNA</strong>\u00a0is suggestive of <strong>systemic lupus erythematosus</strong> (<strong>SLE</strong>).</p>\n<p>SLE is an <strong>autoimmune disorder</strong> that results in damage to multiple organs and organ systems in the body most commonly seen in\u00a0<strong>women</strong> of <strong>reproductive age</strong>.\u00a0\u00a0</p>\n<p><strong>Clinical</strong> and <strong>immunological manifestations </strong>of<strong> SLE</strong>:</p>\n<ol>\n<li>Skin\n<ul>\n<li>acute, subacute cutaneous manifestations (photosensitivity, <strong>malar</strong> or maculopapular rash)</li>\n<li>chronic cutaneous manifestations (discoid lupus, panniculitis, lichen planus-like)\u00a0</li>\n</ul>\n</li>\n<li><strong>Oral</strong> or <strong>nasal ulcers</strong></li>\n<li>Non-scarring alopecia</li>\n<li><strong>Synovitis </strong>involving <strong>\u22652</strong> <strong>joints</strong></li>\n<li>Serositis (pleurisy, pericarditis)</li>\n<li>Renal:\u00a0\n<ul>\n<li>Protein/Creatinine ratio &gt;0.5</li>\n<li>RBC casts</li>\n</ul>\n</li>\n<li>Neurologic: seizures, psychosis, myelitis, neuropathy, confusional state</li>\n<li>Hemolytic anemia</li>\n<li>Leukopenia</li>\n<li>Thrombocytopenia</li>\n<li><strong>Immunological manifestations</strong>\n<ul>\n<li>Antinuclear antibodies &gt;reference value (positive in &gt;98% patients)</li>\n<li><strong>Anti-dsDNA &gt;reference value (specific)</strong></li>\n<li>Anti-Smith antibody (specific)</li>\n<li>Antiphospholipid antibody (lupus anticoagulant, false-positive rapid plasma reagin)</li>\n<li>Low serum complement</li>\n</ul>\n</li>\n</ol>\n<p>To <strong>diagnose</strong> SLE, at least<strong> 4 </strong>out of <strong>11\u00a0</strong>of the above criteria must be positive. However, if a <strong>renal biopsy</strong> is suggestive of <strong>lupus nephritis</strong> and <strong>lupus autoantibodies</strong> are positive then four criteria are not required.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/27de18b3db3b4ddaba636a2c660eebed.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A patient presented with pleuritic chest pain and absent breath sounds on the right side. A pleural effusion is suspected. What is the best chest x-ray view to diagnose this condition?",
    "choices": [
      {
        "id": 1,
        "text": "PA view"
      },
      {
        "id": 2,
        "text": "Right anterior oblique"
      },
      {
        "id": 3,
        "text": "Left anterior oblique"
      },
      {
        "id": 4,
        "text": "Lateral decubitus view"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Lateral decubitus </strong>view is the best view to identify <strong>pleural effusion</strong>. It can identify as little as <strong>25 ml</strong>&nbsp;of pleural fluid.</p>\n<p>Features of chest radiograph in pleural effusion:</p>\n<ul>\n<li>Presence of free pleural fluid&nbsp;</li>\n<li>Blunting of costophrenic angle&nbsp;</li>\n<li><strong>Ellis-S curve</strong> &ndash; This is a radiological illusion and occurs as a medial radiological density due to the presence of partially aerated lung between the anterior and posterior fluid layers, whereas laterally the density is higher due to the presence of fluid only. The actual fluid level is horizontal.</li>\n</ul>\n<p>The image given below shows a <strong>lateral decubitus view</strong> showing <strong>pleural effusion.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a54cce0babb747c3a9d18ce12dd916f3x1280x1103.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ad5f2dd38b3a470998db1567823ff0d5x1030x871.PNG"
    ]
  },
  {
    "text": "A 50-year-old female presented with headache for the past 4 months, she was treated with radiotherapy for vestibular schwannoma 2 year back. What is the probable diagnosis we can arrive from the contrast MRI shown below?",
    "choices": [
      {
        "id": 1,
        "text": "Chronic subdural haematoma"
      },
      {
        "id": 2,
        "text": "Meningioma"
      },
      {
        "id": 3,
        "text": "Glioblastoma"
      },
      {
        "id": 4,
        "text": "Astrocytoma"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The most probable diagnosis of the above patient is <strong>meningioma</strong>.</p>\n<p>The well-defined, hyper intense and homogeneously enhanced mass close to the <strong>midline</strong>, situated <strong>extra-axially </strong>(i.e., <strong>outside</strong> the brain parenchyma). Being non-glial in origin they arise from the meningocytes or <strong>arachnoid cap cells </strong>of the meninges, and thus can occur anywhere meninges are found.</p>\n<p>Meningomas are associated with:</p>\n<ul>\n<li><strong>Female predominance </strong>(some meningiomas contain <strong>estrogen </strong>and <strong>progesterone receptors</strong>).</li>\n<li><strong>Genetic preponderance</strong>: Genetic mutations associated with meningioma are NF-2 and MEN1 mutations.</li>\n<li><strong>Ionizing radiation</strong></li>\n</ul>\n<p>Useful descriptive signs on MRI are:</p>\n<ul>\n<li><strong>CSF vascular cleft sign </strong>helps to establish that mass to be extra-axial. There is a cleft between tumor and normal brain parenchyma.</li>\n<li><strong>Dural tail sign</strong>: Refers to the linear extension of enhancement the dura, beyond the segment on which the tumor is based.</li>\n<li><strong>Sunburst </strong>or <strong>spoke wheel</strong> appearance of the vessels.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c4c23c807baa42ef9772e27dd4d71df7.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "During your ICU rotations, you see a  patient being ventilated with the following apparatus. What does the part marked as A represent?",
    "choices": [
      {
        "id": 1,
        "text": "Oxygen inlet"
      },
      {
        "id": 2,
        "text": "Air inlet"
      },
      {
        "id": 3,
        "text": "CO2 outlet"
      },
      {
        "id": 4,
        "text": "Pressure release valve"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The above image shows a <strong>self-inflating bag and mask </strong>and the&nbsp;part marked as <strong>A</strong> represents the&nbsp;<strong>oxygen inlet</strong>.</p>\n<p>Bag and mask ventilation is used<strong>&nbsp;</strong>as a first step in airway management. It serves as a rescue technique to provide oxygenation and ventilation in patients with difficult airways until tracheal intubation is achieved.&nbsp;</p>\n<p>Mask ventilation is not preferred in patients with an increased risk of <strong>regurgitation</strong>. It should be used with caution in patients with <strong>severe facial trauma.</strong></p>\n<p>The following image shows the parts of a self-inflating bag and mask apparatus with a reservoir bag.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/655de6e2067042ba97de8de2cdc7c33a.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/20bc6743683749aaae07ff9e9d5374a9x1200x1117.JPEG"
    ]
  }
];
        let quizName = 'Fmge Mini Test - 008 (Clinical)';
        const quizFilename = 'fmge-mini-test-008-clinical-1ce49997.html';
        let hierarchy = ["Marrow", "FMGE Mini Test Series", "2023"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>