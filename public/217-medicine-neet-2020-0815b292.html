<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>217 Medicine Neet 2020 - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / PYQs / Medicine
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">23</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A patient came to the hospital with complaints of lethargy, increased sleep, and weight gain. Investigations revealed low plasma TSH concentration.  However, on the \u200badministration of TRH, the TSH levels increased. Which of the following conditions is likely in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Hyperthyroidism due to disease in the pituitary"
      },
      {
        "id": 2,
        "text": "Hypothyroidism due to disease in the pituitary"
      },
      {
        "id": 3,
        "text": "Hypothyroidism due to disease in the hypothalamus"
      },
      {
        "id": 4,
        "text": "Hyperthyroidism due to disease in the hypothalamus"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The presenting symptoms of lethargy, increased sleep, and weight gain are suggestive of<strong> hypothyroidism.</strong> An <strong>increase</strong> in <strong>TSH</strong> on administration of TRH confirms the lack of stimulus for TSH secretion from the <strong>hypothalamus</strong>.&nbsp;</p>\n<p>Although decreased TSH levels can be seen in hyperthyroidism, clinical features such as lethargy, increased sleep and weight gain are not. This pushes the diagnosis in favor of <strong>hypothyroidism.&nbsp;</strong></p>\n<p>If the disease was in the pituitary, there would be no increase in TSH secretion on administration of <strong>TRH</strong> (Option B).</p>\n<p>Normally, the thyrotropin&nbsp;releasing hormone (TRH) is released by the hypothalamus. It stimulates the pituitary gland to release the thyroid-stimulating hormone (TSH), which in turn stimulates the thyroid gland to produce T3 and T4 hormones.&nbsp;</p>\n<p><strong>Low TSH</strong> levels may be seen in the following cases:</p>\n<table style=\"height: 289px;\" width=\"527\">\n<tbody>\n<tr>\n<td style=\"width: 168.85px;\">Disease</td>\n<td style=\"width: 168.85px;\">Pathogenesis</td>\n<td style=\"width: 168.9px;\">Presentation</td>\n</tr>\n<tr>\n<td style=\"width: 168.85px;\">Hyperthyroidism</td>\n<td style=\"width: 168.85px;\">Feedback inhibition of TSH release</td>\n<td style=\"width: 168.9px;\">Symptoms of hyperthyroidism</td>\n</tr>\n<tr>\n<td style=\"width: 168.85px;\">Primary disease of the pituitary</td>\n<td style=\"width: 168.85px;\">Decreased release of TSH, thereby causing a decreased release of thyroid hormones</td>\n<td style=\"width: 168.9px;\">\n<p>Symptoms of hypothyroidism.</p>\n<p>Administration of TRH does not elevate the TSH levels in this case since the pituitary gland is abnormal</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 168.85px;\">Primary disease of the hypothalamus</td>\n<td style=\"width: 168.85px;\">Decreased release of TRH leading to decreased TSH and hypothyroidism</td>\n<td style=\"width: 168.9px;\">Administration of TRH causes elevation of TSH levels since the pituitary gland is normal.</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/df9b4e51942c4cb9b4c27caa3026e7f7x472x868.PNG"
    ]
  },
  {
    "text": "What is the Child-Turcotte-Pugh class for the patient who has a serum bilirubin 2.5 mg/dl, serum albumin 3 g/dl, prothrombin time increased by 5 seconds (INR = 2), no encephalopathy, and mild ascites?",
    "choices": [
      {
        "id": 1,
        "text": "Class A"
      },
      {
        "id": 2,
        "text": "Class B"
      },
      {
        "id": 3,
        "text": "Class C"
      },
      {
        "id": 4,
        "text": "Class D"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given patient belongs to Child-Turcotte-Pugh <strong>class B</strong>.</p>\n<p>The score can be calculated as follows:</p>\n<div>Serum bilirubin-2.5mg/dl: 2&nbsp;</div>\n<div>Serum albumin-3g/dl: 2</div>\n<div>Prothrombin time-5 seconds or INR-2: 2</div>\n<div>No encephalopathy: 1</div>\n<div>Mild ascites: 2</div>\n<p>Therefore, the <strong>Child-Turcotte-Pugh score</strong> is (2+2+2+1+2)= <strong>9</strong> which is included in Class B.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An elderly woman is brought to the OPD with complaints of behavioral change, a history of multiple falls, urinary incontinence, and dementia. What is your diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Normal pressure hydrocephalus"
      },
      {
        "id": 2,
        "text": "Frontotemporal dementia"
      },
      {
        "id": 3,
        "text": "Parkinson disease"
      },
      {
        "id": 4,
        "text": "Creutzfeldt-Jakob disease"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given case scenario describes an elderly woman with urinary incontinence, dementia (cognitive decline), and a history of multiple falls (suggestive of a gait abnormality or ataxia). These form the <strong>classical triad</strong> of <strong>normal pressure hydrocephalus (NPH).&nbsp;</strong></p>\n<p>Both<strong> frontotemporal dementia</strong> (Option B) and <strong>Parkinson&rsquo;s disease </strong>(Option C) &nbsp;are common causes of dementia associated with falls, but urinary incontinence is not commonly appreciated. NPH is, therefore, the most likely diagnosis.</p>\n<p><strong>Normal pressure hydrocephalus</strong> refers to a disproportionate <strong>enlargement</strong> of the <strong>ventricles</strong> compared to the degree of <strong>cortical atrophy. </strong>It is a <strong>communicating hydrocephalus</strong> caused by delayed resorption of cerebrospinal fluid. Out of the classical triad of symptoms, most patients present with one or two. Hence, neuroimaging showing <strong>dilated ventricles</strong> is essential, as well as an <strong>L- dopa challenge test </strong>to rule out parkinson&rsquo;s disease is recommended.&nbsp;</p>\n<p>A characteristic MRI of NPH is given below, showing<strong> dilated lateral ventricles</strong> which are out of proportion to <strong>sulcal deepening:&nbsp;</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f745d9c567da4d89b39cd5694dba8987x468x580.PNG"
    ]
  },
  {
    "text": "A 60-year-old male patient who is a known case of COPD presented with acute exacerbation and is admitted to the ICU. Which of the following statements is correct with regards to the initial management of this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Non-Invasive PPV should be given"
      },
      {
        "id": 2,
        "text": "Invasive PPV should be given"
      },
      {
        "id": 3,
        "text": "IV corticosteroids should be administered"
      },
      {
        "id": 4,
        "text": "Permissive hypercapnia is allowed"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Non-invasive positive pressure ventilation </strong>(NIPPV) should be the <strong>first</strong> mode of ventilation used in COPD patients with acute respiratory failure provided there are <strong>no absolute contraindications. </strong>This approach improves gas exchange, reduces work of breathing and the need for intubation, decreases hospitalization duration and enhances overall survival outcomes.</p>\n<p><strong>Invasive positive pressure ventilation</strong> is only considered after <strong>failure</strong> of NIPPV, resulting in severe respiratory distress, life threatening hypoxemia, severe hypercarbia and/or acidosis, markedly impaired mental status, <strong>respiratory arrest</strong> or<strong> hemodynamic instability</strong> (Option B).</p>\n<p>Apart from NIPPV, <strong>short-acting inhaled beta 2 agonists </strong>(albuterol, salbutamol) with or without <strong>short-acting anticholinergics</strong> (ipratropium) and\u00a0<strong>Long-acting anticholinergics </strong>(tiotropium) are recommended as the initial bronchodilators. <strong>Maintenance</strong> therapy with long-acting beta 2 agonists (formoterol) must be started as soon as possible.</p>\n<p><strong>Systemic corticosteroids </strong>are useful in the treatment of acute exacerbations of COPD as they reduce airway inflammation and improve lung function over time. However, the effects are not immediate. NIPPV on the other hand provides<strong> immediate relief </strong>to the patient and reduces the work of breathing. Therefore, it would not be the best choice in this case. (Option C)</p>\n<p><strong>Antibiotics</strong> can also be considered, as they reduce duration of hospitalisation. Treatment is given for <strong>5 days.\u00a0</strong></p>\n<p><strong>Permissive hypercapnia </strong>refers to a ventilation strategy where tidal volume is reduced in order to avoid hyperinflation-associated lung trauma. It is not preferred at the initial presentation. It is only permitted once invasive PPV is started following NIPPV failure (Option D)\u00a0</p>\n<p>An<strong> exacerbation of COPD </strong>is defined as an event characterized by dyspnea and/or cough and sputum that worsen over &lt; 14 days. Exacerbations of COPD are often associated with <strong>increased</strong> <strong>local</strong> and <strong>systemic</strong> <strong>inflammation</strong> caused by airway infection, pollution, or other insults to the lungs.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Thrombocytopenia, eczema and recurrent infections are seen in:",
    "choices": [
      {
        "id": 1,
        "text": "Wiskott-Aldrich syndrome"
      },
      {
        "id": 2,
        "text": "Chediak-Higashi syndrome"
      },
      {
        "id": 3,
        "text": "Thrombocytopenia-absent radius syndrome"
      },
      {
        "id": 4,
        "text": "Hermansky-Pudlak syndrome"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Thrombocytopenia, eczema and recurrent infections are characteristically seen in <strong>Wiskott-Aldrich syndrome.</strong></p>\n<p>Wiskott Aldrich syndrome is an <strong>X-linked recessive </strong>disorder due to mutations in the<strong> WASP gene.</strong> The characteristic triad of features is:</p>\n<ul>\n<li><strong>Eczema</strong></li>\n<li><strong>Thrombocytopenia</strong>&nbsp;- along with&nbsp;decreased platelet size, impaired platelet aggregation response</li>\n<li><strong>Immunodeficiency</strong> - The immunoglobulin pattern seen is <strong>low</strong> level of <strong>IgM</strong>, <strong>elevated IgA </strong>and <strong>IgE</strong>, and a normal or slightly <strong>low IgG. </strong>Defect in <strong>regulatory T cells</strong> results in recurrent bacterial infections.</li>\n</ul>\n<p><strong>Other options:</strong></p>\n<p>Option B:<strong>&nbsp;Chediak-Higashi syndrome (CHS)</strong> is an autosomal recessive disease due to&nbsp;mutations in CHS1/LYST gene (defective lysosomal transport). It leads to&nbsp;recurrent pyogenic infections, partial oculocutaneous albinism, neurologic abnormalities, and thrombocytopenia. Peripheral smear shows large azurophilic granules in neutrophils and eosinophils. It can lead to hemophagocytic lymphohistiocytosis.</p>\n<p>Option C: <strong>Thrombocytopenia-absent radius syndrome</strong> is an autosomal recessive disorder with severe thrombocytopenia (diagnosed at birth) and bilateral absent radii (thumbs are always present).</p>\n<p>Option D: <strong>Hermansky-Pudlak syndrome</strong> is an autosomal recessive disorder with oculocutaneous albinism, bleeding diathesis (deficient dense granules in platelets), pulmonary fibrosis, and granulomatous colitis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which among the following is more common in limited cutaneous systemic sclerosis when compared to diffuse cutaneous systemic sclerosis?",
    "choices": [
      {
        "id": 1,
        "text": "Esophageal dysmotility"
      },
      {
        "id": 2,
        "text": "Myopathy"
      },
      {
        "id": 3,
        "text": "Interstitial lung disease"
      },
      {
        "id": 4,
        "text": "Scleroderma renal crisis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Esophageal dysmotility</strong> is more commonly seen in<strong> limited cutaneous systemic sclerosis </strong>(lcSSc) compared to diffuse cutaneous systemic sclerosis.</p>\n<p><strong>Systemic sclerosis </strong>is divided into two based on the patterns of involvement - <strong>diffuse</strong> and <strong>limited.</strong></p>\n<p>Limited cutaneous systemic sclerosis is characteristically associated with <strong>CREST syndrome, </strong>which includes <strong>c</strong>alcinosis cutis, <strong>R</strong>aynaud&rsquo;s phenomenon, <strong>e</strong>sophageal dysmotility, <strong>s</strong>clerodactyly and<strong> t</strong>elangiectasia.&nbsp;</p>\n<p>Skin involvement, interstitial lung disease (Option C), myopathy (Option B), and scleroderma renal crisis (Option D) are more common in <strong>diffuse cutaneous systemic sclerosis</strong> (dcSSc) than limited cutaneous systemic sclerosis.</p>\n<p>The incidence of ischemic digital ulcers, CREST features, and primary biliary cirrhosis is more in limited cutaneous systemic sclerosis. The frequency of <strong>pulmonary arterial hypertension</strong> (PAH) is <strong>equal</strong> in both types.</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Water hammer pulse is seen in which of the following conditions?",
    "choices": [
      {
        "id": 1,
        "text": "Aortic stenosis"
      },
      {
        "id": 2,
        "text": "Aortic regurgitation"
      },
      {
        "id": 3,
        "text": "Aortic stenosis and aortic regurgitation"
      },
      {
        "id": 4,
        "text": "Mitral regurgitation"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Severe AS</strong> (Option A) would show<strong> pulsus parvus et tardus,</strong> characterized by the carotid pulse rising slowly to a delayed peak.&nbsp;</p>\n<p><strong>Chronic mitral regurgitation</strong> (Option D) shows a sharp, low volume upstroke due to reduced cardiac output and acute mitral regurgitation demonstrates narrow pulse pressure.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/58e1f5a9c9e94cf8bce33fa1de43073ex1002x942.PNG"
    ]
  },
  {
    "text": "The arterial blood gas analysis findings of a patient are as follows:  pH= 7.30, HCO3= 10 mEq/L,  paCO2= 30 mmHg, which is suggestive of a partially compensated metabolic acidosis. What is the mechanism for the secondary disorder?",
    "choices": [
      {
        "id": 1,
        "text": "Hypoventilation causing decreased CO2 washout"
      },
      {
        "id": 2,
        "text": "Hyperventilation causing increased CO2 washout"
      },
      {
        "id": 3,
        "text": "Increased tubular reabsorption of  HCO3-"
      },
      {
        "id": 4,
        "text": "Increased excretion of H+"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The mechanism for the secondary disorder is <strong>hypoventilation</strong> causing <strong>decreased CO2 washout</strong>.&nbsp;</p>\n<p>The given arterial blood gas findings are suggestive of a <strong>partially compensated metabolic acidosis</strong>. The compensation is <strong>partial </strong>because the <strong>fall in paCO2</strong> much <strong>lower</strong> than what is expected for the given HCO3 levels. The <strong>fall in paCO2</strong> is <strong>inadequate </strong>due to<strong> hypoventilation</strong> causing decreased CO2 washout. In this case, the <strong>secondary disorder</strong> is <strong>respiratory acidosis</strong>.&nbsp;</p>\n<p><strong>Hyperventilation</strong> causing<strong> increased CO2 washout</strong> (Option B) would allow for <strong>better compensation</strong>, with lower paCO2 levels than observed.&nbsp;</p>\n<p>The expected paCO2 can be calculated using <strong>Winter's formula:</strong></p>\n<p>For metabolic acidosis, the expected paCO2 = [1 .5 X HCO3-] + 8 &plusmn; 2.</p>\n<p>Substituting the values, expected PaCO2 = (1.5 x 10) +8 &plusmn; 2<br />= 15+8 &plusmn;2<br />= <strong>21 to 25 mmHg</strong></p>\n<p>However, the <strong>actual PaCO2 is 30 mmHg,</strong> which is <strong>higher</strong> than the expected paCO2 <strong>indicating a secondary respiratory acidosis.</strong> A possible explanation for this could only be <strong>hypoventilation causing decreased CO2 washout.&nbsp;</strong></p>\n<p>Thus, the given ABG findings are suggestive of a mixed acid-base disorder characterized by metabolic acidosis with additional respiratory acidosis.&nbsp;</p>\n<p><strong>For example, </strong>in a patient with diabetic ketoacidosis and pneumonia, the lungs would fail to compensate, and the patient could develop hypoventilation leading to secondary respiratory acidosis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is seen in pituitary apoplexy?",
    "choices": [
      {
        "id": 1,
        "text": "Hypertension"
      },
      {
        "id": 2,
        "text": "Shock"
      },
      {
        "id": 3,
        "text": "Unconsciousness"
      },
      {
        "id": 4,
        "text": "Fatigue"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Shock</strong> is seen in <strong>pituitary apoplexy.</strong></p>\n<p><strong>Loss of consciousness</strong> (Option C) can also be seen but it occurs secondary to <strong>adrenal insufficiency</strong> and <strong>shock</strong>. Hence, shock is the most appropriate answer.</p>\n<p><strong>Pituitary apoplexy</strong> refers to <strong>acute hemorrhagic infarction</strong> of the pituitary gland. This results in the compression of surrounding structures and <strong>hypopituitarism</strong> leading to <strong>acute adrenal insufficiency.</strong> It may be seen spontaneously in a pre-existing pituitary adenoma, post-partum (Sheehan&rsquo;s syndrome), or be associated with hypertension, diabetes mellitus or sickle cell anemia or shock.</p>\n<p>Pituitary apoplexy is an endocrine <strong>emergency</strong> that can lead to severe hypoglycemia, hypotension, shock, central nervous system (CNS) hemorrhage, and death. Acute clinical manifestations commonly encompass intense headaches with signs of meningeal irritation, bilateral visual changes, ophthalmoplegia, and even cardiovascular collapse.</p>\n<p>The investigation of choice is <strong>MRI</strong>.&nbsp;</p>\n<p>Patients who do not exhibit overt visual impairment or altered mental status can be managed conservatively with <strong>high-dose glucocorticoids. </strong>Progressive <strong>visual loss,</strong> <strong>cranial nerve palsy, </strong>or <strong>altered mental status</strong> necessitate expeditious <strong>surgical decompression.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 20-year-old man presents to the emergency department with respiratory distress and hypotension following a trauma. He has subcutaneous emphysema and there is an absence of air entry into the right side of the lungs. What is the next best step?",
    "choices": [
      {
        "id": 1,
        "text": "Start IV fluids with large bore cannula"
      },
      {
        "id": 2,
        "text": "Needle decompression into the 5th intercostal space anterior to the midaxillary line"
      },
      {
        "id": 3,
        "text": "Take the patient to the ICU and intubate him"
      },
      {
        "id": 4,
        "text": "Start positive pressure ventilation"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Tension pneumothorax </strong>is a condition where air accumulates in the pleural space due to a one-way valve air leak, leading to the collapse of the affected lung. This can cause a <strong>mediastinal shift, </strong>compression of the opposite lung, and decreased venous return, resulting in <strong>obstructive shock</strong>. It commonly occurs during <strong>positive-pressure mechanical ventilation, </strong>but can also happen after chest trauma, subclavian/internal jugular venous catheter insertion, or chest wall defects. The diagnosis is clinical, and immediate treatment is necessary without waiting for radiological confirmation.</p>\n<p>Tension pneumothorax is characterized by chest pain, tachypnoea, tachycardia, hypotension, tracheal deviation away from the side of injury, absent breath sounds on the affected side, cyanosis, and neck vein distention. Patients can also develop <strong>subcutaneous emphysema</strong> as a complication secondary to the pneumothorax.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/db0e19a8a4d34eb8893c5d98cd661e1dx376x360.PNG"
    ]
  },
  {
    "text": "Which of the following is true about polyarteritis nodosa?",
    "choices": [
      {
        "id": 1,
        "text": "Necrotising inflammation of large vessels"
      },
      {
        "id": 2,
        "text": "Patient has hypogammaglobulinemia"
      },
      {
        "id": 3,
        "text": "90% is associated with ANCA positivity"
      },
      {
        "id": 4,
        "text": "30% is associated with Hepatitis B"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The image below shows aneurysms in renal vasculature:&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5db82f2c18844397940a5ed9442d9326x490x360.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/33adfddf51944f70b788b371a520df08x502x580.PNG"
    ]
  },
  {
    "text": "Which type of aphasia is seen in the lesions of the posterior part of the superior temporal gyrus?",
    "choices": [
      {
        "id": 1,
        "text": "Fluent"
      },
      {
        "id": 2,
        "text": "Non fluent"
      },
      {
        "id": 3,
        "text": "Anomic"
      },
      {
        "id": 4,
        "text": "Conduction"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Lesions of the <strong>posterior part </strong>of the <strong>superior temporal gyrus </strong>cause <strong>Wernicke&rsquo;s </strong>or <strong>Fluent aphasia</strong> due to the involvement of the Wernicke's area. The speech is full of <strong>jargon</strong> and <strong>neologisms</strong> that make little sense <strong>(area no 22).&nbsp;</strong></p>\n<p><strong>Broca's</strong> (Option B) or <strong>motor/non-fluent aphasia</strong> is seen in lesions of the inferior frontal gyrus which contains the motor speech area. Speech is non-fluent and interrupted, with a paucity of functional words.</p>\n<p>Comprehension of written language and the ability to name objects are compromised in <strong>anomic aphasia</strong> (Option C). This aphasia is caused by damage to the angular gyrus that disrupts visual information processing and transmission to the Wernicke area.</p>\n<p><strong>Conduction aphasia </strong>(Option D) is seen in lesions of the arcuate fasciculus, the bundle of nerve fibers connecting the Wernicke and Broca's areas. Repetition of words is impaired and paraphasias are observed, though not as much as in Wernicke aphasia.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 70-year-old man with a known history of DM and HTN on regular medications presents with a history of progressively worsening dyspnoea on exertion. On examination, there is elevated JVP, positive hepatojugular reflux, crackles at the lung bases, hepatomegaly, ascites, and pedal oedema\u200b. What is your provisional diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Heart failure"
      },
      {
        "id": 2,
        "text": "Hypertrophic cardiomyopathy"
      },
      {
        "id": 3,
        "text": "Mitral regurgitation"
      },
      {
        "id": 4,
        "text": "Portal hypertension"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given symptoms and signs are suggestive of <strong>heart failure </strong>(Option A).</p>\n<p><strong>Portal hypertension</strong> (Option D) can be a result of r<strong>ight-sided heart failure,</strong> however, the presence of worsening dyspnea along with the other symptoms implies a <strong>primary cardiac condition.</strong></p>\n<p><strong>Heart failure</strong> is a common endpoint for most chronic cardiac conditions such as hypertension, valvular heart disease, and coronary heart disease.<br />The symptoms of heart failure are commonly due to <strong>volume overload </strong>with pulmonary and/or systemic venous pressures.</p>\n<table>\n<tbody>\n<tr>\n<td><strong>RIGHT HEART FAILURE</strong></td>\n<td><strong>LEFT HEART FAILURE</strong></td>\n</tr>\n<tr>\n<td>Symptoms occur due to <strong>systemic congestion</strong></td>\n<td>Symptoms occur due to <strong>pulmonary congestion</strong></td>\n</tr>\n<tr>\n<td>\n<ul>\n<li>Raised pulsatile JVP</li>\n<li>Hepatic congestion</li>\n<li>Tender hepatomegaly</li>\n<li>Pitting pedal edema</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Ascites</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Early satiety</li>\n</ul>\n</td>\n<td>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Shortness of breath</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Orthopnea (dyspnea that occurs within 1-2 mins of lying down)</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Paroxysmal nocturnal dyspnea(shortness of breath that develops after lying down for 30 mins or longer)</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Pulmonary rales</li>\n</ul>\n</td>\n</tr>\n</tbody>\n</table>\n<p><br /><br /></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The slowing of conduction in multiple sclerosis is due to which of the following?",
    "choices": [
      {
        "id": 1,
        "text": "Gliosis"
      },
      {
        "id": 2,
        "text": "Loss of myelin sheath"
      },
      {
        "id": 3,
        "text": "Defect at node of Ranvier"
      },
      {
        "id": 4,
        "text": "Leaky Na+ channel"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In multiple sclerosis, the <strong>slowing of conduction</strong> is due to<strong>&nbsp;</strong>the <strong>loss of the myelin sheath.</strong></p>\n<p>Under normal circumstances, nerve conduction in myelinated axons occurs in a saltatory manner i.e from one node of Ranvier to another. But, when demyelination sets in, the nerve impulse are unable to travel as fast due to not being saltatory. This produces either a conduction block or delay.</p>\n<p>Lesions due to multiple sclerosis begin with perivenular cuffing by inflammatory mononuclear cells. Myelin-specific autoantibodies cause degeneration of myelin sheaths. As lesions evolve, prominent astrocytic proliferation&nbsp;(gliosis)&nbsp;is observed.</p>\n<p><strong>Demyelination</strong>&nbsp;is the hallmark in the pathology of multiple sclerosis. But, it is not solely a disease affecting the myelin sheath. Partial or total axonal destruction&nbsp;(neuronal loss)&nbsp;can also occur.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 15-year-old girl presented with fatigue, chronic diarrhoea,  weight loss, bone pain, and abdominal distension.  Investigations revealed iron deficiency anemia and osteoporosis. Which of the following is the single best test to be done for her evaluation?",
    "choices": [
      {
        "id": 1,
        "text": "TSH levels"
      },
      {
        "id": 2,
        "text": "C-peptide levels"
      },
      {
        "id": 3,
        "text": "Urine sugar and ketone"
      },
      {
        "id": 4,
        "text": "IgA tissue transglutaminase antibody"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The presence of fatigue, chronic diarrhea, weight loss and abdominal distention along with investigations showing features of<strong> malabsorption (iron deficiency)</strong> lead to the diagnosis of <strong>celiac disease </strong>or<strong> gluten sensitive enteropathy. </strong>The single best test for which is checking serum for the presence of<strong> IgA tissue transglutaminase (anti-TTG) antibodies</strong> (Option D).</p>\n<p><strong>Celiac disease</strong> is a disorder characterized by an immunological response to gluten causing damage to the proximal intestinal mucosa<strong> (villous atrophy)</strong> and <strong>malabsorption</strong> of nutrients.</p>\n<p>Symptoms usually begin <strong>6 to 24 months</strong> from the introduction of gluten into diet, although most patients go undiagnosed.</p>\n<p>The common manifestations are - &nbsp;irritability, abdominal distention, chronic diarrhea, weight loss or muscle wasting and extra-intestinally, the symptoms observed are aphthous ulcers, delayed puberty, iron deficiency anemia and short stature.</p>\n<p><strong>Screening</strong> for celiac disease is by testing for <strong>tissue transglutaminase IgA,</strong> <strong>endomysial</strong>, and deamidated <strong>antigliadin</strong> antibodies. IgA levels in serum are measured to detect false-negative results because of<strong> IgA deficiency. </strong></p>\n<p><strong>Small intestinal biopsy</strong> shows characteristic <strong>villus blunting,</strong> <strong>crypt hyperplasia, </strong>and increased intraepithelial <strong>lymphocytes</strong>.</p>\n<p>The treatment involves the <strong>exclusion</strong> of <strong>gluten-containing</strong> food from diet.&nbsp;</p>\n<p>Long term complications observed are <strong>osteoporosis</strong>, anemia, infertility and malignancy <strong>(enteropathy related-T cell lymphoma</strong> is the most common association)&nbsp;</p>\n<p>The <strong>Marsh classification</strong> is used to categorize celiac disease into different types and to quantify severity of disease involvement.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 55-year-old male presented with tachypnea and mental confusion. His blood sugar is 350mg/dl, pH- 7.2, HCO3-10, pCO2-30. What is the primarymetabolic abnormality?",
    "choices": [
      {
        "id": 1,
        "text": "Metabolic alkalosis"
      },
      {
        "id": 2,
        "text": "Metabolic acidosis"
      },
      {
        "id": 3,
        "text": "Respiratory alkalosis"
      },
      {
        "id": 4,
        "text": "Respiratory acidosis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The patient has a <strong>primary metabolic acidosis</strong> with <strong>partial respiratory compensation</strong> (Option B)</p>\n<p><strong>Step 1:</strong> Observe pH - Patient is in acidosis.&nbsp;</p>\n<p><strong>Step 2</strong>: Observe the HCO3 value. The normal value of bicarbonate is 22 - 28 mEq/L, which means that this patient has low levels (10mEq/L) . This is indicative of a primary metabolic acidosis.&nbsp;<br />In case of a primary respiratory acidosis, the pCO2 values would have been greater than normal (35 - 45 mmHg). Hence, the answer cannot be Option D.</p>\n<p><strong>Step 3: </strong>Calculate the expected compensatory fall in pCO2 using Winter&rsquo;s formula :</p>\n<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Expected PaCO2 = [1 .5 X HCO3-] + 8 &plusmn; 2<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= (1.5 x 10) + 8 &plusmn; 2<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= <strong>23 &plusmn; 2 mEq/L</strong></p>\n<p>This implies that the levels in the patient are higher than expected - suggestive of a <strong>partially compensated metabolic acidosis.</strong></p>\n<p><strong>Note: </strong>The likely cause of the condition is diabetic ketoacidosis, as the patient has high blood sugar levels.&nbsp;</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A ten-year-old boy was brought to the OPD with fever and swelling of hands after playing football. He gives a history of previous episodes of swelling of hands. On imaging, his spleen was found to be shrunken. Which of the following is a likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Sickle cell anaemia"
      },
      {
        "id": 2,
        "text": "Malaria"
      },
      {
        "id": 3,
        "text": "Pancreatitis"
      },
      {
        "id": 4,
        "text": "Measles"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The findings of episodes of <strong>swelling of hands (dactylitis)</strong> along with the shrunken spleen <strong>(auto splenectomy or splenic infarction) </strong>are suggestive of <strong>sickle cell disease. </strong>Moreover, the symptoms were seen after playing football, which acts as a predisposing factor to sickling to which dehydration, infection and acidosis are the triggers.&nbsp;</p>\n<p>Sickle cell anemia is an <strong>autosomal recessive</strong> disorder that occurs due to the <strong>point mutation</strong> in the <strong>&beta;-globin gene,</strong> which results in the replacement of <strong>glutamate</strong> residue with <strong>valine</strong>. This causes the production of sickle-shaped red blood cells due to the <strong>polymerization</strong> of<strong> deoxygenated hemoglobin (HbS).</strong></p>\n<p>The cardinal clinical feature of sickle cell anemia is acute vaso-occlusive pain, due to ischemia of the tissues. Vaso-occlusive crisis can cause dactylitis, splenic infarction (shrunken spleen over time) and avascular necrosis (AVN).</p>\n<p>Most commonly, the femoral head is affected in AVN. Other sites affected include the humeral head and mandible.</p>\n<p><strong>Dactylitis, </strong>referred to as a hand-foot syndrome, is often the <strong>first</strong> manifestation of pain in infants and young children with sickle cell anemia. Dactylitis often manifests with symmetric or unilateral swelling of the hands and/or feet. &nbsp;</p>\n<p><strong>Other manifestations</strong> include:</p>\n<ul>\n<li>Acute splenic sequestration due to venous obstruction, needing emergency transfusion/splenectomy</li>\n<li>Painful ischemic crises due to vaso-occlusion in connective and musculoskeletal tissue</li>\n<li>Renal papillary necrosis leading to isosthenuria</li>\n<li>Cerebrovascular strokes</li>\n<li>Chronic lower leg ulcers</li>\n<li>Priapism in males</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 53-year-old woman underwent hip replacement surgery. A week after the surgery, the patient developed swelling of the legs associated with pain on palpation. Her heart rate is 70 beats per min. There is no history of hemoptysis or significant weight loss. There is no previous history of pulmonary embolism. What is the risk of developing pulmonary embolism in the patient based on Well's score?",
    "choices": [
      {
        "id": 1,
        "text": "Low"
      },
      {
        "id": 2,
        "text": "High"
      },
      {
        "id": 3,
        "text": "Moderate"
      },
      {
        "id": 4,
        "text": "Cannot comment without d-dimer values"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The risk of developing pulmonary embolism in this patient is <strong>high</strong> (Option B) according to the three-tiered <strong>Well&rsquo;s clinical risk assessment score.&nbsp;</strong></p>\n<p>Calculation of <strong>Well's score:</strong></p>\n<ul>\n<li>Clinical signs of DVT = 3; &nbsp;- swelling of legs, pain on palpation (Moses sign)</li>\n<li>No alternative diagnosis = 3&nbsp;</li>\n<li>Heart rate is &lt;100 BPM = 0; - 70 BPM</li>\n<li>Surgery in previous 4 weeks = 1.5; - hip replacement surgery 1 week ago&nbsp;</li>\n<li>No previous pulmonary embolism = 0</li>\n<li>No Hemoptysis = 0</li>\n<li>No malignancy = 0; - no significant weight loss&nbsp;</li>\n</ul>\n<p><strong>Total score = 7.5</strong></p>\n<p><strong>Risk stratification:</strong></p>\n<ul>\n<li>High risk = &nbsp;&gt; 6.0</li>\n<li>Moderate risk = &nbsp;2.0 to 6.0</li>\n<li>Low risk = &lt;2.0 (in patients with low risk, to further confirm the risk - pulmonary embolism rule-out criteria (PERC) may be referred)&nbsp;</li>\n</ul>\n<p><strong>Note: </strong>There is no other alternative diagnosis which is more likely in this condition, where there is a clear clinical presentation of a deep vein thrombosis, with the associated risk factors of a recent surgery and immobilization. Hence, 3 points can be added to the score. &nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The recommended temperature of water bath for a patient with frost bite is",
    "choices": [
      {
        "id": 1,
        "text": "37 degree C"
      },
      {
        "id": 2,
        "text": "42 degree C"
      },
      {
        "id": 3,
        "text": "32 Degree C"
      },
      {
        "id": 4,
        "text": "30 degree C"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The temperature of the water bath for a patient with <strong>frostbite</strong> should be maintained between <strong>37- 40&deg;C (Option A). </strong>Circulating water is preferred for treatment.&nbsp;</p>\n<p>In frostbite, tissue damage results from severe environmental cold exposure or from direct contact with a very cold object. Tissue injury results from both <strong>freezing</strong> and <strong>vasoconstriction</strong>. It usually affects the <strong>distal</strong> <strong>aspects</strong> of the extremities or <strong>exposed</strong> <strong>parts</strong> of the face, such as the ears, nose, chin, and cheeks.</p>\n<p>The treatment includes - <strong>extraction</strong> from cold environment, <strong>rapid rewarming,</strong> analgesics for pain during thawing, antithrombotics or thrombolytics, cleaning of the injured area with soap or antiseptics, tetanus prophylaxis, monitoring for <strong>compartment syndrome </strong>and finally, elective late amputation after imaging in severe cases.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a95fd453f15d441cae2c655e8df43e7fx476x356.PNG"
    ]
  },
  {
    "text": "A mutation in the gene for aquaporin channel leads to which of the following conditions?",
    "choices": [
      {
        "id": 1,
        "text": "Liddle's syndrome"
      },
      {
        "id": 2,
        "text": "Nephrogenic diabetes insipidus"
      },
      {
        "id": 3,
        "text": "Cystic fibrosis"
      },
      {
        "id": 4,
        "text": "Bartter syndrome"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>A mutation in the gene for <strong>aquaporin 2</strong> channel leads to <strong>nephrogenic diabetes insipidus.</strong></p>\n<p>The<strong> antidiuretic hormone</strong> (ADH) binds to <strong>V2 receptors</strong> in the late distal tubules, collecting tubules, and collecting ducts, and stimulates the movement of an intracellular protein, called aquaporin-2 (AQP-2), to the luminal side of the cell membranes.</p>\n<p><strong>Diabetes insipidus (DI)</strong> is a condition in which there is the absence of or poor response to anti-diuretic hormone (ADH). This results in reduced permeability of the distal tubules and collecting ducts to water. This furthermore leads the kidneys to excrete large amounts of dilute urine that clinically manifests as polyuria and polydipsia.\u00a0</p>\n<p>DI can be of <strong>four types</strong> :\u00a0</p>\n<table>\n<tbody>\n<tr>\n<td>Types\u00a0</td>\n<td>Primary pathology</td>\n<td>Caused by\u00a0</td>\n</tr>\n<tr>\n<td>Pituitary/ Central DI</td>\n<td>Primary deficiency of ADH secretion\u00a0</td>\n<td>Mc defect: AVP -Neurophysin II gene</td>\n</tr>\n<tr>\n<td>Primary polydipsia<br /><br /><br /><br /></td>\n<td>Suppression of ADH secretion by excessive fluid intake<br /><br /><br /><br /><br /></td>\n<td><br /><br />1. Dipsogenic DI : Following head trauma, TB meningitis, Multiple sclerosis.\u00a0<br />2. Psychogenic DI : Due to psychosis or OCD<br />3. Iatrogenic polydipsia : Due to motivated health benefits</td>\n</tr>\n<tr>\n<td>Gestational DI</td>\n<td>Deficiency due to Increased degradation of ADH\u00a0</td>\n<td>N terminal aminopeptidase produced by placenta</td>\n</tr>\n<tr>\n<td>Nephrogenic DI</td>\n<td>Renal insensitivity to ADH or drugs or genetic mutation</td>\n<td>Drugs like lithium - gene encoding V2 receptor on chXq28</td>\n</tr>\n</tbody>\n</table>\n<p><br /><strong>Note: </strong>Lithium - used to treat bipolar disorder, can <strong>cause acquired diabetes insipidus</strong> by decreasing the expression of the AQP2 gene.\u00a0</p>\n<p>Option A : <strong>Liddle\u2019s syndrome</strong> is due to an inherited gain of function mutation of genes regulating the Na channel in collecting duct ENaC, characterized by hypertension, hypokalemia, and metabolic alkalosis.\u00a0</p>\n<p>Option C :<strong> Cystic fibrosis</strong> is an autosomal recessive disorder due to mutation in CFTR gene that serves as a channel in the luminal plasma membranes of epithelial cells and regulates volume and composition of secretions in exocrine glands.</p>\n<p>Option D :<strong> Bartter syndrome</strong> is due to loss-of-function mutations of transporters and ion channels in thick ascending loop of henle, most commonly, Na-K-2Cl transporter.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not a radiological finding in a patient with left heart failure?",
    "choices": [
      {
        "id": 1,
        "text": "Kerley b lines"
      },
      {
        "id": 2,
        "text": "Focal oligemia"
      },
      {
        "id": 3,
        "text": "Increased venous blood in lung"
      },
      {
        "id": 4,
        "text": "Change in upper lobe circulation"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Other radiological signs of Pulmonary embolism :</p>\n<ul>\n<li><strong>Hampton&rsquo;s hump </strong>- a peripheral wedged-shaped density usually located at the pleural base</li>\n<li><strong>Palla&rsquo;s sign </strong>- an enlarged right descending pulmonary artery</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/454e36a125834f768526bc3535d8217cx588x544.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ec73a3c622b74d3f9a017192f3f52a65x702x626.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/fe9b0eab4b3046c9a14c85b095fe64c6x424x590.PNG"
    ]
  },
  {
    "text": "A 60-year-old man presented with an episode of acute onset dizziness and loss of consciousness which lasted for a few seconds followed by a regain of full consciousness. There were no similar episodes in the past. Which of the following is a true statement regarding this scenario?",
    "choices": [
      {
        "id": 1,
        "text": "ECG to rule out atrial fibrillation"
      },
      {
        "id": 2,
        "text": "If ECG is normal, CT scan should be done"
      },
      {
        "id": 3,
        "text": "Tilt-table testing"
      },
      {
        "id": 4,
        "text": "Vestibular neuritis is a possible condition that can cause these symptoms"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The clinical scenario of <strong>transient loss of consciousness </strong>in this patient is suggestive of <strong>syncope</strong>. Hence, an <strong>ECG </strong>must be done to rule out <strong>cardiac causes</strong> for syncope like - arrhythmias (atrial fibrillation, sinus node dysfunction, supra ventricular tachycardias) or a structural cardiac abnormality.</p>\n<p><strong>A CT</strong> would only be required if a <strong>seizure or transient ischemic attack (TIA) </strong>is suspected. However, in this case - the episode only lasted for a <strong>few seconds</strong>, the patient has <strong>no history</strong> of similar episodes in the past and there are <strong>no lasting neurological deficits</strong> after the episode. Therefore, <strong>option B is incorrect.</strong> &nbsp;</p>\n<p><strong>Syncope</strong> is a transient loss of consciousness caused by global cerebral hypoperfusion. It can be due to multiple causes, but is broadly divided into - <strong>neurally mediated syncope</strong>, <strong>orthostatic hypotension</strong> and<strong> cardiac syncope</strong>.&nbsp;</p>\n<p>The<strong> initial workup</strong> for a case of syncope includes:&nbsp;</p>\n<ol>\n<li>Detailed history of the episode and past history of similar episodes&nbsp;</li>\n<li>Physical examination mainly to check BP in standing and supine positions to</li>\n<li>rule out orthostatic hypotension.</li>\n<li>A resting ECG to look for cardiac arrhythmia</li>\n<li><strong>Option B: </strong>If the ECG is normal, no further tests are needed. If the ECG is suggestive of<strong> cardiac arrhythmia, </strong>then further tests including <strong>continuous ECG monitoring </strong>and <strong>electrophysiological studies </strong>may be done.</li>\n</ol>\n<p><strong>Option C:</strong> Tilt-table testing is done in patients with <strong>recurrent syncopal attacks</strong> who are suspected to have <strong>vasovagal syncope</strong>. Psychiatric evaluation is done in patients with recurrent unexplained syncopal attacks.</p>\n<p><strong>Option D</strong>: Vestibular neuritis is <strong>associated with vertigo</strong>, where the patients typically complain of dizziness and a sense of spinning of the head.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 12-year-old child who is known to have type 1 diabetes mellitus presents with confusion and drowsiness. Her mother says that she seems to be breathing very fast. On examination, mucous membranes are dry and blood pressure is 70/50 mm Hg. Random blood glucose is 415 mg/dl and urine ketones are 4+. What is the next best step in management?",
    "choices": [
      {
        "id": 1,
        "text": "2-3 L of normal saline over 1-3 hours"
      },
      {
        "id": 2,
        "text": "Insulin infusion at 0.1 units/kg/hour"
      },
      {
        "id": 3,
        "text": "Arterial blood gas"
      },
      {
        "id": 4,
        "text": "Insulin bolus of 0.1 units/kg given IV"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario is suggestive of <strong>diabetic ketoacidosis (DKA) </strong>and the first step is to assess the<strong> arterial blood gas</strong> (ABG) levels. This precedes correction of <strong>fluid balance</strong>, as assessment of the current status of the patient is necessary before beginning treatment. A <strong>baseline pH </strong>and <strong>electrolyte</strong> level must be obtained.</p>\n<p>Diabetic ketoacidosis is the most serious complication of <strong>type 1 diabetes mellitus.</strong> The symptoms include dehydration, nausea, vomiting, confusion, drowsiness, and coma in severe cases.</p>\n<p>In DKA, the<strong> insulin-to-glucagon ratio</strong> is <strong>decreased</strong> which promotes gluconeogenesis, glycogenolysis, and ketone body formation in the liver. Ketone bodies exist as ketoacids at physiological pH which are neutralized by bicarbonate. As bicarbonate stores are depleted, metabolic acidosis ensues. Increased lactic acid production also contributes to the acidosis.</p>\n<p>The <strong>diagnostic biochemical criteria </strong>for DKA includes:</p>\n<ul>\n<li>Hyperglycemia (&gt;250 mg/dL)</li>\n<li>Venous pH &lt;7.3</li>\n<li>Plasma/serum bicarbonate &lt;15-18 mmol/L</li>\n<li>Increased anion gap</li>\n<li>Ketonemia (beta-hydroxybutyrate [BOHB] &gt;3 mmol/L) and ketonuria</li>\n</ul>\n<p><strong>Signs</strong> of ketoacidosis:&nbsp;</p>\n<ul>\n<li>Kussmaul breathing (deep, heavy, non-labored rapid breathing)</li>\n<li>Fruity breath odor (acetone)</li>\n<li>Prolonged Q-T interval</li>\n<li>Diminished neurocognitive function</li>\n<li>Coma</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/18a61ed32ad34a81b485e17189c69f25x1280x2461.JPEG"
    ]
  }
];
        let quizName = '217 Medicine Neet 2020';
        let hierarchy = ["Marrow", "PYQs", "Medicine"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>