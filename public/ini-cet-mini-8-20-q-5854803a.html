<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ini-Cet Mini - 8 (20 Q) - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2020-21
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A four-year-old boy was brought to the OPD with complaints of chronic diarrhea since the age of 2 years. The child was on treatment for chronic diarrhea. The developmental milestones of the child were normal.  His hematological profile was normal, tissue Transglutaminase Antibody (tTG), Ig A was negative and total IgA was within the normal range. Stool examination showed RBCs but was negative for cysts and eggs. Endoscopy was performed and the duodenal biopsy is shown below. What type of motility is exhibited by the causative organism?",
    "choices": [
      {
        "id": 1,
        "text": "Falling leaf motility"
      },
      {
        "id": 2,
        "text": "Tumbling motility"
      },
      {
        "id": 3,
        "text": "Darting motility"
      },
      {
        "id": 4,
        "text": "Swarming motility"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The clinical vignette with the histopathology is indicative of a diagnosis of<strong> Giardiasis</strong>, caused by Giardia Lamblia which exhibits <strong>falling leaf motility</strong>.</p>\n<p>The image shows an H&amp;E stained section of the duodenal mucosa with giardiasis.&nbsp;The Giardia organisms here are seen in the bowel lumen as pale staining or translucent semicircular or crescent-shaped organisms.&nbsp;The intestinal villi have interepithelial lymphocytes but have a normal architecture.</p>\n<p>Giardia lamblia, also called <em>Giardia duodenalis</em>, is the causative agent of giardiasis.&nbsp;It&nbsp;is a common pathogenic protozoan found in the duodenum and jejunum of humans. Infection is by the consumption of <strong>water</strong> or <strong>food</strong> contaminated with cysts, or by directly by the&nbsp;<strong>feco-oral</strong> route.</p>\n<p>It is weakly pathogenic in humans. Secretory IgA and IL-6 are responsible for clearing the infection. Hence, giardiasis usually occurs in <strong>immunosuppressed, agammaglobulinemia</strong>, or <strong>malnourished individuals</strong>. The symptoms include acute or chronic diarrhea, weight loss, malaise, abdominal cramps, distension, and weakness. The stools may be watery, greasy, bulky, or foul-smelling at various times during the course of the infection.</p>\n<p>The trophozoite is heart-shaped or <strong>pyriform-shaped</strong>&nbsp;with <strong>2 </strong>equally sized <strong>nuclei </strong>and<strong> 4 pairs</strong> of<strong> flagella. </strong>It exhibits slow oscillating motility that resembles the movement of a <strong>falling leaf.&nbsp;</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/28d79d62988b43f5b8e6fc65a4f705de.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9fde03ef2edd4955bd4f1da380d6b5b2x541x464.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/dbfc1c8898d0409aa816b5d2469cabdcx700x460.JPEG"
    ]
  },
  {
    "text": "A 32-year-old man presented with progressive blurred vision, photophobia, and pain in the right eye. On examination, there was conjunctival redness, a mid-dilated pupil, and a shallow anterior chamber in the right eye. A procedure incorporates the following device to aid drainage and treat this condition. Identify the device.",
    "choices": [
      {
        "id": 1,
        "text": "Ex-Press mini shunt"
      },
      {
        "id": 2,
        "text": "Ahmed glaucoma valve"
      },
      {
        "id": 3,
        "text": "Molteno implant"
      },
      {
        "id": 4,
        "text": "Baerveldt implant"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p class=\"p1\">The clinical vignette points to a diagnosis of glaucoma and the device used is an\u00a0<strong>Ex-Press glaucoma implant (mini shunt)</strong>.</p>\n<p class=\"p1\">It is a\u00a0<strong>minimally invasive glaucoma surgery (MIGS)</strong> to increase aqueous drainage.</p>\n<div class=\"page\" title=\"Page 359\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Ex-Press glaucoma implant (mini shunt), is a small\u00a0stainless steel device.\u00a0It is inserted under a scleral flap during a modified trabeculectomy. Mitomycin c might be used to prevent scarring. Complications such as hypotony are lower as compared to standard trabeculectomy.</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/68cf1a78eb994453a05be111194bd8ec.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2f282462c5564aa6bf73bcf045600c07x1280x1518.3074753173485.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/241b4743c3b84c05ab5540b316620202x850x680.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c53478ed45f248d38e67e411a0f8a7eax1280x1215.JPEG"
    ]
  },
  {
    "text": "A 30-year-old lady presented with 5 weeks of amenorrhea and a positive pregnancy test. She is a known case of antiphospholipid antibody syndrome and her previous medical reports show that she had cortical vein thrombosis during the last pregnancy. Which of the following prophylactic measures should be undertaken to prevent the recurrence of such thromboembolic events?",
    "choices": [
      {
        "id": 1,
        "text": "Close monitoring during antepartum period with postpartum heparin"
      },
      {
        "id": 2,
        "text": "Heparin throughout the pregnancy and 6 weeks postpartum"
      },
      {
        "id": 3,
        "text": "Postpartum heparin for 4-6 weeks"
      },
      {
        "id": 4,
        "text": "Antepartum heparin during third trimester with postpartum monitoring"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In this patient of<strong>&nbsp;antiphospholipid antibody syndrome</strong>(APLA) with <strong>prior thromboembolic events</strong>(cortical vein thrombosis),&nbsp;<strong>heparin</strong> should be given <strong>throughout</strong> the pregnancy and<strong> 6 weeks postpartum</strong> to prevent recurrence in subsequent pregnancies.</p>\n<p>Antiphospholipid&nbsp;antibody syndrome(APLA)&nbsp;is an&nbsp;<strong>autoimmune</strong>&nbsp;<strong>disorder</strong> characterized by the presence of <strong>antiphospholipid antibodies</strong>, vascular <strong>thromboses</strong>, or <strong>obstetrical complications</strong>(such as <strong>recurrent pregnancy loss</strong> and <strong>placental dysfunction</strong> leading to fetal growth restriction, stillbirth, preeclampsia, and preterm birth). Antibodies target proteins like&nbsp;<strong>Cardiolipin</strong>&nbsp;and&nbsp;<strong>Beta-2-glycoprotein I</strong>.</p>\n<p><strong>Diagnosis</strong>&nbsp;of APLA requires at least 1 clinical (obstetric or vascular) criterion and 1 laboratory criterion.</p>\n<ul>\n<li><strong>Obstetric</strong>&nbsp;criteria\n<ul>\n<li>One or more unexplained <strong>deaths</strong> of a morphologically <strong>normal fetus</strong> at or beyond 10 weeks or</li>\n<li>Severe<strong> preeclampsia</strong> or <strong>placental insufficiency</strong> requiring delivery before 34 weeks, or</li>\n<li>Three or more unexplained consecutive <strong>spontaneous abortions</strong> before 10 weeks</li>\n</ul>\n</li>\n<li><strong>Vascular&nbsp;</strong>criteria: One or more episodes of arterial, venous, or&nbsp;small vessel thrombosis in any tissue or organ</li>\n<li><strong>Laboratory</strong>&nbsp;criteria include presence of:\n<ul>\n<li>Lupus anticoagulant, or</li>\n<li>Anti-cardiolipin antibodies, or</li>\n<li>Anti-&beta;2 glycoprotein I antibody.</li>\n</ul>\n</li>\n</ul>\n<div class=\"page\" title=\"Page 1131\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Specific therapy</strong> in pregnancy: <strong>Aspirin</strong> plus <strong>heparin</strong> therapy is the most effective regimen. Women are treated with low-dose aspirin (50 mg/day) and heparin (5,000 units SC twice daily) for up to 34 weeks. Unfractionated heparin and low molecular weight heparin (LMWH) are equally effective and safe.</p>\n<p><strong>Corticosteroids</strong>&nbsp;are used only in&nbsp;<strong>secondary</strong>&nbsp;<strong>APLA</strong>&nbsp;syndrome (associated with SLE) and not in primary APLA syndrome.&nbsp;</p>\n</div>\n</div>\n</div>\n</div>\n<div class=\"page\" title=\"Page 1158\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Prophylaxis</strong>:</p>\n<ul>\n<li>Women with <strong>prior thromboembolic events</strong>: Prophylactic anticoagulation&nbsp;<strong>throughout pregnancy</strong> and <strong>6 weeks postpartum</strong> with either <strong>heparin</strong>&nbsp;is recommended.&nbsp;<strong>Serial sonographic assessment</strong> of fetal growth and antepartum testing should be done in the <strong>third trimester</strong> due to the risk of fetal growth abnormalities and stillbirths.</li>\n<li>For women <strong>without prior thromboembolic events</strong>, acceptable regimes include:\n<ul>\n<li>Close antepartum maternal observation with or without prophylactic heparin along with postpartum anticoagulation for 4 to 6 weeks, or</li>\n<li>Surveillance alone , or</li>\n<li>Prophylactic heparin +low dose aspirin (if prior history of recurrent abortion or stillbirth)</li>\n</ul>\n</li>\n</ul>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 40-year-old man was admitted with altered sensorium, hydrophobia, and seizures after he was bitten by a stray dog 4 weeks ago. The patient passed away and an autopsy was performed. Identify the layer of the cerebellar cortex in which the pathognomic intracellular inclusion bodies are usually seen.",
    "choices": [
      {
        "id": 1,
        "text": "Layer C"
      },
      {
        "id": 2,
        "text": "Layer B"
      },
      {
        "id": 3,
        "text": "Layer A"
      },
      {
        "id": 4,
        "text": "Layer D"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The clinical scenario is that of <strong>rabies encephalitis</strong> and the pathognomic intracellular inclusion bodies (Negri bodies) are seen in Purkinje cells belonging to the <strong>Purkinje cell layer (Layer C).</strong></p>\n<div class=\"page\" title=\"Page 2\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<div class=\"page\" title=\"Page 1144\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>The cerebellar cortex is divided into 3 layers histologically. They are:</p>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n<ul>\n<li><strong>Molecular layer</strong>\u00a0- It is the\u00a0<strong>outermost</strong>\u00a0layer that contains\u00a0<strong>stellate cells and basket cells</strong>, and dendrites of Purkinje cells. They receive excitatory input from the parallel fibers and form\u00a0<strong>inhibitory</strong>\u00a0synapses on the Purkinje cells. It contains many myelinated and unmyelinated nerve fibers. It appears pale on H and E staining.</li>\n<li><strong>Purkinje layer</strong>\u00a0- contain the cell bodies of the\u00a0<strong>Purkinje cells\u00a0</strong>which are flask-shaped. Characteristics of Purkinje cells:\n<ul>\n<li><strong>Flask-shaped</strong>, evenly spaced cells\u00a0arranged in a single layer.</li>\n<li><strong>The only efferents of the</strong> <strong>cerebellar cortex.</strong></li>\n<li>A dendrite\u00a0from the neck of each flask-shaped cell passes upward to the molecular layer and the axon passes down through the granular layer to the white matter.</li>\n<li>Purkinje cells<strong>\u00a0</strong>are <strong>inhibitory</strong> and use GABA as their neurotransmitter.</li>\n</ul>\n</li>\n<li><strong>Granular layer</strong>\u00a0- It is the\u00a0<strong>innermost</strong>\u00a0layer. It contains the cell bodies of the\u00a0<strong>granule cells</strong>. It receives excitatory input from the mossy fibers. They end the dendrites of the granule cells and these complexes are called\u00a0<strong>glomeruli</strong>. The axon from the granule cells travels to the molecular layer and bifurcates in a T-shape. These branches from the T are called parallel fibers. These parallel fibers form excitatory synapses with the Purkinje cells. The granule cells form the\u00a0<strong>only excitatory neurons</strong>\u00a0in the cerebellar cortex. It also contains\u00a0<strong>Golgi cells\u00a0</strong>that receive input from parallel fibers and mossy fibers. They send inhibitory output to the granule cells.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/41cf8588432041fea3e42ad5d966ba14.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/94322492b1964024b9ad5ead4c56f8a9x1280x1012.8067700987306.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/cb87fa4d2c2d48ad9adbc5e4257d18cdx254x191.PNG"
    ]
  },
  {
    "text": "A 50-year-old woman presented with complaints of drooping of the angle of the mouth and blurred vision, redness, and pain in both eyes for the past few days. She says that over the past three months she has had a cough, mild fever, and has lost weight. Examination reveals a pulse rate of 84 beats per minute, a blood pressure of 138/76 mm of Hg, and a temperature of 99 F. The right parotid region appears swollen. There is facial asymmetry with drooping of the angle of the mouth, inability to close her right eye, and furrow her forehead on the same side. A chest X-ray is performed which reveals the findings attached below. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Posner-Schlossmann syndrome"
      },
      {
        "id": 2,
        "text": "Heerfordt's syndrome"
      },
      {
        "id": 3,
        "text": "Lofgren's syndrome"
      },
      {
        "id": 4,
        "text": "Tolosa Hunt syndrome"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>This clinical vignette along with the chest X-ray finding of bilateral hilar node enlargement is strongly suggestive of <strong>Heerfordt-Waldenstr\u00f6m syndrome</strong> or <strong>Uveo-parotid fever</strong>. It is a rare presentation of sarcoidosis, and also considered a type of neurosarcoidosis. It is characterized by-</p>\n<ul>\n<li>Fever</li>\n<li>Anterior uveitis- Presents as\u00a0diffuse congestion of the conjunctival vessels with a prominent circumcorneal injection, pain, and blurred vision</li>\n<li>Parotid gland enlargement- Due to a granulomatous inflammatory reaction. Cervical lymphadenopathy may also be present.\u00a0</li>\n<li>Facial nerve palsy- May show epineural granulomas and perineural inflammation involving the facial nerve.\u00a0</li>\n</ul>\n<p id=\"__p5\">The <strong>bilateral hilar lymph node enlargement</strong> further alludes to the diagnosis of sarcoidosis. Sarcoidosis is a systemic disease characterized by the formation of\u00a0<strong>non-caseating granulomas</strong>. Patients with sarcoidosis typically present with cough, dyspnea, chest pain, fever, weight loss, arthralgias, and erythema nodosum. Few patients may have neurological involvement with facial nerve palsy being the most common manifestation.\u00a0</p>\n<p>Diagnosis may be established based on clinical features and biopsy findings. Investigations that are generally used include-</p>\n<ul>\n<li><strong> Chest X-ray:</strong></li>\n</ul>\n<p style=\"padding-left: 30px;\">The chest radiograph is the preferred tool used to stage sarcoidosis. It depends on the lymphadenopathy and pulmonary infiltrates.\u00a0The parenchymal infiltrates in sarcoidosis are predominantly seen in the upper lobe and appear as\u00a0diffuse reticular infiltrates.\u00a0<strong>Garland triad</strong>\u00a0is a lymph node enlargement pattern seen on the chest radiographs in sarcoidosis. It involves the right paratracheal nodes, right hilar nodes, and left hilar nodes. It is also known as the\u00a0<strong>1-2-3 sign or Pawnbrokers sign</strong>.\u00a0</p>\n<p style=\"padding-left: 30px;\">The staging of sarcoidosis is as below-</p>\n<table style=\"margin-left: 30px; width: 833px;\">\n<tbody style=\"padding-left: 30px;\">\n<tr style=\"padding-left: 30px;\">\n<td style=\"padding-left: 30px; width: 65px;\">Stage 1</td>\n<td style=\"padding-left: 30px; width: 694px;\">Bilateral hilar lymphadenopathy (usually symmetrical); right paratracheal nodes often enlarged</td>\n</tr>\n<tr style=\"padding-left: 30px;\">\n<td style=\"padding-left: 30px; width: 65px;\">Stage 2\u00a0</td>\n<td style=\"padding-left: 30px; width: 694px;\">Bilateral hilar\u00a0lymphadenopathy and parenchymal infiltrates</td>\n</tr>\n<tr style=\"padding-left: 30px;\">\n<td style=\"padding-left: 30px; width: 65px;\">Stage 3</td>\n<td style=\"padding-left: 30px; width: 694px;\">Parenchymal infiltrates\u00a0without\u00a0bilateral hilar lymphadenopathy</td>\n</tr>\n<tr style=\"padding-left: 30px;\">\n<td style=\"padding-left: 30px; width: 65px;\">Stage 4</td>\n<td style=\"padding-left: 30px; width: 694px;\">Pulmonary fibrosis\u00a0\u00a0</td>\n</tr>\n</tbody>\n</table>\n<ul>\n<li><strong>Biopsy:</strong>\u00a0Biopsies reveal non-caseating granulomas.\u00a0</li>\n</ul>\n<div class=\"ng-scope\">\n<div class=\"ng-scope\">\n<ul>\n<li class=\"ng-binding\"><strong>Gallium-67 scan:</strong>\n<ul>\n<li><strong>Panda sign</strong>- It is due to bilateral involvement of parotid and lacrimal glands in sarcoidosis, superimposed on the normal uptake in the nasopharyngeal mucosa.</li>\n<li><strong>Lambda sign-</strong>\u00a0It<strong>\u00a0</strong>is seen in thoracic<strong>\u00a0</strong>sarcoidosis.<strong>\u00a0</strong>Bilateral hilar and right paratracheal lymph nodes are typically involved which can resemble the lambda symbol (\u03bb).</li>\n</ul>\n</li>\n<li><strong>Elevated serum ACE levels:</strong>\u00a0Granulomas in sarcoidosis are known to produce ACE.\u00a0</li>\n<li><strong>Hypercalcemia</strong>\u00a0may be seen, due to increased synthesis of\u00a0calcitriol \u2013 1,25-dihydroxy vitamin D, by alveolar macrophages. In some patients, there may be\u00a0hypercalciuria,\u00a0which can lead to nephrocalcinosis.</li>\n<li><strong>Increased CD4/CD8 ratio</strong> of these increased lymphocytes in the BAL fluid. A ratio of &gt;3.5 is strongly supportive of sarcoidosis.</li>\n<li>Bronchoscopy shows the typical\u00a0<strong>'cobblestone' appearance</strong>\u00a0of the mucosa.</li>\n<li><strong>Pulmonary function test</strong>\u00a0shows a restrictive lung disease, with impaired gas exchange.</li>\n</ul>\n</div>\n</div>\n<p class=\"p p-last\">Treatment of\u00a0Heerfordt-Waldenstr\u00f6m syndrome is with <strong>corticosteroids</strong>, which forms the mainstay of treatment. Immunosuppressants such as mycophenolate mofetil, cyclosporine, and infliximab can be used in patients who are refractory to steroids.\u00a0</p>\n<p class=\"p p-last\">The stages of sarcoidosis are given below:</p>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/49295b61a96b43d6b1ef20160e2cb426.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/046ce7ca126e4b17bcf758c665420929x1280x5233.JPEG"
    ]
  },
  {
    "text": "A 52-year-old man is bought to the emergency department after being found in a confused state at a bus station in Kerala. He is unable to recall his name, address, spouse's name, or any other personal information. His driving license from his wallet revealed that he is from Bangalore. Further investigation revealed that he got laid off from his job two days ago. He has no history of substance abuse. Which of the following is the most likely diagnosis for this patient's condition?",
    "choices": [
      {
        "id": 1,
        "text": "Dissociative amnesia with dissociative fugue"
      },
      {
        "id": 2,
        "text": "Confabulation"
      },
      {
        "id": 3,
        "text": "Depersonalization"
      },
      {
        "id": 4,
        "text": "Dissociative identity disorder"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>&nbsp;This clinical vignette is suggestive of <strong>dissociative amnesia</strong> with a&nbsp;<strong>dissociative fugue</strong>.&nbsp;</p>\n<div class=\"page\" title=\"Page 470\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Dissociative amnesia</strong> is characterized by extensive and severe amnesia with an <strong>inability </strong>to<strong> recall</strong> important<strong> autobiographical information</strong>. The amnesia is <strong>predominantly retrograde</strong> with minimal anterograde amnesia. It usually follows severe emotional trauma, interpersonal conflicts, and other <strong>stressful events</strong>, such as sexual abuse, loss of a loved one, loss of livelihood, etcetera. Clinically, the presentation is quite dramatic with significant impairment in social, personal, and occupational functioning. In order for a diagnosis of dissociative amnesia to be made, it is imperative to rule out substance use, and other neurological and psychological conditions that may lead to a presentation similar to dissociative amnesia.&nbsp;</p>\n<p>It is further categorized into the following types:</p>\n<ul>\n<li>Selective amnesia:&nbsp;Ability to remember some of the events occurring during a circumscribed period of time.</li>\n<li>Localized amnesia:&nbsp;Inability to recall all events in a circumscribed period of time.</li>\n<li>Generalized amnesia:&nbsp;Failure to recall one&rsquo;s entire life.</li>\n<li>Continuous amnesia:&nbsp;Failure to recall successive events as they occur.</li>\n<li>Systematized amnesia:&nbsp;Amnesia for certain categories of memory, such as all memories relating to one&rsquo;s family or to a particular person.</li>\n</ul>\n<p><strong>Dissociative fugue</strong> is characterized by a sudden, unintended, and <strong>unexpected travel</strong> to a place away from home, or workplace, or another place involved in one's daily repertoire. It is usually brief, lasting few hours to days, and is generally reversible. It is commonly associated with dissociative amnesia. In addition to amnesia, these patients may also experience confusion, trance-like behaviors, depersonalization, derealization, and conversion symptoms. It may recur in some patients.</p>\n<p>It is important to note that dissociative fugue was deleted as a major diagnostic category in DSM-5. It is instead declared as a subtype or specifier of disso&shy;ciative amnesia.</p>\n<p>Treatment of dissociative amnesia and dissociative fugue is mainly with psychotherapy.&nbsp;</p>\n<div class=\"page\" title=\"Page 475\">\n<p>Other options-</p>\n<p>Option B: <strong>Confabulation</strong>&nbsp;refers to the&nbsp;unconscious <strong>filling</strong> of <strong>gaps</strong> in memory&nbsp;with inaccurate, fabricated, and often implausible information.</p>\n<p>Option C: <strong>Depersonalization</strong>&nbsp;is defined as the&nbsp;persistent or recurrent feeling of&nbsp;<strong>detachment</strong> from one's self. The patient may report feeling like an automation or like they are watching themselves in a movie.</p>\n<p>Option D: <strong>Dissociative identity disorder&nbsp;</strong>is characterized by the presence of&nbsp;two or more&nbsp;distinct identities or&nbsp;personality states&nbsp;that assume control of an individual's behavior. It was previously called&nbsp;multiple personality disorder.&nbsp;</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A\u00a025-year-old obese\u00a0woman comes to the clinic with complaints of\u00a0multiple painful lesions associated with a foul-smelling\u00a0discharge in the axilla. Examination findings are as shown in the image given below. Which of the following is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Acne vulgaris"
      },
      {
        "id": 2,
        "text": "Necrobiosis lipoidica"
      },
      {
        "id": 3,
        "text": "Pyoderma gangrenosum"
      },
      {
        "id": 4,
        "text": "Hidradenitis suppurativa"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The above clinical scenario along with the image showing multiple lesions with foul-smelling discharge in the\u00a0intertriginous area (axilla) in an obese female is strongly suggestive of <strong>hidradenitis suppurativa</strong>.</p>\n<p>Hidradenitis suppurativa is also called <strong>acne inversa</strong> and is seen more commonly seen after puberty. It is a <strong>chronic, inflammatory, recurrent,</strong> <strong>debilitating, follicular</strong> disease.</p>\n<p>The following <strong>three criteria</strong> must be met for the diagnosis to be made:</p>\n<ol>\n<li><strong>Typical lesions - </strong>The lesions can manifest as<strong>\u00a0deep\u2010seated painful nodules,</strong>\u00a0abscesses, <strong>draining sinuses</strong>, <strong>bridged scars</strong>, and paired or multiheaded open pseudo comedones.</li>\n<li><strong>Typical locations -\u00a0</strong>axillae, groin, perineal and perianal region, buttocks, and <strong>infra\u2010 and intermammary folds</strong>.</li>\n<li><strong>Chronicity</strong> and<strong> recurrence</strong> of lesions.\u00a0</li>\n</ol>\n<div class=\"page\" title=\"Page 2426\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<div class=\"page\" title=\"Page 2426\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<div class=\"explanationContentMargin___14IEh\">\n<div class=\"explanationContent-3128605225\" data-intutorial=\"false\">\n<p>Treatment includes:\u00a0</p>\n<ul>\n<li>General measures - <strong>lifestyle modifications</strong> such as cessation of smoking, <strong>weight loss</strong>, and general cleanliness are advised.\u00a0</li>\n<li><strong>Antibiotics</strong> - <strong>Topical clindamycin lotion 0.1%</strong>\u00a0can be used to manage milder lesions. Systemic antibiotics like\u00a0<strong>tetracycline</strong> and a combination of <strong>clindamycin</strong> and <strong>rifampicin</strong> can be used in such conditions.</li>\n<li>Intralesional corticosteroids such a <strong>triaminolone </strong>can be used.</li>\n<li>Acitretin</li>\n<li>Anti-TNF alpha therapy</li>\n<li>Surgery -\u00a0Many lesion\u2010directed therapies have been identified as beneficial in the therapy of HS. <strong>Incision and drainage</strong> are done in a presence of a fluctuant abscess.\u00a0<strong>Deroofing</strong>\u00a0can also be done which is a tissue-saving procedure in which the roof of an abscess or sinus tract is surgically removed using either electrosurgery (using a loop) or conventional surgery. <strong>Ablative lasers</strong> and <strong>electrosurgery </strong>are also useful in removing all the involved tissues.\u00a0<br /><br /></li>\n</ul>\n<p>Other options:</p>\n<p>Option A: <strong>Acne vulgaris</strong>\u00a0is one of the most common skin diseases, highly prevalent in <strong>adolescents</strong>. The lesions can manifest as <strong>open</strong> and <strong>closed comedones</strong>, <strong>papules</strong>, <strong>pustules</strong>, or\u00a0<strong>nodules</strong> with variable degrees of inflammation and depth. The most usually affected areas are the <strong>face</strong>, <strong>back</strong>, and/or <strong>chest</strong>.\u00a0These would not be found in the axillary region.</p>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/7663df46f588472b88378010bccc3d5b.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6d947769ba584c2e86d0c470cf6ddbe6x720x540.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/77392a150c054ce3b307a11730da44c4x1280x1675.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/52964d992b9844898c24726cc599916ax450x338.PNG"
    ]
  },
  {
    "text": "A 65-year-old female patient came to your orthopedic clinic with complaints of pain in the hips and knees. You suspect osteoarthritis of the hips and knees and request an X-ray, findings of which are attached below. Which among the following is the most likely diagnosis of her incidental finding?",
    "choices": [
      {
        "id": 1,
        "text": "Sclerotherapy for varicose veins"
      },
      {
        "id": 2,
        "text": "Monckeberg sclerosis"
      },
      {
        "id": 3,
        "text": "Leriche syndrome"
      },
      {
        "id": 4,
        "text": "Deep vein thrombosis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The incidental X-ray findings showing extensive calcification of the femoral arteries in this patient which are strongly suggestive of\u00a0<strong>Monckeberg medial sclerosis</strong>.\u00a0It<strong>\u00a0</strong>is caused due to calcification in the\u00a0medial walls of <strong>muscular arteries </strong>starting at\u00a0the <strong>internal elastic lamina</strong>.</p>\n<p>It occurs in people aged 50 years and above as a part of <strong>senile degeneration</strong>. Since the calcifications do not\u00a0encroach on the vessel lumen and are usually not\u00a0clinically significant. Therefore, it is usually an incidental finding as in this case.\u00a0</p>\n<p>Histopathological examination reveals\u00a0<strong>c</strong><strong>alcification</strong>\u00a0that is seen as the dark purple stained area on the H&amp;E staining as shown in the image below.</p>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/0db9afc5b50749099d1fbde43a734606.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/cdfb0ab9501a40b2958dc1692a87923ex800x533.JPEG"
    ]
  },
  {
    "text": "A 4-year-old female child is currently under evaluation for supra-valvular aortic stenosis and mental retardation. A characteristic facies is present as shown in the image below. Her karyotype reveals 46XX and her blood investigations reveal hypercalcemia. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "DiGeorge syndrome"
      },
      {
        "id": 2,
        "text": "Williams syndrome"
      },
      {
        "id": 3,
        "text": "Down syndrome"
      },
      {
        "id": 4,
        "text": "Edward syndrome"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>This clinical vignette of mental retardation, elfin facies, hypercalcemia, and supravalvular aortic stenosis is strongly suggestive of <strong>Williams' syndrome</strong>.</p>\n<p>The image shows a young girl with an elfin face with a round face, full cheeks, broad nasal bridge, anteverted nares, thick lips, and a large mouth that is usually left open. They also have short palpebral fissures, prominent ears, and a small mandible.\u00a0</p>\n<p>It is an <strong>autosomal dominant</strong> disorder characterized by multiple congenital development defects, including supra-valvular aortic stenosis, mental retardation, and an elfin facies, in association with hypercalcemia due to abnormal sensitivity to vitamin D with elevated levels of\u00a0<strong>1,25(OH)2D</strong>\u00a0ranging from 150 to 500 pg/mL.</p>\n<p>Williams' syndrome is caused due to\u00a0genetic mutations involving <strong>microdeletions</strong> at the elastin locus on <strong>chromosome 7</strong>.\u00a0</p>\n<p>Other options-</p>\n<p>Option A: <strong>DiGeorge syndrome</strong>\u00a0is caused due to<strong> deletion of chromosome\u00a022q11.2</strong>. The characteristic features are (Mnemonic\u00a0<strong>CATCH-22</strong>) Cardiac abnormality, abnormal facies, thymic aplasia, cleft palate, hypocalcemia, deletion 22q11.2.</p>\n<p>The following image shows a child with <strong>DiGeorge syndrome:</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/9bff2981730c472cba2f568e4c839be8.jpeg"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/597006234c6440de830aee28e50627bbx233x313.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c247d2300e1c4d1caea1a8da0279cf18x1280x1762.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5262579c4cdd4e8884481a1b1a351a90x292x432.PNG"
    ]
  },
  {
    "text": "A 43-year-old man comes to the physician because of nasal congestion and fever for 12 days. His nasal discharge was initially clear but turned yellowish over the last few days. Over-the-counter nasal decongestants and paracetamol have not provided much relief. Examination shows purulent discharge in the nose and pharynx and tenderness over the left maxillary sinus. Which of the following is the next best step in the management of this patient's condition?",
    "choices": [
      {
        "id": 1,
        "text": "Reassurance and follow-up in 1 week"
      },
      {
        "id": 2,
        "text": "Oral amoxicillin-clavulanic acid"
      },
      {
        "id": 3,
        "text": "X-ray of the paranasal sinuses"
      },
      {
        "id": 4,
        "text": "Intravenous amphotericin B"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>This patient with fever, purulent nasal discharge, and a tender maxillary sinus, most likely has <strong>acute sinusitis</strong> and the most appropriate management for this patient is to initiate treatment with <strong>oral amoxicillin and clavulanic acid</strong>.&nbsp;</p>\n<p>His <strong>initial symptoms</strong> of clear mucoid discharge are suggestive of <strong>acute viral rhinosinusitis</strong>, wherein reassurance and symptomatic supportive treatment would have been appropriate. It usually <strong>resolves </strong>in<strong> 7-10 days</strong>.</p>\n<p>However, this patient's longer duration of symptoms&mdash;beyond 10 days, along with a change in the character of nasal discharge from clear to mucopurulent suggests superinfection with bacteria such as <strong>Streptococcus pneumonia</strong> or <strong>Hemophilus influenza.</strong>&nbsp;<strong>Bacterial rhinosinusitis</strong> necessitates treatment with antibiotics. These patients usually present with purulent nasal discharge, nasal obstruction, facial pain and tenderness, headache, and a persisting fever.&nbsp;</p>\n<p><strong>X-ray </strong>is<strong> not recommended</strong> for the routine diagnosis of acute sinusitis as they do not change the course of management in most cases. <strong>CT scans</strong> are used when <strong>complications</strong> due to acute sinusitis such as orbital cellulitis are suspected.&nbsp;</p>\n<p>Antibiotics such as <strong>oral amoxicillin and clavulanic acid</strong> are the first-line agents. <strong>Supportive treatments</strong> such as NSAIDs, decongestants, saline irrigation, and antihistamines may be prescribed. Amphotericin B, on the other hand, is an antifungal. It is used in the treatment of pathologies such as mucormycosis and aspergillosis.&nbsp;</p>\n<p>Complications of acute maxillary sinusitis are:</p>\n<ul>\n<li>Chronic sinusitis</li>\n<li>Frontal sinusitis</li>\n<li>Osteomyelitis of the maxilla</li>\n<li>Orbital cellulitis: infection may spread directly through the roof of the maxilla or indirectly through the ethmoid sinus.</li>\n</ul>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 57-year-old male patient presents to the outpatient clinic with complaints of severe joint pain on his big toe with multiple such episodes in the past. The X-ray shows the 'G' sign. Which of the following signs is also expected to be seen on ultrasound in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Linguine sign"
      },
      {
        "id": 2,
        "text": "Double contour sign"
      },
      {
        "id": 3,
        "text": "Accordion sign"
      },
      {
        "id": 4,
        "text": "Water lily sign"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The X-ray of this patient shows&nbsp;<strong>Martel's sign</strong>/&nbsp;<strong>G-sign</strong>&nbsp;which&nbsp;refers to<strong>&nbsp;</strong>the punched-out lytic lesion and overhanging margin of the new bone. It is seen in <strong>chronic gout</strong>. Among the given options, the radiological sign that is seen in chronic gout is the&nbsp;<strong>double contour sign.&nbsp;</strong></p>\n<p><strong>Double contour sign</strong>&nbsp;is an ultrasound finding that&nbsp;is characterized by an echogenic line on the outer surface of the joint cartilage due to the deposition of monosodium urate crystals on the surface of articular cartilage.</p>\n<p>Gout is a metabolic disease that is characterized by the deposition of&nbsp;<strong>monosodium urate&nbsp;crystals</strong>&nbsp;in joints and connective tissue. It is more common in males and it usually presents as monoarthritis that may be acute and episodic or chronic.&nbsp;</p>\n<ul>\n<li>Acute gout presents with a joint that is red, hot, swollen, and extremely tender on examination.&nbsp;The metatarsophalangeal joint of the great toe is the most frequently involved joint.</li>\n</ul>\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Chronic gout may present with chronic nonsymmetric synovitis, gouty arthritis, and periarticular tophaceous deposits.</p>\n<p>Synovial fluid analysis of joint aspirate is diagnostic and shows the following features-</p>\n</div>\n</div>\n</div>\n<ul>\n<li>Increased leukocyte count with a neutrophilic predominance</li>\n<li>Negatively birefringent crystals on polarized light microscopy of the synovial fluid.</li>\n</ul>\n<p>Other options-</p>\n<p>Option A:&nbsp;<strong>Linguine sign</strong> is seen in intracapsular rupture of <strong>silicone breast implant</strong>.</p>\n<p>Option C:&nbsp;The <strong>Accordion sign</strong> is seen in <strong>pseudomembranous colitis</strong>.</p>\n<p>Option D: <strong>Water lily sign</strong> is seen in<strong> hydatid cyst</strong>.</p>\n<p>&nbsp;</p>\n<p>Ultrasound double contour sign:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3de43f49bd4e40759a5b0e13035c443cx600x530.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/98836b886fc34a328eb80455f715ae6cx889x657.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c50ef63667fa4172883ba7848612003dx720x1251.PNG"
    ]
  },
  {
    "text": "A physician is studying parameter x. She checks the parameter x of all patients using an automated apparatus and compares them to manual checking (considered by her as the gold standard). For patient A, she finds that the automated apparatus and manual checking give very different values. However, on checking 5 times with the automated apparatus, all 5 values obtained are similar to each other. What can be concluded about the automated apparatus?",
    "choices": [
      {
        "id": 1,
        "text": "High validity, low precision"
      },
      {
        "id": 2,
        "text": "High validity, high precision"
      },
      {
        "id": 3,
        "text": "Low validity, low precision"
      },
      {
        "id": 4,
        "text": "Low validity, high precision"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The automated apparatus has <strong>low validity (accuracy)\u00a0</strong>but <strong>high precision.</strong></p>\n<p><strong>Validity (accuracy) </strong>refers to what extent the test accurately measures which it sets out to measure. It refers to the<strong> closeness</strong> with which measured values agree with <strong>\"true\" values. </strong>The values obtained by the automated apparatus are very different from the true values, reducing the validity of the automated apparatus readings.</p>\n<p><strong>Precision</strong> (reliability or reproducibility) is a measure of <strong>repeatability</strong> of a test. That is, the test must give consistent results when repeated more than once on the same individual or material, under the same conditions. The 5 values obtained by the automated apparatus are close to each other, making it precise.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 6-year-old girl was brought with the complaint of sudden and inappropriate outbursts of laughter for no apparent cause in the past 6 months. Her examination reveals developmental delay. Her brain MRI shows the following feature. Considering the suspected diagnosis, which other feature is most likely to be seen with this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Hypothermia"
      },
      {
        "id": 2,
        "text": "Diabetes mellitus"
      },
      {
        "id": 3,
        "text": "Polydipsia"
      },
      {
        "id": 4,
        "text": "Precocious puberty"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The patient seems to be suffering\u00a0<strong>Gelastic seizures. </strong>Her brain MRI\u00a0image shows a\u00a0pedunculated mass in the floor of the 3rd ventricle\u00a0which is suggestive of a <strong>hypothalamic hamartoma.</strong>\u00a0Thus, the other feature most likely to be seen in this condition is<strong>\u00a0precocious puberty.</strong></p>\n<p><strong>Precocious puberty</strong>\u00a0in a <strong>girl</strong> is the\u00a0appearance of any of the <strong>secondary sexual characteristics </strong>before the age of<strong> 8 years.</strong>\u00a0Precocious puberty\u00a0in<strong> boys</strong>\u00a0is the onset of secondary sexual characteristics\u00a0before the age of <strong>9 years</strong>.\u00a0</p>\n<p><strong>Hypothalamic hamartoma\u00a0</strong>arises from a neuronal migration defect between 35 to 40 days of intrauterine life. They present with a <strong>classical triad</strong> of:</p>\n<ul>\n<li>Gelastic epilepsy</li>\n<li>Precocious puberty</li>\n<li>Developmental delay</li>\n</ul>\n<p>Other clinical features can include hypothalamic signs like <strong>diabetes</strong> <strong>insipidus</strong>, <strong>adipsia</strong>, <strong>hyperthermia</strong>, cachexia, and obesity.</p>\n<p>A\u00a0<strong>gelastic seizure</strong>\u00a0is a rare type of\u00a0<strong>seizure</strong>\u00a0that involves a sudden burst of energy, usually in the form of\u00a0<strong>laughing</strong>\u00a0or crying. They have been associated classically with hypothalamic hamartomas.\u00a0</p>\n<p>Treatment of Hypothalamic Hamartoma involves</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>GnRH agonists</strong> (depot-forms or implant) are the treatment of choice for tumor-induced central precocious puberty\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">In patients with hypothalamic hamartoma and associated intractable <strong>gelastic or psychomotor seizures</strong>, stereotactic radiation therapy (Gamma Knife surgery) is more effective and has fewer risks than neurosurgical intervention.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3e2e1c5acb1c4f1d8b3f00cb0749e34d.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "An intern enumerates the steps to place an intercostal drainage tube in a patient. Which of the following steps is incorrect?",
    "choices": [
      {
        "id": 1,
        "text": "Intercostal tube is to be placed along the upper border of lower rib"
      },
      {
        "id": 2,
        "text": "Identify 5th intercostal space posterior to mid axillary line to place the tube"
      },
      {
        "id": 3,
        "text": "Direct the tube posteriorly to prevent injury"
      },
      {
        "id": 4,
        "text": "Local anesthesia should include the pleura"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>An intercostal tube is placed in the&nbsp;<strong>triangle of safety</strong> which is the safest site for insertion of a drain that lies in the 5th intercostal space<strong> anterior to the mid axillary line,</strong> above the level of the nipple, and, below and lateral to the pectoralis major muscle.</p>\n<p><strong>Inserting and managing a chest drain.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/eb1e9993a0a5409db57b15a7673224bcx1063x3817.JPEG"
    ]
  },
  {
    "text": "A female patient with a history of psychiatric illness presents to the outpatient. She admits to abusing diuretics for the past 2 weeks. On examination, blood pressure is 90/60 mm Hg. With respect to extracellular fluid volume (ECF), intracellular fluid volume (ICF), and plasma sodium, which of the following changes will this patient have?",
    "choices": [
      {
        "id": 1,
        "text": "Increased ECF, increased ICF, and decreased plasma sodium"
      },
      {
        "id": 2,
        "text": "Decreased ECF, decreased ICF, and increased plasma sodium"
      },
      {
        "id": 3,
        "text": "Decreased ECF, increased ICF, and decreased plasma sodium"
      },
      {
        "id": 4,
        "text": "Increased ECF, decreased ICF, and increased plasma sodium"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Diuretic overuse shows <strong>decreased ECF, increased ICF,</strong> and<strong> decreased plasma sodium</strong>, leading to&nbsp;<strong>hypoosmotic </strong>volume<strong> contraction</strong>.</p>\n<p>A similar picture is seen in <strong>adrenal insufficiency</strong>. Due to a deficiency of aldosterone, there is a decrease in both plasma volume and osmolality.</p>\n<p>Other Options:</p>\n<p>Option A: This is seen in cases of&nbsp;<strong>hypoosmotic </strong>volume<strong> expansion</strong>&nbsp;like in the <strong>syndrome of inappropriate secretion of antidiuretic hormone </strong>(SIADH) and<strong>&nbsp;</strong>bronchogenic tumors.&nbsp;</p>\n<p>SIADH is associated with <strong>euvolemic hyponatremia</strong>. This leads to a decrease in the osmolarity of the ECF. This causes a fluid shift from the ECF to the ICF until the osmolarity of both compartments becomes equal. The fluid influx also leads to a decrease in the ICF's osmolarity.&nbsp;Therefore, the net effect is an increase in extracellular volume, an increase in intracellular volume, and a fall in osmolarity in both compartments.</p>\n<p>Option B: This is seen in cases of <strong>hyperosmotic</strong> volume<strong> contraction</strong>&nbsp;like in <strong>diabetes insipidus </strong>and excessive <strong>sweating. </strong></p>\n<p>Option D: This is seen in cases of <strong>hyperosmotic</strong> volume <strong>expansion</strong>&nbsp;like in <strong>high NaCl intake</strong>. The addition of excess NaCl to ECF pulls the fluid from ICF into the ECF. This results in a decreased volume of ICF, increased volume of ECF, and increased osmolarity in both ECF and ICF.</p>\n<p>The illustration given below shows the Darrow-Yannet diagram in various conditions.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/16bb3190a1af49888158514d108b001ax1279x1689.JPEG"
    ]
  },
  {
    "text": "What is the correct statement regarding the wound indicated by the red arrow in the given image of the skull?",
    "choices": [
      {
        "id": 1,
        "text": "It is an entry wound because the outer table appears bevelled"
      },
      {
        "id": 2,
        "text": "It is an Exit wound because the inner table appears bevelled"
      },
      {
        "id": 3,
        "text": "It is an Exit wound because the outer table appears bevelled"
      },
      {
        "id": 4,
        "text": "It is an entry wound because the inner table appears bevelled"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In the given image, <strong>bevelling</strong> is seen on the <strong>outer table</strong> and a <strong>punched out hole</strong> is seen on the <strong>inner table.</strong> So, it is an <strong>exit wound.</strong></p>\n<p><strong>Entry wound:</strong> The initial contact of the missile punches a clean hole through the outer table of the skull. Where the bullet emerges internally, the inner table is then unsupported and a cone-shaped plug is detached, forming a crater that is appreciably larger than the external hole.</p>\n<ul>\n<li>Bevelling: inner table</li>\n<li>Punched out hole: outer table</li>\n</ul>\n<p><strong>Exit wound: </strong>If the bullet traverses the cranium and penetrates the opposite side, the same pattern occurs, this time with the small hole on the inner table and the crater on the outside.</p>\n<ul>\n<li>Bevelling: outer table</li>\n<li>Punched out hole: inner table</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ec545dd0a38f4211b2d66143cbf3a746.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5553ce71d34d4fc38d60ae876eb6fbebx1279x878.PNG"
    ]
  },
  {
    "text": "A diabetic patient presents with black, foul-smelling discharge from the nose. She also complains of blurry vision and headache. On examination, erythema, edema, and a few black, necrotic areas are seen. The diagnosis is made and treatment is started immediately, with the first line drug indicated. Which of the following adverse effects is not classically seen due to the drug used?",
    "choices": [
      {
        "id": 1,
        "text": "Hepatotoxicity"
      },
      {
        "id": 2,
        "text": "Hypokalemia"
      },
      {
        "id": 3,
        "text": "Nephrotoxicity"
      },
      {
        "id": 4,
        "text": "Normocytic anemia"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>This <strong>diabetic </strong>patient with nasal discharge, eye pain and necrotic areas most likely has <strong>mucormycosis. </strong>The drug of choice is <strong>amphotericin B. </strong>The adverse effects of amphotericin B include: An acute febrile reaction (fever, chills, rash), <strong>nephrotoxicity</strong>, normocytic anemia, and <strong>hypokalemia</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You have been allotted a patient with an upper limb fracture in the orthopedics ward. The patient fell on his elbow and complains of pain on elbow movement. On examining, the 3 bony point relationship is reversed. The examiner gives you xrays as shown below and asks you to pick up the one belonging to the patient.",
    "choices": [
      {
        "id": 1,
        "text": "D"
      },
      {
        "id": 2,
        "text": "C"
      },
      {
        "id": 3,
        "text": "B"
      },
      {
        "id": 4,
        "text": "A"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given patient with a fall on the elbow and reversed 3 bony point relationship is likely a case of <strong>Olecranon fracture</strong>. The x-ray D corresponds to the <strong>displaced transverse olecranon fracture.</strong></p>\n<p>The&nbsp;three bony points are<strong>&nbsp;</strong>the<strong>&nbsp;</strong>tip of the&nbsp;<strong>medial epicondyle</strong>,<strong>&nbsp;</strong>the<strong>&nbsp;</strong>tip of the&nbsp;<strong>lateral epicondyle</strong>&nbsp;and the <strong>olecranon</strong>. When the elbow is in 90 degrees of flexion, they form an&nbsp;isosceles triangle. When the elbow is extended, they lie transversely in a straight line.&nbsp;</p>\n<p>Since supracondylar fracture (X-ray: C) occurs above any of these bony landmarks, the 3 bony point relationship is preserved in this.</p>\n<p>Other options:</p>\n<p>A - Galeazzi fracture&nbsp;</p>\n<p>B -&nbsp;Monteggia fracture</p>\n<p>C- Supracondylar fracture</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ec6061f52cd0414f85acf11463f19c2b.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "The actions of the muscle attached to the area marked by the red arrow are:",
    "choices": [
      {
        "id": 1,
        "text": "1, 2, 3"
      },
      {
        "id": 2,
        "text": "1, 3. 5"
      },
      {
        "id": 3,
        "text": "1, 4, 5"
      },
      {
        "id": 4,
        "text": "2, 4, 5"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The marked area is&nbsp;<strong>pterygoid fovea</strong> where the <strong>lateral pterygoid</strong> muscle is inserted.&nbsp;The action of this muscle is&nbsp;<strong>depression, protrusion, and side to side movement of the jaw.</strong></p>\n<p>In addition, lateral pterygoid muscle is inserted into the articular disc and capsule of TMJ.</p>\n<p>The lateral pterygoid has the following actions:</p>\n<ol>\n<li><strong>Opening of the jaw (depression)</strong>:&nbsp;Lateral pterygoid has a <strong>specialized role in mandibular opening</strong>&nbsp;mediated by its <strong>horizontal fibres</strong>.&nbsp;When left and right lateral pterygoid muscles contract together, the mandibular condyle is pulled forwards and slightly downwards. This protrusive movement alone has little or no function except in assisting the <strong>opening the jaw&nbsp;</strong>(Gray's Anatomy 41st edition).</li>\n<li><strong>Side-to-side movement</strong>: When the lateral pterygoid contracts unilaterally along with the adjacent medial pterygoid the jaw is pulled medially. This is used for grinding food between teeth of the same side. This action is mediated by the <strong>inferior head of lateral pterygoid</strong>.</li>\n</ol>\n<p style=\"text-align: left;\">Masseter muscle:</p>\n<ul>\n<li>Origin - It arises from a thick aponeurosis from the maxillary process of zygomatic bone and zygomatic arch.</li>\n<li>Insertion - It inserted into the lateral surface of <strong>ramus of the mandible</strong> and coronoid process</li>\n</ul>\n<p><br /><br /></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/fb9d52d4dcfb4182a60a7105bceff5d6.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/63f42fcdb698427fb9b03ff890eee87ex1280x1288.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/04454f0f589e40d29b0e3bfcecdb74e7x1280x1287.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8943b90a4cf34e66b36f8eee2935f767x1279x1400.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a2af3a09e6444b538bb9047bc26d41dex960x720.JPEG"
    ]
  },
  {
    "text": "What is the correct sequence followed while doing rapid sequence induction?",
    "choices": [
      {
        "id": 1,
        "text": "Preoxygenation  -> IV succinylcholine -> Propofol IV -> Intubate"
      },
      {
        "id": 2,
        "text": "Preoxygenation -> Propofol IV -> Intubate  -> IV succinylcholine"
      },
      {
        "id": 3,
        "text": "Preoxygenation -> Propofol IV -> IV succinylcholine -> Intubate"
      },
      {
        "id": 4,
        "text": "IV succinylcholine -> Preoxygenation  -> Propofol IV -> Intubate"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The correct order of rapid sequence induction (RSI) is: <strong>Preoxygenation</strong> with 100% oxygen -&gt; Administer <strong>IV induction</strong> agent -&gt; IV <strong>succinylcholine</strong> -&gt; Do <strong>not</strong> ventilate -&gt; Direct laryngoscopy and <strong>intubation</strong> -&gt; Confirm endotracheal tube <strong>placement</strong> -&gt; Remove cricoid pressure.</p>\n<p>RSI is done when the patient is at increased risk of <strong>pulmonary aspiration</strong>&nbsp;as in pregnancy, full stomach, intestinal obstruction, hiatus hernia, encephalopathy, morbid obesity, and diabetic gastroparesis.</p>\n<p><strong>Bag and mask ventilation</strong> <strong>is avoided</strong> in rapid sequence intubation (RSI) because it leads to <strong>stomach inflation</strong> and increases risk of <strong>aspiration.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7f3e319aa6174d5d9044e026fef3eed6x1176x1512.PNG"
    ]
  }
];
        let quizName = 'Ini-Cet Mini - 8 (20 Q)';
        const quizFilename = 'ini-cet-mini-8-20-q-5854803a.html';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2020-21"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>