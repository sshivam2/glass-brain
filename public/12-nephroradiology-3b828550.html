<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>12 Nephroradiology - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Radiology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">28</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "The given IVP picture is seen in patients with which of the following?",
    "choices": [
      {
        "id": 1,
        "text": "Horseshoe kidney"
      },
      {
        "id": 2,
        "text": "Medullary sponge kidney"
      },
      {
        "id": 3,
        "text": "Duplicated collecting system"
      },
      {
        "id": 4,
        "text": "Retrocaval ureter"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Note: When both upper and lower poles are fused, it is termed a <strong>discoid kidney.\u00a0</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/966b4dae7abe4980a8d234a253d894ba.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a9f14d36038b41e38a119fa29e33230bx510x615.GIF",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/38b8c010681447c48cdee7649765dbd9x941x558.PNG"
    ]
  },
  {
    "text": "During intravenous pyelography of a patient, the left kidney could not be visualized. What condition is this suggestive of?",
    "choices": [
      {
        "id": 1,
        "text": "Duplicated collecting system"
      },
      {
        "id": 2,
        "text": "Polycystic kidney disease"
      },
      {
        "id": 3,
        "text": "Multicystic dysplastic kidney"
      },
      {
        "id": 4,
        "text": "Renal hypoplasia"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Other options:\u00a0</p>\n<p>Option A: In the duplicated collecting system, the <strong>drooping lily sign</strong> is seen. It refers to the inferolateral displacement of the opacified lower pole moiety due to an obstructed (and un-opacified) upper pole moiety.</p>\n<p>Option B:\u00a0In polycystic kidney disease,\u00a0a <strong>streaky appearance</strong> is seen due to\u00a0ectatic collecting ducts.</p>\n<p>Option D: In renal hypoplasia, there is\u00a0a congenitally <strong>small kidney </strong>with <strong>smaller calyces</strong>, lobules, and papillae but essentially <strong>normal residual parenchyma</strong>.\u00a0On imaging, a hypoplastic kidney is small but otherwise normal.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e0bdb99e1d574639b2049ec5889afdf5x360x308.PNG"
    ]
  },
  {
    "text": "During the evaluation of a patient with recurrent UTIs, the following urographic finding was observed. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Horseshoe kidney"
      },
      {
        "id": 2,
        "text": "Medullary sponge kidney"
      },
      {
        "id": 3,
        "text": "Duplicated collecting system"
      },
      {
        "id": 4,
        "text": "Retrocaval ureter"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given intravenous urogram shows the <strong>inferolateral displacement</strong> of the opacified lower pole due to an obstructed (and unopacified) upper pole, referred to as the <strong>drooping lily sign, </strong>observed in patients with a <strong>duplicated collecting system</strong><strong>.</strong>\u00a0</p>\n<p>The duplicated collecting system is a common<strong> congenital anomaly </strong>of the urinary tract characterized by an <strong>incomplete fusion</strong> of upper and lower pole moieties resulting in a variety of complete or incomplete <strong>duplications</strong> of the collecting system. It occurs due to the division of the <strong>ureter </strong>as it ascends upwards from the bladder to the renal parenchyma during the embryological period of life. As a result, the affected individual may have <strong>two collecting systems for one kidney</strong>.\u00a0</p>\n<p>Duplex collecting systems may also be <strong>complicated</strong> by vesicoureteric reflux, obstruction or ureterocoele. When the upper pole ureter is obstructed, the lower pole collecting system appears displaced and stretched on imaging, creating the \"<strong>drooping lily</strong>\" sign observed in intravenous urography.\u00a0</p>\n<p>The Weigert-Meyer law describes the relationship of the upper and lower renal moieties in duplicated collecting systems to their drainage. When there are abnormalities associated with duplicating collecting systems,</p>\n<ul>\n<li>The <strong>upper</strong> pole moiety drains <strong>inferomedially</strong> and is most commonly associated with<strong> obstruction</strong>.</li>\n<li>The <strong>lower</strong> pole moiety drains <strong>superolaterally</strong> and is most commonly associated with <strong>vesicoureteral reflux.</strong></li>\n</ul>\n<p>The illustration given below shows the Weigert-Meyer law.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/57899abad4674a0c9431e4431ca108e5.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/820feda9e5f94323acf2bd58ed8e50f1x1280x2007.JPEG"
    ]
  },
  {
    "text": "Which of the following is not an IVP finding in patients with renal papillary necrosis?",
    "choices": [
      {
        "id": 1,
        "text": "Lobster claw sign"
      },
      {
        "id": 2,
        "text": "Forniceal excavation"
      },
      {
        "id": 3,
        "text": "Signet ring"
      },
      {
        "id": 4,
        "text": "Ball and socket sign"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The image given below shows the following signs of renal papillary necrosis.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/02a0180259ff4791973b4e606fc2d286x1280x3761.JPEG"
    ]
  },
  {
    "text": "A diabetic patient presents with acute onset fever and dysuria. Urinalysis reveals plenty of leukocytes with glycosuria. A CT scan of the abdomen is performed, as shown below. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Acute pyelonephritis"
      },
      {
        "id": 2,
        "text": "Emphysematous pyelonephritis"
      },
      {
        "id": 3,
        "text": "Perinephric abscess"
      },
      {
        "id": 4,
        "text": "Renal abscess"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The clinical scenario, along with the CT scan showing an <strong>enlarged kidney</strong> with areas of <strong>necrosis</strong> and <strong>mottled areas</strong> of <strong>gas</strong> collection, is suggestive of<strong> left-sided</strong> <strong>emphysematous pyelonephritis.</strong></p>\n<p>Emphysematous pyelonephritis is a severe, <strong>acute, necrotizing infection</strong> of the kidney caused by gas-producing organisms. It predominantly affects <strong>diabetic</strong> patients who are particularly susceptible due to their hyperglycemic state, which promotes bacterial growth and fermentation. The most common causative organism is <strong><em>Escherichia coli</em></strong>, which ferments sugar to produce carbon dioxide, leading to <strong>gas accumulation</strong> within renal parenchyma or perinephric tissues. Less commonly, organisms like <em>Klebsiella </em>and<em> Proteus</em> species can also cause this condition.\u00a0\u00a0</p>\n<p>Almost all patients present with fever, vomiting and flank pain.\u00a0Patients frequently present with <strong>sepsis</strong> and ketoacidosis. If not treated early, it may lead to fulminant sepsis and is associated with <strong>high mortality</strong>.\u00a0</p>\n<p>The diagnosis is primarily established radiographically, with a<strong> CT scan</strong> being the investigation of choice in identifying the <strong>extent</strong> of the emphysematous process and guiding <strong>management</strong>. The following diagnostic features are seen:</p>\n<ul>\n<li>Enlarged, destructed renal parenchyma</li>\n<li>Small bubbly or linear streaks of gas</li>\n<li>Fluid collections, with gas-fluid levels</li>\n<li>Focal necrotic areas with or without abscess<br />\u00a0</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/43365b3cf5c0431dbc669971bbb29823.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "The CT nephrogram of a patient with loin pain is given below. All of the following can be included in the differential diagnoses except:",
    "choices": [
      {
        "id": 1,
        "text": "Acute pyelonephritis"
      },
      {
        "id": 2,
        "text": "Autosomal recessive polycystic kidney disease"
      },
      {
        "id": 3,
        "text": "Autosomal dominant polycystic kidney disease"
      },
      {
        "id": 4,
        "text": "Acute renal vein thrombosis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given image shows linear bands of contrast extending from the medulla of the kidney towards the cortex of the kidney, called a <strong>striated nephrogram</strong>\u00a0seen on plain film and CT nephrography. <strong>Autosomal dominant polycystic kidney disease </strong>(<strong>ADPKD</strong>) shows <strong>swiss cheese </strong>nephrogram, not striated nephrogram.</p>\n<p>Conditions which show striated nephrogram include:</p>\n<ul>\n<li><strong>Unilateral:</strong>\n<ul>\n<li>Acute ureteric obstruction</li>\n<li><strong>Acute</strong> <strong>pyelonephritis</strong></li>\n<li><strong>Acute</strong> <strong>renal vein thrombosis</strong></li>\n<li>Acutely following renal contusion</li>\n<li>Acute radiation therapy to the kidney</li>\n</ul>\n</li>\n<li><strong>Bilateral:</strong>\n<ul>\n<li>Autosomal recessive polycystic kidney disease (<strong>ARPKD</strong>)</li>\n<li>Acute pyelonephritis (if it is bilateral)</li>\n<li>Acute tubular obstruction</li>\n<li>Acute tubular necrosis</li>\n<li>Hypotension</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/7bca81d31de94dd09680e883ca885128.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A patient is undergoing a nephrogram. Two minutes after administering the contrast, both kidneys are visualized. After 10 minutes of contrast administration, only the left kidney is visualized. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Acute ureteric obstruction"
      },
      {
        "id": 2,
        "text": "Hydronephrosis"
      },
      {
        "id": 3,
        "text": "Acute complete arterial obstruction"
      },
      {
        "id": 4,
        "text": "Polycystic kidney disease"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>This clinical scenario describes visualization of the left kidney with contrast after 10 minutes, even though contrast has washed off from the right side. Retention of the IV contrast agent by the kidneys for &gt;3 minutes is called a <strong>dense persistent nephrogram</strong>. It can be caused by<strong> acute ureteric obstruction</strong>.</p>\n<p><strong>Hydronephrosis</strong> (chronic obstruction) and acute complete arterial obstruction shows a<strong> rim nephrogram.</strong></p>\n<p>The following image shows a bilateral dense persistent nephrogram:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c5feb702952c407f88cd43e87ec5fc49x1280x906.JPEG"
    ]
  },
  {
    "text": "What is the earliest radiographic finding in patients with genitourinary tuberculosis?",
    "choices": [
      {
        "id": 1,
        "text": "Moth eaten calyces"
      },
      {
        "id": 2,
        "text": "Golf ball on tee sign"
      },
      {
        "id": 3,
        "text": "Lobster claw sign"
      },
      {
        "id": 4,
        "text": "Ring sign"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given image shows the signs of renal papillary necrosis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a409650834aa42509a87819686d56383x1280x1703.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/26e4c9105d1b457091cb1791d1ba685ex418x293.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3b0f8bf4eb0a4ac6bdf57a8755aa0cdcx1280x3761.JPEG"
    ]
  },
  {
    "text": "A 59-year-old man was referred for abdominal pain and sterile pyuria. He was diagnosed with tuberculosis 10 years ago but was non-adherent to treatment. What is the most sensitive imaging modality for his current presentation?",
    "choices": [
      {
        "id": 1,
        "text": "CT intravenous pyelogram"
      },
      {
        "id": 2,
        "text": "Bladder ultrasound"
      },
      {
        "id": 3,
        "text": "Non contrast CT"
      },
      {
        "id": 4,
        "text": "MRI"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Sterile pyuria in a patient with history of tuberculosis raises suspicion of <strong>renal tuberculosis.</strong>\u00a0The <strong>most sensitive</strong> imaging modality for diagnosing renal tuberculosis is<strong> CT Intravenous Pyelogram.</strong></p>\n<p>Renal tuberculosis occurs due to hematogenous dissemination of <em>Mycobacterium tuberculosis</em>, making it a<strong> secondary</strong> infection. There is either reinfection or reactivation of old TB. It is more common in males and typically presents with symptoms such as increased urinary frequency, polyuria, dysuria, hematuria, loin pain/suprapubic pain and sterile pyuria.\u00a0</p>\n<p>In sterile pyuria, urine appears pale and opalescent due to the presence of pus cells. Renal TB is a cause of sterile pyuria. Diagnosis is confirmed with a <strong>tuberculin test</strong>, or at least 3 consecutive <strong>early-morning urine specimens</strong> are examined for acid-fast bacilli. They are stained with a <strong>Ziehl\u2013Neelsen</strong> stain and subsequently cultured.</p>\n<p>The most sensitive imaging modality in renal tuberculosis is<strong> CT urography/pyelography</strong>. <strong>NCCT</strong> is the preferred means of visualizing <strong>renal calcifications</strong>. Manifestations of renal TB as seen on CT are as follows:</p>\n<ul>\n<li><strong>Early</strong> changes:\n<ul>\n<li>Papillary necrosis (single or multiple) and uneven caliectasis</li>\n</ul>\n</li>\n<li><strong>Progressive</strong> changes:\n<ul>\n<li>Multifocal strictures in any part of the collecting system</li>\n<li>Generalized or focal hydronephrosis</li>\n<li>Mural thickening and enhancement</li>\n<li>Poorly enhancing renal parenchyma, either due to direct involvement or due to hydronephrosis</li>\n</ul>\n</li>\n<li><strong>End-stage</strong>:\n<ul>\n<li>Progressive hydronephrosis results in very thin parenchyma, mimicking multiple thin-walled cysts</li>\n<li>Amorphous dystrophic calcification eventually involves the entire kidney (known as the putty kidney), as shown below:</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/13f1eb75debd4695b8255ef673fedd82x720x737.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f984103f7cce4bbc95cdb44deb240957x1280x1703.JPEG"
    ]
  },
  {
    "text": "A 29-year-old man presented with bilateral vague loin discomfort. Plain X-ray KUB was done. All of the following can cause this finding except:",
    "choices": [
      {
        "id": 1,
        "text": "Distal renal tubular acidosis"
      },
      {
        "id": 2,
        "text": "Medullary sponge kidney"
      },
      {
        "id": 3,
        "text": "Sarcoidosis"
      },
      {
        "id": 4,
        "text": "Alport\u2019s syndrome"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given X-ray shows coarse amorphous calcifications of both kidneys suggestive of medullary nephrocalcinosis.\u00a0<strong>Alport's syndrome</strong> causes <strong>cortical nephrocalcinosis.</strong></p>\n<p>Nephrocalcinosis refers to the presence of <strong>calcification</strong> in the renal parenchyma, with most cases affecting the <strong>medulla</strong> and the remaining occurring in the cortex. Stippled patterns of calcification are observed on X-rays in the cortical and medullary regions of both the kidneys due to cortical and medullary nephrocalcinosis, respectively.</p>\n<p>Causes of <strong>medullary nephrocalcinosis</strong> include:</p>\n<ul>\n<li><strong>Distal renal tubular acidosis</strong></li>\n<li><strong>Medullary sponge</strong> <strong>kidney</strong></li>\n<li>Hypercalcemia - including <strong>sarcoidosis</strong>\u00a0</li>\n<li>Hyperparathyroidism</li>\n<li>Hyperoxaluria</li>\n</ul>\n<div class=\"ng-scope\">\n<div class=\"ng-scope\">\n<p class=\"ng-binding\">\u00a0Causes of\u00a0<strong>cortical nephrocalcinosis</strong>\u00a0include:</p>\n<ul>\n<li>Hemolytic uremic syndrome (HUS)</li>\n<li>Graft rejection</li>\n<li>Acute cortical necrosis</li>\n<li>Chronic glomerulonephritis</li>\n<li>Alport syndrome</li>\n</ul>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/fc5cd6872b484e4b835cb0a6abd922ff.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "The renal angiographic picture of a patient is given below. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Fibromuscular dysplasia"
      },
      {
        "id": 2,
        "text": "Renal artery thrombosis"
      },
      {
        "id": 3,
        "text": "Hypertensive nephrosclerosis"
      },
      {
        "id": 4,
        "text": "Renal artery aneurysm"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given renal angiographic image depicts the '<strong>string of beads' </strong>sign, characterized by alternating areas of stenoses and small aneurysms in the renal arteries. This appearance is typical of <strong>fibromuscular dysplasia,</strong>\u00a0a renovascular cause of secondary hypertension.</p>\n<p>Fibromuscular dysplasia is a <strong>segmental</strong>, non-atheromatous, dysplastic type of <strong>angiopathy</strong> characterized by <strong>focal irregular thickening</strong> in medium and large muscular arteries predominantly affecting <strong>females</strong>. The most common subtype is <strong>medial fibroplasia</strong>. The most common sites of involvement in decreasing order of frequency are as follows:<strong> Renal arteries</strong> &gt; carotid arteries &gt; peripheral (limb) arteries - most commonly iliac arteries.</p>\n<p>The typical presentation is in the young person, commonly females with new-onset hypertension.\u00a0</p>\n<p>Medial fibroplasia is typically seen as a 'string of beads<strong>'</strong> appearance on <strong>CT angiography</strong>.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b90ad58c363940d88b92e277eda82cec.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "The following appearance after injecting contrast is a feature of which of the following conditions?",
    "choices": [
      {
        "id": 1,
        "text": "Tuberculosis"
      },
      {
        "id": 2,
        "text": "Schistosomiasis"
      },
      {
        "id": 3,
        "text": "Neurogenic bladder"
      },
      {
        "id": 4,
        "text": "Bladder granuloma"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given X-ray KUB image shows a markedly <strong>contracted</strong> <strong>bladder</strong> wall with reduced capacity called a\u00a0<strong>thimble bladder. </strong>It is a late complication of <strong>genitourinary</strong> <strong>tuberculosis</strong>.</p>\n<p>Tuberculous cystitis results in <strong>fibrosis</strong> and <strong>stiffening</strong> of the entire urinary bladder, leading to an inability to expand and a significant reduction in bladder capacity, as depicted in the figure. The medical term for this feature on the <strong>intravenous urogram</strong> is a thimble bladder.\u00a0</p>\n<p>Genitourinary TB is caused by the <strong>dissemination</strong> of the organism through the <strong>bloodstream </strong>and is thus always a secondary TB. There is either reinfection or reactivation of old TB. It can affect the kidneys, ureters, urinary bladder, prostate, seminal vesicles, epididymis, and vas deferens.</p>\n<p>Lesions caused by tuberculosis in the kidney include:</p>\n<ul>\n<li><strong>Papillary ulcer</strong> - earliest lesion</li>\n<li><strong>Pyonephrosis</strong> - caused by multiple scattered papillary ulcers undergoing caseous necrosis, which later become filled with pus</li>\n<li><strong>Perinephric abscess</strong> - \u00a0by extension of pyonephrosis or tuberculous renal abscess</li>\n<li><strong>Pseudocalculi</strong> - occurs when calcium gets deposited in a papillary ulcer healed with fibrosis</li>\n<li><strong>Ghost calyces</strong> - caused by the destruction of the calyces</li>\n<li><strong>Putty/cement kidney</strong> - amorphous dystrophic calcification eventually involves the entire kidney (seen in X-ray and CT)</li>\n</ul>\n<p>Ureteric lesions seen in genitourinary tuberculosis include <strong>Kerr\u2019s kink</strong> (kinking of the ureteropelvic junction), stricture, beaded ureter, and shortening of the ureter. Other features of bladder TB include:</p>\n<ul>\n<li><strong>Golf hole ureteric orifice</strong> - This is due to fibrosis causing the rigid withdrawn dilated ureteric orifice to look like a golf hole (cystoscopic finding).\u00a0</li>\n<li>Stippled calcifications</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3d67397f3f124b558b95176b221ea422.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/188bd5f5c4ed4fcf9a1e0ada4f5b119ex1280x1703.JPEG"
    ]
  },
  {
    "text": "A 45-year-old man with lower urinary tract symptoms underwent a CT-KUB as shown below, but was lost to follow-up. Two months later,  he returned with worsening symptoms, and repeat imaging revealed a densely calcified bladder resembling a fetal skull. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Tuberculosis"
      },
      {
        "id": 2,
        "text": "Schistosomiasis"
      },
      {
        "id": 3,
        "text": "Neurogenic bladder"
      },
      {
        "id": 4,
        "text": "Bladder carcinoma"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Option D: Cystourethroscopy is the mainstay for diagnosis of<strong> bladder carcinoma</strong>. It is performed on patients with hematuria. The most common radiological sign is a <strong>filling defect</strong> seen in intravenous urography (IVU). Non-contrast CT and MRI and ultrasonography are used for the immediate management of patients with gross painless haematuria.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/0b09b841f0a94753a17c4b4bce5c0567.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0877db49d8ab41838773db482f0d2ab6x720x503.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1f355b1859dc4f28ab319262d7951b9cx720x720.JPEG"
    ]
  },
  {
    "text": "The cystographic evaluation of a woman with recurrent urinary tract infection is given below. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Thimble bladder"
      },
      {
        "id": 2,
        "text": "Neurogenic bladder"
      },
      {
        "id": 3,
        "text": "Bladder carcinoma"
      },
      {
        "id": 4,
        "text": "Schistosomiasis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Option C: In <strong>bladder carcinoma</strong>, lesions are seen on the wall of the bladder and a biopsy is taken to confirm the diagnosis. These lesions cause disruption in the mucosa and the musculature of the bladder. Cystourethroscopy is the mainstay for the diagnosis of bladder carcinoma. It is performed on patients with hematuria. The most common radiological sign is a<strong> filling defect</strong> seen in intravenous urography (IVU).\u00a0</p>\n<p>Option D: Schistosomiasis of the bladder is a parasitic infection by <em>Schistosoma hematobium. </em>The radiographic features in the acute phase is nodular bladder wall thickening, and in the chronic phase, it is the <strong>contracted fibrotic</strong>, thick-walled bladder and <strong>curvilinear calcifications </strong>due to large numbers of calcified eggs in the bladder wall.\u00a0On <strong>cystoscopy,</strong> it can look like nodules, pseudotubercles, ulceration, and sandy patches, and in the end stage, it can cause squamous cell carcinoma of the bladder.</p>\n<p>The CT-KUB image below shows circumferential calcification of the bladder wall.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/64df5a840bea4971b64259812d65d8ca.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/35858ff4077946f6a25ee5ef4e6fcfa9x720x503.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/04603ce0c1df46bf941ca0d7610501f2x720x463.PNG"
    ]
  },
  {
    "text": "In a patient with the following cystogram finding, which of the following would you not suspect?",
    "choices": [
      {
        "id": 1,
        "text": "Neurogenic bladder"
      },
      {
        "id": 2,
        "text": "Pelvic abscess"
      },
      {
        "id": 3,
        "text": "Pelvic lipomatosis"
      },
      {
        "id": 4,
        "text": "Pelvic hematoma"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given image shows a <strong>pear-shaped</strong><strong>\u00a0</strong>bladder, where the normal round or ovoid shape has been <strong>extrinsically compressed</strong> to resemble a pear. The pear may be inverted (also called <strong>tear-drop</strong>\u00a0bladder) or upright, depending on how the excess pelvic tissue compresses the bladder.\u00a0</p>\n<p>The<strong> </strong>causes of the pear-shaped bladder include <strong>pelvic abscess, p</strong><strong>elvic lipomatosis, p</strong><strong>elvic hematoma, </strong>and symmetrical pelvic lymphadenopathy.\u00a0</p>\n<p><strong>Neurogenic bladder</strong> results in a <strong>C</strong><strong>hristmas tree</strong>\u00a0or\u00a0<strong>pine cone</strong> appearance, where the urinary bladder becomes elongated with a pointed shape and a thickened trabeculated wall, as depicted below:\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/4e28c8f943794b89b00afef69101fbb9.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9bb0cbd14c434e5e87dbeee4081c8ff9x720x720.JPEG"
    ]
  },
  {
    "text": "A child with recurrent UTIs is suspected to have a congenital renal anomaly. The following picture is seen on IV urography. Based on these findings, which of the following would you suspect?",
    "choices": [
      {
        "id": 1,
        "text": "Retrocaval ureter"
      },
      {
        "id": 2,
        "text": "Vesicoureteric reflux"
      },
      {
        "id": 3,
        "text": "Medullary sponge kidney"
      },
      {
        "id": 4,
        "text": "Multicystic dysplastic kidney"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Note:<strong> Bilateral fishhook </strong>or<strong> J-shaped</strong> or hockey stick ureters describe the course of the distal ureter in patients with significant <strong>benign prostatic hypertrophy </strong>(BPH).</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/aee0cb7a65f646589bed0ec568a9db22.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/bd0e6c824db04bb085413435a3abecebx720x821.PNG"
    ]
  },
  {
    "text": "A 2-year-old girl was referred for evaluation of recurrent urinary tract infections. She suffered 4 episodes over the past 9 months and had been hospitalized twice. An ultrasound revealed bilateral hydronephrosis with dilatation of ureters. What is the investigation of choice in this child?",
    "choices": [
      {
        "id": 1,
        "text": "VCUG"
      },
      {
        "id": 2,
        "text": "Tc DTPA scan"
      },
      {
        "id": 3,
        "text": "MAG3 scan"
      },
      {
        "id": 4,
        "text": "Tc DMSA scan"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Other options:</p>\n<p>Option B: A <strong>99mTc-DTPA</strong> scan is used to measure GFR as it is cleared by glomerular filtration and no tubular reabsorption, determine differential renal function and evaluate for the presence of degree of renal function.\u00a0</p>\n<p>Option C: The investigation of choice for <strong>ureteropelvic junction obstruction</strong> is a 99mTc-Mercaptoacetyl-triglycine (MAG3) scan. <strong>99mTc-MAG3</strong> is the most commonly used isotope in dynamic renography. Its uptake reflects the tubular function.</p>\n<p>Option D: The <strong>99mTc-DMSA</strong> scan is used for the assessment of the renal cortex as it binds to the sulfhydryl groups in proximal tubules with longer retention than other agents. It allows for a better assessment of differential renal function.\u00a0It is used for the evaluation of the renal structure and morphology, detection of <strong>renal</strong> <strong>scarring</strong> in reflux nephropathy and pyelonephritis and evaluation of renal anatomical abnormalities.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/aa91b46283604eaebcbd13c467f68ce6x1064x2464.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0a34ce33aade47579ac6c06ff757c093x1080x1400.JPEG"
    ]
  },
  {
    "text": "The following spot film was taken while performing a voiding cystourethrogram for a 2-year-old girl. Which of the following investigations will be useful for the evaluation of renal scarring in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Tc 99m DMSA"
      },
      {
        "id": 2,
        "text": "Tc 99m DTPA"
      },
      {
        "id": 3,
        "text": "Tc 99m MAG3"
      },
      {
        "id": 4,
        "text": "Tc 99m pertechnetate"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given voiding cystourethrogram (VCUG) shows a <strong>unilateral grade 4 vesicoureteric reflux</strong> (VUR). The investigation of choice to evaluate for renal scarring in reflux nephropathy is the\u00a0<strong>Tc-99m DMSA </strong>(dimercaptosuccinic acid)\u00a0scan.</p>\n<p>It\u00a0is used in renal imaging to evaluate renal <strong>structure</strong> and <strong>morphology</strong>, particularly in paediatric imaging for the detection of scarring and pyelonephritis.\u00a0DMSA is an ideal agent for the assessment of the <strong>renal cortex</strong> as it binds within the\u00a0<strong>proximal tubules</strong> of the cortex with longer retention than other agents.</p>\n<p>It allows a better assessment of differential renal function. It is a <strong>static scan</strong> as opposed to dynamic DTPA or MAG3 scans. Other common renal scans include:</p>\n<ul>\n<li>Tc-99m <strong>DTPA</strong> (diethylene-triamine-pentaacetate) - used for direct measurement of GFR as it is cleared only via glomeruli with no tubular excretion (option B).\u00a0</li>\n<li>Tc-99m <strong>MAG3</strong> (mercaptoacetyltriglycine) - excreted through the renal route via both glomeruli infiltration and tubular excretion. Hence, in pediatric patients and patients with poor renal function, this test is considered superior to a DTPA scan. (option C).</li>\n<li>In renovascular hypertension, captopril DTPA is used for screening\u00a0and the gold standard investigation is renal angiography.</li>\n</ul>\n<p>The following image shows a DMSA scan of a patient with renal failure with reduced uptake in both kidneys.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a39d142abbe34be7a03a11e12553aa1c.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f9b81bbebb40419ea8dcf2f511174d68x600x577.JPEG"
    ]
  },
  {
    "text": "A neonate is being evaluated for urinary abnormalities. Ultrasonography reveals the following finding. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Vesicoureteric reflux"
      },
      {
        "id": 2,
        "text": "Posterior urethral valve"
      },
      {
        "id": 3,
        "text": "Ureterocele"
      },
      {
        "id": 4,
        "text": "Retrocaval ureter"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given image shows a dilated proximal urethra\u00a0and associated thick-walled distended bladder on ultrasound that resembles a keyhole. This\u00a0<strong>keyhole sign</strong> is seen in the presence of\u00a0<strong>posterior urethral valves.</strong>\u00a0</p>\n<p>Posterior urethral valves are the\u00a0<strong>most common</strong>\u00a0cause\u00a0of\u00a0<strong>severe obstructive uropathy</strong>\u00a0in children.\u00a0The valves are\u00a0<strong>membranes</strong>\u00a0that have a small posterior slit within them, which typically lie just\u00a0<strong>distal to</strong>\u00a0the<strong>\u00a0verumontanum.\u00a0</strong>They function as flap valves and are obstructive to antegrade urinary flow.\u00a0</p>\n<p>Diagnosis is most commonly made <strong>antenatally</strong> with <strong>ultrasound</strong>, which demonstrates <strong>bilateral hydronephrosis</strong> above a distended bladder in the fetus, along with<strong> oligohydramnios</strong> and <strong>pulmonary hypoplasia</strong>. If the diagnosis is not made antenatally, then babies typically present with <strong>urinary infections</strong> in the neonatal period or with uremia and renal failure. Clinically, a <strong>poor urinary stream</strong>, <strong>dribbling</strong>, and palpable bladder (due to diverticula) can be present.</p>\n<p>The diagnosis is<strong> best </strong>made during the<strong> micturition phase of VCUG</strong> in lateral or oblique views so that the posterior urethra can be imaged adequately.\u00a0The following findings are seen:</p>\n<ul>\n<li><strong>Dilatation</strong> and <strong>elongation</strong> of the posterior urethra - the equivalent of the ultrasonographic keyhole sign (as shown in the image below).</li>\n<li>Linear <strong>radiolucent band</strong> corresponding to the valve - seen occasionally.</li>\n<li><strong>Vesicoureteral reflux </strong>(VUR) - seen in 50% of patients.</li>\n<li>Bladder trabeculation/ diverticula.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/dc4d9b2b67fb45afafa025aed76c7f48.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6dd68290a43f40d6912bfb67bb60a003x1280x1369.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1f2af3e95a1d45518fd0622e88aec221x1279x1581.JPEG"
    ]
  },
  {
    "text": "What is the investigation of choice for evaluating posterior urethral valves in a newborn male?",
    "choices": [
      {
        "id": 1,
        "text": "MCU"
      },
      {
        "id": 2,
        "text": "Tc-DTPA scan"
      },
      {
        "id": 3,
        "text": "USG"
      },
      {
        "id": 4,
        "text": "DMSA scan"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Voiding cystourethrogram (<strong>VCUG</strong>)\u00a0or micturating cystourethrogram (<strong>MCU</strong>) is the best imaging technique for diagnosing <strong>posterior urethral valves</strong>.</p>\n<p>Posterior urethral valves result from forming a thick, <strong>valve-like membrane</strong> from a tissue of <strong>Wolffian</strong> <strong>duct</strong> <strong>origin</strong> (failure of regression of the mesonephric duct). This membrane courses obliquely from the verumontanum to the most distal portion of the prostatic urethra. They act as flap valves and are obstructive to antegrade urinary flow.</p>\n<p>Diagnosis is most commonly made <strong>antenatally</strong> with <strong>ultrasound. </strong>However, the diagnosis is<strong> best</strong> made during the <strong>micturition phase </strong>of VCUG\u00a0in lateral or oblique views so that the posterior urethra can be imaged adequately. The following findings are seen:</p>\n<ul>\n<li><strong>Dilatation </strong>and<strong> elongation</strong> of the posterior urethra - the equivalent of the ultrasonographic <strong>keyhole sign </strong>(as shown in the image below).\u00a0</li>\n<li>Linear <strong>radiolucent band</strong> corresponding to the valve - seen occasionally.\u00a0</li>\n<li>Vesicoureteral reflux (<strong>VUR</strong>) - seen in 50% of patients.\u00a0</li>\n<li>Bladder trabeculation/ diverticula.</li>\n</ul>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/cacd0ef628724be2829b3233605b6b03x1280x1581.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0457ce1418fd4b509506a4de5f4b037ax1280x1369.JPEG"
    ]
  },
  {
    "text": "A 48-year-old woman underwent retrograde ureterography as part of an evaluation for intermittent loin pain and dysuria. The following finding is seen. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Ureteric calculi"
      },
      {
        "id": 2,
        "text": "Tuberculosis of ureter"
      },
      {
        "id": 3,
        "text": "Transitional cell cancer of ureter"
      },
      {
        "id": 4,
        "text": "Hydroureter"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>This sign indicates the pathology is\u00a0<strong>chronic</strong>, permitting the lesion to be accommodated in the ureter. Other causes of goblet sign include <strong>metastatic</strong> disease in the ureter and <strong>endometriosis</strong> involving the ureter.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b3a27b3911d645c292d98287e1af349a.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4b6929a4dcf7439ba70ed4e8c1c6aab9x510x565.GIF"
    ]
  },
  {
    "text": "A 45-year-old woman comes to the emergency department with severe back pain, vomiting, and hypotension. CT findings are given below. What is the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Renal cyst"
      },
      {
        "id": 2,
        "text": "Renal cell carcinoma"
      },
      {
        "id": 3,
        "text": "Para pelvic cyst"
      },
      {
        "id": 4,
        "text": "Renal angiomyolipoma"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Renal cell carcinoma </strong>(RCC) is the most common <strong>malignant </strong>tumour of the kidney. It usually occurs in the age group <strong>50-70 years</strong> and macroscopic <strong>hematuria</strong> is seen in about 60% of the cases. It is a differential for angiomyolipoma but it is important to note that <strong>macroscopic fat</strong> is almost always associated with <strong>ossification or calcification.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ed3e6603e2f646a4ab1540a6e060de44.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/81df761cf104457cad0bb3af88a72afbx720x625.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/34edf0a8b03147068dd08b4837d9881ax251x226.JPEG"
    ]
  },
  {
    "text": "The contrast-enhanced CT abdomen of a 50-year-old woman shows the following finding. Which of the following classifications would you use to assess the severity of this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Jackson staging"
      },
      {
        "id": 2,
        "text": "Bosniak classification"
      },
      {
        "id": 3,
        "text": "Durie-Salmon staging"
      },
      {
        "id": 4,
        "text": "Todani classification"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Other options:</p>\n<p>Option A: Jackson staging is used in <strong>carcinoma penis.</strong></p>\n<p>Option C: Durie-Salmon staging is used for <strong>multiple myeloma.</strong></p>\n<p>Option D: Todani classification is used in cases of <strong>choledochal cysts.\u00a0</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3f96aaa956a6439f92ec3a7986c3c4e9.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/89ed11aeaf8f4038a2534cac0454053bx1280x2560.JPEG"
    ]
  },
  {
    "text": "A 17-year-old boy is brought to the ER with left-sided scrotal pain and nausea. It developed suddenly 30 minutes ago while playing football. On examination, the left scrotum is reddish with mild tenderness, and the testis is in horizontal lie. What is the investigation of choice?",
    "choices": [
      {
        "id": 1,
        "text": "Non contrast CT"
      },
      {
        "id": 2,
        "text": "Doppler"
      },
      {
        "id": 3,
        "text": "MRI"
      },
      {
        "id": 4,
        "text": "CECT"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>This clinical scenario of sudden scrotal pain while playing is suspicious for<strong> testicular torsion</strong>. The investigation of choice is <strong>doppler ultrasonography</strong>. It indicates reduced or absent blood flow to the testes.\u00a0</p>\n<p>In testicular torsion, the blood supply to the testicle is compromised due to the <strong>twisting </strong>of the <strong>spermatic cord </strong>within the tunica vaginalis due to a '<strong>bell clapper deformity</strong>', resulting in <strong>ischemia </strong>of the epididymis and the testis. It is typically seen in <strong>adolescence </strong>and usually presents with <strong>sudden onset pain </strong>and swelling of the scrotum, associated with <strong>vomiting. </strong>A high-riding, <strong>swollen</strong>, and <strong>tender testis</strong> with a tender twisted cord can often be palpated above it, along with an<strong> erythematous</strong> scrotum and <strong>absent cremastric reflex</strong> on the affected side.\u00a0</p>\n<p>A Doppler ultrasound may be taken to assess the blood supply but surgical exploration is still indicated as a clinical decision.\u00a0<strong> Doppler ultrasound </strong>scanning<strong> </strong>shows <strong>absent</strong> or <strong>decreased </strong>intratesticular arterial blood flow compared to the contralateral testis. Doppler studies have improved the ultrasonographic evaluation of testicular torsion with the presence of <strong>whirlpool sign</strong> within the spermatic cord, which represents the twisted cord and is analogous to the twisted ovarian pedicle seen in ovarian torsion.\u00a0\u00a0</p>\n<p><strong>Urgent scrotal exploration</strong> is indicated if there is doubt regarding the diagnosis. A transverse scrotal incision is taken and if the testis is viable twisting again is prevented by fixation with three non-absorbable sutures between the tunica albuginea of the testis and the scrotal raphe.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 62-year-old man is being evaluated for new-onset bilateral pedal edema. He had been diagnosed with left-sided renal cell carcinoma 2 months ago but had declined surgery. What is the investigation of choice to evaluate his current complaints?",
    "choices": [
      {
        "id": 1,
        "text": "Intravenous Urography"
      },
      {
        "id": 2,
        "text": "Magnetic Resonance Imaging"
      },
      {
        "id": 3,
        "text": "Contrast-enhanced CT"
      },
      {
        "id": 4,
        "text": "Positron Emission Tomography"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Option A: <strong>Intravenous urography</strong> is no longer suitable for detecting renal masses, particularly if they occur centrally; cross-sectional imaging studies are more appropriate for investigating suspected renal mass.\u00a0</p>\n<p>Option D: <strong>FDG-Positron Emission Tomography</strong>\u00a0plays a limited role in the initial detection and diagnosis of RCC due to low fluorodeoxyglucose uptake by these tumours. However, it can be useful in identifying local recurrence and serves as a complementary tool alongside other cross-sectional imaging methods.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/cecd80049f06400bac6032dfda4b7f58x607x630.JPEG"
    ]
  },
  {
    "text": "A 34-year-old man comes to the emergency department with complaints of severe, right-sided, colicky flank pain that radiates to his groin. He has a history of recurrent kidney stones. What is the investigation of choice?",
    "choices": [
      {
        "id": 1,
        "text": "USG"
      },
      {
        "id": 2,
        "text": "Non contrast CT"
      },
      {
        "id": 3,
        "text": "Contrast enhanced CT"
      },
      {
        "id": 4,
        "text": "Plain X-ray KUB"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>This clinical scenario is suggestive of <strong>renal calculi</strong>. The investigation of choice is<strong>\u00a0non-contrast CT </strong>(NCCT).\u00a0NCCT is useful as it has a <strong>greater sensitivity</strong> to tissue attenuation and, hence, can pick up stones that may appear radiolucent on plain X-rays.</p>\n<p>Renal calculi are more common in males, with <strong>90%</strong> of stones being <strong>radiopaque</strong>. Clinically, patients present with severe pain located over the renal angle, often radiating to the groin. The pain may be accompanied by vomiting due to pyloric spasm, as well as hematuria, nausea, fever, and in some cases, symptoms of pyuria.\u00a0</p>\n<p>A <strong>non-contrast CT scan</strong> is the imaging modality of choice for suspected urinary tract calculi. It is the <strong>most sensitive</strong> and gold-standard test for detecting stones as it is quick, detects most types of calculi, and can be performed with low radiation doses. A history of nephrolithiasis with new-onset flank pain should prompt immediate evaluation with non-contrast CT.\u00a0The radiographic features depend on the <strong>stone composition</strong>.</p>\n<p>The following types of renal calculi may appear <strong>radiolucent</strong> on <strong>plain X-ray: </strong><strong>Uric acid,\u00a0</strong>Indinavir and pure matrix stones (may have radiodense rim or centre). On CT, most stones are usually opaque.\u00a0However, <strong>indinavir</strong> and<strong> pure matrix</strong> stones appear <strong>radiolucent</strong> even on <strong>CT</strong>.</p>\n<p>The following X-ray KUB image shows a staghorn calculus (struvite).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/76df072dd610493999f7310692e077aax491x600.JPEG"
    ]
  },
  {
    "text": "The IVP of a patient with persistent flank pain is given below. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Retrocaval ureter"
      },
      {
        "id": 2,
        "text": "Retroperitoneal fibrosis"
      },
      {
        "id": 3,
        "text": "Medullary sponge kidney"
      },
      {
        "id": 4,
        "text": "Multicystic dysplastic kidney"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given IVP in a patient with persistent flank pain shows the <strong>medial</strong>\u00a0<strong>deviation </strong>of <strong>bilateral ureters,</strong> caused by fibrous tissue deposition in the retroperitoneum at the <strong>lumbosacral</strong> junction, resulting in the characteristic narrow-waisted maiden appearance, known as the <strong>maiden waist sign, </strong>which is seen in <strong>retroperitoneal fibrosis</strong>.</p>\n<p>Retroperitoneal fibrosis (RPF) is a chronic, <strong>nonspecific inflammatory process</strong> of the fibro-fatty tissue in the retroperitoneum, with the <strong>idiopathic</strong> type being the most common, accounting for about 70% of the cases. Patients typically present with persistent <strong>flank pain</strong> or back pain. <strong>Progressive fibrotic thickening</strong> can compress the ureters, leading to bilateral hydronephrosis and, if untreated, renal failure. Aside from idiopathic causes, other causes of RPF include <strong>drug-induced factors </strong>( e.g., methysergide, beta-blockers), advanced malignancy, radiation exposure, trauma, and chronic infections.</p>\n<p>Diagnosis of RPF relies primarily on imaging studies. Intravenous urography shows a characteristic triad of medial deviation of the middle one-third of the ureters, producing a <strong>maiden waist sign</strong>, <strong>hydroureteronephrosis</strong>, and <strong>extrinsic compression</strong> of the ureters by the fibrotic process. CT and MRI are also useful in radiographic evaluation of RPF.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/59ab26f155274e6087092af03bc49ee0.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "The following appearance in IVP is caused by:",
    "choices": [
      {
        "id": 1,
        "text": "Horse shoe kidney"
      },
      {
        "id": 2,
        "text": "Ureterocoele"
      },
      {
        "id": 3,
        "text": "Bladder tumour"
      },
      {
        "id": 4,
        "text": "Posterior urethral valve"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given intravenous pyelography (IVP)\u00a0depicts the <strong>cobra head</strong>\u00a0or<strong>\u00a0adder head </strong>deformity or <strong>spring onion</strong> sign seen in <strong>bilateral</strong> <strong>ureterocele. </strong>These signs refer to a <strong>dilated, contrast-filled distal ureter</strong> surrounded by a thin rim of the ureteric wall and bladder mucosa.</p>\n<p>Ureterocoele is a <strong>cystic enlargement </strong>of the intramural portion of the ureter, more commonly seen in <strong>females</strong>\u00a0than males. It is thought to be caused due to ureteric orifice atresia. They are similar to ectopic ureters, which typically drain the upper pole of the kidney and are associated with dysplastic or non-functional renal tissue.</p>\n<p>If they present clinically, ureteroceles often manifest with <strong>urinary tract infections</strong> (UTIs) in <strong>children</strong>, while in <strong>adults,</strong> they are more likely to present with <strong>stones</strong> in the lower ureter. Ureterocoeles can enlarge and obstruct the bladder neck or the contralateral ureteric orifice.</p>\n<p>The classic sign of a ureterocele on intravenous urography is a \u2018cobra head\u2019, \u2018adder head\u2019, or 'spring onion sign'.\u00a0 On ultrasonography, it can be seen as a <strong>fluid-filled cystic mass</strong> in the bladder.</p>\n<p>The treatment of simple ureteroceles is <strong>surgical excision with re-implantation</strong> of the ureter.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/189f5e0e91284aaaa2e6e6c3f0f565b6.JPEG"
    ],
    "explanation_images": []
  }
];
        let quizName = '12 Nephroradiology';
        let hierarchy = ["Marrow", "qBank", "Radiology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>