<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>03 Concepts Of Disease And Prevention - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Community Medicine
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">26</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following is not a component of the epidemiological triad for tuberculosis?",
    "choices": [
      {
        "id": 1,
        "text": "A malnourished child."
      },
      {
        "id": 2,
        "text": "Mycobacterium tuberculosis"
      },
      {
        "id": 3,
        "text": "Duration of illness"
      },
      {
        "id": 4,
        "text": "Overcrowding"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Hence, a\u00a0malnourished child (host),\u00a0Mycobacterium tuberculosis (agent) and overcrowding (environment) form the epidemiological triad for tuberculosis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c184eed7c7ff471da903ee2938b8f033x1280x1204.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c08c563b712a4996a4ed1bd7c8ef104ax1280x1204.JPEG"
    ]
  },
  {
    "text": "Which of the following is the most logical sequence?",
    "choices": [
      {
        "id": 1,
        "text": "Disease \u2192 Impairment \u2192 Disability \u2192 Handicap"
      },
      {
        "id": 2,
        "text": "Impairment \u2192 Disease \u2192 Handicap \u2192 Disability"
      },
      {
        "id": 3,
        "text": "Disability \u2192 Disease \u2192Impairment \u2192Handicap"
      },
      {
        "id": 4,
        "text": "Disease\u2192 Disability\u2192 Impairment \u2192Handicap"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Disease &rarr; Impairment &rarr; Disability &rarr; Handicap</strong> is the most logical sequence among the given options.</p>\n<p>Disease is a state of physiological/psychological <strong>dysfunction</strong>.</p>\n<p>Impairment is any <strong>loss</strong> or abnormality in normal<strong> structure</strong> or <strong>function</strong>.</p>\n<p>Disability is the<strong> inability&nbsp;</strong>to carry out <strong>normal actions</strong> due to impairment.</p>\n<p>Handicap&nbsp;is the disadvantage due to disability that <strong>limits fulfilment of a role</strong> that is normal.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d37d6e2ed3fe4a9ea79c3defef63c7bex1280x1576.JPEG"
    ]
  },
  {
    "text": "A salesman met with an unfortunate accident that led to him eventually losing his left foot. He has been unable to walk after this incident and so been rendered unemployed. Match the following examples with the corresponding events explaining the concept of disability.",
    "choices": [
      {
        "id": 1,
        "text": "1-B, 2-C, 3-D, 4-A"
      },
      {
        "id": 2,
        "text": "1-D, 2-A, 3-B, 4-C"
      },
      {
        "id": 3,
        "text": "1-A, 2-B, 3-C, 4-D"
      },
      {
        "id": 4,
        "text": "1-C, 2-D, 3-A, 4-B"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The correctly matched events relating to the given example are as follows:</p>\n<table>\n<tbody>\n<tr>\n<td>Event</td>\n<td>Example</td>\n</tr>\n<tr>\n<td>Disease/Disorder</td>\n<td>Accident</td>\n</tr>\n<tr>\n<td>Impairment</td>\n<td>Loss of foot</td>\n</tr>\n<tr>\n<td>Disability</td>\n<td>Cannot Walk</td>\n</tr>\n<tr>\n<td>Handicap</td>\n<td>Unemployed</td>\n</tr>\n</tbody>\n</table>\n<p>The WHO definition of <strong>impairment</strong> is \"any <strong>loss</strong> <strong>or abnormality</strong> <strong>of</strong> psychological, physiological or anatomical <strong>structure or function</strong>\". E.g., loss of a foot. An initial impairment may cause a secondary impairment as well.</p>\n<p>The WHO defines <strong>disability</strong> as ''any<strong> restriction</strong> or lack of ability to perform an <strong>activity</strong> in the manner or within the range considered normal for a human being\".&nbsp;Because of impairment, the affected person may be unable to carry out certain activities and hence the person is considered disabled.</p>\n<p>According to the WHO, a <strong>handicap</strong> is \"a <strong>disadvantage</strong> for a given individual, resulting from an impairment or a disability, that <strong>limits</strong> or prevents the <strong>fulfilment of a role</strong> that is normal (depending on age, sex, and social and cultural factors) for that individual\". The disadvantages experienced by a person as a result of disability makes them handicapped.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is most appropriate about the web of disease causation?",
    "choices": [
      {
        "id": 1,
        "text": "It implies that individual factors in the web have equal weightage"
      },
      {
        "id": 2,
        "text": "It implies that all the chains of causation must be controlled to prevent disease"
      },
      {
        "id": 3,
        "text": "It is mostly applicable for acute and rare diseases"
      },
      {
        "id": 4,
        "text": "It suggests ways of interrupting the disease occurrence"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The <strong>web of causation</strong> for a disease suggests a number of <strong>ways to interrupt</strong> the <strong>disease</strong> occurrence/progression.</p>\n<p>This model was suggested by <strong>MacMahon and Pugh</strong> in their book &lsquo;Epidemiologic Principles and Methods&rsquo;.</p>\n<p><strong>Web of causation</strong> considers all the predisposing factors and their complex interrelationship with each other. This model is ideally <strong>suited</strong> in the study of <strong>chronic disease</strong>. The web of causation does not imply that the disease is controlled only when all the multiple chains of causation are removed. Sometimes <strong>removal</strong> of <strong>one significant link</strong> is sufficient to <strong>control</strong> the <strong>disease</strong>.</p>\n<p>In a multifactorial event, <strong>individual factors</strong> are by <strong>no</strong> means of <strong>equal weightage</strong>. The importance of each factor is <strong>expressed</strong> in terms of <strong>relative risk</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not true regarding the pathogenesis period of a disease?",
    "choices": [
      {
        "id": 1,
        "text": "Primary prevention is possible"
      },
      {
        "id": 2,
        "text": "Recovery is seen in this period"
      },
      {
        "id": 3,
        "text": "Entry of causative agent is seen"
      },
      {
        "id": 4,
        "text": "Includes subclinical cases"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Primary prevention</strong> is not possible in the pathogenesis period of a disease.\u00a0It can only be done in the<strong> period of pre-pathogenesis</strong>.</p>\n<p>The <strong>two phases</strong> in the natural history of a disease include:</p>\n<ul>\n<li><strong>Period of pre-pathogenesis</strong>: It is\u00a0<strong>before</strong>\u00a0the\u00a0<strong>onset</strong>\u00a0of\u00a0disease\u00a0in humans. The disease agent has not entered the host, but the factors favouring the disease already exist. Primary prevention<strong>\u00a0</strong>(health promotion and specific protection) is applicable in this period.</li>\n<li><strong>Period of pathogenesis</strong>:\u00a0It\u00a0begins with\u00a0the\u00a0<strong>entry</strong>\u00a0of the\u00a0<strong>organism</strong>\u00a0till <strong>recovery</strong>, <strong>death</strong> or <strong>disability</strong>. Secondary (halting of the disease process) and tertiary prevention (measures to limit disability) are applicable in this period. It isn't always characterised by the presence of disease symptoms as it also <strong>includes subclinical cases</strong>.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In the iceberg phenomenon of disease, which of the following does not represent the submerged portion of the iceberg?",
    "choices": [
      {
        "id": 1,
        "text": "Pre-symptomatic cases"
      },
      {
        "id": 2,
        "text": "Latent cases"
      },
      {
        "id": 3,
        "text": "Diagnosed cases"
      },
      {
        "id": 4,
        "text": "Undiagnosed cases"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Epidemiologically, the <strong>iceberg phenomenon</strong> of disease,&nbsp;<strong>diagnosed cases</strong> are represented by the floating <strong>tip</strong> of the iceberg.</p>\n<p>The iceberg phenomenon of disease is related to the spectrum of disease. The <strong>water surface</strong> is the line of <strong>demarcation</strong> between the <strong>apparent and inapparent infections</strong>.</p>\n<p>The <strong>submerged portion </strong>of the iceberg<strong>&nbsp;</strong>represents the hidden mass of diseases like <strong>asymptomatic, latent, </strong>and<strong> undiagnosed cases</strong>.<strong>&nbsp;</strong>Screening is done to identify these cases.</p>\n<p>The iceberg phenomenon of disease is depicted in the image below.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c1c4b2aefceb47019a99308b6f61f77dx1280x1252.JPEG"
    ]
  },
  {
    "text": "Which of the following diseases shows the iceberg phenomenon?",
    "choices": [
      {
        "id": 1,
        "text": "Tetanus"
      },
      {
        "id": 2,
        "text": "Rubella"
      },
      {
        "id": 3,
        "text": "Measles"
      },
      {
        "id": 4,
        "text": "Rabies"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Rubella</strong> shows the <strong>iceberg phenomenon</strong> of disease.</p>\n<p>The iceberg phenomenon of diseases is <strong>not shown</strong> by diseases such as <strong>tetanus</strong>, <strong>rabies</strong>, and <strong>measles</strong>.</p>\n<p>Iceberg phenomenon is shown by:</p>\n<ul>\n<li>Polio</li>\n<li>Influenza</li>\n<li>Rubella</li>\n<li>Mumps</li>\n<li>Japanese Encephalitis</li>\n<li>Diphtheria</li>\n<li>Hepatitis A and B</li>\n<li>Tuberculosis</li>\n<li>Diabetes</li>\n<li>Malnutrition</li>\n<li>Hypertension</li>\n</ul>\n<p>Note: If a disease has <strong>more</strong> number of<strong> subclinical infections</strong>, it shows the <strong>iceberg phenomenon</strong> of disease depicted in the image below.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0bc171ac344f4c69ae5e07529257efdcx1280x1252.JPEG"
    ]
  },
  {
    "text": "What is the term used to describe the interruption in the transmission of a disease?",
    "choices": [
      {
        "id": 1,
        "text": "Elimination"
      },
      {
        "id": 2,
        "text": "Eradication"
      },
      {
        "id": 3,
        "text": "Surveillance"
      },
      {
        "id": 4,
        "text": "Control"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Interruption </strong>in the<strong> transmission</strong> of a disease is called <strong>elimination</strong>. It is a step towards eradication.</p>\n<p><span class=\"custom help\"><strong>Elimination </strong>is a <strong>reduction</strong> in the number of <strong>new cases</strong> of an infectious disease <strong>to zero</strong> (or a very low defined target rate) in a defined geographical area as a result of deliberate efforts. Continued measures to prevent re-establishment of transmission are required.</span></p>\n<p><strong>Eradication </strong>is a complete and <strong>permanent worldwide</strong> <strong>reduction</strong> to <strong>zero new cases</strong> of an infectious disease through deliberate efforts. No further control measures are required.\u00a0</p>\n<p><strong>Surveillance\u00a0</strong>is the\u00a0<strong>continuous scrutiny </strong>of factors<strong>\u00a0</strong>that determine the occurrence and distribution of disease and ill health.</p>\n<p><strong>Control</strong> aims at <strong>decreasing</strong> the <strong>incidence</strong>,<strong> duration</strong> and <strong>transmission</strong> of the disease. It also aims at decreasing the physical and psychological <strong>complications</strong> of a disease.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Among the following options, which aids the most in disease elimination?",
    "choices": [
      {
        "id": 1,
        "text": "Isolation"
      },
      {
        "id": 2,
        "text": "Quarantine"
      },
      {
        "id": 3,
        "text": "Herd immunity"
      },
      {
        "id": 4,
        "text": "Complete treatment"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Herd immunity</strong> aids the most in <strong>disease elimination</strong>.</p>\n<p>Herd immunity achieved, especially through immunization, goes a long way in helping the elimination of diseases. When a&nbsp;<strong>high </strong>level of<strong> herd immunity</strong> is maintained, the <strong>susceptible population </strong>is<strong> reduced </strong>to a small proportion, thereby eliminating the disease.</p>\n<p>The purpose of <strong>isolation</strong> is to protect the community by&nbsp;<strong>preventing</strong> the <strong>transfer</strong> of <strong>infection</strong> from the reservoir to the&nbsp;possible susceptible hosts.&nbsp;<strong>Quarantine</strong> refers to<strong> restrictions</strong>&nbsp;on the<strong> healthy contacts</strong> of an infectious disease.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "While collecting surveillance data for disease X, you find that the incidence of the disease is zero in your region. Which of the following statements best describes this scenario?",
    "choices": [
      {
        "id": 1,
        "text": "Disease is eliminated from the region."
      },
      {
        "id": 2,
        "text": "Disease is well controlled in the region."
      },
      {
        "id": 3,
        "text": "Disease is eradicated from the region."
      },
      {
        "id": 4,
        "text": "Disease shows iceberg phenomenon in the region."
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><span class=\"custom help\">In the given scenario, as the disease has<strong> zero incidence</strong>, we can say the disease has been <strong>eliminated</strong> from the region.</span></p>\n<p><span class=\"custom help\"><strong>Elimination&nbsp;</strong>is a&nbsp;<strong>reduction</strong>&nbsp;in the number of&nbsp;<strong>new cases</strong>&nbsp;of an infectious disease <strong>to</strong>&nbsp;<strong>zero</strong>&nbsp;(or a very low defined target rate) in a defined geographical area as a result of deliberate efforts. Continued measures to prevent re-establishment of transmission are required.</span></p>\n<p><strong>Eradication&nbsp;</strong>is a complete and&nbsp;<strong>permanent worldwide</strong>&nbsp;<strong>reduction</strong>&nbsp;to&nbsp;<strong>zero new cases</strong>&nbsp;of an infectious disease through deliberate efforts. No further control measures are required.</p>\n<p><strong>Control</strong>&nbsp;aims at&nbsp;<strong>decreasing</strong>&nbsp;the&nbsp;<strong>incidence</strong>,<strong>&nbsp;duration</strong>&nbsp;and&nbsp;<strong>transmission</strong>&nbsp;of the disease. It also aims at decreasing the physical and psychological&nbsp;<strong>complications</strong>&nbsp;of a disease.</p>\n<p>The&nbsp;<strong>iceberg phenomenon </strong>of disease&nbsp;is related to the spectrum of disease.&nbsp;The&nbsp;<strong>submerged portion </strong>of the iceberg<strong>&nbsp;</strong>represents the hidden mass of diseases like&nbsp;<strong>asymptomatic</strong>, <strong>latent</strong>,&nbsp;and<strong>&nbsp;undiagnosed cases</strong>.<strong>&nbsp;</strong>The&nbsp;<strong>clinical or diagnosed cases</strong>&nbsp;are represented by the&nbsp;<strong>floating tip</strong>&nbsp;of the iceberg and not the submerged portion. As disease incidence is zero here, there are no cases to form the iceberg.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is a silent epidemic?",
    "choices": [
      {
        "id": 1,
        "text": "Bipolar disorders"
      },
      {
        "id": 2,
        "text": "Manic depressive disorder"
      },
      {
        "id": 3,
        "text": "Alzheimer\u2019s disease"
      },
      {
        "id": 4,
        "text": "Generalised anxiety disorder"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Alzheimer&rsquo;s disease</strong> is referred to as the <strong>silent epidemic </strong>of the century.</p>\n<p>Nearly 50 million people globally are living with this disease. Since it strikes so often, so arbitrarily, and with such little warning, many have dubbed it the silent epidemic.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the analysis of routine measurements aimed at detecting changes in the health status of a population called?",
    "choices": [
      {
        "id": 1,
        "text": "Monitoring"
      },
      {
        "id": 2,
        "text": "Surveillance"
      },
      {
        "id": 3,
        "text": "Systematic review"
      },
      {
        "id": 4,
        "text": "Sentinel surveillance"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The&nbsp;<strong>analysis</strong> of routine measurements aimed at <strong>detecting changes</strong> in the <strong>health status</strong> or environment of a population is called <strong>monitoring</strong>.</p>\n<p><strong>Surveillance </strong>is the <strong>continuous scrutiny </strong>of factors that determine the occurrence and distribution of disease and ill health.</p>\n<p><strong>Sentinel surveillance</strong> is a method of <strong>identifying</strong> the <strong>missing cases</strong> and thereby supplementing the notified cases.</p>\n<p><strong>Systematic reviews</strong> involve a detailed plan with the goal of <strong>reducing bias</strong> by identifying, appraising, and synthesizing <strong>all relevant studies</strong> on a particular topic.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In which of the following does surveillance of disease not have a direct role?",
    "choices": [
      {
        "id": 1,
        "text": "Health planning"
      },
      {
        "id": 2,
        "text": "Control of disease"
      },
      {
        "id": 3,
        "text": "Data on new and changing trends"
      },
      {
        "id": 4,
        "text": "Breaking chain of transmission"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Surveillance</strong> of a disease does not have a direct role in breaking the chain of transmission.</p>\n<p>Surveillance is the <strong>continuous scrutiny </strong>of factors that <strong>determine</strong> the <strong>occurrence</strong> and <strong>distribution</strong> of disease and ill health.</p>\n<p>It <strong>helps</strong> in <strong>health planning</strong> and provides <strong>information</strong> about public health disasters including data on <strong>new</strong> and <strong>changing trends</strong> of disease.</p>\n<p>Surveillance requires professional analysis and sophisticated judgment of data, leading to <strong>recommendations</strong> for <strong>control activities</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Measures in sentinel surveillance do not aim at identifying:",
    "choices": [
      {
        "id": 1,
        "text": "Missing cases of the disease"
      },
      {
        "id": 2,
        "text": "Old cases of the disease"
      },
      {
        "id": 3,
        "text": "New cases of the disease"
      },
      {
        "id": 4,
        "text": "Cases free of disability"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Sentinel surveillance</strong> does not include identifying cases free of disability.</p>\n<p>Sentinel surveillance helps in <strong>identifying</strong> the <strong>missing </strong>cases, in addition to the <strong>already existing</strong> and <strong>new cases</strong>. It is used for&nbsp;supplementing routine notifications.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is public health surveillance preferentially aimed at?",
    "choices": [
      {
        "id": 1,
        "text": "Treatment of disease"
      },
      {
        "id": 2,
        "text": "Disease eradication"
      },
      {
        "id": 3,
        "text": "Disease monitoring"
      },
      {
        "id": 4,
        "text": "Health planning"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Public health surveillance is <strong>preferentially</strong> aimed at <strong>health planning</strong>.</p>\n<p><strong>Public health surveillance</strong> provides important <strong>feedback</strong> on the <strong>health status</strong> of the population, about planning <strong>control and prevention activities</strong>, and also for <strong>public health disasters</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is included under primordial prevention of coronary artery disease?",
    "choices": [
      {
        "id": 1,
        "text": "Lifestyle change in adults"
      },
      {
        "id": 2,
        "text": "Coronary bypass"
      },
      {
        "id": 3,
        "text": "Regular BP estimation"
      },
      {
        "id": 4,
        "text": "Lifestyle changes in childhood"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Adoption of a <strong>healthy lifestyle</strong> from <strong>childhood</strong>\u00a0would fall under the category of <strong>primordial prevention </strong>of coronary artery disease.</p>\n<p>Primordial prevention is <strong>preventing</strong> the <strong>emergence of risk factors</strong> among population groups in which these risk factors have not yet appeared. Most adult health problems (obesity, hypertension) have their early origins in childhood. It is in childhood that lifestyles are formed i.e. eating patterns, physical exercise, smoking, etc.</p>\n<p>In primordial prevention, efforts are made to discourage <strong>children</strong> from adopting harmful lifestyles.</p>\n<p>These lifestyle changes when made by\u00a0<strong>adults </strong>are known as<strong> primary</strong> <strong>prevention</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What type of prevention is the prescriptive screening of a disease?",
    "choices": [
      {
        "id": 1,
        "text": "Primordial"
      },
      {
        "id": 2,
        "text": "Primary"
      },
      {
        "id": 3,
        "text": "Secondary"
      },
      {
        "id": 4,
        "text": "Tertiary"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Prescriptive screening</strong> of a disease is an example of <strong>secondary prevention</strong>.</p>\n<p><strong>Prescriptive screening</strong> of disease can lead to <strong>early diagnosis</strong> of disease. By early diagnosis, intervention can be made to prevent disability. Hence, it comes under secondary prevention.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What form of prevention is prospective screening?",
    "choices": [
      {
        "id": 1,
        "text": "Primary"
      },
      {
        "id": 2,
        "text": "Secondary"
      },
      {
        "id": 3,
        "text": "Tertiary"
      },
      {
        "id": 4,
        "text": "Primordial"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Prospective screening</strong> is a type of<strong>&nbsp;primary prevention</strong>.</p>\n<p>Prospective screening&nbsp;is done on <strong>healthy individuals</strong> to screen for disease. It is done <strong>prior</strong> to the<strong> onset</strong> of the disease. E.g., screening donated blood for HIV before it is transfused. This type of prevention reduces the incidence of disease.</p>\n<p>Note:&nbsp;<strong>Prescriptive screening</strong>&nbsp;is done for <strong>case detection. </strong>People are screened for their&nbsp;own benefits. It is an <strong>early diagnosis</strong> of diseases existing in them. This is a form of<strong> secondary prevention</strong>. E.g., neonatal screening for hypothyroidism, pap smear for detection of cervical cancer.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You advise a reproductive age woman to vaccinate against HPV. What is this type of prevention called?",
    "choices": [
      {
        "id": 1,
        "text": "Primordial prevention"
      },
      {
        "id": 2,
        "text": "Primary prevention"
      },
      {
        "id": 3,
        "text": "Secondary prevention"
      },
      {
        "id": 4,
        "text": "Tertiary prevention"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given scenario of <strong>immunisation</strong> is an example of <strong>primary prevention</strong>.</p>\n<p>Primary prevention is an&nbsp;action taken<strong>&nbsp;before</strong>&nbsp;the <strong>onset</strong> of disease. This reduces the possibility of disease occurrence. Hence, <strong>immunization</strong> is a form of primary prevention, through <strong>specific protection</strong>.</p>\n<p>Examples of primary prevention include immunization, sanitation, solid and liquid waste management etc.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Who among the following is not a target for primary prevention?",
    "choices": [
      {
        "id": 1,
        "text": "Apparently healthy individuals"
      },
      {
        "id": 2,
        "text": "Individuals with risk factor"
      },
      {
        "id": 3,
        "text": "Children less than 5years"
      },
      {
        "id": 4,
        "text": "Asymptomatic patients"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Asymptomatic patients</strong> are the target population for <strong>secondary prevention</strong> but not for primary prevention.</p>\n<p><strong>Primary</strong> prevention is implemented <strong>before</strong> the <strong>onset</strong> of the disease. Hence, all patients including asymptomatic ones are not included in the target group.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "As a part of the iodine deficiency control programme, you advocate the usage of iodized salt in hilly areas. What is this type of prevention an example of?",
    "choices": [
      {
        "id": 1,
        "text": "Primordial prevention"
      },
      {
        "id": 2,
        "text": "Primary prevention"
      },
      {
        "id": 3,
        "text": "Secondary prevention"
      },
      {
        "id": 4,
        "text": "Tertiary prevention"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The usage of<strong> iodized salt</strong> in<strong> iodine-deficient areas&nbsp;</strong>like in hilly regions is an example of&nbsp;<strong>primary prevention </strong>as it provides specific protection.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You are performing a routine pap smear on a 30-year-old woman in the gynecology OPD. What level of prevention does this fall under?",
    "choices": [
      {
        "id": 1,
        "text": "Primordial"
      },
      {
        "id": 2,
        "text": "Secondary"
      },
      {
        "id": 3,
        "text": "Primary"
      },
      {
        "id": 4,
        "text": "Tertiary"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Pap smear</strong> is a screening test for carcinoma cervix and is an example of\u00a0<strong>secondary prevention.</strong></p>\n<p><strong>Early diagnosis </strong>(including screening) and treatment\u00a0are the components of secondary prevention. Some of the examples of secondary prevention are as follows:</p>\n<ul>\n<li>Papanicolaou (Pap) smear for early detection of cervical cancer</li>\n<li>Mammography for early detection of breast cancer</li>\n<li>Colonoscopies for early detection of colon cancer</li>\n<li>Blood Pressure Screening</li>\n</ul>\n<p>Secondary prevention measures focus on the <strong>sub-clinical </strong>stag<span style=\"color: #000000;\">e and the <strong>early clinical</strong> stage, such as dysplasia in this case. </span></p>\n<p><span style=\"color: #000000;\">T</span>hese measures enable early detection and prompt effective intervention to correct departures from a state of health.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What mode of prevention is disability prevention by appropriate treatment an example of?",
    "choices": [
      {
        "id": 1,
        "text": "Primordial prevention"
      },
      {
        "id": 2,
        "text": "Primary prevention"
      },
      {
        "id": 3,
        "text": "Secondary prevention"
      },
      {
        "id": 4,
        "text": "Tertiary prevention"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Disability prevention</strong> by appropriate treatment is an example of\u00a0<strong>secondary prevention</strong>. This is because disability has not occurred yet so correct treatment can stop it from developing.</p>\n<p>After the disability has set in, <strong>prevention</strong> of <strong>progression</strong> <strong>of disability</strong> from transitioning into a handicap is <strong>tertiary prevention</strong>. It is also called <strong>disability limitation</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is an example of disability limitation?",
    "choices": [
      {
        "id": 1,
        "text": "Prescribing spectacles for refractive error"
      },
      {
        "id": 2,
        "text": "Starting a patient on anti-tuberculous therapy"
      },
      {
        "id": 3,
        "text": "Abstinence from  smoking"
      },
      {
        "id": 4,
        "text": "Early fixation of fractures"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Prescribing spectacles</strong> for refractive error is an example of <strong>disability limitation </strong>which is a component of <strong>tertiary prevention</strong>. This mode of intervention is applicable when the patient presents late in the pathogenesis phase.&nbsp;</p>\n<p>The objective of this intervention is to<strong> prevent</strong> or halt the transition of the disease process from <strong>impairment</strong> <strong>to</strong> <strong>handicap</strong>.</p>\n<p>Option B: Starting a patient on <strong>anti-tuberculous therapy</strong> is <strong>secondary </strong>prevention as it is a part of treatment.</p>\n<p>Option C: <strong>Abstinence</strong> from <strong>smoking</strong> is a modification of the risk factor. Hence it is an example of <strong>primary </strong>prevention.</p>\n<p>Option D: <strong>Early fixation</strong> of <strong>fractures</strong> will prevent disability.&nbsp;Hence, it is an example of <strong>secondary</strong> prevention.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which among the following diseases was eliminated in India in 2015?",
    "choices": [
      {
        "id": 1,
        "text": "Leprosy"
      },
      {
        "id": 2,
        "text": "Neonatal tetanus"
      },
      {
        "id": 3,
        "text": "Tuberculosis"
      },
      {
        "id": 4,
        "text": "Yellow fever"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Maternal</strong> and<strong> neonatal tetanus&nbsp;</strong>was <strong>eliminated</strong> from India in <strong>2015</strong>, as certified&nbsp;by the WHO.</p>\n<p>Important years for <strong>India</strong> (declared <strong>disease-free</strong>):</p>\n<ul>\n<li>Infective trachoma - 2017</li>\n<li>Yaws - 2016</li>\n<li>Maternal &amp; neonatal tetanus - 2015</li>\n<li>Polio - 2014</li>\n<li>Guinea worm disease (dracunculiasis) - 2000</li>\n</ul>\n<p><strong>Worldwide eradication</strong>:</p>\n<ul>\n<li>Type-2 wild poliovirus - 2015</li>\n<li>Type-3 wild poliovirus- 2019</li>\n<li>Smallpox - 1980</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is false about ICD- 11?",
    "choices": [
      {
        "id": 1,
        "text": "It includes a new chapter on traditional medicine"
      },
      {
        "id": 2,
        "text": "Gender incongruence is now listed as part of mental health"
      },
      {
        "id": 3,
        "text": "The codes relating to antimicrobial resistance are more closely in line with the Global  Antimicrobial Resistance Surveillance System"
      },
      {
        "id": 4,
        "text": "It has come into full effect from January 2022"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The new ICD-11 has a new chapter on <strong>sexual health </strong>that contains<strong> gender incongruence</strong>, which was previously listed under mental health conditions in the ICD-10.</p>\n<p>The ICD 11 was released by the WHO in June 2018 and was presented at the World Health Assembly in May 2019 for adoption by the Member States. It has come into<strong> effect</strong>&nbsp;from&nbsp;<strong>1 January 2022.</strong></p>\n<p>Its&nbsp;designations for <strong>antibiotic resistance align</strong> with the Global Antimicrobial Resistance Surveillance System (<strong>GLASS</strong>). It is given by the <strong>WHO </strong>and&nbsp;is <strong>revised</strong> every&nbsp;<strong>10 years.</strong></p>\n<p><strong>New chapters</strong>&nbsp;added in ICD-11 are:</p>\n<ul>\n<li><strong>Traditional medicine</strong></li>\n<li>Sexual health: Gender incongruence has been moved from mental health to sexual health.</li>\n<li>Gaming disorder has been added under Addictive disorders.</li>\n<li>Immune system disorders, which will enable the better study of allergies.</li>\n</ul>\n<p>It has more detail on cancer, specifically different types of skin cancer, as well as on heart health and weight disorders compared to ICD-10.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '03 Concepts Of Disease And Prevention';
        let hierarchy = ["Marrow", "qBank", "Community Medicine"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>