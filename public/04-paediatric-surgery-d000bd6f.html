<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>04 Paediatric Surgery - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Surgery
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">22</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "An infant delivered at full-term by normal vaginal delivery, presented with respiratory distress immediately after birth. Chest X-ray showed the following picture. What is the probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Hyaline membrane disease"
      },
      {
        "id": 2,
        "text": "Meconium aspiration syndrome"
      },
      {
        "id": 3,
        "text": "Congenital diaphragmatic hernia"
      },
      {
        "id": 4,
        "text": "Transient tachypnea of the newborn"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The above X-ray chest shows <strong>intra-thoracic bowel shadows</strong> along with <strong>mediastinal shift</strong> suggestive of <strong>congenital diaphragmatic hernia</strong>.</p>\n<p>The common clinical presentation is as follows:</p>\n<ul>\n<li>Respiratory distress</li>\n<li>Dextrocardia</li>\n<li>Scaphoid abdomen</li>\n</ul>\n<p>Prenatal diagnosis is done by <strong>ultrasonography</strong>.&nbsp;<strong>Lung-to-head ratio</strong> (LHR) is used to assess severity in patients with left-sided CDH. An LHR value of <strong>&lt;1</strong>&nbsp;is associated with a very <strong>poor</strong> prognosis, whereas an LHR <strong>&gt;1.4</strong> predicts a more <strong>favourable</strong> outcome.</p>\n<p>Option A: <strong>Hyaline membrane disease</strong> is a syndrome in premature infants caused by developmental <strong>insufficiency</strong> of pulmonary <strong>surfactant</strong> production and structural immaturity in the lungs.</p>\n<p>Option B: <strong>Meconium aspiration syndrome</strong>&nbsp;is the aspiration of meconium-stained amniotic fluid, which can occur before, during or immediately after birth. Meconium is the first intestinal discharge from newborns, a viscous, dark-green substance composed of intestinal epithelial cells, lanugo, mucus, and intestinal secretions.</p>\n<p>Option D: During normal delivery, the compression of the rib cage while passing through the mother's vaginal canal helps to remove fluid from the lungs. However, newborns who are delivered via <strong>cesarean</strong> birth may have excess fluid in the lungs and therefore be <strong>hypoxic</strong> and develop <strong>transient tachypnea.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3cd9848c0e5442c590398c7914a49441.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is false regarding congenital diaphragmatic hernia?",
    "choices": [
      {
        "id": 1,
        "text": "Most CDH defects occur on the left side"
      },
      {
        "id": 2,
        "text": "Occurs due to failure of closure of the pleuroperitoneal canal in the developing fetus"
      },
      {
        "id": 3,
        "text": "Pulmonary hypoplasia and pulmonary hypertension significantly affects the prognosis"
      },
      {
        "id": 4,
        "text": "The posterolateral variant of this hernia is known as Morgagni hernia"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Pulmonary hypertension and pulmonary hypoplasia</strong>\u00a0are the <strong>most important prognostic factors</strong> in congenital diaphragmatic hernia.</p>\n<p>Other poor\u00a0prognostic indicators in CDH :</p>\n<ul>\n<li>The presence of liver in the thoracic cavity\u00a0</li>\n<li>Early respiratory distress, within 24 h after birth</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Need for extracorporeal membrane oxygenation</li>\n<li>Herniation to the contralateral lung (<strong>right-sided hernia)</strong></li>\n<li>\u00a0</li>\n</ul>\n<p>Treatment of congenital diaphragmatic hernia:</p>\n<p>Variable period of time (24-72 hours) is to be allowed for stabilization before surgical repair. Immediate respiratory support should be provided, including <strong>rapid endotracheal intubation</strong> and sedation.\u00a0</p>\n<p><strong>Bag and mask ventilation</strong>\u00a0is\u00a0<strong>contraindicated\u00a0</strong>in newborns with congenital diaphragmatic hernia because it\u00a0causes\u00a0<strong>distension of the stomach</strong>\u00a0which in turn may limit the expansion of the already\u00a0<strong>hypoplastic lung</strong>.</p>\n<p>During surgery, the viscera are reduced into the abdominal cavity, and the posterolateral defect in the diaphragm is closed using <strong>interrupted, nonabsorbable sutures.\u00a0</strong>In most cases (80%-90%), a hernia sac is not present. If identified, it is excised at the time of repair.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e19809da62744343a250533e12271526x1280x1659.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d0c33a62e8824903bb81b298c4d46316x1280x1306.JPEG"
    ]
  },
  {
    "text": "Most common organ that herniates in Morgagni\u2019s hernia is ______",
    "choices": [
      {
        "id": 1,
        "text": "Spleen"
      },
      {
        "id": 2,
        "text": "Liver"
      },
      {
        "id": 3,
        "text": "Stomach"
      },
      {
        "id": 4,
        "text": "Transverse colon"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>The transverse colon is</strong> the most common herniating structure in a Morgagni hernia.</p>\n<p><strong>Morgagni Hernia</strong>:</p>\n<ul>\n<li>A hernia in the anterior part of the diaphragm with a defect <strong>between the</strong> <strong>sternal and costal attachments</strong></li>\n<li>The most commonly involved viscus is the <strong>transverse colon.</strong></li>\n</ul>\n<p><strong>Morgagni hernia: </strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/24308b201eaa48879cc8a1ff995807dex611x1024.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/541e9d2999564e41a106b1882eaded87x704x1024.JPEG"
    ]
  },
  {
    "text": "What is not true regarding a Bochdalek hernia?",
    "choices": [
      {
        "id": 1,
        "text": "Early respiratory distress leading to early diagnosis and treatment is a good prognostic sign"
      },
      {
        "id": 2,
        "text": "The contents of hernial sac commonly includes retroperitoneal fat, left kidney or spleen"
      },
      {
        "id": 3,
        "text": "The condition is diagnosed prenatally by ultrasonography."
      },
      {
        "id": 4,
        "text": "Pericardial cyst is a differential diagnosis."
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Early respiratory distress</strong>, within 6 hours of birth, is thought to be a<strong> poor prognostic sign</strong>.</p>\n<p><strong>Features of a&nbsp;Bochdalek hernia</strong>:</p>\n<ul>\n<li><strong>Respiratory distress</strong> is a cardinal sign in infants with a congenital diaphragmatic hernia (CDH).</li>\n<li><strong>Early respiratory distress, within 6 hr after birth, is thought to be a poor prognostic sign</strong>.</li>\n<li>Children with CDH may also have a <strong>scaphoid abdomen and increased chest wall diameter.</strong></li>\n<li>Bowel sounds may also be heard in the chest, with a&nbsp;<strong>bilateral&nbsp;decrease in breath sounds. </strong></li>\n<li>The point of maximal cardiac impulse may be displaced away from the side of a hernia if a&nbsp;<strong>mediastinal shift</strong> has occurred.</li>\n<li><strong>Retroperitoneal fat, left kidney, spleen&nbsp;</strong>or only the omentum commonly herniates through the defect. If the defect is large, most abdominal contents including stomach may herniate.</li>\n</ul>\n<p><strong>Diagnosis: </strong></p>\n<ul>\n<li>Chest radiography and passage of a nasal gastric tube confirm the diagnosis.</li>\n<li>CDH can be diagnosed on <strong>prenatal ultrasonography (between 16 and 24 weeks of gestation) </strong></li>\n<li>High-speed fetal magnetic resonance imaging (MRI) can further define the lesion.</li>\n</ul>\n<p><strong>Ultrasonography findings</strong>:</p>\n<ul>\n<li>Polyhydramnios</li>\n<li>Chest mass</li>\n<li>Mediastinal shift</li>\n<li>Gastric bubble or a liver in the thoracic cavity</li>\n<li>Fetal hydrops</li>\n</ul>\n<p><strong>Differential</strong> <strong>diagnosis</strong>:</p>\n<ul>\n<li>Eventration</li>\n<li>Cystic lung lesion (pulmonary sequestration or cystic adenomatoid Malformation)</li>\n<li><strong>Group B streptococcal sepsis:</strong>&nbsp;associated with <strong>delayed onset</strong> of symptoms and a CDH often on the right side.</li>\n<li><strong>Pneumothorax:&nbsp;</strong>always occurs on <strong>contralateral </strong>to the <strong>side of CDH</strong>.</li>\n</ul>\n<p><strong>Treatment: </strong></p>\n<p>Variable period of time (24-72 hours) to allow for stabilization before surgical repair</p>\n<p>The viscera are reduced into the abdominal cavity, and the posterolateral defect in the diaphragm is closed using interrupted, nonabsorbable sutures.</p>\n<p>In most cases (80%-90%), a hernia sac is not present. If identified, it is excised at the time of repair.</p>\n<p>Conventional mechanical ventilation, high-frequency oscillatory ventilation (HFOV), and extracorporeal membrane oxygenation (ECMO) are the 3 main strategies to support respiratory failure in the newborn with CDH.</p>\n<p>Good relative indicators of stability are as follows:</p>\n<ul>\n<li>Requirement for conventional ventilation only</li>\n<li>Low peak inspiratory pressure</li>\n<li>Fio2 &lt;50</li>\n</ul>\n<p>If the defect is too large, a porous polytetrafluoroethylene (Gore-Tex) patch is used.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is the most common Gastrointestinal atresia?",
    "choices": [
      {
        "id": 1,
        "text": "Duodenal atresia"
      },
      {
        "id": 2,
        "text": "Colonic atresia"
      },
      {
        "id": 3,
        "text": "Ileal atresia"
      },
      {
        "id": 4,
        "text": "Jejunal atresia"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The most common Gastrointestinal atresia is<strong>\u00a0duodenal atresia</strong> (60%) followed by jejunal and ileal atresia (20%). Colonic atresia is the least common type (7-10%).</p>\n<p>Duodenal atresias are commonly associated with chromosomal abnormalities such as <strong>Down syndrome</strong>. It occurs approximately in 1/10,000 births.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 3-day-old neonate presented with recurrent bilious vomiting. An X-ray erect abdomen is given below. What is the next best step in managing this condition?",
    "choices": [
      {
        "id": 1,
        "text": "CT abdomen"
      },
      {
        "id": 2,
        "text": "Gastrograffin follow-through"
      },
      {
        "id": 3,
        "text": "USG abdomen"
      },
      {
        "id": 4,
        "text": "Explorative laparotomy"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Explanation:&nbsp;</p>\n<p>The given clinical history with an x-ray showing a triple bubble sign is suggestive of jejunal atresia. The next best step is to perform a contrast study to localize the site of obstruction.</p>\n<p>Small bowel atresias present with intestinal obstruction soon after birth.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Bilious vomiting is the dominant feature in jejunal atresia&nbsp;</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Abdominal distension is more prominent in ileal atresia</li>\n</ul>\n<p>A small amount of pale meconium may be passed, despite the atresia.</p>\n<p>Plain abdomen radiographs in a jejunal/ileal atresia case will show <strong>multiple air-fluid levels</strong> and dilated loops. They <strong>don't reliably distinguish</strong> small and large bowels in neonates and hence contrast studies are often required to localize the obstruction.</p>\n<p>Water-soluble enemas (<strong>Gastrogaffin</strong>, <strong>Hypaque</strong>) are particularly useful in <strong>differentiating atresia from meconium ileus and Hirschsprung disease</strong>. Contrast studies also help to rule out distal intestinal obstruction and occasionally may act therapeutically to relieve obstructions.</p>\n<p>In most cases of jejunal/ileal atresia, the distal end of the <strong>dilated proximal small bowel</strong> is <strong>resected</strong> and a <strong>primary end-to-end anastomosis</strong> is done. If the proximal bowel is extremely dilated, it may need to be tapered to the distal bowel before anastomosis.</p>\n<p>Other options:&nbsp;</p>\n<p>Option A:&nbsp; CT is not recommended for neonates owing to the harmful effects of <strong>radiation</strong>.</p>\n<p>Option C: USG abdomen does not help to localize the site of obstruction and is more useful in the diagnosis of intussusception, where there is an abdominal mass.</p>\n<p>Option D: Explorative laparotomy is not done for diagnosing intestinal atresias.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/5810dfed2d4d456e80a34ce13f1ca2df.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Bishop-Koop anastomosis is done for which of the following conditions?",
    "choices": [
      {
        "id": 1,
        "text": "Meconium ileus"
      },
      {
        "id": 2,
        "text": "Jejunal atresia"
      },
      {
        "id": 3,
        "text": "Duodenal atresia"
      },
      {
        "id": 4,
        "text": "Hirschprung's disease"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<ul>\n<li><strong>Ramstedt pyloromyotomy</strong> is the standard operation for <strong>hypertrophic pyloric stenosis</strong>.</li>\n<li><strong>Kasai procedure</strong> is done for <strong>biliary atresia</strong>.</li>\n<li><strong>Duhamel, Soave, Swenson procedures</strong> are done in <strong>Hirschsprung&rsquo;s</strong> disease.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/eebb099bfa1b40e7a3d92a4654e9a5d5x1280x2197.JPEG"
    ]
  },
  {
    "text": "An infant presents with copious bilious vomiting and abdominal distension on the 5th day of life. He had not passed meconium for the first 3 days after birth. An abdominal radiograph shows the presence of dilated bowel loops. What is the gold standard investigation for the given condition?",
    "choices": [
      {
        "id": 1,
        "text": "MRI"
      },
      {
        "id": 2,
        "text": "Contrast enema"
      },
      {
        "id": 3,
        "text": "Rectal biopsy"
      },
      {
        "id": 4,
        "text": "Rectal manometry"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The clinical scenario is suggestive of <strong>Hirschsprung's disease</strong>. A <strong>rectal biopsy&nbsp;</strong>is the <strong>gold standard</strong> for the diagnosis of Hirschsprung&rsquo;s disease.</p>\n<p>A rectal biopsy<strong> 2 cm above the dentate line</strong> is the ideal area for a biopsy.</p>\n<p>Hirschsprung&rsquo;s disease is a developmental disorder characterized by the&nbsp;<strong>absence of ganglion cells</strong> in the myenteric (Auerbach) plexus and submucosal (Meissner) plexus.&nbsp;Most infants present with abdominal distention and bilious emesis with failure to pass meconium within the first 24 hours of life.</p>\n<p class=\"p1\">The initial investigation is a <strong>contrast enema.&nbsp;</strong>The area between the dilated and contracted segments is referred to as the<strong> transition zone.&nbsp;</strong>The affected part shows the absence of ganglion cells and <strong>hypertrophy of nerve trunks&nbsp;</strong>in the rectal biopsy.</p>\n<p>Other investigations for Hirschsprung&rsquo;s disease include:</p>\n<ul>\n<li><strong>Water-soluble contrast enema </strong>-<strong>&nbsp;</strong>shows the presence of contracted aganglionic rectum, transition zone, and a dilated normally innervated colon.</li>\n<li><strong>Anorectal manometry -&nbsp;</strong>shows the failure of the relaxation of the internal anal sphincter.</li>\n</ul>\n<div class=\"ng-scope\">\n<div class=\"ng-scope\">\n<p class=\"ng-binding\"><strong>&nbsp;Definitive surgeries</strong> for Hirschsprung disease are as follows:</p>\n<ul>\n<li><strong>Swenson</strong>&nbsp;procedure, where aganglionic bowel is removed and a coloanal anastomosis is performed.</li>\n<li><strong>Duhamel</strong>&nbsp;procedure,<strong>&nbsp;</strong>where the aganglionic rectal stump is left in place and the ganglionated normal colon is pulled posterior.</li>\n<li><strong>Soave</strong>&nbsp;procedure, where endorectal mucosal dissection is done within the aganglionic distal rectum. The ganglionated normal colon is pulled through the remnant muscular cuff, and a coloanal anastomosis is performed.<span style=\"font-size: 14px;\">&nbsp;</span></li>\n</ul>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 2-year-old child is brought to the casualty with severe abdominal pain. On performing emergency exploratory laparotomy, the following finding is noted. Which of the following statements is false regarding this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Can be a lead point for intussusception"
      },
      {
        "id": 2,
        "text": "The most common presenting symptom is bleeding in younger children"
      },
      {
        "id": 3,
        "text": "It is a false diverticulum which extends from the anti-mesenteric side"
      },
      {
        "id": 4,
        "text": "Most common heterotopic tissue is gastric mucosa"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Meckel&rsquo;s diverticulum</strong> is a<strong> true diverticulum,&nbsp;</strong>which extends from the <strong>antimesenteric</strong> side of the small bowel. The diverticula which contain all the layers of the intestine are called <strong>true diverticula</strong>.&nbsp;</p>\n<p>Meckel&rsquo;s diverticulum is caused by a <strong>failure</strong> of normal <strong>regression</strong> of the <strong>vitelline duct</strong> that develops during weeks 5-7 of gestation.</p>\n<p>The <strong>rule of 2's</strong> (Mnemonic for Meckel&rsquo;s diverticulum) :</p>\n<ul>\n<li>2 types of heterotopic mucosa (gastric &amp; pancreatic)</li>\n<li>2% incidence</li>\n<li>located within 2 feet of the ileocecal valve</li>\n<li>approximately 2 inches in length</li>\n<li>Usually symptomatic by 2 years of age</li>\n</ul>\n<p>The most common presentation is painless, massive, <strong>lower GI bleed</strong> in children younger than 5 years.&nbsp;Meckel's diverticulum can be the lead point for <strong>ileoileal or ileocolic intussusception</strong>.</p>\n<p>A bleeding Meckel's diverticulum may be confirmed by a <strong>99 mTc-pertechnetate isotope scan</strong> to detect ectopic gastric mucosa.&nbsp;</p>\n<p><strong>Surgical treatment</strong> is the<strong> definitive </strong>therapy for Meckel&rsquo;s diverticulum. A simple V-shaped diverticulectomy with transverse closure of the ileum is the ideal surgical approach.</p>\n<p>The following diagram shows the various anomalies that arise as a result of the failure of normal regression of vitellointestinal duct:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c20fdedcd1214ecb975e2ea950395dd9.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8091cd1900a0437bb2510a03a6624d3ex1280x2560.JPEG"
    ]
  },
  {
    "text": "A surgery resident is examining a child born with the following defect. Which of the following statements regarding this defect is false?",
    "choices": [
      {
        "id": 1,
        "text": "The central defect of the abdominal wall may be more than 4 cm"
      },
      {
        "id": 2,
        "text": "This defect is usually not associated with other congenital anomalies"
      },
      {
        "id": 3,
        "text": "The overlying sac is made of amnion and peritoneum"
      },
      {
        "id": 4,
        "text": "This defect is a component of the Cantrell's pentalogy"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Omphalocele</strong> is usually <strong>associated</strong> with other<strong> congenital anomalies</strong> whereas gastroschisis is rarely associated with other congenital anomalies.</p>\n<p>Omphalocele refers to a congenital defect of the abdominal wall in which the bowel and solid viscera are <strong>covered</strong> by the <strong>peritoneum and amniotic membrane.</strong></p>\n<ul>\n<li>During normal development of the human embryo, the <strong>midgut herniates outward</strong> through the umbilical ring and continues to grow.\u00a0</li>\n<li>Between <strong>10th-12th week</strong> of gestation, the <strong>midgut returns</strong> to the coelomic cavity and undergoes <strong>proper rotation</strong> and fixation, along with the closure of the umbilical ring.\u00a0</li>\n<li>If the intestine fails to return, the infant is born with the abdominal contents protruding directly through the umbilical ring, with an <strong>intact sac</strong> covering the abdominal viscera, termed an <strong>omphalocele.</strong></li>\n</ul>\n<p>The sac is composed of an outer layer of <strong>amnion</strong> and an inner layer of <strong>peritoneum.</strong> It is seen in omphalocele and not in gastroschisis. Omphalocele can vary from a small defect with intestinal contents to a\u00a0<strong>giant omphalocele</strong> in which the abdominal wall defect <strong>measures 4 cm or more</strong> in diameter. It may even contain <strong>liver</strong>.</p>\n<p>Omphalocele occurs in association with special syndromes such as:</p>\n<ul>\n<li>There is a 60% to 70% incidence of associated anomalies, especially <strong>cardiac anomalies</strong> (20\u201340% of cases) and <strong>chromosomal abnormalities</strong>.</li>\n<li><strong>Exstrophy of the cloaca</strong> (vesicointestinal fissure)</li>\n<li>The <strong>Beckwith-Wiedemann constellation</strong> of anomalies (macroglossia, macrosomia, hypoglycemia, and visceromegaly and omphalocele)</li>\n<li>The<strong> Cantrell\u2019s pentalogy</strong> (lower thoracic wall malformations like cleft sternum, ectopia cordis, epigastric omphalocele, anterior midline diaphragmatic hernia, and cardiac anomalies).</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/dd1031e3767c4578bb4218b822780994.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 19-year-old lady delivered a neonate with the following defect. Which of the following statements about the defect is false?",
    "choices": [
      {
        "id": 1,
        "text": "The defect is generally located to the right of the umbilical cord"
      },
      {
        "id": 2,
        "text": "Herniation of liver is commonly associated with this condition"
      },
      {
        "id": 3,
        "text": "The incidence of this defect is more in preterm babies"
      },
      {
        "id": 4,
        "text": "Serial reduction of eviscerated intestines maybe done for management"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The above image shows&nbsp;<strong>gastroschisis.&nbsp;Herniation</strong> of the <strong>liver</strong> is more commonly seen with <strong>omphalocele</strong> than gastroschisis.</p>\n<p>Gastroschisis represents a congenital anomaly characterized by a defect in the anterior abdominal wall. The abdominal contents protrude through this defect. It is the most common anomaly seen in babies born to mothers under 20 years of age.&nbsp;Unlike omphalocele, there is <strong>no overlying sac</strong> and the <strong>size</strong> of the defect is usually <strong>&lt;4 cm</strong>.</p>\n<div class=\"page\" title=\"Page 1912\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<div class=\"page\" title=\"Page 1912\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>An <strong>orogastric tube</strong> is placed to decompress the stomach.&nbsp;For primary closure, bowel loops are reduced, fascia and skin are approximated.</p>\n</div>\n</div>\n</div>\n</div>\n<p>If the viscera cannot be reduced into the abdomen, a <strong>silo</strong> is placed at the bedside as shown in the image. The eviscerated intestines are <strong>reduced serially</strong> during 5 to 7 days, followed by operative fascial closure.</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/66e23ed2d8a04677a687845dc44ff12b.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f215eade544b45e1bbbcdd861f74d5f9x515x297.JPEG"
    ]
  },
  {
    "text": "The most common extracranial solid tumour in infants and children is  _______.",
    "choices": [
      {
        "id": 1,
        "text": "Neuroblastoma"
      },
      {
        "id": 2,
        "text": "Nephroblastoma"
      },
      {
        "id": 3,
        "text": "Medulloblastoma"
      },
      {
        "id": 4,
        "text": "Rhabdomyosarcoma"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Neuroblastoma</strong> is the most common<strong> extracranial solid</strong> tumour of childhood. While&nbsp;brain tumours&nbsp;are the most common solid tumour of childhood.</p>\n<p>Neuroblastoma is a <strong>malignancy</strong> of neuroblast cells in the <strong>adrenal medulla</strong> or <strong>sympathetic ganglia</strong> and typically presents as an abdominal or paravertebral mass.&nbsp;<strong>Raccoon eyes</strong> (periorbital ecchymoses) are seen in neuroblastoma due to orbital metastasis.&nbsp;</p>\n<p><strong>Shimada classification</strong> is used for classifying neuroblastoma.</p>\n<p>Blue subcutaneous nodules represent skin dissemination of tumour and are associated with the<strong>&nbsp;blueberry muffin syndrome</strong>.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/736863494fb54af3b00c83eaf0bbed82x720x508.PNG"
    ]
  },
  {
    "text": "The most common site of rhabdomyosarcoma in children is _______.",
    "choices": [
      {
        "id": 1,
        "text": "Genitourinary tract"
      },
      {
        "id": 2,
        "text": "Head and neck"
      },
      {
        "id": 3,
        "text": "Extremities"
      },
      {
        "id": 4,
        "text": "Abdomen"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The most <strong>common site</strong> of <strong>rhabdomyosarcoma</strong> in children is the<strong>&nbsp;head and neck.</strong></p>\n<p class=\"p1\">Rhabdomyosarcoma is the most common pediatric soft tissue sarcoma and accounts for approximately 3.5% of childhood cancers.</p>\n<p class=\"p1\">These tumours may occur at virtually any anatomic site but are usually found in the <strong>head and neck </strong>(25%), <strong>genitourinary tract </strong>(24%),&nbsp;<strong>extremities </strong>(19%) and <strong>orbit</strong> (9%). <strong>Retroperitoneum</strong> and other sites account for the remainder of primary sites.</p>\n<p><strong>Rhabdomyosarcomas</strong> are the most common soft tissue tumors among children younger than 15 years and can occur at any site comprised of striated muscle.</p>\n<p>Rhabdomyosarcoma is classified into <strong>three types&nbsp;</strong>- embryonal, alveolar, and pleomorphic.&nbsp;<strong>Embryonal rhabdomyosarcoma</strong> is the most common type.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The most common malignant brain tumor in children is ________.",
    "choices": [
      {
        "id": 1,
        "text": "Pilocytic astrocytoma"
      },
      {
        "id": 2,
        "text": "Oligodendroglioma"
      },
      {
        "id": 3,
        "text": "Ependymoma"
      },
      {
        "id": 4,
        "text": "Medulloblastoma"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Medulloblastoma</strong> is the most common <strong>malignant</strong> <strong>brain tumour</strong> in children.</p>\n<p>They are usually midline. Most of them occur in the cerebellum and present with symptoms of increased ICP.&nbsp;</p>\n<p>Most common tumours in children:</p>\n<ul>\n<li><strong>Brain tumours</strong> are the most common<strong> solid tumours.</strong></li>\n<li><strong>Pilocytic astrocytoma</strong> is the most common brain tumour (usually not malignant).</li>\n<li><strong>Neuroblastoma</strong> is the most common<strong> extracranial </strong>solid tumour.</li>\n<li><strong>Rhabdomyosarcomas</strong> are the most common <strong>soft tissue tumours.</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A female baby born at 30 weeks of gestation was admitted to NICU for prematurity and respiratory distress. She was placed on CPAP and enteric feeds were started. On day 5 of admission, she became lethargic and there was distension of the abdomen. A plain radiograph of the abdomen shows the following findings. Which statement about the condition is false?",
    "choices": [
      {
        "id": 1,
        "text": "Antenatal steroids have shown to reduce the occurrence of this condition"
      },
      {
        "id": 2,
        "text": "The radiograph depicts pneumatosis intestinalis"
      },
      {
        "id": 3,
        "text": "Modified Bell's staging can be used for this condition"
      },
      {
        "id": 4,
        "text": "Surgery is the treatment of choice for all stages"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The clinical scenario and radiological findings are indicative of&nbsp;<strong>necrotizing enterocolitis</strong> (NEC).&nbsp;<span style=\"font-size: 14px;\">The absolute indication for <strong>operative management</strong> of NEC is the presence of <strong>intestinal perforation.&nbsp;</strong></span>Milder cases can be treated with gut rest, antibiotics, and parenteral nutrition.&nbsp;</p>\n<p>The radiograph shows the presence of multiple air bubbles within the bowel wall. This is called <strong>pneumatosis intestinalis</strong>&nbsp;and is a pathognomonic sign suggestive of necrotizing enterocolitis.&nbsp;</p>\n<p><strong>Necrotizing enterocolitis&nbsp;</strong>is the necrosis of a portion of the bowel and is the most common gastrointestinal surgical emergency in the neonatal period.&nbsp;The single most important risk factor is <strong>prematurity</strong>. Other contributing factors are <strong>enteral feeding</strong>, ischemia, and infection. Administration of <strong>antenatal steroids</strong> is known to reduce the occurrence of NEC.</p>\n<p>It usually occurs in the first few days of life after the initiation of the enteral feeds. Some clinical features include:</p>\n<ul>\n<li>Lethargy</li>\n<li>Feeding intolerance</li>\n<li>Bloody stools</li>\n<li>Abdominal distension</li>\n<li>Abdominal tenderness.</li>\n</ul>\n<p>The radiograph may show pneumatosis intestinalis, portal venous gas, ascites, and the presence of free air.</p>\n<p>The<strong>&nbsp;modified Bell's criteria</strong> is used for staging the severity of NEC.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/cfc41dd66b2e4a2981d1161901976880.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 5-year-old child presents with jaundice and abdominal pain. On examination, there is a palpable mass in the right hypochondrium. MRCP reveals multiple dilatations limited to the intrahepatic bile ducts. Which of the following statements about this condition is false?",
    "choices": [
      {
        "id": 1,
        "text": "Todani classification is used for this condition"
      },
      {
        "id": 2,
        "text": "This condition is also known as Caroli's disease"
      },
      {
        "id": 3,
        "text": "Central dot sign is a characteristic CT finding associated with this condition"
      },
      {
        "id": 4,
        "text": "Endoscopic sphincterotomy followed by surveillance is the treatment of choice"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The arrows in the image given below are pointing to the <strong>central dot sign</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e1c15ea7bee94359a2a931c5612a991fx1279x1094.JPEG"
    ]
  },
  {
    "text": "A 10-year-old child came with complaints of pain over the right lower quadrant and lower back pain. On examination, the patient had pain over the right side of the hip on passive extension with a mass in the right lumbar region pointing towards the groin. What is the most probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Pyelonephritis"
      },
      {
        "id": 2,
        "text": "Psoas abscess"
      },
      {
        "id": 3,
        "text": "Appendicitis"
      },
      {
        "id": 4,
        "text": "Torsion of right undescended testis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Treatment is done by <strong>percutaneous CT-guided drainage</strong> and appropriate <strong>antibiotics</strong>.</p>\n<p>Other options:</p>\n<p>Option A: <strong>Pyelonephritis</strong> is usually associated with a history of urinary tract infection and sudden onset of pain in the flank and hypochondrium, not the lumbar region.</p>\n<p>Option C: <strong>Appendicitis (retrocaecal) </strong>can present with pain on passive extension of the hip (psoas sign), but the presence of a mass in the right lumbar region pointing towards the groin makes it an unlikely diagnosis.</p>\n<p>Option D: <strong>Testicular torsion</strong> is a surgical emergency condition presenting with sudden onset pain in the scrotum, groin and lower abdomen, tenderness, redness and edema of the scrotal skin.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/68f3f0abe1d74f1aad24091084f4f153x600x727.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/fc50a1d324ad42fba0bbc235e024ca24x287x210.PNG"
    ]
  },
  {
    "text": "A 3-year child is brought to the pediatrician for the evaluation of the lateral neck mass. On examination, a painless, soft, fluctuating mass is found in the lateral side of the neck, as shown in the image. The slip sign is negative, and the swelling is brilliantly transilluminant. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Cystic hygroma"
      },
      {
        "id": 2,
        "text": "Branchial cyst"
      },
      {
        "id": 3,
        "text": "Lipoma"
      },
      {
        "id": 4,
        "text": "Cervical lymphadenopathy"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>A soft, painless, brilliantly transilluminant, fluctuating mass found in the <strong>posterior part of the neck</strong> in a child, is most likely to be a <strong>cystic hygroma.</strong></p>\n<p>Cystic hygroma is a <strong>lymph-filled sac</strong> that results from the obstruction of the lymph vessels during their development. It is most commonly present in the <strong>posterior triangle of the neck</strong>. The mass may be apparent at birth or may appear in early childhood due to the increased accumulation of lymph. Since the sac is filled with lymph, it is soft, fluctuating, and <strong>brilliantly transilluminant.</strong></p>\n<p>Treatment:</p>\n<ul>\n<li><strong>Aspiration&nbsp;</strong>of the contents, followed by <strong>excision</strong> once the sac or capsule gets thickened by fibrous tissue.</li>\n<li>Single cysts can be treated with <strong>sclerosing therapy.</strong> Commonly used sclerosants include&nbsp;<strong>OK&ndash;432</strong> or <strong>Picibanil,</strong> which is a mixture of group A <em>Streptococcus pyogenes</em> strain, pure ethanol, interferon alpha-2a, and doxycycline.</li>\n<li><strong>Complete excision</strong> is done in case of <strong>multiple cysts.</strong></li>\n</ul>\n<p>Option B: A <strong>branchial cleft</strong> cyst also presents as soft fluctuant swelling. It is present in the <strong>anterior neck</strong> and at the <strong>junction</strong> of the <strong>upper third</strong> and <strong>middle third</strong> of the&nbsp;<strong>sternocleidomastoid muscle</strong>.</p>\n<p>Option C: <strong>Lipoma</strong> is less commonly seen in children. The swelling is <strong>non-fluctuant</strong> and when palpated, the edge slips under the finger. This is known as the <strong>slip sign.</strong></p>\n<p>Option D: Cervical lymphadenopathy is seen in children with infections of the parotid and upper respiratory tract infections. On palpation, they are <strong>firm</strong> and <strong>non-fluctuant</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/21262c2d5da547078124ddb7f91c6afc.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "The most common location of cystic hygroma is ________.",
    "choices": [
      {
        "id": 1,
        "text": "Axilla"
      },
      {
        "id": 2,
        "text": "Posterior triangle of neck"
      },
      {
        "id": 3,
        "text": "Anterior triangle of neck"
      },
      {
        "id": 4,
        "text": "Superior mediastinum"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Cystic hygroma</strong>, also known as cystic lymphangioma and macrocystic lymphatic malformation, is a congenital <strong>multiloculated lymphatic lesion&nbsp;</strong>that can arise anywhere but is classically found in the <strong>left posterior triangle</strong> of the <strong>neck</strong>.</p>\n<p>The other common sites are the axillary, mediastinal, inguinal, and retroperitoneal regions.&nbsp;It occurs as a result of sequestration or obstruction of developing lymph vessels. The cysts are lined by endothelium and filled with lymph.</p>\n<p>The image below shows a newborn with cystic hygroma on the right side of the neck.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://cdn1.dailyrounds.org/uploads/72f7847e8e4f4f2c85924626399346e6x441x410.PNG"
    ]
  },
  {
    "text": "A 15-year-old girl presented with a slow-growing, rubbery, non-tender swelling on the side of the neck as shown in the image. Examination shows the presence of freckles and skin patches over the face and trunk. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Cystic hygroma"
      },
      {
        "id": 2,
        "text": "Chemodectoma"
      },
      {
        "id": 3,
        "text": "Neural tumor"
      },
      {
        "id": 4,
        "text": "Lipoma"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>A lateral neck mass in a pediatric patient, which is non-tender and present in association with&nbsp;freckles, and hyperpigmented skin patches <strong>(cafe-au-lait spots)&nbsp;</strong>is suggestive of <strong>neural tumor</strong> i.e. <strong>neurofibroma</strong>.&nbsp;</p>\n<p>Neurofibroma is a benign tumor arising from the connective tissue of the nerve containing ectodermal, neural and mesodermal connective tissue components. It can be single or multiple. It is the <strong>most common intradural extramedullary spinal tumor</strong>. Neurofibromas can be local, generalized (von Recklinghausen's disease) or plexiform types. Patients present with mild pain or a painless swelling usually in the subcutaneous or cutaneous plane with tingling, numbness and paraesthesia along the distribution of the nerve. Complications of neurofibroma include cystic degeneration, erosion into deeper planes, cord compression and paralysis (spinal neurofibroma) and sarcomatous changes.</p>\n<p>Treatment is excision under general or regional anesthesia. Indications for surgery in neurofibroma include symptomatic patients (pain and pressure symptoms), cosmetic problems and malignant transformation (5%).</p>\n<p>Option A:<strong> Cystic hygroma</strong> is&nbsp;a type of <strong>congenital</strong> lymphangioma. This&nbsp;<strong>swelling is soft</strong> and partially compressible, which shows <strong>positive fluctuation and translucency test</strong>.</p>\n<p>Option B:<strong> Chemodectoma</strong> or carotid body tumor is a rare tumor, most commonly present in the <strong>fifth decade</strong> and there is an association with pheochromocytoma. These patients usually present with a slowly enlarging, painless lump at the <strong>carotid bifurcation.</strong></p>\n<p>Option D: A <strong>lipoma</strong> is a soft painless swelling. It shows the characteristic <strong>slip sign</strong> and is <strong>freely mobile.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3c5ef7fa034a403f80b7693720191e30.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A  first-born, 5-weeks-old male infant presents with non-bilious projectile vomiting. The abdominal radiograph shows the following finding. Which of the following will be the preferred investigation in this case?",
    "choices": [
      {
        "id": 1,
        "text": "CT abdomen"
      },
      {
        "id": 2,
        "text": "Ultrasound examination"
      },
      {
        "id": 3,
        "text": "Barium studies"
      },
      {
        "id": 4,
        "text": "Rectal manometry"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The ultrasound image given above shows redundant pyloric mucosa protruding into the antrum -&nbsp;<strong>Antral nipple sign</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/699627db0fd1456998bcfb149891afff.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/da2da777a3c44973874db75cd1deb7b8x481x496.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3e1a65d52c4e4fe0b7d946225515da0ax595x630.JPEG"
    ]
  },
  {
    "text": "A 2-month-old baby is brought to the outpatient department for a facial defect. On examination, the following findings were noticed. The soft and the hard palate are intact. Which of the following is the most appropriate management in this child?",
    "choices": [
      {
        "id": 1,
        "text": "Cleft lip repair immediately"
      },
      {
        "id": 2,
        "text": "Cleft lip repair at 9 to 12 months"
      },
      {
        "id": 3,
        "text": "Cleft lip repair at 4 to 6 months"
      },
      {
        "id": 4,
        "text": "Cleft lip repair at 12-15 months"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<ol style=\"list-style-type: lower-alpha;\">\n<li style=\"font-weight: 400;\">Unilateral cleft lip with alveolar involvement</li>\n<li style=\"font-weight: 400;\">Bilateral cleft lip with alveolar involvement</li>\n<li style=\"font-weight: 400;\">Unilateral cleft lip associated with cleft palate</li>\n<li style=\"font-weight: 400;\">Bilateral cleft lip and palate</li>\n<li style=\"font-weight: 400;\">Cleft palate only</li>\n</ol>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/0654a1e33b1e44a899655e4403f0cb7f.jpeg"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/364b499ac1cf4032820cae789aab36dex600x336.JPEG"
    ]
  }
];
        let quizName = '04 Paediatric Surgery';
        let hierarchy = ["Marrow", "qBank", "Surgery"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>