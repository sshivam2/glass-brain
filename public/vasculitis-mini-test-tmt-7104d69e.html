<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vasculitis Mini Test - -Tmt - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2024-25
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A 52-year-old woman presented to the hospital with malaise, pain abdomen, and blood in the stools. On examination, the patient also has foot drop. Laboratory investigations reveal anemia, elevated ESR, and negative ANCA. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Polyarteritis nodosa"
      },
      {
        "id": 2,
        "text": "Takayasu arteritis"
      },
      {
        "id": 3,
        "text": "Cogan's syndrome"
      },
      {
        "id": 4,
        "text": "Wegener's granulomatosis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The most likely diagnosis in the given clinical scenario is <strong>polyarteritis nodosa</strong>. The presence of <strong>foot drop</strong> is highly suggestive of <strong>mononeuritis</strong> <strong>multiplex</strong>. Mononeuritis multiplex in combination with malaise, pain abdomen, blood in the stools, anemia, elevated ESR, and <strong>negative ANCA</strong> is highly suggestive of polyarteritis nodosa.</p>\n<div class=\"page\" title=\"Page 876\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Polyarteritis nodosa is necrotizing arteritis involving medium-sized vessels. It may present insidiously with fever, malaise, weight loss, arthralgia, myalgia, or neuropathy.<strong> Mononeuritis multiplex</strong> is most commonly seen as a <strong>foot drop</strong>. Patients also develop symptoms related to vasculitis of a particular organ system. Cutaneous manifestations are skin ulcers,\u00a0<strong>digital gangrene,</strong>\u00a0and <strong>livedo reticularis</strong>. Renal involvement is common and manifests as hypertension or renal failure. GI involvement presents as abdominal pain, nausea and vomiting, bleeding, bowel infarction, and perforation.</p>\n<p>There are no specific serologic tests. Laboratory investigations reveal <strong>anemia, leukocytosis, elevated ESR</strong>. Patients with classic polyarteritis nodosa are <strong>negative</strong> for <strong>ANCA</strong>. Diagnosis is confirmed only by confirming vasculitis on biopsy.</p>\n<p>Other options:</p>\n<p>Option B:<strong> Takayasu arteritis</strong>\u00a0is an inflammatory and stenotic disease of medium- and large-sized arteries- usually aortic arch and its branches. It is\u00a0suspected in a young woman with decreased or <strong>absent peripheral pulses</strong>, <strong>blood pressure discrepancies</strong>, and arterial <strong>bruits</strong>. There is elevated ESR, mild anemia, and <strong>elevated</strong> <strong>immunoglobulin</strong> levels. Diagnosis is confirmed with <strong>arteriography</strong>.</p>\n<p>Option C:\u00a0<strong>Cogan's syndrome</strong> is characterized by <strong>interstitial keratitis</strong> and <strong>vestibulo-auditory symptoms</strong>. Vasculitis of aorta and aortic valve may also be associated.</p>\n<p>Option D:\u00a0<strong>Wegener's granulomatosis\u00a0</strong>is a granulomatous vasculitis of the upper and lower respiratory tracts with glomerulonephritis. Laboratory findings include a markedly elevated ESR, mild anemia, leukocytosis, hypergammaglobulinemia, elevated rheumatoid factor. <strong>ANCA</strong> is usually <strong>positive</strong>.\u00a0</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 33-year-old female patient comes to the clinic with painful lesions on her lower limbs as seen below. Further evaluation shows an association with the HLA -B51 haplotype. What is the characteristic histopathological finding in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Segmental transmural fibrinoid necrosis of the medium sized vessels"
      },
      {
        "id": 2,
        "text": "Necrotizing granulomas with giant cells and leukocytic infiltrate in medium sized vessels"
      },
      {
        "id": 3,
        "text": "Neutrophilic predominant infiltrate in a perivascular distribution in small and medium vessels"
      },
      {
        "id": 4,
        "text": "Luminal thrombosis with micro abscesses in the small sized arteries"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical vignette describes a case of <strong>Behcet's disease</strong> which is a <strong>small-to-medium vessel neutrophilic vasculitis</strong>. The image shows <strong>erythema nodosum</strong> which is a painful, acute, erythematous eruption that is limited to the extensor aspects of the extremities. Pathological examination of the lesions will show <strong>lobular or mixed lobular and septal panniculitis</strong>. The histopathological findings will be\u00a0<strong>neutrophilic predominant infiltrate </strong>in a <strong>perivascular distribution</strong> in small and medium vessels.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/43a124d038de4d8b9e9086c341c27bbe.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 55-year-old female presents with a left-sided temporal headache and jaw claudication. She has also recently been having fatigue, malaise, and a mild fever. Gentle pressure on the scalp elicits focal tenderness. ESR is elevated. Diagnosis is made based on a temporal artery biopsy. Which of the following is most commonly associated with this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Aortic aneurysm"
      },
      {
        "id": 2,
        "text": "Coarctation of aorta"
      },
      {
        "id": 3,
        "text": "Berry aneurysm"
      },
      {
        "id": 4,
        "text": "Peripheral artery disease"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The clinical vignette describes a case of <strong>giant cell arteritis</strong>. <strong>Aortic aneurysms</strong> are commonly associated with this condition.</p>\n<p><strong>Giant Cell Arteritis - </strong>It is an inflammatory disroder of medium to large vessels and occurs due to infiltration of T cells and macrophages<strong>.</strong></p>\n<p><strong>Clinical features -&nbsp;Constitutional symptoms</strong> such as&nbsp;fever, fatigue, and weight loss.&nbsp;Classically, <strong>headaches</strong> due to GCA are located over the <strong>temples</strong>. Other findings include <strong>jaw claudication, transient/permanent vision loss, </strong>and<strong> polymyalgia rheumatica&nbsp;</strong>which presents as the stiffness of the hips and shoulders. Additionally, large vessel involvement commonly presents as <strong>aneurysms of the aorta</strong> that may dissect.&nbsp;Large vessels like vertebral artery, aortic artery and ophthalmic artery are affected resulting in aortitis, aortic aneurysm, diplopia and sometimes complete loss of vision.&nbsp;</p>\n<p><strong>Physical exam findings - Diminished pulses</strong> and <strong>discrepant blood pressure</strong> in the arms can occur and the <strong>temporal or other cranial arteries can be tender or thickened</strong>.</p>\n<p>Diagnosis -&nbsp;<strong>ESR</strong> is generally highly<strong> elevated</strong>. A <strong>temporal artery biopsy</strong> is used to confirm the diagnosis. Biopsy shows pan-arteritis, often most pronounced in the media, composed of CD4+ lymphocytes and macrophages</p>\n<p>Treatment -<strong>&nbsp;</strong>The mainstay of treatment is <strong>glucocorticoids</strong>. Oral glucocorticoids may be tried if there is no visual loss but in the presence of visual loss IV glucocorticoid pulses must be administered.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 63-year-old woman presents with a right-sided headache for 2 weeks along with jaw pain. It has progressively increased in severity. Of late, she also has a loss of appetite, malaise, and fatigue. She also has a history of stiffness and pain in her shoulders and hip, which has disabled her from doing household chores. On examination, the patient appears pale and the temperature is 99.8F. Gentle pressure on the scalp elicits focal tenderness.  ESR is elevated. What is the next best step in the management of this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Sumatriptan"
      },
      {
        "id": 2,
        "text": "Vascular imaging"
      },
      {
        "id": 3,
        "text": "Perform temporal artery biopsy"
      },
      {
        "id": 4,
        "text": "Start steroids"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>This patient's clinical scenario is suggestive of <strong>giant cell arteritis</strong> with <strong>polymyalgia rheumatica</strong>. The patient should be immediately started on <strong>steroids</strong>.&nbsp;</p>\n<p>Giant cell arteritis (GCA), also known as <strong>temporal arteritis</strong> is an inflammation of medium and large-sized vessels. It is more common in <strong>women</strong> and in people aged <strong>&gt;50 years</strong>.</p>\n<p>The clinical features include headache associated with scalp pain and jaw claudication, fever, fatigue, malaise, and weight loss. Half of the patients have signs of superficial temporal artery inflammation, including erythema, pain on palpation, nodularity, thickening, or reduced pulsation on the affected side.&nbsp;Gentle pressure on the scalp may elicit focal or generalized tenderness.&nbsp;It is very commonly associated with polymyalgia rheumatica characterized by morning stiffness and pain around the shoulders and hip.&nbsp;</p>\n<p>A dreaded complication is <strong>ischemic optic neuropathy</strong>, which can lead to&nbsp;<strong>sudden blindness</strong>. Therefore, patients with a clinical diagnosis of GCA, especially with headaches or visual symptoms should immediately be started on steroids. Else damage may be irreversible if treatment is delayed beyond 48 hours.</p>\n<p>The diagnosis can be confirmed by <strong>temporal artery biopsy</strong>. It may not be positive in all patients, due to patchy involvement of the vessels. Obtaining a biopsy segment of 3-5 cm with serial sectioning may yield a positive result. A color doppler ultrasound can be used as an alternative to temporal artery biopsy.&nbsp;</p>\n<p>Newer drugs used in the treatment of giant cell arteritis are <strong>tocilizumab </strong>(anti-IL-6 receptor) and<strong> abatacept </strong>(CTLA4-Ig).</p>\n<p>Other options:</p>\n<p>Option A: <strong>Sumatriptan</strong> is used in the treatment of <strong>migraine</strong> headaches. Although migraine headaches commonly present with unilateral headache, the other clinical features in this patient are suggestive of GCA.</p>\n<p>Option B: There is a limited role of vascular imaging in the diagnosis of GCA. Additionally, the patient must be started on steroids without awaiting diagnostic confirmation when GCA is suspected.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The reagent used in the pathergy test is",
    "choices": [
      {
        "id": 1,
        "text": "Killed  Bartonella henselae"
      },
      {
        "id": 2,
        "text": "Metabisulphite"
      },
      {
        "id": 3,
        "text": "Normal saline"
      },
      {
        "id": 4,
        "text": "Purified protein derivative"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The reagent used in the pathergy test is <strong>normal saline.</strong></p>\n<p><strong>Pathergy test&nbsp;</strong>is the nonspecific skin inflammatory reaction to <strong>intradermal saline injection.&nbsp;</strong>This test is positive in <strong>Behcet disease.&nbsp;</strong></p>\n<p>The diagnostic criterion in Behcet's syndrome is the presence of <strong>recurrent oral ulcerations</strong> <strong>plus two</strong> of the following:</p>\n<ul>\n<li>Recurrent genital ulceration</li>\n<li>Ocular lesions</li>\n<li>Skin lesions</li>\n<li>Positive pathergy test</li>\n</ul>\n<p>Other options:</p>\n<p>Option A- Intradermal injection of <strong>killed Bartonella henselae</strong> is done in the&nbsp;<strong>Foshay test.</strong> It is positive in <strong>cat scratch disease.</strong></p>\n<p>Option B- <strong>Metabisulphite</strong> is used as a food preservative. It is thought to trigger <strong>asthma.</strong></p>\n<p>Option C- <strong>Purified protein derivative&nbsp;</strong>of mycobacterium is used in the <strong>tuberculin test.</strong>&nbsp;One tuberculin unit is injected intradermally on the flexor aspect of the forearm and a reading is taken after 48h (Mantoux method).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 2-year-old child was brought to the hospital with complaints of fever, rash, and swelling of her hands and feet for the past 5 days. There is desquamative skin rash, edema of hands and feet, and cervical lymphadenopathy. Changes in the tongue and hands are as shown in the image.  Which of the following is not a complication of the given condition?",
    "choices": [
      {
        "id": 1,
        "text": "Thrombocytopenia"
      },
      {
        "id": 2,
        "text": "Myocardial infarction"
      },
      {
        "id": 3,
        "text": "Hydrops of gall bladder"
      },
      {
        "id": 4,
        "text": "Sterile pyuria"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario and the image are suggestive of <strong>Kawasaki</strong> <strong>disease</strong> or <strong>mucocutaneous</strong> <strong>lymph</strong> <strong>node</strong> <strong>syndrome</strong>. The complication <strong>not seen</strong> in Kawasaki disease is <strong>thrombocytopenia</strong>.</p>\n<p>Kawasaki disease is an <strong>acute febrile illness</strong> associated with <strong>arteritis</strong> of <strong>medium to large-sized vessels.&nbsp;</strong>It is commonly seen in <strong>infants</strong> and <strong>children</strong> <strong>&lt;4 years</strong> of age.</p>\n<p>Complications include:</p>\n<ul>\n<li>Coronary artery aneurysms and thrombosis</li>\n<li><strong>Myocardial infarction</strong> due to stenosis of the coronary artery at the site of aneurysm</li>\n<li><strong>Hydrops of gall bladder</strong></li>\n<li><strong>Sterile pyuria</strong> (urethritis)</li>\n<li>Arthritis</li>\n<li>Aseptic meningitis</li>\n<li><strong>Thrombocytosis</strong> (late)</li>\n<li>Diarrhea</li>\n<li>Peripheral aneurysms and gangrene.</li>\n</ul>\n<p>Clinical features include<strong>:</strong></p>\n<ul>\n<li>Fever</li>\n<li><strong>Conjunctival&nbsp;and oral erythema</strong></li>\n<li>Blistering, edema of hands and feet</li>\n<li>Erythema of palms and soles</li>\n<li><strong>Desquamative</strong> <strong>rash</strong></li>\n<li><strong>Cervical lymphadenopathy</strong></li>\n</ul>\n<p>The disease is usually <strong>self-limiting</strong>. In some cases, the disease may involve the coronary artery leading to <strong>thrombosis</strong> and <strong>acute</strong> <strong>myocardial</strong> <strong>infarction</strong>. <strong>Intravenous</strong> <strong>immunoglobulin</strong> and <strong>aspirin</strong> may be given to reduce the risk of coronary artery disease.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c54e85f911704be09ba6aedbf41d8f21.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 60 year-old-woman comes with complaints of sudden onset blindness of the right eye, with throbbing headache in the right temporal region associated with jaw claudication. On examination, a thickened tender cord-like structure can be felt in the temple. Temporal artery biopsy shows the following. Which among the following is true about this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Lesions are distributed throughout the entire length of the artery"
      },
      {
        "id": 2,
        "text": "Classic lesions exhibit medial granulomatous inflammation"
      },
      {
        "id": 3,
        "text": "T cell infiltrates are predominantly CD8+"
      },
      {
        "id": 4,
        "text": "Fragmentation is seen in external elastic lamina"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario and histology image is suggestive of <strong>giant cell/temporal arteritis</strong>.&nbsp;Classic lesions exhibit <strong>medial</strong>&nbsp;<strong>granulomatous inflammation</strong>.</p>\n<p><strong>Giant cell/temporal arteritis&nbsp;</strong>is a chronic inflammatory disorder of large to small-sized arteries that especially affects the<strong>&nbsp;</strong>arteries of the head.<strong>&nbsp;</strong>It is seen in&nbsp;people<strong> over 50 years of age</strong>.</p>\n<p>It can affect the following arteries:</p>\n<ul>\n<li>Superficial temporal artery: Intense facial pain or&nbsp;headache along the course of the artery</li>\n<li>Ophthalmic arteries:&nbsp;Sudden and permanent diplopia or blindness</li>\n<li>Aorta:&nbsp;Giant-cell aortitis</li>\n<li>Vertebral arteries</li>\n</ul>\n<p>A <strong>biopsy</strong> is needed to confirm the diagnosis. However, a negative biopsy cannot exclude the diagnosis of giant cell arteritis because the lesions are<strong> focally distributed</strong>, leaving long segments of the artery normal. Hence, the biopsy sample may be taken from the normal part of the artery, leading to a false-negative report. For the same reason, an adequate&nbsp;biopsy requires at least a<strong> 1-cm segment</strong>.</p>\n<p>Biopsy findings of giant cell arteritis include:</p>\n<ul>\n<li>Classic lesions are primarily <strong>medial granulomatous inflammation</strong>.</li>\n<li>These lesions involve the<strong> internal elastic lamina</strong>,&nbsp;leading to&nbsp;<strong>elastic lamina fragmentation</strong>.</li>\n<li>There is<strong> intimal thickening </strong>that reduces the luminal diameter.</li>\n<li>There is an infiltrate with<strong> T cells </strong>(<strong>CD4+ &gt; CD8+</strong>), macrophages, and&nbsp;multinucleated giant cells (75% of specimens).</li>\n</ul>\n<p>The image below shows giant cell arteritis with intimal thickening and internal elastic lamina fragmentation:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/f5d2de3163ea4668b4981213df663796.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d1f97d1accf94d96ba346ce5c7d751c9x1280x950.JPEG"
    ]
  },
  {
    "text": "An 18-year-old male patient presents with the findings shown below, which he says occur recurrently. He also has similar lesions on his scrotum and complains of redness and pain in his eyes. Which of the following is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Cogan's syndrome"
      },
      {
        "id": 2,
        "text": "Sj\u00f6gren's syndrome"
      },
      {
        "id": 3,
        "text": "Behcet's syndrome"
      },
      {
        "id": 4,
        "text": "SAPHO syndrome"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The most likely <strong>diagnosis</strong> in this young man with recurrent oral and genital ulcers, as well as eye involvement, is&nbsp;<strong>Behcet's syndrome</strong>.</p>\n<p>Behcet's syndrome is a vasculitic disorder that presents with <strong>recurrent oral</strong> and <strong>genital ulcerations</strong> and <strong>ocular involvement.&nbsp;</strong>It is a multisystem inflammatory disorder with a known association with <strong>HLA B*51</strong>.&nbsp;</p>\n<p>This syndrome commonly presents in <strong>young people,</strong>&nbsp;with males having more severe disease. These patients present with <strong>recurrent oral aphthous ulcers</strong> that are usually small and <strong>painful</strong>, <strong>painful genital ulcers</strong>, <strong>skin lesions</strong> (folliculitis, erythema nodosum, positive pathergy test, etc.), <strong>uveitis, </strong>arthritis/arthralgia, deep vein thromboses, etc.</p>\n<p>To <strong>diagnose</strong> a patient with this condition, they must present with <strong>recurrent oral ulceration</strong> in <strong>addition to 2 of the following&nbsp;</strong>- <strong>genital ulcers/ocular involvement/skin lesions/positive pathergy test</strong>.</p>\n<p>Topical <strong>glucocorticoids</strong> can be used to manage oral and skin lesions, but ocular involvement can often only be managed with intravenous steroids, azathioprine, and cyclosporine.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/96adf4f344704308be6af0570b523eef.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following are examples of anti neutrophilic cytoplasmic antibody-associated vasculitides?",
    "choices": [
      {
        "id": 1,
        "text": "2, 4 and 6"
      },
      {
        "id": 2,
        "text": "1, 3 and 5"
      },
      {
        "id": 3,
        "text": "2, 3 and 6"
      },
      {
        "id": 4,
        "text": "1, 4 and 5"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Antineutrophilic cytoplasmic antibody <strong>(ANCA)</strong> associated vasculitides include:</p>\n<ul>\n<li>Granulomatosis with polyangiitis (Wegener granulomatosis)</li>\n<li>Eosinophilic granulomatosis with polyangiitis (Churg-Strauss syndrome)</li>\n<li>Microscopic polyangiitis</li>\n</ul>\n<p><strong>Other</strong> <strong>ANCA</strong>-associated diseases are <strong>drug</strong>-<strong>induced</strong> <strong>vasculitis</strong> and <strong>renal limited</strong> <strong>vasculitis</strong>.</p>\n<div class=\"page\" title=\"Page 2\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Small vessel vasculitides are either ANCA-associated vasculitides or immune complex vasculitides.</p>\n<ul>\n<li><strong>Immune complex</strong> vasculitides can be caused by:\n<ul>\n<li><strong>Infections</strong>: Hepatitis B, Hepatitis C, Human Immune deficiency virus (HIV), or endocarditis.</li>\n<li><strong>Autoimmune</strong> conditions such as SLE, rheumatoid arthritis, and Sj\u00f6gren syndrome.\u00a0</li>\n<li><strong>ANCA-associated vasculitides</strong> show little or <strong>no immune complex</strong> deposition and are known as\u00a0<strong>pauci-immune vasculitides.</strong></li>\n</ul>\n</li>\n</ul>\n<p>Granulomatosis with polyangiitis (<strong>Wegener granulomatosis</strong>) involves <strong>upper</strong> and <strong>lower</strong> <strong>respiratory</strong> <strong>tracts</strong> and <strong>kidney</strong>. Symptoms of the upper respiratory tract include bloody nasal discharge, nasal ulceration, sinusitis, and chronic otitis media, characteristic <strong>saddle nose deformity</strong> due to damage to the nasal cartilage. Symptoms of the lower respiratory tract include lung nodules and alveolar hemorrhage. Renal symptoms include high blood pressure, proteinuria, hematuria and a rapidly progressive renal failure. A <strong>c-ANCA</strong> pattern with <strong>positive anti-PR3 antibodies</strong> is seen. Lung biopsy will show evidence of vasculitis and <strong>necrotizing granuloma formation</strong>, which is characteristic of this disease. Granulomas are <strong>absent</strong> in the<strong> kidney biopsy.</strong></p>\n<p><strong>Microscopic polyangiitis </strong>causes small-vessel necrotizing vasculitis without granuloma formation. Glomerulonephritis and acute renal failure are the common manifestations. <strong>Anti-MPO antibodies</strong> positivity with a <strong>p</strong>-<strong>ANCA</strong> pattern is seen. Kidney biopsy will show vasculitis of the capillaries <strong>without granuloma</strong> formation and crescentic glomerulonephritis. Lung involvement is less common.</p>\n<p><strong>Eosinophilic granulomatosis with polyangiitis (Churg-Strauss syndrome) </strong>involves the skin, cardiac and gastrointestinal tract and peripheral nervous system with associated eosinophilia. Biopsy shows <strong>necrotizing vasculitis</strong> with <strong>eosinophilic infiltrates</strong> and eosinophilic granulomas.</p>\n<p><strong>Drug-induced</strong>\u00a0vasculitis may be seen with drugs such as <strong>indomethacin,</strong> <strong>ATT</strong> drugs like rifampicin and isoniazid, and <strong>anti-hyperthyroid drugs</strong> like propylthiouracil, methimazole, carbimazole</p>\n<div class=\"section\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<div class=\"page\" title=\"Page 3\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>The assessment of <strong>disease activity</strong> includes assessment of i<strong>nflammatory markers,\u00a0</strong><strong>ANCA antibodies </strong>and <strong>renal function tests</strong> like urea and electrolytes, urine protein quantification, urine microscopy.</p>\n<p><strong>Disease activity</strong> can be monitored with tools like <strong>Birmingham Vasculitis Activity Score</strong> (BVAS).</p>\n<div class=\"page\" title=\"Page 3\">\n<div class=\"section\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Treatment</strong> involves:</p>\n<ul>\n<li><strong>Induction</strong> of remission to avoid or slow down organ involvement by <strong>cyclophosphamide</strong> in addition to <strong>high-dose steroids</strong>.</li>\n<li><strong>Plasma exchange</strong> or <strong>intravenous rituximab</strong> can be used for the same.</li>\n<li><strong>Rituximab</strong> is superior to cyclophosphamide in disease <strong>relapse</strong>.</li>\n<li><strong>Maintenance</strong> of remission is usually done by either <strong>methotrexate</strong> or <strong>azathioprine</strong>.</li>\n</ul>\n</div>\n</div>\n</div>\n</div>\n</div>\n<div class=\"page\" title=\"Page 4\">\u00a0</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A middle-aged woman presents with hemoptysis, red-colored urine, and frequent sinusitis. Her blood reports revealed anemia, leucocytosis, and elevated erythrocyte sedimentation rate. Serology is positive for antiproteinase-3 ANCA. Her chest x-ray is given below. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Goodpasture's syndrome"
      },
      {
        "id": 2,
        "text": "Microscopic polyangiitis"
      },
      {
        "id": 3,
        "text": "Henoch-Schonlein purpura"
      },
      {
        "id": 4,
        "text": "Granulomatosis with polyangiitis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>This patient has the involvement of the&nbsp;<strong>upper respiratory tract</strong>&nbsp;(frequent sinusitis),&nbsp;<strong>lower respiratory tract</strong>&nbsp;(hemoptysis), and&nbsp;<strong>kidneys</strong>&nbsp;(hematuria), and an <strong>x-ray</strong>&nbsp;shows the presence of a&nbsp;<strong>cavity</strong>&nbsp;in the right lung. These, along with laboratory features and positivity for&nbsp;antiproteinase-3 ANCA&nbsp;(cANCA)&nbsp;suggest that the most likely diagnosis is&nbsp;<strong>granulomatosis with polyangiitis </strong>(GPA).</p>\n<p>GPA is a type of vasculitis&nbsp;characterized by <strong>necrotizing granulomas</strong> in the upper and lower respiratory tract, and small and medium vessels. Also, necrotizing crescentic glomerulonephritis is present in the condition.</p>\n<p>Clinically, they present with fever, purulent rhinorrhea, nasal ulcers, sinus pain, saddle nose, polyarthralgia, cough, hemoptysis, breathlessness, hematuria, and proteinuria. Occasionally, cutaneous purpura and mononeuritis complex may be present.</p>\n<p><strong>Antiproteinase 3-ANCA or antineutrophilic cytoplasmic antibody (cANCA)&nbsp;</strong>is seen in 95% of patients and is a useful marker of disease activity.</p>\n<p>Management is as follows:</p>\n<ul>\n<li>Induction with <strong>cyclophosphamide and glucocorticoids</strong> for <strong>severe</strong> disease. This is stopped after 3-6 months and can be switched to rituximab, azathioprine, methotrexate, and mycophenolate mofetil for the remission.</li>\n<li>Induction with <strong>rituximab and glucocorticoids</strong> is also effective in&nbsp;<strong>severe</strong> disease.</li>\n<li>For a <strong>non-severe</strong> disease, <strong>methotrexate or mycophenolate mofetil</strong> along with <strong>glucocorticoids</strong> is effective for induction as well as remission.</li>\n</ul>\n<p>Other options:</p>\n<p>Options A - In&nbsp;<strong>Goodpasture's syndrome </strong>(pulmonary-renal syndrome),<strong> anti-GBM&nbsp;</strong>autoantibodies are formed against the <strong>glomerular basement membrane</strong>. Younger patients present with hemoptysis, fever, dyspnea, and hematuria while older people present with isolated glomerulonephritis.</p>\n<p>Option B - <strong>Microscopic polyangiitis</strong>&nbsp;mainly involves the small arterioles and venules. The presentation is similar to GPA. However, they do not have upper airway disease or pulmonary nodules. They have<strong>&nbsp;mainly MPO antibodies</strong> or<strong> P-ANCA positivity</strong>. The distinction can be made on<strong>&nbsp;</strong>a <strong>biopsy</strong> where microscopic polyangiitis would have vasculitis <strong>without granulomas</strong>.&nbsp;</p>\n<p>Option C - <strong>Henoch-Schonlein purpura</strong> is a small vessel vasculitis that has&nbsp;<strong>palpable purpura</strong> over the buttocks and lower extremities, arthralgia, gastrointestinal symptoms, and glomerulonephritis. It is commonly seen in <strong>children</strong> and the mechanism is immune complex deposition with <strong>IgA antibody.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/9bc8238b07f247a0b9a757d5ae9c0efa.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 28-year-old woman presented with complaints of double vision, frequent falls, and numbness of both hands. On examination, the radial pulses were not palpable, but the femoral pulses were palpable. An aortic arch angiogram was done, which revealed the following finding. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Polyarteritis Nodosa"
      },
      {
        "id": 2,
        "text": "Takayasu's arteritis"
      },
      {
        "id": 3,
        "text": "Aortic dissection"
      },
      {
        "id": 4,
        "text": "Kawasaki Disease"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The clinical features and the aortic angiogram showing areas of stenosis in multiple great vessels arising from the aortic arch is suggestive of<strong> Takayasu's arteritis, </strong>also known as the pulseless disease<strong>.</strong></p>\n<p><strong>Takayasu's arteritis&nbsp;</strong>is a granulomatous vasculitis affecting medium and large-sized arteries, in this case, the&nbsp;<strong>aortic arch</strong> and its <strong>branches.</strong>&nbsp;Clinical manifestations include <strong>vision&nbsp;disturbances</strong> and profound&nbsp;<strong>weakening of the pulses</strong>, especially in the upper <strong>extremities</strong>.&nbsp;</p>\n<div class=\"page\" title=\"Page 518\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Disease pathology is characterized by transmural fibrous thickening of the aorta. The branches of the aortic arch, when involved, are markedly narrowed or even obliterated, causing absent pulses in the upper extremities.&nbsp;</p>\n<p>In some cases, there may also be involvement of other vessels such as the&nbsp;<strong>pulmonary</strong>, <strong>coronary</strong>, and <strong>renal</strong>&nbsp;arteries.</p>\n<p><strong>Histopathology:</strong></p>\n<ul>\n<li>Irregular thickening of the vessel wall is seen with associated&nbsp;<strong>intimal hyperplasia.</strong>&nbsp;</li>\n<li>Characteristic&nbsp;<strong>granulomatous inflammation,</strong> with the presence of&nbsp;<strong>giant cells</strong> and patchy <strong>medial necrosis.</strong></li>\n<li>Disease progression is associated with&nbsp;<strong>collagenous scarring </strong>and&nbsp;chronic inflammatory infiltrates across all layers of the vessel wall.</li>\n</ul>\n<p>Other options:</p>\n<p>Option a-&nbsp;<strong>Polyarteritis Nodosa</strong> is a vasculitis affecting small or medium-sized muscular arteries. It is often seen in renal and visceral vessels, with exception of the pulmonary arteries. Clinical features result from ischemia and infarction of affected tissues and organs.</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/1a758e8953984de1b8ddeb28db2926ec.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3e27ff54731a4708873b8c7b6fac4be1x1280x482.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/451be28d924943bb9b94ea8b121887edx572x578.PNG"
    ]
  },
  {
    "text": "A 35-year-old male patient presents with abdominal pain, bloody stools, and a tingling sensation in his hands and feet. He is hypertensive and investigations reveal elevated erythrocyte sedimentation rate, negative antineutrophil cytoplasmic antibody, and fibrinoid necrosis on skin tissue biopsy. Which of the following is true about his condition?",
    "choices": [
      {
        "id": 1,
        "text": "Involves pulmonary arteries"
      },
      {
        "id": 2,
        "text": "Hypogammaglobulinemia is seen"
      },
      {
        "id": 3,
        "text": "Eosinophilia is commonly seen"
      },
      {
        "id": 4,
        "text": "Can be associated with Hepatitis B"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The above clinical scenario of a hypertensive male with <strong>peripheral neuropathy</strong>, abdominal <strong>pain</strong>, bloody stools, and <strong>elevated ESR</strong> with <strong>negative C- ANCA</strong> is suggestive of polyarteritis nodosa. 30% of patients with <strong>polyarteritis nodosa (PAN)</strong>&nbsp;have&nbsp;<strong>chronic hepatitis B&nbsp;</strong>and deposits containing HBsAg-HBsAb complexes in&nbsp;affected vessels.</p>\n<p><strong>Polyarteritis nodosa (PAN)</strong> is necrotizing arteritis of the <strong>small and medium-sized</strong> blood vessels. It can affect the skin, peripheral nerves, mesenteric vessels (including renal), heart, and brain. <strong>Pulmonary vessels</strong> are usually<strong> not</strong> involved, however, bronchial vessels may be involved occasionally.</p>\n<p>The disease initially starts with non-specific symptoms like fever, malaise, arthralgia, and myalgia. Later, depending on the artery involved, the patients may develop the following symptoms:</p>\n<ul>\n<li>Skin findings- Rash, purpura, nodules, cutaneous infarcts, livedo reticularis, Raynaud&rsquo;s phenomenon</li>\n<li>Musculoskeletal- Arthritis, arthralgia, myalgia</li>\n<li>Renal artery involvement- hypertension and renal failure.</li>\n<li>Mesenteric artery involvement- abdominal pain, nausea, vomiting, bleeding, and bowel perforation.</li>\n<li>Nervous system- <strong>Peripheral neuropathy</strong>, mono-neuritis multiplex, Cerebral vascular accidents</li>\n<li>Genitourinary-&nbsp;Testicular, ovarian, or epididymal pain</li>\n</ul>\n<p>Diagnosis:</p>\n<ul>\n<li>No specific diagnostic test</li>\n<li>Elevated leukocyte count, with <strong>neutrophil predominance</strong></li>\n<li>Elevated ESR</li>\n<li><strong>Hypergammaglobulinemia</strong></li>\n<li>Hep B and C antibodies</li>\n<li><strong>Eosinophilia- Rare</strong> and if present, suggests the diagnosis of eosinophilic granulomatosis with polyangiitis (Churg Strauss)</li>\n<li>Antibodies against myeloperoxidase and proteinase <strong>C (ANCA) are negative</strong> or rarely found.</li>\n<li>Biopsies of symptomatic skin lesions, painful testes, nerve or muscle- showing medium vessel vasculitis</li>\n<li>Angiograms- showing aneurysms of small and medium-sized vessels in the renal, hepatic and visceral vasculature</li>\n</ul>\n<p>&nbsp;The image below shows the histopathological image of an arterial biopsy in PAN.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/113b550337f54d6fba32d3cd43d46edfx720x552.JPEG"
    ]
  },
  {
    "text": "A middle-aged man presented with hemoptysis and reduced urine output.  There is no history of asthma or upper airway disease. On evaluation, he is found to be positive for p-ANCA. Renal biopsy showed non-granulomatous inflammation, with segmental fibrinoid necrosis. What is the most likely diagnosis in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Polyarteritis nodosa"
      },
      {
        "id": 2,
        "text": "Churg-Strauss syndrome"
      },
      {
        "id": 3,
        "text": "Microscopic polyangiitis"
      },
      {
        "id": 4,
        "text": "Wegener's granulomatosis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The most likely diagnosis in this patient is <strong>microscopic polyangiitis</strong>.</p>\n<p>The above clinical scenario of hemoptysis, reduced urine output, <strong>positive p-ANCA</strong> antibody, and biopsy showing <strong>non-granulomatous inflammation</strong> with segmental fibrinoid necrosis is suggestive of <strong>microscopic polyangiitis.</strong></p>\n<p><strong>Microscopic polyangiitis</strong> is characterized by <strong>necrotizing vasculitis</strong> with few or no immune complexes affecting the small vessels (capillaries, venules, and arterioles). It may have a gradual or acute onset associated with fever, weight loss, and musculoskeletal pain. Renal involvement results in glomerulonephritis which results in renal failure. Hemoptysis occurs due to alveolar hemorrhage.</p>\n<p>Laboratory investigations show elevated erythrocyte sedimentation rate, anemia, leukocytosis, and thrombocytopenia. Most cases are associated with positive p-ANCA antibodies. Tissue biopsy would reveal non-granulomatous inflammation with segmental fibrinoid necrosis.\u00a0</p>\n<p>Other options:</p>\n<p>Option A:\u00a0<strong>Polyarteritis nodosa</strong> (PAN) is <strong>necrotizing</strong> arteritis of the medium and small-sized blood vessels. It can affect the skin, peripheral nerves, renal vessels, mesenteric vessels, heart, and brain. <strong>Lungs </strong>are usually<strong> spared</strong> in PAN. The disease initially starts with non-specific symptoms like fever, malaise, arthralgia, and myalgia. Later, depending on the artery involved, patients may develop the following symptoms:</p>\n<ul>\n<li>Skin findings - ulcers, digital gangrene,\u00a0subcutaneous nodules, and livedo reticularis</li>\n<li>Renal arteries -\u00a0hypertension and renal failure</li>\n<li>Mesenteric arteries - abdominal pain, nausea, vomiting, bleeding, and a bowel perforation</li>\n</ul>\n<p>Patients with PAN do not show p-ANCA and c-ANCA positivity. Tissue biopsy reveals <strong>segmental transmural necrotizing inflammation</strong> associated with luminal thrombosis.</p>\n<p>Options B:\u00a0<strong>Churg-Strauss syndrome</strong> (eosinophilic granulomatosis with polyangiitis) is a small vessel vasculitis characterized by <strong>asthma</strong>, peripheral and tissue eosinophilia, extravascular <strong>granuloma formation,</strong> and vasculitis of multiple organs. The clinical features include non-specific symptoms like fever, malaise, anorexia, and weight loss. The pulmonary findings are characterized by <strong>severe asthmatic attacks</strong> and pulmonary infiltrates. Renal disease is less common in these patients. These patients show <strong>p-ANCA positivity</strong>.</p>\n<p>Option D:\u00a0<strong>Wegener's granulomatosis</strong> (granulomatosis with polyangiitis) is a small vessel vasculitis characterized by <strong>granulomatous vasculitis</strong> of the upper and lower respiratory tract with glomerulonephritis. The clinical features include bloody nasal discharge, nasal septal perforation, serous otitis media, hemoptysis, dyspnea, and glomerulonephritis which may lead to rapidly progressive renal failure. These patients show <strong>c-ANCA positivity</strong>. Tissue biopsy reveals <strong>granulomas</strong> with geographic patterns of central necrosis and accompanying vasculitis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "All of the following are necrotizing vasculitis except___",
    "choices": [
      {
        "id": 1,
        "text": "Churg Strauss syndrome"
      },
      {
        "id": 2,
        "text": "Polyarteritis nodosa"
      },
      {
        "id": 3,
        "text": "Microscopic polyangitis"
      },
      {
        "id": 4,
        "text": "Kawasaki disease"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Kawasaki</strong> disease is a non-necrotizing <strong>non-granulomatous</strong> inflammation of medium-sized blood vessels.</p>\n<p>Kawasaki disease\u00a0is an acute febrile multisystemic disease occurring in <strong>children</strong> less than 5 years of age. Clinical features include <strong>cervical lymphadenitis</strong>, <strong>conjunctival congestion</strong>, <strong>erythema</strong> of the palms,<strong> buccal mucosa</strong>, and <strong>mucosal edema</strong>. It can be complicated by the development of <strong>coronary artery aneurysms</strong>. These aneurysms appear beadlike and thrombosis can also occur.</p>\n<p>Other complications are myocarditis, pericarditis, myocardial ischemia, and cardiomegaly.\u00a0It is managed with high-dose intravenous<strong> immunoglobulin</strong> and aspirin for a few weeks to reduce the incidence of coronary complications. Giant coronary artery aneurysms are treated with surgery.</p>\n<p>Other options:\u00a0</p>\n<p>Vasculitis associated with <strong>necrotizing</strong> inflammation are polyarteritis nodosa, microscopic polyangiitis, Wegener\u2019s granulomatosis, and Churg Strauss syndrome.\u00a0</p>\n<p><strong>Polyarteritis nodosa</strong> is a necrotizing granulomatous inflammation of<strong> small</strong> and <strong>medium-sized arteries</strong> that characteristically affects the renal and visceral arteries.\u00a0<strong>ANCA</strong> are rarely found in patients with polyarteritis nodosa.</p>\n<p><strong>Churg Strauss</strong> syndrome is characterized by <strong>asthma</strong>, peripheral and tissue <strong>eosinophilia</strong>, extravascular <strong>granuloma</strong> formation, and vasculitis of multiple organs.\u00a0<strong>Anti-myeloperoxidase ANCA</strong> antibodies are positive.\u00a0\u00a0</p>\n<p><strong>Microscopic polyangiitis</strong> affects small and medium-sized arteries with a predilection to involve the capillaries and venules. It is highly associated with <strong>ANCA</strong>. Treatment consists of <strong>methotrexate</strong> or <strong>mycophenolate</strong> mofetil and<strong> glucocorticoids</strong> for non-severe disease.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 58-year-old male patient presented with complaints of fever, muscle pain, and hemoptysis. Serology showed MPO-ANCA positivity. Laboratory parameters such as ESR and CRP were elevated. A diagnosis of microscopic polyangiitis is suspected. Which among the following is not a feature of the above likely condition?",
    "choices": [
      {
        "id": 1,
        "text": "Granulomas are present"
      },
      {
        "id": 2,
        "text": "Fibrinoid necrosis is seen"
      },
      {
        "id": 3,
        "text": "Leukocytoclastic vasculitis"
      },
      {
        "id": 4,
        "text": "Medium and large arteries are spared"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Granuloma is not a feature of&nbsp;<strong>microscopic polyangiitis.</strong></p>\n<p>Microscopic polyangiitis is a vasculitis typically involving capillaries, <strong>small arterioles,</strong> and venules.&nbsp;It is more common in <strong>males</strong> with an age of onset of around <strong>57 years.</strong></p>\n<p>Clinically, patients may complain of fever, weight loss, and musculoskeletal pain. They mainly present with <strong>glomerulonephritis</strong> and in a few cases, <strong>hemoptysis</strong> may be the presenting feature.&nbsp;<strong>Mononeuritis multiplex</strong> and <strong>cutaneous vasculitis</strong> are the other manifestations.&nbsp;</p>\n<p>They are associated with <strong>MPO-ANCA</strong>&nbsp;or <strong>P-ANCA</strong> antibodies. ESR and CRP are elevated. Anemia, leukocytosis, and thrombocytosis are also present.&nbsp;</p>\n<p>Morphological features include:</p>\n<ul>\n<li><strong>Fibrinoid necrosis</strong> of the media with <strong>absent granulomas</strong>.</li>\n<li><strong>Sparing</strong> of the medium and large arteries.</li>\n<li>Fragmented neutrophils in the postcapillary venules lead to <strong>leukocytoclastic vasculitis</strong>.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 65-year-old male presents with sudden onset of severe headache and visual disturbances. Examination reveals tender, palpable temporal arteries. Which of the following additional symptoms is he most likely to have?",
    "choices": [
      {
        "id": 1,
        "text": "Facial swelling and erythema"
      },
      {
        "id": 2,
        "text": "Pain and stiffness in the shoulders and hips"
      },
      {
        "id": 3,
        "text": "Intermittent claudication"
      },
      {
        "id": 4,
        "text": "Paresthesias and weakness in the hands and feet"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>This patient's presentation with severe headache, visual disturbances, and tender, palpable temporal arteries is suggestive of <strong>giant cell arteritis (GCA).</strong> Giant cell arteritis often coexists with <strong>polymyalgia rheumatica (PMR)</strong>, characterized by proximal muscle stiffness and pain, typically affecting the shoulders, hips, and sometimes neck and lower back.</p>\n<p>GCA is a systemic vasculitis predominantly affecting medium and large arteries, commonly involving the <strong>branches of the carotid artery</strong>, including the temporal artery. It is characterized by inflammation that can lead to <strong>arterial stenosis</strong> or <strong>occlusion,</strong> causing symptoms such as <strong>severe headaches</strong> and <strong>visual disturbances</strong> due to involvement of cranial arteries. Prompt recognition and treatment are crucial to prevent serious complications like <strong>ischemic optic neuropathy,</strong> which can lead to irreversible blindness if untreated.</p>\n<p>Giant cell arteritis frequently coexists with <strong>polymyalgia rheumatica</strong> (PMR), a related inflammatory condition characterized by <strong>proximal muscle stiffness and pain</strong>, typically involving the shoulders, hips, and occasionally the neck and lower back. PMR may precede, accompany, or follow the onset of GCA in about 50% of cases, suggesting shared underlying pathogenic mechanisms. Both conditions are more common in individuals over the age of 50</p>\n<p>Other options:\u00a0</p>\n<p>Option A: <strong>Facial swelling and erythema </strong>are more indicative of conditions like angioedema or allergic reactions and are not typical of GCA or PMR.</p>\n<p>Option C: <strong>Intermittent claudication</strong>, or pain due to insufficient blood flow, is commonly associated with peripheral arterial disease rather than with GCA or PMR.</p>\n<p>Option D: <strong>Paresthesias and weakness in the hands and feet</strong> suggest peripheral neuropathy, which is unrelated to the symptoms of GCA or PMR.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An 8-year-old boy presents with knee pain, mild nausea, and a nonpruritic rash on his legs following a recent sore throat treated with penicillin. His vital signs are stable, and laboratory tests are unremarkable. What complication is this patient at increased risk for?",
    "choices": [
      {
        "id": 1,
        "text": "Intussusception"
      },
      {
        "id": 2,
        "text": "Adrenal insufficiency"
      },
      {
        "id": 3,
        "text": "Thrombocytopenia"
      },
      {
        "id": 4,
        "text": "Anterior uveitis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>This patient's presentation with knee pain, mild nausea, and a nonpruritic rash on his legs, particularly after a recent sore throat treated with penicillin, is indicative of <strong>IgA vasculitis (Henoch-Schonlein purpura</strong>). <strong>Intussusception</strong> is a common complication in these cases.</p>\n<p>IgA vasculitis is characterized by immune complex deposition in small vessels, leading to <strong>palpable purpura, arthralgia, and gastrointestinal symptoms</strong>. A significant complication of IgA vasculitis is <strong>intussusception</strong>, especially ileo-ileal intussusception, due to <strong>submucosal hemorrhage</strong> and <strong>edema</strong> in the <strong>bowel wall</strong> forming a lead point. Patients with <strong>IgA vasculitis</strong> should be <strong>closely monitored</strong> for signs of <strong>intussusception,</strong> such as <strong>abdominal pain</strong> and <strong>bloody stools,</strong> as prompt intervention may be required.</p>\n<p>Other options:-</p>\n<p>Option B: <strong>Adrenal insufficiency</strong>, such as in <strong>Waterhouse-Friderichsen</strong> syndrome, typically occurs due to adrenal hemorrhage from severe bacterial infections like <strong>meningococcal meningitis.</strong> This patient lacks the characteristic features of meningococcal meningitis, such as <strong>fever, headache, neck stiffness,</strong> and <strong>altered mental status,</strong> making <strong>adrenal insufficiency</strong> unlikely.</p>\n<p>Option C: <strong>Thrombocytopenia</strong>, particularly immune thrombocytopenic purpura (ITP), often follows viral infections and presents with a purpuric rash. However, ITP usually presents with <strong>isolated thrombocytopenia</strong> without the arthralgia seen in this patient. Additionally, <strong>IgA vasculitis</strong> is associated with <strong>normal</strong> or <strong>increased platelet</strong> counts, not decreased.</p>\n<p>Option D: <strong>Anterior uveitis</strong> is associated with systemic immune conditions such as <strong>juvenile idiopathic arthritis</strong> (JIA), which presents with <strong>prolonged joint symptoms</strong> without a rash. This patient's acute presentation with a <strong>rash</strong> and <strong>recent upper respiratory</strong> infection aligns more with <strong>IgA vasculitis,</strong> which is not associated with anterior uveitis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is a poor prognostic indicator for cryoglobulinemic vasculitis?",
    "choices": [
      {
        "id": 1,
        "text": "Low serum cryoglobulin levels"
      },
      {
        "id": 2,
        "text": "Cutaneous vasculitis"
      },
      {
        "id": 3,
        "text": "Glomerulonephritis"
      },
      {
        "id": 4,
        "text": "Absence of hepatitis C viral infection"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Glomerulonephritis</strong> is a poor prognostic indicator in cryoglobulinemic vasculitis because it signifies severe involvement of the kidneys, which can lead to progressive renal damage, chronic kidney disease, or renal failure.</p>\n<p><strong>Cryoglobulinemic vasculitis</strong> involves the deposition of <strong>immune complexes in small- to medium-sized blood vessels</strong>, causing inflammation and damage. When these deposits affect the glomeruli in the kidneys, it can lead to glomerulonephritis, characterized by proteinuria, hematuria, and decreased renal function.</p>\n<p>The presence of glomerulonephritis typically indicates a more aggressive and systemic form of the disease, requiring more intensive immunosuppressive therapy and closer monitoring. Long-term outcomes are worse in patients with renal involvement compared to those with more limited disease manifestations. Acute mortality directly from cryoglobulinemic vasculitis is uncommon, but the presence of glomerulonephritis is a poor prognostic sign for overall outcome. In such patients, 15% progress to end-stage renal disease, with 40% later experiencing fatal cardiovascular disease, infection, or liver failure.</p>\n<p>Other Options:</p>\n<p>Option A: <strong>Lower levels of serum cryoglobulins</strong> generally indicate less severe disease activity. High levels of cryoglobulins are associated with more severe disease and systemic involvement. Therefore, low serum cryoglobulin levels are not considered a poor prognostic indicator.</p>\n<p>Option B: <strong>Cutaneous involvement</strong>, such as purpura or skin ulcers, indicates disease activity but is often more limited compared to systemic involvement like glomerulonephritis. While cutaneous vasculitis can cause discomfort and morbidity, it is not associated with the same level of poor prognosis as renal involvement.</p>\n<p>Option D: The presence of <strong>hepatitis C virus (HCV) </strong>infection is a common underlying cause of cryoglobulinemic vasculitis. However, the absence of HCV does not inherently indicate a poor prognosis. Patients without HCV-related cryoglobulinemic vasculitis might have other underlying etiologies, but their prognosis is more influenced by the extent of organ involvement rather than the absence of the virus itself.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 45-year-old man presents with a 3-month history of sinusitis, hemoptysis, and joint pain. Physical exam reveals oral ulcers and palpable purpura. Labs show elevated inflammatory markers and a positive ANCA test. Which of the following is the most commonly used treatment regimen in the induction phase of this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Azathioprine only"
      },
      {
        "id": 2,
        "text": "Cyclophosphamide only"
      },
      {
        "id": 3,
        "text": "Steroids + Cyclophosphamide"
      },
      {
        "id": 4,
        "text": "Steroids + Azathioprine"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The patient's symptoms and positive ANCA test suggest <strong>granulomatosis with polyangiitis (GPA).</strong> For induction phase in GPA, the most commonly used treatment regimen includes <strong>glucocorticoids (e.g., prednisone) combined with cyclophosphamide.</strong></p>\n<p>Granulomatosis with polyangiitis (GPA), formerly known as <strong>Wegener's</strong> granulomatosis, is a systemic autoimmune vasculitis characterized by <strong>inflammation</strong> of <strong>small</strong> to <strong>medium-sized</strong> blood vessels, leading to <strong>necrosis</strong> and <strong>granuloma</strong> formation. The treatment approach for GPA typically involves two main phases: <strong>induction</strong> of <strong>remission</strong> and <strong>maintenance</strong> therapy.</p>\n<p>During the <strong>induction</strong> phase, the primary goal is to achieve remission and control active disease manifestations. The cornerstone of induction therapy for GPA involves a combination of <strong>glucocorticoids</strong> (steroids) and an <strong>immunosuppressive</strong> agent. Steroids, such as <strong>prednisone,</strong> are used to rapidly <strong>suppress inflammation</strong> and alleviate symptoms. <strong>Cyclophosphamide,</strong> a potent <strong>immunosuppressive</strong> agent, is often chosen alongside steroids for severe cases or when vital organs are involved. It is given orally or intravenously and helps in controlling the autoimmune response responsible for tissue damage and systemic manifestations.</p>\n<p>Once remission is achieved, the <strong>maintenance</strong> phase aims to prevent disease relapse while minimizing long-term side effects of therapy. In this phase, lower doses of steroids are often used in combination with less toxic immunosuppressive agents like azathioprine. These medications help to sustain remission and reduce the risk of disease flare-ups.</p>\n<p>Other options:</p>\n<p>Option A: While <strong>azathioprine</strong> is used in the maintenance phase of GPA treatment to sustain remission and reduce the need for higher doses of steroids, it is not typically used as part of the induction therapy. It is considered less potent compared to cyclophosphamide for controlling active disease.</p>\n<p>Option B: <strong>Cyclophosphamide</strong> is used in the induction phase of GPA treatment due to its potent immunosuppressive effects. However, the combination with steroids (option C) is more specific for achieving remission and controlling active inflammation.</p>\n<p>Option D: <strong>Steroids + Azathioprine</strong>: This combination is used in the maintenance phase of GPA treatment, not in the induction phase. Azathioprine alone is not sufficient for inducing remission in severe cases of GPA and is typically reserved for maintaining disease control after initial induction therapy with steroids and cyclophosphamide.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is an IL-5 antagonist that is used in Churg-Strauss syndrome?",
    "choices": [
      {
        "id": 1,
        "text": "Dupilumab"
      },
      {
        "id": 2,
        "text": "Omalizumab"
      },
      {
        "id": 3,
        "text": "Tocilizumab"
      },
      {
        "id": 4,
        "text": "Mepolizumab"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Mepolizumab</strong> is a monoclonal antibody that specifically targets <strong>interleukin-5 (IL-5)</strong>, a cytokine involved in the maturation, activation, and survival of eosinophilsm, and can be used in Churg-Strauss syndrome.</p>\n<p>Churg-Strauss syndrome, also known as eosinophilic granulomatosis with polyangiitis (EGPA), is characterized by systemic vasculitis and eosinophilia. Mepolizumab has been approved for use in EGPA to reduce the frequency of relapses and control asthma exacerbations in patients with refractory disease. By blocking IL-5, mepolizumab reduces eosinophilic inflammation and helps in managing the disease activity associated with EGPA.</p>\n<p>Other options:</p>\n<p>Option A: <strong>Dupilumab</strong> is a monoclonal antibody that targets the IL-4 receptor alpha subunit, thereby inhibiting IL-4 and IL-13 signaling.</p>\n<p>Option B: <strong>Omalizumab</strong> a monoclonal antibody that binds to immunoglobulin E (IgE) and is used in allergic asthma and chronic urticaria.\u00a0</p>\n<p>Option C: <strong>Tocilizumab</strong> is an IL-6 receptor antagonist used in conditions such as rheumatoid arthritis, giant cell arteritis, and cytokine release syndrome. \u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = 'Vasculitis Mini Test - -Tmt';
        const quizFilename = 'vasculitis-mini-test-tmt-7104d69e.html';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2024-25"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>