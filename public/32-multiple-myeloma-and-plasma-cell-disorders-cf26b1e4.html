<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>32 Multiple Myeloma And Plasma Cell Disorders - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Pathology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">32</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "What is the normal ratio between kappa and lambda light chains?",
    "choices": [
      {
        "id": 1,
        "text": "70:30"
      },
      {
        "id": 2,
        "text": "60:40"
      },
      {
        "id": 3,
        "text": "40:60"
      },
      {
        "id": 4,
        "text": "30:70"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The<strong> normal ratio</strong> of kappa to lambda light chains is <strong>60:40</strong>.</p>\n<p>In multiple myeloma, usually this ratio is skewed, i.e.,&nbsp;favorable secretion of one type of light chain occurs at the expense of the&nbsp;other.&nbsp;Serum-free light chain assay is a recommended part of the initial diagnostic workup for multiple myeloma.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Patients with which of the following can be classified under smoldering multiple myeloma?",
    "choices": [
      {
        "id": 1,
        "text": "Lack of symptoms and a high plasma M component with bone marrow plasma cells >10%"
      },
      {
        "id": 2,
        "text": "Plasma cells >10% in the bone marrow, no paraprotein in blood and presence of lytic bone lesions"
      },
      {
        "id": 3,
        "text": "Plasma cells >10% in bone marrow, abnormal serum free light chain ratio and hypercalcemia"
      },
      {
        "id": 4,
        "text": "Presence of symptoms and a low plasma M component with plasma cells <10%"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Smoldering multiple myeloma</strong> refers to an uncommon variant defined by a <strong>lack of symptoms</strong> and a<strong> high plasma M component.</strong></p>\n<p>The difference between MGUS, smouldering multiple myeloma, and multiple myeloma is given below:</p>\n<table style=\"width: 392px;\">\n<tbody>\n<tr style=\"height: 52.934px;\">\n<td style=\"width: 94px; height: 52.934px;\"><strong>MGUS</strong></td>\n<td style=\"width: 144px; height: 52.934px;\"><strong>Smouldering&nbsp;multiple Myeloma</strong></td>\n<td style=\"width: 148px; height: 52.934px;\"><strong>Multiple Myeloma</strong></td>\n</tr>\n<tr style=\"height: 32px;\">\n<td style=\"width: 94px; height: 32px;\">Asymptomatic</td>\n<td style=\"width: 144px; height: 32px;\">Asymptomatic</td>\n<td style=\"width: 148px; height: 32px;\">Symptomatic</td>\n</tr>\n<tr style=\"height: 114px;\">\n<td style=\"width: 94px; height: 114px;\">M protein in serum&nbsp;&lt;3g/dL</td>\n<td style=\"width: 144px; height: 114px;\">\n<p>M-protein in serum:</p>\n<ul>\n<li>IgG &ge;3 g/dL,</li>\n<li>IgA &gt;1 g/dL</li>\n</ul>\n</td>\n<td style=\"width: 148px; height: 114px;\">M protein in serum and urine</td>\n</tr>\n<tr style=\"height: 54px;\">\n<td style=\"width: 94px; height: 54px;\">Bone Marrow (BM) plasma cells &lt;10%</td>\n<td style=\"width: 144px; height: 54px;\">BM plasma cells 10-60%</td>\n<td style=\"width: 148px; height: 54px;\">BM plasma cells &ge;60%</td>\n</tr>\n<tr style=\"height: 72px;\">\n<td style=\"width: 94px; height: 72px;\">No other organ or tissue impairment</td>\n<td style=\"width: 144px; height: 72px;\">No other organ or tissue impairment</td>\n<td style=\"width: 148px; height: 72px;\">Related impairment is seen.<br />(CRAB)</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 76-year-old man presents for a routine health check-up and is found to be mildly anemic. Physical examination reveals no abnormalities. Serum protein electrophoresis with immunofixation demonstrates an IgG-kappa monoclonal protein with markedly reduced IgM and IgA levels. Bone marrow biopsy shows 12% plasma cells. A skeletal survey reveals osteopenia and several punched-out lytic lesions, but no fractures. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Plasma cell leukemia"
      },
      {
        "id": 2,
        "text": "Multiple myeloma"
      },
      {
        "id": 3,
        "text": "Plasmacytoma"
      },
      {
        "id": 4,
        "text": "MGUS"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario is suggestive of<strong>&nbsp;multiple myeloma</strong>.</p>\n<p>Plasma cell dyscrasias are B-cell proliferations that contain <strong>neoplastic plasma cells</strong> that secrete a monoclonal Ig or Ig fragment.&nbsp;Multiple myeloma is a malignant neoplasm of plasma cells characterized by the presence of <strong>monoclonal immunoglobulin or light chains </strong>in the serum and urine. It is a&nbsp;disease of older adults, with a peak age of incidence of 65 to 70 years.</p>\n<p>Signs and symptoms include:</p>\n<ul>\n<li>Hypercalcemia</li>\n<li>Pathologic fractures/ lytic bone lesions</li>\n<li>Renal failure</li>\n<li>Anemia</li>\n</ul>\n<p>Investigations reveal:</p>\n<ul>\n<li>Radiography -&nbsp;<strong>Punched-out lytic lesions</strong> on X-ray</li>\n<li>Electrophoresis -&nbsp;<strong>Monoclonal elevation </strong>of one immunoglobulin</li>\n<li>Urinalysis - Free <strong>kappa </strong>and<strong> lambda </strong>light chains (Bence Jones proteins)</li>\n<li>Bone marrow biopsy -&nbsp;<strong>10 to 20%</strong>plasma cells (normal is &lt; 5%)</li>\n<li>Peripheral smear -&nbsp;<strong>Rouleaux </strong>formation. A high level of M proteins in myeloma causes red cells in the peripheral blood smears to stick to one another in linear arrays, a finding referred to as <strong>rouleaux formation</strong>.</li>\n</ul>\n<p>Plasma cell tumors are positive for<strong> CD138.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the most common cytogenetic abnormality in multiple myeloma?",
    "choices": [
      {
        "id": 1,
        "text": "Translocation 14q"
      },
      {
        "id": 2,
        "text": "Deletion of 13q"
      },
      {
        "id": 3,
        "text": "Translocation 11q"
      },
      {
        "id": 4,
        "text": "Deletion of 17p"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The<strong> most common</strong> cytogenetic abnormality in <strong>multiple myeloma</strong> is<strong>\u00a0translocation 14q</strong>.</p>\n<p>Cytogenetic abnormalities in multiple myeloma include:</p>\n<ul>\n<li><strong>Translocations</strong> involving IGH on <strong>chromosome 14q</strong> -\u00a0<strong>most frequent</strong>\u00a0</li>\n<li>Monosomy or partial deletion of chromosome 13 (13q14) - Found by FISH (nearly half the cases)</li>\n<li>Translocation of the IgH occurs frequently with cyclin D1 on chromosome 11q and cyclin D3 on chromosome 6p</li>\n<li>Deletions of chromosome 17p involving TP53 tumor-suppressor locus</li>\n</ul>\n<p>Translocations with cyclin D1 are associated with a good outcome, whereas deletion of 17p and t(4;14) portend an aggressive course.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which cytokine is an important growth factor for plasma cells in multiple myeloma?",
    "choices": [
      {
        "id": 1,
        "text": "IL-2"
      },
      {
        "id": 2,
        "text": "IL-6"
      },
      {
        "id": 3,
        "text": "Interferon \u00a0\u03b3"
      },
      {
        "id": 4,
        "text": "IL-1"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The proliferation and survival of <strong>plasma cells</strong> are dependent on several cytokines, most notably <strong>IL-6<em>.</em></strong></p>\n<p>It is an important growth factor for plasma cells. It is produced by the tumor cells themselves and by resident marrow stromal cells. IL6, along with other cytokines,&nbsp;<strong>promotes osteoclastic activity </strong>and<strong> lytic bone lesions.&nbsp;High</strong> serum levels of IL-6 are seen in patients with active disease&nbsp;and are associated with a<strong> poor prognosis</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is the most common monoclonal immunoglobulin seen in patients with myeloma?",
    "choices": [
      {
        "id": 1,
        "text": "IgM"
      },
      {
        "id": 2,
        "text": "IgA"
      },
      {
        "id": 3,
        "text": "IgE"
      },
      {
        "id": 4,
        "text": "IgG"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The most common <strong>monoclonal Ig</strong> (M protein) in <strong>myeloma</strong> is <strong>IgG</strong> (approximately 55% of patients), followed by IgA (approximately 25% of cases).</p>\n<p>The immunosecretory disorders are a diverse group of diseases associated with the proliferation of an<strong> abnormal clone</strong> of immunoglobulin-synthesizing, terminally differentiated B cells. These disorders include:</p>\n<ul>\n<li>Multiple myeloma (MM) and its variants</li>\n<li>Plasmacytoma</li>\n<li>Waldenstrom macroglobulinemia</li>\n<li>Monoclonal gammopathy of undetermined significance</li>\n<li>Monoclonal Ig deposition diseases - Includes primary amyloidosis and nonamyloidotic types.</li>\n</ul>\n<p>The immunoglobulin can be complete or can be composed of either heavy or light chains and is termed<strong> M-(monoclonal) protein.&nbsp;</strong>Most <strong>myelomas</strong> are associated with<strong> more than 3 gm/dL</strong> of serum immunoglobulin.&nbsp;Myelomas expressing IgM, IgD, or IgE occur, but they are rare.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In patients with multiple myeloma, lytic lesions are most commonly seen in which bone?",
    "choices": [
      {
        "id": 1,
        "text": "Skull"
      },
      {
        "id": 2,
        "text": "Ribs"
      },
      {
        "id": 3,
        "text": "Pelvis"
      },
      {
        "id": 4,
        "text": "Vertebrae"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Lytic bony lesions</strong> in myeloma patients are most commonly seen in the<strong> vertebrae</strong>.</p>\n<p><strong>Multiple myeloma</strong> usually presents as destructive plasma cell tumors involving the axial skeleton. The bones most commonly affected (in<strong> descending order</strong> of frequency) are:</p>\n<ol>\n<li><strong>Vertebral column</strong></li>\n<li>Ribs</li>\n<li>Skull</li>\n<li>Pelvis</li>\n<li>Femur</li>\n<li>Clavicle</li>\n<li>Scapula</li>\n</ol>\n<p>Pathologic fractures are common in this condition. The bone lesions appear radiographically as<strong> punched-out defects, </strong>usually 1 to 4 cm in diameter.</p>\n<p>The image given below shows osteoblastic lesions of vertebra in multiple myeloma.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1826aaa0c79d44bdb257c20c68d9af90x513x1066.JPEG"
    ]
  },
  {
    "text": "Which substance is responsible for the marked increase in bone resorption and hypercalcemia in patients with multiple myeloma?",
    "choices": [
      {
        "id": 1,
        "text": "IL 6"
      },
      {
        "id": 2,
        "text": "MIP 1\u03b1"
      },
      {
        "id": 3,
        "text": "NF- \u03baB"
      },
      {
        "id": 4,
        "text": "ALP"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>MIP1&alpha;</strong> secreted by myeloma cells is responsible for the marked<strong> increase</strong> in<strong> bone resorption </strong>and <strong>hypercalcemia.</strong></p>\n<p>Factors produced by neoplastic plasma cells mediate bone destruction, the major pathologic feature of multiple myeloma. Of particular importance, myeloma-derived<strong>&nbsp;macrophage inflammatory protein 1&alpha;</strong> (MIP1&alpha;) upregulates the expression of the receptor activator of NF-&kappa;B ligand (<strong>RANKL</strong>) by bone marrow stromal cells, which in turn <strong>activates osteoclasts</strong>.</p>\n<p>Other factors released from tumor cells, such as modulators of the<strong> Wnt pathway</strong>, are potent<strong> inhibitors of osteoblast function</strong>.</p>\n<p>The net effect is a marked increase in bone resorption, which leads to <strong>hypercalcemia </strong>and <strong>pathological fractures</strong>.</p>\n<p>Serum<strong> alkaline phosphate </strong>levels are <strong>normal </strong>in multiple myeloma.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A pathologist observed the following finding in a peripheral blood smear. In patients with which of the following conditions is this seen?",
    "choices": [
      {
        "id": 1,
        "text": "1 and 4 only"
      },
      {
        "id": 2,
        "text": "2, 3, and 5"
      },
      {
        "id": 3,
        "text": "1, 2, and 5"
      },
      {
        "id": 4,
        "text": "3 and 4 only"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Conditions</strong> that cause rouleaux formation are:</p>\n<ul>\n<li><strong>Multiple myeloma</strong></li>\n<li>Connective tissue disorders like <strong>SLE</strong></li>\n<li><strong>Early HIV</strong></li>\n<li>Infections</li>\n</ul>\n<p>Rouleaux formation is <strong>retarded by albumin</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3c9b0ece8a97408a81fb7622d52988e5.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5b57601f543543e0b85576198349c001x1280x1154.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ec064845202b4751a97571f70b50cae1x1280x1154.JPEG"
    ]
  },
  {
    "text": "Which of the following is least likely to be seen in patients with multiple myeloma?",
    "choices": [
      {
        "id": 1,
        "text": "Dutcher bodies"
      },
      {
        "id": 2,
        "text": "Russell bodies"
      },
      {
        "id": 3,
        "text": "Mooser bodies"
      },
      {
        "id": 4,
        "text": "Mott cells"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<ul>\n<li><strong>Russell bodies</strong> -&nbsp;Hyaline intracytoplasmic inclusions containing Ig</li>\n<li><strong>Mott cells/ morula cells </strong>-&nbsp;Plasma cells containing multiple grape-like cytoplasmic inclusions comprised of Ig</li>\n<li><strong>Flame cells</strong> -&nbsp;Vermillion-staining, glycogen-rich IgA in cytoplasmic projections</li>\n<li><strong>Thesaurocytes </strong>-&nbsp;Dilated endoplasmic reticulum cisternae</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/bd0de03fccda495182f36771da164273x1280x1153.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/db67ce9ac86648bf911efb2ef4655ce0x1280x1152.JPEG"
    ]
  },
  {
    "text": "The peripheral smear of a patient diagnosed with multiple myeloma is shown below. What does the marked structure contain?",
    "choices": [
      {
        "id": 1,
        "text": "Immunoglobulin"
      },
      {
        "id": 2,
        "text": "Golgi bodies"
      },
      {
        "id": 3,
        "text": "Rough endoplasmic reticulum"
      },
      {
        "id": 4,
        "text": "Apoptotic bodies"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given image shows<strong>&nbsp;</strong>a <strong>Mott cell</strong>&nbsp;which is a plasma cell with globular&nbsp;<strong>cytoplasmic inclusions</strong> containing <strong>immunoglobulins</strong> called <strong>Russell bodies</strong>.</p>\n<p><strong>Inclusions containing Ig </strong>are frequently seen in the cytoplasm (<strong>Russell bodies</strong>) or the nucleus (<strong>Dutcher bodies</strong>) of some of the plasma cells in myeloma.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/53bcf73b43c6498d95fcba32fdb02b7a.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6f94b54944444fdbb52f27bd1990aed5x1280x1199.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f08df38011214369800be6225b1eb85ex1280x1199.JPEG"
    ]
  },
  {
    "text": "The marked finding in plasma cells is due to:",
    "choices": [
      {
        "id": 1,
        "text": "Lysosomes"
      },
      {
        "id": 2,
        "text": "Golgi apparatus"
      },
      {
        "id": 3,
        "text": "Ig deposits"
      },
      {
        "id": 4,
        "text": "Cytoplasmic vacuole"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The marked finding is <strong>perinuclear hof</strong>&nbsp;(perinuclear clearing) in plasma cells. It occurs due to a prominent <strong>Golgi apparatus</strong>.</p>\n<p>Plasma cell characteristics include:</p>\n<ul>\n<li>Eccentric nuclei</li>\n<li>Moderate to abundant basophilic cytoplasm</li>\n<li>Pale perinuclear hof, representing the Golgi zone&nbsp;</li>\n</ul>\n<p>The image given below shows plasma cells with perinuclear hof.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/77d91bfc5c374212a67c8aca4ff6e977.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/fa50ee90c14c4be48a6b2388cc107f9dx1280x1151.JPEG"
    ]
  },
  {
    "text": "A 60-year-old male presented with a history of intractable diarrhea. Based on the histological image shown below which of the following is the most appropriate diagnosis:",
    "choices": [
      {
        "id": 1,
        "text": "Lymphoma"
      },
      {
        "id": 2,
        "text": "Leishmaniasis"
      },
      {
        "id": 3,
        "text": "Urate nephropathy"
      },
      {
        "id": 4,
        "text": "Multiple myeloma"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical scenario points to the diagnosis of<strong>\u00a0multiple myeloma</strong>.\u00a0</p>\n<p>The image shows<strong> Russell bodies</strong>\u00a0which are eosinophilic, large, homogeneous immunoglobulin-containing inclusions usually found in a plasma cell undergoing excessive synthesis of immunoglobulins. Russell bodies are distended endoplasmic reticulum.</p>\n<p><strong>Globular inclusions </strong>are<strong> Russell bodies </strong>(if cytoplasmic) and<strong> Dutcher bodies </strong>(if nuclear).\u00a0</p>\n<p>The below image shows Russell bodies:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/62bf0b4c0f354aec96124f0f77319754.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7d2b8cf60e5b488783d68294f57b1b18x720x545.JPEG"
    ]
  },
  {
    "text": "A patient with pallor and pathological fracture is diagnosed with multiple myeloma. Which of the following is not a kidney finding of such patients?",
    "choices": [
      {
        "id": 1,
        "text": "Tubular casts"
      },
      {
        "id": 2,
        "text": "Nephrocalcinosis"
      },
      {
        "id": 3,
        "text": "Wire-loop lesions"
      },
      {
        "id": 4,
        "text": "Renal tubular necrosis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Wire-loop lesions</strong> are seen in<strong> systemic lupus erythematosus</strong>&nbsp;and not in multiple myeloma.&nbsp;</p>\n<p><strong>Renal insufficiency</strong> occurs in half the patients with<strong> multiple myeloma</strong> and several factors are responsible for it. They develop acute kidney injury with ologuria and chronic kidney disease. Tubular casts, amyloidosis, and renal tubular necrosis are all described in the myeloma kidneys.</p>\n<p>Features of<strong> myeloma kidney</strong>:&nbsp;</p>\n<ul>\n<li><strong>Bence&ndash;Jones proteinuria</strong> and<strong> cast nephropathy -</strong>&nbsp;The main cause of renal dysfunction is related to <strong>Bence&ndash;Jones </strong>(light-chain)<strong> proteinuria.&nbsp;</strong>Ig light chains are directly toxic to epithelial cells. Bence-Jones proteins form large, histologically distinct tubular casts that obstruct the tubular lumens and induce a characteristic inflammatory reaction (light-chain cast nephropathy).</li>\n<li><strong>Amyloidosis</strong> of AL type, formed from free light chains (usually of &lambda; type)</li>\n<li><strong>Light-chain deposition disease -</strong>&nbsp;light chains (usually of &kappa; type) deposit in the glomerular basement membrane and mesangium causing a glomerulopathy and in tubular basement membranes, which may cause tubulointerstitial nephritis.</li>\n<li><strong>Hypercalcemia -</strong>&nbsp;Nephrocalcinosis</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What do Bence Jones proteins in the urine of multiple myeloma patients represent?",
    "choices": [
      {
        "id": 1,
        "text": "Light chains"
      },
      {
        "id": 2,
        "text": "Heavy chains"
      },
      {
        "id": 3,
        "text": "Intact antibodies"
      },
      {
        "id": 4,
        "text": "Part of heavy chains"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Bence Jones proteins</strong> are immunoglobulin <strong>light chains</strong> (paraproteins) produced by neoplastic plasma cells.</p>\n<p>They can be<strong> kappa </strong>(most of the time) or<strong> lambda.&nbsp;</strong>The light chains can be immunoglobulin fragments or single homogeneous immunoglobulins. In patients with plasma cell tumors, the level of free light chains is usually elevated. One of the light chains is elevated with a reduction in the other.&nbsp;<strong>Free light chains</strong> are excreted in the<strong> urine</strong> because they are small in size, where they are referred to as <strong>Bence Jones proteins.&nbsp;</strong>Tests for Bence Jones protein are:</p>\n<ul>\n<li>Heat test</li>\n<li>Urine protein electrophoresis</li>\n<li>Immunofixation</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Hyperviscosity symptoms in patients with multiple myeloma occur due to which of the following types of M protein?",
    "choices": [
      {
        "id": 1,
        "text": "IgG1"
      },
      {
        "id": 2,
        "text": "IgG2"
      },
      {
        "id": 3,
        "text": "IgG3"
      },
      {
        "id": 4,
        "text": "IgG4"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Symptoms related to <strong>hyperviscosity\u00a0</strong>in<strong> multiple myeloma</strong>\u00a0occurs due to excessive production of M proteins, usually of <strong>IgG<sub>3</sub> or IgA</strong> subtype.</p>\n<p><strong>Waldenstrom macroglobulinemia (IgM myeloma)</strong> is the most common cause for hyperviscosity syndrome due to excess IgM paraprotein. Less commonly, it also occurs in <strong>multiple myeloma</strong> (with myeloma proteins <strong>IgA and IgG<sub>3</sub> types</strong>) and connective tissue diseases.</p>\n<p>Normal relative serum viscosity ranges from 1.4 to 1.8 units. Symptoms are not seen at &lt;4, and hyperviscosity syndrome typically requires a viscosity of &gt;5 units.</p>\n<p>Clinical features include:</p>\n<ul>\n<li>Visual impairment</li>\n<li>Neurologic problems</li>\n<li>Bleeding</li>\n<li>Cryoglobulinemia</li>\n</ul>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Multiple myeloma patients associated with which type of M protein has the highest risk of renal insufficiency?",
    "choices": [
      {
        "id": 1,
        "text": "IgM"
      },
      {
        "id": 2,
        "text": "IgG"
      },
      {
        "id": 3,
        "text": "IgA"
      },
      {
        "id": 4,
        "text": "IgD"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>IgD type</strong> of multiple myeloma has the <strong>highest risk</strong>&nbsp;of<strong> renal insufficiency.</strong></p>\n<p>IgG is most commonly involved in multiple myeloma. The higher the level of IgG, the more is the risk of renal failure in patients with multiple myeloma overall. But the rarer IgD predominant multiple myeloma has the highest risk of renal insufficiency when compared to other types.</p>\n<p>IgD type&nbsp;multiple myeloma is a rare type of multiple myeloma. In this condition, there is monoclonal IgD in serum.&nbsp;On serum electrophoresis, there is&nbsp;<strong>no or absent M spike.&nbsp;</strong>There is a higher incidence of <strong>extramedullary involvement, amyloidosis, proteinuria,</strong> and<strong> renal insufficiency</strong> in comparison to IgG or IgA type multiple myeloma. It has a poor prognosis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following tumor markers is least likely to be positive in a patient with multiple myeloma?",
    "choices": [
      {
        "id": 1,
        "text": "CD 56"
      },
      {
        "id": 2,
        "text": "syndecan-1"
      },
      {
        "id": 3,
        "text": "CD 138"
      },
      {
        "id": 4,
        "text": "CD 21"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Plasma-cell tumors are least likely to show positivity for CD 21.</p>\n<p>They are positive for <strong>CD138</strong>, an adhesion molecule also known as <strong>syndecan-1</strong>, <strong>CD 38</strong>, and often express <strong>CD56</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not considered as a myeloma-defining event, according to the revised criteria for the diagnosis of multiple myeloma?",
    "choices": [
      {
        "id": 1,
        "text": "More than one focal lesionon MRI of 5 mm or more"
      },
      {
        "id": 2,
        "text": "60% or more clonal plasma cells on bone marrow examination"
      },
      {
        "id": 3,
        "text": "Biopsy proven plasmacytoma"
      },
      {
        "id": 4,
        "text": "Serum involved/uninvolved free light-chain ratio of 100 or greater"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Biopsy-proven plasmacytoma is <strong>not </strong>considered as a myeloma-defining event (MDE).</p>\n<p><strong>Revised International Myeloma Working Group criteria</strong> for the diagnosis of multiple myeloma:</p>\n<p>Clonal bone marrow <strong>plasma cells\u00a0\u226510%</strong> (or) Biopsy-proven bony or extramedullary plasmacytoma.</p>\n<p><strong>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 AND</strong></p>\n<p><strong>Myeloma defining events </strong>(one or more):<strong> Evidence </strong>of <strong>end-organ damage</strong> attributable to the underlying plasma cell proliferative disorder, specifically-</p>\n<ul>\n<li>Hyper<strong>C</strong>alcemia: Serum calcium level &gt;1 mg/dL higher than the upper limit of normal or &gt;11 mg/dL</li>\n<li><strong>R</strong>enal insufficiency: Creatinine clearance &lt;40 mL/min or serum creatinine &gt;2 mg/dL</li>\n<li><strong>A</strong>nemia: Hemoglobin level of &gt;20 g/L (2gm/dl) below the lowest limit of normal, or Hb &lt;10 g/dL</li>\n<li><strong>B</strong>one lesions: One or more osteolytic lesions on skeletal radiography, computed tomography (CT), or positron emission tomography (PET)/CT.</li>\n<li>Any one or more <strong>biomarkers of malignancy</strong>: Clonal bone marrow plasma cells \u226560%; Serum involved/uninvolved free light-chain ratio \u2265 100; &gt;1 focal lesion on magnetic resonance imaging (MRI) that is \u2265 5 mm in size.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 60-year-old lady presents with complaints of pallor, recurrent UTI, and bone pain in lower limbs. Peripheral smear shows rouleaux formation.  X-ray done is given below. Which is the best immunohistochemical marker for this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Annexin A1"
      },
      {
        "id": 2,
        "text": "CD20"
      },
      {
        "id": 3,
        "text": "Cyclin D1"
      },
      {
        "id": 4,
        "text": "Hep-par 1"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario and X-ray showing lytic lesions on the bone are suggestive of <strong>multiple myeloma</strong>. The best<strong>&nbsp;immunohistochemical </strong>(IHC) marker for this condition&nbsp;is <strong>cyclin D1.</strong></p>\n<p>Multiple myeloma&nbsp;is associated with diverse translocations involving the <strong>IgH&nbsp;</strong>locus; overexpression of D cyclins&mdash;<strong>cyclin D1</strong> and D3. Plasma cell tumors are positive for <strong>CD138</strong> and often express <strong>CD56.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/6b7adbe4cd134a48bd62c4c824e0a3fc.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A patient diagnosed with multiple myeloma develops features of restrictive cardiomyopathy and macroglossia. Which of the following amyloid is responsible for this?",
    "choices": [
      {
        "id": 1,
        "text": "AL"
      },
      {
        "id": 2,
        "text": "AA"
      },
      {
        "id": 3,
        "text": "A\u03b22m"
      },
      {
        "id": 4,
        "text": "A Cal"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario is suggestive of<strong> amyloidosis</strong>. The amyloid of the<strong> AL type</strong> is produced from free Ig light chains secreted by a monoclonal population of plasma cells and its deposition is associated with <strong>multiple myeloma.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the most common cause of death in patients with myeloma?",
    "choices": [
      {
        "id": 1,
        "text": "Renal failure"
      },
      {
        "id": 2,
        "text": "Infections"
      },
      {
        "id": 3,
        "text": "Cardiac failure"
      },
      {
        "id": 4,
        "text": "Hypercalcemic crisis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Infections</strong> are the most common <strong>cause of death</strong> in patients with <strong>myeloma</strong>.</p>\n<p>Complications of multiple myeloma include:</p>\n<ul>\n<li>Infections</li>\n<li>Renal failure</li>\n<li>Cardiac failure</li>\n<li>Hypercalcemia</li>\n<li>Anemia</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 60-year-old man presents with complaints of fatigue, pain over the ribs, and confusion. Lab investigations reveal anemia, hypercalcemia, and increased serum creatinine. X-ray shows lytic lesions on the bones. Which of the following is the most powerful prognostic indicator of this condition at the time of diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Number of myeloma cells in the marrow"
      },
      {
        "id": 2,
        "text": "\u03b22 microglobulin"
      },
      {
        "id": 3,
        "text": "Serum C-reactive protein"
      },
      {
        "id": 4,
        "text": "Serum creatinine"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario is suggestive of <strong>multiple myeloma.</strong> The <strong>most powerful </strong>prognostic indicator of this condition at the time of diagnosis is <strong>serum &beta;2 microglobulin</strong>.</p>\n<p>Beta-2 microglobulin is a <strong>low-molecular-weight</strong> protein found on the surface of all nucleated cells. It is the light chain of the HLA histocompatibility complex.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not associated with poor prognosis in a patient with multiple myeloma?",
    "choices": [
      {
        "id": 1,
        "text": "t(4;14)"
      },
      {
        "id": 2,
        "text": "High serum beta-2 microglobulin"
      },
      {
        "id": 3,
        "text": "Low serum albumin"
      },
      {
        "id": 4,
        "text": "t(11;14)"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>t(11;14)</strong> is associated with a<strong> good prognosis</strong> in patients with myeloma.</p>\n<p>t(4;14), <strong>high serum beta-2 microglobulin</strong>, and low serum albumin are all <strong>poor prognostic factors</strong> in myeloma.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 70-year-old man presents with chronic low back pain. On examination, he has pallor and bony tenderness. A skeletal radiographic survey reveals several punched-out lytic lesions. Serum protein electrophoresis shows an M band in the gamma globulin region. Which of the following is not associated with a poor prognosis in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Translocation involving cyclin D1"
      },
      {
        "id": 2,
        "text": "t(14;16)"
      },
      {
        "id": 3,
        "text": "Deletions of 17p"
      },
      {
        "id": 4,
        "text": "t(14;20)"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario is highly suggestive of <strong>multiple myeloma</strong>. <strong>Translocations</strong> involving <strong>cyclin D1</strong> are associated with a <strong>good outcome</strong> in this condition.</p>\n<p>t(14;16), deletions of 17p, and t(14;20) are associated with a more aggressive course.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which among these is not diagnostic of monoclonal gammopathy of undetermined significance?",
    "choices": [
      {
        "id": 1,
        "text": "Serum M protein level < 3 g/dL"
      },
      {
        "id": 2,
        "text": "Bence-Jones proteins in urine"
      },
      {
        "id": 3,
        "text": "Bone marrow plasma cells <10%"
      },
      {
        "id": 4,
        "text": "Absence of lytic bone lesions"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Bence&ndash;Jones proteinuria</strong> is not diagnostic of monoclonal gammopathy of undetermined significance&nbsp;(MGUS) because it is seen in multiple myeloma also.</p>\n<p>MGUS is the most common monoclonal gammopathy.</p>\n<p>Diagnostic criteria of MGUS according to<strong> International Myeloma Working Group guidelines (2014):</strong></p>\n<ul style=\"list-style-type: disc;\">\n<li>Serum monoclonal protein &lt;3g/dL</li>\n<li>Clonal bone marrow plasma cells &lt; 10%</li>\n<li>Absence of end-organ damage such as hyper<strong>c</strong>alcemia, <strong>r</strong>enal failure, <strong>a</strong>nemia and <strong>b</strong>one lesions (<strong>CRAB</strong>)</li>\n<li>No amyloidosis</li>\n</ul>\n<p>The three distinct <strong>clinical types of MGUS </strong>are:</p>\n<ul>\n<li><strong>Non-IgM MGUS</strong>:\n<ul>\n<li>Most common subtype of MGUS</li>\n<li>Approximately 1% of patients with MGUS develop a symptomatic plasma cell neoplasm, usually multiple myeloma, per year</li>\n</ul>\n</li>\n<li><strong>IgM MGUS</strong>:\n<ul>\n<li>IgM MGUS accounts for approximately 15% of MGUS cases</li>\n<li>It can progress to Waldenstr&ouml;m macroglobulinemia, but progression to multiple myeloma is rare</li>\n<li>Bence&ndash;Jones proteinuria has been reported in approximately 20% of these cases</li>\n</ul>\n</li>\n<li><strong>Light chain MGUS (LC-MGUS)</strong>:\n<ul>\n<li>LC-MGUS is a unique subtype of MGUS in which there is no immunoglobulin heavy-chain component</li>\n<li>Urinary M protein &lt;500 mg/24 hour</li>\n<li>LC-MGUS may progress to light-chain smoldering multiple myeloma (idiopathic Bence&ndash;Jones proteinuria) and to light-chain multiple myeloma</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient with complaints of blurred vision, bleeding gums, and tingling sensation over the extremities is diagnosed with lymphoplasmacytic lymphoma. Which of the following immunoglobulins is this condition associated with?",
    "choices": [
      {
        "id": 1,
        "text": "IgG"
      },
      {
        "id": 2,
        "text": "IgA"
      },
      {
        "id": 3,
        "text": "IgE"
      },
      {
        "id": 4,
        "text": "IgM"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>High levels of <strong>IgM</strong> are seen in<strong> lymphoplasmacytic lymphoma</strong>.</p>\n<p>In lymphoplasmacytic lymphoma, high levels of IgM lead to symptoms related to hyperviscosity of the blood. This is known as&nbsp;<strong>Waldenstrom&rsquo;s macroglobulinemia.&nbsp;</strong><em>&lsquo;</em>M&rsquo; or monoclonal spike is seen in this condition. Here, it is caused by IgM; in multiple myeloma, it is caused by IgG. It is characterized by the <strong>absence of lytic lesions</strong> and <strong>normal&nbsp;</strong><strong>serum calcium </strong>levels.</p>\n<p>IgM greatly increases the viscosity of the blood, giving rise to a hyperviscosity syndrome characterized by the following:</p>\n<ul>\n<li>Visual impairment</li>\n<li>Neurologic problems</li>\n<li>Bleeding</li>\n<li>Cryoglobulinemia</li>\n</ul>\n<p>The <strong>normal</strong> relative <strong>viscosity</strong> of the serum is <strong>1.8</strong>.</p>\n<p><strong>Hyperviscosity</strong> is seen in:</p>\n<ul>\n<li>Multiple myeloma</li>\n<li>Waldenstrom&rsquo;s macroglobulinemia</li>\n<li>Cryoglobulinemia</li>\n<li>Myeloproliferative disorders</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 40-year-old man is diagnosed with lymphoplasmacytic lymphoma. Which of the following genes is mutated in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "MYC"
      },
      {
        "id": 2,
        "text": "MYD88"
      },
      {
        "id": 3,
        "text": "SOX"
      },
      {
        "id": 4,
        "text": "RUNX1"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Virtually all cases of <strong>lymphoplasmacytic lymphoma</strong> are associated with acquired <strong>mutations </strong>in<strong> <em>MYD88</em></strong>.&nbsp;</p>\n<p>The&nbsp;<strong>most common </strong>cytogenetic abnormality associated with lymphoplasmacytic lymphoma is <strong>deletion of 6q</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not seen in patients with Waldenstrom macroglobulinemia?",
    "choices": [
      {
        "id": 1,
        "text": "M spike in serum protein electrophoresis"
      },
      {
        "id": 2,
        "text": "Increased serum calcium"
      },
      {
        "id": 3,
        "text": "Features due to organ infiltration"
      },
      {
        "id": 4,
        "text": "Absence of lytic lesions on imaging"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Serum calcium</strong> levels remain<strong> normal</strong> in&nbsp;Waldenstr&ouml;m macroglobulinemia.</p>\n<p><strong>Waldenstr&ouml;m macroglobulinemia</strong>&nbsp;is a syndrome characterised by the following:</p>\n<ul>\n<li><strong>Hyperviscosity </strong>syndrome&nbsp;due to&nbsp;<strong>high levels of IgM</strong></li>\n<li>Most commonly occurs in association with lymphoplasmacytic lymphoma</li>\n<li><em>&lsquo;</em>M&rsquo; or monoclonal spike</li>\n<li><strong>Absence of lytic lesions</strong></li>\n<li><strong>Normal serum</strong> <strong>calcium</strong> levels</li>\n<li>Diffuse marrow infiltration by plasma cells, plasmacytoid lymphocytes, and lymphocytes (all from the same clone)</li>\n<li>Cells <strong>do not form tumor </strong>masses or produce lytic lesions</li>\n<li>Lymphocytes commonly contain <strong>Dutcher bodies (intranuclear inclusions)</strong></li>\n<li>Bence&ndash;Jones proteins in 20&ndash;30%</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is the most common site for extramedullary plasmacytoma?",
    "choices": [
      {
        "id": 1,
        "text": "Gastrointestinal system"
      },
      {
        "id": 2,
        "text": "Upper respiratory tract"
      },
      {
        "id": 3,
        "text": "Genitourinary system"
      },
      {
        "id": 4,
        "text": "Central nervous system"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Extramedullary plasmacytomas are seen in<strong> the upper respiratory tract</strong>.&nbsp;Most&nbsp;of them are seen in the nasopharynx, oropharynx, sinuses, and larynx.</p>\n<p><strong>Plasmacytoma</strong> is a tumor of plasma cells of bony or soft tissue. It can occur anywhere in the body without evidence of systemic disease.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is Seligmann's disease?",
    "choices": [
      {
        "id": 1,
        "text": "\u03b1- heavy chain disease"
      },
      {
        "id": 2,
        "text": "\u03b3- heavy chain disease"
      },
      {
        "id": 3,
        "text": "\u03bc- heavy chain disease"
      },
      {
        "id": 4,
        "text": "\u03b2- heavy chain disease"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>&alpha;- heavy</strong> chain disease (HCD) is known as <strong>Seligmann's disease</strong>.</p>\n<p>There are three heavy chain diseases:</p>\n<ul>\n<li><strong>&alpha;- heavy</strong> chain disease -&nbsp; <strong>Seligmann's disease</strong></li>\n<li><strong>&gamma;- heavy</strong> chain disease -&nbsp;<strong>&nbsp;Franklin's disease</strong></li>\n<li><strong>&mu;- heavy</strong> chain disease - Associated with light-chain secretion (Bence&ndash;Jones proteinuria) in a few cases</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 60-year-old man presents with a history of bone pain, weakness, and loss of weight for 3 years. On examination, enlarged lymph nodes and organomegaly are noted. Peripheral smear shows 22% plasma cells, which are \u03bb-chain restricted. Serum IgE level is elevated. X-ray image of the lumbar vertebra shows lytic punched-out lesions. What is the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Multiple myeloma"
      },
      {
        "id": 2,
        "text": "Plasmacytoma"
      },
      {
        "id": 3,
        "text": "Lymphoplasmacytic lymphoma"
      },
      {
        "id": 4,
        "text": "Plasma cell leukemia"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical scenario points to the diagnosis of<strong> plasma cell leukemia</strong>. In this case, the peripheral blood smear shows <strong>22% of plasma cells </strong>and<strong> </strong>presents with <strong>organomegaly</strong>.</p>\n<p>Plasma cell leukemia is defined by the observation in blood of <strong>more than 20% clonal plasma cells</strong> by differential count of the leucocytes or by counting <strong>more than 2\u2009\u00d7\u200910<sup>9</sup>\u00a0per liter circulating clonal plasma cells.\u00a0</strong>Plasma cell leukemia (PCL) is a <strong>rare and aggressive form</strong> of leukemia and plasma cell dyscrasia. PCL can be divided into primary PCL (PCL) and secondary PCL (sPCL) following previously diagnosed multiple myeloma (MM); the latter typically occurring at a late and advanced stage of MM.</p>\n<p>Patients with plasma cell leukemia are more likely to have <strong>extramedullary involvement of liver and spleen</strong>, causing organomegaly than in multiple myeloma. (Option A)</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '32 Multiple Myeloma And Plasma Cell Disorders';
        let hierarchy = ["Marrow", "qBank", "Pathology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>