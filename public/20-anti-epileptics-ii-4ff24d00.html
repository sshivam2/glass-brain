<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>20 Anti-Epileptics Ii - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Pharmacology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">26</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following anti-epileptics is an AMPA glutamate receptor antagonist?",
    "choices": [
      {
        "id": 1,
        "text": "Levetiracetam"
      },
      {
        "id": 2,
        "text": "Brivaracetam"
      },
      {
        "id": 3,
        "text": "Perampanel"
      },
      {
        "id": 4,
        "text": "Rufinamide"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Perampanel </strong>is a selective non-competitive<strong> antagonist of the AMPA-type glutamate receptor.</strong> It is approved for adjunctive therapy of <strong>focal-onset</strong> seizures.</p>\n<p>Options A and B: Levetiracetam and brivaracetam act on SV2A proteins and modulates GABA and glutamate release.</p>\n<p>Option D: Rufinamide acts on voltage-gated sodium channels.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following mechanisms of action is observed with levetiracetam?",
    "choices": [
      {
        "id": 1,
        "text": "GABA transaminase inhibition"
      },
      {
        "id": 2,
        "text": "GABA transporter inhibition"
      },
      {
        "id": 3,
        "text": "Binding to synaptic vesicular protein SV2A"
      },
      {
        "id": 4,
        "text": "Inhibition of neuronal sodium channel"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Levetiracetam </strong>has a binding affinity to synaptic vesicular<strong> protein SV2A.&nbsp;</strong>SV2A plays a role in vesicle recycling following exocytosis of neurotransmitter</p>\n<p>When levetiracetam bind to this synaptic vesicular protein, it decreases the <strong>release</strong> of excitatory neurotransmitter <strong>glutamate</strong> thus <strong>preventing seizures.</strong>&nbsp;</p>\n<p>Levetiracetam also&nbsp;<strong>inhibits N-type Ca2+ channels</strong> and Ca2+ release from intracellular stores.Thus, it is considered a <strong>broad-spectrum</strong> antiepileptic as it has an effect on multiple channels.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A known epileptic patient on levetiracetam has been seizure-free for 2 years. But he develops agitation and anger issues interfering with his day-to-day activities as a result of the drug intake. Which of the following measures is to be taken next?",
    "choices": [
      {
        "id": 1,
        "text": "Slowly taper the drug over next 6 months"
      },
      {
        "id": 2,
        "text": "Continue levetriacetam since a 5 year seizure free interval is needed"
      },
      {
        "id": 3,
        "text": "Stop levetiracetam and start on a different anti-epileptic"
      },
      {
        "id": 4,
        "text": "Discontinue the drug as he is seizure free"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The mood changes observed in the above patient must be due to an adverse effect of levetiracetam. <strong>Abrupt stoppage</strong> of the drug can result in <strong>rebound</strong> seizures. So the best management will be to <strong>slowly taper the drug</strong> over the <strong>next 6 months</strong>.</p>\n<p style=\"text-align: justify;\">Adverse effects of <strong>levetiracetam</strong>:</p>\n<ul>\n<li>Somnolence</li>\n<li style=\"text-align: justify;\">Asthenia</li>\n<li style=\"text-align: justify;\">Ataxia</li>\n<li style=\"text-align: justify;\">Dizziness.</li>\n<li style=\"text-align: justify;\"><strong>Mood and behavioral changes</strong></li>\n<li style=\"text-align: justify;\">Psychotic reactions (rare)</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Tiagabine has been initiated as an adjunctive treatment for focal seizures in a patient. What is the mechanism of action of this drug?",
    "choices": [
      {
        "id": 1,
        "text": "Inhibiting GABA transaminase"
      },
      {
        "id": 2,
        "text": "Increasing GABA synthesis"
      },
      {
        "id": 3,
        "text": "Inhibiting GABA transporter"
      },
      {
        "id": 4,
        "text": "Inhibiting glutamate release"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Tiagabine</strong>&nbsp;acts by inhibiting<strong>&nbsp;</strong>the<strong> GAT1 GABA transporter,</strong>&nbsp;thereby <strong>reducing</strong> its <strong>reuptake</strong> into neurons<strong>.</strong> It also increases the duration of inhibitory impulses in the synapse by prolonging the action of GABA.</p>\n<p>Tiagabine is approved as an <strong>add-on</strong> therapy for <strong>refractory partial seizures</strong> with or without generalization.</p>\n<p>Other antiepileptic drugs that have <strong>GABA enhancing activity</strong> are <strong>vigabatrin</strong> and <strong>stiripentol</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 25-year-old patient diagnosed with Lennox-Gastaut syndrome was prescribed a drug with NMDA antagonist activity. Identify the drug.",
    "choices": [
      {
        "id": 1,
        "text": "Memantine"
      },
      {
        "id": 2,
        "text": "Riluzole"
      },
      {
        "id": 3,
        "text": "Ketamine"
      },
      {
        "id": 4,
        "text": "Felbamate"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Felbamate</strong> is the<strong>\u00a0NMDA receptor antagonist </strong>prescribed to this patient. It\u00a0also potentiates GABA action. It is indicated in refractory primary or secondary generalized seizures and <strong>Lennox-Gastaut syndrome.</strong></p>\n<p>Felbamate is associated with aplastic anemia and liver failure.</p>\n<p>Option A: Memantine is used in Alzheimer\u2019s disease.</p>\n<p>Option B: Riluzole is used in amyotrophic lateral sclerosis.</p>\n<p>Option C<strong>:</strong> Ketamine causes dissociative anesthesia and used in general anesthesia.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An antiepileptic agent which acts by opening neuronal potassium channels was prescribed to a patient admitted to the neurology ward. On discharge, the patient was asked to have a regular ophthalmological examination every 6 months. Which drug is most likely prescribed?",
    "choices": [
      {
        "id": 1,
        "text": "Ezogabine"
      },
      {
        "id": 2,
        "text": "Rufinamide"
      },
      {
        "id": 3,
        "text": "Vigabatrin"
      },
      {
        "id": 4,
        "text": "Gabaculine"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Ezogabine</strong> (retigabine) acts by <strong>opening</strong> <strong>neuronal</strong> <strong>potassium channels</strong>. By opening the K<sup>+</sup> channels, stabilizes the resting membrane potential and reduces the excitability of the nerve membrane.</p>\n<p>FDA recommends that patients on chronic ezogabine therapy need <strong>visual acuity</strong> and <strong>fundus</strong>&nbsp;<strong>examination</strong>&nbsp;every 6 months due to the possibility&nbsp;of <strong>retinal abnormalities.</strong>&nbsp; &nbsp;</p>\n<p>Option B:<strong>&nbsp;</strong>Rufinamide acts by prolonging an inactive state of the Na<sup>+</sup> channel.</p>\n<p>Option C:&nbsp; Vigabatrin is a GABA transaminase inhibitor.</p>\n<p>Option D: Gabaculine is an irreversible GABA reuptake inhibitor, that has only experimental value, due to high toxicity.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "All of the following statements are true about zonisamide except:",
    "choices": [
      {
        "id": 1,
        "text": "Indicated in focal seizures"
      },
      {
        "id": 2,
        "text": "Nephrolithiasis is not a side effect"
      },
      {
        "id": 3,
        "text": "Inhibits T type calcium channel"
      },
      {
        "id": 4,
        "text": "Blocks low voltage gated Na+ channel"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p style=\"text-align: justify;\"><strong>Nephrolithiasis</strong>&nbsp;is a side effect of <strong>zonisamide</strong>.</p>\n<p style=\"text-align: justify;\">Zonisamide is a broad-spectrum antiepileptic, that acts by blocking low voltage Na+ channels and T type calcium channels.&nbsp;It also has <strong>carbonic anhydrase inhibiting activity</strong> that may result in metabolic acidosis and the formation of renal stones.</p>\n<p style=\"text-align: justify;\">It is used in the treatment of <strong>focal seizures.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Patients on which of the following antiepileptic drugs will experience weight loss?",
    "choices": [
      {
        "id": 1,
        "text": "Sodium valproate"
      },
      {
        "id": 2,
        "text": "Vigabatrin"
      },
      {
        "id": 3,
        "text": "Topiramate"
      },
      {
        "id": 4,
        "text": "Carbamazepine"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Topiramate</strong> causes <strong>weight loss</strong> as one of its common side effects.&nbsp;</p>\n<p>Topiramate has mixed mechanisms of action<strong>:</strong></p>\n<ul>\n<li>Reduces voltage gate Na+ currents</li>\n<li>Activates hyperpolarizing K+ currents</li>\n<li>Enhances postsynaptic GABAA current</li>\n<li>Limits the activation of AMPA subtype of glutamate receptors.</li>\n</ul>\n<p>Topiramate is used in <strong>focal seizures, GTCS </strong>and<strong>&nbsp;Lennox-Gastaut syndrome</strong>.</p>\n<p>The side effects:&nbsp;</p>\n<ul>\n<li>Cognitive impairment</li>\n<li><strong>Weight loss</strong></li>\n<li>Fatigue</li>\n<li>Renal calculi</li>\n</ul>\n<p>Sodium valproate, vigabatrin (highest incidence), and carbamazepine cause <strong>weight gain.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 55-year-old patient presented to the OPD with complaints of pain over a healed dermatomal rash on his lateral chest wall. Gabapentin was prescribed to this patient. The analgesic activity of this drug is mainly exerted by which of the following?",
    "choices": [
      {
        "id": 1,
        "text": "Increasing the duration of GABA Cl- channel opening"
      },
      {
        "id": 2,
        "text": "Inhibiting the GABA transaminase enzyme"
      },
      {
        "id": 3,
        "text": "Inhibiting the uptake of GABA at the presynaptic membrane"
      },
      {
        "id": 4,
        "text": "Inhibiting the Ca2+ channel current"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p style=\"text-align: justify;\"><strong>Gabapentin</strong> exerts its analgesic activity by <strong>inhibiting</strong> the<strong> Ca2+ channel current</strong> in this patient who is most likely suffering from <strong>post-herpetic neuralgia.</strong></p>\n<p class=\"p1\" style=\"text-align: justify;\">Gabapentin and pregabalin have close structural similarity to GABA. Still, they <strong>do not act through the effects of GABA receptors</strong> or&nbsp;any other mechanism related to GABA-mediated neurotransmission.&nbsp;</p>\n<p class=\"p1\" style=\"text-align: justify;\">They inhibit the calcium channel current which decreases the entry of calcium in the presynaptic neuron. When calcium entry in the neuron is reduced, there is a decrease in the release of glutamate. This lowers the excitability of the neuron, thus reducing seizure activity.</p>\n<p class=\"p1\" style=\"text-align: justify;\">Therapeutic use of these drugs:&nbsp; &nbsp; &nbsp;</p>\n<p class=\"p1\" style=\"text-align: justify;\"><strong>Gabapentin</strong>: Focal seizures, postherpetic neuralgia pain</p>\n<p class=\"p1\" style=\"text-align: justify;\"><strong>Pregabalin</strong>: Focal seizures,&nbsp;postherpetic neuralgia pain,&nbsp;diabetic neuropathy pain, spinal cord injury pain, fibromyalgia pain.</p>\n<p class=\"p1\">&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An infant presents with sudden jerky movements of the head, neck and arms. On EEG evaluation, a characteristic pattern of hypsarrhythmia is observed. Which is the GABA transaminase inhibitor approved for the treatment of this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Vigabatrin"
      },
      {
        "id": 2,
        "text": "Tiagabine"
      },
      {
        "id": 3,
        "text": "Progabide"
      },
      {
        "id": 4,
        "text": "Pregabalin"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario along with<strong> hypsarrytmia </strong>on EEG is suggestive of <strong>West syndrome.&nbsp;</strong><strong>Vigabatrin</strong> is an <strong>inhibitor </strong>of the<strong> GABA transaminase </strong>that can be used in this condition.&nbsp;</p>\n<p>Inhibition of the enzyme GABA transaminase leads to an increase in the concentration of GABA in the synaptic cleft which is an&nbsp;inhibitory neurotransmitter. This contributes to its anticonvulsant property of vigabatrin.&nbsp;</p>\n<p>West syndrome is a rare type of<strong> epilepsy syndrome</strong> that begins in <strong>infancy</strong>. It is characterized by a triad of:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Infantile seizures (also called salaam spells)</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Developmental regression</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Hypsarrhythmia i.e Himalayan wave pattern on EEG</li>\n</ul>\n<p style=\"text-align: justify;\">Treatment of West syndrome includes:</p>\n<ul>\n<li style=\"text-align: justify;\">ACTH</li>\n<li>Vigabatrin if associated with<strong> tuberous sclerosis</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the drug of choice in the treatment of infantile spasms?",
    "choices": [
      {
        "id": 1,
        "text": "ACTH"
      },
      {
        "id": 2,
        "text": "Phenobarbitone"
      },
      {
        "id": 3,
        "text": "Carbemazepine"
      },
      {
        "id": 4,
        "text": "Vigabatrin"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The <strong>drug of choice</strong> in the treatment of <strong>infantile spasms</strong> or West syndrome is <strong>adrenocorticotropic hormone</strong> (ACTH.)</p>\n<p>The mechanism of action of ACTH or glucocorticoids is unknown but may involve a reduction in inflammatory processes. <strong>Vigabatrin</strong> is used if the spasms are associated with <strong>tuberous sclerosis</strong>.&nbsp;</p>\n<p>Other antiseizure medications that may be helpful are valproate, topiramate, zonisamide, or benzodiazepines.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which antiepileptic drug is associated with permanent visual loss?",
    "choices": [
      {
        "id": 1,
        "text": "Topiramate"
      },
      {
        "id": 2,
        "text": "Ethosuximide"
      },
      {
        "id": 3,
        "text": "Vigabatrin"
      },
      {
        "id": 4,
        "text": "Felbamate"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Vigabatrin</strong> is associated with <strong>progressive</strong> and <strong>permanent visual loss.</strong></p>\n<p>It is a <strong>GABA transaminase inhibitor</strong> indicated in:</p>\n<ul>\n<li>West syndrome associated with tuberous sclerosis</li>\n<li>Refractory focal seizures with impaired awareness.&nbsp; &nbsp;</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following antiepileptic drugs are approved for prophylaxis in patients suffering from migraines?",
    "choices": [
      {
        "id": 1,
        "text": "2, 3 and 4"
      },
      {
        "id": 2,
        "text": "3 and 5"
      },
      {
        "id": 3,
        "text": "1, 4 and 5"
      },
      {
        "id": 4,
        "text": "1 and 3"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Sodium valproate,</strong>&nbsp;<strong>topiramate </strong>and gabapentin&nbsp;are approved anti-epileptics for use in <strong>prophylaxis of migraine</strong>.</p>\n<p>Carbamazepine, phenytoin and rufinamide are not used for prophylaxis of a migraine.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 22-year-old female is brought to the casualty with seizures for the past 10 minutes. History from relatives suggests no seizure-free intervals in the past 10 minutes. After stabilizing the vitals of the patient, which is the first drug you administer to the patient?",
    "choices": [
      {
        "id": 1,
        "text": "Lorazepam"
      },
      {
        "id": 2,
        "text": "Diazepam"
      },
      {
        "id": 3,
        "text": "Phenobarbitone"
      },
      {
        "id": 4,
        "text": "Thiopentone sodium"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>This scenario described above is of&nbsp;<strong>status epilepticus</strong>. The first drug used in the management is <strong>lorazepam.</strong></p>\n<p>Status epilepticus refers to <strong>continuous</strong> seizures or <strong>repetitive</strong>, <strong>discrete</strong> seizures with <strong>impaired consciousness</strong> in the inter-ictal period. For practical purposes, it is defined as any one of the following:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Continuing seizures &gt;5 minutes or</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">No regaining of consciousness between 2 seizures.</li>\n</ul>\n<p>Management of status epilepticus:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0c41b7774f474be49e4a076917ec371cx1096x1496.PNG"
    ]
  },
  {
    "text": "A 25-year-old newly married female comes to the OPD with a positive urine pregnancy test. Her history is suggestive of antiepileptic use since 8 years. Which of the following statements is incorrect about further management in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Anti epileptic agents has to be continued at stabilised doses"
      },
      {
        "id": 2,
        "text": "Immediately stop antiepileptics once pregnancy is detected"
      },
      {
        "id": 3,
        "text": "Folate supplementation is a must"
      },
      {
        "id": 4,
        "text": "No antiepiletic is deemed safe in pregnancy"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Stopping antiepileptics abruptly</strong> once pregnancy is detected in this patient is <strong>not recommended</strong>. If this is done, then there is a lot of <strong>risk</strong> to the <strong>fetus</strong> by uncontrolled seizures and can result in <strong>anoxia</strong> and <strong>intellectual disability.</strong> Antiepileptics have to be continued and then the <strong>dose</strong> can be<strong> tapered slowly</strong> if there are no episodes of seizures.</p>\n<p>Management of seizures in pregnancy:&nbsp;</p>\n<ul>\n<li>If the patient is a known case of seizure and is on any antiepileptic drug: The same prescribed drug is continued</li>\n<li>If the first episode occurs during pregnancy: The drug preferred is either <strong>lamotrigine</strong> or <strong>levetiracetam</strong></li>\n<li><strong>Folic acid</strong> (1-4 mg/day) should be given to all</li>\n</ul>\n<p>No antiepileptic is deemed safe in pregnancy. So, it is important to have the patient on <strong>monotherapy</strong> at the <strong>lowest effective dose</strong>, especially during the <strong>first trimester.</strong>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An infant is born with a birth defect as shown in the image below. It is the most common teratogenic effect of:",
    "choices": [
      {
        "id": 1,
        "text": "Phenytoin"
      },
      {
        "id": 2,
        "text": "Topiramate"
      },
      {
        "id": 3,
        "text": "Sodium valproate"
      },
      {
        "id": 4,
        "text": "Phenobarbital"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The above illustration is suggestive of an infant with<strong> spina bifida</strong> of the open type which is the <strong>most common teratogenic</strong> effect of <strong>sodium valproate.</strong>&nbsp;</p>\n<p>Option A: Phenytoin is usually associated with fetal hydantoin syndrome.&nbsp;</p>\n<p>Option B: Topiramate has shown growth defects in animal studies and hypospadias have been shown in the male fetus but the definite relationship is lacking.</p>\n<p>Option D: Phenobarbital has teratogenic effects similar to phenytoin.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ba16aff3a87f412ab13b9cea93dcd207.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which is the treatment of choice for juvenile myoclonic epilepsy in pregnancy?",
    "choices": [
      {
        "id": 1,
        "text": "Levetiracetam"
      },
      {
        "id": 2,
        "text": "Carbamazepine"
      },
      {
        "id": 3,
        "text": "Vigabatrin"
      },
      {
        "id": 4,
        "text": "Phenytoin"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The drug of choice for <strong>juvenile myoclonic epilepsy</strong>&nbsp;(JME) in pregnancy is <strong>levetiracetam</strong>. <strong>Lamotrigine</strong>&nbsp;or levetiracetam are <strong>alternative</strong> first-line in pregnancy as they have fewer teratogenic effects.</p>\n<p>The drug of choice for JME is <strong>valproate</strong>.&nbsp;However, in pregnant women or women of childbearing age, valproate should be avoided because of the increased risks of fetal malformations and neurodevelopmental delay.</p>\n<p>Carbamazepine, vigabatrin, and phenytoin are <strong>not indicated</strong> in juvenile myoclonic epilepsy as they may <strong>worsen myoclonic jerks</strong> and<strong> absence</strong> <strong>seizures.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 29-year-old primigravida, at 4-months period of gestation and history of juvenile myoclonic epilepsy, visits your clinic. She has been regularly taking sodium valproate and is now concerned about the medication possibly affecting her child. What would you suggest to this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Immediately taper valproate and start lamotrigine"
      },
      {
        "id": 2,
        "text": "Continue valproate with serial drug monitoring"
      },
      {
        "id": 3,
        "text": "Switch to carbamazepine"
      },
      {
        "id": 4,
        "text": "Add lamotrigine to valproate"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In the given scenario, the patient should be advised to <strong>continue valproate</strong>, and <strong>serial drug monitoring</strong> should be done.&nbsp;</p>\n<p>Valproate has a higher teratogenic potential. It is usually avoided before conception if other antiepileptics with less teratogenicity (lamotrigine. levetiracetam) can be used. But for a woman who is <strong>pregnant</strong> and is already taking valproate, <strong>changing the drug</strong> is <strong>not recommended</strong>.</p>\n<p>Option A - The patient is presenting in the <strong>second trimester</strong> when organogenesis would have been complete. Therefore, tapering the drug and introducing lamotrigine is not an option as precipitating seizures has a greater risk of fetal harm at this stage.</p>\n<p>Option C: Carbamazepine is not indicated in JME as it may worsen the myoclonic jerks and absence seizures.&nbsp;</p>\n<p>Option D- Adding additional drugs to stabilized doses may increase teratogenicity. So adding lamotrigine to valproate is also not a viable option.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is recommended for prophylaxis in a pregnant woman who is on anti-epileptic drugs with an enzyme-inducing property?",
    "choices": [
      {
        "id": 1,
        "text": "Vitamin K"
      },
      {
        "id": 2,
        "text": "Anti D immunoglobulin"
      },
      {
        "id": 3,
        "text": "Indomethacin"
      },
      {
        "id": 4,
        "text": "Prostacyclin"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p style=\"text-align: justify;\"><strong>Vitamin K</strong>&nbsp;is recommended for <strong>prophylaxis</strong> in pregnant women who are on <strong>antiepileptic drugs</strong> having <strong>enzyme-inducing properties.</strong></p>\n<p style=\"text-align: justify;\">Antiepileptic drugs with enzyme inducing properties:</p>\n<ul>\n<li style=\"text-align: justify;\">Phenytoin</li>\n<li style=\"text-align: justify;\">Carbamazepine</li>\n<li style=\"text-align: justify;\">Oxcarbazepine</li>\n<li style=\"text-align: justify;\">Topiramate</li>\n<li style=\"text-align: justify;\">Phenobarbital</li>\n<li style=\"text-align: justify;\">Primidone</li>\n</ul>\n<p>They <strong>induce CYP enzymes</strong> that interfere with the <strong>metabolism</strong> of <strong>vitamin K</strong>. Deficiency of vitamin K-dependent clotting factors can occur in the newborn leading to <strong>coagulopathy</strong> and intracerebral <strong>hemorrhage</strong>.</p>\n<p style=\"text-align: justify;\">Although hemorrhage is uncommon, the <strong>mother</strong> should be treated with <strong>oral vitamin K, </strong>20 mg/day in the last two weeks of pregnancy. The <strong>infant</strong> should receive an <strong>intramuscular injection of vitamin K</strong> (1 mg) at birth.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following antiepileptics is effective in Lennox-Gastaut syndrome, but shows the highest propensity to cause rashes in young children warranting its withdrawal?",
    "choices": [
      {
        "id": 1,
        "text": "Sodium valproate"
      },
      {
        "id": 2,
        "text": "Levetiracetam"
      },
      {
        "id": 3,
        "text": "Lamotrigine"
      },
      {
        "id": 4,
        "text": "Vigabatrin"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Lamotrigine</strong> is effective in <strong>Lennox-Gastaut syndrome</strong> and has the highest propensity to cause <strong>rashes in young children</strong>.</p>\n<p>Lamotrigine is also associated with toxic epidermal necrosis and <strong>Stevens-Johnson Syndrome</strong> in some patients. The incidence of serious rash and other serious skin conditions is higher with lamotrigine than other anti-epileptics provided in the options. The occurrence of <strong>rash warrants</strong>&nbsp;the<strong> stoppage</strong> of the drug.&nbsp;</p>\n<p>Option A: Sodium valproate is the drug of choice in Lennox-Gastaut syndrome. It can cause fulminant hepatitis especially in children &lt; 2 years.</p>\n<p>Option B: Levetiracetam is also effective in most of the seizures present in Lennox-Gastaut syndrome. It can increase blood pressure in children &lt; 4 years.</p>\n<p>Option D: Vigabatrin is also effective in Lennox-Gastaut syndrome, especially as an&nbsp;add-on therapy. It can cause permanent visual field defects.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Patients receiving which of the following anti-microbial drugs are least likely to develop seizures?",
    "choices": [
      {
        "id": 1,
        "text": "Beta lactam compounds"
      },
      {
        "id": 2,
        "text": "Quinolones"
      },
      {
        "id": 3,
        "text": "Macrolides"
      },
      {
        "id": 4,
        "text": "Isoniazid"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Macrolides</strong> are the <strong>least likely</strong> anti-microbial out of the given options to cause <strong>seizures.</strong></p>\n<p><strong>Antimicrobials associated</strong> with <strong>causing seizures:&nbsp;</strong></p>\n<ul>\n<li>Beta-lactam and related compounds</li>\n<li>Quinolones</li>\n<li>Acyclovir</li>\n<li>Isoniazid</li>\n<li>Ganciclovir</li>\n</ul>\n<p>Other groups of <strong>drugs</strong> that are <strong>implicated</strong> in causing <strong>epilepsy:</strong></p>\n<ul>\n<li>Alkylating agents - busulfan, chlorambucil</li>\n<li>Antimalarials - chloroquine, mefloquine</li>\n<li>Anesthetics/ analgesics - meperidine, fentanyl, tramadol, local anesthetics</li>\n<li>Immunomodulatory drugs - cyclosporine, tacrolimus, interferons</li>\n<li>Psychotropics:\n<ul>\n<li>Antidepressants - bupropion</li>\n<li>Antipsychotics - clozapine</li>\n<li>Anti-manic drugs - lithium</li>\n</ul>\n</li>\n<li>Drugs of abuse - amphetamine, cocaine, phencyclidine, methylphenidate</li>\n<li>Miscellaneous - Theophylline, memantine.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following drugs of abuse is least likely to be associated with seizures?",
    "choices": [
      {
        "id": 1,
        "text": "Amphetamine"
      },
      {
        "id": 2,
        "text": "Cocaine"
      },
      {
        "id": 3,
        "text": "Cannabinoids"
      },
      {
        "id": 4,
        "text": "Phencyclidine"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Cannabinoids </strong>are being investigated for the <strong>treatment</strong> of various types of <strong>epilepsy</strong> and are <strong>least likely</strong> to <strong>cause</strong> seizures.</p>\n<p>Drugs of <strong>abuse</strong> that are <strong>implicated</strong> in causing <strong>seizures</strong> are:&nbsp;</p>\n<ul>\n<li>Amphetamine</li>\n<li>Cocaine</li>\n<li>Phencyclidine</li>\n<li>Methylphenidate</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient presented to the OPD with a skin rash for 3 days. He gives a history of antiepileptic drug use for 2 months and is ataxic on examination. He is diagnosed to have Stevens-Johnson syndrome. Which of the following drugs are implicated in these adverse effects?",
    "choices": [
      {
        "id": 1,
        "text": "Phenobarbital"
      },
      {
        "id": 2,
        "text": "Lamotrigine"
      },
      {
        "id": 3,
        "text": "Topiramate"
      },
      {
        "id": 4,
        "text": "Ethosuximide"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Lamotrigine</strong> is known to cause such adverse effects in patients.</p>\n<p>Adverse effects of lamotrigine:</p>\n<ul>\n<li>Skin rash</li>\n<li>Stevens-Johnson syndrome</li>\n<li>Dizziness</li>\n<li>Diplopia</li>\n<li>Sedation</li>\n<li>Ataxia</li>\n<li>Headache</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following drugs if used can lead to behavioral effects such as aggression?",
    "choices": [
      {
        "id": 1,
        "text": "Phenytoin"
      },
      {
        "id": 2,
        "text": "Phenobarbitone"
      },
      {
        "id": 3,
        "text": "Levetiracetam"
      },
      {
        "id": 4,
        "text": "Pregabalin"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Children </strong>who are on<strong> levetiracetam </strong>have a <strong>higher risk </strong>of developing several behavioral side-effects such as<strong> aggression</strong>, hostility, and nervousness compared to children who do not use levetiracetam.</p>\n<p>These side effects are seen in less frequency with <strong>brivaracetam</strong>.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following drug is approved for use in fibromyalgia?",
    "choices": [
      {
        "id": 1,
        "text": "Gabapentin"
      },
      {
        "id": 2,
        "text": "Pregabalin"
      },
      {
        "id": 3,
        "text": "Tiagabine"
      },
      {
        "id": 4,
        "text": "Topiramate"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Pregabalin</strong> is approved for use in <strong>fibromyalgia</strong>. It is also approved for use in diabetic peripheral neuropathy.</p>\n<p>Mechanism of analgesic action:</p>\n<ul>\n<li>Interacts at the binding site of the alpha, delta subunit&nbsp;of voltage-dependent Ca2+ channels</li>\n<li>Correlates with decreased Ca2+ channel function&nbsp;and release of neurotransmitters</li>\n<li>Decreased neurotransmitter release is associated&nbsp;with reduced neuronal hyperexcitability.</li>\n</ul>\n<p>Options A and C: Gabapentin and tiagabine are also useful in fibromyalgia but are not approved for this indication and are used off-label.</p>\n<p>Option D: Topiramate's efficacy is not encouraging in fibromyalgia and neuropathic pain.</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the first-line treatment for infantile spasms associated with tuberous sclerosis?",
    "choices": [
      {
        "id": 1,
        "text": "ACTH"
      },
      {
        "id": 2,
        "text": "Vigabatrin"
      },
      {
        "id": 3,
        "text": "Glucocorticoids"
      },
      {
        "id": 4,
        "text": "Sodium valproate"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Vigabatrin </strong>is particularly effective in <strong>infantile spasms</strong> associated with <strong>tuberous sclerosis</strong> and is considered the first-line treatment in this condition.</p>\n<p><strong>ACTH</strong> is considered to be the drug of choice for <strong>infantile spasms</strong> that are <strong>not associated</strong> with <strong>tuberous sclerosis.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '20 Anti-Epileptics Ii';
        let hierarchy = ["Marrow", "qBank", "Pharmacology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>