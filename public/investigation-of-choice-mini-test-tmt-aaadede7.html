<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Investigation Of Choice Mini Test - -Tmt - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2023-24
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "The radiological investigation of choice for avascular necrosis of bone is ________",
    "choices": [
      {
        "id": 1,
        "text": "X-ray"
      },
      {
        "id": 2,
        "text": "CT"
      },
      {
        "id": 3,
        "text": "MRI"
      },
      {
        "id": 4,
        "text": "Scintigraphy"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The<strong> investigation of choice</strong> for <strong>avascular necrosis</strong> of bone is<strong> MRI</strong> as initially, bone infarction occurs in the marrow.</p>\n<p>Avascular necrosis or&nbsp;<strong>osteonecrosis</strong>&nbsp;is a painful bone condition resulting from diminished blood supply mainly due to trauma or non-traumatic etiologies.&nbsp;</p>\n<p>The typical features are pain with movements in or near the joint, click in the joint, joint stiffness, limping gait, and deformity. Restriction of actions is also a feature of this condition.</p>\n<p>The radiograph shows reactive new bone formation,<strong>&nbsp;increased radiolucency</strong>&nbsp;in the subchondral bone, and&nbsp;a<strong>&nbsp;distorted articular surface</strong>. MRI has high sensitivity and specificity in diagnosis.</p>\n<p>Management in the early stages can involve osteotomy while in late stages pain control, splinting, arthrodesis and total or partial replacement are preferred.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 45-year-old alcoholic obese male patient presented to the emergency department with severe pain abdomen radiating to the back. Blood investigations revealed increased serum amylase and lipase levels. What is the investigation of choice for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Erect abdominal X-ray"
      },
      {
        "id": 2,
        "text": "CECT"
      },
      {
        "id": 3,
        "text": "Ultrasonography"
      },
      {
        "id": 4,
        "text": "MRI scan"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The clinical presentation of the patient is suggestive of <strong>acute pancreatitis</strong>. Contrast-enhanced computed tomography (<strong>CECT</strong>) is the <strong>imaging investigation of choice</strong>.&nbsp;</p>\n<p>Acute pancreatitis is a condition characterized by inflammatory damage to the pancreas. Various causes of acute pancreatitis are:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Gallstone-induced</strong> (most common cause)</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Alcohol</strong> (2nd most common cause)</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Trauma</strong> (most common cause in children)</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Iatrogenic- Post-endoscopic retrograde cholangiopancreatography (ERCP)</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Drug-induced pancreatitis (Thiazides, Azathioprine, Anti-cancer drugs, etc)</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Hypertriglyceridemia</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Hypercalcemia</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Scorpion bite</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Idiopathic</li>\n</ul>\n<p>Clinical presentation of acute pancreatitis is characterized by <strong>epigastric pain radiating</strong> to the <strong>back</strong> which is<strong> relieved by bending forward</strong>, nausea, and vomiting. Acute hemorrhagic pancreatitis can present with certain named signs like:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Cullen&rsquo;s sign</strong>: Discoloration around the umbilicus</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Grey Turner&rsquo;s sign</strong>: Discoloration in the flanks</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Fox sign</strong>: Discoloration in the inguinal region</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Bryant&rsquo;s sign</strong>: Discoloration on the scrotum</li>\n</ul>\n<p>Blood investigations show <strong>increased serum amylase </strong>and<strong> lipase levels</strong>. Serum lipase is more sensitive and specific than serum amylase but it rises late. USG cannot help establish the diagnosis of pancreatitis. Plain <strong>erect chest x-ray</strong> and <strong>abdominal radiographs</strong> are <strong>not diagnostic </strong>of acute pancreatitis and can only be used to rule out certain differentials. Contrast-enhanced computed tomography (<strong>CECT</strong>) is the <strong>imaging investigation of choice, </strong>but may not always be needed. Various scoring systems are used to grade the severity of acute pancreatitis based on blood investigations and radiographic findings.</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A pediatrician suspects vesicoureteric reflux in a girl with a history of recurrent urinary tract infections. What is the investigation of choice to confirm this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Ultrasound abdomen"
      },
      {
        "id": 2,
        "text": "MRI"
      },
      {
        "id": 3,
        "text": "Voiding cystourethrogram"
      },
      {
        "id": 4,
        "text": "DMSA scan"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Voiding cystourethrogram (VCUG)</strong>&nbsp;is the investigation of choice for&nbsp;<strong>vesicoureteral reflux.</strong></p>\n<p>Recurrent febrile urinary tract infections in a child should raise the suspicion of an anatomical defect like vesicoureteric reflux as the cause. Compared to other investigations, a<strong>&nbsp;VCUG</strong> provides more anatomic information. It can demonstrate:</p>\n<ul>\n<li>Vesicoureteral reflux</li>\n<li>Duplex collecting system</li>\n<li>Ectopic ureter</li>\n<li>Paraureteral (bladder) diverticulum</li>\n<li>Bladder outlet obstruction</li>\n<li>Signs of voiding dysfunction, such as a spinning top urethra</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 68-year-old hypertensive male patient presented with a sudden onset tearing type of chest pain, prompting suspicion of aortic dissection. On examination, the patient was hemodynamically unstable. What is the diagnostic modality of choice for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Transesophageal echocardiography"
      },
      {
        "id": 2,
        "text": "Chest X-ray"
      },
      {
        "id": 3,
        "text": "Contrast enhanced CT"
      },
      {
        "id": 4,
        "text": "MRI"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The <strong>diagnostic modality</strong> <strong>of choice</strong> in a <strong>hemodynamically unstable</strong> patient with <strong>suspected acute aortic dissection</strong> is <strong>transesophageal echocardiography.</strong></p>\n<p><strong>Transesophageal echocardiography</strong> can be done at the bedside in patients who are too <strong>unstable</strong> for transportation; it can give information about flow in the true and false lumen and shows very high sensitivity for confirmation of the aortic dissection. Currently, a <strong>CT scan is the initial best investigation</strong> for the diagnosis of aortic dissection in the&nbsp;<strong>hemodynamically stable</strong> patient. Additionally, it tells about the extent of the dissection.</p>\n<p><strong>Magnetic resonance imaging</strong> has perfect <strong>sensitivity</strong> and<strong> specificity</strong>&nbsp;making it one of the <strong>most accurate</strong> tools for the <strong>diagnosis</strong> of an aortic dissection. On an MRI the contrast between the lumen and aortic wall makes the detection of intimal flap easy.&nbsp;<strong>Multidetector computerized tomography</strong> (MDCT) provides very high image quality with much shorter acquisition times.</p>\n<p><strong>Aortic dissection&nbsp;</strong>occurs when a <strong>defect</strong> or flap occurs in the <strong>intima</strong> of the <strong>aorta.</strong></p>\n<p>Predisposing factors for aortic dissection are:</p>\n<ul>\n<li><strong>Age</strong></li>\n<li><strong>Hypertension</strong></li>\n<li><strong>Marfan syndrome</strong></li>\n<li>Pregnancy</li>\n<li>Other connective tissue disorders, for example, Ehlers&ndash;Danlos syndrome, giant cell arteritis, systemic lupus erythematosus</li>\n<li>Coarctation of the aorta</li>\n<li>Turner or Noonan syndromes</li>\n<li>Aortic cannulation site (iatrogenic)</li>\n</ul>\n<p>Clinical features:</p>\n<ul>\n<li>The most typical presentation of&nbsp;<strong>aortic dissection</strong>&nbsp;is a&nbsp;<strong>tearing interscapular pain.</strong></li>\n<li>The<strong>&nbsp;tracheal tug sign,</strong>&nbsp;also known as&nbsp;<strong>Oliver&rsquo;s sign,</strong>&nbsp;is seen in the&nbsp;<strong>arch</strong>&nbsp;of the&nbsp;<strong>aorta aneurysm</strong>.</li>\n<li>It is elicited by gently grasping the cricoid cartilage and applying upward pressure while the patient stands with their chin extended upward. Due to the anatomical position of the arch, which overrides the left main bronchus, a tug on the trachea is felt if an aneurysm is present. Therefore, it is also called the tracheal tug sign.</li>\n</ul>\n<p>The dissection can extend<strong>&nbsp;distally down</strong>&nbsp;the aorta to involve the:</p>\n<ul>\n<li><strong>Renal</strong> arteries (renal pain and renal failure)</li>\n<li><strong>Mesenteric</strong> arteries (abdominal pain and bowel ischemia)</li>\n<li><strong>Spinal</strong> arteries&nbsp;<strong>(paraplegia)</strong></li>\n<li><strong>Iliac</strong> arteries (leg pain, pallor, loss or reduced pulses, and limb ischemia).</li>\n</ul>\n<p>The dissection may track <strong>proximally</strong> to involve the:</p>\n<ul>\n<li><strong>Head</strong> and <strong>neck</strong> vessels (symptoms and signs of a stroke or transient ischaemic attack)</li>\n<li><strong>Coronary</strong> vessels (MI)</li>\n<li><strong>Aortic root</strong> (aortic regurgitation)</li>\n</ul>\n<p>The dissection may also result in aortic wall rupture into the pericardium (<strong>cardiac tamponade</strong>) or mediastinum (left haemothorax).</p>\n<p>Below is the CT image showing the<strong>&nbsp;double lumen of the aorta</strong> is suggestive of aortic dissection.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e4409973fc5f4c89ae55da7330571ff9x720x612.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3e5e423c826d4ffdad44509e35883891x1280x1241.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b881f8de772d4828a3cb443aa7995621x1280x3028.JPEG"
    ]
  },
  {
    "text": "A 40-year-old woman presents with fever and colicky right upper quadrant pain and tenderness in the same area. Levels of bilirubin, transaminases, and alkaline phosphatase are mildly elevated. What is the most suitable investigation for the likely underlying condition?",
    "choices": [
      {
        "id": 1,
        "text": "Ultrasonography"
      },
      {
        "id": 2,
        "text": "MRCP"
      },
      {
        "id": 3,
        "text": "CT Scan"
      },
      {
        "id": 4,
        "text": "HIDA scan"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The initial investigation of choice in this patient with suspected <strong>cholecystitis</strong> is\u00a0<strong>Ultrasonography (USG).</strong></p>\n<p>Acute cholecystitis is usually due to mechanical obstruction of the cystic duct or gallbladder neck by a gall- stone.\u00a0It presents as <strong>fever, nausea, vomiting,</strong> and pain in the right hypochondrium with referred pain to the back. On examination, <strong>Murphy's sign</strong>\u2014pain caused by inspiration while applying pressure to the right upper abdomen, causing the patient to stop breathing\u2014is seen.</p>\n<p><strong>Ultrasonography (USG)</strong>\u00a0is the initial investigation of choice<strong>. USG\u00a0</strong>showing<strong>\u00a0gallstones, pericholecystic fluid, and gallbladder wall thickening</strong> is diagnostic.\u00a0<strong>CT</strong> is<strong> less sensitive</strong>(Option C) than ultrasound for the diagnosis of acute cholecystitis, though it usually shows similar findings to USG.</p>\n<p>In cases where USG is normal, a HIDA scan (Option D) is done to confirm the diagnosis.\u00a0<strong>Failure to visualize</strong>\u00a0the gallbladder 2 hours after injection demonstrates <strong>obstruction</strong> of the<strong> cystic duct</strong>, which definitively diagnoses acute cholecystitis. Filling of the gallbladder during a HIDA scan essentially eliminates the diagnosis of cholecystitis.</p>\n<div class=\"page\" title=\"Page 1536\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Treatment including <strong>cholecystectomy </strong>done<strong> within 72 hours</strong> has better outcomes that interval surgery</p>\n<p>The following image depicts the radioisotope scan in which the gallbladder and biliary tree are visualized:</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/07db1d49891a474aac8c771214092eafx995x964.JPEG"
    ]
  },
  {
    "text": "A 50-year-old smoker presented with miosis, ptosis of the right eye, and anhidrosis of the right side of the face. He also has occasional chest pain along with fever and weight loss for the past month. A pancoast tumour is suspected. Which of the following is the investigation of choice for this condition?",
    "choices": [
      {
        "id": 1,
        "text": "CT scan"
      },
      {
        "id": 2,
        "text": "FDG-PET scan"
      },
      {
        "id": 3,
        "text": "Bronchoscopy"
      },
      {
        "id": 4,
        "text": "MRI"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The clinical picture is suggestive of a\u00a0<strong>Pancoast tumor (superior sulcus tumor)</strong> and the <strong>investigation of choice</strong> is <strong>MRI</strong>.</p>\n<p>Investigations in Pancoast tumor:</p>\n<div class=\"ng-scope\">\n<ul>\n<li><strong>MRI (MRI &gt; CT)</strong>\u00a0is the<strong> investigation of choice</strong> for superior sulcus tumor/ Pancoast tumor as the associated <strong>soft tissue infiltration</strong>, the extent of which can be best visualized using an MRI.</li>\n<li><strong>FDG-PET</strong> scan shows <strong>high uptake</strong> by the tumor cells. FDG is taken up by all metabolizing cells but more avidly by cancer cells.</li>\n<li><strong>Bronchoscopy</strong> can be done in endobronchial tumors to obtain a tissue diagnosis.</li>\n</ul>\n</div>\n<div class=\"ng-scope\">\n<div class=\"ng-scope\">\n<p><strong>Pancoast syndrome/ superior sulcus tumor</strong> results from a local extension of a tumor growing in the <strong>apex of the lung</strong>, with the involvement of\u00a0<strong>C8, T1, and T2</strong>\u00a0nerve roots, stellate ganglion, and the chest wall.</p>\n<p>It presents with pain that radiates to the <strong>ulnar distribution of the arm</strong>, often with the destruction of the 1st and 2nd ribs.</p>\n<p>Patients with the central or <strong>endobronchial growth</strong> of the primary tumor may present with a cough, hemoptysis, wheeze, stridor, dyspnea, or post-obstructive pneumonitis.</p>\n<p><strong>Regional spread</strong> can cause</p>\n<ul>\n<li>Tracheal obstruction</li>\n<li>Esophageal compression with dysphagia</li>\n<li>Recurrent laryngeal paralysis with hoarseness</li>\n<li><strong>Phrenic nerve palsy</strong> with the elevation of the hemidiaphragm and dyspnea</li>\n<li>Sympathetic nerve paralysis with <strong>Horner\u2019s syndrome</strong> (enophthalmos, ptosis, miosis, and anhydrosis)</li>\n</ul>\n<p>The below images show chest x-ray, FDG-PET images, and management of the Pancoast tumor.</p>\n</div>\n<div class=\"ng-scope\">\n<div class=\"ng-scope\">\u00a0</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7813405796f1470994bde7636f9d62d9x720x591.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7522ab2428ee44678da76324cfc822bfx720x426.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/47460bc51cd64c32a49dcf30dabb28a6x1280x2864.JPEG"
    ]
  },
  {
    "text": "A 36-year-old man presents with a painless testicular mass with a sense of heaviness in the scrotum. His blood work showed raised LDH and AFP. Which of the following is the imaging modality of choice?",
    "choices": [
      {
        "id": 1,
        "text": "Contrast enhanced computed tomography"
      },
      {
        "id": 2,
        "text": "Ultrasonography"
      },
      {
        "id": 3,
        "text": "Trans-scrotal biopsy"
      },
      {
        "id": 4,
        "text": "Magnetic resonance imaging"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario of a middle-aged man presenting\u00a0with a <strong>painless testicular mass</strong> with a sense of <strong>heaviness</strong> in the scrotum suggests the diagnosis of a\u00a0<strong>testicular tumour</strong>. Blood work showed raised LDH and AFP, which are tumour markers for <strong>non-seminomatous germ cell tumours </strong>(NSGCTs).<strong> </strong>The imaging modality<strong>\u00a0</strong>of\u00a0choice<strong>\u00a0</strong>is<strong>\u00a0ultrasonography.</strong></p>\n<p>Testicular tumours are uncommon male malignancies. <strong>Seminomas</strong> generally occur in the <strong>4th decade</strong> of life, while <strong>NSGCTs</strong>\u00a0are common in the <strong>3rd</strong> decade of life. <strong>Spermatocytic seminomas</strong> occur commonly in men older than <strong>50 years</strong>.</p>\n<p>Clinical features of testicular tumours are:</p>\n<ul>\n<li>Occurrence in the specific age group.</li>\n<li><strong>Painless testicular mass</strong> is the usual symptom</li>\n<li>Sense of <strong>scrotal heaviness</strong></li>\n<li>Abdominal or lumbar mass due to metastasis</li>\n<li>Chest pain, dyspnea, and haemoptysis due to lung metastasis</li>\n<li><strong>Prepubertal interstitial</strong> cell tumours produce <strong>androgens</strong>, causing precocious puberty</li>\n<li><strong>Postpubertal interstitial</strong> cell tumours produce <strong>feminising hormones</strong>, leading to gynecomastia, erectile dysfunction, loss of libido and azoospermia.</li>\n</ul>\n<p>The<strong> initial diagnostic investigation </strong>of<strong> choice </strong>is<strong> ultrasonography (USG)</strong>. USG of the affected as well as the unaffected testis is done and is mandatory. Tumour markers aid in the diagnosis. <strong>Chest X-ray</strong> is done to detect <strong>'cannonball'</strong> metastasis\u00a0in the lungs.</p>\n<p>Other options:</p>\n<p>Option A -\u00a0<strong>Contrast-Enhanced Computed Tomography\u00a0</strong>(CECT) is done to assess the thoracic, abdominal and pelvic areas for <strong>metastasis</strong>. Although it is essential in staging and monitoring response to therapy, it is not the imaging modality of choice.</p>\n<p>Option C:\u00a0<strong>Trans-scrotal biopsy</strong>\u00a0has <strong>no role</strong> in the diagnosis of testicular tumours.</p>\n<p>Option D:\u00a0<strong>Magnetic Resonance Imaging\u00a0</strong>(MRI) may be used as an adjunct if ultrasound findings are equivocal or if the location of the mass is uncertain.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A neonate is brought on the 5th day of life with abdominal distension. The mother informs that the child has not passed meconium yet. Distal bowel obstruction is suspected. What is the diagnostic test of choice?",
    "choices": [
      {
        "id": 1,
        "text": "Rectal manometry"
      },
      {
        "id": 2,
        "text": "Contrast enema"
      },
      {
        "id": 3,
        "text": "Rectal suction biopsy"
      },
      {
        "id": 4,
        "text": "Calretinin immunostain\u00ading"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The clinical presentation (abdominal distension and failure to pass meconium) is suggestive of <strong>Hirschsprung\u2019s disease</strong>. <strong>Contrast enema</strong> is used as the <strong>initial</strong> <strong>investigation</strong>\u00a0when Hirschsprung\u2019s disease is suspected and is the diagnostic test of choice. <strong>Rectal biopsy</strong> is the <strong>gold standard investigation.</strong></p>\n<p>Hirschsprung disease or <strong>congenital aganglionic colon</strong> is characterized by the <strong>absence of ganglion cells</strong> in the <strong>myenteric (Auerbach) plexus</strong> and <strong>submucosal (Meissner) plexus</strong> of the <strong>distal intestinal segment</strong>. This is because of the <strong>premature arrest</strong> of normal migration of neural crest cells from the cecum to the rectum.</p>\n<p>It causes a muscular spasm of the <strong>distal intestinal segment</strong>, resulting in <strong>functional obstruction</strong> of the affected bowel and proximal dilation (<strong>megacolon</strong>). The area between the dilated and contracted segments is referred to as the <strong>transition zone</strong>.</p>\n<p>Hirschsprung disease is classified into -</p>\n<ul>\n<li>Short-segment - limited to the rectosigmoid segment</li>\n<li>Long-segment - proximal extension beyond the rectosigmoid segment</li>\n</ul>\n<p><strong>Note</strong>: while the<strong> gold standard</strong> investigation for Hirschsprung\u2019s disease is <strong>rectal suction biopsy</strong>, an <strong>imaging study</strong> will <strong>first</strong> be required to figure out the <strong>location</strong> from where the sample needs to be taken.</p>\n<p>The image below shows dilated ganglionic and contracted aganglionic segments in Hirschsprung's disease,</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0fc3cdfe0f2d4a268398a2afe3839034x1280x1573.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a4079f7c1f83426ca6094d5d37bf059ax720x816.PNG"
    ]
  },
  {
    "text": "A 4-week old infant presented to the emergency department with projectile, nonbilious vomiting after feeding. On examination, a firm ovoid abdominal mass with hyperperistalsis is present. What is the Investigation of choice for this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Barium meal"
      },
      {
        "id": 2,
        "text": "Ultrasound"
      },
      {
        "id": 3,
        "text": "CT scan"
      },
      {
        "id": 4,
        "text": "MRI"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The above given clinical scenario points to the diagnosis of&nbsp;<strong>congenital hypertrophic pyloric stenosis.&nbsp;</strong>Ultrasound examination is the Investigation of choice for this condition.&nbsp;<strong>Ultrasound</strong> examination <strong>confirms the diagnosis</strong> of congenital hypertrophic pyloric stenosis (CHPS) in the majority of cases. <strong>Cervix sign</strong> and <strong>Nipple sign</strong> are signs of <strong>Congenital Hypertrophic Pyloric stenosis</strong> in <strong>USG</strong>.</p>\n<p>&nbsp;CHPS typically presents with the following:</p>\n<ul>\n<li><strong>Non-bilious vomiting</strong>, which is progressive, projectile, occurring immediately after a feed, usually presents after the<strong> 3<sup>rd</sup> week of age</strong>.&nbsp;</li>\n</ul>\n<div class=\"ng-scope\">\n<div class=\"ng-scope\">\n<ul>\n<li>&nbsp;Physical examination reveals a&nbsp;firm, ovoid, 1 to 2 cm<strong> abdominal mass, </strong>and abnormal left to right hyperperistalsis is seen.</li>\n</ul>\n</div>\n</div>\n<ul>\n<li>As the vomiting continues, a progressive loss of fluid, hydrogen ions, chloride ions, and potassium leads to <strong>hypokalemic hypochloremic metabolic alkalosis with paradoxical aciduria</strong>.</li>\n</ul>\n<p><strong>Pathogenesis:</strong> Hyperplasia of the pyloric muscularis propria, which obstructs the gastric outflow tract.</p>\n<p><strong>Treatment:</strong> Surgical splitting of the muscularis (<strong>Ramstedt pyloromyotomy</strong>) is curative.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 16-year-old boy is admitted with fever, icterus, and headache for the past 5 days. The life cycle of the causative organism is given below. Which serological test should be done for diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Widal test"
      },
      {
        "id": 2,
        "text": "Microscopic agglutination test"
      },
      {
        "id": 3,
        "text": "Weil felix reaction"
      },
      {
        "id": 4,
        "text": "Paul Bunnell test"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>&nbsp;The given clinical scenario and the life cycle shown in the image is suggestive of&nbsp;<strong>leptospirosis (Weil's disease).</strong> A<strong> microscopic agglutination test</strong>&nbsp;is used for the diagnosis of leptospirosis.</p>\n<p>Leptospirosis is a <strong>zoonotic</strong> disease caused by <strong>leptospira</strong>. Humans are <strong>infected</strong> when the leptospires in<strong> water contaminated</strong> by the urine of carrier animals enter the body through cuts or abrasions on the skin or through the intact mucosa of the mouth, nose, or conjunctiva.</p>\n<p>Clinical features include fever, jaundice, vomiting, headache, and intense injection of the eyes. Some may present as aseptic meningitis or with hepatorenal damage (Weil's disease).</p>\n<p>Diagnosis includes:</p>\n<ul>\n<li><strong>Microscopy</strong> -\n<ul>\n<li>Examination of blood - Leptospires may be demonstrated under the <strong>dark field microscope</strong> or by immunofluorescence. The organism disappears from blood after 1 week.</li>\n<li>Examination of urine: Leptospires appear in the urine in the second week of the disease. Centrifuged deposit of the urine may be examined under dark ground illumination.</li>\n</ul>\n</li>\n<li><strong>Culture</strong> - With semisynthetic media like <strong>EMJH</strong> (Ellinghausen, McCullough, Johnson, Harris) or Korthof's, Stuart's, and Fletcher's media.</li>\n<li><strong>Serotype-specific</strong> tests:&nbsp;\n<ul>\n<li><strong>Microscopic</strong> <strong>agglutination test</strong>&nbsp;(more specific)</li>\n<li>Macroscopic agglutination test &nbsp;</li>\n<li>A rapid diagnostic test to detect leptospira-specific IgM antibody in human sera.</li>\n</ul>\n</li>\n</ul>\n<p>The treatment of choice is<strong>&nbsp;IV penicillin </strong>or<strong> IV ceftriaxone.&nbsp;</strong>Doxycycline 200 mg orally given once a week is effective in prophylaxis.</p>\n<p>Option A: <strong>Widal test</strong> is used to screen for typhoid fever.</p>\n<p>Option C: <strong>Weil-Felix reaction</strong> is used to diagnose rickettsial fevers &nbsp;</p>\n<p>Option D: <strong>Paul-Bunnell test</strong> is the investigation of choice for infectious mononucleosis.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/4f137f036bc340aeb58cb0faf66abfdc.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A term neonate is being evaluated for altered level of consciousness. There are also decreased spontaneous movements and abnormal respiration on examination prompting the suspicion for Intraventricular hemorrhage. Which of the following is the investigation of choice?",
    "choices": [
      {
        "id": 1,
        "text": "Cranial ultrasonography"
      },
      {
        "id": 2,
        "text": "Electroencephalogram"
      },
      {
        "id": 3,
        "text": "CT scan"
      },
      {
        "id": 4,
        "text": "MRI scan"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>&nbsp;<strong>Cranial Ultrasonography</strong> is the preferred modality for diagnosis of intraventricular hemorrhage (IVH) because of the high sensitivity, ease of access and lack of radiation exposure.&nbsp;</p>\n<p>The most important risk factor for intraventricular hemorrhage (IVH) is <strong>prematurity</strong> with high incidence in <strong>very low birth weight (VLBW)</strong> infants weighing &lt;1500 g at birth. The risk of GMH-IVH increases with decreasing gestational age and birth weight. Some other risk factors that increase its incidence include respiratory distress, mechanical ventilation, cardiopulmonary resuscitation and hypotension.</p>\n<p>The origin of bleeding is the small blood vessels in the <strong>germinal matrix</strong>,&nbsp;located between the caudate nucleus and the thalamus at the level of the foramen of Monro.&nbsp;In preterm infants, a weak structural support system makes the germinal matrix vulnerable to hemorrhage and injury particularly when there is hemodynamic instability.</p>\n<p>&nbsp;Most cases present on the first day of life and the majority in the first few days of life. The most common presentation is a stuttering course with <strong>altered levels</strong> of <strong>consciousness</strong>, <strong>respiratory cycle alterations</strong>,<strong> hypotonia</strong>, <strong>decreased spontaneous</strong> and <strong>elicited movements,</strong> and subtle changes in eye position and movement. Catastrophic deterioration occurs in very few patients with <strong>seizures</strong>, <strong>coma</strong> and <strong>decerebrate posturing</strong> progressing over minutes to hours. Some patients may have a clinically silent presentation.</p>\n<p><strong>Ultrasound</strong> is the preferred modality because of the high sensitivity, ease of access and lack of radiation exposure. Routine ultrasound screening is recommended for infants born at &lt; 28 weeks gestation. CT scan is useful to detect cortical neuronal injury and Magnetic resonance imaging (MRI) is used to evaluate any hypoxic ischemic brain injury.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 22-year-old male patient presents with red violaceous skin lesion with a palpable mass on his forearm. History reveals that this finding has been present since childhood and has been increasing in size. On examination warmth, bruit and thrill are present. What is the investigation of choice for this condition?",
    "choices": [
      {
        "id": 1,
        "text": "CT"
      },
      {
        "id": 2,
        "text": "MRI"
      },
      {
        "id": 3,
        "text": "Duplex USG"
      },
      {
        "id": 4,
        "text": "Digital subtraction angiography"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The above clinical scenario is suggestive of <strong>arteriovenous malformation</strong> (AVM).&nbsp;<strong>MRI</strong>&nbsp;is the investigation<strong>&nbsp;</strong>of choice&nbsp;for the <strong>evaluation</strong> and <strong>follow-up</strong> of&nbsp;peripheral arteriovenous malformations.</p>\n<p>Magnetic resonance imaging (MRI) offers numerous advantages over both CT and radiographs and has become the most important modality to diagnose arteriovenous malformations. MRI techniques including&nbsp;<strong>time-of-flight and phase contrast</strong>&nbsp;can be used to isolate inflow blood supply to better&nbsp;<strong>predict the risk of ischemia</strong>&nbsp;following embolization.</p>\n<p>MRI also provides well-defined images defining boundaries between the AVM, surrounding fat, and neurovascular bundles, which is necessary for the planning of surgical or embolic interventions.</p>\n<p>On examination, AVM appears as a <strong>red/violaceous</strong> lesion with a palpable mass under it. Local <strong>warmth, bruit,</strong> and <strong>thrill</strong> are <strong>present.</strong><br /><br /><strong>Treatment</strong> is initiated when signs and symptoms of <strong>ischemia,</strong> ulceration, bleeding, or hemodynamic instability are present. Surgical management includes <strong>arterial embolization</strong> to temporarily occlude the AVM followed by surgical<strong> extirpation/destruction.</strong> The AVM and overlying skin is widely excised followed by reconstruction.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 32-year-old man presented with severe pulsatile proptosis, chemosis, diplopia, and an orbital bruit in the left eye three weeks after a motor vehicle accident. He also complains of headaches and tinnitus on the left side. The intraocular pressure in the left eye was increased. What is the investigation of choice in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "CT head"
      },
      {
        "id": 2,
        "text": "Digital subtraction angiography"
      },
      {
        "id": 3,
        "text": "Orbital doppler imaging"
      },
      {
        "id": 4,
        "text": "MRI head"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario of a patient with pulsatile proptosis, chemosis, and a bruit is suggestive of <strong>traumatic carotid-cavernous fistula</strong>. Selective catheter <strong>digital subtraction angiography is the investigation of choice</strong>.</p>\n<p><br /><strong>A carotid cavernous fistula</strong>&nbsp;is an arteriovenous fistula communicating between the internal carotid artery and the cavernous sinus.<br /><strong>Causes:&nbsp;</strong></p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Severe head trauma (most common in males)&nbsp;</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Degenerative vessels (atheromatous or syphilitic disease) without discoverable trauma, especially in women</li>\n</ul>\n<p><strong>Types:&nbsp;</strong></p>\n<ol>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Direct fistula:&nbsp;</li>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"2\">High-flow shunts in which carotid artery blood passes directly into the cavernous sinus through a defect in the wall of the intracavernous portion of the internal carotid artery&nbsp;</li>\n</ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Indirect fistula&nbsp;</li>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"2\">Dural shunt/ low flow shunt in which the arterial blood flows through the meningeal branches of the external or internal carotid arteries indirectly into the cavernous sinus. Clinical manifestations are subtler than in a direct fistula.</li>\n</ul>\n</ol>\n<p><br /><strong>Presentation:</strong></p>\n<p>It presents within days or weeks following trauma; usually ipsilateral to the fistula but may be bilateral, or even contralateral.</p>\n<p>The <strong>classical triad</strong> of presentation is <strong>pulsatile proptosis, chemosis, and bruit.&nbsp;</strong></p>\n<ol>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Marked epibulbar vascular dilatation - &ldquo;<strong>Corkscrew vessels</strong>&rdquo;</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Chemosis</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Pulsatile proptosis associated with a bruit and a thrill</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Increased IOP&nbsp;</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Anterior segment ischemia, characterized by corneal epithelial edema, aqueous cells, and flare and in severe cases iris atrophy, cataract, and rubeosis iridis.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Ophthalmoplegia (III-VI nerve palsies)</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Ophthalmoscopy findings: optic disc swelling, venous dilatation, and intraretinal hemorrhage from venous stasis, and impaired retinal blood flow.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Visual loss\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Immediate - due to ocular or optic nerve damage</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Delayed - as a result of exposure keratopathy, secondary glaucoma, central retinal vein occlusion, anterior segment ischemia, or ischaemic optic neuropathy.</li>\n</ul>\n</li>\n</ol>\n<p><strong>Investigations:</strong></p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Selective catheter Digital subtraction angiography is the investigation of choice.</strong></li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">CT and MRI angiography can also be done</li>\n</ul>\n<p><br /><strong>Treatment:</strong> mostly conservative. Embolization during arteriography is the treatment of choice.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 24-year-old male patient presented with complaints of cough with sputum, abdominal pain, and diarrhea. There is a history of repeated lung and sinus infections since childhood. His BMI is 18 kg/m2 and has bilateral nasal polyps. Both lungs have coarse rhonchi and a chest radiograph shows evidence of bilateral upper lobe bronchiectasis. To confirm the suspected diagnosis of cystic fibrosis, which of the following is the next best investigation of choice?",
    "choices": [
      {
        "id": 1,
        "text": "Sweat chloride values >60 mmol/L"
      },
      {
        "id": 2,
        "text": "Isolation of Pseudomonas aeruginosa on repeated sputum cultures"
      },
      {
        "id": 3,
        "text": "Sweat chloride values >40 mmol/L"
      },
      {
        "id": 4,
        "text": "Genetic analysis for CFTR gene"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>In a suspected case of <strong>cystic fibrosis</strong>, a&nbsp;<strong>sweat chloride </strong>value is the investigation of choice. Values <strong>&gt;60 mmol/L </strong>are <strong>diagnostic.&nbsp;</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 52-year-old female patient presented with gradually increasing difficulty in breathing for the past 6 months. She is on methotrexate for rheumatoid arthritis. Interstitial Lung Disease is suspected. What is the investigation of choice to confirm the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "MRI"
      },
      {
        "id": 2,
        "text": "PFT"
      },
      {
        "id": 3,
        "text": "HRCT"
      },
      {
        "id": 4,
        "text": "Chest x-ray"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>High-resolution CT</strong> is the <strong>investigation of choice</strong> for <strong>ILD</strong>.\u00a0\u00a0</p>\n<p><strong>Interstitial lung disease</strong> (ILD) refers to the <strong>remodeling of interstitial space</strong>, the region between the epithelium and endothelium. The main pathology is <strong>fibrosis</strong>.</p>\n<p>It can be broadly classified into:</p>\n<ul>\n<li>\u00a0ILD of known causes like occupational(coal workers' pneumoconiosis, silicosis), rheumatological(rheumatoid arthritis,<strong> diffuse&gt;limited</strong> cutaneous <strong>systemic sclerosis,</strong> polymyositis, dermatomyositis, and occasionally SLE and Sjogren syndrome), and treatment-induced.</li>\n<li>ILD of unknown cause, which is also called <strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">idiopathic interstitial pneumonia (IIP).\u00a0</strong></li>\n</ul>\n<div><strong>IIP</strong> is further divided into:</div>\n<ul>\n<li><strong>Idiopathic pulmonary fibrosis</strong> (<strong>IPF</strong>)/ Usual Interstitial Pneumonia (UIP): It is the <strong>most common</strong> form of idiopathic interstitial pneumonia.</li>\n<li>Non-specific interstitial pneumonia (NSIP)</li>\n<li>Cryptogenic Organizing pneumonia (COP)</li>\n<li>Acute interstitial pneumonia (AIP)</li>\n<li>Respiratory bronchiolitis associated ILD (RB-ILD)</li>\n<li>Desquamative interstitial pneumonia (DIP)</li>\n<li>Lymphocytic interstitial pneumonia (LIP)</li>\n<li>ILD is a <strong>restrictive</strong> lung disease with <strong>low V/Q mismatch</strong> where\u00a0the alveolar-arterial oxygen gradient <strong>(a-A O<span style=\"font-size: 11.6667px;\">2</span>\u00a0gradient)</strong> is <strong>increased</strong> due to a <strong>defect</strong> <strong>in</strong> <strong>diffusion</strong> resulting in <strong>hypoxemia</strong>.</li>\n</ul>\n<p>ILD(pulmonary fibrosis) is the <strong>most</strong> <strong>serious adverse</strong> <strong>effect</strong> of prolonged <strong>amiodarone</strong> (class iii antiarrhythmic) use. Thus, amiodarone is <strong>contraindicated</strong> in ILD patients<strong>.</strong></p>\n<div class=\"row mt-3\">\u00a0</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which among the following is the investigation of choice in renal cell carcinoma?",
    "choices": [
      {
        "id": 1,
        "text": "IVP"
      },
      {
        "id": 2,
        "text": "CECT"
      },
      {
        "id": 3,
        "text": "MRI"
      },
      {
        "id": 4,
        "text": "USG"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>The investigation of choice</strong> in renal cell carcinoma is <strong>CECT</strong>.</p>\n<p><strong>MRI </strong>is the investigation of choice in <strong>renal vein involvement </strong>as the renal vein is sub-optimally visualized in CECT.</p>\n<p>MRI is superior to CT in differentiating benign from malignant thrombus but offers no advantage in staging the nodal disease.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 57-year-old male patient had a sudden tearing type of chest pain. He is a known hypertensive patient for the past 15 years and has not been on regular treatment. Acute coronary syndrome was ruled and he is hemodynamically stable. Considering aortic dissection, which is the next investigation to be performed?",
    "choices": [
      {
        "id": 1,
        "text": "CT"
      },
      {
        "id": 2,
        "text": "MRI"
      },
      {
        "id": 3,
        "text": "Ultrasound"
      },
      {
        "id": 4,
        "text": "Aortography"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>CT</strong> is the initial investigation for <strong>aortic dissection</strong>. As it is more <strong>widely available</strong> and takes a&nbsp;<strong>shorter time</strong> compared to MRI.</p>\n<p>MRI, though highly accurate for acute aortic disease evaluation, is usually confined to cases of severe renal insufficiency or absolute contraindications to iodinated contrast medium.</p>\n<p><strong>Ultrasound</strong> and&nbsp;<strong>aortography</strong> are not the investigation of choice for aortic dissection. Aortography used to be the gold standard. It involved the injection of high-flow contrast into the vessel. It has been replaced by noninvasive imaging. Intravascular ultrasound can be performed, but the procedure is expensive and requires experience.</p>\n<p>The below image depicts a CT chest indicating Type A aortic dissection from the aortic root. (A) Axial view and (B) sagittal view. Arrows indicate intimal flap.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f8c2f064ac384f9ea5c0d11de611af5cx800x335.JPEG"
    ]
  },
  {
    "text": "A patient after a road traffic accident presented with pain abdomen. The resident examines the child and found that vitals were stable and tenderness was present in the left lumbar region. Which is the best investigation of choice?",
    "choices": [
      {
        "id": 1,
        "text": "Contrast enhanced CT scan"
      },
      {
        "id": 2,
        "text": "Retrograde urethrogram"
      },
      {
        "id": 3,
        "text": "Wait and watch"
      },
      {
        "id": 4,
        "text": "Emergency laparotomy"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical vignette with <strong>abdominal pain</strong> and tenderness in&nbsp;the left lumbar region following a road traffic accident is suggestive of <strong>blunt renal trauma</strong>. The investigation of choice is <strong>CECT</strong> in a<strong> hemodynamically stable patient.</strong></p>\n<p><strong>Blunt trauma</strong> is the main cause of renal injuries and is generally self-limiting. Radiological investigations are indicated when there is gross haematuria, shock in combination with microscopic haematuria, <strong>pediatric renal trauma</strong>, and penetrating injuries.</p>\n<p><strong>CECT</strong> is the investigation of choice. It assesses&nbsp;the extent of the injury, showing laceration, extravasation, surrounding hemorrhage, and vessel injury. It also shows non-renal injuries and effectively stages renal pedicle injuries. Arterial occlusion will manifest as rim enhancement of the normal renal contour.</p>\n<p>Blunt trauma is mostly treated <strong>conservatively. </strong>Most of the <strong>penetrating injuries</strong> require surgical <strong>renal exploration.</strong></p>\n<p>Absolute indications for surgical intervention in renal trauma are:</p>\n<ul>\n<li>Massive hemorrhage</li>\n<li>Renal pedicle avulsion (grade 5 injury)</li>\n<li>Expanding, pulsatile, or uncontained <strong>retroperitoneal</strong> hematoma</li>\n</ul>\n<p>Relative indications are:</p>\n<ul>\n<li>Large laceration of the renal pelvis or avulsion of the ureteropelvic junction</li>\n<li>Bowel or pancreatic injuries</li>\n<li>Persistent urinary leakage, postinjury urinoma, or perinephric abscess&nbsp;</li>\n<li>Complete renal artery thrombosis of both kidneys&nbsp;</li>\n<li>Renal hypertension</li>\n</ul>\n<p>Other options:</p>\n<p>Option D: <strong>Exploratory laparotomy</strong> is recommended in unstable patients and those with penetrating renal injuries.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is considered the investigation of choice for the evaluation of a patient with suspected peptic ulceration?",
    "choices": [
      {
        "id": 1,
        "text": "Gastroduodenoscopy"
      },
      {
        "id": 2,
        "text": "CECT"
      },
      {
        "id": 3,
        "text": "Barium meal"
      },
      {
        "id": 4,
        "text": "Barium swallow"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Gastroduodenoscopy</strong> is considered the <strong>investigation of choice</strong> for the evaluation of a patient with <strong>suspected peptic ulcer disease.</strong></p>\n<p>Gastric peptic ulcers are predominantly located along the lesser curvature near the interface of the body and antrum. The most common site of <strong>peptic ulcer</strong> is the&nbsp;<strong>anterior wall </strong>of the <strong>proximal duodenum,&nbsp;</strong>within a few centimeters of the pyloric valve.&nbsp;</p>\n<p>The image below shows a peptic ulcer with a <strong>round </strong>to<strong> oval and sharply punched-out defect,</strong> and a clean mucosal margin.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c779b2a090da476886059e6556f9a787x400x408.JPEG"
    ]
  },
  {
    "text": "A 14-year-old boy was brought to the emergency department with complaints of sudden and continuous pain in the right testicle. The pain radiated to the abdomen and the inguinal area associated with nausea and vomiting. What is the investigation of choice for this condition?",
    "choices": [
      {
        "id": 1,
        "text": "CT"
      },
      {
        "id": 2,
        "text": "Doppler USG"
      },
      {
        "id": 3,
        "text": "MRI"
      },
      {
        "id": 4,
        "text": "PET"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The clinical scenario points towards a likely of&nbsp;<strong>testicular torsion</strong>.&nbsp;<strong>Doppler ultrasonography</strong> is the investigation of choice for this condition.</p>\n<p><strong>Testicular&nbsp;torsion</strong>&nbsp;is typically seen in adolescence and presents with the&nbsp;<strong>sudden onset of testicular pain.</strong></p>\n<div class=\"page\" title=\"Page 978\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>It results from a bilateral anatomic defect that leads to increased mobility of the testes&nbsp;<strong>(bell&shy;clapper abnormality).&nbsp;</strong>Twisting of the spermatic cord typically cuts off the venous drainage of the testis. But, thick-walled arteries remain patent, producing intense vascular engorgement, followed by<strong>&nbsp;hemorrhagic infarction.</strong></p>\n</div>\n</div>\n</div>\n</div>\n<p>The morphologic changes range from intense&nbsp;<strong>congestion</strong>&nbsp;to widespread&nbsp;<strong>hemorrhage</strong>&nbsp;to testicular&nbsp;<strong>infarction&nbsp;</strong>depending on the duration of torsion. In advanced stages, the testis is markedly&nbsp;<strong>enlarged</strong>&nbsp;and consists entirely of soft,&nbsp;<strong>necrotic, hemorrhagic tissue.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = 'Investigation Of Choice Mini Test - -Tmt';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2023-24"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>