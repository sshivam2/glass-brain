<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>266 Paediatrics Neet 2022 - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / PYQs / Pediatrics
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">14</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A 1-day-old neonate has not passed urine since birth. What is the next step in management?",
    "choices": [
      {
        "id": 1,
        "text": "Continue breast feeding and observe"
      },
      {
        "id": 2,
        "text": "Admit to NICU"
      },
      {
        "id": 3,
        "text": "Start artificial feeding"
      },
      {
        "id": 4,
        "text": "Start intravenous fluids"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><span class=\"ILfuVd\" lang=\"en\"><span class=\"hgKElc\">In this clinical scenario, a <strong>1 day-old neonate</strong> has <strong>not passed urine</strong> since birth. Most healthy neonates void <strong>within 24 hours of life</strong>. Delay beyond the first 24 hours of life is generally benign but may result in parental anxiety. <strong>Continuing breastfeeding</strong> and <strong>observing</strong> is the next best step in management.<br /></span></span></p>\n<p><span class=\"ILfuVd\" lang=\"en\"><span class=\"hgKElc\">The <strong>first urination</strong> should occur by <strong>12-24\u00a0hours</strong> of age and the <strong>first</strong> passage of <strong>meconium</strong> should occur by <strong>48\u00a0hours</strong> of age.\u00a0<br /></span></span></p>\n<p><span class=\"ILfuVd\" lang=\"en\"><span class=\"hgKElc\"> Delay in the passage of urine is seen in conditions causing blockage to urine outflow or birth defects that affect the spinal cord. Some commonly seen conditions are vesicoureteric reflux, <strong>ureteropelvic junction obstruction, posterior urethral valve,</strong> ureterocele, and spina bifida.</span></span></p>\n<p><span class=\"ILfuVd\" lang=\"en\"><span class=\"hgKElc\">Delay in the passage of the first stool in term neonates may be associated with conditions causing a lower intestinal obstruction, which include <strong>meconium plug syndrome,</strong> Hirschsprung disease, and imperforate anus. More generalized problems, such as sepsis or hypothyroidism, should be considered.</span></span></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 7-year-old boy presented with abdominal pain, vomiting, oliguria, and periorbital puffiness following chemotherapy. Investigations reveal hyperuricemia, raised creatinine levels, and hyperkalemia.  What is the next best step in the management of this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Hydration"
      },
      {
        "id": 2,
        "text": "Probenecid"
      },
      {
        "id": 3,
        "text": "Allopurinol"
      },
      {
        "id": 4,
        "text": "Rasburicase"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p style=\"text-align: justify;\">The clinical scenario and the laboratory investigations are suggestive of <strong>tumor lysis syndrome</strong>. Aggressive<strong> hydration</strong> is the next best step in the\u00a0<strong>management</strong> of this condition.</p>\n<p style=\"text-align: justify;\"><strong>Tumor lysis syndrome</strong> (TLS) is a condition that can occur <strong>spontaneously</strong> after the <strong>initiation</strong> of <strong>chemotherapy.</strong>\u00a0</p>\n<p>During chemotherapy, the treatment kills the malignant cells, which leads to increased serum uric acid levels from the turnover of nucleic acids causing <strong>hyperuricemia.</strong> Tumor lysis results in the release of intracellular potassium, and phosphate pools, which causes <strong>hyperkalemia</strong>, and<strong> hyperphosphatemia.\u00a0</strong>Increased phosphate levels lead to reciprocal depression of serum calcium/<strong>hypocalcemia.</strong> Deposition of uric acid crystals, calcium phosphate, and hyperphosphatemia leads to <strong>renal failure.</strong></p>\n<p><strong>Signs</strong> and <strong>symptoms</strong> associated with TLS can develop within 12-48 hours after the initiation of chemotherapy and include:</p>\n<ul>\n<li><strong>Abdominal pain</strong> and distension</li>\n<li>Dysuria, oliguria, flank pain and hematuria</li>\n<li>Anorexia, <strong>vomiting</strong>, cramps, <strong>seizures</strong>, spasms, altered mental status, and tetany due to hypocalcemia</li>\n<li><strong>Weakness</strong>\u00a0and paralysis due to hyperkalemia</li>\n<li>Hemodialysis in patients refractory to medical treatment</li>\n</ul>\n<p>The <strong>Cairo-Bishop criteria</strong> are used to <strong>assess</strong> the <strong>severity</strong> of TLS.</p>\n<p><strong>Management</strong> of TLS includes:</p>\n<ul>\n<li>Before starting therapy, the <strong>electrolytes</strong> should be <strong>measured</strong> and <strong>aggressive hydration</strong> should be done.</li>\n<li><strong>Allopurinol </strong>is a xanthine oxidase inhibitor that decreases the synthesis of uric acid. It should be started in TLS to <strong>prevent</strong> further <strong>accumulation</strong> of <strong>uric acid.</strong></li>\n<li><strong>Febuxostat </strong>is a selective non-purine xanthine oxidase inhibitor that can be used to <strong>treat</strong> <strong>hyperuricemia.</strong> It does not require dose calculations and can be used in patients with mildly decreased renal function.</li>\n<li><strong>Rasburicase </strong>is an enzyme that degrades uric acid. It is preferred in TLS over allopurinol to decrease the accumulation of uric acid.</li>\n</ul>\n<div class=\"ng-star-inserted\">\n<div class=\"table-responsive font-weight-light answer-scroll ng-star-inserted\">\n<div class=\"ng-star-inserted\">\n<div class=\"table-responsive font-weight-light answer-scroll ng-star-inserted\">\n<div class=\"ng-star-inserted\">\n<div class=\"table-responsive font-weight-light answer-scroll ng-star-inserted\">\n<p>Option B: <strong>Probenecid </strong>inhibits the organic anion transporter in the nephron. It thereby inhibits the reabsorption of uric acid. It is <strong>contraindicated</strong> in TLS as it increases the risk of uric acid stones due to increased uric acid levels.</p>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A baby presented with abdominal pain. On examination, a mass is palpated in the right lumbar region. A barium enema is done, and the image is given below. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Intussusception"
      },
      {
        "id": 2,
        "text": "Volvulus"
      },
      {
        "id": 3,
        "text": "Duodenal atresia"
      },
      {
        "id": 4,
        "text": "Intestinal obstruction"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Option D: <strong>Intestinal obstruction</strong> presents with abdominal pain and distension with constipation. A plain x-ray of the abdomen shows <strong>multiple air-fluid levels </strong>(shown below). Normally,&nbsp;<strong>3</strong> air-fluid levels can be seen in the plain x-ray at the fundus of the stomach, at the duodenum, and at the cecum. A <strong>barium meal</strong> is usually <strong>contraindicated</strong> in acute intestinal obstruction.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ce47deeb0cfc426fa6520fe814223b5a.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d81d8af7dc2c42c1847e0212ef827ddfx720x598.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/322a6381b6a84dfd93a2fda7c2454257x1144x1136.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b3fe8d68474c421a8ad39354ab6a2710x720x343.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0d6e64c52ff94d0586c0f1d777de8120x720x840.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/207ce6628d3644fe9fb851ee0bafe6a1x796x1024.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4ec9c8c384384bf782a0313cf73169b2x1015x1197.JPEG"
    ]
  },
  {
    "text": "An 8-day-old newborn was found to have thyroid-stimulating hormone level of more than 100 mIU/L.  Which of the following will be the next best investigation?",
    "choices": [
      {
        "id": 1,
        "text": "Urine iodine excretion"
      },
      {
        "id": 2,
        "text": "Serum thyroid receptor antibody"
      },
      {
        "id": 3,
        "text": "Radiotracer uptake with technetium"
      },
      {
        "id": 4,
        "text": "Perchlorate secretion test"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Treatment</strong> with <strong>levothyroxine</strong> should be started immediately after diagnosis. <strong>Thyroxine\u00a0</strong>(T4) of dose\u00a0<strong>10-15\u00a0\u03bcg/kg/day</strong>\u00a0should be started and adjusted to achieve the normal free T4 range. In central hypothyroidism, cortisol replacement should be started before thyroid replacement.</p>\n<div class=\"ng-scope\">\n<p class=\"ng-binding\">Neonatal hypothyroidism is a <strong>sensitive indicator</strong> of <strong>environmental iodine deficiency</strong> and can also be an effective indicator for m<strong>onitoring the impact of a program</strong>.</p>\n<p>Other options:</p>\n<p>Option A: <strong>Urinary iodine excretion</strong> is used for <strong>surveillance</strong> and epidemiological studies for classifying countries according to the level of iodine deficiency by the WHO, and is an effective indicator of the program against iodine deficiency.</p>\n<p>Option B: <strong>Serum thyroid receptor antibody\u00a0</strong>is used to <strong>diagnose transient congenital hypothyroidism</strong> caused due to transplacental passage of TSH receptor blocking antibodies. It is usually seen in babies born to mothers suffering from autoimmune hypothyroidism taking thyroxine.</p>\n<p>Option D: A <strong>perchlorate secretion test </strong>can<span class=\"ILfuVd\" lang=\"en\"><span class=\"hgKElc\"> be used to diagnose</span></span><strong><span class=\"ILfuVd\" lang=\"en\"><span class=\"hgKElc\"> thyroid peroxidase deficiency.</span></span></strong></p>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ea6391f8140145268369895a6f3d07fbx881x548.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/301028818d404a6abe467ea8f6995231x489x448.PNG"
    ]
  },
  {
    "text": "A 10-month-old infant was brought with complaints of jerking movement of limbs towards the body. On examination, there is a regression of developmental milestones. Electroencephalogram shows hypsarrythmia. Which of the following is the drug of choice in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Phenytoin"
      },
      {
        "id": 2,
        "text": "Adrenocorticotropic hormone (ACTH)"
      },
      {
        "id": 3,
        "text": "Levetiracetam"
      },
      {
        "id": 4,
        "text": "Phenobarbitone"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Diagnosis</strong> is confirmed by <strong>EEG</strong> which typically shows <strong>hypsarrythmia.</strong></p>\n<p>The treatment of choice in West syndrome is either adreno-corticotropic hormone (<strong>ACTH</strong>) or <strong>corticosteroids.</strong> An antiseizure medication, mainly&nbsp;<strong>vigabatrin</strong> can be used when associated with <strong>tuberous sclerosis.</strong></p>\n<p>Note: The table given below shows the EEG features seen in various seizure disorders.</p>\n<table style=\"width: 477px; height: 238px;\" border=\"1\">\n<tbody>\n<tr>\n<td style=\"width: 161.817px;\"><strong>Disease</strong></td>\n<td style=\"width: 299.183px;\"><strong>Typical EEG feature</strong></td>\n</tr>\n<tr>\n<td style=\"width: 161.817px;\">Lennox-Gastaut syndrome</td>\n<td style=\"width: 299.183px;\">1.5-2.5 Hz spike and polyspike bursts in sleep</td>\n</tr>\n<tr>\n<td style=\"width: 161.817px;\">Absence seizures</td>\n<td style=\"width: 299.183px;\">3 Hz spike and slow-wave (spike and dome pattern)</td>\n</tr>\n<tr>\n<td style=\"width: 161.817px;\">Juvenile myoclonic epilepsy</td>\n<td style=\"width: 299.183px;\">4-5 Hz spike</td>\n</tr>\n<tr>\n<td style=\"width: 161.817px;\">West syndrome</td>\n<td style=\"width: 299.183px;\">Hypsarrhythmia (high-voltage waves with chaotic background)</td>\n</tr>\n</tbody>\n</table>\n<p>Options A and C: <strong>Phenytoin</strong> and<strong> l</strong><strong>evetiracetam</strong> are used in focal seizures and <strong>status epilepticus.</strong></p>\n<p>Option D: <strong>Phenobarbitone </strong>is used as an antiepileptic in <strong>neonatal seizures</strong> and as an enzyme inducer in&nbsp;Crigler-Najjar syndrome type II.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ab3b894029134b81bbc7ed16c86b9a75x439x296.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7c4d127d30524a63a2d12ccffa51a60cx510x737.GIF"
    ]
  },
  {
    "text": "A 2-month-old infant born to an HIV-positive mother presents with recurrent diarrhea. What is the next best step?",
    "choices": [
      {
        "id": 1,
        "text": "Test stool for giardia and give antibiotics"
      },
      {
        "id": 2,
        "text": "Dried spot sample for HIV DNA PCR"
      },
      {
        "id": 3,
        "text": "Antibody tests for HIV"
      },
      {
        "id": 4,
        "text": "Aerobic culture"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In the above scenario,&nbsp;the diagnosis of HIV infection should be established/ruled out before evaluating for secondary infections. Hence, a<strong>&nbsp;dried spot sample </strong>for<strong> HIV DNA PCR</strong> is the next best step.</p>\n<p><strong>AIDS enteropathy,</strong> a syndrome of malabsorption with partial villous atrophy not associated with a specific pathogen, has been postulated to be a<br />result of direct HIV infection of the gut.</p>\n<p>The diagnosis of HIV infection in babies&nbsp;born to HIV-infected mothers is done by <strong>HIV proviral DNA</strong> or RNA PCR, HIV culture, or HIV p24 antigen. The national program (Early Infant Diagnosis) now uses HIV total nucleic acid (RNA + proviral DNA) PCR test on <strong>dried blood spot samples</strong>. All positive tests need to be confirmed with an HIV PCR test on another sample.</p>\n<p>An infant born to an HIV-positive mother should be <strong>breastfed exclusively</strong> or by <strong>replacement feeds</strong> exclusively for <strong>6 months</strong> of age. Infants should receive <strong>ARV prophylaxis</strong> with <strong>s</strong><strong>yrup nevirapine </strong>or<strong> zidovudine</strong><strong>.</strong>&nbsp;</p>\n<p>Involvement of the gastrointestinal tract is common in HIV-infected babies. Common pathogens identified are bacteria (<em>Salmonella, Campylobacter, Shigella, Mycobacterium avium complex</em>), protozoa (<em><strong>Giardia,</strong> Cryptosporidium, Isospora, microsporidia</em>), viruses (CMV, HSV, rotavirus), and fungi (<strong><em>Candida</em></strong>). MAC and protozoal infections are most severe and protracted in children.</p>\n<p>Other options:</p>\n<p>Option A: <strong>Test stool for giardiasis and give antibiotics </strong>is not preferred as the immediate next step. First, the diagnosis of HIV infection should be established before treating secondary infections.</p>\n<p>Option C: <strong>Antibody tests for HIV</strong> are not useful in establishing the diagnosis of HIV infection. This is because all infants born to HIV-infected mothers test antibody positive at birth because of the passive transfer of maternal HIV antibodies across the placenta. It can be used as a diagnostic tool after <strong>18 months</strong> of age.</p>\n<p>Option D: <strong>Aerobic culture </strong>is not used for the diagnosis of HIV infection.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An 8-year-old child has difficulty walking and getting up from a squatting position. A muscle biopsy was done and is as shown in the image. Which of the following is true about this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Death occurs in 3rd decade"
      },
      {
        "id": 2,
        "text": "Previous history of viral prodrome"
      },
      {
        "id": 3,
        "text": "It is a mitochondrial storage disorder"
      },
      {
        "id": 4,
        "text": "Early treatment has excellent prognosis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<ul>\n<li><strong>Trendelenburg gait/</strong>hip waddle</li>\n<li>The patient is unable to walk by the age of 12 years and <strong>death occurs by late 20 years</strong> of age, mostly due to respiratory failure during sleep.</li>\n</ul>\n<p>The<strong> complications</strong> of DMD include contractures, scoliosis, dilated cardiomyopathy, and\u00a0<strong>malignant hyperthermia</strong> after<strong> anesthesia.</strong></p>\n<p><strong>Diagnosis</strong> of DMD:</p>\n<ul>\n<li><strong>Elevated</strong>\u00a0serum\u00a0<strong>creatine kinase</strong>\u00a0levels</li>\n<li><strong>Polymerase chain reaction</strong>\u00a0(PCR) analysis for the <strong>dystrophin</strong> <strong>gene</strong></li>\n<li>If PCR is normal, but clinical suspicion is high,\u00a0<strong>muscle biopsy </strong>(<strong>fatty replacement</strong> of muscle fibers) with dystrophin immunocytochemistry (absence of the normal sarcolemmal staining) is done.</li>\n</ul>\n<div class=\"ng-star-inserted\">\n<div class=\"table-responsive font-weight-light answer-scroll ng-star-inserted\">\n<p><strong>Treatment</strong> of DMD includes <strong>glucocorticoids</strong> (prednisone or deflazacort), and multidisciplinary management. <strong>Eteplirsen</strong> and <strong>casimersen</strong> are the two new FDA-approved drugs for the treatment of DMD.</p>\n<p>Note- The FDA has approved Vamorolone, a novel corticosteroid for the treatment of DMD. The drug offers enhanced anti-inflammatory properties and mineralocorticoid receptor antagonism as well. It is potentially a safer and more effective alternative to glucocorticoids.\u00a0\u00a0</p>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a391ced3eb664522bee942516c8733ff.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/64aed9b19da74dbc96065fbfe87167f4x1280x1308.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/114ab9174f4b47e09d9d15ddf464d26ax720x1022.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b3b5906d77cf4ff684c56e928a3410b7x510x482.GIF"
    ]
  },
  {
    "text": "A child presented with a history of loose stools with an increase in frequency for 4 days. On examination, he is drowsy, unable to feed, and skin on pinching goes back very slowly. According to the integrated management of neonatal and childhood illness (IMNCI), this child will be classified as having:",
    "choices": [
      {
        "id": 1,
        "text": "Mild dehydration"
      },
      {
        "id": 2,
        "text": "Some dehydration"
      },
      {
        "id": 3,
        "text": "Severe dehydration"
      },
      {
        "id": 4,
        "text": "Moderate dehydration"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>A clinical scenario of a dehydrated child who is <strong>drowsy</strong> and <strong>not able to feed</strong> with <strong>skin going back very slowly on pinching</strong> is suggestive of <strong>severe dehydration&nbsp;</strong>(as per IMNCI).</p>\n<p><strong>Diarrhea</strong> is defined as a change in consistency and frequency of stools that occurs more than <strong>3</strong> times a day. Diarrhea, if associated with blood in stools, is called <strong>dysentery</strong>. If the episodes subside within 7 days, it is called <strong>acute diarrhea</strong>. If it persists for more than 2 weeks, it is called <strong>persistent diarrhea</strong>.</p>\n<p>Intestinal infections are the most common cause of acute diarrhea. <strong>Rotavirus</strong> and <strong>enterotoxigenic <em>E. coli</em></strong> are the major infectious causes of acute diarrhea. Other causes are certain drugs, food allergies, and systemic infections (e.g. urinary tract infection and otitis media).</p>\n<p>The most important assessment in the evaluation of diarrhea is to look for the <strong>degree of dehydration</strong>. It is assessed as follows:</p>\n<table style=\"height: 359px; width: 566px;\">\n<tbody>\n<tr>\n<td style=\"width: 129.5px;\"><strong>Parameters</strong></td>\n<td style=\"width: 135.5px;\"><strong>No dehydration</strong></td>\n<td style=\"width: 134px;\"><strong>Some dehydration</strong></td>\n<td style=\"width: 134px;\"><strong>Severe dehydration</strong></td>\n</tr>\n<tr>\n<td style=\"width: 129.5px;\">Condition</td>\n<td style=\"width: 135.5px;\">Well alert</td>\n<td style=\"width: 134px;\">Restless, irritable</td>\n<td style=\"width: 134px;\">Lethargic or <strong>unconscious, </strong>floppy</td>\n</tr>\n<tr>\n<td style=\"width: 129.5px;\">Eyes</td>\n<td style=\"width: 135.5px;\">Normal</td>\n<td style=\"width: 134px;\">Sunken</td>\n<td style=\"width: 134px;\">Very sunken and dry</td>\n</tr>\n<tr>\n<td style=\"width: 129.5px;\">Tears</td>\n<td style=\"width: 135.5px;\">Present</td>\n<td style=\"width: 134px;\">Absent</td>\n<td style=\"width: 134px;\">Absent</td>\n</tr>\n<tr>\n<td style=\"width: 129.5px;\">Mouth and tongue</td>\n<td style=\"width: 135.5px;\">Moist</td>\n<td style=\"width: 134px;\">Dry</td>\n<td style=\"width: 134px;\">Very dry</td>\n</tr>\n<tr>\n<td style=\"width: 129.5px;\">Thirst</td>\n<td style=\"width: 135.5px;\">Drinks normally<br />not thirsty</td>\n<td style=\"width: 134px;\">Thirsty, drinks eagerly</td>\n<td style=\"width: 134px;\">Drinks poorly or is <strong>not able to drink</strong></td>\n</tr>\n<tr>\n<td style=\"width: 129.5px;\">Skin pinch</td>\n<td style=\"width: 135.5px;\">Goes back quickly</td>\n<td style=\"width: 134px;\">Goes back slowly</td>\n<td style=\"width: 134px;\"><strong>Goes back very slowly</strong></td>\n</tr>\n<tr>\n<td style=\"width: 129.5px;\">Treatment</td>\n<td style=\"width: 135.5px;\">Plan A</td>\n<td style=\"width: 134px;\">Weigh the patient, if possible,<br />and use treatment Plan B</td>\n<td style=\"width: 134px;\">Weigh the patient and use treatment<br />Plan C urgently</td>\n</tr>\n</tbody>\n</table>\n<p>Based on the degree of dehydration after history and examination, the<br /><strong>estimated fluid loss</strong> is calculated as follows:</p>\n<table style=\"height: 140px;\" width=\"397\">\n<tbody>\n<tr>\n<td style=\"width: 190.55px;\"><strong>Degree of dehydration</strong></td>\n<td style=\"width: 190.45px;\"><strong>Assessment of fluid loss</strong></td>\n</tr>\n<tr>\n<td style=\"width: 190.55px;\">No dehydration</td>\n<td style=\"width: 190.45px;\">less than 50 mL/kg</td>\n</tr>\n<tr>\n<td style=\"width: 190.55px;\">Some dehydration</td>\n<td style=\"width: 190.45px;\">50-100 mL/kg</td>\n</tr>\n<tr>\n<td style=\"width: 190.55px;\">Severe dehydration</td>\n<td style=\"width: 190.45px;\">more than 100 mL/kg</td>\n</tr>\n</tbody>\n</table>\n<p>The treatment plans A,B, and C are explained in the pearl below.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following children are considered at-risk babies?",
    "choices": [
      {
        "id": 1,
        "text": "2,3"
      },
      {
        "id": 2,
        "text": "1,2,3,4"
      },
      {
        "id": 3,
        "text": "4,5"
      },
      {
        "id": 4,
        "text": "1,4"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<div class=\"ng-scope\">\n<div class=\"ng-scope\">\n<p class=\"ng-binding\">Among the given options, babies on <strong>artificial feeds</strong> and babies of <strong>working/single parents</strong> as considered&nbsp;<strong>at-risk babies.</strong>&nbsp;</p>\n<p class=\"ng-binding\">The following are considered at-risk infants:</p>\n<ul>\n<li>Birth weight <strong>&lt;2.5 kg</strong></li>\n<li>Twins&nbsp;</li>\n<li><strong>Birth order of 5 or more</strong></li>\n<li>Artificial feeding</li>\n<li><strong>Weight &lt;70% of the expected weight </strong>(i.e. II and III degrees of malnutrition)</li>\n<li>Failure to gain weight during 3 successive months</li>\n<li>Children with&nbsp;protein-energy malnutrition<strong>&nbsp;</strong>(<strong>PEM</strong>) and diarrhea</li>\n<li>Working mother or single parent&nbsp;</li>\n</ul>\n<p>It is important to identify children at risk and give special intensive care. This is done because these children contribute largely to perinatal, neonatal, and infant mortality.</p>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Identify the condition.",
    "choices": [
      {
        "id": 1,
        "text": "Bladder exstrophy"
      },
      {
        "id": 2,
        "text": "Omphalocele"
      },
      {
        "id": 3,
        "text": "Persistent vitellointestinal duct"
      },
      {
        "id": 4,
        "text": "Gastroschisis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Option D: <strong>Gastroschisis&nbsp;</strong>is a condition where intestinal loops herniate through the defect in the abdominal wall. The defect usually lies to <strong>one side of the umbilicus</strong> (right side commonly). The loops of the bowel are <strong>not covered by amnion</strong> as they herniate through the abdominal wall directly into the amniotic cavity. It is associated with elevated <strong>alpha-fetoprotein</strong> levels.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ec72ad1ae36043d8ba91f7beb797d578.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/847da86cdb674b79801255d79963371fx1279x1242.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e46e6a1487b840f4aaf1b14dc57ff0cax1279x1242.JPEG"
    ]
  },
  {
    "text": "A previously healthy child presented with acute-onset dyspnea. A chest X-ray shows unilateral hyperinflation of the lungs. What is true for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Focal area of decreased air entry will be suggestive of foreign body"
      },
      {
        "id": 2,
        "text": "Flexible bronchoscopy used for removal"
      },
      {
        "id": 3,
        "text": "In complete obstruction, ball and valve mechanism causes hyperinflation"
      },
      {
        "id": 4,
        "text": "The child has developed acute laryngotracheobronchitis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The above scenario is suggestive of a <strong>foreign body</strong> in the <strong>airway,</strong> most likely\u00a0in the bronchi. In this condition, auscultation is likely to reveal a <strong>focal area</strong> of<strong> decreased air entry\u00a0</strong>due to incomplete airway obstruction</p>\n<p>It is more commonly seen in children below 4 years. The most foreign bodies in the airway are <strong>food items.</strong> The foreign bodies can be <strong>non-irritating</strong> types (plastic, glass, or metallic foreign bodies) and <strong>irritating</strong> types (vegetables, peanuts, beans, and seeds).</p>\n<p>The clinical presentation depends upon the site of the obstruction.</p>\n<table style=\"height: 184px; width: 440.817px;\">\n<tbody>\n<tr>\n<td style=\"width: 145px;\"><strong>Site of foreign bodies</strong></td>\n<td style=\"width: 273.817px;\"><strong>Signs and symptoms</strong></td>\n</tr>\n<tr>\n<td style=\"width: 145px;\">Larynx</td>\n<td style=\"width: 273.817px;\">\n<ul>\n<li>Complete obstruction causes asphyxia</li>\n<li>Incomplete obstruction causes croup, hoarseness, cough, stridor, and dyspnea.</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td style=\"width: 145px;\">Trachea</td>\n<td style=\"width: 273.817px;\">\u00a0Dysphonia, dysphagia, dry cough, and biphasic stridor.</td>\n</tr>\n<tr>\n<td style=\"width: 145px;\">Bronchi</td>\n<td style=\"width: 273.817px;\">\n<ul>\n<li>May be asymptomatic.</li>\n<li><strong>Asymmetric breath sound/air entry</strong>, coughing, and breathing.</li>\n</ul>\n</td>\n</tr>\n</tbody>\n</table>\n<p><strong>Foreign bodies</strong> in bronchi are more <strong>likely</strong> to <strong>enter</strong> the <strong>right bronchus</strong> because it is <strong>wider</strong> and more <strong>in line</strong> with the <strong>tracheal</strong> lumen.</p>\n<p>The initial evaluation is done with a plain <strong>X-ray chest</strong> in posteroanterior and lateral views (expiratory films are useful). It may reveal:</p>\n<ul>\n<li>The radio-opaque foreign body- size, shape, and location</li>\n<li>In <strong>complete</strong>\u00a0airway obstruction- lobar or segmental <strong>atelectasis</strong></li>\n<li>In <strong>incomplete</strong>\u00a0airway obstruction<strong>- </strong>the <strong>ball valve</strong> <strong>mechanism</strong> is produced when a foreign body<strong> incompletely obstructs</strong> a bronchus <strong>allowing air</strong> to <strong>enter</strong> inside but <strong>not leave.</strong> This leads to the appearance of <strong>hyperinflation</strong>\u00a0or obstructive emphysema of the <strong>affected area</strong> when an <strong>expiratory X-ray</strong> film is taken as the air is not allowed to escape.</li>\n</ul>\n<p><strong>Management</strong> of foreign body airway is as follows:</p>\n<ul>\n<li><strong>Laryngeal</strong> foreign body-\u00a0<strong>Heimlich maneuver</strong> should be attempted.\u00a0If it fails, <strong>cricothyrotomy</strong> or emergency <strong>tracheostomy</strong> should be done</li>\n<li>Foreign bodies in the <strong>trachea</strong> and <strong>bronchi</strong> are removed through a <strong>rigid bronchoscope</strong> after <strong>adequate hydration</strong> and<strong> emptying</strong> of the<strong> stomach.</strong></li>\n<li>Appropriate <strong>antibiotics</strong> are given to prevent secondary infection.</li>\n</ul>\n<p>Option D: <strong>L</strong><strong>aryngotracheobronchitis </strong>or<strong> croup</strong> is caused by the <strong>parainfluenza virus.</strong> It commonly affects children of age 6 months-3 years. The clinical features include <strong>barking cough,</strong> biphasic <strong>stridor,</strong> and <strong>low-grade fever.</strong> The chest <strong>X-ray</strong> shows a\u00a0<strong>narrowing</strong> of the <strong>subglottic region</strong> known as the<strong> steeple sign</strong>.</p>\n<p>The image given below shows the steeple sign seen in croup.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/27865489f62746df981f2abf3e666795x720x702.JPEG"
    ]
  },
  {
    "text": "A male child presented with arthralgia and abdominal pain. On examination, there was palpable purpura over the lower limbs. There is past history of upper respiratory tract infection prior to the onset of presenting symptoms. Which of the following is the treatment for this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Azathioprine"
      },
      {
        "id": 2,
        "text": "Methotrexate"
      },
      {
        "id": 3,
        "text": "Cyclosporine"
      },
      {
        "id": 4,
        "text": "Glucocorticoids"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Other options:</p>\n<p>Immunosuppressants like <strong>azathioprine, methotrexate</strong> and <strong>cyclosporine </strong>are used in a variety of <strong>rheumatologic disorders</strong> like vasculitis, arthritis, inflammatory bowel diseases like Crohn's disease and ulcerative colitis, autoimmune hepatitis, and lupus nephritis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5fa5b37ef5654b55bbac749c23554a42x720x480.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f6c89442e2c14373be3d9a605cd45ab8x720x508.JPEG"
    ]
  },
  {
    "text": "A 10-year-old presents with edema and anasarca. A diagnosis of minimal change disease is made. Which of the following is true about this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Light microscopy shows effacement of podocytes"
      },
      {
        "id": 2,
        "text": "Good response to steroids"
      },
      {
        "id": 3,
        "text": "Most common in adults"
      },
      {
        "id": 4,
        "text": "Non-selective proteinuria"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The majority of children will respond to <strong>corticosteroid </strong>(prednisone/prednisolone) treatment and will achieve complete <strong>remission </strong>(urine PCR&lt;0.2 or &lt;1+ protein on urine dipstick).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/21351171e95f4d01a44ca923200b040fx1280x2264.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c8d9f93354bf4a0cafaa1f94d6ac5892x720x540.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/25349fef3b82459482d2aac2f7e881a5x720x687.JPEG"
    ]
  },
  {
    "text": "A 10-year-old child presents with diarrhea and weight loss. On examination, the height and weight are lesser than expected. Laboratory investigations were positive for class II HLA-DQ2. Which of the following will you advise the child?",
    "choices": [
      {
        "id": 1,
        "text": "Fat-free diet"
      },
      {
        "id": 2,
        "text": "Lactose-free diet"
      },
      {
        "id": 3,
        "text": "Low carbohydrate diet"
      },
      {
        "id": 4,
        "text": "Gluten-free diet"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Other options:</p>\n<p>Option A: <strong>Fat-free diet</strong> is <strong>advised</strong> for various disorders causing <strong>steatorrhea.</strong> These include pancreatic insufficiency, cystic fibrosis, and familial hypercholesterolemia.</p>\n<p>Option B: <strong>Lactose-free diet</strong> is advised for <strong>lactose intolerance.</strong> It occurs due to <strong>lactase</strong> deficiency. Patients usually present with diarrhea, abdominal pain, gassiness, and bloating. A lactose tolerance test or <strong>breath hydrogen test</strong> may be used for the diagnosis.</p>\n<p>Option C: <strong>Low-carbohydrate</strong> diet is advised for <strong>diabetes</strong> mellitus.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f3cc705111074b36a04be6774c34c2c9x800x533.JPEG"
    ]
  }
];
        let quizName = '266 Paediatrics Neet 2022';
        let hierarchy = ["Marrow", "PYQs", "Pediatrics"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>