<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>03 Transport Across Cell Membrane - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Physiology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">24</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Transport of lipid-soluble substances across the cell membrane occurs via which of the following?",
    "choices": [
      {
        "id": 1,
        "text": "Porins"
      },
      {
        "id": 2,
        "text": "Ionophore"
      },
      {
        "id": 3,
        "text": "Lipopolysaccharides"
      },
      {
        "id": 4,
        "text": "Diffusion"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Lipid-soluble substances are transported across the cell membrane via diffusion.</p>\n<ul>\n<li>The <strong>rate of diffusion</strong> depends directly on <strong>lipid solubility.</strong></li>\n<li>Characteristics of simple diffusion\n<ul>\n<li>The only form of transport that is <strong>not carrier-mediated</strong></li>\n<li>Occurs down an electrochemical gradient (<strong>&ldquo;downhill&rdquo;</strong>)</li>\n<li>Does not require metabolic energy and therefore is <strong>passive</strong></li>\n</ul>\n</li>\n<li>Permeability\n<ul>\n<li>Describes the ease with which a solute diffuses through a membrane</li>\n<li>Depends on the characteristics of the solute and the membrane</li>\n</ul>\n</li>\n<li>Small hydrophobic solutes (e.g., O2) have the highest permeabilities in lipid membranes.</li>\n<li>Hydrophilic solutes (e.g., Na+) must cross cell membranes through water-filled channels, or pores. If the solute is an ion, then its flux will depend on both the concentration difference and the potential difference across the membrane.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following will diffuse more rapidly through phospholipid membranes?",
    "choices": [
      {
        "id": 1,
        "text": "Oxygen"
      },
      {
        "id": 2,
        "text": "Sodium"
      },
      {
        "id": 3,
        "text": "Chloride"
      },
      {
        "id": 4,
        "text": "Water"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Among the following substances, <strong>oxygen</strong>&nbsp;diffuses more rapidly through phospholipid membranes as it is a <strong>lipid-soluble</strong> substance.&nbsp;</p>\n<p>Phospholipid membranes are:</p>\n<ul>\n<li>Permeable to lipid-soluble substances (e.g., O<sub>2</sub>, CO<sub>2</sub>, NH<sub>3</sub>, steroid hormones)</li>\n<li>Impermeable to water-soluble substances (e.g., Na<sup>+</sup>, Cl<sup>-</sup>, glucose)</li>\n<li>Semipermeable to water</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is explained by the fick\u2019s law of diffusion?",
    "choices": [
      {
        "id": 1,
        "text": "Active diffusion along concentration gradient"
      },
      {
        "id": 2,
        "text": "Passive diffusion along concentration gradient"
      },
      {
        "id": 3,
        "text": "Active diffusion against concentration gradient"
      },
      {
        "id": 4,
        "text": "Passive diffusion against concentration gradient"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Fick&rsquo;s law of diffusion explains passive diffusion along the concentration gradient.&nbsp;</p>\n<p><strong>Fick&rsquo;s law of diffusion</strong>:<strong>&nbsp;</strong>The magnitude of the diffusing tendency is directly proportional to the cross-sectional area across which diffusion is taking place and the concentration gradient, or chemical gradient, which is the difference in concentration of the diffusing substance divided by the thickness of the membrane.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "For a membrane permeable substance, the intracellular concentration (IC) is 10 units and extracellular concentration (EC) is 5 units. If the intracellular concentration, surface area of the membrane and thickness of the membrane are doubled, and the EC remains the same, What will be the net effect on the diffusion?",
    "choices": [
      {
        "id": 1,
        "text": "Diffusion becomes 2x"
      },
      {
        "id": 2,
        "text": "Diffusion becomes 3x"
      },
      {
        "id": 3,
        "text": "Diffusion becomes 1/2x"
      },
      {
        "id": 4,
        "text": "Diffusion becomes 1/3x"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The net effect on the diffusion is, it&nbsp;<strong>becomes 3x.</strong></p>\n<p>The magnitude of the diffusion:&nbsp;</p>\n<div class=\"ng-scope\">\n<div class=\"ng-scope\"><img class=\"ng-scope\" src=\"https://cdn1.dailyrounds.org/uploads/48bd639ac87e43a29172cf5878d91411x306x127.PNG\" /></div>\n<div class=\"ng-scope\">where,</div>\n</div>\n<div class=\"ng-scope\">\n<div class=\"ng-scope\">\n<ul>\n<li>J = net rate of diffusion</li>\n<li>D = diffusion coefficient</li>\n<li>A = area of the membrane</li>\n<li>&Delta;x = thickness of the membrane or the distance the molecule must travel across for diffusion</li>\n<li>&Delta;c = concentration gradient</li>\n</ul>\n<p>In the condition mentioned above, the surface area, the thickness of the membrane and intracellular concentration becomes doubled. This means,<strong><br /></strong></p>\n<ul>\n<li><strong>A&nbsp;</strong>is doubled = 2A</li>\n<li><strong>&Delta;x&nbsp;</strong>is doubled = 2&Delta;x</li>\n<li>IC is doubled. 10x2= 20 units; EC is 5 units.</li>\n</ul>\n<p>So,&nbsp;&Delta;c = 20 - 5 = 15.&nbsp;&Delta;c was 5 with the original concentrations. Hence &Delta;c has been tripled.</p>\n<p>Now,</p>\n<p>J=-D x 2A x 3&Delta;c/2&Delta;x = 3 x [DA &Delta;c/&Delta;x]</p>\n<p>Therefore the <strong>diffusion of the substance increases by three-fold.</strong></p>\n<p><strong>2nd method :</strong></p>\n<p>J = - DA (&Delta;c / &Delta;x )<br />After applying changes,&Delta;c = intracellular conc. - extracellular conc. &nbsp;&nbsp;&nbsp;&nbsp;= 10 - 5&nbsp; &nbsp; = 5</p>\n<p>Therefore, J1 = - DA (5 / &Delta;x ) <br /><br />After appropriate doublings, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;New intracellular conc. = 10 * 2 = 20 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;New extracellular conc. = 5 (since no change) &nbsp;&nbsp;&nbsp;&nbsp;&Delta;c = 20 - 5 = 15</p>\n<p>Therefore, J2 = - D 2*A (15 / 2*&Delta;x ) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p>\n<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= - D A (15 / &Delta;x )</p>\n<p>Now, &nbsp;&nbsp;&nbsp;&nbsp;J2 &nbsp;/ J1 = [- DA (15 / &Delta;x ) ] / [ = - DA (5 / &Delta;x ) ] &nbsp;&nbsp;&nbsp;</p>\n<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; J2 &nbsp;/ J1 &nbsp;= 15 / 5&nbsp;</p>\n<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= 3</p>\n<p>Therefore the <strong>diffusion of the substance increases by three-fold.</strong></p>\n<p>&nbsp;</p>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following does not follow transport saturation kinetics?",
    "choices": [
      {
        "id": 1,
        "text": "Facilitated diffusion"
      },
      {
        "id": 2,
        "text": "Na+-Ca2+ exchanger"
      },
      {
        "id": 3,
        "text": "Simple diffusion"
      },
      {
        "id": 4,
        "text": "Coupled transport"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Simple diffusion</strong> is not carrier-mediated transport hence do not follow saturation kinetics.</p>\n<ul>\n<li>Facilitated diffusion, primary active transport, and secondary active transport all involve integral membrane proteins and are called <strong>carrier-mediated transport</strong>.</li>\n<li><strong>All carrier-mediated transport system follows saturation kinetics</strong>.</li>\n<li><strong>The figure</strong> shows that as the concentration of the diffusing substance increases, the rate of simple diffusion continues to increase proportionately, but in the case of facilitated diffusion, the rate of diffusion cannot rise greater than the<strong> transport maximum</strong> (Tm). Tm is analogous to the&nbsp;<strong>maximum velocity</strong> (Vmax) level in enzyme kinetics.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/57ca1b0e751c4de3b0537fdd51104884x1280x959.JPEG"
    ]
  },
  {
    "text": "Which statement about the facilitated diffusion is true?",
    "choices": [
      {
        "id": 1,
        "text": "Form of active transport"
      },
      {
        "id": 2,
        "text": "Requires carrier protein"
      },
      {
        "id": 3,
        "text": "Doesn't follow saturation kinetics"
      },
      {
        "id": 4,
        "text": "Requires creatinine phosphate"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>When <strong>carrier proteins </strong>help in the movement of substances in the direction of their chemical or electrical gradients (downhill movement), no energy input is required and the process is called <strong>facilitated diffusion.</strong></p>\n<p><strong>Examples</strong></p>\n<ul>\n<li>GLUT</li>\n<li>Urea Transporters :\n<ul>\n<li>UTA<sub> 1, 2, 3, 4</sub> in Kidney</li>\n<li>UTB in RBC</li>\n</ul>\n</li>\n<li>Amino Acid Transporters</li>\n</ul>\n<p>Other options are wrong because:&nbsp;</p>\n<ul>\n<li>Facilitated diffusion is a type of passive transport.</li>\n<li>It follows saturation kinetics.&nbsp;</li>\n<li>No energy input is required in facilitated diffusion.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/cf1a691501c84c0a8bda5452ac135c65x1280x959.JPEG"
    ]
  },
  {
    "text": "The movement of which of the following substance across the membrane is most affected by osmotic pressure?",
    "choices": [
      {
        "id": 1,
        "text": "Sodium"
      },
      {
        "id": 2,
        "text": "Potassium"
      },
      {
        "id": 3,
        "text": "Water"
      },
      {
        "id": 4,
        "text": "Glucose"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<ul>\n<li>Osmotic pressure is calculated by <strong>Vant Hoff&rsquo;s law</strong>.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8e35ad8d48c24887b9e12db0ac64d953x1280x1475.JPEG"
    ]
  },
  {
    "text": "Osmolarity is defined as _______",
    "choices": [
      {
        "id": 1,
        "text": "Number of osmole per litre"
      },
      {
        "id": 2,
        "text": "Number of osmole per kg"
      },
      {
        "id": 3,
        "text": "Weight of solute per litre"
      },
      {
        "id": 4,
        "text": "Weight of solvent per litre"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Difference between osmolarity &amp; osmolality:</strong></p>\n<ul>\n<li><strong>Osmolarity</strong> is the number of osmoles <strong>per litre of</strong> <strong>solution</strong>,</li>\n<li><strong>Osmolality</strong> is the number of osmoles <strong>per kilogram of solvent</strong>.</li>\n<li>Therefore, osmolarity is affected by the volume of the various solutes in the solution and the temperature, while the osmolality is not.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Passive transfer of only solvent occurs in ______",
    "choices": [
      {
        "id": 1,
        "text": "Diffusion"
      },
      {
        "id": 2,
        "text": "Active transport"
      },
      {
        "id": 3,
        "text": "Osmosis"
      },
      {
        "id": 4,
        "text": "Pinocytosis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Passive transfer of the only solvent occurs in&nbsp;<strong>Osmosis.</strong></p>\n<p>The diffusion of <strong>solvent</strong> molecules into a region in which there is a higher concentration of a <strong>solute</strong> to which the membrane is impermeable is called <strong>osmosis.</strong></p>\n<p>Note: Membrane is impermeable to the solute.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 47-year-old diabetic man takes a low-dose aspirin daily due to cardiovascular risk. The absorption of aspirin in the stomach is an example of which type of transport?",
    "choices": [
      {
        "id": 1,
        "text": "Nonionic diffusion"
      },
      {
        "id": 2,
        "text": "Facilitated diffusion"
      },
      {
        "id": 3,
        "text": "Simple diffusion"
      },
      {
        "id": 4,
        "text": "Secondary active transport"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The absorption of salicylates like aspirin in the stomach is an example of <strong>nonionic diffusion</strong>.</p>\n<ul>\n<li>Some weak acids and bases are quite soluble in cell membranes in the undissociated form, but they cannot cross membranes in the charged (i.e. dissociated) form. Consequently, molecules of the undissociated substance diffuse from one side of the membrane to the other and then dissociate. This phenomenon is called <strong>nonionic diffusion</strong>.</li>\n</ul>\n<p><strong>Examples</strong></p>\n<ul>\n<li>Ammonia excretion in collecting ducts</li>\n<li>Excretion of weak acids and bases in the kidney</li>\n<li>Absorption of salicylates in the stomach</li>\n<li>Absorption of bile acids in the distal ileum</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Energy is required in which of the following mode of transport.",
    "choices": [
      {
        "id": 1,
        "text": "Osmosis"
      },
      {
        "id": 2,
        "text": "Diffusion"
      },
      {
        "id": 3,
        "text": "Facilitated diffusion"
      },
      {
        "id": 4,
        "text": "Active transport"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>When a carrier protein transports substances against their electrical and chemical gradients (uphill movement) it requires energy and this type of transport <strong>is called active transport</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/422fba2d55334e289eeea90b0de17786x1280x1167.JPEG"
    ]
  },
  {
    "text": "Movement of calcium from the cytosol to the extracellular space takes place by",
    "choices": [
      {
        "id": 1,
        "text": "Primary active transport"
      },
      {
        "id": 2,
        "text": "Facilitated diffusion"
      },
      {
        "id": 3,
        "text": "Simple diffusion"
      },
      {
        "id": 4,
        "text": "None of the above"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The movement of calcium from the cytosol to the extracellular space takes place by primary active transport.&nbsp;</p>\n<p>Two <strong>primary active transport</strong> calcium pumps maintain low intracellular calcium levels. One pumps calcium ions&nbsp;to the extracellular space and another to the sarcoplasmic reticulum.</p>\n<p>Calcium transport also takes place via <strong>secondary active transport</strong>. A <strong>sodium-calcium exchanger/antiporter</strong>&nbsp;moves sodium ions to the interior and calcium ions to the exterior.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Na+-K+ ATP pump uses ________",
    "choices": [
      {
        "id": 1,
        "text": "ATPase"
      },
      {
        "id": 2,
        "text": "GTPase"
      },
      {
        "id": 3,
        "text": "Acetyl CoA"
      },
      {
        "id": 4,
        "text": "NADPH"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Functions:</strong></p>\n<ul>\n<li>Controlling Cell Volume.</li>\n<li>Electrogenic Nature- maintains Resting membrane potential</li>\n<li>The energy from the Na+&ndash;K+ pump also indirectly serves as the energy source for secondary active transport.</li>\n</ul>\n<p><strong>Regulation:</strong></p>\n<ul>\n<li>Pump activity is altered by second messenger molecules eg. cAMP, DAG</li>\n<li>Stimulated by thyroid hormones, insulin and aldosterone</li>\n<li>Inhibition by dopamine ,digitalis glycosides, ouabain</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d5b2c6c36dd64bec9f82bd9995a83de8x800x380.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/98d08d6a031e419b94568f325e496e6dx1020x1602.JPEG"
    ]
  },
  {
    "text": "Primary active transport is mediated by which one of the following enzymes?",
    "choices": [
      {
        "id": 1,
        "text": "G-Protein"
      },
      {
        "id": 2,
        "text": "Na+-K+ ATPase"
      },
      {
        "id": 3,
        "text": "Carrier protein"
      },
      {
        "id": 4,
        "text": "Channel protein"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In active transport the energy is provided almost exclusively by the hydrolysis of ATP. Hence many carrier molecules are ATPases (eg. <strong>Na+-K+-ATPase</strong>), enzymes that catalyze the hydrolysis of ATP.</p>\n<table style=\"width: 319px;\">\n<tbody>\n<tr>\n<td style=\"width: 166px;\"><strong>PRIMARY ACTIVE TRANSPORT</strong></td>\n<td style=\"width: 155px;\"><strong>SECONDARY ACTIVE TRANSPORT</strong></td>\n</tr>\n<tr>\n<td style=\"width: 166px;\">Requires <strong>direct input of metabolic energy </strong>in the form of adenosine triphosphate <strong>(ATP) </strong>\u00a0</td>\n<td style=\"width: 155px;\">The transport of two or more solutes is coupled and metabolic energy is provided\u00a0 <strong>indirectly</strong> from the Na<sup>+</sup> gradient that is maintained across cell membranes by Na<sup>+</sup>-K<sup>+</sup>-ATPase pump</td>\n</tr>\n<tr>\n<td style=\"width: 166px;\">\n<p>a) Na<sup>+</sup>-K<sup>+</sup>-ATPase or sodium potassium pump</p>\n<p>b) Ca<sup>2+</sup> -ATPase</p>\n<p>c) H<sup>+</sup>-ATPase or proton pump d)\u00a0\u00a0\u00a0\u00a0\u00a0 H<sup>+</sup>-K<sup>+</sup>-ATPase</p>\n</td>\n<td style=\"width: 155px;\">\n<p>a) Na<sup>+</sup>- glucose cotransport</p>\n<p>b) Na<sup>+</sup>-Ca<sup>2+</sup> counter transport</p>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "For Na+-K+ ATPase coupling ratio is _____",
    "choices": [
      {
        "id": 1,
        "text": "1:1"
      },
      {
        "id": 2,
        "text": "1:2"
      },
      {
        "id": 3,
        "text": "2:3"
      },
      {
        "id": 4,
        "text": "3:2"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Na+-K+ ATPase or Na+-K+ ATP pump is an <strong>electrogenic pump</strong> in that it moves three positive charges out of the cell for each two that it moves in, and it is therefore said to have a <strong>coupling ratio of 3:2.</strong></p>\n<p><strong>Note:</strong></p>\n<ul>\n<li>Na+-K+ ATP pump is found in almost all parts of the body, and it catalyzes the hydrolysis of ATP to ADP and uses the energy for its activity</li>\n<li>It is one of the <strong>major energy using process</strong> in the body. On an average, it accounts for<strong> 24% of the energy utilized by the cells</strong>, and in <strong>neurons it accounts for 70%</strong>. Thus, it accounts for large share in basal metabolism</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 40-year-old diabetic man has been prescribed empagliflozin. Which of the following processes will most likely be affected by this drug?",
    "choices": [
      {
        "id": 1,
        "text": "Secondary active transport"
      },
      {
        "id": 2,
        "text": "Primary active transport"
      },
      {
        "id": 3,
        "text": "Facilitated diffusion"
      },
      {
        "id": 4,
        "text": "Simple diffusion"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Empagliflozin</strong> is an SGLT-2 inhibitor.\u00a0<strong>SGLT-2</strong> or sodium-glucose transport protein 2 is an example of a cotransporter that plays a key role in glucose absorption from renal tubule by\u00a0<strong>secondary active transport</strong>. This process is blocked by <strong>SGLT-2 inhibitors</strong>, leading to renal loss of glucose and improved glycemic control.</p>\n<ul>\n<li>A special property of the transport protein involved in secondary active transport is that a conformational change to allow Na+ movement to the interior will not occur until a glucose molecule also attaches to the transport protein. When they both become attached, the conformational change takes place automatically, and the Na+ and glucose are transported to the inside of the cell at the same time.</li>\n<li>The figure shows glucose is transported <strong>uphill</strong> and Na+ is transported downhill. Energy derived from the downhill movement of Na+ is maintained by the\u00a0<strong>Na<sup>+</sup>-K<sup>+</sup> ATPase</strong> pump on the basolateral side.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5400c06db26f4755955d436ac2b31edbx1279x981.JPEG"
    ]
  },
  {
    "text": "Glucose is absorbed in intestine by?",
    "choices": [
      {
        "id": 1,
        "text": "Primary active transport"
      },
      {
        "id": 2,
        "text": "Facilitated diffusion"
      },
      {
        "id": 3,
        "text": "Simple diffusion"
      },
      {
        "id": 4,
        "text": "Secondary active transport"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p class=\"p1\"><strong>Glucose</strong> is absorbed in <strong>the intestine by secondary active transport </strong>(sodium co-transport).</p>\n<div class=\"page\" title=\"Page 803\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<div class=\"page\" title=\"Page 803\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>The energy for glucose transport is provided indirectly, by the active transport of Na+ out of the cell. This maintains the concen&shy;tration gradient across the luminal border of the cell so that more Na+ and consequently more glucose enter.</p>\n<p>Though both secondary active transport and facilitated diffusion play a role in glucose absorption, it is the initial active transport of sodium through the basolateral membranes of the intestinal epithelial cells that provide the eventual force for moving glucose through the membranes as well. So,&nbsp;<strong>secondary active transport</strong> is the single best answer for this question.</p>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 40-year-old lady is diagnosed with Lambart- Eaton syndrome. Radioimmunoassay reveals the presence of serum antibodies against voltage-gated calcium channels. Which of the following process will be affected as a result of this pathology?",
    "choices": [
      {
        "id": 1,
        "text": "Facilitated Diffusion"
      },
      {
        "id": 2,
        "text": "Endocytosis"
      },
      {
        "id": 3,
        "text": "Exocytosis"
      },
      {
        "id": 4,
        "text": "Simple Diffusion"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Exocytosis</strong> of neurotransmitters at the nerve terminals will be affected&nbsp;as a result of&nbsp;antibodies against voltage-gated calcium channels.</p>\n<p>After an action potential reaches the terminal endings of a nerve, the influx of Ca2+ via voltage-gated calcium channels leads to the fusion of intracellular vesicles with cell membranes. This results in the release of neurotransmitters into the synaptic space. This process will be impaired in the case of Lambert-eaton syndrome.</p>\n<p><strong>Exocytosis</strong> is the extrusion of membrane-bound vesicles.&nbsp;In <strong>exocytosis</strong>, intracellular vesicles move to the cell membrane, fuse with it and then release their contents to the extracellular fluid.&nbsp;Solute and water can be released from the cell via vesicles by the process of <strong>exocytosis</strong>.</p>\n<p><strong>Exocytosis can be:</strong></p>\n<p><strong>Constitutive exocytosis:</strong></p>\n<ul>\n<li>Involves prompt transport of proteins to the cell membrane in vesicles, with little or no processing or storage</li>\n<li>Examples\n<ul>\n<li>Goblet cells in the intestine continuously to release mucus</li>\n<li>Fibroblasts in connective tissue release collagen</li>\n</ul>\n</li>\n</ul>\n<p><strong>Regulated/ Non constitutive exocytosis:</strong></p>\n<ul>\n<li>Here the proteins from golgi apparatus initially enter the secretory granules, where the processing of prohormones to mature hormones occurs before exocytosis</li>\n<li>Examples\n<ul>\n<li>Endocrine cells, hormones are stored in secretory vesicles and released in response to a signal from outside the cell.</li>\n<li>To insert proteins into the cell membrane like aquaporin insertion</li>\n</ul>\n</li>\n</ul>\n<p><strong>Note:</strong></p>\n<ul>\n<li>The term &lsquo;regulated exocytosis&rsquo; is misleading because even constitutive exocytosis is regulated.</li>\n</ul>\n<ul>\n<li>Exocytosis involves two families of proteins: <strong>Rabs</strong>, which help vesicles dock onto the membrane, and <strong>SNAREs</strong>, which facilitate membrane fusion.</li>\n<li>This is Ca2+ -dependent process</li>\n<li>Exocytosis, like endocytosis, requires energy in the form of ATP.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1718dd14780a4086bd0c676502c40d17x399x352.PNG"
    ]
  },
  {
    "text": "Which pathway is called regulated pathway?",
    "choices": [
      {
        "id": 1,
        "text": "Constitutive exocytosis"
      },
      {
        "id": 2,
        "text": "Constitutive endocytosis"
      },
      {
        "id": 3,
        "text": "Receptor mediated endocytosis"
      },
      {
        "id": 4,
        "text": "Non Constitutive exocytosis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The non constitutive pathway of exocytosis is called the regulated pathway.</p>\n<p>Exocytosis can be either constitutive or non constitutive(regulated):</p>\n<ul>\n<li><strong>Regulated or nonconstitutive pathway:</strong> Proteins from the Golgi apparatus initially enter secretory granules, where processing of prohormones to the mature hormones occurs before exocytosis.</li>\n<li><strong>Constitutive pathway:</strong> Involves the prompt transport of proteins to the cell membrane in vesicles, with little or no processing or storage.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 30-year-old gentleman is diagnosed with elevated blood cholesterol levels. A defect in a process that involves the protein 'clathrin' is being suspected. Which of the following process will be most likely affected by this defect?",
    "choices": [
      {
        "id": 1,
        "text": "Receptor mediated endocytosis"
      },
      {
        "id": 2,
        "text": "Exocytosis"
      },
      {
        "id": 3,
        "text": "Cell to cell adhesion"
      },
      {
        "id": 4,
        "text": "Plasma membrane"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Importance:</strong></p>\n<ul>\n<li>Internalisation of many receptors and ligands bound to them eg. LDL, Nerve Growth Factor.</li>\n<li>Receptor-mediated endocytosis transports a variety of substances including protein hormones, growth factors, antibodies, and plasma proteins that serve as carriers for iron and cholesterol.</li>\n<li>Synaptic function</li>\n<li>Abnormalities in receptor-mediated removal of cholesterol from the blood are associated with elevated plasma cholesterol levels and cardiovascular disease.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d8f898626f294591ab81af1b3dc493d9x1280x957.JPEG"
    ]
  },
  {
    "text": "Which of the following is true about secretory vesicle transport?",
    "choices": [
      {
        "id": 1,
        "text": "Along concentration gradient"
      },
      {
        "id": 2,
        "text": "No relation with concentration gradient"
      },
      {
        "id": 3,
        "text": "Against the concentration gradient"
      },
      {
        "id": 4,
        "text": "Passive method of membrane transport"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Vesicular transport has <strong>no relation</strong> to the concentration gradient.</p>\n<p>Vesicular transport requires energy expenditure by the cell, so this is an <strong>active</strong> method of membrane transport. Energy is needed to accomplish vesicle formation and vesicle movement within the cell.</p>\n<p>&nbsp;</p>\n<table style=\"width: 829px;\">\n<tbody>\n<tr>\n<td style=\"width: 119px;\">METHOD OF TRANSPORT</td>\n<td style=\"width: 179px;\">SUBSTANCE INVOLVED</td>\n<td style=\"width: 256px;\">ENERGY REQUIREMENT</td>\n</tr>\n<tr>\n<td style=\"width: 119px;\"><strong>Endocytosis</strong></td>\n<td style=\"width: 179px;\">\n<div class=\"page\" title=\"Page 21\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Uptake of fluids or macromolecules by the cell</p>\n</div>\n</div>\n</div>\n</div>\n</td>\n<td style=\"width: 256px;\">&nbsp;</td>\n</tr>\n<tr>\n<td style=\"width: 119px;\">\n<ol>\n<li>Pinocytosis</li>\n</ol>\n</td>\n<td style=\"width: 179px;\">\n<p>Substances ingested are in the solution</p>\n</td>\n<td style=\"width: 256px;\">\n<p>Small molecules are taken up by invaginations of the plasma membrane&nbsp;and pinch off to form a vesicle.</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 119px;\">\n<p>&nbsp; &nbsp; 2. Phagocytosis</p>\n</td>\n<td style=\"width: 179px;\">Multimolecular particles (e.g bacteria, cellular debris)</td>\n<td style=\"width: 256px;\">Active. The cell extends pseudopods around the particle to form a vesicle.</td>\n</tr>\n<tr>\n<td style=\"width: 119px;\">&nbsp; &nbsp; 3. Receptor-mediated</td>\n<td style=\"width: 179px;\">Specific large polar molecule (ex: Transferrin, LDL)</td>\n<td style=\"width: 256px;\">Active. Molecules bind to receptors that are localized in clathrin-coated pits in the plasma membrane, endocytosed in vesicles that fuse with lysosomes</td>\n</tr>\n<tr>\n<td style=\"width: 119px;\"><strong>Transcytosis</strong></td>\n<td style=\"width: 179px;\">\n<div class=\"page\" title=\"Page 21\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Intact proteins across epithelial barriers (e.g., ingested antibodies in maternal milk across intestinal epithelia)</p>\n</div>\n</div>\n</div>\n</div>\n</td>\n<td style=\"width: 256px;\">\n<div class=\"page\" title=\"Page 21\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Movement of endocytosed vesicles between the apical and basolateral compartments of cells.</p>\n</div>\n</div>\n</div>\n</div>\n</td>\n</tr>\n<tr>\n<td style=\"width: 119px;\"><strong>Exocytosis</strong></td>\n<td style=\"width: 179px;\">Secretary products (e.g hormones, enzymes), as well as large molecules that pass through the cell intact.</td>\n<td style=\"width: 256px;\">Active. An increase in cytosolic Ca2+ induces the fusion of a secretory vesicle with the plasma membrane; the vesicle opens up and releases its contents.</td>\n</tr>\n</tbody>\n</table>\n<div class=\"page\" title=\"Page 59\">&nbsp;</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Transcytosis occurs in which of the following cell types?",
    "choices": [
      {
        "id": 1,
        "text": "Epithelial cells of intestine"
      },
      {
        "id": 2,
        "text": "Neuroglia"
      },
      {
        "id": 3,
        "text": "Neuron"
      },
      {
        "id": 4,
        "text": "Axolemma"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Transcytosis is seen in epithelial cells of intestine. Transcytosis is endocytosis across one membrane of the cell followed by exocytosis across the opposite membrane.</p>\n<p><strong>Transcytosis across epithelia or endothelia:&nbsp;</strong>Some molecules, such as proteins, are too large to diffuse through the membrane or cross the membrane transporters of epithelia. Instead they are moved across epithelia by transcytosis.</p>\n<p><strong>Steps:</strong></p>\n<ul>\n<li>The molecule is brought into the epithelial cell via receptor-mediated endocytosis.</li>\n<li>The resulting vesicle attaches to microtubules in the cells cytoskeleton and is transported across the cell by vesicular transport.</li>\n<li>At the opposite side of the epithelium, the contents of the vesicle are expelled into the interstitial fluid by exocytosis.</li>\n</ul>\n<p><strong>Significance:</strong></p>\n<ul>\n<li>Transcytosis makes it possible for large proteins to move across an epithelium and remain intact.</li>\n<li>It is the means by which infants absorb maternal antibodies in breast milk. The antibodies are absorbed on the apical surface of the infant&rsquo;s intestinal epithelium and then released into the extracellular fluid.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c62fc3ee8e2748328db54c9434a8bb58x800x575.PNG"
    ]
  },
  {
    "text": "Which of the following ion is used in exocytosis?",
    "choices": [
      {
        "id": 1,
        "text": "K+"
      },
      {
        "id": 2,
        "text": "Na+"
      },
      {
        "id": 3,
        "text": "Ca2+"
      },
      {
        "id": 4,
        "text": "Mg"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>As exocytosis, begins &rarr; &uarr;in intracellular Ca<sup>2+</sup> &rarr; Ca<sup>2+</sup>interacts with a calcium sensing protein &rarr; secretory vesicle docking and fusion &rarr; fused area of membrane opens, the vesicle contents diffuse into the extracellular fluid while the vesicle membrane stays behind and becomes part of the cell membrane.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 35-year-old diabetic man is started on an insulin secretagogue. Which of the following ions is required for emeiocytosis or reverse pinocytosis during the insulin secretion process?",
    "choices": [
      {
        "id": 1,
        "text": "Na+"
      },
      {
        "id": 2,
        "text": "K+"
      },
      {
        "id": 3,
        "text": "Ca2+"
      },
      {
        "id": 4,
        "text": "Mg2+"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Emeiocytosis </strong>requires<strong> Ca<sup>2+</sup></strong> directly.</p>\n<p><strong>Emeiocytosis </strong>is&nbsp;the&nbsp;movement of secretory granules to the plasma membrane of the cell, fusion of the granule surface membrane with the cell membrane, rupture of membranes, and liberation of granular contents into the pericapillary space.&nbsp;</p>\n<p><strong>Insulin secretion </strong>(as shown in the image below):</p>\n<ul>\n<li>Glucose enters B cells by GLUT-2 transporters.</li>\n<li>It is phosphorylated and metabolized to pyruvate (Pyr) in the cytoplasm.</li>\n<li>The Pyr enters the mitochondria and is metabolized via the citric acid cycle. The ATP formed by oxidative phosphorylation inhibits ATP-sensitive K<sup>+</sup> channels, reducing K<sup>+</sup> efflux.</li>\n<li>This depolarizes the B cell, and Ca<sup>2+</sup> influx is increased. The Ca<sup>2+</sup> stimulates the release of insulin by exocytosis. Glutamate (Glu) is also formed, and this primes secretory granules, preparing them for exocytosis.</li>\n</ul>\n<p>It is <strong>promoted by Ca<sup>2+,&nbsp;</sup>&nbsp;&uarr; K<sup>+</sup></strong></p>\n<p>It is <strong>inhibited by Mg<sup>2+,&nbsp;</sup>K<sup>+</sup> depletion</strong>.</p>\n<p>The process of emeiocytosis for insulin secretion is depicted in the image below.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c112a56ab4744b22baec3a1e041e026ax600x685.JPEG"
    ]
  }
];
        let quizName = '03 Transport Across Cell Membrane';
        let hierarchy = ["Marrow", "qBank", "Physiology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>