<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neet 2021 Mini Test 6  (20 Questions) - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2020-21
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following conditions is not typically associated with the histopathological feature shown below?",
    "choices": [
      {
        "id": 1,
        "text": "Papillary thyroid carcinoma"
      },
      {
        "id": 2,
        "text": "Follicular carcinoma of thyroid"
      },
      {
        "id": 3,
        "text": "Meningioma"
      },
      {
        "id": 4,
        "text": "Papillary serous cystadenocarcinoma of ovary"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The above histopathological slide shows a <strong>Psammoma body</strong>. It is <strong>not typically seen </strong>in<strong> follicular carcinoma of the thyroid.</strong></p>\n<p>Psammoma bodies are<strong>\u00a0</strong>are <strong>concentric, lamellated structures</strong> formed as a product of <strong>dystrophic calcification. </strong>They are<strong>\u00a0</strong>associated with<strong> papillary</strong> <strong>histomorphology</strong>\u00a0and are caused by <strong>infarction and calcification of papillae tips.\u00a0</strong></p>\n<p>Conditions associated with psammoma bodies include-</p>\n<ul>\n<li>Papillary thyroid carcinoma</li>\n<li>Papillary serous cystadenocarcinoma of the ovary</li>\n<li>Papillary renal cell carcinoma</li>\n<li>Meningiomas</li>\n<li>Prolactinoma</li>\n<li>Mesothelioma</li>\n<li>Somatostatinoma.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/0ad0408338e64c6a85114f85d482d35a.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 22-year-old primigravida at 36 weeks gestation comes to the ER with nausea, vomiting, and abdominal pain. Nausea and vomiting began one day back and now the patient is unable to tolerate fluids. She complains of pain in the right upper quadrant which started a few hours back. On examination, her temperature is 100.2 F, the pulse is 118 bpm and her BP is 110/70 mm of Hg. She has swelling of her lower limbs up to the ankles bilaterally. Abdominal examination shows a gravid uterus corresponding to 36 weeks of gestation and tenderness in the right upper quadrant, with mild guarding. She was treated for asymptomatic bacteriuria in the first trimester. Laboratory results are given below. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Acute appendicitis"
      },
      {
        "id": 2,
        "text": "Acute fatty liver of pregnancy"
      },
      {
        "id": 3,
        "text": "HELLP syndrome"
      },
      {
        "id": 4,
        "text": "Acute pyelonephritis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>This patient's clinical scenario along with the USG findings is most suggestive of <strong>acute appendicitis.</strong></p>\n<p><strong>Acute appendicitis</strong> is the <strong>most common surgical non-gynecological cause</strong> of acute abdomen in pregnancy.</p>\n<p>The diagnosis of acute appendicitis in pregnancy is difficult due to</p>\n<ul>\n<li>Nausea and vomiting may be considered normal, especially in the first trimester of pregnancy</li>\n<li>Leukocytosis is a physiological finding in pregnancy</li>\n<li>A gravid enlarging uterus can push the appendix upward and outward, causing the pain to localize in the right flank or right upper quadrant.</li>\n</ul>\n<p>Acute appendicitis in pregnancy is associated with miscarriage, preterm delivery, increased risk of peritonitis, perinatal and maternal mortality.</p>\n<p>USG abdomen is used to confirm. MRI abdomen can be done if USG is inconclusive. <strong>Operative laparotomy</strong> with minimal uterine manipulation should be done at the earliest. Laparoscopic appendicectomy can be done before 28 weeks of gestation.&nbsp;<strong>USG Abdomen</strong> would reveal a <strong>&gt;6mm diameter</strong>, <strong>aperistaltic, non-compressible, dilated</strong> appendix seen as a <strong>blind-ending&nbsp;structure arising from the base of the caecum</strong></p>\n<p>Other options:</p>\n<p>Option B: <strong>Acute fatty liver of pregnancy</strong> also presents with nausea, vomiting, and right upper abdominal pain in the third trimester of pregnancy. However, it is associated with a<strong> significant elevation in liver transaminases,</strong>&nbsp;although usually &lt;1000 U/L.</p>\n<p>Option C: <strong>HELLP</strong> (hemolysis, elevated liver enzymes, low platelets) syndrome, a complication of preeclampsia also presents with nausea and vomiting, with mid-epigastric pain. It is associated with <strong>proteinuria</strong> and <strong>platelet count &lt;10,000 cells/&mu;L</strong>.This patient's BP is normal and urinalysis shows no proteins.&nbsp;</p>\n<p>Option D: <strong>Acute pyelonephritis</strong> presents with nausea, vomiting, right flank pain, and spiking fever. Untreated asymptomatic bacteriuria in early pregnancy may increase the risk of acute pyelonephritis. This patient has a clean urinalysis, and no USG findings suggestive of pyelonephritis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You are evaluating a 7-year-old boy in the emergency department who was brought from school with complaints of fever and sore throat. On examination, he has extensive submandibular and cervical swelling. On performing an oral exam, he has foul breath and a well-demarcated white-gray exudative substance adherent to his oropharynx as shown in the image below. Attempts to remove this pseudomembranous substance result in bleeding. A rapid strep test on a throat swab is negative. On asking for the patient\u2019s vaccination records, the school notes say that he has not undergone routine vaccinations by parental choice. Which of the following is incorrect about the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Systemic manifestations are due to bacterial toxin"
      },
      {
        "id": 2,
        "text": "Toxin acts by over-activating adenylate cyclase"
      },
      {
        "id": 3,
        "text": "The patient is at risk for congestive heart failure"
      },
      {
        "id": 4,
        "text": "Droplet precautions are recommended for the patient"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>This is a classic clinical description and oral examination of a patient with <strong>diphtheria</strong>.&nbsp;The diphtheria toxin is an extremely potent protein toxin that acts by <strong>inhibiting protein synthesis</strong> by <strong>inactivating elongation factor (EF-2)</strong>.</p>\n<p>&nbsp;<strong>Corynebacterium diphtheria</strong> (also called Klebs- Loeffler bacillus) is a gram-positive bacillus with clubbing at both ends. They possess characteristic polymetaphosphate granules also called <strong>metachromatic granules</strong>.&nbsp;&nbsp;</p>\n<p>Clinically, patients with diphtheria present with fever, sore throat, and pseudomembranous lesions on the tonsillar, pharyngeal, or nasal mucosa. The pseudo-membrane in diphtheria is tightly adherent to the underlying tissues and attempts to remove them result in bleeding. A few patients develop massive edema of the tonsils, submandibular and paratracheal region causing a characteristic&nbsp;<strong>bull-neck. </strong>It is&nbsp;associated with foul breath, thick speech, and stridor.</p>\n<p>The systemic manifestations of diphtheria are due to&nbsp;<strong>diphtheria toxin</strong> and not due to bacteremia. It has a special affinity for myocardium, adrenal glands, and nerve endings and therefore, causes weakness as a result of <strong>neurotoxicity</strong>, cardiac arrhythmias, or congestive heart failure due to <strong>myocarditis</strong>.</p>\n<p>Treatment of diphtheria includes administration of <strong>diphtheria anti-toxin</strong>. Recommended antibiotics include <strong>penicillin G</strong> and <strong>erythromycin</strong> for <strong>two weeks.&nbsp;</strong>Patients are placed in an isolation room and droplet precautions should be maintained for all cases of respiratory diphtheria. Although patients are not contagious starting 48 hours after antibiotic therapy, droplet precautions are typically maintained until the completion of antibiotic course and is culture-negative on two cultures taken 24 hours apart. Droplet precautions include use of masks, gowns, gloves and protective eye-gear when providing direct patient care.&nbsp;</p>\n<p>While the development of an effective vaccine has nearly eradicated the disease in many countries, failure to undergo routine vaccination leaves some patients at risk.&nbsp;Vaccination with diphtheria toxoid is recommended for all cases of diphtheria after convalescence, as natural infection may not induce an adequate level of protective immunity.</p>\n<p>Patient with diphtheria showing bull-neck-</p>\n<div class=\"page\" title=\"Page 248\">&nbsp;</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/fa8488123fb34c198b32725c9e3b1a2d.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3acf5b15face45469a087dbe87f43243x268x332.JPEG"
    ]
  },
  {
    "text": "Use of raloxifene would be indicated for",
    "choices": [
      {
        "id": 1,
        "text": "1, 3"
      },
      {
        "id": 2,
        "text": "1, 2, 4"
      },
      {
        "id": 3,
        "text": "1, 2, 5"
      },
      {
        "id": 4,
        "text": "1, 2, 3, 4, 5"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Use of raloxifene is <strong>not indicated</strong> for the <strong>treatment</strong> of invasive breast cancer or risk reduction for <strong>non-invasive</strong> breast cancer</p>\n<p>Raloxifene is a <strong>selective estrogen receptor modulator </strong>(SERM).&nbsp;</p>\n<ul>\n<li>It has an antagonist action on estrogen receptors in the breast and uterine endometrial tissue. It reduces breast cancer cell growth and endometrial proliferation.</li>\n<li>It has an agonist action on estrogen receptors in bone, which causes inhibition of osteoclasts reducing the risk of osteoporosis.</li>\n</ul>\n<p>Indications for raloxifene include</p>\n<ul>\n<li>Treatment and prevention of osteoporosis in postmenopausal females.</li>\n<li>Risk reduction for invasive breast cancer especially&nbsp;in postmenopausal females with osteoporosis or&nbsp;with a high risk for invasive breast cancer&nbsp;</li>\n</ul>\n<p>Raloxifene is not indicated for the treatment of invasive breast cancer or reduction of the risk of recurrence. It is also not indicated for the reduction of the risk of noninvasive breast cancer.</p>\n<p>Side effects of raloxifene include hot flashes and increased risk of venous thromboembolism.</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "During dissection, the professor points to a structure in the popliteal fossa marked with the red arrow shown in the image below. He further mentions that damage to this structure would cause a high-stepping gait and an inability to dorsiflex the ankle. The structure marked is ______.",
    "choices": [
      {
        "id": 1,
        "text": "Common peroneal nerve"
      },
      {
        "id": 2,
        "text": "Sural nerve"
      },
      {
        "id": 3,
        "text": "Saphenous nerve"
      },
      {
        "id": 4,
        "text": "Tibial nerve"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The damaged structure is most likely a <strong>common peroneal nerve</strong>. It is also called the common fibular nerve. It descends down obliquely along the lateral side of the popliteal fossa till the fibular head. It lies medial to the biceps femoris.</p>\n<p>The common peroneal nerve is a\u00a0<strong>component </strong>of the s<strong>ciatic nerve</strong>. In the posterior thigh, it supplies the\u00a0<strong>short head </strong>of the<strong> biceps femoris</strong>. It curves around the neck of the fibula deep to the peroneus longus and divides into superficial and deep peroneal nerves.</p>\n<ul>\n<li>The\u00a0<strong>superficial peroneal</strong>\u00a0nerve innervates peroneus longus and peroneus brevis which are the\u00a0<strong>evertors</strong>\u00a0of the foot and to the skin over the dorsal area of the foot except for the first webspace and lateral side of the little toe.</li>\n<li>The\u00a0<strong>deep peroneal</strong>\u00a0nerve innervates all muscles of the\u00a0<strong>anterior compartment</strong>\u00a0which are the\u00a0<strong>dorsiflexors</strong>\u00a0of the foot, extensor digitorum brevis, first two dorsal interossei muscles, and skin between the great and second toes.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/5c219d1865a74f2ea067467ca9e31e8c.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/90d5838ef9be43c781b8e915e21c63d2x800x600.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/bae9347ff6a942b9901ae14cf2c80c40x1280x2400.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c4c4cfc2264047f497980378d25becb6x1280x2803.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a50b2a1ef4214f858982596b2a7662ddx622x600.JPEG"
    ]
  },
  {
    "text": "Which part of the spine is most commonly affected in patients with rheumatoid arthritis?",
    "choices": [
      {
        "id": 1,
        "text": "C1 - C2"
      },
      {
        "id": 2,
        "text": "C6 - C7"
      },
      {
        "id": 3,
        "text": "L4 - L5"
      },
      {
        "id": 4,
        "text": "T1 - T2"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The <strong>atlantoaxial joint</strong> (C1 &amp; C2) is the most commonly affected part of the spine in patients with <strong>rheumatoid arthritis.</strong></p>\n<p>The joints in rheumatoid arthritis are bilaterally and symmetrically involved. The commonly affected joints are:</p>\n<ul>\n<li>Metacarpophalangeal (MCP) joints</li>\n<li style=\"text-align: justify;\">Wrists</li>\n<li style=\"text-align: justify;\">Proximal interphalangeal (PIP) joints</li>\n<li style=\"text-align: justify;\">Metatarsophalangeal joints (MTP) joints</li>\n<li style=\"text-align: justify;\">Atlantoaxial joint</li>\n</ul>\n<p>There is relative <strong>sparing of </strong>the<strong> DIP joint</strong> in rheumatoid arthritis. The involvement of DIP joints should direct suspicion towards osteoarthritis<strong>.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A mother brings her 4-month-old female child to the outpatient department. She was delivered by C-section. The pregnancy was complicated by oligohydramnios and breech presentation. On examination of the child, you notice the finding shown in the image below. What is the most appropriate management for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Closed reduction only"
      },
      {
        "id": 2,
        "text": "Pavlik harness after closed reduction"
      },
      {
        "id": 3,
        "text": "Total hip replacement"
      },
      {
        "id": 4,
        "text": "Femoral osteotomy"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>A<strong>\u00a0Pavlik harness</strong> <strong>after closed reduction</strong> is the most appropriate\u00a0management for this infant, with history and examination suggestive of\u00a0<strong>developmental dysplasia of the hip</strong> (DDH). The image shows one knee (affected knee) at a lower level compared to the other, which is known as <strong>Galeazzi's sign.</strong></p>\n<p>Developmental dysplasia of the hip or congenital dysplasia of the hip is characterized by <strong>spontaneous dislocation of the hip joint before, during, or shortly after birth</strong>. Risk factors for DDH include-</p>\n<ul>\n<li>Sex of the baby - Female gender is more susceptible\u00a0</li>\n<li>Intrauterine positioning - Breech position\u00a0</li>\n<li>Oligohydramnios</li>\n<li>Genetic predisposition\u00a0</li>\n</ul>\n<p>Examination of the developmental dysplasia of the hip-</p>\n<ul>\n<li>Tests to check instability of the hip -\n<ul>\n<li><strong>Ortolani test</strong>: To perform this test, the infant is supine, with the hip and knee flexed. With the thumb placed over the medial thigh and the index finger on the greater trochanter, the hip is gently <strong>abducted</strong>. This reduces the femoral <strong>head into the acetabulum</strong> producing a palpable \"clunk\".\u00a0</li>\n<li><strong>Barlow test</strong>: This test is done within 2\u20133 days of birth. To perform this test, the infant is supine with the knees fully flexed and the hip at 90\u00b0 of flexion. Gentle <strong>adduction</strong> results in a posterior subluxation or <strong>dislocation</strong> of an easily dislocatable <strong>femoral</strong> <strong>head</strong>, producing a palpable \"clunk\"</li>\n</ul>\n</li>\n<li><strong>Galeazzi's test</strong>\u00a0is shown in the above image. It is done between 3 to 8-month aged children in\u00a0unilateral cases of developmental dysplasia of the hip\u00a0(DDH). To perform this test, the child is in the supine position with the hip and knee in flexion. The level of both the knee joints is noted with respect to a horizontal line. Normally both knees should be at the same level. In DDH, the affected knee is seen at a <strong>lower level</strong> indicating\u00a0femoral shortening. This is also known as the<strong>\u00a0Allis sign</strong>.\u00a0</li>\n<li>Marked\u00a0<strong>a</strong><strong>symmetry </strong>of the<strong>\u00a0inguinal, gluteal, thigh,\u00a0</strong>or<strong> popliteal folds</strong>.</li>\n<li>Decreased abduction on the affected side.</li>\n<li>Positive tredelenburg sign</li>\n<li>Limb-length discrepancy</li>\n</ul>\n<p>Treatment of DDH includes early closed reduction with splinting or casts. If closed reduction cannot be achieved in long-standing dislocations, an open reduction may become necessary.</p>\n<div class=\"ng-scope\">\n<div class=\"ng-scope\">\n<ul>\n<li>&lt; 6 months: Closed reduction with Pavlik harness or Von Rosen splint is done.\u00a0\u00a0</li>\n<li>6-18 months: Closed or open reduction with hip spica application is done.</li>\n<li>1.5\u00a0years- 3 years: Open reduction and pelvic or femoral osteotomies may be required</li>\n<li>3-8 years: Femoral shortening or pelvic osteotomies.</li>\n<li>&gt;8 years: Femoral and pelvic osteotomies or total hip replacement considered</li>\n</ul>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/8927263bb0a74f0e9a91d80ba6a6c1fc.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A mother with polyhydramnios delivered a baby at term gestation. She was unable to feed the baby as it choked on the milk. She also noticed the baby's abdomen appeared distended. Vesicular breath sounds in bilateral lung fields and abdominal distension were noted on examination. An attempt to pass a nasogastric tube fails. An X-ray is ordered and appears as shown. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Foreign body in the trachea"
      },
      {
        "id": 2,
        "text": "Gastric volvulus"
      },
      {
        "id": 3,
        "text": "Tracheo-esophageal fistula"
      },
      {
        "id": 4,
        "text": "Congenital diaphragmatic hernia"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given symptoms of choking and abdominal distention with a failure to pass a nasogastric tube and an X-ray showing NG tube in proximal esophagus and stomach distended with gas suggests the presence of a <strong>tracheoesophageal fistula (TEF).</strong></p>\n<p>A tracheoesophageal fistula is an abnormal fistula communication between the esophagus and trachea. Among the different types, <strong>Type C</strong> is the <strong>most common</strong> type. It consists of\u00a0<strong>proximal esophageal atresia and distal TEF.</strong>\u00a0With each breath, the air enters the distal esophagus and the stomach causing gastric distention which presents as abdominal distention.\u00a0</p>\n<p>Inability to pass a nasogastric (NG) tube is a crucial pointer in the diagnosis of esophageal atresia.\u00a0</p>\n<p>Tracheoesophageal fistula is associated with <strong>VACTERL</strong> (vertebral, anorectal, cardiac, tracheal, esophageal, renal, and limb) anomalies.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/324d5494d12f46969790126c2c4e10bb.jpg"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/95bd74f95fb84cd58124c38bb727e041x1280x1964.JPEG"
    ]
  },
  {
    "text": "A 40-year-old man comes with complaints of excessive daytime sleepiness. His wife says he snores a lot. His BMI is 32, blood pressure- 156/100 mm Hg. He scored 12 on the Epworth scale. Muller maneuver suggested airway obstruction. He was advised to lose weight and to use an APAP machine for his symptoms. This machine helps improve his condition by providing:",
    "choices": [
      {
        "id": 1,
        "text": "Continuous adjustment of positive airway pressure"
      },
      {
        "id": 2,
        "text": "Fixed negative pressure during inspiration and expiration"
      },
      {
        "id": 3,
        "text": "Higher pressure during inspiration and lower pressure during expiration"
      },
      {
        "id": 4,
        "text": "Lower pressure during inspiration and higher pressure during expiration"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The clinical scenario suggests the diagnosis of <strong>obstructive sleep apnoea</strong>. APAP machine (<strong>Autotitrating</strong>&nbsp;continuous positive airway pressure) used for this condition acts by providing continuous adjustment of the airway pressure.</p>\n<p>The symptoms of daytime somnolence, systemic hypertension, and a high BMI are indicative of <strong>obstructive sleep apnoea </strong>(OSA)<strong>.</strong>&nbsp;OSA causes hypoventilation and resulting transient hypoxia and hypercapnia. <strong>Epworth scale</strong> is used to <strong>assess daytime sleepiness</strong>. A score of more than 10 is considered excessive daytime sleepiness.&nbsp;Muller maneuver is used to assess airway obstruction using a flexible endoscope.&nbsp;</p>\n<p>OSA is managed by providing positive airway pressure to maintain the airway during sleep. The following machines can be used:</p>\n<ul>\n<li>CPAP (Continuous positive airway pressure) - It maintains the same level of air pressure during inspiration and expiration.&nbsp;</li>\n<li>BiPAP (Bilevel&nbsp;positive airway pressure) - It delivers a higher pressure during inspiration and a lower pressure during expiration.</li>\n<li>APAP (Autotitrating continuous positive airway pressure) - It continuously adjusts the airway pressure.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 45-year-old man who has come for his health checkup enquires about a swelling in his left forearm. He had noticed it by chance 3 years ago. The swelling is not painful but has slightly increased in size. On examination, a firm, round, mobile mass is detected on the flexor aspect of his left forearm. There were no associated paresthesias or neurological deficits. The skin over the swelling and in the surrounding areas appears normal. Histopathological examination revealed the mass to be a schwannoma. Which among the following is false about the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Antoni B areas are nuclear-free zones between areas of nuclear palisading"
      },
      {
        "id": 2,
        "text": "Antoni A areas are dense eosinophilic areas containing spindle cells"
      },
      {
        "id": 3,
        "text": "It involves loss of expression of the gene product Merlin"
      },
      {
        "id": 4,
        "text": "Schwannomas lacking Antoni B areas mimic sarcomas"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><span data-preserver-spaces=\"true\">The false statement is option A. Nuclear-free zones lying between the regions of nuclear palisading are known as Verocay bodies.</span></p>\n<p>Schwannomas are noninvasive, well-circumscribed, and encapsulated tumors that arise from the Schwann cells of the peripheral nerve sheaths. It occurs due to <strong>loss of expression of merlin - an NF2 gene product</strong>. Merlin normally restricts the expression of growth factor receptors like EGFR on the cell surface. In its absence, cells hyperproliferate in response to growth factors.</p>\n<p>It presents as a slow-growing, painless mass, with a predilection for flexor surfaces of the forearm and palm. They are usually solitary, but patients with NF 1 or NF2 may develop multiple schwannomas involving large peripheral nerves or bilateral acoustic schwannomas.</p>\n<p>Paraesthesias and neurological findings are usually absent, but can rarely occur if the tumor compresses the nerve or undergoes malignant change.&nbsp;</p>\n<p>Pathological Features:</p>\n<p>Gross - They appear as firm, grey masses.&nbsp;</p>\n<p>Microscopic - Schwann cells are spindle-shaped cells containing a wavy or buckled shape nucleus. Schwannomas consist of a mixture of Antoni A and Antoni B areas.&nbsp;</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Antoni A areas</strong> are <strong>dense eosinophilic areas</strong> containing spindle-shaped cells. These cells are arranged as intersecting fascicles and nuclear palisading is seen here. The <strong>nuclear-free zones</strong> between the palisading are termed as <strong>Verocay bodies</strong>.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Antoni B areas are loose hypocellular areas</strong>, where the spindle cells are spread apart by the myxoid extracellular matrix.&nbsp;</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Some large mitotically active Schwannomas lacking Antoni B areas can mimic a sarcoma.&nbsp;</li>\n</ul>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/83ad02c0b0c7410d9ce80b29828e1938x800x533.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e73d5b40f18f43e398de87e87400afeax800x593.JPEG"
    ]
  },
  {
    "text": "An elderly man presents for evaluation following an episode of syncope the same day. He reports having fatigue, chest pain, and exertional breathlessness. 2D-echo shows left ventricular hypertrophy, with an aortic valve area of 0.8 sq. cm. What will be the character of the pulse in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Pulsus alternans"
      },
      {
        "id": 2,
        "text": "Pulsus bisferiens"
      },
      {
        "id": 3,
        "text": "Pulsus paradoxus"
      },
      {
        "id": 4,
        "text": "Pulsus parvus et tardus"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>This patient's clinical scenario is suggestive of&nbsp;<strong>aortic stenosis (AS)</strong>,<strong>&nbsp;</strong>which is associated with the characteristic <strong>pulsus parvus et tardus.</strong></p>\n<p>Aortic stenosis is the <strong>narrowing of the aortic valve</strong>. It may be caused by the <strong>calcification</strong> of the normal aortic valve, calcification of the congenital bicuspid valve, and rheumatic heart disease. Narrowing of the aortic valve causes a <strong>decreased stroke volume</strong>. This results in a <strong>weak</strong>&nbsp;<strong>pulse</strong> (parvus), which <strong>rises slowly</strong> to a <strong>delayed peak</strong> (tardus), best appreciated in the carotid arteries.</p>\n<p>Three cardinal clinical features of aortic stenosis:</p>\n<ul>\n<li><strong>Exertional dyspnea:</strong>&nbsp;This occurs due to left ventricular (LV) diastolic dysfunction. Raised end-diastolic LV volume and reduced LV compliance lead to increased LV pressure, leading to elevation of pulmonary capillary wedge pressure. This causes exertional dyspnea.</li>\n<li><strong>Angina pectoris</strong>:&nbsp;It occurs due to the&nbsp;combination of the increased O<sub><span class=\"s1\">2 </span></sub>needs of hypertrophied myocardium and reduction of O<sub><span class=\"s1\">2 </span></sub>delivery&nbsp;</li>\n<li><strong>Syncope</strong>:&nbsp;It occurs due to the combination of decreased cardiac output and systemic arterial dilation which lead to a reduction of cerebral perfusion.</li>\n</ul>\n<p>As LV systole gets prolonged, the aortic component of S<sub>2</sub> may become synchronous with the pulmonary component, or there may be a <strong>paradoxical splitting of&nbsp;S<sub>2,</sub></strong> where the aortic component follows the pulmonary component.&nbsp;The murmur in aortic stenosis is typically an <strong>ejection systolic murmur</strong> best heard at the right second intercostal space and transmitted to the carotids.&nbsp;</p>\n<p><strong>Severe AS</strong> is defined as the aortic valve area <strong>&lt;1 cm<sup>2</sup></strong>. Patients even with severe AS may be asymptomatic as the left ventricle undergoes hypertrophy to increase the intraventricular pressure and maintain the stroke volume. Symptomatic AS is an indication for valve replacement.</p>\n<p>Other options:</p>\n<p>Option A: <strong>Pulsus alternans</strong> is defined as <strong>beat-to-beat variability</strong> in the amplitude of the pulse. It is seen in patients with <strong>severe LV dysfunction</strong>.</p>\n<p>Option B: <strong>Pulsus bisferiens</strong>&nbsp;also known as bifid pulse has <strong>two systolic peaks.</strong> It is seen in patients with <strong>hypertrophic obstructive cardiomyopathy</strong>. There is a rapid upstroke to the first peak (percussion wave) and a slower rise to the second peak (tidal wave). It is also rarely appreciated in patients with severe aortic regurgitation.</p>\n<p>Option C: <strong>Pulsus paradoxus</strong> is defined as a <strong>fall in systolic pressure &gt;10 mmHg</strong> with <strong>inspiration.</strong> It is seen in patients with pericardial tamponade, severe asthma, massive pulmonary embolism, and tension pneumothorax.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A researcher is studying the difference in the incidence of asthma in children who are exposed to second-hand smoke and those who are not. If he wishes to express the additional incidence of asthma in the exposed children as a percentage, which of the following should he use?",
    "choices": [
      {
        "id": 1,
        "text": "Attributable risk"
      },
      {
        "id": 2,
        "text": "Relative risk"
      },
      {
        "id": 3,
        "text": "Population attributable risk"
      },
      {
        "id": 4,
        "text": "Odds ratio"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The researcher may use<strong> attributable risk</strong> to express<strong> the increased incidence of asthma in the exposed children.</strong></p>\n<p><strong>Attributable risk</strong> (AR) is the <strong>difference in incidence</strong> rates of disease (or death) between an <strong>exposed</strong> group and the&nbsp;<strong>non-exposed group</strong>. It is often expressed as a <strong>percentage</strong>. The terms \"risk difference\" or <strong>\"cumulative incidence difference\"</strong> refers to attributable risk.</p>\n<p><img src=\"https://dhmbxeygs57ff.cloudfront.net/uploads/f0f5c1d8244d48fc850f4dea8885418dx902x260.JPEG\" width=\"458\" height=\"132\" /></p>\n<p>Other Options:</p>\n<p>Option B: <strong>Relative risk</strong> (RR) is the <strong>ratio</strong> of the <strong>incidence</strong> of the disease (or death) among <strong>exposed</strong> and the incidence among <strong>non-exposed</strong>.</p>\n<p>Option C: <strong>Population-attributable risk</strong> is the<strong> incidence</strong> of the disease (or death) in the <strong>total population</strong> <strong>minus</strong> the incidence of disease (or death) among those who were <strong>not exposed</strong> to the suspected causal factor. Population attributable risk is measured by multiplying attributable risk with the population prevalence of exposure.</p>\n<p>Option D: <strong>Odds ratio</strong> is a measure of the <strong>strength of association </strong>between a risk factor and outcome in <strong>case-control </strong>studies.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 30-year-old patient with burns was brought to the casualty department. As shown in the image below, there was sparing of the front and back of the chest and face. Painful erythema was present on both palms.  Also, there was uniform involvement of both lower limbs circumferentially, genitalia, and the front and back of the abdomen. Lesions were painful and showed blanching on pressure. What fluid resuscitation plan would you choose as per the 2018 ATLS guidelines, if the patient weighed 50 kg?",
    "choices": [
      {
        "id": 1,
        "text": "2.75 L over 8 hours, followed by 2.75 L over 16 hours"
      },
      {
        "id": 2,
        "text": "4.5 L over 8 hours, followed by 4.5 L over 16 hours"
      },
      {
        "id": 3,
        "text": "6 L over 8 hours, followed by 6 L over 16 hours"
      },
      {
        "id": 4,
        "text": "9 L over 8 hours, followed by 9 L over 16 hours"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given image shows second-degree burns, as evident from the moist appearance of the skin, associated with pain and blanching on pressure. The total volume of fluid needed <strong>is 5.5 L</strong>, of which <strong>2.75 L is given in the first 8 hours</strong> and<strong> 2.75L is given in the next 16 hours</strong> as indicated by&nbsp;</p>\n<p>Step 1<strong>: </strong>Calculating the percentage of burns using the Wallace rule of nines:</p>\n<ul>\n<li><strong>This includes only second-&nbsp;and third-degree&nbsp;burns.</strong></li>\n<li>Right lower limb + left lower limb and anterior-posterior lower torso + genitalia = 18 + 18 + 18 + 1 = 55%</li>\n</ul>\n<p>STEP 2: Calculating fluid using the resuscitation formula for thermal burns:</p>\n<p>According to <strong>ATLS 10th edition 2018 guidelines, </strong>the fluid resuscitation formula for thermal burns is<strong> 2 mL/kg/TBSA% </strong>given<strong> IV.</strong></p>\n<p>Fluid requirement = 2 mL x body weight x TBSA</p>\n<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = 2 mL x 50 kg x 55%</p>\n<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = 5.5 L</p>\n<p><strong>One-half</strong> of the calculated fluid need is given in the <strong>first 8 hours</strong>, and the <strong>remaining half</strong> is given over the subsequent <strong>16 hours</strong>.</p>\n<p>The rate of infusion for IV resuscitation fluid should be as constant as possible; sharp decreases in infusion rates can lead to vascular collapse and an increase in edema.</p>\n<p>Superficial (epidermal) burns&nbsp;are excluded from this calculation.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/aca02f28b34648b59eb12e3d85df1677.jpg"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3723b1975d9c4b34a6dc6e97c4592182x398x319.PNG"
    ]
  },
  {
    "text": "A 28-year-old recently married woman was brought dead to the casualty with severe third-degree burns. An autopsy was conducted and chemical analysis revealed traces of kerosene on her clothes. An interrogation revealed there were frequent quarrels at home as her husband and his family constantly berated her for not bringing in money from her parents. Which of the following sections covers the punishment for this incident?",
    "choices": [
      {
        "id": 1,
        "text": "304A"
      },
      {
        "id": 2,
        "text": "304B"
      },
      {
        "id": 3,
        "text": "376B"
      },
      {
        "id": 4,
        "text": "376AB"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>This incident can be considered as <strong>dowry death</strong>\u00a0which\u00a0is defined under section <strong>304B IPC</strong>.</p>\n<p>When there is the death of a woman <strong>within 7 years of her marriage</strong> and she was subjected to cruelty or harassment by her husband or his family in demand of dowry, the husband/family member shall be deemed to have caused her death.\u00a0The punishment for such cases is imprisonment for<strong>\u00a0</strong>a<strong> minimum of 7 years,</strong> but may be extended to life imprisonment.</p>\n<p>Option A: Section <strong>304A IPC: </strong>Causing death by negligence (up to 2 yrs of imprisonment or fine or both).</p>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The variation in the secretion of a hormone throughout the day is given in the graph below. Which of the following stimulates its secretion?",
    "choices": [
      {
        "id": 1,
        "text": "Glucose"
      },
      {
        "id": 2,
        "text": "IGF-1"
      },
      {
        "id": 3,
        "text": "Glucagon"
      },
      {
        "id": 4,
        "text": "Cortisol"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The image depicts the variations in secretion of <strong>growth hormone</strong> throughout the day. Among the following&nbsp;<strong>glucagon</strong>&nbsp;stimulates its secretion.</p>\n<p>Identifying growth hormone in a graph</p>\n<ul>\n<li>Growth hormone is found at relatively <strong>low levels during the day</strong> <strong>unless</strong> specific <strong>triggers such as strenuous exercise are present</strong>.</li>\n<li><strong>During sleep, </strong>on the other hand<strong>, large pulsatile bursts of growth hormone</strong> secretion occur.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/6784a4bc2b634c28bf755985de673b1b.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 45-year-old diabetic patient presented with asymmetric pupils. On examination the degree of asymmetry was more in dim light. It was also associated with ptosis in the eye with the smaller pupil. Which of the following drugs can be used for the confirmation of diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Phenylephrine drops"
      },
      {
        "id": 2,
        "text": "Apraclonidine drops"
      },
      {
        "id": 3,
        "text": "Hydroxyamphetamine drops"
      },
      {
        "id": 4,
        "text": "Pilocarpine drops"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The clinical scenario of <strong>ptosis and anisocoria</strong> (asymmetric pupils) that is more <strong>apparent in dim light</strong> is suggestive of <strong>Horner\u2019s syndrome</strong>. <strong>Apraclonidine drops</strong> can be used for the confirmation of Horner\u2019s syndrome.</p>\n<p>Horner syndrome, also called oculosympathetic paresis, is characterized by</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Ptosis</strong> - usually due to weakness of Muller\u2019s muscle</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Miosis</strong> - due to unopposed action of sphincter pupillae leading to anisocoria</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Anhydrosis</strong> - reduced ipsilateral sweating</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Heterochromia</strong>\u00a0<strong>iridis</strong>- seen in congenital and long-standing disease. The affected eye is lighter in color.\u00a0</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Anisocoria that is accentuated in dim light</li>\n</ul>\n<p>It can be produced by a lesion anywhere along the <strong>sympathetic pathway</strong> that supplies the head, eye, and neck.</p>\n<p>Tests for confirmation of Horner's syndrome -</p>\n<ul>\n<li><strong>Apraclonidine drops - </strong>The results are\u00a0\n<ul>\n<li><strong>Horner pupil dilates</strong> - due to upregulation of\u00a0\u03b1<sub>1</sub> receptors in the dilator pupillae.\u00a0</li>\n<li>Normal pupil does not dilate</li>\n</ul>\n</li>\n<li><strong>Cocaine drops</strong>\u00a0\n<ul>\n<li><strong>Horner pupil does not dilate</strong></li>\n<li>Normal pupil dilates</li>\n<li>This is because cocaine blocks the re-uptake of noradrenaline at the postganglionic nerve endings. This causes dilatation in a normal pupil. In Horner's syndrome, noradrenaline is not secreted. Therefore, the administration of cocaine has no effect.</li>\n</ul>\n</li>\n</ul>\n<p>Tests for localization of the lesion -</p>\n<ul>\n<li><strong>Phenylephrine</strong> or <strong>adrenaline</strong>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"3\"><strong>Postganglionic</strong> <strong>lesion</strong> - Horner pupil will <strong>dilate</strong></li>\n<li style=\"font-weight: 400;\" aria-level=\"3\">Preganglionic and central lesions - pupil will not dilate</li>\n<li style=\"font-weight: 400;\" aria-level=\"3\">Normal pupil will not dilate</li>\n</ul>\n</li>\n<li><strong>Hydroxyamphetamine</strong>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"3\"><strong>Preganglionic lesion</strong> - pupil will <strong>dilate</strong></li>\n<li style=\"font-weight: 400;\" aria-level=\"3\">Postganglionic lesion - pupil will not dilate</li>\n<li style=\"font-weight: 400;\" aria-level=\"3\">Normal pupil will dilate</li>\n</ul>\n</li>\n</ul>\n<p>Other options</p>\n<p>Option D - Pilocarpine is used in the differential diagnosis of fixed dilated pupils. Mydriasis due to neurologic origin (3rd nerve palsy) responds readily to 1% pilocarpine, whereas there will be no response if the dilation is due to anticholinergic causes.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 6-month-old is brought by his parents with a history of decreased weight gain. On examination, you find that the baby has hepatosplenomegaly, muscle weakness and atrophy, hypotonia, and decreased deep tendon reflexes. Blood tests reveal normal glucose levels. Biopsy of the liver reveals initial stages of cirrhosis due to the accumulation of abnormal glycogen with few branch points, whose structure resembles amylopectin. The clinical and laboratory results are indicative of which glycogen storage disease?",
    "choices": [
      {
        "id": 1,
        "text": "Von Gierke disease"
      },
      {
        "id": 2,
        "text": "Andersen disease"
      },
      {
        "id": 3,
        "text": "McArdle disease"
      },
      {
        "id": 4,
        "text": "Tarui disease"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The clinical and laboratory features indicate <strong>Andersen's disease</strong> in the baby. Inability to gain weight, hepatosplenomegaly, muscle weakness, and accumulation of abnormal glycogen resembling amylopectin point towards the diagnosis.</p>\n<p><strong>Andersen's disease</strong> is type IV glycogen storage disease. It is transmitted in an <strong>autosomal recessive</strong> pattern and occurs due to a deficiency of&nbsp;<strong>glycogen branching enzyme </strong>because of pathologic variants in the GBE1 gene. This leads to accumulation of of an abnormal structure of glycogen known as <strong>polyglucosan</strong>.&nbsp; It is characterized by</p>\n<ul>\n<li>Growth delay</li>\n<li>Hepatomegaly due to the accumulation of polysaccharides with few branch points</li>\n<li>Myopathy</li>\n<li>There might be fasting intolerance and ketosis in the initial stages. Hypoglycemia usually appears late in the disease when it is associated with cirrhosis, esophageal varices, and ascites.<span class=\"Apple-converted-space\">&nbsp;</span></li>\n<li><strong>Biopsy of the liver</strong> will show the presence of abnormal glycogen which resembles <strong>amylopectin</strong>. Amylopectin is found in plants and has very few branches. Since there is a defect in the branching of the glycogen, the abnormal glycogen appears like amylopectin.</li>\n</ul>\n<p class=\"p2\">The diagnosis is confirmed by absent branching enzyme activity in skin fibroblasts, muscle, or liver and analysis of the DNA mutation.</p>\n<p>Other options</p>\n<p>Option A- <strong>Von Gierke's disease</strong> has features of <strong>lactic acidosis</strong>, hypoglycemia, hyperuricemia, impaired growth, and bone thinning. It occurs due to a defect in the <strong>glucose 6-phosphatase.</strong></p>\n<p>Option C-&nbsp;<strong>McArdle disease</strong> usually manifests as&nbsp;exercise intolerance, <strong>muscle cramping with exercise</strong>. It is usually a benign chronic condition. It occurs due to a defect in the <strong>muscle glycogen phosphorylase</strong>.</p>\n<p>Option D- <strong>Tarui disease</strong> also presents similar to the McArdle disease. Patients may have developmental delay, and hemolytic anemia in addition to exercise-induced muscle cramps.&nbsp;It occurs due to a defect in the <strong>muscle phosphofructokinase</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 28-year-old male patient attends your clinic for health check-up. He says that he does not have any friends and does not like to go out often. He lives by himself. Throughout the examination, he does not make eye-contact. He seems quiet for the most part and answers your questions with a single word or phrase. What is the most likely diagnosis in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Paranoid personality disorder"
      },
      {
        "id": 2,
        "text": "Avoidant personality disorder"
      },
      {
        "id": 3,
        "text": "Schizotypal personality disorder"
      },
      {
        "id": 4,
        "text": "Schizoid personality disorder"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>This clinical vignette is strongly suggestive of <strong>schizoid personality disorder</strong>.</p>\n<p>It is a <strong>cluster A</strong> personality disorder that includes-</p>\n<ul>\n<li>Paranoid personality disorder</li>\n<li>Schizoid personality disorder</li>\n<li>Schizotypal personality disorder.</li>\n</ul>\n<p><strong>Schizoid personality disorder</strong> is characterized by a tendency for social withdrawal, isolation, and introversion. They tend to live alone and take up jobs that require minimal interpersonal interaction. They are emotionally detached, aloof, and have a flattened affect. They avoid eye contact and conversations and when questioned, are likely to give short direct responses. They do not desire relationships or sexual intimacy and tend not to have partners or friends. However, they have a good attachment with animals. They also tend to have solitary hobbies and interests.&nbsp;</p>\n<p>Other options-</p>\n<p>Option A-<strong> Paranoid personality disorder</strong> is characterized by pervasive suspiciousness and mistrust in all interpersonal relationships. They are excessively fearful about perceived threats and deceit. They tend to be extremely jealous and hostile, argumentative, and defensive. A commonly seen defense mechanism is projection.&nbsp;</p>\n<p>Option B- <strong>Avoidant personality disorder</strong> is characterized by isolation but a strong wish to participate in activities and relationships. This is absent in those with schizoid personality disor&shy;der where people do not desire social interaction and relationships.&nbsp;</p>\n<p>Option C- <strong>Schizotypal personality disorder</strong> is characterized by odd perceptions, thinking, and behavior. They tend to have magical thinking, bizarre fantasies, and preoccupations, such as excessive superstition, and beliefs that they have superpowers, etc. They have peculiar speech and an eccentric appearance. They can be differentiated from schizophrenia by the lack of psychotic features.&nbsp;</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 50-year-old man with a history of hypertension and prior MI was found to have raised total cholesterol and LDL and was started on simvastatin. Which would be the best time for him to take this drug so as to have an optimum effect on his LDL levels?",
    "choices": [
      {
        "id": 1,
        "text": "Evening"
      },
      {
        "id": 2,
        "text": "Early morning"
      },
      {
        "id": 3,
        "text": "Pre lunch"
      },
      {
        "id": 4,
        "text": "It is equally effective irrespective of the time of administration"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Simvastatin</strong> demonstrates a <strong>significant\u00a0LDL-C (</strong>low-density lipoprotein cholesterol)<strong>\u00a0reduction</strong> when <strong>administered in the evening</strong>, compared with morning administration.</p>\n<p>For statins with <strong>shorter half-lives</strong> like lovastatin 2 hours, simvastatin &lt; 5 hours, and fluvastatin &lt; 3 hours, the FDA has recommended an <strong>evening administration</strong>, while <strong>daytime administration</strong> is recommended <strong>for statins with longer half-lives</strong> like rosuvastatin 19 hours, and pravastatin 22 hours.</p>\n<p><strong>Atorvastatin</strong> has active <strong>metabolites with half-lives ranging from 20 to 30 hours</strong>, which may contribute to the fact that it can be <strong>taken at any time</strong>, and demonstrates the same LDL-C <strong>reduction\u00a0regardless of the time of day of drug administration.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient presented to a primary care physician with complaints of depression. She takes a monoamine oxidase (MAO) inhibitor. The physician added another anti-depressant following which she developed restlessness, fever, extreme agitation with hyperreflexia, and autonomic instability. Which of the following drugs is most likely to be added?",
    "choices": [
      {
        "id": 1,
        "text": "Fluoxetine"
      },
      {
        "id": 2,
        "text": "Imipramine"
      },
      {
        "id": 3,
        "text": "Mirtazapine"
      },
      {
        "id": 4,
        "text": "Trazadone"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>In the given clinical scenario, the patient who is on a <strong>Monoamine Oxidase (MAO)</strong> develops diarrhea, restlessness, fever, extreme agitation with hyperreflexia, and autonomic instability which is suggestive of <strong>serotonin syndrome</strong>. The newly added drug must have been a selective serotonin reuptake inhibitor <strong>(SSRI)</strong>. Among the given options, <strong>fluoxetine</strong> is an SSRI.</p>\n<p>When an <strong>SSRI</strong> is administered along <strong>with</strong> an <strong>MAO-I, tramadol,</strong> and <strong>pethidine,</strong> plasma levels of <strong>serotonin</strong> are <strong>raised</strong> resulting in <strong>serotonin syndrome. Clinical features</strong> of serotonin syndrome include diarrhea, <span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"><strong>agitation, restlessness,</strong> rigidity, <strong>hyperthermia,</strong> hyperreflexia, <strong>autonomic instability,</strong>&nbsp;twitchings followed by convulsions, </span><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">delirium, coma, status epilepticus, cardio&shy; vascular collapse, and death.</span></p>\n<p>Treatment involves <strong>removing the offending agent and supportive care</strong>.&nbsp;</p>\n<p>Other options:</p>\n<p>Option B: <strong>Imipramine</strong> is a <strong>tricyclic antidepressant</strong>. Common side effects include anticholinergic symptoms, sedation, weight gain, and cardiac arrhythmias. TCAs given with <strong>MAO inhibitors</strong>&nbsp;can result in <strong>hypertensive crisis</strong> with excitement and hallucinations.</p>\n<p>Option C: <strong>Mirtazapine </strong>acts by enhancing noradrenaline and 5-HT release.&nbsp;It helps patients with insomnia. Common side effects include increased appetite and <strong>weight gain.&nbsp;</strong>It doesn't cause sexual dysfunction.</p>\n<p>Option D: <strong>Trazadone</strong> is also an <strong>atypical antidepressant</strong>. Common side effects include <strong>postural hypotension </strong>and <strong>priapism.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = 'Neet 2021 Mini Test 6  (20 Questions)';
        const quizFilename = 'neet-2021-mini-test-6-20-questions-9eedf1cd.html';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2020-21"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>