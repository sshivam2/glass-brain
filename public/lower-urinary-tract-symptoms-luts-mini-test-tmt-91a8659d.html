<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lower Urinary Tract Symptoms (Luts) Mini Test - -Tmt - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2024-25
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A patient presents with complaints of severe left loin pain and burning micturition. His erect abdominal X-ray is shown below. What is the best management for his condition?",
    "choices": [
      {
        "id": 1,
        "text": "Extracorporeal shockwave lithotripsy"
      },
      {
        "id": 2,
        "text": "Percutaneous nephrolithotomy"
      },
      {
        "id": 3,
        "text": "Percutaneous nephrostomy"
      },
      {
        "id": 4,
        "text": "Ureteroscopic removal"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given abdominal X-ray shows <strong>left staghorn renal calculi. </strong>The best treatment option for staghorn renal calculi is <strong>percutaneous nephrolithotomy (PCNL).</strong></p>\n<p><strong>Staghorn calculi </strong>is also known as <strong>triple phosphate stone. </strong>It occupies the renal pelvis and calyces.</p>\n<p><strong>PCNL:</strong><strong>&nbsp;</strong>Endoscopic instruments are passed into the kidney by percutaneous technique and stones are fragmented and removed. It is mainly used in treating large stones and stones in the proximal ureter.</p>\n<p>Indications of PCNL:</p>\n<ul>\n<li>Obstructions caused by anatomical abnormalities like pulviureteric junction obstruction, calyceal diverticula or ureteric obstruction</li>\n<li><strong>Staghorn calculi</strong></li>\n<li>Stones <strong>&gt;2.5 cm</strong> in size</li>\n<li>Stone composition - <strong>struvite</strong>, <strong>calcium oxalate monohydrate</strong> and <strong>cystine</strong> stones</li>\n<li><strong>Multiple stones</strong></li>\n<li><strong>Obese patients</strong> in whom <strong>ESWL</strong> is <strong>contraindicated </strong></li>\n<li>Stones not responding for ESWL</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/52f36ee2fba3409a89d2808d4a3a7294.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ec2aa35ede5b4582ba611a596f1bfeedx1280x1688.JPEG"
    ]
  },
  {
    "text": "An 8-year-old girl presented with fever, increased urinary frequency, and dysuria. The physician suspects a urinary tract infection. What is the most likely etiology?",
    "choices": [
      {
        "id": 1,
        "text": "Escherichia coli"
      },
      {
        "id": 2,
        "text": "Proteus mirabilis"
      },
      {
        "id": 3,
        "text": "Pseudomonas aeruginosa"
      },
      {
        "id": 4,
        "text": "Staphylococcus saprophyticus"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong><em>Escherichia coli</em> (<em>E. coli</em>)</strong> is the <strong>most common</strong> <strong>cause</strong> of <strong>urinary tract infection</strong> (UTI) at <strong>any age</strong>. It accounts for about 90% of the cases in young women who present for the first time.</p>\n<p>The symptoms and signs may include:</p>\n<ul>\n<li>Fever</li>\n<li>Urinary frequency</li>\n<li>Dysuria</li>\n<li>Pyuria</li>\n<li>Hematuria</li>\n<li>Flank pain in upper UTI</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 24-year-old patient presents with a history of urinary frequency, nocturia, and excessive thirst. Her laboratory evaluation results are given below. Brain MRI shows the absence of a bright spot in the pituitary. Her past medical history includes an episode of meningitis. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Nephrogenic diabetes insipidus"
      },
      {
        "id": 2,
        "text": "Primary polydipsia"
      },
      {
        "id": 3,
        "text": "Central diabetes insipidus"
      },
      {
        "id": 4,
        "text": "Syndrome of inappropriate ADH secretion"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><span data-preserver-spaces=\"true\">The clinical scenario and the lab results indicating&nbsp;</span><strong><span data-preserver-spaces=\"true\">increased urine output</span></strong><span data-preserver-spaces=\"true\">&nbsp;with&nbsp;</span><strong><span data-preserver-spaces=\"true\">low urine osmolarity</span></strong> and <strong><span data-preserver-spaces=\"true\">decreased ADH levels&nbsp;</span></strong><span data-preserver-spaces=\"true\">suggest the diagnosis of&nbsp;</span><strong><span data-preserver-spaces=\"true\">central diabetes insipidus</span></strong><span data-preserver-spaces=\"true\">.&nbsp;</span></p>\n<p><span data-preserver-spaces=\"true\">Diabetes insipidus can be of two types -&nbsp;</span><strong><span data-preserver-spaces=\"true\">central&nbsp;</span></strong><span data-preserver-spaces=\"true\">or&nbsp;</span><strong><span data-preserver-spaces=\"true\">peripheral&nbsp;</span></strong><span data-preserver-spaces=\"true\">(nephrogenic). Central DI occurs due to&nbsp;</span><strong><span data-preserver-spaces=\"true\">deficiency of ADH</span></strong><span data-preserver-spaces=\"true\">.&nbsp;</span></p>\n<p><span data-preserver-spaces=\"true\">Central diabetes insipidus (DI) is a disorder of the&nbsp;</span><strong><span data-preserver-spaces=\"true\">posterior pituitary</span></strong><span data-preserver-spaces=\"true\">. It is characterized by&nbsp;</span><strong><span data-preserver-spaces=\"true\">decreased ADH</span></strong><span data-preserver-spaces=\"true\">&nbsp;leading to large volumes of&nbsp;</span><strong><span data-preserver-spaces=\"true\">urine production</span></strong><span data-preserver-spaces=\"true\">. Patients present with&nbsp;</span><strong><span data-preserver-spaces=\"true\">excessive thirst, nocturia</span></strong><span data-preserver-spaces=\"true\">, and&nbsp;</span><strong><span data-preserver-spaces=\"true\">urinary frequency.</span></strong><span data-preserver-spaces=\"true\">&nbsp;The&nbsp;</span><strong><span data-preserver-spaces=\"true\">urine</span></strong><span data-preserver-spaces=\"true\">&nbsp;is&nbsp;</span><strong><span data-preserver-spaces=\"true\">dilute&nbsp;</span></strong><span data-preserver-spaces=\"true\">with an osmolarity of &lt; 300 mOsm/L. The 24-hour urine volume is &gt;40 ml/kg and the basal plasma ADH is &lt;1 pg/ml.</span></p>\n<p><span data-preserver-spaces=\"true\">Central DI occurs due to damage to the&nbsp;</span><strong><span data-preserver-spaces=\"true\">neurohypophysis</span></strong><span data-preserver-spaces=\"true\">&nbsp;in the posterior pituitary. It can be congenital or acquired. In this patient, meningitis has led to the development of DI.&nbsp;</span></p>\n<p><span data-preserver-spaces=\"true\">Central DI can be treated with&nbsp;</span><strong><span data-preserver-spaces=\"true\">desmopressin</span></strong><span data-preserver-spaces=\"true\">, an ADH analogue. Nephrogenic DI requires treatment with a thiazide diuretic, amiloride, low sodium diet, and indomethacin.&nbsp;</span></p>\n<p><span data-preserver-spaces=\"true\">In nephrogenic DI, ADH levels may be&nbsp;</span><strong><span data-preserver-spaces=\"true\">normal</span></strong><span data-preserver-spaces=\"true\">&nbsp;or&nbsp;</span><strong><span data-preserver-spaces=\"true\">increased</span></strong><span data-preserver-spaces=\"true\">&nbsp;because the kidney has become resistant to its effects. The two can be differentiated by the&nbsp;</span><strong><span data-preserver-spaces=\"true\">water deprivation test</span></strong><span data-preserver-spaces=\"true\">. (Option A)</span></p>\n<p><span data-preserver-spaces=\"true\">Option B -&nbsp;</span><strong><span data-preserver-spaces=\"true\">Primary polydipsia</span></strong><span data-preserver-spaces=\"true\">&nbsp;would have a&nbsp;</span><strong><span data-preserver-spaces=\"true\">bright spot</span></strong><span data-preserver-spaces=\"true\">&nbsp;on the brain MRI. Primary polydipsia presents with an&nbsp;</span><strong><span data-preserver-spaces=\"true\">excessive thirst</span></strong><span data-preserver-spaces=\"true\">&nbsp;that reduces the serum osmolarity. There is a compensatory increase in free water excretion that offsets the increased intake to maintain a normal serum sodium level.&nbsp;</span></p>\n<p><span data-preserver-spaces=\"true\">Option D -&nbsp;</span><strong><span data-preserver-spaces=\"true\">Syndrome of inappropriate ADH secretion&nbsp;</span></strong><span data-preserver-spaces=\"true\">would have increased ADH secretion, concentrated urine, and hyponatremia.&nbsp;</span></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An elderly woman presented with a mass per vaginum and incontinence. She complains that she has to push the mass inwards to be able to urinate normally. What is the type of incontinence seen here?",
    "choices": [
      {
        "id": 1,
        "text": "Urge incontinence"
      },
      {
        "id": 2,
        "text": "Stress incontinence"
      },
      {
        "id": 3,
        "text": "Overflow incontinence"
      },
      {
        "id": 4,
        "text": "Neurogenic bladder"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given case scenario is suggestive of a <strong>cystocele</strong> in a case of <strong>genital prolapse</strong>. <strong>Stress incontinence</strong> is seen in these cases.</p>\n<p>In stress incontinence,&nbsp;involuntary leakage of urine occurs when there is increased intraabdominal pressure, such as during<strong>&nbsp;</strong>laughing, sneezing, or coughing. There is no normal urge to pass urine.</p>\n<p>Option A:&nbsp;<strong>Urge incontinence</strong> is the <strong>involuntary voiding</strong> of urine when there is an <strong>imminent</strong> <strong>urge</strong> to urinate.</p>\n<p>Option C:&nbsp;<strong>Overflow incontinence</strong> is an old term that refers to the inability to empty the bladder, with involuntary, continuous <strong>urinary dribbling</strong>. Currently, it refers to another presentation of urge incontinence.&nbsp;</p>\n<p>Option D: <strong>Neurogenic bladder</strong> occurs due to <strong>defects</strong> anywhere in the pathway of the <strong>micturition reflex</strong>, e.g., spinal cord trauma, diabetes etc. It presents with with urgency or urge incontinence.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A type 2 diabetic patient who was recently started on treatment complains of frequent urination, fever, and burning micturition. Which of the following drugs is most likely responsible for these symptoms?",
    "choices": [
      {
        "id": 1,
        "text": "Dapagliflozin"
      },
      {
        "id": 2,
        "text": "Metformin"
      },
      {
        "id": 3,
        "text": "Glipizide"
      },
      {
        "id": 4,
        "text": "Exenatide"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>This clinical scenario is suggestive of a urinary tract infection (<strong>UTI</strong>). This adverse effect occurs as a result of&nbsp;<strong>dapagliflozin&nbsp;</strong>use.</p>\n<p>The group of sodium-glucose co-transporter-2 or <strong>SGLT-2&nbsp;inhibitors&nbsp;</strong>includes drugs like dapagliflozin and canagliflozin. These drugs&nbsp;prevent glucose reabsorption in the renal tubules and cause loss of sodium and glucose.&nbsp;</p>\n<ul>\n<li>UTI - due to <strong>glucosuria</strong></li>\n<li>Dehydration<strong>&nbsp;-&nbsp;</strong>due to <strong>natriuresis</strong> and volume loss</li>\n<li><strong>Euglycemic diabetic ketoacidosis</strong> - low blood glucose levels due to glucosuria can reduce insulin release</li>\n</ul>\n<p>SGLT-2 inhibitors must be temporarily discontinued for 3-4 days before any scheduled surgery to avoid potential risk for diabetic ketoacidosis.</p>\n<table style=\"width: 482px;\">\n<tbody>\n<tr>\n<td style=\"width: 49px; text-align: center;\" colspan=\"3\"><strong>Management of diabetes mellitus</strong></td>\n</tr>\n<tr>\n<td style=\"width: 49px;\"><strong>Intervention</strong></td>\n<td style=\"width: 319.25px;\"><strong>Advantages</strong></td>\n<td style=\"width: 306.75px;\"><strong>Disadvantages</strong></td>\n</tr>\n<tr>\n<td style=\"width: 49px;\">Lifestyle changes</td>\n<td style=\"width: 319.25px;\">Reduced complications and mortality</td>\n<td style=\"width: 306.75px;\">Insufficient for most patients within 1st year</td>\n</tr>\n<tr>\n<td style=\"width: 49px;\">Metformin</td>\n<td style=\"width: 319.25px;\">Weight neutral</td>\n<td style=\"width: 306.75px;\">\n<p>GI side effects</p>\n<p>Contraindicated when GFR &lt; 45 ml/min</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 49px;\">Insulin</td>\n<td style=\"width: 319.25px;\">\n<p>Rapidly effective</p>\n<p>Lowers HbA1c more than other drugs (by 1.5-3%)</p>\n</td>\n<td style=\"width: 306.75px;\">\n<p>Weight gain</p>\n<p>Hypoglycemia</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 49px;\">GLP-1 agonists</td>\n<td style=\"width: 319.25px;\">\n<p>Weight loss</p>\n<p>Reduces cardiovascular complications</p>\n</td>\n<td style=\"width: 306.75px;\">GI side effects</td>\n</tr>\n<tr>\n<td style=\"width: 49px;\">Pramlintide</td>\n<td style=\"width: 319.25px;\">\n<p>Weight loss</p>\n<p>Lowers postprandial glucose</p>\n</td>\n<td style=\"width: 306.75px;\">\n<p>GI side effects</p>\n<p>Hypoglycemia when used with insulin</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 49px;\">Sulfonylureas</td>\n<td style=\"width: 319.25px;\">Rapidly effective</td>\n<td style=\"width: 306.75px;\">\n<p>Weight gain</p>\n<p>Hypoglycemia</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 49px;\">Thiazolidinediones</td>\n<td style=\"width: 319.25px;\">Lowers insulin requirements</td>\n<td style=\"width: 306.75px;\">\n<p>Weight gain, edema,&nbsp;CHF, fractures</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 49px;\">Meglitinides</td>\n<td style=\"width: 319.25px;\">Rapidly effective</td>\n<td style=\"width: 306.75px;\">\n<p>Weight gain</p>\n<p>Hypoglycemia</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 49px;\">SGLT-2 inhibitors</td>\n<td style=\"width: 319.25px;\">\n<p>Weight loss</p>\n<p>Better cardiovascular and renal outcomes</p>\n</td>\n<td style=\"width: 306.75px;\">\n<p>UTI, vulval candidiasis</p>\n<p>Dehydration</p>\n<p>Euglycemic DKA</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 49px;\">DPP-4 inhibitors</td>\n<td style=\"width: 319.25px;\">Weight neutral</td>\n<td style=\"width: 306.75px;\">Angioedema, urticaria</td>\n</tr>\n<tr>\n<td style=\"width: 49px;\">Alpha-glucosidase inhibitors</td>\n<td style=\"width: 319.25px;\">Weight neutral</td>\n<td style=\"width: 306.75px;\">\n<p>GI flatulence</p>\n<p>Rise in LFT</p>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 28-year-old woman came to the hospital with complaints of severe burning micturition and fever. On urine microscopy, there were plenty of pus cells. Urine for culture and drug sensitivity was sent.  Which of the following drugs is a urinary anesthetic which can be prescribed in this patient to relieve her severe burning pain during micturition?",
    "choices": [
      {
        "id": 1,
        "text": "Methenamine"
      },
      {
        "id": 2,
        "text": "Nitrofurantoin"
      },
      {
        "id": 3,
        "text": "Phenazopyridine"
      },
      {
        "id": 4,
        "text": "Phenacetin"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In this case, multiple pus cell in urine is indicative of urinary tract infection.&nbsp;Phenazopyridine can be prescribed in this patient&nbsp;to relieve her severe burning pain during micturition.</p>\n<p><strong>Phenazopyridine</strong> is a <strong>urinary anesthetic</strong>. It is used as a local anesthetic in urinary tract disorders to<strong> relieve the pain</strong> of lower urinary-tract irritation, as in <strong>cystitis, urethritis or prostatitis</strong>.&nbsp;It does not have any antibacterial action and affords symptomatic relief of burning sensation, dysuria and urgency due to cystitis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An elderly man complains of difficulty in urination, urinary frequency, and urgency for the past month that has progressively worsened. Per rectal examination reveals an enlarged prostate that is non-tender, firm, and smooth. The rectal mucosa is movable over the surface of the swelling. Serum PSA levels are within normal limits. Which of the following zones of the prostate is likely to be involved in this pathology?",
    "choices": [
      {
        "id": 1,
        "text": "A"
      },
      {
        "id": 2,
        "text": "B"
      },
      {
        "id": 3,
        "text": "C"
      },
      {
        "id": 4,
        "text": "D"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The clinical scenario is highly suggestive of<strong> benign prostatic hyperplasia.</strong> The <strong>transitional zone&nbsp;</strong>of the prostate marked as <strong>'C'</strong> is commonly involved in this pathology.</p>\n<p>The prostate has three distinct zones as follows:</p>\n<table style=\"height: 285px;\" width=\"338\">\n<tbody>\n<tr>\n<td style=\"width: 105px;\"><strong>ZONE</strong></td>\n<td style=\"width: 105px;\"><strong>STRUCTURES ENCLOSED</strong></td>\n<td style=\"width: 106px;\"><strong>CLINICAL SIGNIFICANCE</strong></td>\n</tr>\n<tr>\n<td style=\"width: 105px;\">Transitional zone</td>\n<td style=\"width: 105px;\">Urethra&nbsp;</td>\n<td style=\"width: 106px;\">The common site for BPH (<strong>benign prostatic hyperplasia</strong>)</td>\n</tr>\n<tr>\n<td style=\"width: 105px;\">Central zone</td>\n<td style=\"width: 105px;\">Ejaculatory ducts</td>\n<td style=\"width: 106px;\">Rarely diseased</td>\n</tr>\n<tr>\n<td style=\"width: 105px;\">Peripheral zone</td>\n<td style=\"width: 105px;\">\n<p>Central transitional zone</p>\n<p>Pre-prostatic urethra</p>\n</td>\n<td style=\"width: 106px;\">The common site for prostatic carcinoma</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/eddcf94a981c4639b4de4d1ac2ba2a7a.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9e529e52849648aeac470929f60fdfdax1280x2560.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/67be3e8ed6d54d7a848f0bbf386c5032x399x378.JPEG"
    ]
  },
  {
    "text": "A 25-year-old male complained of burning micturition, multiple joints pains, and red eyes. Reiter's syndrome is suspected. Which of the following cutaneous feature is likely to be associated?",
    "choices": [
      {
        "id": 1,
        "text": "Dermatitis herpetiformis"
      },
      {
        "id": 2,
        "text": "Keratoderma blennorrhagica"
      },
      {
        "id": 3,
        "text": "Molluscum contagiosum"
      },
      {
        "id": 4,
        "text": "Butterfly rash"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Keratoderma blennorrhagica is seen associated with <strong>Reiter&rsquo;s syndrome</strong> in <strong>10%</strong> of cases.</p>\n<p>Reiter syndrome is a systemic disorder, originally defined as a triad of arthritis, urethritis, and conjunctivitis. Cutaneous involvement includes psoriasiform lesions, named<strong> keratoderma blennorrhagic um (in about 10%</strong>), painful and erosive lesions on the tips of the fingers and toes, nail dystrophy (20-30%) and erythroderma as a rare complication.</p>\n<p>In addition, there may be other distinct mucocutaneous manifestations like <strong>circinate balanitis</strong>, these are small, shallow, painless ulcerative lesions on the glans penis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5e584c039cc04580aa6c654616fb2d08x176x96.JPEG"
    ]
  },
  {
    "text": "A 68-year-old man with Parkinson's disease was prescribed mirabegron to control his symptoms of urinary urgency and incontinence. What is the mechanism of action of this drug?",
    "choices": [
      {
        "id": 1,
        "text": "\u03b22 agonist"
      },
      {
        "id": 2,
        "text": "\u03b23 agonist"
      },
      {
        "id": 3,
        "text": "M3 receptor antagonist"
      },
      {
        "id": 4,
        "text": "M1 receptor antagonist"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Mirabegron</strong> is a <strong>&beta;<sub>3</sub>&nbsp;agonist&nbsp;</strong>used for the treatment of <strong>overactive bladder&nbsp;</strong>(OAB).&nbsp;Stimulation of &beta;<sub>3</sub>&nbsp;receptors in detrusor muscle increases the bladder capacity and provides symptomatic relief in overactive bladder.</p>\n<div class=\"ng-scope\">\n<div class=\"ng-scope\">\n<p id=\"__p7\">Antimuscarinic drugs are the mainstay of oral pharmacological treatment for OAB. It acts by inhibiting muscarinic receptor subtypes, <strong>M2 and M3 </strong>in the bladder. Both subtypes are expressed in multiple tissues, resulting in anticholinergic adverse events such as <strong>dry mouth</strong>, <strong>constipation,</strong> and <strong>cognitive impairment.&nbsp;</strong>These adverse effects are not seen with mirabegron as it acts via adrenergic receptors.</p>\n<p>Mirabegron is a moderate<strong> inhibitor</strong> of<strong> CYP2D6. </strong>Hence, caution has to be exercised when prescribing it along with CYP2D6 substrates such as metoprolol, desipramine, digoxin.&nbsp;</p>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 36-year-old woman presented with intermittent suprapubic pain, increased urinary frequency, and dysuria for 2 months. A cystoscopy revealed the presence of Hunner ulcers. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Malakoplakia"
      },
      {
        "id": 2,
        "text": "Transitional cell carcinoma of bladder"
      },
      {
        "id": 3,
        "text": "Follicular cystitis"
      },
      {
        "id": 4,
        "text": "Interstitial cystitis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Hunner ulcers</strong> are chronic mucosal ulcers that are characteristic of <strong>interstitial cystitis</strong> or chronic pelvic pain syndrome.</p>\n<p>It is a rare idiopathic condition that occurs most frequently in <strong>women.&nbsp;</strong>It presents with intermittent severe suprapubic pain, urinary frequency, urgency, hematuria,&nbsp;and dysuria.</p>\n<p>The following cystoscopic findings are seen in the bladder mucosa:</p>\n<ul>\n<li>Fissures</li>\n<li>Punctate hemorrhages (<strong>glomerulations</strong>)</li>\n</ul>\n<p>The microscopic findings include:<strong>&nbsp;</strong></p>\n<ul>\n<li><strong>Mucosal ulceration</strong> covered by fibrin and necrotic material</li>\n<li>Increased numbers of mucosal<strong> mast cells</strong></li>\n<li>Submucosal edema</li>\n</ul>\n<p>In later stages, transmural fibrosis may occur, leading to a <strong>contracted bladder</strong>. Biopsy must be done to <strong>rule out carcinoma in situ,</strong> which may clinically mimic interstitial cystitis.&nbsp;</p>\n<p>The following image shows a Hunner's ulcer in a patient with interstitial cystitis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6802a354ad8f47ad8efc07f22b39b0adx405x421.JPEG"
    ]
  },
  {
    "text": "A man presents to the OPD with recurrent attacks of burning micturition and urethral discharge. Gram-staining of the purulent discharge is given in the image below. Deficiency of which of the following complement factors increases the risk of development of this infection?",
    "choices": [
      {
        "id": 1,
        "text": "C1 esterase inhibitor"
      },
      {
        "id": 2,
        "text": "C4b5678"
      },
      {
        "id": 3,
        "text": "C5b6789"
      },
      {
        "id": 4,
        "text": "C2"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>This clinical scenario along with the <strong>microscopic</strong> findings of <strong>Gram\u2010negative intracellular diplococci</strong> indicates infection with <strong>Neisseria gonorrhoeae</strong>. A <strong>deficiency</strong> of <strong>membrane attack complex(C5b6789)</strong> leads to an increased risk of recurrent Neisseria infections.</p>\n<p>Complement factor <strong>C5b binds</strong> to the late components <strong>C6-C9,</strong> resulting in the formation of the <strong>membrane attack complex (MAC). Neisseria</strong> has thin cell walls, hence it is <strong>susceptible</strong> to <strong>lysis</strong> to the Membrane attack complex(MAC). Hence, <strong>deficiency</strong> of this complex leads to an <strong>increased risk</strong> of <strong>recurrent Neisseria</strong> infections.</p>\n<p><strong>Gonorrhea</strong>&nbsp;is a sexually transmitted disease caused by&nbsp;<em><strong>N. gonorrhea</strong></em>. The major symptoms include&nbsp;<strong>urethritis</strong>,&nbsp;<strong>vaginal&nbsp;discharge,&nbsp;</strong>dyspareunia, and&nbsp;<strong>dysuria.</strong>&nbsp;In the laboratory diagnosis of&nbsp;<em>N. gonorrhea,&nbsp;</em>the<em>&nbsp;</em>discharge on Gram's stain reveals&nbsp;<strong>gram\u2010negative intracellular diplococci</strong>&nbsp;within phagocytes.&nbsp;<span class=\"notion-enable-hover\" data-token-index=\"2\" data-reactroot=\"\">It<em>&nbsp;</em><strong>acidifies glucose</strong>&nbsp;but&nbsp;<strong>not maltose</strong>&nbsp;in serum sugars.</span>&nbsp;<strong>Stuart's</strong>&nbsp;medium is used for transport while&nbsp;<strong>Thayer-Martin agar</strong>&nbsp;is used as a selective medium used to isolate&nbsp;<em>N. gonorrhoeae.&nbsp;</em>Cultures can be obtained from&nbsp;<strong>chocolate agar</strong>&nbsp;or&nbsp;<strong>Mueller-Hinton agar</strong>.&nbsp;</p>\n<p><strong>Stuart&rsquo;s medium&nbsp;</strong>is the transport media used for&nbsp;<em><strong>Neisseria gonorrhea&nbsp;</strong></em>and<em><strong>&nbsp;</strong></em><strong><em>Neisseria meningitides.&nbsp;</em></strong>It is a semisolid, non-nutrient medium.&nbsp;<strong>Charcoal</strong>&nbsp;present in the medium neutralizes certain bacterial inhibitors&nbsp;while a<strong>&nbsp;reducing agent&nbsp;</strong>prevents oxidation.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/2ef2c0310ad9419c8b7e3aba5800b7a5.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 50-year-old female complains of progressive lower abdominal pain associated with frequent and painful urination. Under antibiotic coverage, cystoscopic examination shows soft, yellow, and raised mucosal plaques. The biopsy study from one of the lesions is given below. Which of the following organisms is the most common cause of this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Staphylococcus aureus"
      },
      {
        "id": 2,
        "text": "Mycobacterium tuberculosis"
      },
      {
        "id": 3,
        "text": "Escherichia coli"
      },
      {
        "id": 4,
        "text": "Proteus mirabilis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The clinical condition is described in the given case scenario is Malakoplakia. <strong>Escherichia coli</strong> is the most common organism involved in this condition.</p>\n<p>Malakoplakia is a distinct form of inflammatory reaction seen in chronic cystitis. It is a chronic inflammatory reaction resulting from acquired <strong>defects in phagocyte function</strong>, commonly affecting the urinary bladder. It can also be seen in other organ systems like the gastrointestinal tract, female genital tract, and the central nervous system. Malakoplakia is seen in chronic bacterial infection, mostly by <em><strong>Escherichia\u00a0coli</strong></em> or occasionally <strong>Proteus</strong> species.\u00a0 \u00a0Grossly, malakoplakia takes the form of soft, yellow, slightly raised <strong>mucosal plaques</strong>, often misdiagnosed clinically as malignancy. Microscopically, they are composed of <strong>large, foamy macrophages</strong> mixed with occasional multinucleate giant cells and lymphocytes. The macrophages have an abundant granular cytoplasm due to phagosomes stuffed with undigested bacterial products. In addition, intracellular deposition of calcium and iron within enlarged lysosomes forms laminated basophilic concretions, known as <strong>Michaelis\u2013Gutmann bodies</strong>, pathognomonic of malakoplakia.</p>\n<p>\u00a0The following image shows the\u00a0<strong>Michaelis\u2013Gutmann bodies\u00a0</strong>marked in black arrows.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/0d06acbe3a334122a8bc9b02521879e1.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/480909d0edff45ec8c3505db6da23d9ax1040x772.JPEG"
    ]
  },
  {
    "text": "A young woman complains of burning sensation during micturition, increased urinary frequency, and urgency. She does not complain of fever, flank pain, or colicky abdominal pain. Which of the following is/are the first-line medications used in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "1, 4, and 5"
      },
      {
        "id": 2,
        "text": "2, 3, and 5"
      },
      {
        "id": 3,
        "text": "1 only"
      },
      {
        "id": 4,
        "text": "1 and 3"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical sceanrio is suggestive of<strong> uncomplicated urinary tract infection</strong>&nbsp;(UTI), and<strong> nitrofurantoin </strong>and<strong>&nbsp;trimethoprim and sulfamethoxazole</strong> are the <strong>first-line drugs</strong>&nbsp;used in this condition.</p>\n<p>UTI encompasses many clinical entities, including asymptomatic bacteriuria, cystitis, prostatitis, and pyelonephritis. When the infection is confined to the bladder, also known as <strong>acute cystitis</strong>&nbsp;(the <strong>most common</strong> manifestation), it is known as&nbsp;<strong>uncomplicated UTI</strong>. This&nbsp;is&nbsp;more prevalent among <strong>women</strong> than men. When the infection extends beyond the bladder, causing systemic symptoms and signs, it is known as&nbsp;<strong>complicated UTI</strong>.</p>\n<p>Frequent sexual intercourse, a history of UTI, diabetes, and incontinence are some of the important risk factors of UTI. It is most commonly caused by <em><strong>E. coli</strong></em>. Other species include&nbsp;<em>Staphylococcus saprophyticus, Klebsiella</em>,<em> Proteus</em>,<em> Enterococcus</em>, and <em>Citrobacter</em> species.&nbsp;</p>\n<p>Patients with <strong>cystitis</strong> typically present with&nbsp;<strong>dysuria</strong>, <strong>urinary frequency</strong>, and <strong>urgency</strong>.&nbsp;Nocturia, hesitancy, suprapubic discomfort, and gross hematuria can also be seen.&nbsp;<strong>Fever</strong> with a typical high spiking picket-fence pattern and rigors,&nbsp;<strong>flank and/or loin pain</strong>,&nbsp;nausea, and vomiting&nbsp;are seen in <strong>pyelonephritis</strong>. UTI&nbsp;can be complicated by the presence of infection, stones or foreign bodies, or delayed response to treatment.</p>\n<p>Treatment in a patient with uncomplicated cystitis is started based on history alone. However, if symptoms are not specific or history is not reliable, a <strong>urine dipstick test</strong> is performed. Emperical treatment can be started in a woman with <strong>one symptom of UTI</strong> and a <strong>positive nitrite or leukocyte esterase&nbsp;</strong>result. In case of a negative result, urine culture and pelvic examination are recommended.</p>\n<p>Antibiotic therapy include:</p>\n<ul>\n<li><strong>Trimethoprim and sulfamethoxazole </strong>(TMP-SFX)<strong>&nbsp;</strong>and&nbsp;<strong>nitrofurantoin</strong>: These are the <strong>first-line </strong>drugs for <strong>uncomplicated cystitis</strong>. However, TMP-SFX show high rates of resistance and adversely affect the normal flora in the body. Pivmecillinam, fosfomycin, and nitrofurantoin can be used instead.&nbsp;</li>\n<li><strong>Beta-lactam antibiotics</strong>: These are the <strong>second-line</strong> agents due to high rates of relapse and lower pathogen clearance.</li>\n<li><strong>Fluoroquinolones&nbsp;</strong>(ciprofloxacin): These&nbsp;are used for uncomplicated cystitis only if no other alternatives are available due to high rates of resistance and side effects like increased risk of Achilles tendon rupture and irreversible neuropathy. However, they are the <strong>first-line</strong> drugs for <strong>pyelonephritis</strong>.</li>\n<li><strong>Ampicillin</strong> and <strong>cephalosporins</strong>: These are drugs of choice in <strong>pregnancy</strong>.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient presents with urinary frequency, nocturia, enuresis. 24 hr urine volume was done and found that it is greater than 3 litres. The urine osmolality was 200 mOsm/L. ADH assay was done and the values revealed 0.8 pg/ml. MRI of brain was done and the T1 weighted image did not reveal any abnormalities. The most likely diagnosis is ?",
    "choices": [
      {
        "id": 1,
        "text": "Nephrogenic DI"
      },
      {
        "id": 2,
        "text": "Primary polydipsia"
      },
      {
        "id": 3,
        "text": "Pituitary DI"
      },
      {
        "id": 4,
        "text": "Mannitol Infusion"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical situation suggests <strong>Primary polydipsia.</strong></p>\n<p><strong>Approach to the question :</strong></p>\n<ul>\n<li>Greater than 3 litres = Polyuria</li>\n<li>Urine osmolality &lt; 300 mOsm/ L = Diabetes insipidus, Primary polydipsia</li>\n<li>Urine osmolality &gt; 300 mOsm/ L = Solute loss (Mannitol infusion, Hypertonic saline)</li>\n<li>ADH assay normal value = 1 pg/ml</li>\n<li>ADH assay &gt; 1 = Nephrogenic DI</li>\n<li>ADH assay &lt; 1 = Primary polydipsia , Central DI</li>\n</ul>\n<p>To differentiate Central DI and Primary polydipsia , MRI brain should be done.</p>\n<ul>\n<li>In case of Primary polydipsia , <strong>Pituitary bright spot</strong> will be <strong>seen</strong>.</li>\n<li>In Central DI , <strong>Pituitary bright spot</strong> will be <strong>absent.</strong></li>\n</ul>\n<p><strong>NOTE:&nbsp;</strong>In <strong>most healthy adults and children</strong>, the <strong>posterior pituitary emits a hyperintense signal</strong> visible in T1-weighted midsagittal images. <strong>This &ldquo;bright spot&rdquo; is almost always present in patients with primary polydipsia</strong> but is always absent<br />or abnormally small in patients with pituitary DI.</p>\n<p>Therefore, when the question says that there were no abnormalities in the MRI, it just means that there is a <strong>pituitary bright spot present</strong>, because it is a finding seen even in healthy people and hence not considered an abnormality.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 28-year-old male patient presents with a history of purulent urethral discharge and painful micturition for the past 2 days. Why is the following medium used to elicit the growth of the suspected pathogenic organism in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "It is an enrichment media"
      },
      {
        "id": 2,
        "text": "Growth of other commensals is suppressed"
      },
      {
        "id": 3,
        "text": "It contains potassium tellurite"
      },
      {
        "id": 4,
        "text": "It is an egg-containing medium"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Thayer-Martin medium is shown in the above image, and it is used to isolate <em><strong>Neisseria gonorrhoeae</strong></em> because the antimicrobials present in it\u00a0<strong>suppress the growth of other commensal organisms.</strong></p>\n<p>Gonorrhea in males most commonly manifests as\u00a0<strong>acute urethritis - mucopurulent urethral discharge and burning micturition,\u00a0</strong>as mentioned in the given clinical scenario.\u00a0</p>\n<p>Contents of Thayer-Martin medium includes</p>\n<ul>\n<li><strong>Vancomycin</strong>: to inhibit most gram-positive bacteria</li>\n<li><strong>Colistin (Polymyxin E)</strong>: to inhibit most gram-negative bacteria other than <em>Neisseria</em></li>\n<li><strong>Nystatin</strong>\u00a0or\u00a0<strong>anisomycin</strong>: to inhibit yeast</li>\n</ul>\n<p>Note:\u00a0Contents of Modified Thayer-Martin medium are same as those of Thayer-Martin medium, except that the former contains an additional antibiotic trimethoprim\u00a0to inhibit proteus.</p>\n<p>Since <em><strong>N. gonorrhoeae</strong>, N. meningitidis,</em> and <em>N. lactamica</em> are <strong>colistin-resistant</strong> they can be grown on these selective media.</p>\n<p><strong>Gonorrhea i</strong><strong>n males:</strong>\u00a0</p>\n<ul>\n<li>The disease starts as acute urethritis.\u00a0This infection may extend along the urethra to involve the prostate, seminal vesicles, and epididymis.</li>\n<li><strong>Chronic urethritis</strong> may result in\u00a0<strong>stricture</strong> formation.</li>\n<li>The infection may spread to the periurethral tissues causing abscess and multiple discharging sinuses <strong>(water can perineum).</strong></li>\n</ul>\n<p><strong>Gonorrhea in females:</strong>\u00a0</p>\n<ul>\n<li>The initial infection involves the <strong>cervix</strong> <strong>uteri\u00a0</strong>and <strong>urethra\u00a0</strong>which\u00a0may extend to Bartholin glands, endometrium, and fallopian tubes.</li>\n<li>The vaginal mucosa is not usually affected in adults because of the stratified squamous epithelium. It is resistant to infection by the cocci, and also because of the acidic pH of vaginal secretions.</li>\n<li>Pelvic inflammatory disease and salpingitis may result in\u00a0<strong>sterility.</strong></li>\n<li>Rarely peritonitis may develop with perihepatic inflammation termed\u00a0<strong>Fitz-Hugh-Curtis syndrome.</strong></li>\n</ul>\n<p>Other options:</p>\n<p>Option A- Enrichment media are\u00a0<strong>liquid</strong>\u00a0media, which\u00a0<strong>allow</strong>\u00a0for the<strong>\u00a0growth of certain</strong>\u00a0organisms and\u00a0<strong>inhibit the growth of others</strong>\u00a0(natural flora). Substances having a stimulating effect on bacteria, which is to be grown, or an inhibitory effect on those to be suppressed are used in this medium. Examples include</p>\n<ul>\n<li>Tetrathionate broth where tetrathionate allows typhoid-paratyphoid bacilli to grow and inhibits coliforms.</li>\n<li>Selenite F broth for dysentery-causing bacteria\u00a0</li>\n</ul>\n<p>Option C - <strong>McLeod medium</strong> is an indicator medium that contains <strong>potassium tellurite</strong>. Tellurite is reduced to metallic tellurium by <em>Corynebacterium diphtheriae</em>\u00a0to produce black colonies.</p>\n<p>Option D -\u00a0<strong>Enriched medium</strong>: When a basal medium is\u00a0<strong>added</strong>\u00a0with additional\u00a0<strong>nutrients</strong>\u00a0such as<strong>\u00a0blood, serum, or egg</strong>, it is called enriched medium. e.g. Lowenstein-Jensen medium is an inspissated selective egg medium containing fresh egg or egg yolk used for the primary isolation of <em>Mycobacterium</em> species<em>.\u00a0</em>\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/03013d97226044cfb6d2520ca8517d25.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 24-year old female G1P0L0 at 12 weeks of gestation complains of burning micturition, vaginal pruritus, and increased frequency of urination. On examination, her vitals are stable. There is no suprapubic or costovertebral angle tenderness. On per vaginal examination, there is redness of the cervix. Urine analysis is positive for leukocyte esterase but negative on Gram staining. Cervical swab Gram staining also does not show any organisms. Which of the following is the treatment of choice in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Azithromycin alone"
      },
      {
        "id": 2,
        "text": "Doxycycline alone"
      },
      {
        "id": 3,
        "text": "Azithromycin + doxycycline"
      },
      {
        "id": 4,
        "text": "Azithromycin + ceftrioxone"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The above clinical scenario is suggestive of <strong>Chlamydial cervicitis </strong>and is treated with<strong>&nbsp;azithromycin </strong>in<strong> pregnant women</strong>.</p>\n<p>Chlamydia trachomatis is a <strong>gram-negative obligate intracellular bacteria</strong> and is a common cause of sexually transmitted infections.&nbsp;</p>\n<p>Smears prepared from urethral and cervical secretions are used for diagnosis. As these organisms <strong>lack muramic acid</strong> in the cell wall, they <strong>do not stain</strong> well on <strong>gram staining</strong>. Diagnosis can be made through<strong> PCR (gold standard)</strong>, fluorescent antibody stain, or Giemsa stain.&nbsp;<strong>NAATs are the most sensitive tests</strong> for these specimens and therefore are <strong>recommended for detecting C. trachomatis infection.</strong></p>\n<p>Chlamydia trachomatis infection is <strong>most often asymptomatic but may present as urethritis, cervicitis, vulvovaginitis, and pelvic inflammatory disease</strong> in women.&nbsp;Chlamydial infection in pregnancy can lead to abortion, intrauterine growth restriction, and pre-term labor. Chlamydial infections can be transmitted to the baby during birth causing conjunctivitis, nasopharyngitis, otitis media, and pneumonia.</p>\n<p>Treatment with <strong>azithromycin (1 g orally single dose) or doxycycline (100 mg BD for 7 days)</strong> is advised <strong>both to the patient and her sexual partner.</strong> In <strong>pregnant women</strong> like this patient, <strong>doxycycline</strong> is <strong>contraindicated </strong>due to <strong>teratogenicity</strong>. Other drugs which can be used safely in pregnant women with chlamydia include erythromycin and amoxicillin.&nbsp;</p>\n<p><strong>Ceftriaxone</strong> (500 mg IM single dose) is added empirically when there is a suspicion of <strong>gonococcal infection.</strong> It presents with purulent white discharge. In gonococcal cervicitis, gram staining of cervical swabs shows gram-negative diplococci.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 20-year-old male patient presents to the OPD with complaints of fever, intermittent abdominal pain, and burning micturition. He gives a history of swimming in a freshwater lake 10 days back. Urine microscopy shows the following. Which of the following is the causative agent?",
    "choices": [
      {
        "id": 1,
        "text": "Schistosoma hematobium"
      },
      {
        "id": 2,
        "text": "Schistosoma mansoni"
      },
      {
        "id": 3,
        "text": "Schistosoma japonicum"
      },
      {
        "id": 4,
        "text": "Schistosoma species cannot be determined based on egg"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical picture and image showing an <strong>egg</strong> that is <strong>non-operculated</strong> with the <strong>terminal spine</strong> at one pole are suggestive of infection with&nbsp;<strong><em>Schistosoma hematobium</em>.</strong></p>\n<p>Species differentiation of schistosoma can be done based on the location of the spine as follows:</p>\n<ul>\n<li>Terminal spine-&nbsp;<em>Schistosoma hematobium</em></li>\n<li>Lateral spine-&nbsp;<em>Schistosoma mansoni</em></li>\n<li>Rudimentary lateral spine-&nbsp;<em>Schistosoma japonicum</em></li>\n</ul>\n<p>The image below shows egg of&nbsp;<em>Schistosoma mansoni.&nbsp;</em>Adult worms of&nbsp;<strong>S. mansoni</strong>&nbsp;live in the&nbsp;<strong>inferior mesenteric vein</strong><em><strong>.</strong></em></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e4c3df51c7ac4b7d8d2343dc63123a6e.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d9e482352ca84931a53713d6f49968f1x958x622.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3ee84b0ab3854f10936c6f287cebb2a0x600x464.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/db6850bf3c464cb18c5a7d08eb91ddaex720x512.JPEG"
    ]
  },
  {
    "text": "A 45-year-old man presents with dull pelvic pain and burning micturition for 1 year. On per rectal exam, he has mild pain on palpating the prostate. Which is best suited to obtain a culture sample for his condition?",
    "choices": [
      {
        "id": 1,
        "text": "Mid stream clean catch sample"
      },
      {
        "id": 2,
        "text": "Sample of the ejaculate"
      },
      {
        "id": 3,
        "text": "Per rectal prostate aspirate"
      },
      {
        "id": 4,
        "text": "Sample obtained after a prostate massage"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical scenario of <strong>chronic pelvic</strong> pain with <strong>burning micturition</strong> lasting more than a year makes chronic prostatitis the likely diagnosis. In order to obtain an adequate sample for this, a <strong>prostate massage</strong> is done to elicit <strong>prostatic secretions</strong> (or <strong>threads)which</strong> are sent for culture to clinch the diagnosis.</p>\n<p><strong>Chronic bacterial prostatitis\u00a0</strong>occurs when either acute infections were not treated adequately or if the patient has had repeated episodes of acute prostatitis.</p>\n<p>Clinically, patients present with <strong>prostatodynia</strong> and <strong>dysuria.</strong> They can also have <strong>sexual</strong> dysfunction.</p>\n<p>Diagnosis of chronic bacterial prostatitis is done via the 3-tube test.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6e7956f83bf845adb6dbdfb9d1d6654dx1280x1257.JPEG"
    ]
  },
  {
    "text": "Komal, a high school student developed a fever after she came back from a trip with her friends. She also complained about pain while urinating. She says she has been having these episodes frequently for the past few years. Her father and her grandfather are a known case of cystic kidney disease. Her urine analysis is indicative of UTI with hematuria. Renal ultrasound was done and its findings are shown below. Which of the following chromosomes are associated with this condition?",
    "choices": [
      {
        "id": 1,
        "text": "14 and 6"
      },
      {
        "id": 2,
        "text": "8 and 14"
      },
      {
        "id": 3,
        "text": "4 and 16"
      },
      {
        "id": 4,
        "text": "12 and 16"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The presence of multiple cysts seen on the ultrasound(image) along with a positive family history point towards the diagnosis of&nbsp;<strong>autosomal-dominant polycystic kidney disease.</strong>&nbsp;<strong>Chromosomes 16 and 4</strong> are associated with this condition.&nbsp;</p>\n<p>Autosomal-dominant polycystic kidney disease inheritance:</p>\n<table style=\"width: 445.372px;\">\n<tbody>\n<tr>\n<td style=\"width: 157px;\">Chromosome involved</td>\n<td style=\"width: 140px;\"><strong>Chr16 short arm</strong></td>\n<td style=\"width: 132.372px;\"><strong>Chr 4 long arm</strong></td>\n</tr>\n<tr>\n<td style=\"width: 157px;\">Gene</td>\n<td style=\"width: 140px;\"><em>PKD 1</em></td>\n<td style=\"width: 132.372px;\"><em>PKD 2</em></td>\n</tr>\n<tr>\n<td style=\"width: 157px;\">Protein encoded</td>\n<td style=\"width: 140px;\">Polycystin 1</td>\n<td style=\"width: 132.372px;\">Polycystin 2</td>\n</tr>\n<tr>\n<td style=\"width: 157px;\">Function</td>\n<td style=\"width: 140px;\">Transmembrane glycoprotein</td>\n<td style=\"width: 132.372px;\">Non-selective cation channel</td>\n</tr>\n<tr>\n<td style=\"width: 157px;\">Seen in</td>\n<td style=\"width: 140px;\">85 %</td>\n<td style=\"width: 132.372px;\">10&ndash;15 %</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/8922fbbcd2914284bfa50955ea0b92fb.jpg"
    ],
    "explanation_images": []
  },
  {
    "text": "A 27-year-old woman presents with urinary frequency, urgency, and burning during urination of two days duration. Presence of which of the following additional findings would make you suspect pyelonephritis in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Fever"
      },
      {
        "id": 2,
        "text": "Bacteriuria"
      },
      {
        "id": 3,
        "text": "White blood cell casts"
      },
      {
        "id": 4,
        "text": "Sterile pyuria"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>White blood cell casts</strong> are specific features of&nbsp;<strong>pyelonephritis</strong>. Neutrophil-rich casts (pus casts)&nbsp;indicate&nbsp;<strong>renal involvement</strong>&nbsp;because casts are formed only in tubules.&nbsp;</p>\n<p>The urine contains many leukocytes (<strong>pyuria</strong>) derived from the inflammatory infiltrate.&nbsp; It is found in both <strong>upper</strong> and <strong>lower UTIs</strong> and cannot differentiate between them. <strong>Fever</strong> is also a <strong>non-specific</strong> finding.</p>\n<p><strong>Ascending infection</strong> is the most common <strong>cause</strong> of clinical pyelonephritis.</p>\n<p>Note: Sterile pyuria is defined as white cells in the urine in the absence of significant bacterial growth. It is seen in renal TB.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = 'Lower Urinary Tract Symptoms (Luts) Mini Test - -Tmt';
        const quizFilename = 'lower-urinary-tract-symptoms-luts-mini-test-tmt-91a8659d.html';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2024-25"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>