<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>23 Appendix - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Surgery
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">24</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "What is the most common anatomical position of the appendix?",
    "choices": [
      {
        "id": 1,
        "text": "Paracecal"
      },
      {
        "id": 2,
        "text": "Postileal"
      },
      {
        "id": 3,
        "text": "Retrocaecal"
      },
      {
        "id": 4,
        "text": "Pelvic"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Retrocaecal</strong> is the most common position of the appendix.</p>\n<p><strong>Positions of appendix</strong>:</p>\n<ul>\n<li>Retrocaecal: 74%</li>\n<li>Pelvic: 21%</li>\n<li>Sub-cecal: 1.5%</li>\n<li>Pre-ileal: 1%</li>\n<li>Post-ileal: 0.5%</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f49f070eddbf4110a3f241946e09bfa2x600x742.JPEG"
    ]
  },
  {
    "text": "Which of the following is not true regarding the various anatomical positions of the appendix?",
    "choices": [
      {
        "id": 1,
        "text": "Tenderness may be elicited on the immediate right of the umbilicus in post-ileal appendicitis"
      },
      {
        "id": 2,
        "text": "The most common location of the base of the appendix is retro-caecal"
      },
      {
        "id": 3,
        "text": "An inflamed pelvic appendix may cause an increase in frequency of micturition"
      },
      {
        "id": 4,
        "text": "Post-ileal appendicitis may have diarrhoea as a presenting complaint"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>base of the appendix</strong> is found at the confluence of the three <strong>taeniae coli of the caecum</strong>. Its position is constant. Conversely, the tip of the appendix can be found in many positions ( retrocaecal being the most common)</p>\n<p>The taeniae coli fuse to form the longitudinal muscle coat of the appendix. During surgery, gentle traction at the taenia coli, leads the surgeon to the base of the appendix.</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e9297eb11d304a51b38dff5e5b39122ax600x742.JPEG"
    ]
  },
  {
    "text": "During an appendectomy, the mesoappendix is divided and ligated. Which of the following is false about the major vessel ligated in this step?",
    "choices": [
      {
        "id": 1,
        "text": "It supplies only the appendix"
      },
      {
        "id": 2,
        "text": "It is a branch of upper division of the ileocolic artery"
      },
      {
        "id": 3,
        "text": "It is an end artery"
      },
      {
        "id": 4,
        "text": "Thrombosis is most common at the tip"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>appendicular artery</strong> transverses&nbsp;behind the terminal ileum and enters the<strong> mesoappendix</strong>&nbsp;away from the base of the appendix. It lies along the free border of the <strong>mesoappendix</strong>.<strong>&nbsp;</strong>The terminal part or<strong>&nbsp;</strong>the<strong> tip</strong> of the artery lies on the wall of the appendix and may become <strong>thrombosed</strong> in appendicitis, resulting in distal gangrene or necrosis.</p>\n<p>It supplies only the <strong>appendix </strong>and is&nbsp;an<strong> end-artery.</strong></p>\n<p>An <strong>accessory appendicular</strong> <strong>artery</strong>&nbsp;called the artery of Seshachalam may be present. It&nbsp;anastomoses at the base of the appendix with a branch of the posterior cecal artery.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4bef7bc4398a4bda814f39db19cb27f0x844x714.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e44f3dfdd3b9459e915fb13d001e4a01x572x582.PNG"
    ]
  },
  {
    "text": "While assisting a laparoscopic appendectomy, you observe the resident use the Fold of Treves as a guide while coagulating vessels in the mesoappendix. Which of the following best describes the anatomical landmark?",
    "choices": [
      {
        "id": 1,
        "text": "Mucous membrane projecting into the ileal lumen"
      },
      {
        "id": 2,
        "text": "The ilio-cecal fold of the peritoneum"
      },
      {
        "id": 3,
        "text": "The fold of the mucous membrane around appendiceal orifice"
      },
      {
        "id": 4,
        "text": "The fold of the peritoneum over ascending colon"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Jackson Membrane: Adhesion from the right abdominal wall to the anterior tenia of the ascending colon.</p>\n<p>Gerlach valves: A mucosal fold covering the appendiceal orifice.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0009821363034533a2861cf730f83db4x1280x1583.JPEG"
    ]
  },
  {
    "text": "The CECT findings of a patient who presented with a positive McBurney's sign show a dilated appendix, appendicular wall thickening, and fat stranding. What is the initiating event that leads to his condition?",
    "choices": [
      {
        "id": 1,
        "text": "Bacterial invasion"
      },
      {
        "id": 2,
        "text": "Perforation"
      },
      {
        "id": 3,
        "text": "Luminal obstruction"
      },
      {
        "id": 4,
        "text": "Ischemia"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The clinical scenario is suggestive of&nbsp;<strong>appendicitis</strong>. The initiating event in the development of appendicitis is <strong>luminal obstruction</strong>.</p>\n<p>Deep tenderness at McBurney's point, known as <strong>McBurney's sign</strong>, is a sign of acute appendicitis.&nbsp;<strong>McBurney's point</strong> is a point at&nbsp;one-third of the distance from the anterior superior iliac spine and umbilicus. It is where the appendix is commonly located.</p>\n<p>Due to the relatively small diameter of the appendicular lumen, it is easily obstructed. Usually, due to <strong>fecoliths.&nbsp;</strong>This&nbsp;leads to the buildup of mucus secretions and air due to bacteria. With progressive dilation, venous drainage may get hampered, leading <strong>to full-thickness ischemia and perforation</strong>.</p>\n<p>Obstructed lumen of appendix &rarr;&nbsp;Retained secretions with distension of lumen&nbsp;&rarr;&nbsp;Secretions get infected&nbsp;&rarr;&nbsp;Venous occlussion due to increased pressure&nbsp;&rarr;&nbsp;Bacterial translocation&nbsp;&rarr; Gangrene &amp; perforation&nbsp;&rarr;&nbsp;Appendicular abscess&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the earliest symptom in a patient with acute appendicitis?",
    "choices": [
      {
        "id": 1,
        "text": "Right lower quadrant pain"
      },
      {
        "id": 2,
        "text": "Periumbilical pain"
      },
      {
        "id": 3,
        "text": "Fever"
      },
      {
        "id": 4,
        "text": "Anorexia"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Symptoms of acute appendicitis begin as <strong>periumbilical pain</strong>&nbsp;followed by anorexia and nausea.</p>\n<p>Acute appendicitis begins with poorly localized <strong>colicky abdominal</strong> <strong>pain</strong>,<strong>&nbsp;</strong>first noticed in the<strong> periumbilical region.&nbsp;</strong>This is due to <strong>midgut visceral discomfort </strong>(T8 to T10 dermatomes)&nbsp;in response to appendiceal inflammation and obstruction.</p>\n<p>Over the <strong>next 12-24 hours</strong>, it localises to the <strong>right lower quadrant</strong> due to local peritoneal inflammation.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient presents to the casualty with right lower abdominal pain, nausea, and fever. On examination, there is increased pain in the right lower quadrant when palpating the left lower quadrant. What is this sign is called?",
    "choices": [
      {
        "id": 1,
        "text": "Rovsing sign"
      },
      {
        "id": 2,
        "text": "Aaron sign"
      },
      {
        "id": 3,
        "text": "Dunphy's sign"
      },
      {
        "id": 4,
        "text": "McBurney's sign"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given triad of clinical features, namely <strong>fever</strong>, <strong>nausea</strong> and <strong>right lower abdominal pain</strong> is <strong>Murphy's triad</strong>. It is suggestive of <strong>acute appendicitis</strong>. Deep palpation of the left iliac fossa can cause pain in the right iliac fossa. This sign is called <strong>Rovsing&rsquo;s sign.</strong></p>\n<p>This pain is due to the backflow of gases from the colon into the inflamed right intestine when the&nbsp;left&nbsp;lower abdomen is palpated.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You are examining a patient suspected to have appendicitis. During the given manoeuvre, you notice that the  patient has sharp right-sided abdominal pain. Which of the following statements is false?",
    "choices": [
      {
        "id": 1,
        "text": "This sign elicited is known as Psoas Sign"
      },
      {
        "id": 2,
        "text": "It is commonly associated with pelvic appendicitis"
      },
      {
        "id": 3,
        "text": "Flexion of the hip against resistance may be done instead"
      },
      {
        "id": 4,
        "text": "Pain is due to contact of inflamed appendix with the psoas muscle"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Pain elicited on hip flexion and internal rotation is called<strong>\u00a0</strong>the <strong>obturator sign</strong>. It is commonly seen in pelvic appendicitis.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/65ffb37e6bab4cec9e38b285a3fc3132.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ef0873788b654cff81f19549dfbe5699x510x336.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c64b2b48667a42a48da577846297ff2dx720x621.GIF"
    ]
  },
  {
    "text": "A young boy was brought to the casualty with a history of fever and abdominal pain. On examination, he was febrile and his pulse rate was 104 beats/min. The CT scan image is shown below. Which of the following  signs is not seen in this disease?",
    "choices": [
      {
        "id": 1,
        "text": "McBurney's tenderness"
      },
      {
        "id": 2,
        "text": "Rovsing\u2019s  sign"
      },
      {
        "id": 3,
        "text": "Psoas sign"
      },
      {
        "id": 4,
        "text": "Ballance sign"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The patient's history and radiological findings are indicative of <strong>acute appendicitis</strong>. Ballance sign is <strong>not</strong> seen in acute appendicitis.</p>\n<p>Findings on CT that are suggestive of acute appendicitis include:</p>\n<ul>\n<li>Appendiceal dilatation (&gt;6 mm in diameter)&nbsp;</li>\n<li>Appendiceal wall thickening (&gt;3 mm) and enhancement</li>\n</ul>\n<p><strong>Ballance sign </strong>is seen due to a <strong>ruptured spleen</strong>. The ballance sign is positive if there is a <strong>fixed dullness</strong> to&nbsp;percussion&nbsp;in the <strong>left flank</strong> and <strong>shifting dullness</strong> to percussion in the <strong>right flank.</strong> The fixed dullness is due to the presence of coagulated blood near the lacerated spleen while the shifting dullness is due to the presence of blood in the peritoneal cavity.</p>\n<p>Option A:&nbsp;Deep tenderness at McBurney's point, known as&nbsp;<strong>McBurney's sign</strong>, is a sign of acute appendicitis.&nbsp;<strong>McBurney's point</strong>&nbsp;is a point at&nbsp;one-third of the distance from the anterior superior iliac spine and umbilicus.</p>\n<p>Option B:&nbsp;<strong>Rovsing sign</strong> is seen in appendicitis. <strong>Deep palpation</strong> of the <strong>left iliac fossa</strong> may cause pain in the right iliac fossa.</p>\n<p>Option C:&nbsp;<strong>Psoas sign</strong> is seen in appendicitis. Occasionally, an in\ufb02amed appendix lies on the psoas muscle, and the patient will lie with the right hip \ufb02exed, for pain relief.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b052aaad056f40eaa0fc783b2d48830e.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 9-year-old girl is brought to the casualty with a history of abdominal pain and vomiting for the past 4 hours. On examination, the patient is febrile. Rebound tenderness in the right iliac fossa is seen. Which among the following is the preferred imaging modality in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Contrast-enhanced CT scan"
      },
      {
        "id": 2,
        "text": "Ultrasound of the abdomen"
      },
      {
        "id": 3,
        "text": "Non-contrast enhanced CT"
      },
      {
        "id": 4,
        "text": "Erect X Ray of the abdomen"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The clinical scenario is suggestive of acute appendicitis. In the pediatric population, <strong>ultrasound of the abdomen</strong> is the preferred imaging modality to identify the presence of an inflamed appendix. It avoids the risk of radiation exposure.&nbsp;</p>\n<p>In<strong> adults</strong>, the best imaging modality is a <strong>CT scan</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "For which of the following criteria on the Alvarado system, will you assign 2 points to a patient with features of appendicitis?",
    "choices": [
      {
        "id": 1,
        "text": "1, 2"
      },
      {
        "id": 2,
        "text": "1, 3"
      },
      {
        "id": 3,
        "text": "3, 5"
      },
      {
        "id": 4,
        "text": "4, 5"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The Alvarado score is a clinical scoring system used in the diagnosis of appendicitis.&nbsp;In the Alvorado scoring system,&nbsp;<strong>leukocytosis &ge; </strong>10 &times; 10<sup>9</sup><strong> cells/L&nbsp;</strong>&nbsp;and<strong> tenderness right iliac fossa</strong> have two points.<strong>&nbsp;</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following organisms is most commonly isolated in patients presenting with perforated appendicitis?",
    "choices": [
      {
        "id": 1,
        "text": "Viridans streptococcus"
      },
      {
        "id": 2,
        "text": "Bacteroides thetaiotaomicron"
      },
      {
        "id": 3,
        "text": "Bacteroides fragilis"
      },
      {
        "id": 4,
        "text": "Peptostreptococcus"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><em>Bacteroides fragilis</em><strong> is the most common anaerobe</strong> and <em>Escherichia coli</em><strong> is the most common aerobe isolated</strong> from <strong>perforated appendicitis.</strong></p>\n<table>\n<tbody>\n<tr>\n<td width=\"319\">\n<p>Type of bacteria</p>\n</td>\n<td width=\"319\">\n<p>Patients (%)</p>\n</td>\n</tr>\n<tr>\n<td width=\"319\">\n<p>Anaerobic Bacteria</p>\n</td>\n<td width=\"319\">\n<p>&nbsp;</p>\n</td>\n</tr>\n<tr>\n<td width=\"319\">\n<p><em><strong>Bacteroides fragilis</strong></em></p>\n</td>\n<td width=\"319\">\n<p>80</p>\n</td>\n</tr>\n<tr>\n<td width=\"319\">\n<p><em>Bacteroides thetaiotaomicron</em></p>\n</td>\n<td width=\"319\">\n<p>61</p>\n</td>\n</tr>\n<tr>\n<td width=\"319\">\n<p><em>Bilophila wadsworthia</em></p>\n</td>\n<td width=\"319\">\n<p>55</p>\n</td>\n</tr>\n<tr>\n<td width=\"319\">\n<p><em>Peptostreptococcus</em> spp.</p>\n</td>\n<td width=\"319\">\n<p>46</p>\n</td>\n</tr>\n<tr>\n<td width=\"319\">\n<p>Aerobic Bacteria</p>\n</td>\n<td width=\"319\">\n<p>&nbsp;</p>\n</td>\n</tr>\n<tr>\n<td width=\"319\">\n<p><em><strong>E. coli</strong></em></p>\n</td>\n<td width=\"319\">\n<p>77</p>\n</td>\n</tr>\n<tr>\n<td width=\"319\">\n<p><em>Streptococcus viridians</em></p>\n</td>\n<td width=\"319\">\n<p>43</p>\n</td>\n</tr>\n<tr>\n<td width=\"319\">\n<p>Group D streptococci</p>\n</td>\n<td width=\"319\">\n<p>27</p>\n</td>\n</tr>\n<tr>\n<td width=\"319\">\n<p><em>Pseudomonas aeruginosa</em></p>\n</td>\n<td width=\"319\">\n<p>18</p>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient presents with fever and right lower quadrant pain for the past week. On examination, tenderness and guarding in the right iliac fossa are present. An ill-defined abdominal mass is also palpated. CBC reveals leucocytosis. What is the next step in management?",
    "choices": [
      {
        "id": 1,
        "text": "Appendicectomy"
      },
      {
        "id": 2,
        "text": "Monitor and administer fluids"
      },
      {
        "id": 3,
        "text": "Incision and drainage"
      },
      {
        "id": 4,
        "text": "Exploratory laparotomy"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In<strong> appendicular mass,</strong> the inflammatory process is already localized and any surgical intervention may be difficult and dangerous. Hence, if the general condition is satisfactory, the <strong>conservative Ochsner&ndash;Sherren regimen</strong> is used.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Identify the incision made on a patient while performing an appendicectomy.",
    "choices": [
      {
        "id": 1,
        "text": "Gridiron incision"
      },
      {
        "id": 2,
        "text": "Lanz incision"
      },
      {
        "id": 3,
        "text": "Rutherford\u2013Morison incision"
      },
      {
        "id": 4,
        "text": "Rockey\u2013Davis incision"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Lanz incision</strong> is a transverse skin crease incision for appendicitis 2 cm below the&nbsp; umbilicus, centered on the midclavicular&ndash;mid inguinal line</p>\n<p>Option A:&nbsp;<strong>Gridiron</strong>&nbsp;<strong>incision </strong>is an&nbsp;oblique <strong>muscle-splitting</strong> incision in the right lower quadrant. It is also called&nbsp;<strong>McBurney</strong> incision.</p>\n<p>Option C:&nbsp;<strong>Rutherford&ndash;Morrison incision </strong>is an<strong>&nbsp;</strong>oblique <strong>muscle-cutting</strong> incision with its lower end over McBurney&rsquo;s point and <strong>extending obliquely upwards and laterally</strong> as necessary(Shown on the left side in the image for the sake of clarity)</p>\n<p>Option D<strong>: Rockey&ndash;Davis incision&nbsp;</strong>is a&nbsp;transverse right lower quadrant incision.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3b35e46a763d478c8f1d065f5dc77cbc.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7fcf2d22eeb94e2686b24dca63e0784ex1200x1486.JPEG"
    ]
  },
  {
    "text": "A surgeon performs an appendicectomy with a grid iron incision. He later converts the incision to Rutherford Morrison incision. Which of the following are cut?",
    "choices": [
      {
        "id": 1,
        "text": "1, 3,  4"
      },
      {
        "id": 2,
        "text": "2, 3, 4"
      },
      {
        "id": 3,
        "text": "1, 2, 3"
      },
      {
        "id": 4,
        "text": "1, 2, 4"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The structures cut when the initial incision <strong>g</strong><strong>ridiron incision</strong>&nbsp;(McBurney's incision) is converted to the&nbsp;<strong>Rutherford Morrison incision&nbsp;</strong>are the <strong>external oblique, internal oblique,&nbsp;</strong>and<strong> transverse abdominis muscles</strong>.</p>\n<p>When the preoperative diagnosis is reasonably certain, the widely used incision for <strong>appendectomy</strong> is known as the <strong>gridiron incision</strong>. It is made perpendicular to a line connecting the anterior superior iliac spine to the umbilicus, with its center at McBurney's point. When better access is needed, the gridiron incision can be <strong>converted to a Rutherford Morison incision</strong> by extending the incision obliquely upwards and laterally.&nbsp;</p>\n<p>Rutherford Morison's incision is suitable for a <strong>para- or retrocecal appendix</strong> that is fixed. It is an <strong>oblique muscle-cutting incision</strong> starting from McBurney's point and extending upward and laterally as needed. <strong>All layers </strong>(skin, subcutaneous tissues, <strong>external oblique, internal oblique,&nbsp;transversus abdominis</strong>, and the peritoneum)&nbsp;are divided along the incision line.</p>\n<p>In recent years, the <strong>transverse skin crease (Lanz) incision</strong> has gained popularity due to improved exposure and ease of extension when necessary. This incision is placed approximately 2 cm below the umbilicus along the midclavicular-midinguinal line, with its length adjusted according to the patient's size and obesity. If required, the incision can be extended medially by retracting or dividing the rectus abdominis muscle (statement 4).</p>\n<p>When there is <strong>uncertainty</strong> in the diagnosis, especially in the presence of <strong>intestinal obstruction</strong>, a <strong>lower midline abdominal incision</strong> is preferred over a right lower paramedian incision.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a8ca8469c8e84b158acc6eb8fe7b48ddx1280x1585.JPEG"
    ]
  },
  {
    "text": "As a surgical resident performing an appendectomy, what is the maximum stump size that you can leave behind in order to prevent stump appendicitis?",
    "choices": [
      {
        "id": 1,
        "text": "1 mm"
      },
      {
        "id": 2,
        "text": "2 mm"
      },
      {
        "id": 3,
        "text": "5 mm"
      },
      {
        "id": 4,
        "text": "4 mm"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The residual appendiceal stump should be no longer than <strong>5 mm</strong>, so as to minimize the possibility of stump appendicitis in the future.</p>\n<p><strong>Stump appendicitis</strong> is a complication that occurs after an appendectomy. It is caused by the <strong>inflammation of the residual appendiceal tissue</strong> after the appendix is removed. The clinical presentation of stump appendicitis is similar to acute appendicitis.</p>\n<p>Factors predisposing for stump appendicitis:</p>\n<ul>\n<li>Inadequate identification of the appendicular base due to severe local inflammation</li>\n<li>Leaving a long stump due to fear of cecal injury or difficult dissection</li>\n<li>Local ulcerations due to fecoliths.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 19-year-old boy is taken up for open appendicectomy. Which of the combinations of the following instruments is best suited for his procedure?",
    "choices": [
      {
        "id": 1,
        "text": "1, 2, 4, 7"
      },
      {
        "id": 2,
        "text": "1, 2, 3"
      },
      {
        "id": 3,
        "text": "1, 4, 6"
      },
      {
        "id": 4,
        "text": "4, 5, 6, 7"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Lane\u2019s tissue holding forceps</strong></p>\n<ul>\n<li>It has got stout and thick distal blades with oval fenestra in each blade</li>\n<li>Apposing tooth in the tip</li>\n<li>Lock in proximal part</li>\n</ul>\n<p><strong>Uses:</strong></p>\n<ul>\n<li>Hold bulky and tough structures, hold lymph nodes.</li>\n</ul>\n<p><strong>Tracheal dilator is used to keep tracheostomy open.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/2f22540bdf204b66a7dcc2c7de9c80b3.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e5168dd52c1146cd8623e922375efdf5x1279x916.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c612b79a569d4467afc96bdaa3bbcc0bx720x720.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9e6d9c6714284b57af9d9f880ad42b36x1280x1666.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a59d1172dd5a4c9ab80fe91cd670b0c0x1279x1022.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6001068b36e642e58a370bec84e1ced3x1280x1431.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a17709f9f80041b081a9cb777470032ax1279x1077.JPEG"
    ]
  },
  {
    "text": "What is the most common post-operative complication that may arise in patients who undergo an appendectomy ?",
    "choices": [
      {
        "id": 1,
        "text": "Wound infection"
      },
      {
        "id": 2,
        "text": "Intra-abdominal abscess"
      },
      {
        "id": 3,
        "text": "Paralytic ileus"
      },
      {
        "id": 4,
        "text": "Adhesive intestinal obstruction"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Wound infection</strong> is the most common postoperative complication of appendectomy.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the most common neoplasm of the appendix ?",
    "choices": [
      {
        "id": 1,
        "text": "Adenocarcinoma"
      },
      {
        "id": 2,
        "text": "Carcinoid"
      },
      {
        "id": 3,
        "text": "Mucinous cystadenoma"
      },
      {
        "id": 4,
        "text": "Adenocarcinoid"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The most common neoplasm primarily identified in the appendix are&nbsp;<strong>carcinoid tumors</strong>.&nbsp;</p>\n<p>They account for approximately 66% of all tumors of the appendix.&nbsp;They are detected in 0.3 to 0.9% of appendectomy specimens.</p>\n<p><strong>Adenocarcinoma</strong> of the appendix is very rare, accounting for 0.5% of all gastrointestinal cancers. The adenocarcinoma malignancies are <strong>three subtypes: </strong></p>\n<ul>\n<li>Mucinous</li>\n<li>Colonic type&nbsp;</li>\n<li>Adenocarcinoid</li>\n</ul>\n<p>Mucinous is the most common subtype whereas Adenocarcinoid is the rarest.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is false about carcinoid tumours of appendix?",
    "choices": [
      {
        "id": 1,
        "text": "Size appears to be the best predictor of malignant behavior and metastatic potential"
      },
      {
        "id": 2,
        "text": "Arise from Kulchitsky cells of the crypts of Lieberk\u00fchn"
      },
      {
        "id": 3,
        "text": "Most common location is the base of the appendix"
      },
      {
        "id": 4,
        "text": "Metastasis is rare"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The most common location of the carcinoid tumour of the appendix is the <strong>tip of the appendix </strong>i.e.,<strong> the distal third </strong>of&nbsp;the appendix.</p>\n<p>A<strong> carcinoid tumour, </strong>also known as&nbsp;<strong>argentaffinoma</strong>,&nbsp;arises in argentaffin tissue (Kulchitsky cells of the crypts of Lieberk&uuml;hn). It often&nbsp;presents with symptoms of <strong>subacute </strong>or<strong> recurrent appendicitis</strong>.</p>\n<p>On gross examination, it is a&nbsp;moderately hard,&nbsp;<strong>yellow tumour</strong> between the intact mucosa and the peritoneum.&nbsp;Microscopically, tumour cells are small, arranged in <strong>small nests within the muscle</strong>, and have a characteristic pattern using immunohistochemical stain for<strong> chromogranin B.&nbsp;</strong></p>\n<p>Carcinoid tumours are the most common appendiceal tumours but they&nbsp;<strong>rarely</strong><strong>&nbsp;metastasize.</strong></p>\n<p>Treatment<strong>&nbsp;</strong>includes <strong>appendicectomy</strong>.&nbsp;Indications for <strong>right hemicolectomy</strong> along with appendectomy are :</p>\n<ul>\n<li>Involvement of the cecal wall</li>\n<li>Tumour is 2 cm or more in size</li>\n<li>Lymph nodes are involved.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 35-year-old female patient is admitted to the hospital for complaints of pain and tenderness in the right iliac fossa. She underwent an appendicectomy. A 2.5 cm tumor was encountered at the base of the appendix which was found to be carcinoid on histopathological examination. What is the next step in management?",
    "choices": [
      {
        "id": 1,
        "text": "No further treatment is required"
      },
      {
        "id": 2,
        "text": "Send the urine for 5- hydroxy indole acetic acid levels"
      },
      {
        "id": 3,
        "text": "Perform right hemicolectomy"
      },
      {
        "id": 4,
        "text": "Add chemotherapy following appendicectomy"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The carcinoid tumors of the appendix which are more than 2 cm in size are treated with <strong>right hemicolectomy</strong>.</p>\n<p>Management of carcinoid tumors:</p>\n<ul>\n<li>&lt;1 cm &ndash; Appendicectomy</li>\n<li>1-2 cms - Appendicectomy or right hemicolectomy depending on the individual tumor characteristics.</li>\n<li><strong>&gt;2 cm &ndash; Right hemicolectomy</strong></li>\n</ul>\n<p>Irrespective of size, it is recommended to perform a right hemicolectomy in:</p>\n<ul>\n<li>Carcinoids at the appendiceal base (&lt;2 cm from the base)</li>\n<li>Lymphatic invasion or lymph node involvement</li>\n<li>Spread to the mesoappendix</li>\n<li>Tumor-positive resection margins</li>\n<li>Cellular pleomorphism with a high mitotic index.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Following an appendectomy, the specimen was sent for HPE. A well-circumscribed, yellowish tumor measuring 0.5 cm in diameter at the tip of the appendix was seen. The stained sections revealed a typical carcinoid tumor of the appendix. The specimen had a tumor-free margin on all sides. The base of the appendix, the mesoappendix, and nodes were not involved. What is the next step of management?",
    "choices": [
      {
        "id": 1,
        "text": "Observation"
      },
      {
        "id": 2,
        "text": "Right hemicolectomy"
      },
      {
        "id": 3,
        "text": "Chemotherapy"
      },
      {
        "id": 4,
        "text": "Radiotherapy"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The size of the carcinoid tumour is 0.5 cm (&lt;1 cm), the margins of the resected specimen are tumour free, and there is no involvement of appendix base, mesoappendix, or lymph nodes. The best management approach here is observation.\u00a0</p>\n<p>Carcinoid tumour may be detected in ~0.5% of appendectomy specimens.\u00a0<strong>Appendectomy</strong> is adequate in the treatment of cases with a <strong>diameter of &lt;1 cm </strong>and in those with a<strong> diameter of 1-2 cm without lymphovascular invasion.</strong></p>\n<p>If a tumour is\u00a0found after appendicectomy<strong>:\u00a0</strong></p>\n<ul>\n<li>If it is an\u00a0<strong>adenocarcinoma</strong>,\u00a0perform\u00a0<strong>right hemicolectomy.</strong></li>\n<li>If it is a\u00a0<strong>carcinoid tumour,</strong> treatment differs according to the tumour size:\n<ul>\n<li>&lt;1 cm \u2013 Observation</li>\n<li>1\u20132 cm \u2013 Right hemicolectomy if a lymphovascular invasion is seen</li>\n<li><strong>&gt;2 cm \u2013 Right hemicolectomy</strong></li>\n</ul>\n</li>\n</ul>\n<p>Right hemicolectomy treatment is indicated even in tumours &lt; 2 cm in case of:</p>\n<ul>\n<li>Tumours localized at the <strong>base</strong> of the appendix</li>\n<li>Invasion of <strong>lymphatic ducts</strong>, <strong>serosa</strong> and <strong>mesoappendix</strong></li>\n<li>Presence of <strong>regional lymph node</strong> metastasis</li>\n<li>Positive surgical margins\u00a0</li>\n<li>Mucin production (mucinous carcinoid tumours)</li>\n<li>High mitotic fast cellular pleomorphism</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 6-year-old presented with right lower quadrant pain and fever for 1 day. An appendicitis was suspected and the patient was prepared for surgery. During the surgery, a normal appendix was found but mesenteric lymph nodes were enlarged. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Yersinia enterocolitica infection"
      },
      {
        "id": 2,
        "text": "E. coli infection"
      },
      {
        "id": 3,
        "text": "MALT"
      },
      {
        "id": 4,
        "text": "Streptococcus infection"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong><em>Yersinia enterocolitica</em></strong> causes inflammation of the terminal ileum, appendix, and cecum, alongwith mesenteric lymphadenopathy. It is the <strong>most common differential diagnosis of acute appendicitis</strong>.&nbsp;</p>\n<p><strong>Acute mesenteric </strong><strong>lymphadenitis</strong>&nbsp;manifests as acute right lower quadrant abdominal pain associated with mesenteric lymph node enlargement and a normal appendix.&nbsp;Diagnosis is made after exploration of the abdomen of a patient suspected of having acute appendicitis, which reveals a normal appendix and enlarged mesenteric lymph nodes.&nbsp;It usually occurs in children and young adults.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A postmenopausal lady diagnosed with mucinous cystadenoma appendix is unwilling for surgery. A few weeks later, she complains of vague abdominal pain and progressive abdominal distension. Ultrasound reveals the presence of ascites. CT reveals a thickened peritoneum, multiple loculated fluid collections, and scalloping of the liver and spleen margin. Which of the following statements is false regarding her condition?",
    "choices": [
      {
        "id": 1,
        "text": "The patient is most likely suffering from disseminated peritoneal carcinomatosis"
      },
      {
        "id": 2,
        "text": "The histology of the appendiceal tumor is an important predictor of survival"
      },
      {
        "id": 3,
        "text": "Cytoreductive surgery with IPHC maybe required for management"
      },
      {
        "id": 4,
        "text": "This condition can also occur in patients with ovarian neoplasms"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario of a patient with mucinous cystadenoma appendix and imaging findings are suggestive of<strong> pseudomyxoma peritonei.\u00a0</strong></p>\n<p>Pseudomyxoma peritonei refers to a condition of<strong> mucinous ascites</strong> arising due to the rupture of a mucinous tumor of appendix or ovary. It most commonly occurs in patients between 40-50 years of age. They are often asymptomatic or present with non-specific complaints like abdominal pain and distension.</p>\n<p>Physical examination may reveal ascites with<strong> non shifting dullness</strong> and rarely, a palpable abdominal mass. CT scan may reveal accumulation of mucinous material and <strong>scalloped indentation of the visceral surfaces</strong> of the liver and spleen. The peritoneal surfaces may be thickened due to the solid components of the tumor. The histology of the primary appendiceal tumor is an important predictor of survival.<br />Management consists of extensive resection of the tumor (<strong>cytoreduction</strong>) and <strong>intraperitoneal heated chemotherapy (IPHC)</strong>. Surgical management may include omentectomy, resection of the peritoneum and involved organs, appendectomy or a right hemicolectomy.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '23 Appendix';
        let hierarchy = ["Marrow", "qBank", "Surgery"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>