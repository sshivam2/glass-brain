<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>34 Paediatric Hemato-Oncology - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Pediatrics
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">24</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Cancer-'The emperor of all maladies spares no one'. Which of the following is the most common childhood malignancy?",
    "choices": [
      {
        "id": 1,
        "text": "Neuroblastoma"
      },
      {
        "id": 2,
        "text": "Astrocytoma"
      },
      {
        "id": 3,
        "text": "Acute lymphoblastic leukemia"
      },
      {
        "id": 4,
        "text": "Acute myeloid leukemia"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Leukemias</strong> are the most common childhood malignancies. Among these,<strong>&nbsp;acute lymphoblastic leukemia (ALL)</strong> is <strong>the most common</strong>, accounting for about 77% of childhood leukemias.&nbsp;</p>\n<p>Most commons in childhood malignancies:</p>\n<ul>\n<li>Second most common malignancy in childhood: Brain tumor</li>\n<li>Third most common malignancy in children: Lymphoma</li>\n<li><strong>Most common</strong> <strong>solid tumor</strong> in children:&nbsp;<strong>Brain tumor</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You are asked to review an article titled, 'Childhood cancers- a menace'. Which of the following statements is wrong and needs to be edited out?",
    "choices": [
      {
        "id": 1,
        "text": "Acute lymphoblastic leukemia is the most common type of leukemia in children with Down syndrome."
      },
      {
        "id": 2,
        "text": "The most common intra-abdominal malignancy is Wilm\u2019s tumor."
      },
      {
        "id": 3,
        "text": "The most common extracranial solid malignancy is neuroblastoma."
      },
      {
        "id": 4,
        "text": "The most common brain tumors in children are infratentorial."
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>most common intraabdominal malignancy</strong> in children is <strong>neuroblastoma</strong>.&nbsp;</p>\n<ul>\n<li>The most common leukemias&nbsp;seen in <strong>Down&rsquo;s syndrome</strong>: acute lymphoblastic leukemia <strong>(ALL) &gt;&nbsp;</strong>acute myeloid leukemia <strong>(AML)</strong></li>\n<li>The most common site of a brain tumor in children:<strong>&nbsp;Infratentorium</strong></li>\n<li>The most common <strong>extra-cranial</strong> solid neoplasm in children:&nbsp;<strong>Neuroblastoma </strong></li>\n<li>The most common <strong>intra-abdominal</strong> neoplasm in children:&nbsp;<strong>Neuroblastoma </strong></li>\n<li>The most common <strong>primary neoplasm of renal tissue</strong> in children:<strong> Wilm&rsquo;s tumor</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the most common leukemia you would encounter in a child with the following findings?",
    "choices": [
      {
        "id": 1,
        "text": "Acute myeloid leukemia"
      },
      {
        "id": 2,
        "text": "Acute lymphoblastic leukemia"
      },
      {
        "id": 3,
        "text": "Chronic myeloid leukemia"
      },
      {
        "id": 4,
        "text": "Chronic lymphoid leukemia"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The image shows a typical Down's facies (flattened nose, flat occiput, low set ears, protruding tongue). The most common leukemia in children with <strong>Down syndrome</strong> is <strong>acute lymphoblastic leukemia (ALL).</strong></p>\n<p>Children with Down syndrome are at<strong> increased risk</strong> of both acute lymphoid leukemia (ALL) and acute myeloid leukemia (AML).</p>\n<p>10% of neonates with Down's syndrome develop<strong> transient leukemia or myeloproliferative disorder</strong>. These features usually resolve within the <strong>first 3 months of life</strong>. However, they require close follow-up, because 20\u201330% will develop <strong>typical leukemia (often acute megakaryocytic leukemia) by 3 years of life.</strong></p>\n<p>Note:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Most common leukemia in Down's syndrome: <strong>B-cell Acute lymphoblastic leukemia</strong> (overall)</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">The most common leukemia in children<strong> &lt;3years</strong> of age with<strong> Down syndrome</strong> is<strong> acute myeloid leukemia (AML).</strong></li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Most common AML in Down's syndrome:<strong> M7/megakaryoblastic</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/845860367ea948d0affb5f5e2cd48976.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Jeevit, a 7-year-old boy brought to you by his mother, complains of bone pain so severe that he cannot sleep. Investigations reveal:",
    "choices": [
      {
        "id": 1,
        "text": "TdT+,HLA DR+,CD20+, Cy Ig +"
      },
      {
        "id": 2,
        "text": "CD19+, CD20+, CD24+, Surface Ig+"
      },
      {
        "id": 3,
        "text": "CD3+, CD4+, CD5+, CD34+"
      },
      {
        "id": 4,
        "text": "CD2+, CD7+, TdT+"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>B-lymphoblastic leukemia(pre-B-ALL)</strong> is the most common immunophenotype with&nbsp;<strong>TdT+,HLA DR+, CD10+, CD19+, CD20+, CD24+, Cy Ig +</strong> , with onset at <strong>1-10 years</strong> of age.</p>\n<p>The most common type of acute lymphoblastic leukemia (ALL) in children is B-lymphoblastic leukemia (previously termed pre-B-ALL)</p>\n<p>Based on current WHO classification: The most common subtype of ALL is <strong>B lymphoblastic leukemia &gt; T lymphoblastic leukemia &gt; Mature B-cell Leukemia (Burkitt leukemia)</strong></p>\n<p>The production of symptoms and signs of ALL is a result of the <strong>replacement of bone marrow by malignant cells</strong> and caused by secondary bone marrow failure. On physical examination, findings of pallor, listlessness, purpuric/petechial skin lesions, or mucous membrane hemorrhage can reflect<strong> bone marrow failure.</strong> The <strong>proliferative nature</strong> of the disease may be manifested as lymphadenopathy, splenomegaly, or, less often, hepatomegaly. At presentation<strong> 75% of patients have leukocyte counts of &lt;20,000/&micro;L</strong>; <strong>thrombocytopenia</strong> is seen in 75% of patients and <strong>hepatosplenomegaly</strong> in 30&ndash;40% of patients. Patients with joint pain may have evidence of<strong> joint swelling and effusion</strong>. <strong>Deep bone pain </strong>may be present with marrow involvement, but <strong>tenderness will not be elicited.</strong></p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You are posted in the pediatric hematology department as a first-year postgraduate. All of the following cases you encounter are at an increased risk of developing leukemias except:",
    "choices": [
      {
        "id": 1,
        "text": "1,4"
      },
      {
        "id": 2,
        "text": "2,5"
      },
      {
        "id": 3,
        "text": "1,3,4"
      },
      {
        "id": 4,
        "text": "5 only"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Fanconi&rsquo;s anemia</strong>&nbsp;(not syndrome) predisposes to the development of childhood leukemias eg: B-ALL due to <strong>defective DNA repair.&nbsp;</strong>Fanconi syndrome is a syndrome of inadequate reabsorption in the proximal renal tubules<strong>. Congenital pernicious anemia</strong> <strong>does not</strong> predispose to leukemias.</p>\n<p>Factors predisposing to childhood leukemias</p>\n<ul>\n<li>Genetic conditions:\n<ul>\n<li><strong>Fanconi&rsquo;s anemia</strong></li>\n<li>Bloom syndrome</li>\n<li><strong>Ataxia telangiectasia</strong></li>\n<li>Li-Fraumeni syndrome</li>\n<li>Down syndrome</li>\n<li><strong>Severe combined immunodeficiency</strong></li>\n<li><strong>Neurofibromatosis 1&nbsp;&nbsp;&nbsp;</strong></li>\n<li>Paroxysmal nocturnal hemoglobinuria</li>\n<li>Diamond-Blackfan anemia</li>\n<li>Schwachman diamond syndrome</li>\n<li>Kostmann syndrome</li>\n</ul>\n</li>\n<li>Environmental factors:\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Ionizing radiation</li>\n<li>Alkylating agents</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Nitrosoureas</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Epipodophyllotoxin</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Benzene exposure</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Advanced maternal age.</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "To diagnose a 5-year-old child with acute lymphoblastic leukemia, a pathologist has to see at least ____ percentage of blast cells in a bone marrow biopsy.",
    "choices": [
      {
        "id": 1,
        "text": "15"
      },
      {
        "id": 2,
        "text": "10"
      },
      {
        "id": 3,
        "text": "25"
      },
      {
        "id": 4,
        "text": "30"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Work-up of ALL:</p>\n<p>It is important that all studies necessary to confirm a diagnosis and adequately classify the type of leukemia be performed, including<strong> bone marrow aspiration</strong> and biopsy, <strong>flow cytometry, cytogenetics, and molecular studies</strong>. The initial evaluation should also include a<strong> CSF examination</strong>. If lymphoblasts are found and the CSF leukocyte count is elevated,<strong> overt CNS or meningeal leukemia</strong> is present. This finding reflects <strong>a poorer stage</strong> and indicates the need for additional CNS and systemic therapies.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/301bd304236f4091b83d20e9cf634f40x357x512.JPEG"
    ]
  },
  {
    "text": "A 4-year-old child who was being evaluated for pancytopenia is diagnosed with acute lymphoblastic leukemia. Which of the following findings would indicate a poor prognosis?",
    "choices": [
      {
        "id": 1,
        "text": "Minimal residual disease>0.01% at the end of induction therapy"
      },
      {
        "id": 2,
        "text": "t(12,21) on cytogenetic study"
      },
      {
        "id": 3,
        "text": "Early B- cell immunophenotype."
      },
      {
        "id": 4,
        "text": "Initial WBC count of 20,000 cells/mm3"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>MRD(Minimal residual disease) is a quantitative estimate of the burden of leukemic cells present in marrow. <strong>MRD&gt;0.01%</strong>at the end of induction <strong>suggests a poorer prognosis</strong>.</p>\n<p>Initial WBC count of &lt;50,000cells/mm3, B-cell immunophenotype and t(12,21) indicate a standard risk(Favourable prognosis)</p>\n<p><strong>Risk-directed therapy is the standard of current ALL treatment</strong> and accounts for:</p>\n<ul>\n<li>Age at diagnosis</li>\n<li>Initial WBC count</li>\n<li>Immunophenotypic and cytogenetic characteristics of blast populations</li>\n<li>The rapidity of early treatment response (i.e., how quickly the leukemic cells can be cleared from the marrow or peripheral blood)</li>\n<li>Assessment of MRD at the end of induction therapy.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 14-year-old boy is rushed to the casualty due to difficulty in breathing and swelling of the face and neck. Clinically, he has features suggestive of superior vena cava obstruction. Chest X-ray image shows superior mediastinal widening. Which of the following is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "B-cell acute lymphoblastic leukemia"
      },
      {
        "id": 2,
        "text": "T-cell acute lymphoblastic leukemia"
      },
      {
        "id": 3,
        "text": "Chronic myeloid leukemia"
      },
      {
        "id": 4,
        "text": "Chronic lymphocytic leukemia"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>T-cell acute lymphoblastic leukemia (T-ALL)</strong> is the most likely diagnosis since the chest X-ray shows <strong>superior mediastinal widening</strong>- indicating an involvement of the<strong> thymus gland.</strong></p>\n<p>T-ALL accounts for about 15% of childhood ALL cases; it is <strong>more common in adolescents</strong> - this is the time when the thymus reaches maximum size.</p>\n<p>60% of patients with T-ALL present with a mediastinal mass. The <strong>mediastinal mass</strong> may be <strong>asymptomatic</strong> and detected only on chest x-ray or may cause cough and dyspnea, particularly on lying flat or with facial swelling and plethora due to vascular compression (<strong>superior vena cava syndrome</strong>).</p>\n<p><strong>B-ALL</strong> presents usually between <strong>1-10 years</strong> of age perhaps because the number of normal bone marrow pre-B-cells (the cell of origin) is greatest very early in life.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 2-month-old infant with seizures and failure to thrive has cutaneous nodules and hepatosplenomegaly. On investigations, CBC reveals hyperleukocytosis with a leukocyte count of 1,10,000cells/mm3. Peripheral smear and immunophenotyping studies reveal large, irregular lymphoblasts, with a phenotype negative for the CD10 (common ALL antigen) marker. On a cytogenetic study which of the following is most likely to be seen?",
    "choices": [
      {
        "id": 1,
        "text": "t(11, 14)"
      },
      {
        "id": 2,
        "text": "t (4,11)"
      },
      {
        "id": 3,
        "text": "t (12,21)"
      },
      {
        "id": 4,
        "text": "t (15,21)"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The above findings are diagnostic of <strong>Infantile acute lymphoblastic leukemia</strong>. Translocation <strong>(4;11) involving the MLL gene</strong> is most commonly associated with Infantile leukemia accounts for the <strong>very high relapse rate.</strong></p>\n<p>2% of cases of leukemia during childhood occur <strong>before the age of 1 year</strong> and are referred to as<strong> infantile leukemia.</strong></p>\n<p>Patients often present with <strong>hyperleukocytosis</strong> and extensive tissue infiltration producing <strong>organomegaly</strong>. <strong>Subcutaneous nodules, known as leukemia cutis</strong>, caused by infiltration by leukemic cells are observed more often in infants than in older children.&nbsp;</p>\n<p>The leukemic cell morphology is usually that of large, irregular lymphoblasts, with a<strong> phenotype negative for the CD10 (common ALL antigen) marker</strong> (pro-B), unlike most older children with B-ALL, who are CD10 +. Has a very poor prognosis.</p>\n<p><strong>Note:</strong></p>\n<p><strong>Infants with AML</strong> present with CNS and skin involvement and most commonly have a subtype known as <strong>acute myelomonocytic leukemia.</strong></p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A mother has noticed recently that her child refuses to be touched, seems to be in distress, and cries inconsolably. She brings her child to you who was investigated thoroughly and was diagnosed to have acute lymphoblastic leukemia. Which of the following drugs can be used to treat her?",
    "choices": [
      {
        "id": 1,
        "text": "Imatinib"
      },
      {
        "id": 2,
        "text": "L-asparaginase"
      },
      {
        "id": 3,
        "text": "Tretinoin"
      },
      {
        "id": 4,
        "text": "Cladribine"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>L-asparaginase</strong> is used in the treatment of acute lymphoid leukaemia (<strong>ALL</strong>)<strong>. </strong>ALL can present with hepatosplenomegaly, severe joint and bone pains that the kid refuses to be handled.<strong><br /></strong></p>\n<p>It is observed that some lymphoid malignancies are <strong>unable to synthesize asparagine</strong> on their own and must derive it from the bloodstream. L-asparaginase catalyses circulating L-asparagine, thereby <strong>inhibiting protein synthesis</strong> in the cancer cells.</p>\n<p><strong>Treatment of ALL</strong></p>\n<ul>\n<li><strong>Induction: </strong>4 weeks\n<ul>\n<li>L-asparaginase: single dose (side effects: pancreatitis, thrombosis)</li>\n<li>Vincristine: weekly (side effects: neuropathy, SIADH)</li>\n<li>Prednisolone</li>\n<li>Anthracycline</li>\n</ul>\n</li>\n<li><strong>CNS prophylaxis- intrathecal methotrexate</strong></li>\n<li><strong>Consolidation:</strong>&nbsp;\n<ul>\n<li>Methotrexate</li>\n<li>Epipodophyllotoxin</li>\n<li>Cyclophosphamide</li>\n<li>Cytosine-Arabinoside</li>\n</ul>\n</li>\n<li><strong>Maintenance:</strong>&nbsp;24-36 months\n<ul>\n<li>6-Mercaptopurine</li>\n<li>Methotrexate</li>\n</ul>\n</li>\n</ul>\n<p><strong>Other options:</strong></p>\n<ul>\n<li>Imatinib is a tyrosine kinase inhibitor used to treat chronic myeloid leukemia and acute lymphoblastic leukemia with t(9;22) BCR-ABL fusion gene.</li>\n<li>Tretinoin is used in acute promyelocytic leukaemia with t(15;17) PML-RARA fusion gene.</li>\n<li>Cladribine is used in hairy cell leukaemia.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You are posted in the hematology department as a pathologist.  You are asked to report the bone marrow biopsy slide given below, which belongs to a 3-year-old child who is being evaluated for pancytopenia. To make a diagnosis of acute myeloid leukemia, what percentage of such cells should you visualize at the least?",
    "choices": [
      {
        "id": 1,
        "text": "10"
      },
      {
        "id": 2,
        "text": "20"
      },
      {
        "id": 3,
        "text": "25"
      },
      {
        "id": 4,
        "text": "30"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Diagnosis of&nbsp;<strong>acute myeloid leukemia (AML)</strong> is confirmed by the presence of <strong>more than 20% myeloblast cells&nbsp;</strong>(as shown in the image)<strong> in the bone marrow.</strong></p>\n<p>Flow cytometry and special stains can be used to identify myeloperoxidase-containing cells, which confirms the myelogenous origin of leukemia.</p>\n<p><strong>Note:</strong></p>\n<p>The diagnosis of <strong>acute lymphoid leukemia (ALL)</strong> requires the presence of more than <strong>25% blasts</strong> in the bone marrow.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/47200b3688514887801154c31d899c7c.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 3-year-old boy was brought to the pediatric OPD with complaints of persistent fever for the past 1 week. His CBC is given below:",
    "choices": [
      {
        "id": 1,
        "text": "t(8;21)"
      },
      {
        "id": 2,
        "text": "t(15;17)"
      },
      {
        "id": 3,
        "text": "Inv 16"
      },
      {
        "id": 4,
        "text": "Monosomy 7"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Monosomy 7</strong> is associated with a\u00a0<strong>poor</strong><strong>\u00a0prognosis</strong>\u00a0in patients with acute myeloid leukemia (<strong>AML</strong>).</p>\n<p>The production of symptoms and signs of AML is a result of the replacement of bone marrow by malignant cells and caused by secondary bone marrow failure-pallor, fatigue, exercise intolerance, bruising, oral mucosal bleeding, or epistaxis, as well as fever, which may be caused by infection or the disease.</p>\n<p>In addition, patients with AML present with signs and symptoms that are uncommon in Acute lymphoblastic leukemia, including subcutaneous nodules or<strong>\u201cblueberry muffin\u201d lesions</strong> (especially in infants),<strong> infiltration of the gingiva</strong> (especially in monocytic subtypes), signs and laboratory findings of <strong>disseminated intravascular coagulation</strong> (especially indicative of acute promyelocytic leukemia), and discrete masses, known as <strong>chloromas or granulocytic sarcomas.</strong></p>\n<p>Prognostic implications of chromosomal abnormalities in AML are given below:</p>\n<table style=\"width: 281.153px;\">\n<tbody>\n<tr>\n<td style=\"width: 286.153px;\">\n<p>Favorable prognosis</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 286.153px;\">\n<ul>\n<li>t(8;21); RUNX1-RUNX1T1</li>\n<li>Inv(16) or t(16;16); CBF\u03b2</li>\n<li><em>NPM1</em> mutation</li>\n<li><em>CEBPA</em> mutation</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td style=\"width: 286.153px;\">\n<p>Poor prognosis</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 286.153px;\">\n<ul>\n<li>inv(3)\u00a0</li>\n<li>t(6;9)</li>\n<li>5q-</li>\n<li>del(7q)</li>\n<li>complex karyotype (\u22653 abnormalities)</li>\n<li>Monosomy7</li>\n</ul>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A child with a violaceous, raised nodular skin lesion which on biopsy is found to be infiltrated by myeloblasts is likely suffering from which type of Acute myeloid leukemia (AML)?",
    "choices": [
      {
        "id": 1,
        "text": "AML M2"
      },
      {
        "id": 2,
        "text": "AML M3"
      },
      {
        "id": 3,
        "text": "AML M7"
      },
      {
        "id": 4,
        "text": "AML M1"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Nodular, violaceous skin lesion infiltrated with myeloblasts is descriptive of Chloroma otherwise known as <strong>extramedullary myeloblastoma or granulocytic(myeloid) sarcoma</strong>. Myeloid sarcomas are seen in AML subtypes<strong> M2, M4, M5a, and M5b.</strong></p>\n<p>&ldquo;Chloroma&rdquo; was coined due to the peculiar green color of the tumor caused by myeloperoxidase present in tumor cells.</p>\n<p>These masses can occur in the absence of apparent bone marrow involvement and typically are associated with t(8;21) translocation. Chloromas also may be seen in the orbit and epidural space.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Erythemic myelosis is ______.",
    "choices": [
      {
        "id": 1,
        "text": "AML M2"
      },
      {
        "id": 2,
        "text": "AML M5"
      },
      {
        "id": 3,
        "text": "AML M7"
      },
      {
        "id": 4,
        "text": "AML M6"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Erythemic myelosis is <strong>AML M6</strong>.</p>\n<p>Constitute about 1% of AML cases</p>\n<p>Two subtypes of AML M6:<strong><br /></strong></p>\n<ul>\n<li>Erythroid or myeloid leukemia: M6a (more common)</li>\n<li>Pure erythroid leukemia: M6b, also called erythemic myelosis<strong> (Di Guglielmo disease).</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A neonate with trisomy 21 has anemia, petechiae, hepatosplenomegaly, and no life-threatening complications on examination.CBC reveals high leucocyte count and peripheral smear shows numerous myeloblasts. The genetic makeup of blast cells when studied reveals GATA-1 mutations. At 3 months of age, his CBC counts come back to normal and there are no blast cells in his peripheral smear. As his treating physician, what would you recommend?",
    "choices": [
      {
        "id": 1,
        "text": "Chemotherapy"
      },
      {
        "id": 2,
        "text": "Radiotherapy"
      },
      {
        "id": 3,
        "text": "Bone marrow transplant"
      },
      {
        "id": 4,
        "text": "A close follow-up"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>This infant has a&nbsp;<strong>transient myeloproliferative disease,</strong> which usually <strong>resolves spontaneously</strong> in the first&nbsp;3 months of life, and <strong>they require close-follow up because</strong>&nbsp;20&ndash;30% will develop typical leukemia (<strong>acute megakaryocytic leukemia</strong>) by 3 years of life.</p>\n<p>Approximately 10% of neonates with Down syndrome develop transient leukemia or myeloproliferative disorder characterized by high leukocyte counts, blast cells in the peripheral blood, and associated anemia, thrombocytopenia, and hepatosplenomegaly. These features usually resolve within the first 3 months of life. Although these neonates can require temporary transfusion support, they do not require chemotherapy unless there is evidence of life-threatening complications.</p>\n<p>As only 20-30% of such children develop acute megakaryocytic leukemia a bone marrow transplant would be a drastic step in our case.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An 18-month-old child presents to the pediatric OPD with complaints of fever and rashes for the past 1 week after extensive workup gets diagnosed as Juvenile chronic myeloid leukemia. Which of the following findings is not consistent with this baby\u2019s diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "The genetic study may reveal NF-1 mutation"
      },
      {
        "id": 2,
        "text": "The presence of Philadelphia chromosome on FISH"
      },
      {
        "id": 3,
        "text": "The bone marrow shows a myelodysplastic pattern with <20% blasts."
      },
      {
        "id": 4,
        "text": "The peripheral smear reveals nucleated RBCs"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Patients with juvenile myelomonocytic leukemia do not have the Philadelphia chromosome.</p>\n<p>Formerly termed <strong>juvenile chronic myeloid leukemia (CML)</strong>, it is a clonal proliferation of hematopoietic stem cells that typically affects <strong>children younger than 2 years </strong>of age. Patients with JMML present with rashes, lymphadenopathy, splenomegaly, and hemorrhagic manifestations.</p>\n<p>Patients with this disease <strong>do not have the Philadelphia chromosome</strong> (the Philadelphia chromosome is characteristic of CML). The peripheral blood smear shows an elevated leukocyte count with increased monocytes, thrombocytopenia, and anemia with the <strong>presence of erythroblasts</strong>. Bone marrow shows a myelodysplastic pattern, with blasts accounting for &lt;20% of cells. Patients with <strong>neurofibromatosis type 1 </strong>and <strong>Noonan syndrome</strong> have a predilection for this type of leukemia.</p>\n<p>JMML in the <strong>setting of Noonan syndrome</strong> is unique, with most patients having a <strong>spontaneous resolution.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The most common non-Hodgkin's lymphoma in children is _____________.",
    "choices": [
      {
        "id": 1,
        "text": "B-cell acute lymphoblastic leukemia (B-ALL)"
      },
      {
        "id": 2,
        "text": "Mantle cell lymphoma"
      },
      {
        "id": 3,
        "text": "Diffuse large B-cell lymphoma (DLBCL)"
      },
      {
        "id": 4,
        "text": "Burkitt lymphoma"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Burkitt lymphoma</strong> is the most common non-Hodgkin's lymphoma in <strong>children</strong> under the age of 15 years.</p>\n<p>Diffuse large B-cell lymphoma (DLBCL) is the most common form of non-Hodgkin lymphoma (NHL) in adults and adolescents (15-19) years, worldwide.</p>\n<p>B-cell acute lymphoblastic leukemia (B-ALL) is the most common childhood malignancy&nbsp;and the most common leukemia in children. (It is not a non-Hodgkin's lymphoma).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements best describe the behavior of Non-Hodgkin lymphoma in a 10-year-old child?",
    "choices": [
      {
        "id": 1,
        "text": "Is dominantly nodal"
      },
      {
        "id": 2,
        "text": "Is of high grade and aggressive"
      },
      {
        "id": 3,
        "text": "Has variable growth fraction"
      },
      {
        "id": 4,
        "text": "Has poor outcome"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In contrast to adult non-Hodgkin's lymphoma (NHL), which is typically indolent, <strong>pediatric NHL </strong>is<strong> usually high-grade </strong>and <strong>aggressive.</strong></p>\n<p>NHL in the pediatric age group has distinct clinical and behavior properties when compared to adults. These include the following:</p>\n<table style=\"width: 330.503px;\">\n<tbody>\n<tr>\n<td style=\"width: 170px;\">\n<p><strong>NHL in adults</strong></p>\n</td>\n<td style=\"width: 148.503px;\">\n<p><strong>NHL in children</strong></p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 170px;\">\n<p><strong>Low/intermediate grade</strong></p>\n</td>\n<td style=\"width: 148.503px;\">\n<p><strong>High grade</strong></p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 170px;\">\n<p>Dominantly nodal</p>\n</td>\n<td style=\"width: 148.503px;\">\n<p>Extra-nodal</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 170px;\">\n<p>Variable growth fraction</p>\n</td>\n<td style=\"width: 148.503px;\">\n<p>High growth fraction</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 170px;\">\n<p>Poor long-term outcome</p>\n</td>\n<td style=\"width: 148.503px;\">\n<p>Good outcome</p>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 6-year-old boy is brought with complaints of abdominal distension, fatigue, and night sweats for the past 4 months. He also has a 2-month history of postprandial fullness and recurrent non-bilious vomiting. On examination, he is pale, has hepatosplenomegaly and shifting dullness. A CT scan shows mesenteric and retroperitoneal lymph node enlargement. A biopsy specimen of the mesenteric lymph node reveals tumor cells with high mitotic index and starry sky pattern. The cytogenetic study revealed t(8;14).To stage the disease, which of the following systems would you use?",
    "choices": [
      {
        "id": 1,
        "text": "Ann-Arbor staging"
      },
      {
        "id": 2,
        "text": "Binet staging"
      },
      {
        "id": 3,
        "text": "St Jude staging"
      },
      {
        "id": 4,
        "text": "RAI staging"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Retroperitoneal and mesenteric lymphadenopathy</strong> with hepatosplenomegaly, anemia, and short duration of disease, point towards a diagnosis of lymphoid neoplasms.The classic translocation of <strong>t(8;14)</strong> and <strong>starry sky appearance</strong> with a high mitotic index on HPE point toward a diagnosis of <strong>Burkitt lymphoma</strong>. Burkitt&rsquo;s lymphoma is the <strong>most common type of Non-Hodgkin lymphoma</strong> worldwide. <strong>St Jude system of staging</strong> is used for staging childhood non-Hodgkin lymphoma.</p>\n<table style=\"height: 202px; width: 448.3958435058594px;\">\n<tbody>\n<tr>\n<td style=\"width: 229px;\">\n<p><strong>Disease</strong></p>\n</td>\n<td style=\"width: 218.39584350585938px;\">\n<p><strong>System of staging</strong></p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 229px;\">\n<p>Hodgkin lymphoma</p>\n</td>\n<td style=\"width: 218.39584350585938px;\">\n<p>Ann&ndash;Arbor staging</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 229px;\">\n<p><strong>Non-Hodgkin Lymphoma</strong></p>\n</td>\n<td style=\"width: 218.39584350585938px;\">\n<p><strong>St Jude(Murphy) staging<br /></strong></p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 229px;\">\n<p>Chronic lymphoid leukemia</p>\n</td>\n<td style=\"width: 218.39584350585938px;\">\n<p>Rai staging<br />Binet staging</p>\n</td>\n</tr>\n</tbody>\n</table>\n<p>The current revised staging system used for NHL is the <strong>International Pediatric Non-Hodgkin Lymphoma Staging System (IPNHLSS)</strong> which reflects our increasing ability to diagnose lower levels of organ involvement with disease. For instance, the older staging system (St. Jude/Murphy classification) did not account for molecular or flow cytometry involvement of bone marrow, which is now reflected in the new system.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A lymph node biopsy of a 9-year-old child with cervical lymphadenopathy showed the following picture. The diagnosis is_____.",
    "choices": [
      {
        "id": 1,
        "text": "Burkitt Lymphoma"
      },
      {
        "id": 2,
        "text": "Hodgkin's  disease"
      },
      {
        "id": 3,
        "text": "Acute lymphoblastic leukemia"
      },
      {
        "id": 4,
        "text": "Chloroma"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In the picture given above,&nbsp;<strong>Reed&ndash;Sternberg (RS) cells are seen, which is a pathognomonic feature of Hodgkin's lymphoma (HL).</strong></p>\n<p>Reed&ndash;Sternberg cells are<strong> large and either multinucleated or have a bilobed nucleus </strong>(thus resembling an \"owl's eye\" appearance) with prominent eosinophilic inclusion-like nucleoli. The RS cell is clonal in origin and <strong>arises from the germinal center B cells </strong>but typically has lost most B-cell gene expression and function.</p>\n<p>Hodgkin lymphoma encompasses a group of lymphoid neoplasms that typically arise in a signal node or chain of nodes and spread first to anatomically contiguous sites.</p>\n<p><strong>WHO classification of Hodgkin lymphoma</strong> includes 5 subtypes namely;</p>\n<ol>\n<li>Nodular sclerosis</li>\n<li>Mixed cellularity</li>\n<li>Lymphocyte-rich</li>\n<li>Lymphocyte depletion</li>\n<li>Nodular lymphocyte predominance</li>\n</ol>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/8907ea56731742cc83ce8b076042ff73.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/fbddaab65116410683fdef610e8e907ex510x619.GIF"
    ]
  },
  {
    "text": "A 12- year-old female comes to you with a flu-like illness and left supraclavicular swelling of uncertain nature. Her chest X-ray shows left mediastinal enlargement. CT scan of the chest and abdomen reveals the presence of enlarged lymph nodes in the neck, mediastinum, and liver, and an FDG-PET/CT scan shows multiple scattered consolidation lesions involving also the bones. The diagnosis of classical Hodgkin\u2019s lymphoma, nodular sclerosis subtype, is made on cervical lymph node biopsy. According to Ann-Arbor's staging system, how will you stage her disease?",
    "choices": [
      {
        "id": 1,
        "text": "2"
      },
      {
        "id": 2,
        "text": "1"
      },
      {
        "id": 3,
        "text": "4"
      },
      {
        "id": 4,
        "text": "3"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The clinical vignette describes<strong> Hodgkin&rsquo;s lymphoma</strong> with the involvement of <strong>liver and bone marrow</strong>, which is classified as<strong> Stage 4 </strong>according to Ann-Arbor staging.</p>\n<p>Ann Arbor Staging of Hodgkin&rsquo;s Lymphoma</p>\n<table>\n<tbody>\n<tr>\n<td width=\"63\">\n<p>Stage I</p>\n</td>\n<td width=\"369\">\n<p>Involvement of a <strong>single</strong> lymph node (I) or Lymphoid structure(eg: spleen, thymus, Waldyer's ring)</p>\n</td>\n</tr>\n<tr>\n<td width=\"63\">\n<p>Stage II</p>\n</td>\n<td width=\"369\">\n<p>Involvement of 2 or more lymph node regions on the <strong>same side of the diaphragm</strong>&nbsp;&nbsp;</p>\n</td>\n</tr>\n<tr>\n<td width=\"63\">\n<p>Stage III</p>\n</td>\n<td width=\"369\">\n<p><strong>Involvement of lymph node regions or lymphoid structures on both sides of the </strong><strong>diaphragm (III)</strong></p>\n</td>\n</tr>\n<tr>\n<td width=\"63\">\n<p>Stage IV</p>\n</td>\n<td width=\"369\">\n<p><strong>Involvement of extranodal site beyond that designated as 'E'</strong></p>\n<p><strong>More than one extranodal deposit at any location</strong></p>\n<p><strong>Any involvement of liver or bone marrow</strong></p>\n</td>\n</tr>\n<tr>\n<td width=\"63\">\n<p>A</p>\n</td>\n<td width=\"369\">\n<p>No symptoms</p>\n</td>\n</tr>\n<tr>\n<td width=\"63\">B</td>\n<td width=\"369\">\n<p>The presence of fever &gt;38&deg;C (100.4&deg;F) for 3 consecutive days</p>\n<p>Recurrent drenching night sweats</p>\n<p>Unexplained loss of &gt;10% of body weight in the 6 months&nbsp;</p>\n</td>\n</tr>\n<tr>\n<td width=\"63\">E</td>\n<td width=\"369\">&nbsp;Localized, solitary involvement of extra lymphatic tissue, excluding liver and bone marrow</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The following parameter in ALL indicate a poor prognosis ________.",
    "choices": [
      {
        "id": 1,
        "text": "Age >10 years"
      },
      {
        "id": 2,
        "text": "Leukocyte count <50,000/mm3"
      },
      {
        "id": 3,
        "text": "Hyperdiploidy"
      },
      {
        "id": 4,
        "text": "Trisomy of chromosomes 4, 10, and 17"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Age &gt;10 years</strong> indicates a poor prognosis in ALL.</p>\n<p>Leukocyte count &lt;50,000/mm3, hyperdiploidy, and trisomy of chromosomes 4,10,17 indicate a good prognosis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Sanctuary sites of acute lymphoblastic leukemia are______.",
    "choices": [
      {
        "id": 1,
        "text": "Central nervous system"
      },
      {
        "id": 2,
        "text": "Testis"
      },
      {
        "id": 3,
        "text": "Both A and B"
      },
      {
        "id": 4,
        "text": "None of the above"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Both CNS and testis are considered as sanctuary sites of acute lymphoblastic leukemia (ALL).</p>\n<ul>\n<li>A sanctuary site is an area of the body that is <strong>poorly penetrated by pharmacological agents&nbsp;</strong>and, therefore, serves as a place in which tumor cells or infectious organisms can escape the effects of drug therapy.</li>\n<li><strong>Early institution of CNS prophylaxis&nbsp;</strong>(intrathecal methotrexate) is essential to eradicate these escaped leukemic cells.</li>\n<li>Testicular involvement is rarely evident at diagnosis, testicular involvement can present as painless testicular enlargement.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 4-year-old boy presents with pancytopenia and hepatosplenomegaly. Bony tenderness is also present. He is most likely suffering from the following type of ALL_____.",
    "choices": [
      {
        "id": 1,
        "text": "B cell"
      },
      {
        "id": 2,
        "text": "T cell"
      },
      {
        "id": 3,
        "text": "Both B and T cell"
      },
      {
        "id": 4,
        "text": "None of the above"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>B-cell lymphoblastic leukemia (L1)</p>\n<ul>\n<li>This is the <strong>most common</strong> immunophenotype of acute lymphocytic leukemia (ALL) in a child between the ages of <strong>1-10 years</strong>.</li>\n<li>They present with features of bone marrow failure and organ infiltration such as <strong>pancytopeni</strong>a and <strong>hepatosplenomegaly</strong>, respectively, so <strong>B-cell ALL</strong> is the most likely diagnosis.</li>\n<li>Bony tenderness may be present due to sub-periosteal infiltration of lymphoblastic cells.</li>\n<li>T-cell ALL (L2) typically presents in adolescent boys with a large anterior mediastinal mass (thymus or mediastinal lymph nodes), causing respiratory distress or superior vena cava obstruction.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '34 Paediatric Hemato-Oncology';
        const quizFilename = '34-paediatric-hemato-oncology-8a4cbeed.html';
        let hierarchy = ["Marrow", "qBank", "Pediatrics"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>