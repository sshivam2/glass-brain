<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>29 Hepatic Disorders And Infections In Pregnancy - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Obstetrics & Gynecology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">25</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following is not true regarding obstetric cholestasis?",
    "choices": [
      {
        "id": 1,
        "text": "Pruritus is worse at night"
      },
      {
        "id": 2,
        "text": "Serum bilirubin >5 mg/dl"
      },
      {
        "id": 3,
        "text": "Pruritus usually develops in the third trimester"
      },
      {
        "id": 4,
        "text": "Aspartate transaminase <200 IU /L"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Obstetric cholestasis</strong> is a condition in which cholestasis occurs in pregnancy.&nbsp;<strong>Serum bilirubin</strong> increases very late in the disease and total plasma concentrations<strong> rarely exceed 5 mg/dL</strong>.&nbsp;</p>\n<p>Hyperbilirubinemia results from the retention of conjugated pigment.&nbsp;</p>\n<p>It is also referred to as recurrent jaundice of pregnancy, cholestatic hepatosis, and icterus gravidarum.&nbsp;There is a significant genetic influence.&nbsp;It may be more common in <strong>multifetal pregnancies.</strong></p>\n<p>Patients present with <strong>pruritus</strong>&nbsp;that develops usually during the<strong> third trimester,</strong> typically involving the&nbsp;<strong>palms and soles</strong>. It&nbsp;is <strong>worse at night</strong>. Icterus may also be present.</p>\n<table style=\"height: 135px;\" width=\"455\">\n<tbody>\n<tr>\n<td style=\"width: 177.867px;\">\n<p><strong>Disorder</strong></p>\n</td>\n<td style=\"width: 127.683px;\"><strong>AST (SGOT) U/L</strong></td>\n<td style=\"width: 125.45px;\"><strong>Bilirubin (mg/dL)</strong></td>\n</tr>\n<tr>\n<td style=\"width: 177.867px;\">Cholestasis of pregnancy</td>\n<td style=\"width: 127.683px;\"><strong>Up to 200</strong></td>\n<td style=\"width: 125.45px;\">1&ndash;5</td>\n</tr>\n<tr>\n<td style=\"width: 177.867px;\">Acute fatty liver of pregnancy</td>\n<td style=\"width: 127.683px;\">200&ndash;800</td>\n<td style=\"width: 125.45px;\">4&ndash;10</td>\n</tr>\n<tr>\n<td style=\"width: 177.867px;\">Hepatitis</td>\n<td style=\"width: 127.683px;\">2000+</td>\n<td style=\"width: 125.45px;\">5&ndash;20</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A woman at 34 weeks of gestation presents with severe itching over her palms and soles for 2 weeks. She gives a history of similar complaints in her last pregnancy. On examination, she is icteric. Which of the following is the preferred investigation to diagnose this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Serum bile acid"
      },
      {
        "id": 2,
        "text": "Serum bilirubin"
      },
      {
        "id": 3,
        "text": "Alanine amino transferase"
      },
      {
        "id": 4,
        "text": "5' nucleosidase"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical picture is suggestive of <strong>cholestasis in pregnancy</strong>. <strong>Serum bile acid</strong>&nbsp;is the <strong>earliest </strong>and<strong> most consistent</strong> parameter to increase in obstetric cholestasis.</p>\n<p><strong>Serum cholic acid</strong> is preferred compared to serum chenodeoxycholic acid.</p>\n<p>Although <strong>serum bile acid</strong> increases after meals it is still considered an important investigation among women with obstetric cholestasis. This is because serum bile acid levels <strong>remain significantly elevated</strong> in women with&nbsp;<strong>obstetric cholestasis</strong> in comparison to pregnant women without it.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A food critic at 32 weeks of gestation presents with nausea and mild right upper abdominal pain. She also gives a history of itching over palms and soles for 2 weeks. On examination, she is icteric. Investigations done are shown below. What is the preferred treatment in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Antihistamines + nutritional support"
      },
      {
        "id": 2,
        "text": "Antiviral therapy"
      },
      {
        "id": 3,
        "text": "Ursodeoxycholic acid"
      },
      {
        "id": 4,
        "text": "Cholestyramine"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given scenario is suggestive of <strong>obstetric cholestasis</strong>. <strong>Ursodeoxycholic acid</strong> is the drug of choice in obstetric cholestasis.</p>\n<p>It relieves pruritus, lowers bile acid and serum enzyme levels (like SGOT, ALP). It may also reduce certain neonatal complications such as preterm birth, fetal distress, and respiratory distress syndrome.</p>\n<p>Antihistamines and topical emollients<strong>&nbsp;</strong>may provide some relief.&nbsp;</p>\n<p><strong>Cholestyramine</strong> causes decreased absorption of fat-soluble vitamins, which leads to <strong>vitamin K deficiency</strong>. Fetal coagulopathy may develop, which may lead to<strong> intracranial hemorrhage and stillbirth</strong>, and therefore it is <strong>not preferred.</strong></p>\n<div class=\"ng-scope\">\n<div class=\"ng-scope\">\n<table width=\"455\">\n<tbody>\n<tr>\n<td>\n<p><strong>Disorder</strong></p>\n</td>\n<td><strong>AST (SGOT) U/L</strong></td>\n<td><strong>Bilirubin (mg/dL)</strong></td>\n</tr>\n<tr>\n<td>Cholestasis of pregnancy</td>\n<td>Up to 200</td>\n<td>1&ndash;5</td>\n</tr>\n<tr>\n<td>Acute fatty liver of pregnancy</td>\n<td>200&ndash;800</td>\n<td>4&ndash;10</td>\n</tr>\n<tr>\n<td>Hepatitis</td>\n<td>2000+</td>\n<td>5&ndash;20</td>\n</tr>\n</tbody>\n</table>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following features are not likely to be seen in a patient with acute fatty liver of pregnancy?",
    "choices": [
      {
        "id": 1,
        "text": "Only 1"
      },
      {
        "id": 2,
        "text": "2 & 4"
      },
      {
        "id": 3,
        "text": "3, 4 & 5"
      },
      {
        "id": 4,
        "text": "1, 3 & 4"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Hyperglycemia, hypercholesterolemia, and thrombocytosis are not likely to be seen in acute fatty liver of pregnancy (AFLP).&nbsp;</p>\n<p><strong>Clinical features of AFLP</strong> include:<strong><br /></strong></p>\n<ul>\n<li>Persistent nausea and vomiting</li>\n<li>Progressive jaundice</li>\n<li><strong>Hypoglycemia</strong></li>\n<li>Hypertension</li>\n<li>Proteinuria</li>\n<li>Edema</li>\n<li><strong>Thrombocytopenia</strong></li>\n<li>Moderate to severe liver dysfunction - manifested by:\n<ul>\n<li><strong>Hypofibrinogenemia</strong></li>\n<li>Hypoalbuminemia</li>\n<li><strong>Hypocholesterolemia</strong></li>\n<li><strong>Prolonged clotting time.</strong></li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A woman at 37 weeks of gestation with icterus, nausea, and yellowish discoloration of urine has abnormal liver function tests. She is suspected to have acute fatty liver of pregnancy. Which of the following is false regarding this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Symptoms improve post delivery"
      },
      {
        "id": 2,
        "text": "More common in first pregnancy"
      },
      {
        "id": 3,
        "text": "Associated with female fetus"
      },
      {
        "id": 4,
        "text": "Occurs due to  heterozygous defect for fatty acid oxidation"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Acute fatty liver of pregnancy</strong> (AFLP) is more commonly associated with <strong>male fetuses</strong> and not female fetuses.</p>\n<p>AFLP is a rare, potentially fatal complication also known as acute fatty metamorphosis or acute yellow atrophy. It is\u00a0more common in the <strong>third trimester</strong><strong>.\u00a0</strong>It is<strong>\u00a0</strong>due to a defect in the long-chain-3-hydroxy acyl-CoA-dehydrogenase <strong>(LCHAD) pathway</strong>.</p>\n<p>It is also\u00a0associated with:</p>\n<ul>\n<li><strong>First pregnancy\u00a0</strong>-\u00a0uncommon in subsequent pregnancies</li>\n<li>Maternal obesity</li>\n<li><strong>Multiple pregnancies</strong></li>\n</ul>\n<div class=\"ng-scope\">\n<div class=\"ng-scope\">\n<p>Investigations:</p>\n<ul>\n<li>Liver function tests such as AST, ALT, and serum bilirubin levels are raised.</li>\n<li>Hemolysis with coagulopathy:\n<ul>\n<li>Decreased platelets and fibrinogen</li>\n<li>Elevated d-dimers and prothrombin time</li>\n</ul>\n</li>\n<li>Biopsy reveals a characteristic<strong> microvesicular fatty infiltration</strong>.</li>\n</ul>\n<p>The definitive management of AFLP is <strong>rapid delivery of the fetus</strong> and supportive care.\u00a0Hepatic dysfunction usually <strong>normalizes</strong> within a week of delivery.\u00a0</p>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following will not increase the risk for urinary tract infection in pregnant women?",
    "choices": [
      {
        "id": 1,
        "text": "Diabetes"
      },
      {
        "id": 2,
        "text": "Hypertension"
      },
      {
        "id": 3,
        "text": "Sickle cell anaemia"
      },
      {
        "id": 4,
        "text": "Vesicoureteric reflux"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Hypertension is not a risk factor for urinary infections in pregnancy.&nbsp;</p>\n<p>Risk factors for urinary infections in pregnancy include:</p>\n<ul>\n<li>Urinary retention</li>\n<li><strong>Vesicoureteric reflux</strong> of pregnancy</li>\n<li><strong>Diabetes</strong> in pregnancy</li>\n<li><strong>Sickle cell anemia</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A G3P2 lady at 13 weeks of gestation presented for a regular antenatal checkup. A urine routine revealed the presence of 2,00,000 gram-negative bacilli/mL. Repeat urinalysis showed the following results. Which of the following is not true about this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Incidence is similar to that in non pregnant women"
      },
      {
        "id": 2,
        "text": "It is higher in people with sickle cell trait"
      },
      {
        "id": 3,
        "text": "Antibiotic therapy is required only if symptoms develop"
      },
      {
        "id": 4,
        "text": "There is risk of developing chronic renal lesions"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario is suggestive of <strong>asymptomatic bacteriuria. Antibiotic therapy</strong> should be given regardless of the symptoms.&nbsp;</p>\n<p>Asymptomatic bacteriuria<strong>&nbsp;</strong>refers to persistent, actively multiplying bacteria within the&nbsp;urinary tract in asymptomatic women.</p>\n<p>Organisms that cause urinary infections are those from the normal perineal flora. The most common causative agent is <strong><em>E.coli.</em> </strong>Others include&nbsp;<em>Klebsiella, </em>and<em> Proteus</em>.</p>\n<p><strong>Incidence</strong> is <strong>similar</strong> to that in <strong>non-pregnant</strong> women. Prevalence depends on parity (more in higher parity), race, socioeconomic status (more in low SES).</p>\n<p>It is more common in<strong>&nbsp;</strong>patients with sickle cell anemia/trait, diabetes. There is a <strong>high risk </strong>of developing<strong> chronic renal lesions</strong> in later life.&nbsp;</p>\n<p>It is also associated with:</p>\n<ul>\n<li>Hypertension</li>\n<li>Anemia</li>\n<li>Premature labor</li>\n<li>Intrauterine growth retardation</li>\n<li>Urinary tract abnormalities in recurrent cases.</li>\n</ul>\n<p>Diagnostic criteria:</p>\n<ul>\n<li>A&nbsp;<strong>positive bacterial count</strong> of the same species -&nbsp;<strong>over 1,00,000/mL </strong></li>\n<li>Organisms in midstream clean-catch specimen of urine on two occasions</li>\n<li>No symptoms of urinary infection</li>\n</ul>\n<p>Treatment:</p>\n<ul>\n<li>Single-dose therapy - Amoxicillin 3g, Nitrofurantoin 200mg&nbsp;</li>\n<li>Regular 10-14 days therapy - Amoxicillin, Nitrofurantoin, Cephalexin, or Amoxiclav</li>\n<li>Recurrent cases need to be treated until delivery with prophylactic doses.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A woman presented to the clinic with severe lower abdominal pain and dysuria at 28 weeks of gestation.  Suprapubic tenderness was noted on palpation. Urine examination revealed pyuria with microscopic hematuria.  All of the following can be used to treat this condition except?",
    "choices": [
      {
        "id": 1,
        "text": "Amoxycillin"
      },
      {
        "id": 2,
        "text": "Cefazolin"
      },
      {
        "id": 3,
        "text": "Ciprofloxacin"
      },
      {
        "id": 4,
        "text": "Cefixime"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The&nbsp;given clinical scenario is suggestive of <strong>cystitis</strong>.&nbsp;<strong>Ciprofloxacin</strong>,<strong> a </strong><span class=\"st\" data-hveid=\"44\" data-ved=\"0ahUKEwi7wNzb-qTZAhXLPY8KHUZsAF4Q4EUILDAA\"><strong>fluoroquinolone</strong> antibiotic, is <strong>contraindicated</strong> in pregnancy as it causes cartilage and bone defects in the fetus.</span></p>\n<p><strong>Antibiotics</strong> are used for treating cystitis in pregnancy.&nbsp;</p>\n<p><strong>Antibiotics safe in pregnancy include:</strong></p>\n<ul>\n<li><span class=\"st\" data-hveid=\"44\" data-ved=\"0ahUKEwi7wNzb-qTZAhXLPY8KHUZsAF4Q4EUILDAA\">Penicillin group</span></li>\n<li><span class=\"st\" data-hveid=\"44\" data-ved=\"0ahUKEwi7wNzb-qTZAhXLPY8KHUZsAF4Q4EUILDAA\">Cephalosporins</span></li>\n<li><span class=\"st\" data-hveid=\"44\" data-ved=\"0ahUKEwi7wNzb-qTZAhXLPY8KHUZsAF4Q4EUILDAA\">Erythromycin</span></li>\n<li><span class=\"st\" data-hveid=\"44\" data-ved=\"0ahUKEwi7wNzb-qTZAhXLPY8KHUZsAF4Q4EUILDAA\">Metronidazole (except in the 1st trimester)</span></li>\n</ul>\n<p><span class=\"st\" data-hveid=\"44\" data-ved=\"0ahUKEwi7wNzb-qTZAhXLPY8KHUZsAF4Q4EUILDAA\"><strong>Antibiotics unsafe in pregnancy include:</strong></span></p>\n<ul>\n<li><span class=\"st\" data-hveid=\"44\" data-ved=\"0ahUKEwi7wNzb-qTZAhXLPY8KHUZsAF4Q4EUILDAA\">Tetracycline</span></li>\n<li><span class=\"st\" data-hveid=\"44\" data-ved=\"0ahUKEwi7wNzb-qTZAhXLPY8KHUZsAF4Q4EUILDAA\">Aminoglycoside</span></li>\n<li><span class=\"st\" data-hveid=\"44\" data-ved=\"0ahUKEwi7wNzb-qTZAhXLPY8KHUZsAF4Q4EUILDAA\">Chloramphenicol</span></li>\n<li><span class=\"st\" data-hveid=\"44\" data-ved=\"0ahUKEwi7wNzb-qTZAhXLPY8KHUZsAF4Q4EUILDAA\">Metronidazole(in the first trimester)</span></li>\n<li><strong><span class=\"st\" data-hveid=\"44\" data-ved=\"0ahUKEwi7wNzb-qTZAhXLPY8KHUZsAF4Q4EUILDAA\">Fluoroquinolones</span></strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which stage of pregnancy is most often complicated by acute pyelonephritis?",
    "choices": [
      {
        "id": 1,
        "text": "1st trimester"
      },
      {
        "id": 2,
        "text": "2nd trimester"
      },
      {
        "id": 3,
        "text": "3rd trimester"
      },
      {
        "id": 4,
        "text": "Puerperium"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Acute pyelonephritis</strong> in pregnancy most often complicates <strong>2nd trimester</strong> of pregnancy.&nbsp;</p>\n<p>Acute pyelonephritis occurs more commonly in those with preexisting renal disease. It is caused by<strong>&nbsp;<em>E. coli </em></strong><em>&gt;&gt; Streptococcus sp., S.aureus &gt; Enterobacter, Klebsiella sp.&nbsp;</em></p>\n<p>Clinical features include:</p>\n<ul>\n<li>Fever with chills</li>\n<li><strong>Loin pain</strong></li>\n<li>Vomiting</li>\n<li>Right-sided renal angle tenderness</li>\n</ul>\n<p>Patients may develop <strong>acute respiratory distress syndrome</strong> due to endotoxin-mediated alveolar injury.<strong> Hemolysis</strong>&nbsp;can also occur due to endotoxins, leading to <strong>anemia</strong>.</p>\n<p>Treatment includes <strong>intravenous fluids&nbsp;</strong>with <strong>antibiotics</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following congenital infections are associated with the triad of Gregg in a neonate?",
    "choices": [
      {
        "id": 1,
        "text": "Toxoplasma"
      },
      {
        "id": 2,
        "text": "Parvovirus"
      },
      {
        "id": 3,
        "text": "Varicella zoster virus"
      },
      {
        "id": 4,
        "text": "Rubella"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Triad of Gregg</strong> is seen in a neonate infected congenitally with<strong>&nbsp;rubella virus</strong>. The features include:</p>\n<ul>\n<li>Patent ductus arteriosus (PDA)</li>\n<li>Cataract</li>\n<li>Sensorineural Hearing loss (SNHL)</li>\n</ul>\n<p>Other infections which cause congenital malformations are:</p>\n<table style=\"height: 306px;\" width=\"439\">\n<tbody>\n<tr>\n<td style=\"width: 105.483px;\"><strong>Organism</strong></td>\n<td style=\"width: 316.017px;\"><strong>Effect</strong></td>\n</tr>\n<tr>\n<td style=\"width: 105.483px;\">Toxoplasma</td>\n<td style=\"width: 316.017px;\">\n<p>Hydro/microcephaly, convulsions, chorioretinitis, cerebral calcification</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 105.483px;\">Varicella</td>\n<td style=\"width: 316.017px;\">\n<p>Skin scarring, hypoplastic limbs, eye defects, microcephaly</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 105.483px;\">Parvovirus</td>\n<td style=\"width: 316.017px;\">Non-immune hydrops</td>\n</tr>\n<tr>\n<td style=\"width: 105.483px;\">Syphilis</td>\n<td style=\"width: 316.017px;\">\n<p><strong>Hutchinson's triad:</strong>&nbsp;</p>\n<ul>\n<li>Interstitial keratitis</li>\n<li>Hutchinson's teeth</li>\n<li>Eighth nerve deafness</li>\n</ul>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is true about toxoplasmosis in pregnancy?",
    "choices": [
      {
        "id": 1,
        "text": "Maximum transmission and damage in 1st trimester"
      },
      {
        "id": 2,
        "text": "Maximum transmission in 1st trimester and maximum damage in 3rd trimester"
      },
      {
        "id": 3,
        "text": "Maximum damage in 1st trimester and maximum transmission in 3rd trimester"
      },
      {
        "id": 4,
        "text": "Maximum transmission and damage in 3rd trimester"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Toxoplasmosis causes <strong>maximal complications</strong>&nbsp;in<strong> 1st trimester</strong> and is&nbsp;<strong>maximally transmitted&nbsp;</strong>in the <strong>3rd trimester.</strong></p>\n<p>This is because the risk of transmission increases and the risk of damage decreases as pregnancy progresses further.</p>\n<p>Clinical features of affected neonates include:</p>\n<ul>\n<li><strong>Hydrocephalus or microcephaly</strong></li>\n<li><strong>Chorioretinitis</strong></li>\n<li><strong>Intracranial calcifications</strong></li>\n<li><strong>Convulsions</strong></li>\n<li>Low birthweight</li>\n<li>Hepatosplenomegaly</li>\n<li>Jaundice</li>\n<li>Anemia</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A woman presents for a regular antenatal check-up at 12 weeks of gestation. She works at a rescue center that held an adoption drive for cats a few weeks ago. On examination, mild cervical lymphadenopathy is noted. Sabin-Feldman dye test is positive. Which of the following will be used to treat this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Spiramycin"
      },
      {
        "id": 2,
        "text": "Pyrimethamine-sulfonamide"
      },
      {
        "id": 3,
        "text": "Doxycycline"
      },
      {
        "id": 4,
        "text": "Cotrimoxazole"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given scenario points to a diagnosis of <strong>maternal toxoplasmosis</strong>. It is treated using <strong>spiramycin.</strong></p>\n<p><strong>Pyrimethamine-sulfonamide</strong> is used when <strong>fetal infections </strong>are<strong>&nbsp;</strong>confirmed. It should be&nbsp;<strong>avoided </strong>in the <strong>first trimester</strong>.</p>\n<p><strong>Toxoplasmosis </strong>is caused by&nbsp;<em>Toxoplasma gondii.</em>&nbsp;<strong>Cats</strong> are definitive hosts. It&nbsp;can be transmitted to humans either by ingestion of raw or inadequately cooked infected meat or by ingestion of oocysts via exposure to cat litter or soil.</p>\n<p><strong>Acute</strong> infection is diagnosed either by the presence of&nbsp;<strong>IgG and IgM antibodies</strong> or by a four-fold increase in paired specimens 4 weeks apart.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A per-vaginal examination performed on a lady in labor reveals multiple painful tiny vesicular ulcers over the vulva and vaginal walls. A slide showing the microscopic findings is given below. What is the best step in the management of delivery in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Vaginal delivery"
      },
      {
        "id": 2,
        "text": "Cesarean section"
      },
      {
        "id": 3,
        "text": "Give tocolytics and treat the infection"
      },
      {
        "id": 4,
        "text": "Local application of antibiotic."
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Painful genital ulcers</strong> and painful <strong>inguinal lymphadenopathy</strong> are suggestive of <strong>herpes virus</strong> infection. The cytological image showing multinucleate giant cells, <strong>Tzanck cells</strong> confirms the diagnosis of HSV. The best step in the management of delivery in this patient is a&nbsp;<strong>cesarean section.&nbsp;</strong></p>\n<p>Herpes infection&nbsp;in the newborn may occur during birth, particularly if the mother has<strong> genital lesions</strong> due to<strong> HSV-2</strong>. In such cases, a cesarean section may <strong>prevent&nbsp;neonatal infection.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/2ff0c439c3b4422da3ee0ab1816cf964.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/fdde9322be5c459db277c2cbe52f4451x1280x1144.JPEG"
    ]
  },
  {
    "text": "In a pregnant woman with herpes simplex infection, the risk of transmission to the fetus will be maximum during which stage of the pregnancy?",
    "choices": [
      {
        "id": 1,
        "text": "First trimester"
      },
      {
        "id": 2,
        "text": "Second trimester"
      },
      {
        "id": 3,
        "text": "Third trimester"
      },
      {
        "id": 4,
        "text": "Labour"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The <strong>maximum </strong>risk of<strong> HSV transmission</strong> from mother to child is <strong>during labor. </strong>This is<strong>&nbsp;</strong>due to the shedding of the virus from an active infection in the genital tract during delivery.</p>\n<p>HSV is a&nbsp;<strong>sexually transmitted infection</strong>. There is a higher risk of transmission during primary infections than with recurrences.&nbsp;Reactivations are less severe.</p>\n<p><strong>Cesarean delivery</strong> reduces the risk of vertical transmission during labor and is indicated in:</p>\n<ul>\n<li>Cases of <strong>active genital lesions</strong> - both primary and recurrent</li>\n<li><strong>Prodromal symptoms</strong> - like vulval itching or burning</li>\n</ul>\n<p>Suspicious lesions should be sent for PCR testing or culture. Antiviral treatment with <strong>acyclovir</strong> should be given if found positive.</p>\n<p>Women without active genital lesions, without symptoms, or those with active lesions in non-genital areas can undergo normal labor and delivery.&nbsp;</p>\n<p><strong>Management</strong> of HSV infection during pregnancy:</p>\n<ul>\n<li>Primary or recurrent infections during pregnancy -&nbsp;Oral <strong>acyclovir</strong> or <strong>valacyclovir</strong></li>\n<li>Severe or disseminated infection -&nbsp;IV acyclovir followed by oral acyclovir</li>\n<li>Pain relief -&nbsp;Oral <strong>analgesics</strong> or topical anesthetics</li>\n<li>Urinary retention - <strong>catheterization.</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The risk of fetal varicella syndrome is maximum when the mother is infected between _____.",
    "choices": [
      {
        "id": 1,
        "text": "6 to 10 weeks"
      },
      {
        "id": 2,
        "text": "8 to 12 weeks"
      },
      {
        "id": 3,
        "text": "13 to 20 weeks"
      },
      {
        "id": 4,
        "text": "20 to 28 weeks"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The<strong>&nbsp;risk </strong>of developing<strong>&nbsp;fetal varicella syndrome</strong>&nbsp;(congenital varicella syndrome) is <strong>highest&nbsp;</strong>when the mother develops varicella infection between <strong>13 to 20 weeks</strong>.&nbsp;</p>\n<p>Congenital varicella syndrome occurs in <strong>2% of infants</strong> with maternal varicella <strong>between 13 and 20 weeks</strong> of gestation and in<strong> 0.4% of infants</strong> <strong>before 13 weeks</strong> of gestation. It is rare after 20 weeks.</p>\n<p><strong>Congenital varicella syndrome</strong> is characterized by<strong> cicatricial skin scarring</strong> in a zoster-like pattern (zig-zag scarring), and <strong>limb hypoplasia </strong>(shown below). They can also&nbsp;present with <strong>neurological</strong> abnormalities (<strong>microcephaly, cortical atrophy, mental retardation</strong>), ophthalmic features (<strong>chorioretinitis, microphthalmia, cataract</strong>), and renal and autonomic system abnormalities (<strong>hydronephrosis, neurogenic bladder</strong>). <strong>Low birth weight</strong> is also common.&nbsp;</p>\n<p>Infants born to mothers with varicella in the period from<strong> 5 days prior to delivery up to 2 days after delivery</strong>&nbsp;are at high risk for <strong>severe neonatal varicella</strong>. They acquire the infection transplacentally.</p>\n<p>Since the mother has not developed a strong antibody response, the infant lacks the protective effect of maternal anti-varicella-zoster virus (VZV) antibodies.&nbsp; Therefore <strong>varicella-zoster immune globulin</strong>&nbsp;(VZIG)<strong>&nbsp;</strong>should be administered as soon as possible after birth to <strong>newborns</strong> whose mothers have varicella<strong>&nbsp;5 days before and up to 2 days after</strong> the delivery.&nbsp;</p>\n<p>Since perinatally acquired varicella can be potentially life-threatening, the infant should typically be treated with <strong>intravenous acyclovir</strong> (10 mg/kg every 8 hours) when <strong>lesions</strong> <strong>appear</strong>.&nbsp;</p>\n<p>For <strong>pregnant women</strong> with uncomplicated primary varicella or herpes zoster that does not require hospitalization, the recommended treatment is <strong>oral acyclovir</strong>&nbsp;(800 mg five times daily for seven days).&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a9ca7f26f1f745e6b367632ca66f2ddfx383x576.JPEG"
    ]
  },
  {
    "text": "A young woman delivered a baby with limb hypoplasia and cicatricial skin lesions. Which of the following infections did the mother most likely have during her pregnancy?",
    "choices": [
      {
        "id": 1,
        "text": "Rubella"
      },
      {
        "id": 2,
        "text": "Cytomegalovirus"
      },
      {
        "id": 3,
        "text": "Chicken pox"
      },
      {
        "id": 4,
        "text": "Toxoplasmosis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given scenario is<strong>&nbsp;</strong>suggestive of&nbsp;<strong>congenital varicella syndrome</strong>. It is seen in babies born to mothers who had<strong> chickenpox infections</strong> during their pregnancy.</p>\n<p>Features of congenital varicella syndrome include:</p>\n<ul>\n<li>Chorioretinitis</li>\n<li><strong>Limb hypoplasia</strong></li>\n<li><strong>Cicatricial skin lesions</strong></li>\n<li>Microphthalmia</li>\n<li>Cerebral cortical atrophy</li>\n<li>Growth restriction</li>\n<li>Hydronephrosis</li>\n</ul>\n<p>The image below shows limb hypoplasia in fetal varicella syndrome:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ad62ab53725c47c0a2012a385567d500x383x576.JPEG"
    ]
  },
  {
    "text": "In a pregnant woman with syphilis, the infection can get transmitted to the fetus during which stage in pregnancy?",
    "choices": [
      {
        "id": 1,
        "text": "During delivery"
      },
      {
        "id": 2,
        "text": "28-32 weeks"
      },
      {
        "id": 3,
        "text": "Before 6 weeks"
      },
      {
        "id": 4,
        "text": "10-15 weeks"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Note: The risk of fetal infection during untreated early maternal syphilis is ~75&ndash;95%, decreasing to ~35% for maternal syphilis of &gt;2 years duration.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/058d0cc8a28d47aaaf8dd6abaa882e50x640x488.JPEG"
    ]
  },
  {
    "text": "You are posted in the labor room. While inspecting the placenta to rule out any abnormalities, you notice that it appears pale and enlarged. Which of the following infections does the mother most likely have?",
    "choices": [
      {
        "id": 1,
        "text": "Rubella"
      },
      {
        "id": 2,
        "text": "Measles"
      },
      {
        "id": 3,
        "text": "Syphillis"
      },
      {
        "id": 4,
        "text": "Toxoplasmosis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Enlarged and pale placenta</strong> is due to infection by&nbsp;<strong>syphilis</strong>.</p>\n<p>Other clinical manifestations and complications include:</p>\n<ul>\n<li>Spontaneous abortion</li>\n<li>Stillbirth</li>\n<li>Non-immune hydrops&nbsp;</li>\n<li>Intrauterine growth restriction&nbsp;</li>\n<li>Perinatal death.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A sexually active woman presents with amenorrhea for the past 3 months and a history of a painless genital ulcer. UPT is positive and routine antenatal tests revealed a reactive VDRL report. What is the dose of benzathine penicillin that should be given for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "3\u20134 million units intravenously"
      },
      {
        "id": 2,
        "text": "2.4 million units intramuscularly as a single injection"
      },
      {
        "id": 3,
        "text": "2.4 million units intramuscularly daily, plus probenecid 500 mg orally for 14 days"
      },
      {
        "id": 4,
        "text": "2.4 million units intramuscularly weekly for three doses"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The&nbsp;given clinical scenario is suggestive of <strong>early syphilis</strong> in a pregnant woman.<strong> 2.4 million units</strong>&nbsp;of <strong>benzathine penicillin</strong> should be given <strong>intramuscularly&nbsp;</strong>as a single injection.</p>\n<p>Treatment of syphilis includes:</p>\n<ul>\n<li><strong>Early syphilis </strong>-&nbsp;Benzathine penicillin G, 2.4 million units intramuscularly as a <strong>single</strong> injection</li>\n<li><strong>Late syphilis </strong>(&gt;1 year duration) -<strong>&nbsp;</strong>Benzathine penicillin G, 2.4 million units intramuscularly weekly for <strong>three doses</strong></li>\n</ul>\n<p>Treatment of <strong>neurosyphilis:</strong></p>\n<ul>\n<li>Aqueous<strong> crystalline penicillin</strong> G, 3&ndash;4 million units intravenously every 4 hours for 10&ndash;14 days</li>\n<li>Procaine penicillin, 2.4 million units intramuscularly daily, plus probenecid 500 mg orally four times daily, both for 10&ndash;14 days.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A woman at 24 weeks of gestation presented with complaints of fatigue, joint pain, and the following rash for 3 weeks. Urinalysis showed proteinuria and anti-Smith antibodies were positive. Which of the following complications is least likely in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Thrombocytopenia"
      },
      {
        "id": 2,
        "text": "Eclampsia"
      },
      {
        "id": 3,
        "text": "Post term delivery"
      },
      {
        "id": 4,
        "text": "Thrombophilia"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The above scenario points to a diagnosis of <strong>SLE</strong>.&nbsp;<strong>Preterm labor&nbsp;</strong>is a complication in pregnant women with SLE, not post-term delivery.</p>\n<p>Complications in a pregnant patient with SLE include:</p>\n<ul>\n<li><strong>Thrombophilia</strong></li>\n<li>Preterm labor</li>\n<li>Hypertension, <strong>eclampsia</strong>, and preeclampsia</li>\n<li>Anemia</li>\n<li><strong>Thrombocytopenia</strong></li>\n<li>Stroke</li>\n<li>Renal failure</li>\n</ul>\n<p>Features of neonatal lupus include:</p>\n<ul>\n<li>Cardiac abnormalities - Complete heart blocks&nbsp;</li>\n<li>Cutaneous lupus</li>\n<li>Hepatobiliary diseases - liver failure,&nbsp;transient conjugated hyperbilirubinemia, transient transaminase elevations</li>\n<li>Hematologic abnormalities - thrombocytopenia, neutropenia, or anemia</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a8ffa59dceff4d1c8e97decaea16686d.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A woman with HIV presents for a routine antenatal checkup at 35 weeks of gestation. Investigations revealed a viral load of >1000 copies/ml. What will be the best mode of delivery in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Normal vaginal delivery"
      },
      {
        "id": 2,
        "text": "Cesarean delivery"
      },
      {
        "id": 3,
        "text": "Forceps assisted vaginal delivery"
      },
      {
        "id": 4,
        "text": "Vacuum assisted vaginal delivery"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Cesarean delivery\u00a0</strong>is the preferred mode of delivery in a woman with HIV viral load\u00a0<strong>above 1000 copies/ml\u00a0</strong>at 34-36 weeks of gestation.</p>\n<p>Cesarean delivery\u00a0is usually scheduled at <strong>38 weeks</strong> of gestation, or two weeks before the due date.</p>\n<p>Pregnant women with HIV on ART throughout pregnancy, with a viral load <strong>&lt;1000 <span class=\"nowrap\">copies/mL</span></strong>\u00a0evaluated within 4-6 weeks of delivery, may choose to have a <strong>vaginal delivery.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A woman is diagnosed to be positive for HIV in her first trimester. What is the appropriate management?",
    "choices": [
      {
        "id": 1,
        "text": "Start ART immediately and continue till 6 weeks after delivery"
      },
      {
        "id": 2,
        "text": "Start ART after 1st trimester and continue life-long"
      },
      {
        "id": 3,
        "text": "Start ART immediately and continue life-long"
      },
      {
        "id": 4,
        "text": "Start ART after 1st trimester and continue till 6 weeks after delivery"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>ART</strong> should be <strong>initiated immediately and&nbsp;continued lifelong</strong> in<strong>&nbsp;</strong>all <strong>pregnant </strong>and<strong> breastfeeding </strong>women with <strong>HIV. </strong>This is&nbsp;regardless of their WHO clinical stage and CD4 cell count.</p>\n<p>*Note: Pearl attached below has been updated according to the NACO ART guidelines 2021. Efavirenz has been replaced by <strong>Dolutegravir</strong> as per the new guidelines.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A woman with HIV on antiretroviral therapy is in labor. Which of the following will be given to her newborn baby prophylactically?",
    "choices": [
      {
        "id": 1,
        "text": "6 weeks of nevirapine"
      },
      {
        "id": 2,
        "text": "6 weeks of zidovudine and nevirapine"
      },
      {
        "id": 3,
        "text": "12 weeks of zidovudine, nevirapine and lamivudine"
      },
      {
        "id": 4,
        "text": "12 weeks of zidovudine and lamivudine"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>In India, according to the&nbsp;<strong>NACO</strong> guidelines, <strong>nevirapine</strong> is given in the syrup form for<strong> 6 weeks</strong> to an infant of a mother who is on<strong> long-term ART.</strong></p>\n<p>In infants born to mothers with HIV who are <strong>not on ART</strong>, syrup&nbsp;<strong>nevirapine</strong> should be continued for <strong>12 weeks</strong>.&nbsp;</p>\n<p>According to the<strong>&nbsp;NIH guidelines, zidovudine</strong>&nbsp;should be given to the neonate for <strong>4 weeks.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The risk of developing a stroke is highest during what period of gestation in a pregnant woman?",
    "choices": [
      {
        "id": 1,
        "text": "1st trimester"
      },
      {
        "id": 2,
        "text": "2nd trimester"
      },
      {
        "id": 3,
        "text": "Postpartum period"
      },
      {
        "id": 4,
        "text": "Intrapartum period"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The <strong>highest incidence of stroke</strong> in pregnancy is 5 days to 2 weeks&nbsp;<strong>postpartum. </strong>This is&nbsp;followed by the intrapartum period.</p>\n<p>There is an increased risk of cerebrovascular thrombosis post-delivery due to a sudden reduction in the blood volume, a fall in the level of circulating antithrombotic factors, and venous stasis.</p>\n<p><strong>Risk factors of stroke in pregnancy</strong> include:</p>\n<ul>\n<li>Hypertensive disorders</li>\n<li>Gestational diabetes</li>\n<li>Antepartum hemorrhage</li>\n<li>Cesarean delivery.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is false regarding epilepsy in pregnancy?",
    "choices": [
      {
        "id": 1,
        "text": "It increases risk of fetal malformations by 5%"
      },
      {
        "id": 2,
        "text": "Seizure risk is more at the time of delivery"
      },
      {
        "id": 3,
        "text": "Seizure frequency increases in 30% of women"
      },
      {
        "id": 4,
        "text": "Ideal contraceptive in breast feeding mother with seizure disorder is DMPA"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Untreated epilepsy has no association with fetal malformations. <strong>Anti-epileptic medications</strong> such as valproate, phenytoin, etc., are responsible for <strong>fetal malformations</strong>.</p>\n<p><strong>Seizure frequency</strong> is unchanged in 50%, increased in 30%, and decreased in 20% women.</p>\n<p>Seizure <strong>risk increases during labor</strong> as pain and hyperventilation decrease the seizure threshold.</p>\n<p>The <strong>ideal contraceptive</strong> in a breastfeeding mother with a seizure disorder is <strong>depot medroxyprogesterone acetate</strong> (DMPA), as progestins increase the seizure threshold.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '29 Hepatic Disorders And Infections In Pregnancy';
        const quizFilename = '29-hepatic-disorders-and-infections-in-pregnancy-9fb6aae3.html';
        let hierarchy = ["Marrow", "qBank", "Obstetrics & Gynecology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>