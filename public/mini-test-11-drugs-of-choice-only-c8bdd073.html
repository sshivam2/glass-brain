<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini Test 11- Drugs Of Choice Only - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2021-22
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A 36-year-old male HIV patient presents to the ED with a cough with bloody sputum. He also has night sweats, chills, and difficulty in breathing. A chest X-ray and examination of the sputum show the following findings. Which of the following is the drug of choice for his condition?",
    "choices": [
      {
        "id": 1,
        "text": "Amikacin"
      },
      {
        "id": 2,
        "text": "Cotrimoxazole"
      },
      {
        "id": 3,
        "text": "Minocycline"
      },
      {
        "id": 4,
        "text": "Linezolid"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario along with the chest X-ray and gram-staining is suggestive of&nbsp;<strong>Nocardiosis.</strong>&nbsp;The drug of choice is&nbsp;<strong>cotrimoxazole.</strong></p>\n<p><em>Nocardia</em> is a <strong>gram-positive</strong> and acid-fast bacteria.&nbsp;Nocardia pneumonia has a sub-acute presentation with mostly cough with thick sputum and fever. Generally, hemoptysis is uncommon. Chest radiography shows <strong>nodular infiltrations</strong> involving bilateral lung fields.</p>\n<p>Extrapulmonary manifestations are common, the <strong>brain</strong> is the most commonly involved organ. It is associated with dense bilateral infiltrates with cavitating nodules and subacute brain abscesses.</p>\n<p>The drug of choice is&nbsp;<strong>cotrimoxazole.&nbsp;</strong>Severe disease is treated with a combination of cotrimoxazole, amikacin, and ceftriaxone, or imipenem.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/dfacc98188c14e3e8fb1003ce4308a40.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 25-year-old female patient came with complaints of amenorrhea for 6 weeks. The urine pregnancy test was positive. Her thyroid profile is given below. She reports that her mother has Graves disease. What is the drug of choice for her present condition?",
    "choices": [
      {
        "id": 1,
        "text": "Propylthiouracil"
      },
      {
        "id": 2,
        "text": "Methimazole"
      },
      {
        "id": 3,
        "text": "Carbimazole"
      },
      {
        "id": 4,
        "text": "Levothyroxine"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The above clinical features are suggestive of <strong>hyperthyroidism</strong>&nbsp;in the&nbsp;<strong>1<sup>st</sup> trimester of pregnancy.&nbsp;Propylthiouracil</strong> is the drug of choice for this patient.&nbsp;</p>\n<p>Propylthiouracil is an antithyroid drug that belongs to the group of <strong>thioamides</strong>. It inhibits the&nbsp;<strong>peroxidase enzyme, </strong>which&nbsp;catalyzes&nbsp;<strong>the coupling reaction of iodotyrosyl residues; </strong>thus reducing thyroid hormone synthesis. Propylthiouracil also inhibits <strong>peripheral iodothyronine deiodination</strong>.</p>\n<p>Uses:</p>\n<ul>\n<li>As a definitive treatment and to control remission in <strong>Graves disease</strong></li>\n<li>In conjunction with radioactive iodine</li>\n<li><strong>Preoperatively</strong> to control the disorder requiring surgery</li>\n</ul>\n<p>Adverse effects:</p>\n<ul>\n<li><strong>Agranulocytosis</strong> is reversible once the drug is stopped</li>\n<li><strong>Most common</strong> is <strong>urticarial rash</strong></li>\n<li><strong>Teratogenic</strong> potential limited to methimazole and carbimazole leading to\n<ul>\n<li><strong>Fetal aplasia cutis&nbsp;</strong></li>\n<li><strong>Choanal </strong>and<strong> esophageal atresia</strong></li>\n</ul>\n</li>\n</ul>\n<p><strong>Propylthiouracil</strong> does <strong>not</strong> cross the <strong>placental barrier</strong> whereas <strong>methimazole </strong>and<strong> carbimazole</strong> <strong>cross</strong> the placental barrier leading to teratogenicity. Therefore, propylthiouracil is the drug of choice for hyperthyroidism in&nbsp;1<sup>st</sup> trimester of pregnancy (period of organogenesis). Propylthiouracil use is limited to the first trimester due to the risk of hepatotoxicity, following which it is replaced with methimazole (or carbimazole) in the 2<sup>nd</sup> and 3<sup>rd</sup> trimesters.</p>\n<p>Other options:</p>\n<p>Option D: <strong>Levothyroxine</strong> is a thyroid hormone preparation used in the treatment of <strong>hypothyroidism</strong> and <strong>myxedema coma.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 42-year-old man involved in a road traffic accident was brought to the emergency room. His vitals are as shown below. His vitals did not improve on fluid resuscitation. On FAST examination, there was fluid present in the retroperitoneal space. The patient was shifted to the operating room for laparotomy. What is the intravenous agent of choice for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Ketamine"
      },
      {
        "id": 2,
        "text": "Propofol"
      },
      {
        "id": 3,
        "text": "Thiopentone"
      },
      {
        "id": 4,
        "text": "Midazolam"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Ketamine&nbsp;</strong>is the intravenous agent of choice in this patient. Ketamine indirectly <strong>stimulates</strong> the <strong>cardiovascular system</strong>&nbsp;and is thus useful in this patient as he has come with a traumatic injury to the abdomen and is <strong>hemodynamically unstable</strong>.</p>\n<p>Ketamine is a <strong>phencyclidine</strong> derivative that inhibits <strong>NMDA&nbsp;</strong>(N-methyl-D-aspartate) <strong>receptors</strong> resulting in a decrease in excitatory stimulation by glutamate in the brain.&nbsp;It is a strong <strong>analgesic</strong> and <strong>amnestic </strong>agent.&nbsp;It also causes <strong>dissociative anesthesia</strong>.</p>\n<p>On the cardiovascular system, it directly has a cardio-depressive effect and <strong>indirectly</strong> stimulates it by activating the <strong>sympathetic system&nbsp;</strong>and inhibiting the vagus nerve.&nbsp;It <strong>predominantly</strong> shows a <strong>stimulatory</strong> effect hence causing tachycardia, increased cardiac output, and <strong>increased</strong> systemic and pulmonary <strong>hypertension</strong>.</p>\n<p>On the respiratory system, it has a <strong>bronchodilator</strong> effect on bronchial smooth muscles. It increases salivary secretion and bronchial secretion.&nbsp;It also acts on other systems and increases the intracranial and intraocular pressures.</p>\n<p>Uses:</p>\n<ul>\n<li>Ketamine is the <strong>intravenous agent of choice</strong> for patients with <strong>shock</strong>, <strong>low cardiac output states,</strong> and <strong>reactive airway diseases.</strong></li>\n<li>It is also used in patients with congenital heart diseases, especially with&nbsp;<strong>right-to-left shunts</strong></li>\n<li><strong>Perioperative analgesia</strong></li>\n</ul>\n<p>Ketamine should be <strong>avoided</strong> in patients with a history of seizures, psychiatric illness, or vascular aneurysms. It is also contraindicated in open eye injuries and eye surgeries</p>\n<p>Adverse effects:</p>\n<ul>\n<li><strong>Hallucination</strong> is the most common side effect of ketamine.</li>\n<li><strong>Emergence reaction</strong> (vivid dreaming, illusion, etc)</li>\n<li>Increases brain oxygen consumption and metabolic rate leading to increased intracranial tension.</li>\n</ul>\n<p>Other options:</p>\n<p>Option B:&nbsp;<strong>Propofol</strong> is the most commonly used parenteral anesthetic. It is cerebro-protective by decreasing cerebral metabolic rate. It produces dose-dependent hypotension.</p>\n<p>Option C:<strong> Thiopentone</strong> belongs to the barbiturate group. It is cerebro-protective and is an anticonvulsant. It leads to <strong>hypotension</strong> due to vasodilation. It is <strong>contraindicated</strong> in&nbsp;patients with obstructive airway disease, severe <strong>cardiovascular instability,</strong> and shock, history of porphyrias.</p>\n<p>Option D:&nbsp;<strong>Midazolam</strong> is a benzodiazepine. It is used in treating seizures and is used in daycare surgeries as an induction agent due to its short half-life.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 56-year-old male patient with a history of diabetes mellitus was diagnosed with major depression. He attempted suicide by consuming a bottle of glipizide tablets. What is the antidote of choice for this case?",
    "choices": [
      {
        "id": 1,
        "text": "Glucagon"
      },
      {
        "id": 2,
        "text": "Octreotide"
      },
      {
        "id": 3,
        "text": "Intravenous dextrose"
      },
      {
        "id": 4,
        "text": "Leucovorin"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The antidote of choice for the above case scenario suggestive of <strong>sulfonylurea overdose\u00a0</strong>(glipizide belongs to the sulfonylurea group) which resulted in <strong>severe hypoglycemia</strong> is <strong>o</strong><strong>ctreotide</strong>.</p>\n<p>Octreotide is a <strong>somatostatin analogue</strong>. It\u00a0inhibits the secretion of growth hormone. It binds to <strong>somatostatin-2</strong> receptors on <strong>pancreatic beta cells</strong> and <strong>blocks</strong> the <strong>Ca<sup>2+</sup>\u00a0influx</strong> resulting in a <strong>decrease </strong>in<strong> insulin secretion</strong>. Hence, it can be used to correct the hypoglycemia caused by sulfonylurea. overdose.</p>\n<p>Other uses of octreotide:</p>\n<ul>\n<li><strong>Acromegaly</strong></li>\n<li><strong>Esophageal varices</strong></li>\n<li>Thyrotrope adenomas</li>\n<li><strong>Carcinoid tumors</strong></li>\n<li>Adenomas secreting VIP(watery diarrhea)</li>\n<li>Diagnostic imaging of neuroendocrine tumors</li>\n<li><strong>Sulfonylurea toxicity</strong></li>\n</ul>\n<p>Adverse effects:\u00a0</p>\n<ul>\n<li>Injection site pain</li>\n<li>Hyperglycemia</li>\n<li><strong>Gallstones</strong></li>\n</ul>\n<p>Other options:\u00a0</p>\n<p>Option A: <strong>Glucagon</strong>\u00a0can rectify hypoglycemia by promoting glycogenolysis and gluconeogenesis. However, it is not routinely administered as it can stimulate insulin release and is not useful in glycogen-depleted patients.</p>\n<p>Option C: <strong>Intravenous dextrose</strong> is not given because when administered it creates a hyperglycemic state thus stimulating insulin release, causing hypoglycemia again.</p>\n<p>Option D: <strong>Leucovorin\u00a0</strong>(folinic acid) is the antidote of choice for <strong>methotrexate overdose</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient with calcium oxalate monohydrate crystals in the urine is diagnosed with ethylene glycol poisoning. What is the drug of choice for treating this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Sodium bicarbonate"
      },
      {
        "id": 2,
        "text": "Fomepizole"
      },
      {
        "id": 3,
        "text": "Thiamine"
      },
      {
        "id": 4,
        "text": "Ethanol"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Fomepizole</strong> is the drug of choice for the treatment of<strong> ethylene glycol poisoning.</strong></p>\n<p>Treatment of ethylene glycol poisoning:</p>\n<ul>\n<li><strong>Fomepizole</strong> (preferred) or <strong>ethanol</strong> (if fomepizole is unavailable) - inhibits the enzyme alcohol dehydrogenase</li>\n<li><strong>Sodium bicarbonate</strong>&nbsp;- correct systemic acidosis</li>\n<li><strong>Hemodialysis</strong>&nbsp;- for elevated toxic alcohol levels, severe acid-base derangements, or evidence of end-organ toxicity</li>\n<li><strong>Co-factors</strong> (folic acid, thiamine, and pyridoxine) - optimizes non-toxic metabolic pathways for the elimination of parent alcohol or its metabolites</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 54-year-old female patient came with complaints of easy fatiguability and back pain for the past 2 months. She gives a history of night sweats, dry skin, vaginal dryness, decrease libido since one year, and a right wrist fracture 3 months back. On investigation, her T-score is found to be \u20132.6. What is the drug of choice for her present complaint?",
    "choices": [
      {
        "id": 1,
        "text": "Estrogen"
      },
      {
        "id": 2,
        "text": "Zolendronate"
      },
      {
        "id": 3,
        "text": "Teriparatide"
      },
      {
        "id": 4,
        "text": "Denosumab"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Zoledronate&nbsp;</strong>(bisphosphonates) is the drug of choice for her present complaint i.e., back pain. The given clinical scenario is suggestive of <strong>post-menopausal osteoporosis</strong> and bisphosphonates are the drug of choice for this condition.</p>\n<p>Zoledronate mainly targets the calcium of <strong>remodeling bone</strong>. It inhibits bone resorption by inducing <strong>apoptosis</strong> of <strong>osteoclast</strong> and <strong>inhibition</strong> of the&nbsp;<strong>cholesterol biosynthesis pathway.</strong>&nbsp;</p>\n<p>Therapeutic uses:</p>\n<ul>\n<li><strong>Post-menopausal </strong>and<strong> steroid-induced osteoporosis</strong></li>\n<li><strong>Paget's disease</strong></li>\n<li>Tumor-induced osteolysis</li>\n<li>Hypercalcemia</li>\n</ul>\n<p>Adverse effects:</p>\n<ul>\n<li>Oral intake causes <strong>esophagitis</strong> and <strong>esophageal erosion</strong>.</li>\n<li>Intravenous intake causes <strong>infusion reactions</strong> like skin flushing, flu-like symptoms, muscle, and joint aches.</li>\n<li><strong>Nephrotoxicity</strong></li>\n<li>Hypocalcemia</li>\n<li><strong>Osteonecrosis of jaw bone</strong></li>\n<li>Increased risk of femoral shaft fractures</li>\n</ul>\n<p>Postmenopausal osteoporosis is an exaggerated form of bone depletion that accompanies aging and loss of gonadal activity. Other risk factors of osteoporosis are:</p>\n<ul>\n<li><strong>Age</strong></li>\n<li><strong>Female sex</strong></li>\n<li class=\"p1\">Alcohol</li>\n<li class=\"p1\">Smoking</li>\n<li class=\"p1\">Previous history of fragility fractures</li>\n<li class=\"p1\">Family history of hip fracture</li>\n<li class=\"p1\">Low body mass index- less than 18.5 kg/m<sup><span class=\"s1\">2</span></sup></li>\n<li class=\"p1\">Excessive usage of <strong>glucocorticoids</strong></li>\n</ul>\n<p>They present with fractures that occur without any trauma or as a result of low-impact trauma. The commonly associated fractures are fractures of the distal part of the <strong>radius</strong> (Colle's fracture), fractures of the<strong>&nbsp;hip</strong>, and fractures of the&nbsp;<strong>vertebrae</strong>.&nbsp;</p>\n<p>Other options:&nbsp;</p>\n<p>Option A: <strong>Estrogen</strong> supplementation is <strong>not</strong> effective for postmenopausal osteoporosis.</p>\n<p>Option C: <strong>Teriperatide</strong> is a <strong>parathormone analogue</strong> that is used in the treatment of severe osteoporosis (T-score &lt; &ndash;2.5).</p>\n<p>Option D: <strong>Denosumab</strong> is a <strong>monoclonal antibody</strong> against <strong>RANK receptors</strong> and is used for severe osteoporosis (T-score &lt; &ndash;2.5).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 30-year-old man who just came back from a trip to Brazil presents with fever, headache, and rash for the last 3 days. He is diagnosed with Rocky Mountain spotted fever. Which of the following correctly describes the mechanism of action of the drug which should be used to treat him?",
    "choices": [
      {
        "id": 1,
        "text": "Inhibits DNA gyrase, topoisomerase IV"
      },
      {
        "id": 2,
        "text": "Acts on 50s subunit and inhibits protein synthesis"
      },
      {
        "id": 3,
        "text": "Acts on transpeptidase and inhibits cell wall synthesis"
      },
      {
        "id": 4,
        "text": "Acts on 30s subunit and inhibits protein synthesis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Doxycycline</strong> is the drug of choice for <strong>Rocky Mountain spotted fever</strong>. It belongs to the <strong>tetracycline</strong> group of antimicrobials. It acts on the&nbsp;<strong>30s bacterial ribosome subunit</strong> and inhibits bacterial protein synthesis.</p>\n<p>Therapeutic uses of tetracyclines include:</p>\n<ul>\n<li><strong>Rickettsial infections</strong> such as <strong>Rocky Mountain spotted fever</strong>, scrub typhus, and Q fever</li>\n<li><strong>Pneumonia</strong> due to <em>Steptococcus pneumonia</em>, <em>H. influenzae&nbsp;</em>and atypical organisms</li>\n<li><strong>Sexually transmitted infections</strong> like <em>Chlamydia</em> <em>trachomatis</em></li>\n<li>Prevention and treatment of <strong>anthrax</strong></li>\n<li><em>Brucella</em>, <em>Bartonella</em>, <em>Borrelia</em> infections</li>\n<li><em>Mycobacterium marinum&nbsp;</em>(swimming pool granuloma)</li>\n</ul>\n<p>Tetracyclines are incompletely absorbed from the gut, leading to <strong>alteration of the gut flora</strong> due to the high concentration which is left unabsorbed in the intestines. This can cause an <strong>overgrowth of some organisms</strong> such as <strong>yeasts</strong>, <em><strong>Enterococci</strong></em> and <em><strong>Pseudomonas</strong></em> during prolonged tetracycline therapy. <strong>Children</strong> treated with tetracyclines may develop <strong>permanent brown discoloration of the teeth</strong>. The <strong>teratogenic</strong> effect associated with tetracyclines is their <strong>deposition in the fetal skeleton</strong> during pregnancy and <strong>depression of bone growth</strong> in infants.</p>\n<p><strong>Hepatotoxicity</strong> and <strong>nephrotoxicity</strong> can also occur. <strong>Demeclocycline</strong> causes <strong>nephrogenic diabetes insipidus</strong>, and has been used for the <strong>treatment of SiADH</strong>. Other side effects include <strong>idiopathic intracranial hypertension</strong> and vestibular toxicity.</p>\n<p>The main mechanism of <strong>resistance</strong> to tetracyclines is by a <strong>decreased antibiotic influx</strong> or acquisition of an <strong>energy-dependent efflux pump</strong> for the drug. Other mechanisms include a ribosomal protein that displaces tetracycline from its target and enzymatic inactivation of tetracyclines.</p>\n<p>Other options:</p>\n<p>Option A: Inhibition of <strong>DNA gyrase, topoisomerase IV</strong> is the mechanism of action of <strong>fluoroquinolones</strong>.</p>\n<p>Option B: The antibiotics which act on the <strong>50s subunit of bacterial ribosome</strong> include&nbsp;<strong>chloramphenicol</strong>, <strong>macrolides</strong>, <strong>clindamycin</strong>, <strong>linezolid,</strong> and <strong>streptogramins</strong>.</p>\n<p>Option C: Blocking of the <strong>transpeptidase enzyme</strong> and <strong>inhibition of cell wall synthesis</strong> is the mechanism of action of <strong>penicillins</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 60-year-old male patient diagnosed with Parkinson's disease is on levodopa for 1 year. He developed involuntary, rapid, irregular movements of hands, face, and legs 2 days back. What is the first line of treatment for the above presentation?",
    "choices": [
      {
        "id": 1,
        "text": "Apomorphine"
      },
      {
        "id": 2,
        "text": "Entacapone"
      },
      {
        "id": 3,
        "text": "Amantadine"
      },
      {
        "id": 4,
        "text": "Selegiline"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The above clinical scenario is suggestive of <strong>levodopa-induced dyskinesia.\u00a0</strong>The first line of treatment for this condition\u00a0is <strong>Amantadine</strong>.</p>\n<p>Normally, dopamine in the nigrostriatal pathway provides continuous (tonic) stimulation to the dopaminergic receptors in the striatum. In Parkinson's disease, there is a loss of these tonic signals as there is a loss of dopaminergic neurons of the nigrostriatal pathway. This reduced dopaminergic activity is compensated by the increased glutaminergic activity in the striatum.</p>\n<p>Levodopa that is administered in Parkinson's disease provides pulsatile (intermittent) signals to these dopamine receptors. Recent studies indicate that the\u00a0<strong>overactivity</strong> of the <strong>glutaminergic neurons</strong> in the striatum and <strong>pulsatile dopaminergic therapy</strong> (instead of normal tonic stimulation)<strong>\u00a0</strong>leads to altered signaling in the striatal neurons resulting\u00a0in levodopa-induced dyskinesia.</p>\n<p>Amantadine <strong>inhibits</strong> the <strong>NMDA receptors</strong>(glutaminergic receptors)\u00a0thereby mediating an anti-dyskinetic effect. It also has an anti-viral effect by interfering in the function of M2 protein and inhibiting viral replication. It is used in the treatment of influenza.</p>\n<p>Adverse effects:</p>\n<ul>\n<li><strong>Livedo reticularis </strong>is the appearance of non-blanching purplish dermal streaks</li>\n<li>Edema</li>\n<li>Contraindicated in renal, cardiovascular disease</li>\n</ul>\n<p>The image below shows <strong>livedo reticularis</strong>:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/72cf3ce8c782419a8b130cb0ccf0a764x600x448.JPEG"
    ]
  },
  {
    "text": "An 8 month-old baby is brought to the pediatric clinic with symptoms of diarrhea, hair loss and failure to thrive. On clinical examination, there is inflammation of the skin around the mouth and the perianal region as shown in the image. What is the preferred drug to treat this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Oral iron therapy"
      },
      {
        "id": 2,
        "text": "Oral zinc therapy"
      },
      {
        "id": 3,
        "text": "Oral vitamin B12 therapy"
      },
      {
        "id": 4,
        "text": "Oral vitamin B6 therapy"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>A child with&nbsp;symptoms of diarrhea, hair loss, and eczematous rash typically in the perioral and perineal region is characteristic of <strong>acrodermatitis</strong> <strong>enteropathica</strong>. It is due to zinc deficiency.&nbsp;<strong>Oral zinc therapy</strong> is the preferred drug.</p>\n<p>Acrodermatitis enteropathica is an <strong>autosomal</strong> <strong>recessive</strong> disorder caused by a mutation in the <strong>intestinal</strong> <strong>zinc</strong> <strong>transporter</strong> <strong>gene</strong>,&nbsp;<strong>SLC39A4</strong>, found on <strong>chromosome 8q24.3</strong>,&nbsp;which leads to <strong>zinc deficiency.</strong></p>\n<p>Children commonly present with <strong>symmetrical, eczematous plaques</strong> that become <strong>vesicular, bullous, pustular, </strong>or<strong> erosive</strong> with characteristic crusting at the edges.&nbsp;The <strong>perioral eruption</strong> usually spares the upper lip.</p>\n<p>Diagnosis by clinical features and low plasma zinc levels. <strong>Oral zinc therapy</strong> is the treatment of choice (3 mg/kg/24 h).&nbsp;</p>\n<p><strong>Mnemonic-</strong>&nbsp;<strong>DEAL</strong> for Acrodermatitis enteropathica:</p>\n<p><strong>D &ndash; </strong><strong>D</strong>iarrhoea</p>\n<p><strong>E &ndash; E</strong>czematous dermatitis</p>\n<p><strong>A - A</strong>lopecia</p>\n<p><strong>L &ndash; L</strong>ethargy</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/643ab1da9fa94a059807e981eff59c64.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "An adolescent girl presents with the complaint of dropping objects from her hands during morning hours and during exams. There is no history of loss of consciousness. EEG shows 4-5 Hz polyspike-and-slow waves that are enhanced by photic stimulation. What is the drug of choice for seizures in this girl?",
    "choices": [
      {
        "id": 1,
        "text": "Sodium valproate"
      },
      {
        "id": 2,
        "text": "Carbamazepine"
      },
      {
        "id": 3,
        "text": "Vigabatrin"
      },
      {
        "id": 4,
        "text": "Phenytoin"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p style=\"text-align: left;\">The given clinical scenario points towards a diagnosis of <strong>j</strong><strong>uvenile myoclonic epilepsy (Janz syndrome).&nbsp;</strong>The drug of choice for the seizure in this girl is <strong>sodium valproate.&nbsp;</strong></p>\n<p style=\"text-align: left;\">It is&nbsp;characterized by&nbsp;myoclonic jerks, which are most frequent in the <strong>morning</strong> with <strong>preserved consciousness</strong>. The jerks can manifest as<strong> dropping objects </strong>along with absence seizures.&nbsp;Sleep deprivation, alcohol, and <strong>photic stimulation</strong> act as triggers.&nbsp;The EEG shows <strong>4-5 polyspike</strong> and <strong>slow-wave discharges.&nbsp;</strong>Levetiracetam, lamotrigine, and topiramate are the other alternatives used.</p>\n<p style=\"text-align: left;\">Other options:</p>\n<p style=\"text-align: left;\">Option 3:&nbsp;<strong>Vigabatrin</strong>&nbsp;is the <strong>drug of choice</strong> for infantile spasm.</p>\n<p style=\"text-align: left;\">EEG findings of JME are shown below:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/333f4d0ddb1b43c4b8875d288b7d1641x800x389.JPEG"
    ]
  },
  {
    "text": "An HIV patient presents with fever, cough, chest discomfort, and shortness of breath for 1 week. On chest CT, a halo sign is seen.  On LPCB preparation, septate hyphae and conidiophores are seen. On the culture of bronchoalveolar lavage fluid, black colonies with galactomannan assay positive are obtained. Which of the following drugs is preferred in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Itraconazole"
      },
      {
        "id": 2,
        "text": "Voriconazole"
      },
      {
        "id": 3,
        "text": "Amphotericin B"
      },
      {
        "id": 4,
        "text": "5-fluorocytosine"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The above clinical scenario is suggestive of <strong>acute</strong>&nbsp;<strong>invasive pulmonary aspergillosis.&nbsp;Voriconazole </strong>is the preferred drug in this condition.<strong>&nbsp;</strong></p>\n<p><strong>Invasive aspergillosis</strong>&nbsp;occurs due to infection with <em>Aspergillus</em> species. Most cases of invasive aspergillosis involve the lungs. The clinical features include fever, cough which may be productive, chest discomfort, hemoptysis, and shortness of breath.</p>\n<p>It is often seen in immunocompromised or debilitated due to prolonged treatment with antibiotics, steroids, and cytotoxics.</p>\n<p>Other manifestations of aspergillus species are allergic bronchopulmonary aspergillosis, aspergilloma, and superficial infections of the eye, external ear, and nasal sinuses.</p>\n<p>Diagnosis of invasive aspergillosis is made when the following findings are observed:</p>\n<ul>\n<li><strong>A positive culture</strong> from the affected organ</li>\n<li>Aspergillus antigen detection of <strong>galactomannan</strong></li>\n<li>Narrow, <strong>septate hyphae</strong> with branching at <strong>45<sup>o</sup></strong> and conidiophores</li>\n<li><strong>Halo sign</strong> on CT scan</li>\n</ul>\n<p>The image below shows <strong>septate hyphae</strong> with 45<sup>o</sup> branching and <strong>conidiophores</strong>:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/80af9a1ef8334da2a617f41d2fdfd658x512x191.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8ef240f3171b4a618f8d992495650e55x512x384.PNG"
    ]
  },
  {
    "text": "A 35-year-old man complained of low mood, decreased appetite, and loss of weight for the past 2 months. He mentions that he feels worthless and has decreased interest in activities. He also complains of great difficulty falling asleep. He has past history of atrial fibrillation. Which of the following drugs should be preferred for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Fluoxetine"
      },
      {
        "id": 2,
        "text": "Venlafaxine"
      },
      {
        "id": 3,
        "text": "Imipramine"
      },
      {
        "id": 4,
        "text": "Mirtazapine"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The patient in the given clinical scenario has\u00a0<strong>major depression</strong> with <strong>insomnia</strong>, <strong>decreased appetite</strong>,\u00a0and\u00a0<strong>weight loss</strong>.\u00a0The preferred drug for this patient is\u00a0<strong>mirtazapine</strong>\u00a0as it is an antidepressant with <strong>sedative</strong> and <strong>appetite-stimulating</strong> properties.</p>\n<p><strong>Mirtazapine</strong> is an <strong>atypical antidepressant</strong> (a noradrenergic-specific\u00a0serotonin antagonist). It blocks the presynaptic\u00a0\u03b1<sub>2</sub> receptors and postsynaptic 5HT<sub>2</sub>\u00a0and 5HT<sub>3</sub> receptors. The antagonism at serotonin receptors helps relieve anxiety<strong>\u00a0</strong>and <strong>insomnia</strong> and <strong>stimulates</strong> <strong>appetite</strong>. It has a sedative property as it blocks the H<sub>1</sub> receptors.\u00a0Mirtazapine is used in the treatment of <strong>major depression\u00a0</strong>with long-standing\u00a0<strong>insomnia</strong>.</p>\n<p>Adverse effects include sedation, increased appetite, weight gain, and rarely\u00a0agranulocytosis.\u00a0Sexual dysfunction\u00a0is\u00a0not\u00a0a known side-effect of mirtazapine.</p>\n<p><strong>Atypical anti-depressants</strong> are those that act by <strong>unique mechanisms</strong> other than those of\u00a0selective serotonin reuptake inhibitor (SSRI),\u00a0serotonin-noradrenaline reuptake inhibitor (SNRI), MAO inhibitors, and tricyclic antidepressants. It includes drugs like <strong>trazodone</strong>, <strong>mianserin</strong>, <strong>bupropion</strong>, mirtazapine, and <strong>amoxapine</strong>.</p>\n<p>Other options:</p>\n<p>Option A: <strong>Fluoxetine</strong> is an\u00a0<strong>SSRI\u00a0</strong>used in the treatment of <strong>major depression</strong>, obsessive-compulsive disorder, post-traumatic stress disorder, <strong>bulimia</strong> and <strong>anorexia nervosa</strong>, and generalized anxiety disorders. It may cause\u00a0<strong>insomnia</strong>, and<strong>\u00a0</strong>hence, it is avoided in this patient. Other\u00a0adverse effects include anxiety, irritability, and decreased libido.</p>\n<p>Option B: <strong>Venlafaxine</strong> is an\u00a0<strong>SNRI</strong>\u00a0used in the treatment of <strong>major depression</strong>, generalized anxiety disorder, and panic disorder. It may cause\u00a0<strong>insomnia</strong>, and\u00a0hence, it is avoided in this patient. Other adverse effects are nausea,<strong>\u00a0sexual dysfunction,</strong>\u00a0and <strong>sustained elevation</strong> of <strong>blood pressure</strong>.</p>\n<p>Option C: <strong>Imipramine</strong> is a <strong>tricyclic antidepressant</strong>\u00a0used in the treatment of <strong>major depression\u00a0</strong>and<strong>\u00a0nocturnal enuresis</strong>. Its use should be<strong> limited</strong> in <strong>heart diseases</strong> as it has quinidine-like effects on cardiac conduction, and\u00a0hence, it is avoided in this patient.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the chemotherapeutic agent of choice for the management of metastatic gastrointestinal stromal tumor?",
    "choices": [
      {
        "id": 1,
        "text": "Erlotinib"
      },
      {
        "id": 2,
        "text": "Imatinib"
      },
      {
        "id": 3,
        "text": "Sorafenib"
      },
      {
        "id": 4,
        "text": "Dasatinib"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Imatinib</strong> is the chemotherapeutic agent of choice for <strong>metastatic gastrointestinal stromal tumors </strong>(GIST).</p>\n<p><strong>Imatinib</strong> is a <strong>tyrosine kinase inhibitor</strong>. In GIST, it inhibits the mutant c-KIT gene. Its adverse effects include <strong>myelosuppression</strong>, diarrhea, nausea, vomiting, edema, and periorbital swelling.</p>\n<p><strong>Gastrointestinal stromal tumors (GIST) </strong>are <strong>mesenchymal</strong> <strong>tumors</strong> originating from the <strong>interstitial</strong> <strong>cells</strong> <strong>of</strong> <strong>Cajal</strong>, located in the gastrointestinal myenteric plexus. The most common mutation associated with GIST is the <strong>c-KIT </strong>gene mutation. They compromise 1-3% of all gastrointestinal tumors. The most common sites are the stomach, small bowel, and rectum. They are considered to have <strong>metastatic potential</strong> if <strong>larger than 5cm</strong>.</p>\n<p>Symptoms of GIST include pain abdomen, nausea, vomiting, hematemesis, and malena.</p>\n<p>They are diagnosed on <strong>endoscopy</strong> and can be confirmed by targeted biopsy by endoscopic ultrasound. The primary mode of treatment is <strong>surgical resection</strong> if they are easily resectable. Smaller tumors (&lt;5cm) are treated by wedge resection and larger tumors (&gt;5cm) may require gastrectomy or duodenectomy, with 3-6 months of <strong>imatinib therapy</strong> before operation. Imatinib therapy should be continued for large tumors with high malignant potential.</p>\n<p>Other options:</p>\n<p>Option A: <strong>Erlotinib</strong> is an EGFR tyrosine kinase inhibitor. It is used in the management of <strong>non-small cell lung cancer</strong> and <strong>pancreatic cancer</strong>.\u00a0</p>\n<p>Option C: <strong>Sorafenib</strong> is an intracellular kinase inhibitor. It is used in the management of <strong>hepatocellular carcinoma</strong>.</p>\n<p>Option D: <strong>Dasatinib</strong> is a BCR-ABL tyrosine kinase inhibitor. It is used in the management of<strong>\u00a0imatinib-resistant CML</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 40-year-old female patient was posted for unilateral mastectomy for breast carcinoma. Halothane was used as the inhalational agent. Intraoperatively, she develops fever and tachycardia. On physical examination, rigidity was noted in the masseter muscle. What is the drug of choice for the management of this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Succinylcholine"
      },
      {
        "id": 2,
        "text": "Dantrolene"
      },
      {
        "id": 3,
        "text": "Isoflurane"
      },
      {
        "id": 4,
        "text": "Vecuronium"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The above clinical scenario of a patient developing <strong>fever</strong>, <strong>tachycardia</strong>, and <strong>rigidity of the masseter muscle</strong> after being administered <strong>halothane</strong> is suggestive of <strong>malignant hyperthermia</strong>.<strong>\u00a0</strong>The <strong>drug</strong> <strong>of</strong> <strong>choice</strong> for the condition is<strong> dantrolene</strong>.</p>\n<p>Dantrolene is a <strong>direct-acting</strong> skeletal muscle <strong>relaxant</strong> that acts on the <strong>RyR1</strong> (ryanodine receptor) <strong>calcium</strong> <strong>channels</strong> in the <strong>sarcoplasmic</strong> <strong>reticulum</strong> of skeletal muscles and <strong>inhibits calcium-induced calcium release</strong>. This results in the\u00a0uncoupling of membrane depolarization and muscle contraction, thus inhibiting muscle contraction.</p>\n<p><strong>Malignant hyperthermia</strong> is a genetic condition in which <strong>mutated</strong> <strong>RyR1</strong><strong>\u00a0receptors</strong> are present in the skeletal muscles. In the presence of certain triggers, this mutated RyR1 causes severe dysfunction in the RyR1 channels. This leads to the accumulation of calcium ions in the sarcoplasmic reticulum resulting in sustained muscle contraction, rigidity, increased heat production, acidosis, hyperkalemia, and increased end-tidal CO<sub>2</sub>. Patients with <strong>positive family history</strong> and patients with <strong>congenital myopathies</strong> are at <strong>increased risk</strong> for the development of this condition.</p>\n<p>Drugs triggering malignant hyperthermia:</p>\n<ul>\n<li>Succinylcholine</li>\n<li>Halothane</li>\n<li>Isoflurane</li>\n<li>Sevoflurane</li>\n</ul>\n<p>Dantrolene<strong> </strong>sodium is the drug<strong> </strong>of<strong> </strong>choice for malignant hyperthermia. Once the diagnosis is made, the causative inhalational agent should be stopped immediately. Supportive management includes rapid cooling, inhalation of 100% oxygen, control of acidosis, and treatment of hyperkalemia.</p>\n<p>Other options:</p>\n<p>Options A and C: <strong>Succinylcholine</strong> and <strong>isoflurane</strong> are known to cause malignant hyperthermia, and hence cannot be used for the management.</p>\n<p>Option D: <strong>Vecuronium</strong> is a non-depolarizing skeletal muscle relaxant. It is not indicated for the management of malignant hyperthermia.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the treatment of choice to ameliorate the non-neural manifestations of mucopolysaccharidosis II?",
    "choices": [
      {
        "id": 1,
        "text": "Aldurazyme"
      },
      {
        "id": 2,
        "text": "Alglucosidase alfa"
      },
      {
        "id": 3,
        "text": "Elaprase"
      },
      {
        "id": 4,
        "text": "Nagalzyme"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Elaprase </strong>(recombinant iduronate-2-sulfatase)\u00a0is the treatment of choice to ameliorate the non-neural manifestations of mucopolysaccharidosis II/<strong>Hunter syndrome</strong>.</p>\n<p><strong>Mucopolysaccharidoses</strong>\u00a0are a group of <strong>lysosomal storage</strong> metabolic disorders\u00a0caused by the absence or malfunctioning of\u00a0lysosomal\u00a0enzymes needed to break down molecules called\u00a0glycosaminoglycans. There are 7 distinct classes of mucopolysaccharidosis which are further subcategorized.</p>\n<p><strong>Hunter syndrome</strong>\u00a0is an <strong>X-linked recessive</strong> disorder caused due to deficiency of <strong>iduronate-2-sulfatase</strong>. This enzyme deficiency leads to the accumulation of <strong>heparan sulfate</strong> and <strong>dermatan sulfate.</strong> It almost exclusively manifests in males.</p>\n<p><strong>Clinical features</strong> of Hunter syndrome are similar to Hurler syndrome\u00a0(mucopolysaccharidosis I)\u00a0<strong>except</strong> for the <strong>corneal clouding</strong> and slow progression of central nervous system deterioration. Other features are:</p>\n<ul>\n<li>Short stature</li>\n<li>Hearing impairment</li>\n<li>Coarse facial features</li>\n<li>Mongolian spots</li>\n<li>Joint stiffness, carpal tunnel syndrome</li>\n<li>Chronic diarrhea</li>\n<li>Valvular cardiac disease</li>\n<li>Intellectual disability</li>\n<li>Spastic paraplegia</li>\n<li>Communicating hydrocephalus</li>\n</ul>\n<p>Diagnosis:</p>\n<ul>\n<li>Newborn screening using dried blood spots</li>\n<li>Semiquantitative analysis of increased urinary glycosaminoglycans(GAG)</li>\n<li>Quantitative analysis of single GAG</li>\n<li>Definitive diagnosis by <strong>enzyme assay</strong></li>\n</ul>\n<p><strong>Elaprase\u00a0</strong>(recombinant iduronate-2-sulfatase)<strong>\u00a0</strong>is the treatment of choice to ameliorate the <strong>non-neural manifestations</strong>. Early hematopoietic stem cell transplantation may have some effects. Hematopoietic stem cell transplantation when done before 9 months of age results in normal cognitive development. Transplantation does not have any effect on neuropsychological manifestation when impaired cognition is already present at the time of transplantation. Symptomatic therapy is given for most neurological manifestations.</p>\n<p>Other options:</p>\n<p>Option A: <strong>Aldurazyme\u00a0</strong>(recombinant L-iduronidase) is approved as enzyme replacement therapy for <strong>Hurler syndrome\u00a0</strong>(mucopolysaccharidosis I).</p>\n<p>Option B: <strong>Alglucosidase alfa\u00a0</strong>(recombinant\u00a0\u03b1-glucosidase) is the enzyme replacement therapy for <strong>Pompe disease.</strong></p>\n<p>Option D: <strong>Nagalzyme\u00a0</strong>(recombinant N-acetylgalactosamine-4-sulfatase) is the enzyme replacement therapy for <strong>Maroteux-Lamy syndrome\u00a0</strong>(mucopolysaccharidosis VI).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 30-year-old woman presented with itching and malodorous discharge in the vagina. Whiff's test was positive and microscopy of the discharge is shown below.  What is the drug of choice for this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Ampicillin"
      },
      {
        "id": 2,
        "text": "Ciprofloxacin"
      },
      {
        "id": 3,
        "text": "Metronidazole"
      },
      {
        "id": 4,
        "text": "Clotrimazole"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The clinical scenario, a positive Whiff test and clue cells on microscopy point towards a diagnosis of <strong>bacterial vaginosis.&nbsp;Metronidazole&nbsp;</strong>(oral or intravaginal) or intravaginal <strong>clindamycin </strong>are considered the drugs of choice.&nbsp;</p>\n<p>The male partner should be treated in case of recurrent infections of bacterial vaginosis.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e4449bab169741b798f3407876a157bf.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 55-year-old female patient presents with diminished vision, headache, and eye pain. She had a history of herpes infection. On examination, there is an increase in IOP. The ophthalmologist prescribes an eye drop for increased  IOP. After a week, the patient presents with herpetic keratitis. Which of the following is the most likely drug to have favored the development of herpetic keratitis?",
    "choices": [
      {
        "id": 1,
        "text": "Timolol"
      },
      {
        "id": 2,
        "text": "Latanoprost"
      },
      {
        "id": 3,
        "text": "Brimonidine"
      },
      {
        "id": 4,
        "text": "Dorzolamide"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Latanoprost</strong> is the most likely drug to\u00a0have favored the development of herpetic keratitis in this patient.</p>\n<p><strong>Latanoprost</strong> is a <strong>prostaglandin analogue</strong> and acts by increasing the uveoscleral outflow thus reducing the IOP. Latanoprost is <strong>preferred</strong> over\u00a0\u03b2-blockers due to its decreased systemic side effects.\u00a0</p>\n<p>Prostaglandin analogues induce the release of endogenous prostaglandins in the iris and ciliary which enhances the cell-to-cell spread of HSV resulting in reactivation of the herpes infection.\u00a0</p>\n<p>Adverse effects:</p>\n<ul>\n<li><strong>conjunctival hyperaemia</strong></li>\n<li><strong>eyelash thickening</strong>\u00a0</li>\n<li><strong>iris pigmentation</strong>\u00a0</li>\n<li>promotion of <strong>herpetic keratitis\u00a0</strong>in a patient with a <strong>history of herpes infection</strong></li>\n<li>if used preoperatively, cystoid macular edema following cataract surgery</li>\n</ul>\n<p><strong style=\"text-align: justify;\">Primary open-angle glaucoma </strong><span style=\"text-align: justify;\">(POAG)</span><strong style=\"text-align: justify;\">\u00a0</strong><span style=\"text-align: justify;\">is a bilateral, symmetrical disease with an adult-onset type. In this condition, there is an increase in the IOP due to trabecular sclerosis leading to decreased aqueous outflow. The clinical features include headache, difficulty in dark adaptation, frequent change of glasses, and blurring of vision.\u00a0</span></p>\n<p>On ocular examination, an <strong>open anterior chamber angle</strong>, <strong>glaucomatous optic nerve head changes</strong>, <strong>visual field defect</strong>s, and an <strong>increased IOP</strong> of more than <strong>21mmHg </strong>are noted.</p>\n<p>Other options:</p>\n<p>Option A- Timolol is a <strong>non-selective\u00a0\u03b2-blocker</strong> that decreases the IOP by <strong>reducing</strong> the <strong>aqueous humor production</strong> through blockade of the\u00a0<strong>\u03b2-receptors</strong> on the <strong>ciliary epithelium. </strong>The adverse effects include:</p>\n<ul>\n<li>Ocular effects are allergy, decreased corneal sensation, and <strong>punctate keratitis</strong></li>\n<li>Systemic effects-\n<ul>\n<li>Potentially fatal <strong>bronchospasm</strong> in <strong>asthmatic patients</strong> and reversible airway diseases due to blockade of\u00a0\u03b2<sub>2</sub> receptors in bronchial smooth muscle</li>\n<li>Heart blocks, bradycardia, worsening of heart failure, and hypotension are some of the cardiovascular adverse effects</li>\n</ul>\n</li>\n</ul>\n<p>Option C-\u00a0<strong>Brimonidine</strong>\u00a0is a <strong>selective alpha-2</strong> <strong>agonist\u00a0</strong>which decreases aqueous synthesis and increases uveoscleral outflow. It can cross the blood-brain barrier and, hence, causes <strong>drowsiness and CNS depression</strong>. It is\u00a0<strong>contraindicated</strong> in <strong>infants</strong> and <strong>children</strong>.</p>\n<p>Option D- <strong>Dorzolamide</strong> is a topical <strong>carbonic anhydrase inhibitor</strong> that decreases IOP by reducing aqueous formation. The main adverse effect is the <strong>bitter taste</strong> following administration. It is <strong>contraindicated</strong> in people with allergies to sulfonamide antibiotics.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the drug of choice for lithium-induced nephrogenic diabetes insipidus?",
    "choices": [
      {
        "id": 1,
        "text": "Demeclocycline"
      },
      {
        "id": 2,
        "text": "Thiazide diuretics"
      },
      {
        "id": 3,
        "text": "Tolvaptan"
      },
      {
        "id": 4,
        "text": "Amiloride"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The<strong> drug of choice</strong> for <strong>lithium-induced nephrogenic diabetes</strong>\u00a0<strong>insipidus</strong> is <strong>amiloride</strong>.</p>\n<p>Amiloride belongs to the <strong>K<sup>+</sup>-sparing diuretic group</strong>. It is a renal epithelial Na<sup>+</sup> channel(ENac) inhibitor in collecting duct cells. Lithium enters through the ENac and inhibits the action of the anti-diuretic hormone. Amiloride <strong>blocks</strong> the<strong> entry </strong>of<strong> Li<sup>+</sup> </strong>ion through the<strong> ENac</strong>\u00a0and thus mitigates diabetes insipidus induced by lithium.</p>\n<p>The most important adverse effect of amiloride is <strong>hyperkalemia</strong>. Other adverse effects include nausea, vomiting, diarrhoea, and headache.</p>\n<p>Other options:</p>\n<p>Option A:\u00a0<strong>Demeclocycline</strong> belongs to the tetracycline group of antibiotics. It interferes with the anti-diuretic hormone action but is used in the <strong>treatment</strong> of the syndrome of inappropriate antidiuretic hormone(<strong>SIADH</strong>).\u00a0</p>\n<p>Option B:\u00a0<strong>Thiazide diuretics</strong> inhibit the <strong>Na<sup>+</sup>-Cl<sup>-</sup> symport</strong> present in the distal convoluted tubule of the nephron. It is used in the <strong>treatment</strong> of <strong>nephrogenic diabetes insipidus</strong> by decreasing the ability of the kidney to excrete free water. It increases the reabsorption of water in the proximal tubule and reduces the ability of the distal tubule to dilute the urine.\u00a0</p>\n<p>Option C:\u00a0<strong>Tolvaptan</strong> is a vasopressin antagonist used in the treatment of SIADH, hypervolemic and euvolemic hyponatremia.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 22-year-old male patient complains of pruritis. He feels intense pruritus and has painful, red streaks between his fingers and in the groin area. He states that the itchiness is worse at night. Other students from his college dormitory also present with similar complaints. An image of his skin on physical examination is shown below. Which of the following can be used for the treatment of this patient?",
    "choices": [
      {
        "id": 1,
        "text": "5 % permethrin cream"
      },
      {
        "id": 2,
        "text": "Oral albendazole"
      },
      {
        "id": 3,
        "text": "5% lindane lotion"
      },
      {
        "id": 4,
        "text": "Topical corticosteroids"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The clinical vignette describes a case of <strong>scabies</strong>. Management of scabies involves&nbsp;topical application <strong>of 5%</strong> <strong>permethrin cream.</strong></p>\n<p>The image shows a magnified view of a <strong>burrowing trail of the scabies mite</strong>. The scaly patch on the left was caused by the scratching and marks the mite's entry point into the skin. The mite has burrowed to the top-right, where it can be seen as a dark spot at the end. <strong>Burrow</strong> is the characteristic lesion of scabies.</p>\n<p><strong>Scabies</strong> is an <strong>ectoparasitic</strong> <strong>infestation</strong> caused in humans by the <strong>Sarcoptes scabiei var. hominis.</strong></p>\n<p>The characteristic symptoms of a scabies infection include <strong>intense itching</strong> and <strong>superficial</strong> <strong>burrows</strong>.&nbsp;Burrows present as slightly raised <strong>brownish tortuous</strong> lesions. It is&nbsp;created by the excavation of the <strong>adult</strong> <strong>mite</strong> in the <strong>epidermis</strong>.&nbsp;In most people, the trails of the burrowing mites are <strong>linear</strong>&nbsp;in the skin.</p>\n<p>Typical locations of lesions are the <strong>finger webs, the flexor surfaces of the wrists</strong>, the elbows, the axillae, the buttocks and genitalia, and the breasts of women.</p>\n<p>Other treatment options - topical application of <strong>1% lindane lotion</strong>, benzyl benzoate, esdepalletrin (bioallethrin), crotamiton, and precipitated sulfur.</p>\n<p>Other options:</p>\n<p>Option B- <strong>Oral albendazole</strong> is used in the treatment of <strong>larva currens</strong> and <strong>c</strong><strong>utaneous larva migrans. </strong>They&nbsp;present as&nbsp;pruritic erythematous papules at the site of penetration of the hookworms with an erythematous serpiginous larva track.</p>\n<p>The image below shows <strong>cutaneous larva migrans</strong>:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/42fad614b73f47d4b8413d567cf3dd8b.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c80ed4ef43b14c0ca07ac4283d6bf16cx720x633.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2de7648a4da64427b815b68715998fd9x720x473.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e9ec1c51295749369a99ad75f9ae745dx720x749.JPEG"
    ]
  },
  {
    "text": "An elderly male patient with a history of  Mycobacterium avium complex infection presented with fatigue and a dragging sensation in the left upper abdomen. On examination, massive splenomegaly with no lymphadenopathy was found. His peripheral smear is as shown below. What is the drug of choice for this malignancy?",
    "choices": [
      {
        "id": 1,
        "text": "Vemurafenib"
      },
      {
        "id": 2,
        "text": "Pentostatin"
      },
      {
        "id": 3,
        "text": "Interferon \u03b1"
      },
      {
        "id": 4,
        "text": "Cladribine"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p style=\"text-align: justify;\">The clinical scenario and the findings of leukemic cells&nbsp;with<strong> fine hair-like projections</strong> in the peripheral smear are suggestive of<strong>&nbsp;</strong>hairy cell leukemia. <strong>Cladribine</strong> is the <strong>drug of choice</strong> for the treatment of <strong>hairy cell leukemia.</strong></p>\n<p style=\"text-align: justify;\">Hairy cell leukemia is responsive to chemotherapy with interferon &alpha;, pentostatin, and cladribine. However, cladribine, <strong>a purine analogue</strong> is the preferred drug of choice as complete remission with cladribine occurs clinically in the majority of patients and long-term disease-free survival is frequent.&nbsp;Cladribine is administered daily for 7 days by continuous intravenous infusion.</p>\n<p style=\"text-align: justify;\">Chemotherapy-refractory patients have&nbsp;responded to <strong>vemurafenib, a BRAF inhibitor.</strong></p>\n<p style=\"text-align: justify;\">Splenectomy is often&nbsp;associated with prolonged remission.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ff324cc45a924a0d885c240d2b8ff5a1.JPEG"
    ],
    "explanation_images": []
  }
];
        let quizName = 'Mini Test 11- Drugs Of Choice Only';
        const quizFilename = 'mini-test-11-drugs-of-choice-only-c8bdd073.html';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2021-22"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>