<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fmge Mini Test - 023 - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / FMGE Mini Test Series / 2022
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">30</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following cranial nerves is a pure sensory nerve?",
    "choices": [
      {
        "id": 1,
        "text": "Olfactory"
      },
      {
        "id": 2,
        "text": "Trochlear"
      },
      {
        "id": 3,
        "text": "Trigeminal"
      },
      {
        "id": 4,
        "text": "Abducent"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The <strong>olfactory</strong> nerve is a <strong>pure sensory nerve</strong>. It carries no motor fibers.</p>\n<ul>\n<li>Olfactory: Sensory</li>\n<li>Optic: Sensory</li>\n<li>Oculomotor: Motor</li>\n<li>Trochlear: Motor</li>\n<li>Trigeminal: Both&nbsp;</li>\n<li>Abducent: Motor</li>\n<li>Facial: Both</li>\n<li>Vestibulocochlear: Sensory</li>\n<li>Glossopharyngeal: Both</li>\n<li>Vagus: Both</li>\n<li>Accessory: Motor</li>\n<li>Hypoglossal: Motor</li>\n</ul>\n<p>\"Both\" stands for a mixed nerve (both motor and sensory).</p>\n<p>Mnemonic: <strong>S</strong>ome <strong>S</strong>ay <strong>M</strong>arry <strong>M</strong>oney <strong>B</strong>ut <strong>M</strong>y <strong>B</strong>rother <strong>S</strong>ays <strong>B</strong>ig <strong>B</strong>rain <strong>M</strong>atters <strong>M</strong>ore.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Vasopressin has maximum effect on which part of the renal tubule?",
    "choices": [
      {
        "id": 1,
        "text": "Proximal tubule"
      },
      {
        "id": 2,
        "text": "Distal tubule"
      },
      {
        "id": 3,
        "text": "Loop of henle"
      },
      {
        "id": 4,
        "text": "Collecting duct"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Vasopressin has the&nbsp;maximum effect on the collecting ducts.</p>\n<p>Vasopressin acts by inserting<strong> aquaporin 2</strong> present in cytoplasmic vesicles of <strong>principal cells on to the apical membrane</strong>.&nbsp;The effect is mediated via the vasopressin V2 receptor, cyclic adenosine 5-monophosphate (cAMP), and protein kinase A.&nbsp;When <strong>vasopressin is absent</strong>, the <strong>collecting duct</strong> epithelium is relatively <strong>impermeable to water.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9f84bdcfc1c34778bfbd6642c2d8e9d3x1280x2173.JPEG"
    ]
  },
  {
    "text": "A 36-year-old man presented with complaints of bluish-black discolouration of sclera and pinna for last 6 months. Since childhood, his urine turns black on standing as shown in the image below. What is the most probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Phenylketonuria"
      },
      {
        "id": 2,
        "text": "Alkaptonuria"
      },
      {
        "id": 3,
        "text": "Tyrosinemia"
      },
      {
        "id": 4,
        "text": "Maple syrup urine disease"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Blackening</strong> <strong>of urine</strong> on standing is characteristic of <strong>alkaptonuria</strong>&nbsp;and results due to excretion of <strong>homogentisic acid</strong> in the urine.</p>\n<p>It is an autosomal recessive condition due to <strong>deficiency</strong> of <strong>homogentisate oxidase&nbsp;</strong>(also called<strong>&nbsp;</strong>homogentisate 1,2-dioxygenase).</p>\n<p>The homogentisic acid is then oxidized to benzoquinone acetate and polymerized to form <strong>black-coloured alkapton bodies</strong>, which deposits in soft tissues like cartilage and is called as <strong>ochronosis.</strong></p>\n<p>Image A - Normal urine<br />Image B - Alkaptonuria</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a9f90b03b6b44b3dbeabc3844777c16a.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c4298c90589b42caa94eb67da6696ea0x1280x950.JPEG"
    ]
  },
  {
    "text": "Dutcher bodies are seen in_____.",
    "choices": [
      {
        "id": 1,
        "text": "CML"
      },
      {
        "id": 2,
        "text": "AML"
      },
      {
        "id": 3,
        "text": "Myeloma"
      },
      {
        "id": 4,
        "text": "Hodgkin lymphoma"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Dutcher bodies are pale-staining intranuclear inclusions within plasma cells containing Ig, which are more common in IgA myeloma.</p>\n<ul>\n<li><strong>Russell bodies</strong>: Hyaline intracytoplasmic inclusions containing Ig.</li>\n<li><strong>Mott cells/morula cells</strong>: Plasma cells containing multiple grape-like cytoplasmic inclusions comprised of Ig</li>\n<li><strong>Flame cells</strong>: Vermillion-staining, glycogen-rich IgA in cytoplasmic projections</li>\n<li><strong>Thesaurocytes</strong>: Dilated endoplasmic reticulum cisternae</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://cdn1.dailyrounds.org/uploads/6649bdfd86a64c3f9b04adec3b196063x387x272.PNG"
    ]
  },
  {
    "text": "A patient presented with vomiting to medicine OPD. He has a history of eating fried rice. What is the most likely organism causing this?",
    "choices": [
      {
        "id": 1,
        "text": "Clostridium perfringens"
      },
      {
        "id": 2,
        "text": "Bacillus cereus"
      },
      {
        "id": 3,
        "text": "Staphylococcus aureus"
      },
      {
        "id": 4,
        "text": "Bacillus anthracis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Food poisoning&nbsp;after eating fried rice is due to<strong>&nbsp;Bacillus cereus.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the drug of choice for drug induced Parkinson\u2019s disease?",
    "choices": [
      {
        "id": 1,
        "text": "Levodopa"
      },
      {
        "id": 2,
        "text": "Benzhexol"
      },
      {
        "id": 3,
        "text": "Amantidine"
      },
      {
        "id": 4,
        "text": "Selegilline"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The<strong> drug of choice </strong>for <strong>drug-induced Parkinson&rsquo;s</strong> disease is<strong> benzhexol.</strong></p>\n<p>Benzhexol is an <strong>antimuscarinic agent</strong>. Drug-induced parkinsonism is a condition that is caused by certain drugs that have <strong>D<sub>2</sub> antagonistic action</strong> like <strong>typical antipsychotics</strong>. Due to the decrease in dopaminergic activity, they result in an unbalanced cholinergic activity. Benzhexol is a&nbsp;<strong>centrally-acting&nbsp;</strong>antimuscarinic agent. It acts by restoring the cholinergic balance in the striatal interneurons.&nbsp;</p>\n<p>The following drugs are implicated in drug-induced parkinsonism:</p>\n<table width=\"308\">\n<tbody>\n<tr>\n<td><strong>Drug class</strong></td>\n<td>\n<p><strong>Examples&nbsp;</strong></p>\n</td>\n</tr>\n<tr>\n<td><strong>Typical antipsychotics</strong></td>\n<td>\n<p>Phenothiazines, haloperidol</p>\n</td>\n</tr>\n<tr>\n<td><strong>Atypical antipsychotics</strong></td>\n<td>Risperidone, olanzapine</td>\n</tr>\n<tr>\n<td><strong>Dopamine depleters</strong></td>\n<td>Reserpine, tetrabenazine</td>\n</tr>\n<tr>\n<td><strong>Antiemetics</strong></td>\n<td>Metoclopramide, levosulpiride</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The incision preferred during autopsy in case of asphyxial death due to neck compression is?",
    "choices": [
      {
        "id": 1,
        "text": "I shaped incision"
      },
      {
        "id": 2,
        "text": "Modified Y shaped incision"
      },
      {
        "id": 3,
        "text": "Y shaped incision"
      },
      {
        "id": 4,
        "text": "Elongated X shaped incision"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The incision preferred in the case of asphyxial death due to neck compression is the<strong>&nbsp;modified Y shaped incision.</strong></p>\n<p>In strangulation, hanging, and any condition where the larynx might be damaged, modified Y shaped incision is to be preferred, as the skin of the upper neck can then be dissected off the mandible and raised clear to give a wide approach to the neck structures.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7936d1aa390e490eba8aef0d06673327x1280x1461.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1efd6e6fdf7446749707ff0986981e4ax1280x1461.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a62432d2a6a64ea69b99385be4431ae1x1280x1462.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2b668e16807649d781f2c0a359e71723x1280x1462.JPEG"
    ]
  },
  {
    "text": "Cough on scratching the external acoustic canal is due to?",
    "choices": [
      {
        "id": 1,
        "text": "Auriculotemporal nerve"
      },
      {
        "id": 2,
        "text": "Auricular branch of vagus"
      },
      {
        "id": 3,
        "text": "Great auricular nerve"
      },
      {
        "id": 4,
        "text": "Facial nerve"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Cough on scratching the external acoustic canal is due to the&nbsp;<strong>auricular branch of the vagus nerve</strong> (also called <strong>Arnold's</strong>&nbsp;<strong>nerve</strong>).</p>\n<p>Ear-cough reflex (Otorespiratory reflex):<strong>&nbsp;</strong>The Arnold's nerve innervates the skin over a small part of the ear and external auditory canal. In patients with chronic cough, scratching or mechanical stimulation of ear leads to activation of Arnold's nerve, which evokes reflex cough.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is used to estimate the visual field?",
    "choices": [
      {
        "id": 1,
        "text": "Confrontation method"
      },
      {
        "id": 2,
        "text": "Campimetry"
      },
      {
        "id": 3,
        "text": "Octopus Fieldmaster"
      },
      {
        "id": 4,
        "text": "All the above"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<ul>\n<li>All the options are used to estimate the visual field.</li>\n<li><strong>Types:</strong>\n<ul>\n<li>Manual perimetry:<strong>&nbsp;Confrontation method, Lister&rsquo;s perimeter, Campimetry (Scotometry), Goldmann&rsquo;s perimeter</strong></li>\n<li>Automated perimetry:<strong>&nbsp;Octopus Fieldmaster, Humphrey Field Analyzer</strong></li>\n</ul>\n</li>\n</ul>\n<p>The image given below shows Lister's perimeter.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5d3425a4c368461f87164bdd477f4ca8x1280x1707.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0c84e667bdbd48ac909f1b4dc06226e9x500x390.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/cddd387ab1e84a9f9be9829352d3c7abx311x244.JPEG"
    ]
  },
  {
    "text": "Demographic gap starts contracting in the _________ phase.",
    "choices": [
      {
        "id": 1,
        "text": "Low stationary"
      },
      {
        "id": 2,
        "text": "Early expanding"
      },
      {
        "id": 3,
        "text": "Late expanding"
      },
      {
        "id": 4,
        "text": "Declining"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Demographic gap starts contracting</strong> in the <strong>late expanding</strong> phase\u00a0<strong>(STAGE 3).</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An employee diagnosed with TB gets extended sickness benefit for:",
    "choices": [
      {
        "id": 1,
        "text": "1 year"
      },
      {
        "id": 2,
        "text": "2 years"
      },
      {
        "id": 3,
        "text": "3 years"
      },
      {
        "id": 4,
        "text": "4 years"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Extended sickness benefit</strong> is for 2 years.</p>\n<p>Few important points to be known about the ESI act:</p>\n<ul>\n<li>It covers all employees getting income up to Rs.21,000/- per month.</li>\n<li>Employer contributes <strong>3.25% of the total wage bill</strong>.</li>\n<li>Employee contributes <strong>0.75% of wages</strong>.</li>\n<li>State and Central government share medical expenditure in the ratio 1:7.</li>\n<li>Medical benefit: Full medical care</li>\n<li>Sickness benefit: 70% of the average daily wages and is payable for 91 days.</li>\n<li><strong>Extended sickness benefit</strong>: Payable for<strong> 2 years</strong> for a set of 34 diseases such as TB, leprosy, malignant diseaes, diabetes, Parkinsons, Myasthenia Gravis, Glaucoma, Coronary artery disease etc.</li>\n<li>Enhanced sickness benefit: Full average daily wage for a duration up to 7 days in case of vasectomy and up to 14 days in case of tubectomy.</li>\n<li>Maternity benefit: Benefit is payable at full wages for 26 weeks (6.5 months) for pregnancy, 6 weeks following a miscarriage, and 30 days for sickness arising out of pregnancy.</li>\n<li>Funeral expenses: Cash not exceeding Rs.15,000.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "At PHCs, vaccines are stored in:",
    "choices": [
      {
        "id": 1,
        "text": "Cold boxes"
      },
      {
        "id": 2,
        "text": "Ice lined refrigerators"
      },
      {
        "id": 3,
        "text": "Walk-in-freezers"
      },
      {
        "id": 4,
        "text": "Deep freezers"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Ice-lined refrigerators</strong> (ILRs) are the main method of vaccine storage in <strong>primary health centres </strong>(PHCs).</p>\n<p>ILRs are an important part of the cold chain and they maintain a temperature of <strong>2 to 8 degree Celsius</strong> for storage of vaccines.&nbsp;They have different <strong>temperature zones </strong>for different vaccines and they are stored accordingly in the <strong>baskets</strong> that are provided in most ILRs.&nbsp;<strong>Dial</strong> or digital thermometers are used to record temperatures inside an ILR.</p>\n<p><span style=\"font-size: 14px;\">Inside the ILR there is a<strong> lining of water containers (ice packs or tubes)</strong> fitted all around the walls.&nbsp;</span><span style=\"font-size: 14px;\">When the refrigerator is functioning the water in the containers <strong>freezes</strong> and cools the cabinet. When the electricity supply fails, then the ice lining <strong>maintains the inside temperature</strong> of the refrigerator at a safe level for vaccines. Therefore, the temperature is maintained in ILR for a much longer duration than in the deep freezers and domestic refrigerators. Thus ILR is an ideal option for safe storage of vaccines.</span></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://cdn1.dailyrounds.org/uploads/b788dbcaf6d64847b56a73442f43bbc3x375x375.PNG"
    ]
  },
  {
    "text": "A 40-year-old man is admitted to the hospital with severe pancreatitis. The next day he develops sudden onset breathlessness and severe hypoxia. Below is the chest X-ray obtained. What is the most probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Pulmonary embolism"
      },
      {
        "id": 2,
        "text": "Acute respiratory distress syndrome (ARDS)"
      },
      {
        "id": 3,
        "text": "Hospital-acquired pneumonia"
      },
      {
        "id": 4,
        "text": "Left ventricular failure"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The history of <strong>severe pancreatitis</strong> and the chest X-ray findings of <strong>B/L diffuse alveolar opacities</strong> are suggestive of <strong>ARDS.</strong></p>\n<p><strong>Acute respiratory distress syndrome</strong> is a clinical syndrome characterized by <strong>acute onset, severe dyspnea, tachypnea, hypoxemia, </strong>and<strong> pulmonary infiltrates </strong>leading to respiratory failure. Etiological factors can be divided into direct and indirect causes of lung injury as follows:</p>\n<p><strong>Direct lung injury-</strong></p>\n<ul style=\"list-style-type: circle;\">\n<li>Pneumonia</li>\n<li>Aspiration of gastric contents</li>\n<li>Near drowning</li>\n<li>Toxic inhalation injury</li>\n<li>Pulmonary contusion</li>\n<li>COVID-19</li>\n</ul>\n<p><strong>Indirect lung injury-</strong></p>\n<ul style=\"list-style-type: circle;\">\n<li>Sepsis</li>\n<li>Severe trauma like burns, flail chest, head trauma, multiple bone fractures</li>\n<li>Transfusions</li>\n<li>Drug overdose</li>\n<li>Multiple transfusions</li>\n<li>Pancreatitis</li>\n<li>Drug overdose</li>\n</ul>\n<p>There are <strong>three stages </strong>in the development of ARDS:</p>\n<p><strong>Exudative phase</strong>: Occurs for the first 7 days of the illness. The alveolar-capillary endothelial cells and type I pneumocytes are injured, with a breach in the tight alveolar barrier. Proinflammatory cytokines like IL-8, IL-1, TNF-\u03b1, and LT-B4 lead to the recruitment of neutrophils and the development of a hyaline membrane in the alveoli.</p>\n<p><strong>Proliferative phase:</strong> Occurs from day 7-21. Recovery from mechanical ventilation is seen in most patients. Some patients may develop pulmonary fibrosis in this stage. Histological recovery is seen in this phase with a shift to lymphocyte predominant infiltrates. Type II pneumocytes proliferate and secrete surfactant with subsequent differentiation to Type I pneumocytes.</p>\n<p><strong>Fibrotic phase:</strong> Is associated with increased mortality. Extensive alveolar duct and interstitial fibrosis are seen.</p>\n<p>Chest X-ray features in ARDS:</p>\n<p>Chest x-ray features usually develop <strong>12-24 hours</strong> after initial lung insult as a result of proteinaceous interstitial edema. Within one week, hyaline membrane occurs due to type 1 pneumocyte damage. There are <strong>diffuse bilateral coalescent opacities </strong>consistent with pulmonary edema.\u00a0</p>\n<p><strong>Severity </strong>classification of ARDS:</p>\n<p><strong>Mild</strong>: 200 mmHg &lt; Pao2/Fio2 \u2264 300 mmHg<br /><strong>Moderate:</strong> 100 mmHg &lt; Pao2/Fio2 \u2264 200 mmHg<br /><strong>Severe</strong>: Pao2/Fio2 \u2264 100 mmHg</p>\n<p><strong>Management</strong> includes :</p>\n<ul>\n<li>Mechanical ventilation with low tidal volume and high-PEEP.</li>\n<li>Prone ventillation</li>\n<li>Extracorporeal membrane oxygenation</li>\n<li>Early neuromuscular blockade</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/4c10dc6e9fa04f1499db4d4a03860c73.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A middle-aged woman who presented with features of tremors, palpitations, weight loss, and menstrual irregularities is diagnosed with Grave's disease. Which of the following statements is true with respect to the report of the thyroid function test in Graves' disease?",
    "choices": [
      {
        "id": 1,
        "text": "Low TSH levels"
      },
      {
        "id": 2,
        "text": "Low free T4 levels"
      },
      {
        "id": 3,
        "text": "Low  serum T3 levels"
      },
      {
        "id": 4,
        "text": "Radioactive Iodine Uptake (RAIU) at 24 hours below normal"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>In Graves' disease, the level of serum <strong>TSH is low</strong>, <strong>unbound T4 is high</strong> and serum <strong>T3 is high</strong>.&nbsp;</p>\n<p>Graves disease is caused by autoantibodies that bind to the thyrotropin receptor (<strong>TSHR-Ab</strong>), stimulating the growth of the thyroid and <strong>overproduction of thyroid hormone(T4 and T3)</strong>. These hormones then cause<strong> negative feedback</strong> to the anterior pituitary and thus, <strong>decrease TSH levels</strong>.</p>\n<p>And in patients with thyrotoxicosis including Graves', the RAIU (radioactive iodine uptake) at 24 hours is characteristically <strong>above normal.</strong></p>\n<p>The evaluation of thyrotoxicosis is given in the flowchart below:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2629719860ee454597819db3ba331bacx711x659.GIF"
    ]
  },
  {
    "text": "Iron absorption takes place in the _____.",
    "choices": [
      {
        "id": 1,
        "text": "Proximal small intestine under basic condition"
      },
      {
        "id": 2,
        "text": "Proximal small intestine under acidic condition"
      },
      {
        "id": 3,
        "text": "Distal small intestine under basic condition"
      },
      {
        "id": 4,
        "text": "Distal small intestine under acidic condition"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Iron absorption takes place in the&nbsp;<strong>proximal small intestine under acidic conditions</strong>.</p>\n<ul>\n<li>Dietary iron present as heme is efficiently absorbed; but non-heme iron is less efficiently absorbed mainly because of interference by phosphates, tannins, oxalates and other food constituents.</li>\n<li>Iron is absorbed into the luminal cell in the ferrous form by&nbsp;<strong>DMT-1&nbsp;</strong>also known as natural resistance-associated macrophage protein type 2 (<strong>Nramp2</strong>)</li>\n<li>The acidic contents of the stomach facilitate the conversion of ferric (Fe<sup>3+</sup>) iron to ferrous (Fe<sup>2+</sup>) iron by an enzyme called&nbsp;<strong>ferrireductase</strong>.</li>\n<li>Once inside the cell, the iron can be stored as&nbsp;<strong>ferritin</strong>, or be released at the basolateral surface through&nbsp;<strong>ferroportin</strong>.&nbsp;</li>\n<li><strong>Hephaestin&nbsp;</strong>is a ferroxidase that converts ferrous (Fe<sup>2+</sup>)&nbsp;iron into ferric (Fe<sup>3+</sup>)&nbsp;form for binding to transferrin in the plasma.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/acda5fdbd5dd4d02a24ce182a3060cabx1279x1210.JPEG"
    ]
  },
  {
    "text": "Infection with hepatitis E virus has the highest fatality rate in which of the following populations?",
    "choices": [
      {
        "id": 1,
        "text": "Pregnant women"
      },
      {
        "id": 2,
        "text": "Infants"
      },
      {
        "id": 3,
        "text": "Malnourished"
      },
      {
        "id": 4,
        "text": "Adolescents"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Fatality due to Hepatitis E is <strong>highest</strong> in&nbsp;<strong>pregnant women</strong>.</p>\n<p>In the general population, hepatitis E can be complicated by fatal fulminant hepatitis in 1&ndash;2% of cases. But in<strong> pregnant women</strong>, it is <strong>raised to 20%</strong>.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is the principle behind the wound healing procedure shown in the image below?",
    "choices": [
      {
        "id": 1,
        "text": "Negative pressure wound therapy"
      },
      {
        "id": 2,
        "text": "Positive pressure wound therapy"
      },
      {
        "id": 3,
        "text": "Foam therapy"
      },
      {
        "id": 4,
        "text": "Sponge therapy"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The principal behind the wound healing procedure, as shown above, is <strong>negative pressure wound therapy.</strong></p>\n<p>Applying intermittent negative pressure of approximately -125 mmHg appears to hasten debridement and the formation of granulation tissue in chronic wounds and ulcers.</p>\n<p>The negative pressure may act by decreasing oedema, by removing interstitial fluid and by increasing blood flow.&nbsp;As a result, bacterial counts decrease and cell proliferation increases, thereby creating a suitable bed for graft or flap cover.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ba804cce95e347d2b8290c14466109b2.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Investigation of choice for acute pancreatitis is_______",
    "choices": [
      {
        "id": 1,
        "text": "Plain X-ray abdomen"
      },
      {
        "id": 2,
        "text": "CECT"
      },
      {
        "id": 3,
        "text": "MRI"
      },
      {
        "id": 4,
        "text": "USG"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<ul>\n<li><strong>Contrast-enhanced CT scan</strong> is the <strong>investigation of choice</strong>.</li>\n<li>The <strong>optimal time</strong> for performing CECT is <strong>more&nbsp;than 72 h after the onset of symptoms&nbsp;</strong>(In the first 72 hours, CT may underestimate the extent of necrosis.).</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Following a motor vehicle collision, a 30-year-old male sustained blunt trauma to his abdomen. What is the organ most likely to be injured?",
    "choices": [
      {
        "id": 1,
        "text": "Liver"
      },
      {
        "id": 2,
        "text": "Spleen"
      },
      {
        "id": 3,
        "text": "Jejunum"
      },
      {
        "id": 4,
        "text": "Mesentery"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>spleen</strong> is the most <strong>common</strong> organ involved in <strong>blunt trauma</strong> injury of the <strong>abdomen.</strong></p>\n<p>In blunt trauma, organs that cannot yield to impact by elastic deformation are most likely to be injured, namely, the <strong>solid organs</strong> (liver, spleen, and kidneys).</p>\n<p>For <strong>penetrating trauma</strong>, organs with the<strong> largest surface area</strong> when <strong>viewed from the front</strong> are most prone to injury (small bowel, liver, and colon). Additionally, since bullets and knives usually follow straight lines, <strong>adjacent structures</strong> are commonly injured (e.g., the <strong>pancreas and duodenum</strong>).</p>\n<p><strong>Deceleration </strong>injures&nbsp;the <strong>pedicled organs</strong>&nbsp;by <strong>shearing</strong>&nbsp;the organs from their points of attachment to the retroperitoneum (intestines and kidney).</p>\n<p>The most <strong>commonly</strong> injured <strong>bowel</strong> in cases of blunt trauma of the abdomen is <strong>jejunum.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 45-year-old male patient who presented with a scrotal swelling underwent an orchidectomy. The image below shows the histopathology findings. What is your diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Seminoma"
      },
      {
        "id": 2,
        "text": "Yolk-sac tumor"
      },
      {
        "id": 3,
        "text": "Embryonal cell carcinoma"
      },
      {
        "id": 4,
        "text": "Teratoma"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Based on the gross and microscopic appearance of the specimen, the diagnosis is <strong>seminoma</strong>.</p>\n<p>The gross specimen shows a well-circumscribed, pale, <strong>gray-white, fleshy</strong>, homogenous mass, with a&nbsp;<strong>lobulated cut surface</strong>, usually devoid of hemorrhage or necrosis.&nbsp;Histopathology shows <strong>uniform tumor cells</strong> with abundant <strong>clear cytoplasm</strong>, distinct cell borders, and <strong>large central nuclei</strong>.&nbsp;There is a sparse lymphocytic infiltrate. Classically, they have a fried egg appearance.</p>\n<p>Option B: <strong>Yolk-sac tumor</strong> has a <strong>yellowish-white, mucinous</strong> appearance.</p>\n<p>Option C: <strong>Embryonal cell carcinoma</strong> appears <strong>variegated</strong> with foci of <strong>hemorrhage</strong> or <strong>necrosis.</strong></p>\n<p>Option D: <strong>Teratomas</strong> also have a <strong>variegated</strong> appearance but have <strong>cysts</strong> reflecting the<strong> multiplicity of tissue types</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/5130cfe866aa458ab55ba0efeb8fb393.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A G2P1 GDM patient was admitted in labor. During labor, a diagnosis of shoulder dystocia has been made. The obstetrician performed the following maneuver. This maneuver is named as _______",
    "choices": [
      {
        "id": 1,
        "text": "Rubin manoeuvre"
      },
      {
        "id": 2,
        "text": "McRobert manoeuvre"
      },
      {
        "id": 3,
        "text": "Barnum manoeuvre"
      },
      {
        "id": 4,
        "text": "Wood corkscrew manoeuvre"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The manoeuvre shown above is <strong>McRoberts manoeuvre.</strong></p>\n<p><strong>McRoberts manoeuvre:</strong></p>\n<ul>\n<li>This is the single most effective intervention and should be the <strong>first maneuver to be performed</strong> in shoulder dystocia.</li>\n<li>It involves flexion and abduction of the maternal hips, positioning the maternal thighs on her abdomen.</li>\n<li>The <strong>lateral cutaneous nerve of the thigh</strong> is the most common nerve to get <strong>injured</strong>\u00a0during this maneuver.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/66c51f11c5874257a3c5e3358be64cc1.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 25-year-old infertile male underwent semen analysis. \nResults show: sperm concentration - 16 million/ml: pH- 7.5: volume - 2 mL: no agglutination is seen. \nMorphology shows 60% normal and 60% motile sperms. The most likely diagnosis is ______",
    "choices": [
      {
        "id": 1,
        "text": "Oligospermia"
      },
      {
        "id": 2,
        "text": "Normospermia"
      },
      {
        "id": 3,
        "text": "Azoospermia"
      },
      {
        "id": 4,
        "text": "Aspermia"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>This male with sperm concentration&nbsp;<strong>16 million/mL is considered to be normospermia</strong>.</p>\n<p><strong>According to the WHO 2010 criteria for semen analysis, the lower reference limit for normal sperm concentration is 15 million/mL</strong>.</p>\n<p>Oligospermia is defined as a sperm concentration &lt;15 million/mL, and counts &lt;5 million/mL are considered severe.</p>\n<p>Note:&nbsp;<strong>Morphology </strong>is the<strong> most important factor</strong>/marker of sperm analysis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A teenage girl presented with irregular menstrual cycles and increased facial hair. On USG, her ovaries were enlarged. Which of the following are used in the first line treatment?",
    "choices": [
      {
        "id": 1,
        "text": "1,2,3"
      },
      {
        "id": 2,
        "text": "2,3,4"
      },
      {
        "id": 3,
        "text": "1,3,4"
      },
      {
        "id": 4,
        "text": "1,2,4"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario is suggestive of <strong>polycystic ovarian syndrome</strong> and <strong>anti-androgens, lifestyle modifications</strong>, and <strong>combined oral contraceptives</strong>&nbsp;(2, 3, and 4) represent the first-line treatment modalities for this condition. Laparoscopic drilling is a surgical management procedure done when medical therapy fails.&nbsp;</p>\n<p>This patient's irregular menstrual cycles, increased facial hair (signifying clinical hyperandrogenism), and increased ovarian volume are suggestive of polycystic ovarian syndrome (PCOS).</p>\n<p>PCOS is an endocrinopathy seen in women of reproductive age, affecting multiple systems. The&nbsp;<strong>Rotterdam criteria</strong>&nbsp;is used to diagnose PCOS. The presence of&nbsp;<strong>any two of the three</strong>&nbsp;components of this criteria establishes the diagnosis of PCOS.</p>\n<ul>\n<li>Clinical/biochemical hyperandrogenism (<strong>hirsutism</strong>, acne)</li>\n<li><strong>Menstrual abnormalities (Oligo/amenorrhoea)</strong>, anovulation, infertility</li>\n<li><strong>Polycystic ovaries&nbsp;</strong>on ultrasound.</li>\n</ul>\n<div class=\"page\" title=\"Page 424\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Sonographic criteria for polycystic ovaries include &ge; 12 small cysts or an increased ovarian volume (&gt; 10 mL) or both.&nbsp;</p>\n</div>\n</div>\n</div>\n</div>\n<p><strong>Ultrasound</strong> image given below shows an <strong>enlarged ovary </strong>seen in PCOS with multiple follicles in the periphery.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/452854eb73d749aea3e9504878fdbb01x533x400.JPEG"
    ]
  },
  {
    "text": "Which of the following is seen in marasmus and not in kwashiorkor?",
    "choices": [
      {
        "id": 1,
        "text": "Fatty change in liver"
      },
      {
        "id": 2,
        "text": "Voracious appetite"
      },
      {
        "id": 3,
        "text": "Hypoalbuminemia"
      },
      {
        "id": 4,
        "text": "Edema"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<ul>\n<li>Children with <strong>marasmus</strong>&nbsp;have<strong>&nbsp;a&nbsp;voracious&nbsp;appetite,</strong> whereas children with <strong>kwashiorkor</strong> often <strong>refuse to eat</strong>.</li>\n<li><strong>Hypoalbuminemia</strong> is seen in&nbsp;<strong>kwashiorkor,</strong> which leads&nbsp;to edema.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The knee deformity shown below is called as _____",
    "choices": [
      {
        "id": 1,
        "text": "Genu recurvatum"
      },
      {
        "id": 2,
        "text": "Genu varus"
      },
      {
        "id": 3,
        "text": "Genu valgum"
      },
      {
        "id": 4,
        "text": "Windswept deformity"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The deformity shown is <strong>genu valgum</strong>.</p>\n<p>A normal knee has 5-7 degrees physiological outward deviation. Any increase or decrease in angle can result in knee deformities.&nbsp;</p>\n<p>Knee deformities are:</p>\n<ul>\n<li><strong>Genu valgus (valgum)</strong>&nbsp;or <strong>knock knee</strong> - Knees are abnormally approximated and the ankles are divergent.</li>\n<li><strong>Genu varus (varum)</strong>&nbsp;or <strong>bow knee</strong> -&nbsp;Knees are abnormally divergent &nbsp;and the ankles are approximated.</li>\n<li><strong>Windswept deformity</strong> - Abnormal valgus deformity of one knee with varus of the other.</li>\n<li><strong>Genu recurvatum</strong> - Hyperextension at knee joint, knee bends backwards.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/94a13e8eb3c04bc298b5c310765e92ef.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/cf09b0be7dd94b558cde45468ebf3944x1280x2560.JPEG"
    ]
  },
  {
    "text": "A 20-year-old female presents with patchy hair loss, characterized by short, broken strands appearing together with long, normal hairs in the affected areas. No abnormalities of the skin or scalp are present. Biopsy shows perifollicular hemorrhage. The probable diagnosis is ______",
    "choices": [
      {
        "id": 1,
        "text": "Alopecia areata"
      },
      {
        "id": 2,
        "text": "Tinea capitis"
      },
      {
        "id": 3,
        "text": "Trichotillomania"
      },
      {
        "id": 4,
        "text": "Anagen effluvium"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given history and findings suggest a diagnosis of <strong>Trichotillomania</strong>.</p>\n<p><strong>Trichotillomania:</strong></p>\n<ul>\n<li>A <strong>chronic psychiatric disorder</strong> characterized by repetitive hair pulling, leading to variable hair loss.</li>\n<li>There is increased tension prior to the hair pulling and a relief of tension or gratification after the hair pulling.</li>\n<li>More common in females.</li>\n<li><strong>Trichophagy</strong>\n<ul>\n<li>Eating hair&nbsp;may follow the hair plucking.</li>\n<li>Complications of trichophagy include trichobezoars, malnutrition, and intestinal obstruction</li>\n</ul>\n</li>\n<li>Biopsy: <strong>Perifollicular hemorrhages</strong> present.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/356a3f282f624000b4b2071cfe59c57b.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "All of the following are used to assess difficult airway except_____",
    "choices": [
      {
        "id": 1,
        "text": "Thyromental distance"
      },
      {
        "id": 2,
        "text": "ASA classification"
      },
      {
        "id": 3,
        "text": "Mallampati classification"
      },
      {
        "id": 4,
        "text": "Neck circumference"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>ASA classification</strong>&nbsp;is used to <strong>quantify patient risk for anesthesia </strong>and not difficult airway</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The skin condition shown in the image below is seen in ____.",
    "choices": [
      {
        "id": 1,
        "text": "Psoriasis"
      },
      {
        "id": 2,
        "text": "Seborrheic dermatitis"
      },
      {
        "id": 3,
        "text": "Pityriasis rosea"
      },
      {
        "id": 4,
        "text": "Ichthyosis vulgaris"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<ul>\n<li>The image represents <strong>fish-like scales</strong> on the skin characteristically seen in <strong>ichthyosis</strong> <strong>vulgaris&nbsp;</strong>(<strong>Icthyos</strong> = <strong>Fish</strong>).</li>\n<li><strong>Ichthyosis</strong> <strong>vulgaris</strong> is a skin condition that happens when the skin does not shed the dead skin cells. This leads to a dry, dead skin cells that accumulate in <strong>small</strong> <strong>patches</strong> on the surface of the skin, especially on the <strong>arms</strong> and <strong>legs</strong>.</li>\n<li>It is also called the \"<strong>fish</strong> <strong>scale</strong> <strong>disease</strong>\"&nbsp;due to the dead skin that accumulates in the same pattern to a fish&rsquo;s scales.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d17f231a400e43d1968fb99aceda1141.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Best investigation for pulmonary embolism _____",
    "choices": [
      {
        "id": 1,
        "text": "MRI"
      },
      {
        "id": 2,
        "text": "V/Q scan"
      },
      {
        "id": 3,
        "text": "Plain CT"
      },
      {
        "id": 4,
        "text": "CT angiography"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Pulmonary CT angiography /MDCT is the best investigation for pulmonary embolism. The dye is injected through the intravenous route.</p>\n<p>The below figure is a&nbsp;CT angiography demonstrating multiple filling defects both at the bifurcation (<strong>saddle pulmonary embolism</strong>) and in the pulmonary arteries.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/509754532eee4cf8850c57e0593602d3x1024x806.PNG"
    ]
  },
  {
    "text": "The Nuclear scan used for the detection of Meckel\u2019s diverticulum:",
    "choices": [
      {
        "id": 1,
        "text": "Tc pyrophoshate"
      },
      {
        "id": 2,
        "text": "Tc 99m DTPA"
      },
      {
        "id": 3,
        "text": "Tc 99m MAG3"
      },
      {
        "id": 4,
        "text": "Tc 99m pertechnetate"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<ul>\n<li>Tc 99m Pertechnetate is used for detection of Meckel's diverticulum.</li>\n<li><strong>Uses of Tc-99m pertechnetate:</strong>\n<ul>\n<li>Thyroid imaging</li>\n<li>Meckel scan</li>\n<li>Testicle imaging</li>\n<li>Parathyroid imaging for distinguishing from thyroid gland</li>\n<li>Gastric emptying studies, intestinal and rectal functional studies.</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = 'Fmge Mini Test - 023';
        const quizFilename = 'fmge-mini-test-023-f0aa6a1d.html';
        let hierarchy = ["Marrow", "FMGE Mini Test Series", "2022"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>