<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>12 Escherichia, Proteus And Klebsiella - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Microbiology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">16</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "An old woman presented to the OPD with dysuria and frequent micturition. Urinalysis showed pus cells, and culture on MacConkey agar showed the following. Which organism is involved here?",
    "choices": [
      {
        "id": 1,
        "text": "Escherichia"
      },
      {
        "id": 2,
        "text": "Salmonella"
      },
      {
        "id": 3,
        "text": "Shigella"
      },
      {
        "id": 4,
        "text": "Proteus"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Mnemonic to remember non-lactose fermenters:<strong>\u00a0(SPY\u00a0PSM)</strong></p>\n<ul>\n<li><em><strong>S</strong>almonella</em></li>\n<li><em><strong>P</strong>roteus</em></li>\n<li><em><strong>Y</strong>ersinia</em></li>\n<li><em><strong>P</strong>rovidencia-</em> late fermenter</li>\n<li><em><strong>S</strong>higella</em> (except <em>S.sonnei</em> which is a late lactose fermenter)</li>\n<li><em><strong>M</strong>organella</em></li>\n</ul>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/9392018bce284cbf9110fc8e40ae68f5.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/604e93dedce447ba8e26ff30fe940ef4x1280x1280.JPEG"
    ]
  },
  {
    "text": "The stool culture of a patient with suspected food poisoning produced hemolytic colonies on blood agar. The isolated organism gave a positive indole test and a positive MUG test. You observe the following colonies on eosin methylene blue agar. Identify the organism.",
    "choices": [
      {
        "id": 1,
        "text": "Escherichia coli"
      },
      {
        "id": 2,
        "text": "Klebsiella pneumoniae"
      },
      {
        "id": 3,
        "text": "Proteus vulgaris"
      },
      {
        "id": 4,
        "text": "Klebsiella granulomatis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given scenario of a patient with suspected food poisoning with <strong>stool</strong> culture growing <strong>hemolytic colony</strong> on blood agar with a <strong>positive indole</strong> test and MUG test with a <strong>iridescent green</strong> colony growth on <strong>eosin methylene blue</strong> agar is characteristic of<strong> <em>Escherichia coli.\u00a0</em></strong></p>\n<p><em>E. coli</em> produces the enzyme\u00a0<strong>\u03b2-glucuronidase</strong> which is tested using the\u00a0<strong>MUG test.\u00a0</strong>In it, the substrate\u00a0MUG (4-methylumbelliferyl-\u03b2-glucuronide) is reduced by the enzyme to <strong>produce a fluorescent color</strong> which indicates a positive MUG test.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/5d4bdbae7c2545968fc2c05d801e4ff6.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "What is the cut-off for bacteriuria beyond which a diagnosis of catheter-associated urinary tract infection (CAUTI) can be made?",
    "choices": [
      {
        "id": 1,
        "text": ">10^2  CFU/ml"
      },
      {
        "id": 2,
        "text": ">10^3 CFU/ml"
      },
      {
        "id": 3,
        "text": ">10^4  CFU/ml"
      },
      {
        "id": 4,
        "text": ">10^5  CFU/ml"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>cut-off</strong> value for bacteriuria to diagnose catheter-associated <strong>urinary tract infection</strong> (CAUTI) is <strong>&gt;10<sup>3\u00a0</sup></strong>CFU/mL.</p>\n<p>The minimum criterion for catheter-associated <strong>asymptomatic bacteriuria</strong> (CA-ASB) is\u00a0<strong>&gt;10<sup>2</sup></strong><sup>\u00a0</sup>CFU/mL.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A tourist came to the OPD with complaints of abdominal pain and watery diarrhea. Which of the following strains of E. coli is most commonly implicated in this case?",
    "choices": [
      {
        "id": 1,
        "text": "Enteropathogenic E. coli"
      },
      {
        "id": 2,
        "text": "Enterohemorrhagic E. coli"
      },
      {
        "id": 3,
        "text": "Enterotoxigenic E. coli"
      },
      {
        "id": 4,
        "text": "Enteroinvasive E. coli"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>This patient with watery diarrhea most likely has <strong>traveller\u2019s diarrhea</strong> caused by<strong> Enterotoxigenic<em> Escherichia coli</em>\u00a0</strong>(ETEC).\u00a0</p>\n<p>Enterotoxigenic E. coli (ETEC) is the most common organism that causes diarrhea in travelers. It produces the following toxins:</p>\n<ul>\n<li>LT (heat-labile toxin) - acts by <strong>\u2191cAMP</strong></li>\n<li>ST (heat-stable toxin) - two types of ST are known, ST-A (ST-I) and ST-B (ST-II)\n<ul>\n<li>ST-A is soluble in methanol and acts by \u2191 <strong>cGMP</strong> in the intestine.</li>\n<li>ST-B is insoluble in methanol, and the mode of action is not known.</li>\n</ul>\n</li>\n</ul>\n<p>Other options:\u00a0</p>\n<p>Option A: <strong>Enteropathogenic</strong> E. coli (EPEC) causes <strong>infantile</strong> diarrhea in developing countries. It adheres to the mucosal surface of the small intestine using E. coli adherent factor (EAF) and locus of enterocyte effacement (LEE) and causes effacement of microvilli.\u00a0</p>\n<p>Option B: <strong>Enterohemorrhagic</strong> E. coli (EHEC) produces <strong>verocytotoxin,</strong> which targets vascular endothelium. It causes hemorrhagic colitis and hemolytic uremic syndrome.</p>\n<p>Option D: <strong>Enteroinvasive</strong> E.coli (EIEC) invades <strong>interstitial epithelial</strong> cells in the intestine and causes a condition resembling <strong>shigellosis.</strong> This ability is determined by a plasmid, which can be detected as a diagnostic test.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Identify the organism below that causes effacement and attachment of intestinal cells.",
    "choices": [
      {
        "id": 1,
        "text": "ETEC"
      },
      {
        "id": 2,
        "text": "EIEC"
      },
      {
        "id": 3,
        "text": "EPEC"
      },
      {
        "id": 4,
        "text": "EAEC"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The image below shows an electron microscopy image of E Coli.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/dd8c6b12e06c4a618c5833f64e86a693.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/cb665fb7793947eabae4829a87df5a89x1280x1046.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8bc3d14de6014f70bf6970fdc8a7a784x720x604.PNG"
    ]
  },
  {
    "text": "You are investigating an outbreak of diarrhea.  You find out that the etiological agent causes stacked-brick formation on hep-2 cells as shown below.  What is the likely organism?",
    "choices": [
      {
        "id": 1,
        "text": "Enteroaggregative E.coli"
      },
      {
        "id": 2,
        "text": "Enterohemorrhagic E.coli"
      },
      {
        "id": 3,
        "text": "Enterotoxigenic E.coli"
      },
      {
        "id": 4,
        "text": "Enteroinvasive E.coli"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The<strong> stacked-brick pattern </strong>of adherence on <strong>hep-2 cells</strong> is caused by<strong>\u00a0enteroaggregative<em> E. coli</em></strong> (EAEC).</p>\n<p>Enteroaggregative<em> E. coli</em><strong>\u00a0</strong>has been associated with <strong>persistent diarrhea</strong>.\u00a0Intestinal colonization of EAEC is mediated by\u00a0<strong>aggregative adherence fimbriae</strong> (AAF).\u00a0<strong>EAST-1</strong>\u00a0toxin (enteroaggregative heat-stable toxin) is considered to be a major <strong>virulence</strong> factor for EAEC.</p>\n<p>The given image shows the stacked-brick pattern of adherence on microscopy at 600x magnification.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/da8e0cdf96264d888ecf25f97a49da62.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/109033e58654480a862d35410bf3ad79x510x499.GIF"
    ]
  },
  {
    "text": "A 29-year-old woman presented with bloody diarrhea, abdominal pain, hemolytic anemia, thrombocytopenia, and acute renal failure. She was diagnosed with hemolytic uremic syndrome and treated with plasmapheresis and dialysis. What is false about the infectious causative agent?",
    "choices": [
      {
        "id": 1,
        "text": "Serotype O157:H7 causes hemolytic-uremic syndrome."
      },
      {
        "id": 2,
        "text": "It does not produce a Shiga like toxin"
      },
      {
        "id": 3,
        "text": "Fecal leukocytes may be seen"
      },
      {
        "id": 4,
        "text": "There is person to person transmission."
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Hemolytic-uremic syndrome </strong>(HUS)\u00a0is caused by\u00a0enterohemorrhagic<em> E. coli</em> <strong>(EHEC)</strong>\u00a0serotype <strong>O157:H7.\u00a0</strong>It <strong>produces a Shiga like toxin</strong>, therefore EHEC is also known as Shiga toxin-producing <em>E. coli</em>\u00a0(STEC).</p>\n<p>Other options:</p>\n<p>Option A - Strains of\u00a0<em><strong>E. coli</strong></em>\u00a0producing <strong>verocytotoxin</strong> or Shiga toxin (stx2a-g) can cause diarrheal disease ranging from mild <strong>diarrhea</strong> to fatal <strong>hemorrhagic colitis</strong> and <strong>HUS.\u00a0</strong>The <strong>most common</strong>\u00a0EHEC belongs to serotype <strong>O157:H7.</strong></p>\n<p>Option C - In <strong>EHEC</strong> diarrhea, <strong>fecal leukocytes</strong> are commonly seen (70%) but although it is an infectious condition, fever is not seen. The<strong> absence of fever</strong> can lead to its misdiagnosis as a non-infectious condition such as intussusception or ischemic bowel disease.</p>\n<p>Option D -\u00a0The disease is <strong>transmitted</strong> through <strong>contaminated feces</strong>.\u00a0Person-to-person transmission\u00a0can occur if infected\u00a0persons\u00a0do not wash their hands after using the toilet or after changing diapers.</p>\n<p>Note: Shiga toxin produced by <em>S. dysenteriae</em> is referred to as Stx.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Sereny test was employed for laboratory diagnosis of which of the following organisms?",
    "choices": [
      {
        "id": 1,
        "text": "Enterotoxigenic E. coli"
      },
      {
        "id": 2,
        "text": "Enteropathogenic E. coli"
      },
      {
        "id": 3,
        "text": "Enterohemorrhagic E. coli"
      },
      {
        "id": 4,
        "text": "Enteroinvasive E. coli"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The<strong> Sereny test</strong> is an animal pathogenicity test that used to be employed for laboratory diagnosis of <strong>enteroinvasive<em> E. coli</em> </strong>and<strong> Shigella.</strong></p>\n<p>Freshly isolated suspension of <strong>bacteria</strong> is instilled <strong>into the eyes</strong> of guinea pigs which leads to\u00a0<strong>mucopurulent conjunctivitis</strong> and <strong>severe keratitis</strong>.</p>\n<p>It is <strong>not in use anymore</strong> as we have better methods of detecting toxigenicity now like molecular methods.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the culture media used to differentiate E. coli O157:H7 from other E. coli?",
    "choices": [
      {
        "id": 1,
        "text": "Sorbitol-MacConkey agar"
      },
      {
        "id": 2,
        "text": "Mannitol salt agar"
      },
      {
        "id": 3,
        "text": "Cystine-lactose-electrolyte deficient medium"
      },
      {
        "id": 4,
        "text": "Thiosulphate citrate Bile salt sucrose medium"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Sorbitol-MacConkey agar</strong> is&nbsp;used to <strong>differentiate </strong><em>E. coli</em> O157:H7 from other <em>E. coli</em>.</p>\n<p><em>E. coli </em><strong>O157:H7</strong> does<strong> not</strong> <strong>ferment sorbitol</strong> and produces&nbsp;<strong>pale colonies</strong> on Sorbitol-MacConkey agar. All <strong>other</strong> strains of <em>E. coli</em><strong> ferment sorbitol</strong>. Thus they produce <strong>pink colonies</strong> on Sorbitol-MacConkey agar.</p>\n<p>O157:H7 strains do <strong>not contain</strong>&nbsp;<strong>&beta;-glucuronidase</strong> and so are unable to use the substrate 4-methylumbelliferyl-&beta;-glucuronide(MUG). Thus, they give a <strong>negative MUG test</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Match the following E.coli with their respective pathogenesis.",
    "choices": [
      {
        "id": 1,
        "text": "A-4,B-3,C-2,D-1"
      },
      {
        "id": 2,
        "text": "A-1,B-3,C-2,D-4"
      },
      {
        "id": 3,
        "text": "A-1,B-2,C-3,D-4"
      },
      {
        "id": 4,
        "text": "A-4,B-2,C-3.D-1"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The correctly matched pairs are as follows:</p>\n<table style=\"height: 145px; width: 502px;\">\n<tbody>\n<tr>\n<td style=\"width: 69.8203px;\"><em><strong>E. coli</strong></em></td>\n<td style=\"width: 416.18px;\"><strong>Mechanism of action</strong></td>\n</tr>\n<tr>\n<td style=\"width: 69.8203px;\">1. ETEC</td>\n<td style=\"width: 416.18px;\">A. Produce a heat-stable toxin and cause activation of guanylyl cyclase</td>\n</tr>\n<tr>\n<td style=\"width: 69.8203px;\">2. EIEC</td>\n<td style=\"width: 416.18px;\">B. Invades intestinal mucosal cells \u00a0</td>\n</tr>\n<tr>\n<td style=\"width: 69.8203px;\">3. EHEC</td>\n<td style=\"width: 416.18px;\">C. Produces a toxin against vascular endothelium cells</td>\n</tr>\n<tr>\n<td style=\"width: 69.8203px;\">4. EPEC</td>\n<td style=\"width: 416.18px;\">D. Adhere to the mucosal surface and cause effacement of microvilli</td>\n</tr>\n</tbody>\n</table>\n<p>The various strains of <em>Escherichia coli</em> are:</p>\n<ul>\n<li><strong>Enterotoxigenic</strong> <em>E. </em><em>coli</em>\u00a0(ETEC) is the most common organism\u00a0<strong>that</strong> causes <strong>diarrhea</strong> in\u00a0<strong><strong>travelers</strong>.\u00a0</strong>It produces the following toxins:\n<ul>\n<li><strong>LT\u00a0</strong>(heat-labile toxin)- acts by<strong>\u00a0\u2191cAMP</strong></li>\n<li><strong>ST\u00a0</strong>(heat-stable toxin)- two types of ST are known, ST-A (ST-I) and ST-B (ST-II)\n<ul>\n<li><strong>ST-A</strong>\u00a0is soluble in methanol and acts by <strong>\u2191cGMP</strong>\u00a0in the intestine.\u00a0</li>\n<li><strong>ST-B\u00a0</strong>is insoluble in methanol, and the mode of <strong>action</strong> is <strong>not known</strong>.</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<div class=\"column\">\n<ul>\n<li><strong>Enteroinvasive</strong><em> E. coli</em><strong>\u00a0</strong>(EIEC)<strong> invade interstitial epithelial cells</strong> in the intestine and cause a condition <strong>resembling shigellosis</strong>. This ability is determined by a <strong>plasmid, detection</strong> of which can also be a diagnostic test. <strong>Sereny's test</strong> was employed to diagnose EIEC but it is not in use anymore.</li>\n<li><strong>Enterohemorrhagic</strong>\u00a0<em>E.</em><em> coli</em><strong><em>\u00a0</em></strong>(EHEC)\u00a0produces <strong>verocytotoxin,</strong> which targets vascular endothelium. It causes\u00a0<strong>hemorrhagic colitis</strong> and <strong>hemolytic uremic syndrome.</strong></li>\n<li><strong>Enteropathogenic</strong> <em>E.</em><em> coli</em><em>\u00a0</em>(EPEC) causes <strong>infantile diarrhea</strong> in developing countries. It adheres to the mucosal surface of small intestine using EAF and LEE and causes <strong>effacement</strong> of <strong>microvilli</strong>. This leads to <strong>attachment</strong> and\u00a0<strong>effacement</strong>\u00a0lesions of intestinal cells.</li>\n<li><strong>Enteroaggregative</strong> <em>E.</em><em> coli</em><strong> </strong>(EAEC)<strong>\u00a0</strong>produces the <strong>stacked brick pattern</strong>\u00a0of adherence on hep-2 cells. EAEC\u00a0has been associated with\u00a0<strong>persistent diarrhea</strong>.\u00a0Intestinal colonization of EAEC is mediated by\u00a0AAF (aggregative adherence fimbriae). EAEC produces EAST-1\u00a0toxin (enteroaggregative heat-stable toxin) which is considered to be a major virulence factor.</li>\n</ul>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is false?",
    "choices": [
      {
        "id": 1,
        "text": "E.coli is an aerobe and facultative anaerobe."
      },
      {
        "id": 2,
        "text": "Proteus infection increases risk of uric acid stones."
      },
      {
        "id": 3,
        "text": "E.coli is motile by peritrichous flagella."
      },
      {
        "id": 4,
        "text": "Proteus can metabolise phenylalanine to phenylpyruvic acid."
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><em><strong>Proteus</strong></em>\u00a0increases the risk of\u00a0<strong>struvite</strong> <strong>stones</strong> in the bladder as it leads to the\u00a0<strong>alkalinisation of urine.\u00a0</strong>Struvite stones are <strong>magnesium-ammonium phosphate stones</strong> that appear as rectangular/<strong>coffin-lid crystals</strong> shaped on urine microscopy.\u00a0Uric acid stones are precipitated in acidic urine.</p>\n<p><em>Proteus</em> produces enzyme phenylalanine deaminase which converts phenylalanine to phenyl pyruvic acid. This property is the basis for the <strong>phenylalanine deaminase test</strong>.</p>\n<p>The test is performed by inoculating the organism in <strong>phenylalanine agar</strong>. After incubation, <strong>10% ferric chloride</strong> is added to the media. If phenyl pyruvic acid was produced, it will react with the ferric chloride and <strong>turn dark green</strong>.\u00a0 If the medium remains a straw colour, the organism is negative for phenylalanine deaminase production.</p>\n<p><strong><em>E. coli</em></strong> is an aerobe and facultative anaerobe. Its motility is due to the presence of<strong> peritrichous flagella</strong>. It is the most common cause of <strong>urinary tract infections.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following shows Dienes phenomenon?",
    "choices": [
      {
        "id": 1,
        "text": "Proteus mirabilis"
      },
      {
        "id": 2,
        "text": "Klebsiella granulomatis"
      },
      {
        "id": 3,
        "text": "Providencia stuartii"
      },
      {
        "id": 4,
        "text": "Serratia marcescens"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Dienes phenomenon</strong> is exhibited by\u00a0<em><strong>Proteus mirabilis</strong>.</em></p>\n<p>When two <strong>identical strains </strong>of <em>Proteus</em> are inoculated at different places of the <strong>same culture plate</strong>, the resulting swarms of <strong>growth coalesce</strong> and no line is formed between swarming cultures of the same strain. However, if they are from <strong>two different strains</strong>, the spreading films of growth <strong>fail to coalesce</strong> and remain separated by a narrow but easily visible <strong>furrow\u00a0</strong>(known as\u00a0<strong>Dienes line</strong>).\u00a0This is known as <strong>Dienes phenomenon.</strong></p>\n<p>The image below shows Dienes phenomenon.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5f80999d184543d4a4f17c57d70fb6c5x512x398.PNG"
    ]
  },
  {
    "text": "Blood culture of the sputum sample taken from a patient diagnosed with hospital-acquired pneumonia, showed a characteristic phenomenon as shown in the image. Identify the bacteria that exhibit this phenomenon.",
    "choices": [
      {
        "id": 1,
        "text": "Klebsiella"
      },
      {
        "id": 2,
        "text": "Enterobacter"
      },
      {
        "id": 3,
        "text": "Serratia"
      },
      {
        "id": 4,
        "text": "Proteus"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given image of the <strong>blood culture</strong> finding shows the characteristic <strong>bull's eye</strong>\u00a0<strong>swarming </strong>pattern exhibited by <em><strong>Proteus</strong>.</em></p>\n<p>Proteus species move very actively with the help of <strong>peritrichous flagella</strong>, resulting in <strong>swarming</strong> on <strong>solid\u00a0media.</strong> It can be <strong>suppressed</strong> <strong>by</strong> the addition of:</p>\n<ul>\n<li>phenyl ethyl alcohol</li>\n<li>chloral hydrate</li>\n<li>sulphonamides</li>\n<li>sodium azide</li>\n<li>boric acid</li>\n<li>increasing the concentration of agar to 6%.</li>\n</ul>\n<p>Swarming does <strong>not occur</strong> on <strong>MacConkey medium</strong> and cystine-lactose-electrolyte-deficient (<strong>CLED</strong>) <strong>medium</strong>.</p>\n<p>Proteus is a gram-negative bacillus seen as a <strong>normal gastrointestinal</strong> flora. The two most common species causing infection in humans are P. mirabilis and P. vulgaris, which can be differentiated by spot indole test. P. <strong>mirabilis</strong> is <strong>indole negative</strong> while P. <strong>vulgaris</strong> is <strong>indole positive.</strong> Production of urease enzyme by Proteus, which hydrolyses urea to ammonia causes alkalinization of urine. Alkalinization of urine leads to the precipitation of organic and inorganic compounds which contributes to the formation of Struvite stones. P. mirabilis is associated with urinary tract infections while P. vulgaris is usually associated with <strong>wound</strong> and <strong>soft tissue</strong> infections.\u00a0</p>\n<p>Other organisms that show swarming include:</p>\n<ul>\n<li><em>Clostridium tetani</em></li>\n<li><em>Vibrio parahaemolyticus</em></li>\n<li><em>Serratia</em></li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b691f6f7058d4ad8b0279dbc2eaab09f.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A middle-aged man from north India presents with a deformity as shown in the image below. He gives a history of foul-smelling purulent nasal discharge before this nodule appeared. Which of the following organisms is responsible for his condition?",
    "choices": [
      {
        "id": 1,
        "text": "Rhinosporidium seeberi"
      },
      {
        "id": 2,
        "text": "Klebsiella rhinoscleromatis"
      },
      {
        "id": 3,
        "text": "Klebsiella ozaenae"
      },
      {
        "id": 4,
        "text": "Klebsiella oxytoca"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The above image and clinical scenario are suggestive of <strong>r</strong><strong>hinoscleroma</strong> and it is caused by <strong><em>Klebsiella rhinoscleromatis</em>.</strong></p>\n<p>K. rhinoscleromatis is a gram-negative bacillus also known as <strong>Frisch bacillus.\u00a0</strong>It is endemic in<strong> north India.\u00a0</strong>Rhinoscleroma is characterized by <strong>chronic granulomatous\u00a0hypertrophy</strong> of the nose.\u00a0Biopsy of the lesion shows:</p>\n<ul>\n<li><strong>Mikulicz cells-</strong>\u00a0large foamy cells with a central nucleus and vacuolated, cytoplasm containing causative bacilli.</li>\n<li><strong>Russell bodies-</strong> eosinophilic inclusion bodies found in the plasma cells. These are also observed in multiple myeloma.</li>\n</ul>\n<p>Other options:\u00a0\u00a0</p>\n<p>Option A: <em>Rhinosporidium seeberi</em> causes <strong>rhinosporidiosis.</strong></p>\n<p>Option C: <em>K. ozaenae</em> causes <strong>atrophic rhinitis</strong>.</p>\n<p>Option D: <em>K. oxytoca</em> is associated with <strong>hemorrhagic colitis</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/aaa376f893fb48bda4b164de68e1cebd.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "You notice a sputum sample of a patient suspected of having ventilator-associated pneumonia turns progressively redder over time. Microscopic examination of the sample reveals an absence of red blood cells. Which of the following organisms could have caused this?",
    "choices": [
      {
        "id": 1,
        "text": "Streptococcus pneumoniae"
      },
      {
        "id": 2,
        "text": "Proteus mirabilis"
      },
      {
        "id": 3,
        "text": "Klebsiella pneumonia"
      },
      {
        "id": 4,
        "text": "Serratia marcescens"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given condition of <strong>sputum</strong> sample <strong>turning</strong>\u00a0<strong>redder</strong>\u00a0over time\u00a0can be caused by<strong>\u00a0<em>Serratia marcescens</em>.</strong></p>\n<p><em>Serratia marcescens</em> are pleomorphic coccobacilli that can grow in sputum after collection and can <strong>mimic\u00a0hemoptysis</strong> because they produce a <strong>red pigment</strong> called\u00a0<strong>prodigiosin. </strong></p>\n<p>S. macescens mainly cause healthcare-associated infections such as ventilator-associated pneumonia, meningitis, endocarditis, septicemia and peritonitis. They can contaminate IV fluids, surgical instruments, and antiseptic solutions.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 19-year-old boy presented with a single painless papule on his penis with no enlarged lymph nodes. A smear was made from the lesion and stained with Wright- Giemsa stain which showed the finding as shown in the following picture. Identify the organism.",
    "choices": [
      {
        "id": 1,
        "text": "Treponema pallidum"
      },
      {
        "id": 2,
        "text": "Herpes simplex"
      },
      {
        "id": 3,
        "text": "Chlamydia trachomatis"
      },
      {
        "id": 4,
        "text": "Klebsiella granulomatis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical vignette and the image showing\u00a0<strong>D</strong><strong>onovan bodies</strong>\u00a0in Wright/Giemsa-stained impression smears indicate a diagnosis of <strong>donovanosis</strong> caused by\u00a0<strong><em>Klebsiella granulomatis.</em></strong>\u00a0They appear as <strong>rounded</strong> <strong>coccobacilli</strong>\u00a0within cystic spaces in large mononuclear cells (called\u00a0<strong>Pund cells</strong>).</p>\n<p><em>Klebsiella granulomatis</em>\u00a0shows bipolar condensation of chromatin giving a <strong>safety</strong> <strong>pin</strong> <strong>appearance</strong>.</p>\n<p>Bipolar staining (safety pin appearance) is shown by:</p>\n<ul>\n<li><em>H. ducreyi</em></li>\n<li><em>Vibrio parahaemolyticus</em></li>\n<li><em>Klebsiella granulomatis</em></li>\n<li><em>Yersinia pestis</em></li>\n<li><em>Burkholderia pseudomallei</em></li>\n<li><em>Burkholderia mallei</em></li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/26109dded79149868db2b639da07010c.PNG"
    ],
    "explanation_images": []
  }
];
        let quizName = '12 Escherichia, Proteus And Klebsiella';
        let hierarchy = ["Marrow", "qBank", "Microbiology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>