<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unintentional Weight Loss Mini Test - -Tmt - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2023-24
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "According to the NSQIP/AGS guidelines, severe nutritional risk in the geriatric population is present when unintended weight loss is ______________",
    "choices": [
      {
        "id": 1,
        "text": "Greater than 30% within 12 months"
      },
      {
        "id": 2,
        "text": "Greater than 20% within 6 months"
      },
      {
        "id": 3,
        "text": "Greater than 10% within 6 months"
      },
      {
        "id": 4,
        "text": "Greater than 15% within 12 months"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p style=\"text-align: left;\">The NSQIP/AGS guidelines note a severe nutritional risk when <strong>unintended weight loss</strong> <strong>is greater than 10% within 6 months </strong>in the geriatric population.</p>\n<p style=\"text-align: left;\">As part of the preoperative evaluation for geriatric anaesthesia, nutritional screening is conducted as <strong>malnutrition</strong> is associated with adverse surgical outcomes.\u00a0</p>\n<p style=\"text-align: left;\">Severe nutritional risk is associated with:</p>\n<ul>\n<li style=\"text-align: left;\">Unintended weight loss is <strong>greater than 10%</strong> within <strong>6 months\u00a0</strong></li>\n<li style=\"text-align: left;\">Body mass index <strong>(BMI) &lt; 18.5 kg/m2</strong></li>\n<li style=\"text-align: left;\"><strong>Serum albumin &lt; 3 g/dL</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the anticipated weight loss after delivery as a result of the expulsion of products of gestation and accompanying blood loss?",
    "choices": [
      {
        "id": 1,
        "text": "1-2 kgs"
      },
      {
        "id": 2,
        "text": "5-6 kgs"
      },
      {
        "id": 3,
        "text": "3-4 kgs"
      },
      {
        "id": 4,
        "text": "2-3 kgs"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>There is a weight loss of <strong>5-6 kgs</strong> due to the expulsion of products of gestation (fetus, placentae, liquor) and accompanying blood loss after delivery.\u00a0</p>\n<p>This estimate includes the average weight of a full-term newborn (approximately 3-4 kgs), the placenta (roughly 0.5-1 kg), amniotic fluid (about 0.8-1 kg), and additional blood and fluid loss that occurs during delivery.</p>\n<p>This weight loss may continue up to <strong>6 months</strong> after delivery.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not an indication for evaluating a patient with unintentional weight loss?",
    "choices": [
      {
        "id": 1,
        "text": "5% weight loss in 30 days"
      },
      {
        "id": 2,
        "text": "25% of food left uneaten after 7 days"
      },
      {
        "id": 3,
        "text": "BMI of <24 kg/m2"
      },
      {
        "id": 4,
        "text": "10% weight loss in 180 days"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Body mass index (BMI) of <strong>&lt;21 \u00a0kg/m<sup>2</sup> </strong>is considered an <strong>indication</strong> for evaluating a patient with <strong>unintentional weight loss (UWL).</strong></p>\n<p>Indications of UWL include:</p>\n<ul>\n<li><strong>5% weight loss in 30 days\u00a0</strong></li>\n<li><strong>10% weight loss in 180 days</strong></li>\n<li><strong>Body mass index &lt;21 kg/m<sup>2</sup></strong></li>\n<li><strong>25% of food left uneaten after 7 days\u00a0</strong></li>\n<li>Change in fit of clothing</li>\n<li>Change in appetite, smell, or taste\u00a0</li>\n<li>Abdominal pain, nausea, vomiting, diarrhoea, constipation, dysphagia\u00a0</li>\n</ul>\n<p>A thorough history and physical examination, a complete blood count, tests for liver enzyme levels, C-reactive protein, ESR, renal function studies, thyroid function tests, chest radiography, and abdominal ultrasound are all part of the initial evaluation. <strong>Cancer screening tests</strong>, such as <strong>mammography</strong> and <strong>colonoscopy,</strong> should be performed.</p>\n<p>All elderly patients with weight loss should undergo screening for dementia and depression by using instruments such as the <strong>Mini-Mental</strong> State <strong>Examination</strong> and the <strong>Geriatric Depression Scale</strong>, respectively. The<strong> Mini Nutritional Assessment </strong>and the <strong>Nutrition Screening Initiative</strong> are also available for the nutritional assessment of elderly patients</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An HIV patient presented with involuntary weight loss of >10% associated with chronic diarrhea for > 30 days. He was diagnosed with wasting syndrome. Which of the following is least likely to be responsible for weight loss in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Loss of body cell mass"
      },
      {
        "id": 2,
        "text": "Myofiber degeneration"
      },
      {
        "id": 3,
        "text": "Loss of muscle mass"
      },
      {
        "id": 4,
        "text": "Lipoatrophy"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Wasting syndrome</strong>/ <strong>generalized wasting </strong>is an<strong> AIDS-defining condition</strong> associated with<strong> involuntary weight loss of &gt;10% </strong>of body weight, fever and <strong>chronic diarrhoea lasting &gt;30 days</strong> without any other cause. <strong>Lipoatrophy</strong> is <strong>not responsible</strong> for weight loss in this condition.</p>\n<p>The majority of the weight loss in this condition is due to a loss of<strong> muscle mass, </strong>also known as <strong>lean body mass</strong> or<strong> body cell mass.</strong> Bioelectrical impedance analysis (BIA) or a full body x-ray (DEXA) scan is used to measure it.</p>\n<p>A constant feature of this syndrome is <strong>severe muscle wasting </strong>with <strong>scattered myofiber degeneration</strong> and occasional evidence of <strong>myositis.</strong></p>\n<p><strong>Glucocorticoids</strong> may be of some benefit. Androgenic steroids, growth hormone, and total parenteral nutrition have all been used as therapeutic interventions, with varying degrees of success.</p>\n<p>Wasting syndrome is rarely seen nowadays due to the <strong>early initiation </strong>of<strong> antiretroviral drugs.</strong></p>\n<p><strong>HIV-associated lipodystrophy</strong> is a side effect of antiretroviral therapy (ART) that occurs due to the <strong>redistribution</strong> of <strong>adipose tissue.</strong> It can manifest as <strong>fat accumulation (lipohypertrophy)</strong> or <strong>fat loss (lipoatrophy).</strong></p>\n<p>Lipoatrophy is characterised by <strong>subcutaneous fat loss</strong> in the face, arms, legs, abdomen, and/or buttocks. There is<strong> preferential fat loss </strong>with n<strong>o evidence </strong>of <strong>muscle atrophy,</strong> which distinguishes it from AIDS-related wasting syndrome.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You are assessing the risk of developing malnutrition in a patient with a history of unintentional weight loss using the Malnutrition Universal Screening Tool (MUST). What score is assigned to a patient who lost 4% of body weight in the last 6 months?",
    "choices": [
      {
        "id": 1,
        "text": "1"
      },
      {
        "id": 2,
        "text": "2"
      },
      {
        "id": 3,
        "text": "0"
      },
      {
        "id": 4,
        "text": "3"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>According to the Malnutrition Universal Screening Tool (MUST), this patient is assigned a<strong> score of 0</strong> for a 4% weight loss in the last 6 months.</p>\n<p>MUST is a screening tool used to detect protein-energy malnutrition and identify people at risk of malnutrition. MUST uses three independent criteria to determine the overall risk of malnutrition: <strong>current weight status</strong> (calculated by <strong>BMI</strong>), <strong>unintentional weight loss,</strong> and <strong>acute disease effect</strong>. Each parameter has a rating of 0, 1, or 2.</p>\n<p><strong>Weight loss</strong> (over the last 3-6 months) is determined by reviewing the individual's <strong>medical record. </strong>If the patient is currently suffering from a <strong>pathophysiologic</strong> condition and has <strong>not consumed any food</strong> for more than 5 days, an acute disease factor is added.</p>\n<table style=\"border-collapse: collapse; width: 53.8779%; height: 134.39px;\" border=\"1\">\n<tbody>\n<tr style=\"height: 22.3984px;\">\n<td style=\"width: 13.4812%; height: 22.3984px;\"><strong>Score\u00a0</strong></td>\n<td style=\"width: 34.8062%; height: 22.3984px;\"><strong>BMI</strong></td>\n<td style=\"width: 51.7126%; height: 22.3984px;\"><strong>Unintentional weight loss (last 3-6 months)</strong></td>\n</tr>\n<tr style=\"height: 22.3984px;\">\n<td style=\"width: 13.4812%; height: 22.3984px;\"><strong>0</strong></td>\n<td style=\"width: 34.8062%; height: 22.3984px;\">&gt;20 (&gt;30 obese)</td>\n<td style=\"width: 51.7126%; height: 22.3984px;\"><strong>&lt;5%</strong></td>\n</tr>\n<tr style=\"height: 22.3984px;\">\n<td style=\"width: 13.4812%; height: 22.3984px;\">1</td>\n<td style=\"width: 34.8062%; height: 22.3984px;\">18.5-20</td>\n<td style=\"width: 51.7126%; height: 22.3984px;\">5-10%\u00a0</td>\n</tr>\n<tr style=\"height: 22.3984px;\">\n<td style=\"width: 13.4812%; height: 22.3984px;\">2</td>\n<td style=\"width: 34.8062%; height: 22.3984px;\">&lt; 18.5</td>\n<td style=\"width: 51.7126%; height: 22.3984px;\">&gt;10%</td>\n</tr>\n</tbody>\n</table>\n<p>Acute disease effect: add 2. The overall risk for malnutrition is established as <strong>low (score = 0), medium (score = 1), or high (score &gt; 2).</strong></p>\n<p>This screening tool's ability to be used in all healthcare settings and by <strong>adults of all ages</strong> is a significant <strong>advantage.</strong> It has good concurrent validity with the majority of other nutrition assessment tools tested and is quick and simple to use.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient who presented with significant weight loss was started on parenteral nutrition, following which, he developed refeeding syndrome. What is the maximum nutritional support that should be started to prevent this condition?",
    "choices": [
      {
        "id": 1,
        "text": "5 kcal/kg per day"
      },
      {
        "id": 2,
        "text": "10 kcal/kg per day"
      },
      {
        "id": 3,
        "text": "15 kcal/kg per day"
      },
      {
        "id": 4,
        "text": "20 kcal/kg per day"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In the above clinical scenario of<strong> refeeding syndrome, </strong>maximum nutritional support of <strong>10 kcal/kg per day</strong> is recommended to prevent this condition from occurring.</p>\n<p><strong>Refeeding syndrome </strong>is a potentially lethal condition that can occur with <strong>rapid</strong> and <strong>excessive feeding</strong> of patients with severe underlying <strong>malnutrition</strong> due to starvation, alcoholism, delayed nutritional support, anorexia nervosa, or massive weight loss in obese patients.</p>\n<p>The patient is considered to be at risk of developing refeeding syndrome with either one or more of the following:\u00a0</p>\n<ul>\n<li>BMI &lt;16 kg/m2</li>\n<li><strong>Unintentional weight loss &gt;15% within the last 3\u20136 months\u00a0</strong></li>\n<li>Little or no nutritional intake for more than 10 days\u00a0</li>\n<li>Low potassium, phosphate or magnesium levels prior to feeding\u00a0</li>\n</ul>\n<p>With excessive refeeding, there is an increased release of insulin due to the metabolic shift from <strong>fat</strong> to <strong>carbohydrate </strong>substrate. As a result, there is an increase in the cellular uptake of electrolytes including phosphate, magnesium, potassium, and calcium. Hence metabolic abnormalities are seen which include <strong>hypophosphatemia, h</strong><strong>ypomagnesemia, h</strong><strong>ypokalemia, </strong>and<strong> h</strong><strong>ypocalcemia.</strong></p>\n<p>These electrolyte disorders thereby result in myocardial infarction, arrhythmias, respiratory dysfunction, liver dysfunction, seizures, confusion, coma, tetany, and death.</p>\n<p>Nutritional support should be started at a maximum of<strong> 10 kcal/kg per day,</strong> with the goal of gradually increasing levels to meet full needs within<strong> 4-7 days.</strong>\u00a0Treatment includes the <strong>correction</strong> of underlying <strong>electrolyte abnormalities</strong> and nutritional support with supplementary <strong>thiamine, vitamin</strong> <strong>B,</strong> multivitamins and trace elements.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b90bd25dfc0e47c9bcc71d63946d74e9x1280x2558.JPEG"
    ]
  },
  {
    "text": "A 60-year-old male patient, diagnosed with colon cancer, underwent a hemicolectomy procedure. Following the surgery, he developed persistent nausea and vomiting with significant weight loss. An abdominal CT scan with contrast showed the following findings. Resolution of symptoms was seen following weight gain in the patient. Which part of the bowel is involved in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Ascending colon"
      },
      {
        "id": 2,
        "text": "Duodenum"
      },
      {
        "id": 3,
        "text": "Ileum"
      },
      {
        "id": 4,
        "text": "Transverse colon"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In the given clinical scenario of an elderly male patient presenting with <strong>persistent nausea, vomiting</strong> and <strong>significant weight loss</strong> following a <strong>hemicolectomy procedure</strong> for colon cancer with <strong>resolution</strong> of these symptoms with<strong> weight gain</strong> and <strong>CT abdomen</strong> showing <strong>reduced angle</strong> between the <strong>superior mesenteric artery </strong>and the <strong>abdominal aorta</strong> is suggestive of <strong>superior mesenteric artery (SMA) syndrome/ Wilkie syndrome.</strong> The <strong>duodenum</strong> is involved in this condition.</p>\n<p>Wilkie's syndrome is an acquired disorder in which the <strong>third part of the duodenum</strong> gets compressed between the superior mesenteric artery anteriorly and the aorta posteriorly, as shown in the image below.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/0c93523e0fbc4270ac6bf6afea5dda27.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1fe671582fe24b2a822f5e2da966cdc1x1280x2560.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2b94ce6ed6d94a23a06c014f0a892299x720x662.PNG"
    ]
  },
  {
    "text": "A 45-year-old diabetic lady presented to the OPD with the following skin lesion. She also gives a history of depression and unintentional weight loss over the past few months. Further examination confirms the presence of a pancreatic neuroendocrine tumour. Which of the following should be evaluated to confirm the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Somatostatin levels"
      },
      {
        "id": 2,
        "text": "Vasoactive Intestinal Peptide (VIP) levels"
      },
      {
        "id": 3,
        "text": "Glucagon levels"
      },
      {
        "id": 4,
        "text": "C peptide levels"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In the given clinical scenario of a 45-year-old <strong>diabetic</strong> lady with a history of <strong>depression</strong> and <strong>unintentional weight loss</strong> presenting with necrolytic migrating erythema (shown in the image) and further examination confirming the presence of a\u00a0 pancreatic neuroendocrine tumour is suggestive of <strong>glucagonoma</strong>. <strong>Glucagon level</strong> <strong>&gt;1000 pg/mL</strong> is considered <strong>diagnostic.</strong></p>\n<p>Glucagonoma\u00a0is a rare neuroendocrine tumour of the pancreas. A majority of them are malignant at the time of presentation. They are most commonly seen arising from the <strong>pancreatic tail.</strong></p>\n<p>Clinically, the classic presentation of glucagonoma is with the \u201c<strong>4 D\u2019s</strong>\u201d:</p>\n<ul>\n<li><strong>Diabetes</strong></li>\n<li><strong>Dermatitis</strong>- a characteristic waxing and waning necrolytic migrating erythema is seen that usually appears before other symptoms.</li>\n<li><strong>Deep vein thrombosis</strong>\u00a0</li>\n<li><strong>Depression</strong></li>\n</ul>\n<p>In addition, it is marked by a <strong>severe catabolic state</strong> that results in <strong>significant weight loss,</strong> depletion of protein and fat reserves and vitamin deficiencies.\u00a0</p>\n<p><strong>Necrolytic migrating erythema</strong> is a characteristic skin lesion seen in glucagonoma patients usually before the appearance of other symptoms It is thought to be caused by<strong> low levels of amino acids. </strong>Therefore <strong>parenteral administration</strong> of amino acids was found to result in the disappearance of the skin lesions.</p>\n<p>Diagnosis is established by estimating plasma glucagon levels. A level <strong>&gt;1000 pg/mL</strong> is considered diagnostic (normal plasma glucagon level is &lt;150 pg/mL). <strong>Hypoaminoacidemia</strong> is also a characteristic laboratory finding.\u00a0</p>\n<div class=\"page\" title=\"Page 655\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Treatment</strong>\u00a0may include long-acting\u00a0somatostatin analogues\u00a0like <strong>octreotide</strong> to relieve some of the clinical symptoms such as dermatitis. To counteract the effects of malnutrition and the catabolic effects of weight loss, nutritional support measures include total parenteral nutrition and supplementation with amino acids and zinc.</p>\n<p><strong>Surgical resection</strong> may be attempted but is often unsuccessful due to extrapancreatic malignant spread at the time of diagnosis.\u00a0</p>\n<p>Other options:</p>\n<p>Option A: <strong>Somatostatinoma</strong> is also a pancreatic neuroendocrine tumour characterized by steatorrhea, diabetes mellitus, hypochlorhydria, and gallstones. A fasting plasma <strong>somatostatin level</strong> <strong>&gt;160 pg/m</strong>l is indicative of somatostatinoma.</p>\n<p>Option B: <strong>VIPoma</strong> is characterized by watery diarrhoea, hypokalemia, and achlorhydria (WDHA syndrome). It is caused by the release of <strong>vasoactive intestinal peptide</strong> (VIP) from the tumour. Patients with VIPomas have levels ranging from<strong> 225-2000 pg/mL </strong>(normal VIP levels &lt; 200 pg/mL)</p>\n<p>Option D: <strong>Insulinomas</strong> are the most common pancreatic neuroendocrine tumors. They are characterized by symptoms of <strong>hypoglycemia,</strong> <strong>low plasma glucose</strong> at the time of symptoms, and relief of symptoms on glucose consumption. This is known as the <strong>Whipple's triad</strong>.<strong> C peptide levels &gt; </strong><strong>1.2 \u03bcg/ml </strong>with a glucose level of &lt;40 mg/dl are highly suggestive of insulinoma.</p>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c7d01b36d05e498fab15c625b5dd24d4.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Otoscopic examination in a young lady with a history of significant unintentional weight loss shows synchronous movement of the tympanic membrane with respiration. What other feature will be characteristically seen in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Popping sensation"
      },
      {
        "id": 2,
        "text": "Otitis media with effusion"
      },
      {
        "id": 3,
        "text": "Autophony"
      },
      {
        "id": 4,
        "text": "Otalgia"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario of a young lady with a history of <strong>significant unintentional weight loss</strong> and ENT examination showing <strong>synchronous</strong> <strong>movement</strong> of the <strong>tympanic membrane</strong> with <strong>respiration</strong> is suggestive of a <strong>patulous eustachian tube</strong>. <strong>Autophony</strong> is characteristically seen in this condition.</p>\n<p>Autophony is the <strong>abnormal perception</strong> of <strong>one's own breath and voice sounds.</strong></p>\n<p>Patulous tube is a benign condition in which the eustachian tube remains <strong>abnormally patent.</strong> It is associated with <strong>weight loss</strong> (due to chronic illness), <strong>pregnancy</strong> (especially in the third trimester) and <strong>neurologic disorders</strong> like stroke and multiple sclerosis.\u00a0Significant weight loss can lead to abnormal patency due to <strong>reduced tissue pressures</strong> and <strong>loss of fat deposits</strong> in the eustachian tube region.\u00a0</p>\n<p>The most common symptom of a patulous tube is autophony. Patients also present with varying degrees of <strong>aural fullness,</strong> loud <strong>tinnitus</strong> synchronized with nasal breathing. When excessive pressure changes are transmitted to the middle ear, <strong>vertigo</strong> and <strong>hearing loss</strong> can occur.</p>\n<p>Treatment includes <strong>weight gain</strong> and administration of<strong> potassium iodide solution</strong>. In long-standing cases, <strong>cauterization</strong> of tubes or <strong>grommet insertion</strong> is done.</p>\n<p>Other options:</p>\n<p>Options A and D: <strong>Popping sensations</strong> and <strong>otalgia</strong> are seen in cases of <strong>tubal blockage.</strong></p>\n<p>Option B: <strong>Otitis media with effusion </strong>is commonly seen in patients with <strong>cleft palate</strong> due to the <strong>high elastin</strong> content of the <strong>torus tubarius,</strong> which makes tube opening difficult.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following inflammatory mediators is not responsible for the symptoms of cachexia and unintentional weight loss in cancer patients?",
    "choices": [
      {
        "id": 1,
        "text": "Interleukin-1 \u03b2"
      },
      {
        "id": 2,
        "text": "Interleukin-2"
      },
      {
        "id": 3,
        "text": "Interleukin-6"
      },
      {
        "id": 4,
        "text": "TNF-\u03b1"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Cachexia</strong> and <strong>weight loss</strong> in cancer patients have been mainly linked to the inflammatory mediators <strong>TNF-\u03b1, interleukin-1 \u03b2, and interleukin-6.</strong> Interleukin-2 does not play a role in this.</p>\n<p>Cancer cachexia is a <strong>hypercatabolic</strong> state characterized by a<strong> loss of muscle mass</strong> that cannot be explained by a reduction in food intake. It is a severely debilitating condition marked by <strong>extreme weight loss,</strong> fatigue, muscle atrophy, anaemia, anorexia, and oedema.</p>\n<p>Cytokines <strong>suppress feeding behaviour</strong> and <strong>decrease gastric motility,</strong> <strong>gastric emptying,</strong> and <strong>intestinal motility.</strong> TNF-\u03b1, also known as <strong>cachectin,</strong> is a primary mediator of muscle wasting. Muscle loss occurs as a result of increased degradation of major skeletal muscle structural proteins due to cytokines, which result in <strong>ubiquitination</strong> of target proteins and proteolysis via the proteasome.</p>\n<p>Loss of fat stores in cancer patients is attributed to a protein called<strong> lipid mobilizing factor</strong>. This has been detected in the sera and urine of patients with advanced cancer and it sensitizes adipocytes to lipolytic stimuli.</p>\n<p>Tumour necrosis factor-\u03b1 levels are also elevated in several other disease states associated with cachexia and weight loss like AIDS, heart failure, rheumatoid arthritis and COPD.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not considered a major manifestation of unintentional weight loss?",
    "choices": [
      {
        "id": 1,
        "text": "Anorexia"
      },
      {
        "id": 2,
        "text": "Dehydration"
      },
      {
        "id": 3,
        "text": "Osteopenia"
      },
      {
        "id": 4,
        "text": "Sarcopenia"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Osteopenia</strong> is not considered a major manifestation of unintentional weight loss (UWL).</p>\n<p>The four major manifestations of unintentional weight loss are</p>\n<ul>\n<li><strong>Anorexia</strong> (loss of appetite)</li>\n<li><strong>Sarcopenia</strong> (loss of muscle mass)</li>\n<li><strong>Cachexia</strong> (a syndrome of weight loss, loss of muscle and adipose tissue, anorexia, and weakness)</li>\n<li><strong>Dehydration</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 50-year-old male patient with a history of coronary artery disease presented with recurrent postprandial abdominal pain over the last 6 months. The pain typically occurs within 30 minutes of starting the meal. The patient also reports avoiding certain food items that precipitate these symptoms, which has ultimately led to significant weight loss in the patient. Which of the following investigations is considered the best screening tool to evaluate this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Upper GI Endoscopy"
      },
      {
        "id": 2,
        "text": "Barium-meal follow through"
      },
      {
        "id": 3,
        "text": "Duplex ultrasound"
      },
      {
        "id": 4,
        "text": "CT angiography"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario of a 50-year-old male patient with a history of <strong>coronary artery disease</strong> presenting with a <strong>6-month</strong> history of recurrent <strong>postprandial abdominal pain</strong> which starts within <strong>30 minutes</strong> of starting a meal and the avoidance of certain food items that precipitate these symptoms, which has led to <strong>significant weight loss</strong> points to the diagnosis of<strong> chronic mesenteric ischemia. Duplex ultrasound</strong> is the best <strong>screening tool</strong> to evaluate this condition.</p>\n<p>Chronic mesenteric ischemia occurs due to <strong>atherosclerosis</strong> of the <strong>celiac</strong> or <strong>mesenteric arteries.</strong> It is common in older women, and they usually have a history of <strong>smoking, coronary artery disease,</strong> cerebrovascular disease, or peripheral artery disease.\u00a0</p>\n<p>Postprandial abdominal pain, known as <strong>intestinal angina,</strong> is caused by an imbalance between increased demand and decreased blood flow to the intestine. Pain typically begins 30 minutes after the start of a meal and lasts an hour or more. In the epigastrium, <strong>pain</strong> is felt as a <strong>deep, constant ache</strong> that can sometimes radiate to the upper left or right quadrant.\u00a0</p>\n<p>Patients <strong>avoid eating</strong> due to postprandial pain and this leads to <strong>significant weight loss.</strong></p>\n<p><strong>Duplex ultrasound's</strong> high sensitivity and specificity have made it a <strong>popular screening tool</strong> for assessing mesenteric vessels.\u00a0Diagnosis is confirmed by <strong>CT angiography. </strong>Once the disease is confirmed, the patients have to be started with <strong>antiplatelets</strong> and <strong>mesenteric angioplasty</strong> and <strong>stenting</strong> should be performed.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 40-year-old woman presented with unintentional weight loss, sweating, and palpitations. On examination, she was found to have an enlarged thyroid gland. Radioactive iodine studies revealed the following findings. What is the definitive management in this case?",
    "choices": [
      {
        "id": 1,
        "text": "Anti-thyroid drugs"
      },
      {
        "id": 2,
        "text": "Radioactive iodine therapy"
      },
      {
        "id": 3,
        "text": "Total thyroidectomy"
      },
      {
        "id": 4,
        "text": "Hemithyroidectomy"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario of a 40-year-old woman who presented with <strong>unintentional weight loss, sweating,</strong> and <strong>palpitations</strong> with an <strong>enlarged thyroid gland</strong> on examination and radioactive iodine scan showing multiple areas of <strong>high iodine uptake</strong> is suggestive of <strong>toxic multinodular goitre. </strong>The definitive management is a\u00a0<strong>total</strong> or<strong> near-total thyroidectomy.</strong></p>\n<p>Multinodular goitre (MNG) is more commonly observed in women. It is common in\u00a0<strong>iodine-deficient regions.\u00a0</strong>MNG is discordant growth with functionally and structurally altered thyroid follicles presenting as <strong>multiple nodules</strong> in the thyroid. It could present as toxic or non-toxic MNG</p>\n<p>Clinical features:</p>\n<div class=\"page\" title=\"Page 471\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<div class=\"page\" title=\"Page 471\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<ul>\n<li><strong>Multiple nodules</strong>\u00a0of different sizes are formed in both lobes, also in the isthmus, which is firm, nodular, non-tender, and moves with deglutition.</li>\n<li>Patients with toxic MNG have\u00a0<strong>subclinical</strong>\u00a0or\u00a0<strong>mild hyperthyroidism</strong>.</li>\n<li>The recent increase in size signifies\u00a0<strong>malignant transformation</strong>\u00a0or\u00a0<strong>haemorrhage.</strong></li>\n<li><strong>Positive Kocher\u2019s test</strong>\u00a0is due to compression over the trachea (tracheomalacia/scabbard trachea) in a long-standing MNG.</li>\n<li>Nodule when calcified becomes harder; necrosis softens the nodule.</li>\n</ul>\n<p>Investigations:</p>\n<ul>\n<li>Thyroid function test - suggestive of\u00a0<strong>subclinical</strong>\u00a0or\u00a0<strong>mild hyperthyroidism</strong>.</li>\n<li><strong>Ultrasound</strong> neck identifies impalpable nodules, number, nature of nodule, and vascularity of nodule.</li>\n<li><strong>Radioactive Iodine </strong>studies show <strong>high uptake</strong> in <strong>multiple sites</strong> due to <strong>over-functioning</strong> of the <strong>toxic nodules.</strong></li>\n<li><strong>FNAC</strong> is done from the most dominant and suspicious nodule.</li>\n</ul>\n<div class=\"page\" title=\"Page 472\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Complications of MNG:</p>\n</div>\n</div>\n</div>\n</div>\n<ul>\n<li>Secondary thyrotoxicosis\u00a0</li>\n<li><strong>Follicular carcinoma</strong> of the thyroid</li>\n<li>Hemorrhage in a nodule</li>\n<li>Tracheal obstruction, calcification</li>\n</ul>\n<p>Treatment:</p>\n<div class=\"page\" title=\"Page 473\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Usually,\u00a0<strong>surgery</strong>\u00a0is preferred after bringing the patient to a euthyroid state with the help of <strong>anti-thyroid drugs </strong>(option A).\u00a0<strong>Radioactive iodine therapy </strong>(option B) is implemented for large goitres as it decreases goitre size and can ablate regions of autonomy.</p>\n<p>Adequate thyroidectomy is essential, either<strong> total or subtotal, complete removal</strong> of<strong> diseased thyroid</strong> without retaining is considered, due to chances of <strong>high recurrence</strong>. Re-surgery for recurrent MNG is difficult due to loss of anatomical plane and fibrosis; hence\u00a0<strong>total thyroidectomy</strong>\u00a0is often advised.\u00a0<strong>Postoperative L-thyroxine</strong>\u00a0is often given to prevent any fluctuation in TSH level which may cause recurrent nodule formation.</p>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/f6432a7338f3409bbf8a646cd1574ac6.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/84debe461e9e4ef6a8de25fbe9c71e7fx1280x3027.JPEG"
    ]
  },
  {
    "text": "A 50-year-old smoker presents with occasional chest pain, pain along the left arm, and ptosis. He also complains of unintentional weight loss for the past month. His chest X-ray reveals a mass at the left lung apex with the destruction of adjacent ribs. He underwent the imaging modality shown, which revealed a high uptake within the tumour. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Small cell carcinoma of the lung"
      },
      {
        "id": 2,
        "text": "Bronchial carcinoid tumour"
      },
      {
        "id": 3,
        "text": "Pancoast tumor"
      },
      {
        "id": 4,
        "text": "Adenocarcinoma of the lung"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario of a 50-year-old smoker presenting with <strong>occasional chest pain, pain</strong> along the<strong> left arm</strong>, <strong>ptosis</strong> and <strong>unintentional weight loss</strong> for the past month with a chest X-ray revealing a <strong>mass</strong> at the <strong>left lung apex</strong> with the <strong>destruction</strong> of <strong>adjacent ribs</strong> and the<strong> FDG PET-CT </strong>scan shown above revealing a<strong> high uptake</strong> within the tumour is suggestive of a <strong>Pancoast</strong> <strong>tumour (superior sulcus tumour).\u00a0</strong></p>\n<p>Pancoast\u2019s tumour is a rare form of lung cancer that originates at the apex of the lung. It has a unique presentation due to the <strong>stellate ganglion, chest wall</strong> and <strong>brachial plexus involvement. </strong></p>\n<p>It can invade the brachial plexus<strong> (C8 and T1 commonly)</strong>, resulting in a radicular distribution of pain along the ulnar nerve. Invasion of the <strong>stellate ganglion</strong> results in <strong>Horner\u2019s syndrome</strong> which presents with <strong>ipsilateral ptosis, miosis, enophthalmos, and anhidrosis</strong>. <strong>Shoulder</strong> and <strong>chest pain </strong>on the same side can result from the invasion into the <strong>chest wall</strong> and the<strong> 1st and/or 2nd rib</strong>s. Local spread, if involving the trachea or esophagus can result in <strong>dyspnea</strong> or <strong>dysphagia.</strong>\u00a0</p>\n<p>Investigations:</p>\n<ul>\n<li><strong>MRI &gt; CT</strong> is the investigation of choice for superior sulcus tumour/ Pancoast tumour.</li>\n<li><strong>FDG-PET</strong> scan shows high uptake by the tumour cells. FDG is taken up by all metabolizing cells but more avidly by cancer cells.</li>\n<li><strong>Bronchoscopy</strong> can be done in endobronchial tumours to obtain a tissue diagnosis.</li>\n</ul>\n<p>Management is summarized in the flowchart as shown below.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/f5a74d3171a741fc9d706d08eb92196d.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/47460bc51cd64c32a49dcf30dabb28a6x1280x2864.JPEG"
    ]
  },
  {
    "text": "A 50-year-old male presented with a history of epigastric pain, vomiting and peripheral edema. He also gave a history of involuntary weight loss in the last 2 months. On investigation, his serum protein level was found to be low. An endoscopy was done, and an image obtained when the scope was in the stomach is shown below. The gastric aspirate showed a decrease in the acid content of the stomach. Which part of the stomach is usually spared in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Antrum"
      },
      {
        "id": 2,
        "text": "Fundus"
      },
      {
        "id": 3,
        "text": "Body"
      },
      {
        "id": 4,
        "text": "Cardia"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario of a 50-year-old male who presented with <strong>epigastric pain, vomiting, peripheral edema,</strong>\u00a0<strong>involuntary weight loss</strong> and <strong>hypoproteinemia</strong> with a decreased acid content of the stomach (<strong>hypochlorhydria)</strong> and endoscopy showing <strong>hypertrophied gastric mucosal folds</strong> is suggestive of <strong>M\u00e9n\u00e9trier disease</strong> which usually spares the <strong>antrum</strong> of the stomach.</p>\n<p><strong>Menetrier</strong> <strong>disease, </strong>also called<strong>\u00a0hyperplastic hypersecretory gastropathy\u00a0</strong>is a disorder of the stomach characterized by <strong>enlarged rugae</strong> (gastric folds). It is common in <strong>men</strong> and the age of onset is usually between 40-60 years. In children, it is usually associated with <strong>cytomegalovirus infection</strong> and in adults the aetiology is unknown.</p>\n<p>Clinical features include <strong>epigastric pain,</strong> nausea, <strong>vomiting,</strong> anorexia, <strong>peripheral edema,</strong> and <strong>weight loss.</strong> <span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">It occurs due to <strong>excessive secretion</strong> of </span><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">transforming growth factor (TGF)-\u03b1,</strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> which stimulates the epidermal growth factor receptor <strong>(EGFR) pathway,</strong> resulting in increased proliferation of <strong>mucus cells/foveolar hyperplasia</strong> within the body and fundus, causing enlarged gastric folds. The <strong>antrum is usually spared.\u00a0</strong></span></p>\n<p>There is excessive production of <strong>mucous</strong> in the stomach which results in increased loss of proteins <strong>(hypoproteinemia),</strong> and a decreased number of parietal cells and oxyntic glands leads to <strong>hypochlorhydria.</strong> They are at an increased risk of developing <strong>gastric carcinoma.</strong></p>\n<p>Histopathologic examination of the stomach shows hyperplasia of foveolar mucous cells, <strong>cystically dilated glands</strong> that are elongated\u00a0(with a <strong>corkscrew-like appearance)</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/7a3503d2b0a54954b6e3c3b1fe26064d.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4860366c504447dfa0b85302a5bd5a21x510x802.GIF"
    ]
  },
  {
    "text": "A 23-year-old man presented with diarrhea, floating stools, and weight loss for 3 months. The biopsy of the intestine is shown below. His symptoms improved with folic acid intake. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Celiac disease"
      },
      {
        "id": 2,
        "text": "Whipple\u2019s disease"
      },
      {
        "id": 3,
        "text": "Tropical sprue"
      },
      {
        "id": 4,
        "text": "Short bowel syndrome"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The above clinical scenario of a young man presenting with diarrhea, floating stools, and weight loss\u00a0with histopathology showing <strong>partial villous atrophy</strong> and marked intraepithelial lymphocytosis indicating inflammation of lamina propria\u00a0and improvement with folic acid intake is suggestive of <strong>tropical sprue</strong>.</p>\n<p><strong>Tropical sprue</strong> is an acquired <strong>malabsorptive</strong> condition that causes chronic diarrhea, steatorrhea, weight loss, and folate and vitamin B12 malabsorption. It occurs in some tropical regions and is often considered a postinfectious complication. Diagnosis is based on a <strong>small intestinal biopsy</strong> showing villous atrophy and chronic inflammation, similar to celiac disease. However, tropical sprue\u00a0is <strong>unresponsive</strong> to a <strong>gluten-free diet</strong>.</p>\n<p>Treatment includes broad-spectrum antibiotics (e.g., <strong>tetracycline</strong> for up to six months) and <strong>folic acid supplementation</strong>, which can lead to improvement within weeks. Patients often recover fully if they leave the endemic area. Folic acid alone can improve symptoms and correct hematologic deficiencies, but antibiotics are typically needed for complete resolution.</p>\n<p>Other options:</p>\n<p>Option A: <strong>Celiac disease</strong> is a gluten-sensitive enteropathy. Patients present with iron deficiency anemia, weight loss, diarrhea, and malabsorption. A biopsy reveals <strong>blunting of the villi</strong>, crypt hyperplasia, and inflammation propria. <strong>Tissue transglutaminase </strong>is involved in the pathogenesis of this disorder. Patients <strong>respond </strong>to a <strong>gluten</strong>-free diet. The image below shows histopathological findings seen in celiac disease.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/12b10219a48f423197e732661e055dd0.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f21ca58ddcea4cde873759dd93ff248bx761x674.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/01e1db2c217148d5a7278e99fbe85309x900x675.JPEG"
    ]
  },
  {
    "text": "Which of the following drugs used to treat type II diabetes mellitus causes weight loss?",
    "choices": [
      {
        "id": 1,
        "text": "Liraglutide"
      },
      {
        "id": 2,
        "text": "Glimepiride"
      },
      {
        "id": 3,
        "text": "Repaglinide"
      },
      {
        "id": 4,
        "text": "Tolbutamide"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Liraglutide promotes <strong>weight loss</strong>.</p>\n<p>NOTE:</p>\n<p>GLP-1 analogs, pramlintide, SGLT-2 inhibitors, and metformin* cause weight loss\u00a0</p>\n<p>DPP-4 inhibitors and alpha-glucosidase inhibitors are weight neutral drugs.</p>\n<p>Sulfonylureas and insulin promote weight gain.</p>\n<p>Note: *Metformin classification is a bit difficult. It can cause weight loss especially in obese patients and few authorities do consider metformin as weight neutral.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient who is a known case of alcohol dependence syndrome presents with sudden and unintentional weight loss. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Hepatic adenoma"
      },
      {
        "id": 2,
        "text": "Cholangiocarcinoma"
      },
      {
        "id": 3,
        "text": "Hepatocellular carcinoma"
      },
      {
        "id": 4,
        "text": "Alcoholic hepatitis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The most likely diagnosis in this patient with a history of alcohol dependence, sudden unintentional weight loss, and <strong>raised AFP</strong> is <strong>hepatocellular carcinoma</strong> (HCC).</p>\n<div class=\"page\" title=\"Page 624\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>HCC</strong> is the <strong>most common cause of primary liver cancer</strong>. It is more commonly seen in males, and the peak age group is between 65-70 years. The <strong>main risk factor</strong> for HCC is <strong>cirrhosis</strong> and associated chronic liver damage due to chronic infection by hepatitis B or C virus (HBV or HCV), <strong>alcohol abuse</strong>, metabolic syndrome, or hemochromatosis. The<strong> incidence </strong>of<strong> HCC</strong> is <strong>increasing</strong> worldwide. This is contributed by the increase in HCV and HBV infections, along with lifestyle disorders like obesity.&nbsp;Obesity is associated with non-alcoholic fatty liver disease (NAFLD). This progresses on to non-alcoholic steatohepatitis (NASH) causing cirrhosis and hepatocellular carcinoma. Thus,&nbsp;NASH and NAFLD are risk factors for HCC.&nbsp;</p>\n<p>Regular surveillance, including liver imaging and monitoring of alpha-fetoprotein levels, is recommended for high-risk populations, such as those with liver cirrhosis, chronic hepatitis B or C infection, or significant alcohol consumption. Early detection of HCC can improve treatment outcomes and overall prognosis.</p>\n</div>\n</div>\n</div>\n</div>\n<p>Very early HCC is treated by ablation. Early HCC with a single nodule is resected, but when there are multiple nodules over 3 cm, ablation or transplantation are considered.&nbsp;Intermediate-stage HCC is treated by chemoembolization.&nbsp;Transarterial chemoembolization (<strong>TACE</strong>) is used for multinodular lesions. &nbsp;</p>\n<p>Other Options:</p>\n<p>Option A: <strong>Hepatic adenomas</strong> are <strong>benign liver tumors</strong> that are often <strong>associated with oral contraceptive use</strong> and <strong>anabolic steroid use</strong>.&nbsp;The patient's history of alcohol dependence and high alpha-fetoprotein levels are not consistent with hepatic adenoma. Additionally, hepatic adenomas are usually <strong>asymptomatic</strong> and do not present with sudden unintentional weight loss.</p>\n<p>Option B: Cholangiocarcinoma&nbsp;is a cancer that arises from the bile ducts within the liver. While patients with alcohol dependence may have an increased risk of cholangiocarcinoma, the <strong>elevated alpha-fetoprotein levels are not typical</strong> for this type of cancer. Cholangiocarcinomas usually <strong>present with jaundice, pruritus, and abdominal pain</strong>, but sudden weight loss is less characteristic.</p>\n<p>Option D: <strong>Alcoholic hepatitis</strong> is an inflammation of the liver caused by excessive alcohol consumption. It usually presents with jaundice, fever, and abdominal pain. While the patient's history of alcohol dependence might suggest alcoholic hepatitis, elevated alpha-fetoprotein levels and unintentional weight loss are not typical for this condition. Moreover, the AST/ALT ratio is usually greater than 2 in alcoholic hepatitis, but it is 0.5 in this case.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A transbronchial biopsy of a patient with fever, cough and weight loss shows the findings of the biopsy below. Which of the following chemical mediators are involved in its pathogenesis?",
    "choices": [
      {
        "id": 1,
        "text": "IFN gamma"
      },
      {
        "id": 2,
        "text": "Bradykinin"
      },
      {
        "id": 3,
        "text": "C5a"
      },
      {
        "id": 4,
        "text": "Prostaglandin"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong class=\"animating\">Interferon gamma (IFN-\u03b3) </strong>i<span class=\"animating\">s a <strong>pro-inflammatory cytokine</strong> that is involved in the formation of granulomas.</span><span class=\"animating\">\u00a0It <strong>activates macrophages</strong> to differentiate into <strong>epithelioid cells</strong> and <strong>multinucleated giant cells</strong>,</span><span class=\"animating\">\u00a0which are the main components of granulomas.</span></p>\n<p data-sourcepos=\"12:1-12:170\"><span class=\"animating\">IFN-\u03b3 is the most important chemical mediator involved in the pathogenesis of granulomas.</span><span class=\"animating\"> It is produced by <strong>T helper 1 (Th1) cells</strong> and other immune cells in response to a variety of stimuli,</span><span class=\"animating\"> including infections,</span><span class=\"animating\"> autoimmune diseases,</span><span class=\"animating\"> and foreign bodies.</span></p>\n<p><strong>Interferon-gamma-induced changes</strong>\u00a0in the macrophages:</p>\n<ol>\n<li><strong>Augmented ability</strong>\u00a0of the macrophages to\u00a0<strong>phagocytose</strong>\u00a0and kill micro-organisms.</li>\n<li><strong>Increased</strong>\u00a0expression of<strong>\u00a0class 2 MHC molecules</strong>\u00a0to enhance antigen presentation.</li>\n<li>Increased secretion in presence of\u00a0<strong>tumor necrosis factor, interleukin-1,</strong>\u00a0and other inflammatory chemokines.</li>\n<li><strong>Amplification</strong>\u00a0of the Th1 response by producing more\u00a0<strong>interleukin-12.</strong></li>\n</ol>\n<p data-sourcepos=\"14:1-14:454\"><span class=\"animating\"><strong>Granulomas</strong> are characteristic of a number of diseases,</span><span class=\"animating\"> including <strong>tuberculosis,</strong></span><strong><span class=\"animating\"> sarcoidosis,</span></strong><span class=\"animating\"><strong> and Crohn's disease</strong>.</span><span class=\"animating\"> In these diseases,</span><span class=\"animating\"> IFN-\u03b3 plays a central role in the formation of granulomas,</span><span class=\"animating\"> which help to <strong>contain and eliminate</strong> the offending agent.</span><span class=\"animating\"> However,</span><span class=\"animating\"> granulomas can also be formed in response to non-harmful stimuli,</span><span class=\"animating\"> such as foreign bodies or allergens.</span><span class=\"animating\"> In these cases,</span><span class=\"animating\"> granulomas can be harmful and can lead to tissue damage and organ dysfunction.</span></p>\n<p><strong class=\"animating\">B. Bradykinin:</strong><span class=\"animating\">\u00a0Bradykinin is a vasodilator that is involved in the inflammatory response.</span><span class=\"animating\">\u00a0It is not directly involved in the formation of granulomas.</span></p>\n<p><strong class=\"animating\">C. Complement C5a:</strong><span class=\"animating\">\u00a0Complement C5a is a chemoattractant that attracts neutrophils and other inflammatory cells to the site of infection or injury.</span><span class=\"animating\">\u00a0It is not directly involved in the formation of granulomas.</span></p>\n<p><strong class=\"animating\">D. Prostaglandin:</strong><span class=\"animating\">\u00a0Prostaglandins are a group of signaling molecules that are involved in a variety of physiological processes,</span><span class=\"animating\">\u00a0including inflammation.</span><span class=\"animating\">\u00a0Prostaglandins can promote or inhibit the formation of granulomas,</span><span class=\"animating\">\u00a0depending on the context.</span></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/db9335dac1d049e88c02736e6e86292e.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Patients on which of the following antiepileptic drugs will experience weight loss?",
    "choices": [
      {
        "id": 1,
        "text": "Sodium valproate"
      },
      {
        "id": 2,
        "text": "Vigabatrin"
      },
      {
        "id": 3,
        "text": "Topiramate"
      },
      {
        "id": 4,
        "text": "Carbamazepine"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Topiramate</strong> causes <strong>weight loss</strong> as one of its common side effects.&nbsp;</p>\n<p>Topiramate has mixed mechanisms of action<strong>:</strong></p>\n<ul>\n<li>Reduces voltage gate Na+ currents</li>\n<li>Activates hyperpolarizing K+ currents</li>\n<li>Enhances postsynaptic GABAA current</li>\n<li>Limits the activation of AMPA subtype of glutamate receptors.</li>\n</ul>\n<p>Topiramate is used in <strong>focal seizures, GTCS </strong>and<strong>&nbsp;Lennox-Gastaut syndrome</strong>.</p>\n<p>The side effects:&nbsp;</p>\n<ul>\n<li>Cognitive impairment</li>\n<li><strong>Weight loss</strong></li>\n<li>Fatigue</li>\n<li>Renal calculi</li>\n</ul>\n<p>Sodium valproate, vigabatrin (highest incidence), and carbamazepine cause <strong>weight gain.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = 'Unintentional Weight Loss Mini Test - -Tmt';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2023-24"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>