<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>01 Basics Of Fracture And Its Management - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Orthopedics
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">19</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following is a pathognomonic sign of a long bone fracture?",
    "choices": [
      {
        "id": 1,
        "text": "Pain on movement"
      },
      {
        "id": 2,
        "text": "Swelling"
      },
      {
        "id": 3,
        "text": "Deformity"
      },
      {
        "id": 4,
        "text": "Abnormal mobility"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Abnormal mobility&nbsp;</strong>in a long bone is a <strong>pathognomonic</strong> sign of <strong>fracture</strong>.&nbsp;</p>\n<p><span class=\"fontstyle0\">A fracture is a <strong>break in the structural continuity</strong> of the bone. Generally, <strong>m</strong></span><strong>ovements</strong> occur in the limb <strong>only at the joints</strong>. If one is able to elicit <strong>mobility at locations other than the joints</strong> (say in the middle of the arm), it is a <strong>definite sign of a fracture</strong>. <strong>Crepitus</strong> may be felt while doing this. Other features of a fracture include:</p>\n<ul>\n<li><span class=\"fontstyle0\">Pain</span></li>\n<li><span class=\"fontstyle0\">Bruising</span></li>\n<li><span class=\"fontstyle0\"><strong>Swelling</strong></span></li>\n<li><strong>Deformity&nbsp;</strong></li>\n</ul>\n<p>These can be due to a soft-tissue injury or dislocation as well.</p>\n<p>Clinically, eliciting abnormal movement or crepitus inflicts more pain. Hence it is <strong>no longer recommended.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Match the following type of fractures with their associated mechanism of force.",
    "choices": [
      {
        "id": 1,
        "text": "1-a, 2-d, 3-c, 4-b"
      },
      {
        "id": 2,
        "text": "1-c, 2-a, 3-d, 4-b"
      },
      {
        "id": 3,
        "text": "1-b, 2-c, 3-a, 4-d"
      },
      {
        "id": 4,
        "text": "1-b, 2-a, 3-d, 4-c"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Based on the continuity of the periosteum, fractures can be complete or incomplete.&nbsp;</p>\n<p>In <strong>complete</strong> fractures, the <strong>bone is split into two</strong> or more fragments and continuity of periosteum is disrupted. It can be:</p>\n<ul>\n<li><strong>Impacted </strong>fracture - The fracture fragments are <strong>jammed together</strong> and the fracture line is not visible</li>\n<li class=\"p1\"><strong>Comminuted </strong>fracture - There is a fracture of&nbsp;<strong>more than two fragments</strong></li>\n<li class=\"p1\"><strong>Segmental</strong> fracture - A separated fragment is seen in the middle</li>\n<li class=\"p1\"><strong>Avulsion </strong>fracture - Breaking of a piece of <strong>bone attached to a strong muscle.</strong>&nbsp;e.g. olecranon and patella fracture</li>\n</ul>\n<p>In <strong>incomplete fractures</strong>, the bone is <strong>incompletely split</strong>&nbsp;and the <strong>periosteum remains in continuity</strong>. They include:</p>\n<ul>\n<li class=\"p1\"><strong>Greenstick fractures</strong>: The <strong>outer cortex breaks and the inner cortex bends</strong> causing the bone to buckle like the snapping of a green twig. It is seen in the <strong>pediatric population</strong>.&nbsp;</li>\n<li class=\"p1\"><strong>Compression fractures</strong>: Cancellous bone <strong>crumple</strong> due to force. This is typically seen in <strong>vertebral bodies</strong>, calcaneum, and the tibial plateau.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/778c796e145a4d7f9e1b285f2826e496x1280x4043.JPEG"
    ]
  },
  {
    "text": "An elderly woman was brought to the OPD after she slipped and fell from her chair. She is a known case of breast cancer with distant metastasis. The X-ray of the patient is given below. Which of the following statements is false regarding this type of fracture?",
    "choices": [
      {
        "id": 1,
        "text": "It occurs in abnormal bones"
      },
      {
        "id": 2,
        "text": "Mirels\u2019 score is used to assess the risk of fracture"
      },
      {
        "id": 3,
        "text": "FDG-PET or CT is the gold standard in evaluating bony metastasis"
      },
      {
        "id": 4,
        "text": "Pain occurs only after the fracture"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>FDG-PET or CT</strong> is the <strong>gold standard</strong> in evaluating <strong>bony metastases.&nbsp;</strong>The <strong>risk of fracture</strong> in metastatic bone lesions is assessed using&nbsp;<strong>Mirels&rsquo; score</strong>.&nbsp;</p>\n<table style=\"height: 93px;\" width=\"490\">\n<tbody>\n<tr>\n<td style=\"width: 115.5px; text-align: center;\" colspan=\"4\"><strong>Mirel's criteria</strong></td>\n</tr>\n<tr>\n<td style=\"width: 115.5px;\"><strong>Score</strong></td>\n<td style=\"width: 115.5px;\"><strong>1</strong></td>\n<td style=\"width: 115.5px;\"><strong>2</strong></td>\n<td style=\"width: 115.5px;\"><strong>3</strong></td>\n</tr>\n<tr>\n<td style=\"width: 115.5px;\"><strong>Site</strong></td>\n<td style=\"width: 115.5px;\">Upper limb</td>\n<td style=\"width: 115.5px;\">Lower limb</td>\n<td style=\"width: 115.5px;\">Peri-trochanteric</td>\n</tr>\n<tr>\n<td style=\"width: 115.5px;\"><strong>Pain</strong></td>\n<td style=\"width: 115.5px;\">Mild</td>\n<td style=\"width: 115.5px;\">Moderate</td>\n<td style=\"width: 115.5px;\">Functional</td>\n</tr>\n<tr>\n<td style=\"width: 115.5px;\"><strong>Lesion</strong></td>\n<td style=\"width: 115.5px;\">Blastic</td>\n<td style=\"width: 115.5px;\">Mixed</td>\n<td style=\"width: 115.5px;\">Lytic</td>\n</tr>\n<tr>\n<td style=\"width: 115.5px;\"><strong>Size</strong></td>\n<td style=\"width: 115.5px;\">&lt;1/3</td>\n<td style=\"width: 115.5px;\">1/3 to 2/3</td>\n<td style=\"width: 115.5px;\">&gt;2/3</td>\n</tr>\n</tbody>\n</table>\n<p><br />A <strong>Mirels's score &gt; 8 </strong>warrants a <strong>prophylactic fixation. Management</strong> of pathological fracture is <strong>based on the causative lesion</strong> and survival of the patient.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a3fbdaeadcb74c65b4cbb2a7a767cf09.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9656f04286e446bfba248c2931c5701cx1280x1400.JPEG"
    ]
  },
  {
    "text": "All of the following conditions can cause a pathological fracture, except:",
    "choices": [
      {
        "id": 1,
        "text": "Gaucher\u2019s disease"
      },
      {
        "id": 2,
        "text": "Osteogenesis imperfecta"
      },
      {
        "id": 3,
        "text": "Hyperparathyroidism"
      },
      {
        "id": 4,
        "text": "Fabry\u2019s disease"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Fabry's disease does <strong>not</strong> cause pathological fractures. It presents with angiokeratomas and <strong>acroparasthesias</strong>.&nbsp;</p>\n<p class=\"p1\"><strong>Pathological fractures </strong>are fractures that occur in a<strong> weakened bone</strong> that has structurally changed due to some condition. They occur either spontaneously or due to <strong>minor trauma</strong>.</p>\n<p class=\"p1\">In <strong>Gaucher's disease</strong>, there is a deficiency of&nbsp;<strong>glucocerebrosidase. </strong>This leads to&nbsp;an accumulation of <strong>lipid-laden macrophages</strong> in the&nbsp;bone tissue, weakening the bone and causing fractures.</p>\n<p><strong>Osteogenesis imperfecta</strong> is an&nbsp;<strong>autosomal dominant disorder that&nbsp;</strong>occurs most commonly due to mutation in the&nbsp;<strong>COL1A&nbsp;</strong>and&nbsp;<strong>COL2A</strong>&nbsp;genes. This results in the <strong>abnormal formation of type 1 collagen</strong>. Since type 1 collagen is mainly present in the bone, the patient presents with&nbsp;<strong>repeated fractures</strong>&nbsp;with no or minimal trauma.</p>\n<p><strong>Hyperparathyroidism</strong> can cause severe <strong>bone resorption</strong> leading to bone pains and&nbsp;<strong>pathological fracture</strong>.</p>\n<p class=\"p1\">Overall,<strong> osteoporosis</strong> is the <strong>most common reason</strong> for pathological fractures. Below the age of 20, the common causes of pathological fracture are benign bone tumors and cysts.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You are working as a medical officer in the Indian army. An army recruit presents to you with complaints of pain in the right foot. He joined his training 6 months back. His X-ray is given below. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Pathological fracture"
      },
      {
        "id": 2,
        "text": "March fracture"
      },
      {
        "id": 3,
        "text": "Runner's fracture"
      },
      {
        "id": 4,
        "text": "Green stick fracture"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario and the X-ray showing a <strong>fracture</strong> of the <strong>2<sup>nd</sup> metatarsal </strong>are suggestive of&nbsp;a&nbsp;<strong>March fracture</strong>. It is a type of <strong>stress&nbsp;fracture</strong>.</p>\n<p><strong>Stress</strong>&nbsp;<strong>fractures</strong> (or <strong>fatigue&nbsp;fractures</strong>)&nbsp;<span class=\"fontstyle0\">occur in a&nbsp;<strong>normal bone</strong> that is subjected to <strong>chronic</strong>&nbsp;<strong>repetitive stress</strong>. This initiates a bone remodeling process. When r</span>esorption occurs&nbsp;faster than replacement, the bone becomes&nbsp;liable to fracture. Such fractures are typically seen in athletes, dancers, or <strong>military personnel</strong> who have a strenuous exercise regimen.</p>\n<p>Common sites for stress fractures include:</p>\n<ul>\n<li>Metatarsals (especially the second, <strong>march fracture</strong>)</li>\n<li>Calcaneum&nbsp;</li>\n<li>Navicular&nbsp;</li>\n<li class=\"p1\">Distal shaft of the fibula (<strong>runner&rsquo;s fracture</strong>)</li>\n<li class=\"p1\">Tibial shaft&nbsp;</li>\n<li class=\"p1\">Patella&nbsp;</li>\n<li class=\"p1\">Femoral neck</li>\n</ul>\n<p><strong>MRI</strong> is the <strong>investigation of choice</strong> to diagnose stress fractures. It can visualize lower-grade stress injuries before X-ray changes appear. A <strong>bone&nbsp;scan </strong>is the&nbsp;investigation of choice&nbsp;when <strong>multiple sites</strong> have <strong>stress fractures</strong>.&nbsp;</p>\n<p>Most stress fractures are managed using an <strong>elastic bandage</strong> and <strong>avoidance of painful activity</strong> until the lesion heals. Stress <strong>fracture of the femoral neck&nbsp;</strong>should be managed by <strong>internal fixation</strong> as a prophylactic measure.</p>\n<p>The image below shows a stress fracture:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/943357ff4d5b489780af60c64706802b.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2e622ff18f51460ea702b2c72bd1dbd7x720x1499.JPEG"
    ]
  },
  {
    "text": "In which of the following conditions does the bone heal by increased callus formation?",
    "choices": [
      {
        "id": 1,
        "text": "Necrosis of bone ends"
      },
      {
        "id": 2,
        "text": "Rigid fracture fixation"
      },
      {
        "id": 3,
        "text": "Compression plating"
      },
      {
        "id": 4,
        "text": "Flexible fracture fixation"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><br />The image below shows callus formation:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/75fd1f9c84144ad28b035a77dc1303f7x850x408.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d93f69d5cf9d45b19afbf0c7c5dfa991x640x1005.JPEG"
    ]
  },
  {
    "text": "A teenager is brought to the casualty after sustaining a wrist injury during a sports meet.  His X-ray is given below. The orthopedic surgeon tries to reduce the fracture fragments by using traction on soft tissues around the bones. What is this technique known as?",
    "choices": [
      {
        "id": 1,
        "text": "Callotaxis"
      },
      {
        "id": 2,
        "text": "Ligamentotaxis"
      },
      {
        "id": 3,
        "text": "Distraction osteogenesis"
      },
      {
        "id": 4,
        "text": "Arthrodesis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The technique which uses <strong>traction on the soft tissue</strong>&nbsp;around the bones to <strong>reduce the fracture fragments</strong> is known as <strong>ligamentotaxis</strong>. The given X-ray shows a fracture of the radial styloid process (<strong>Chauffeur's fracture</strong> or <strong>Hutchinson fracture</strong>).</p>\n<p class=\"p1\"><strong>Reduction of the fracture</strong>&nbsp;is done to ensure normal alignment and adequate&nbsp;apposition of the bone fragments. There are two methods of reduction:</p>\n<ul>\n<li class=\"p1\"><strong>Closed reduction</strong>: The fracture is reduced under appropriate anesthesia and muscle relaxation.&nbsp;Closed reduction of fracture relies on <strong>indirect fragment alignment</strong> utilizing the <strong>pull of the soft tissue envelope</strong>&nbsp;(ligaments and capsules), which is known as&nbsp;<strong>ligamentotaxis</strong>.</li>\n<li class=\"p1\"><strong>Open reduction</strong>: Operative reduction of the fracture under direct vision.&nbsp;</li>\n</ul>\n<p>Option A and C: <strong>Callotaxis</strong> is callus distraction or <strong>distraction osteogenesis</strong>. It is used for <strong>limb lengthening</strong> or filling of large segmental defects in the bone.</p>\n<p>Option D: <strong>Arthrodesis</strong> (artificial ankylosis or syndesis) is the <strong>artificial induction of joint ossification</strong> between two bones by surgery.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d1a7112c2eb64e7b8a998a2c591cb93b.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Hanging cast is used to treat which of the following?",
    "choices": [
      {
        "id": 1,
        "text": "Olecranon fracture"
      },
      {
        "id": 2,
        "text": "Malgaigne's fracture"
      },
      {
        "id": 3,
        "text": "Humerus shaft fracture"
      },
      {
        "id": 4,
        "text": "Colle's fracture"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p class=\"p1\">After the fracture is reduced, it is important to <strong>hold the reduction</strong> with some restriction of movements to&nbsp;promote soft-tissue healing and to allow free movement of the unaffected parts.&nbsp;The methods of holding reduction include:</p>\n<ul>\n<li class=\"p1\">Continuous traction (traction by gravity, skin traction, or skeletal traction)</li>\n<li class=\"p1\">Cast splintage</li>\n<li class=\"p1\">Functional bracing</li>\n<li class=\"p1\">Internal fixation</li>\n<li class=\"p1\">External fixation</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9be1bb16d100429bbceaeb9496bc96c4x1280x1723.JPEG"
    ]
  },
  {
    "text": "A cast was applied to a patient with a wrist injury as shown below. What is this cast known as?",
    "choices": [
      {
        "id": 1,
        "text": "Colles cast"
      },
      {
        "id": 2,
        "text": "Scaphoid cast"
      },
      {
        "id": 3,
        "text": "Bachelor cast"
      },
      {
        "id": 4,
        "text": "Turn-buckle cast"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The cast applied to a patient in the <strong>glass holding position</strong> is known as the <strong>scaphoid cast</strong>. It is used to treat <strong>scaphoid fractures</strong>.</p>\n<p>To apply a scaphoid cast, the <strong>wrist </strong>is held in<strong> slight dorsiflexion</strong> and the <strong>thumb </strong>is in<strong> abduction</strong> and <strong>slight flexion</strong> as if the glass is being held between the index finger and thumb. It extends from just below the elbow to just proximal to the metacarpal necks of the digits. On the thumb, the cast extends just proximal to the interphalangeal joint.</p>\n<p>Scaphoid fracture presents with pain and swelling over the radial aspect of the wrist. A <strong>fall</strong> on an <strong>outstretched</strong> hand could result in such a fracture. The&nbsp;fracture can be confirmed (when an x-ray does not show a fracture) if there is <strong>pain</strong>&nbsp;elicited in the <strong>anatomical snuff box</strong> on the radial border of the wrist.</p>\n<p>An oblique x-ray of the wrist should be able to show a scaphoid fracture.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c11136fd4f724d5c9263f675bf642695.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements are true about open fractures?",
    "choices": [
      {
        "id": 1,
        "text": "1 and 2"
      },
      {
        "id": 2,
        "text": "1 and 4"
      },
      {
        "id": 3,
        "text": "2 and 4"
      },
      {
        "id": 4,
        "text": "2 and 3"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Open fractures</strong> are usually associated with <strong>multiple other injuries</strong> and <strong>compartment syndrome </strong>can occur as a complication of open fractures.</p>\n<p>Open fractures are\u00a0characterized by a break in the overlying skin and soft tissues. Hence, the fracture fragment is exposed to the external environment. It is usually <strong>associated</strong> with <strong>multiple other injuries.</strong></p>\n<p>The most common sites involved in open fractures include\u00a0</p>\n<ul>\n<li><strong>Phalanges </strong>(Fingers and toes)</li>\n<li><strong>Tibial diaphysis</strong></li>\n<li>Distal radius\u00a0</li>\n<li>Ankle</li>\n</ul>\n<p>Open fractures are more prone to develop an <strong>infection</strong>, as it's exposed to the external environment. The presence of an open fracture does not prevent the development of <strong>compartment syndrome</strong>.</p>\n<p>Major components of management of all open fractures are:</p>\n<ul>\n<li><strong>Antibiotic</strong> prophylaxis - It should be given <strong>as early as possible<br /></strong></li>\n<li><strong>Early debridement</strong> of the wound and fracture - This includes the following steps:\n<ul>\n<li><strong>Excision</strong> of the wound margins</li>\n<li><strong>Extension</strong> of the wound if required</li>\n<li>Delivery of the fracture outside the wound for proper examination</li>\n<li>Removal of the devitalized tissue</li>\n<li><strong>Cleansing of the wound</strong> to remove all the foreign materials</li>\n<li>Nerves and tendons are usually left alone, but if the wound is clean, a repair can be considered</li>\n</ul>\n</li>\n<li><strong>Wound cover</strong>:\n<ul>\n<li>In <strong>Gustilo Type I and II fractures</strong> wound cover can be done <strong>at the time of debridement </strong>(Early wound cover)</li>\n<li><strong>Delayed wound cover</strong> is usually practiced in <strong>Type III</strong> fractures</li>\n</ul>\n</li>\n<li><strong>Fracture stabilization</strong> - The method of stabilization depends on the degree of contamination, amount of soft tissue damage, and time from the injury to operation.\n<ul>\n<li><strong>External fixation</strong> is used as a <strong>temporary</strong> measure if there is a delay in wound cover</li>\n<li>If definitive wound cover can be achieved at the time of debridement and there is no significant contamination, then an open fracture can be managed as same as a closed injury\u00a0</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 40-year-old man presents with a fracture of the right tibia following an RTA. On examination, the wound is highly contaminated and appears as shown below. His distal pulses are felt well. According to the Gustilo-Anderson classification, this injury would be classified as type:",
    "choices": [
      {
        "id": 1,
        "text": "II"
      },
      {
        "id": 2,
        "text": "IIIA"
      },
      {
        "id": 3,
        "text": "IIIB"
      },
      {
        "id": 4,
        "text": "IIIC"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>This open fracture will be classified as <strong>Type IIIB </strong>on<strong> Gustilo-Anderson's classification</strong> due to the extensive wound (&gt;10 cm), high contamination, very severe loss of soft tissue cover, and <strong>intact vascularity</strong>.</p>\n<p>A fracture where the skin and soft tissues are breached is known as an <strong>open fracture</strong> (or a&nbsp;compound fracture). Gustilo and Anderson's classification is the most commonly followed classification for open fractures.</p>\n<p>Open fractures with an <strong>arterial injury</strong> that requires repair will be classified as <strong>IIIC</strong>, irrespective of the size of the soft-tissue wound.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/0e080e55b99f4978b31bf8f84cde930c.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "You are the intern on duty and you receive patients who have been in a road traffic accident. For which of the following patients will you urgently call the orthopaedic resident on call?",
    "choices": [
      {
        "id": 1,
        "text": "Patient with recurrent shoulder dislocation"
      },
      {
        "id": 2,
        "text": "Patient with a fractured arm with capillary refill time of less than 3 seconds in his fingers"
      },
      {
        "id": 3,
        "text": "Patient with a fractures arm with a 10 cm long incision over the arm"
      },
      {
        "id": 4,
        "text": "Patient with a fractured arm with capillary refill time of 5 seconds in his fingers"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Capillary refill time</strong>\u00a0of\u00a0<strong>more than 3 seconds\u00a0</strong>indicates <strong>inadequate limb perfusion</strong>. It is a<strong> surgical emergency </strong>and\u00a0could be due to either vascular injury by direct trauma or compartment syndrome.\u00a0Hence an orthopedic intervention will be needed urgently.\u00a0</p>\n<p>All other patients will also need an orthopedic intervention, however, the <strong>blood flow</strong> should be <strong>restored</strong> at the <strong>earliest</strong>.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An industrial worker was rushed to casualty after he accidentally got his leg stuck in a machine. On examination, he was found to have an open fracture as shown below. He was urgently taken up for wound debridement and was considered for primary closure. It can be performed in all of the following conditions, except:",
    "choices": [
      {
        "id": 1,
        "text": "If injury to debridement interval < 12 hours"
      },
      {
        "id": 2,
        "text": "Capillary refilling time of 2 seconds"
      },
      {
        "id": 3,
        "text": "Impaired nerve supply"
      },
      {
        "id": 4,
        "text": "Wound margin can be closed without tension"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>When there is&nbsp;impaired nerve supply,&nbsp;primary closure of open fracture is <strong>not</strong> recommended.</p>\n<p><strong>Primary closure</strong> of open fracture is the <strong>closure of the wound</strong> by&nbsp;direct skin suturing <strong>during the index procedure</strong> (first debridement). In general,<strong> primary closure</strong> of wounds of <strong>Gustilo type I and II fractures</strong> can be done at the time of debridement.</p>\n<p>In&nbsp;<strong>Gustilo type IIIA</strong> fractures, <strong>some surgeons delay</strong> <strong>closure</strong> until a second-look procedure is performed. In most cases of&nbsp;<strong>Gustilo type IIIB and IIIC</strong> injuries, a&nbsp;<strong>delayed closure</strong>&nbsp;is practiced.&nbsp;</p>\n<p>Important criteria for primary closure:</p>\n<ul>\n<li>The patient&rsquo;s general condition should be stable</li>\n<li>Injury to debridement interval is <strong>&lt; 12 hours</strong></li>\n<li>All necrotic material must have been removed</li>\n<li>Stable fixation can be achieved either by internal or external fixation</li>\n<li><strong>Normal circulation</strong></li>\n<li><strong>Intact nerve supply</strong></li>\n<li>The wound skin margins can be closed without tension</li>\n<li>There should be <strong>no multisystem injuries</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/79063e7f18434edd825ebde20d6bf2bf.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "In which of the following fractures is surgical management necessary for optimum functional results?",
    "choices": [
      {
        "id": 1,
        "text": "Clavicle fracture"
      },
      {
        "id": 2,
        "text": "Distal radius fracture"
      },
      {
        "id": 3,
        "text": "Fibula fracture"
      },
      {
        "id": 4,
        "text": "Monteggia fracture"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Surgical management is necessary</strong> for optimum functional results in&nbsp;<strong>Monteggia fracture </strong>(fracture of the ulnar shaft with concomitant dislocation of the radial head).</p>\n<p>While the other listed injuries may necessitate surgery in certain situations, conservative treatment for&nbsp;Monteggia fracture yields poor results.&nbsp;</p>\n<p>Fractures in which <strong>surgical treatment</strong> will be <strong>needed&nbsp;</strong>to obtain an <strong>optimal result</strong> include:</p>\n<ul>\n<li>Displaced intraarticular fractures</li>\n<li>Unstable fractures after failed conservative management</li>\n<li>Major avulsion fractures&nbsp;after failed conservative management</li>\n<li>Displaced pathologic fractures</li>\n<li>Fractures in which conservative treatment is known to provide poor functional results, such as <strong>femoral neck fractures</strong>, <strong>Galeazzi fracture-dislocations</strong>, and <strong>Monteggia fracture-dislocations</strong></li>\n<li>Displaced physeal injuries with high-risk for growth arrest (<strong>Salter-Harris types III and IV</strong>)</li>\n<li>Nonunions, especially malreduced ones, after failed conservative or operative management</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "All of the following are common indications for the procedure shown below, except:",
    "choices": [
      {
        "id": 1,
        "text": "Burns over the fracture site"
      },
      {
        "id": 2,
        "text": "Type 1 open fracture"
      },
      {
        "id": 3,
        "text": "Type 3 open fracture"
      },
      {
        "id": 4,
        "text": "Limb lengthening"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The image shows <strong>external fixation </strong>using an external fixator. Type 1 open fracture is <strong>not</strong> a common indication for external fixation.</p>\n<p class=\"p1\">External fixation is holding the fracture using\u00a0transfixing screws that pass through the bone above and below the fracture and are connected to each other by <strong>rigid bars</strong> or an <strong>external frame</strong>. This provides\u00a0rigid fixation of the bones in cases where other methods of immobilization are inappropriate.\u00a0</p>\n<p class=\"p1\"><strong>External fixation</strong> is <strong>especially</strong> applicable for the\u00a0<strong>tibia</strong> and <strong>pelvis</strong>. It\u00a0is also used for fractures of the femur, humerus, and distal radius.</p>\n<p>Common indications for external fixation:</p>\n<ul>\n<li>Severe <strong>type II and III open fractures</strong></li>\n<li>Fractures associated with <strong>severe</strong> <strong>burns </strong>(as burn tissue predisposes to infection and can result in osteomyelitis)</li>\n<li>Fractures requiring grafts</li>\n<li>Fractures requiring distraction</li>\n<li><strong>Limb</strong> <strong>lengthening\u00a0</strong>(Ilizarov Procedure)</li>\n<li>Arthrodesis</li>\n<li>Infected fractures or nonunions</li>\n<li>Correction of malunions</li>\n</ul>\n<p>The image given below shows an external fixator applied to the right tibia:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/f576a35ef16540eca7b17b106209db3d.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6c5890f60842466c8a58e0e1df1d6f38x802x1199.JPEG"
    ]
  },
  {
    "text": "A 25-year-old patient underwent external fixation after sustaining a femur fracture. On follow-up, he was noted to have developed a pin-tract infection. He did not respond to antibiotics. On performing radiograph, what kind of sequestrum are you most likely to see in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Button-hole sequestrum"
      },
      {
        "id": 2,
        "text": "Black"
      },
      {
        "id": 3,
        "text": "Tubular"
      },
      {
        "id": 4,
        "text": "Ring"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p class=\"p1\">The given clinical scenario with a history of <strong>external fixation</strong> is suggestive of a<strong> pin site infection.</strong>&nbsp;It appears as a <strong>ring sequestrum</strong> in an X-ray.</p>\n<p class=\"p1\"><strong>Sequestrum</strong> is a fragment of <strong>dead&nbsp;bone</strong> lying within a cavity formed by necrosis. Various types of sequestra and their causes are given in the following table:</p>\n<table style=\"width: 482px;\">\n<tbody>\n<tr style=\"height: 36px;\">\n<td style=\"width: 233px; height: 36px;\"><strong>Type of Sequestrum</strong></td>\n<td style=\"width: 281px; height: 36px;\"><strong>Cause</strong></td>\n</tr>\n<tr style=\"height: 36px;\">\n<td style=\"width: 233px; height: 36px;\"><strong>Tubular</strong> or diaphyseal sequestrum</td>\n<td style=\"width: 281px; height: 36px;\">Acute <strong>pyogenic</strong> osteomyelitis</td>\n</tr>\n<tr style=\"height: 36px;\">\n<td style=\"width: 233px; height: 36px;\"><strong>Ring</strong> sequestrum</td>\n<td style=\"width: 281px; height: 36px;\">Amputation stump and at Steinmann <strong>pins</strong></td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 233px; height: 18px;\">Ivory sequestrum</td>\n<td style=\"width: 281px; height: 18px;\">Syphilis</td>\n</tr>\n<tr style=\"height: 36px;\">\n<td style=\"width: 233px; height: 36px;\">Fine sandy sequestrum</td>\n<td style=\"width: 281px; height: 36px;\">Viral osteomyelitis</td>\n</tr>\n<tr style=\"height: 44px;\">\n<td style=\"width: 233px; height: 44px;\"><strong>Coarse sandy</strong> sequestrum</td>\n<td style=\"width: 281px; height: 44px;\">Body of vertebra (cavity of <strong>tuberculosis</strong>)</td>\n</tr>\n<tr style=\"height: 26px;\">\n<td style=\"width: 233px; height: 26px;\">Flake or Feathery sequestrum</td>\n<td style=\"width: 281px; height: 26px;\">\n<p>Tuberculosis of rib (cavity of tuberculosis)</p>\n</td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 233px; height: 18px;\">Kissing sequestrum</td>\n<td style=\"width: 281px; height: 18px;\">Peridiscal tuberculosis of vertebra</td>\n</tr>\n<tr style=\"height: 36px;\">\n<td style=\"width: 233px; height: 36px;\">Button-hole sequestrum</td>\n<td style=\"width: 281px; height: 36px;\">Radiation</td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 233px; height: 18px;\"><strong>Black</strong> sequestrum</td>\n<td style=\"width: 281px; height: 18px;\"><strong>Actinomycosis</strong></td>\n</tr>\n</tbody>\n</table>\n<p><br />The image below shows a ring sequestrum formed at the site of a pin used in the diaphysis of the tibia:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/45c6cec75ecc48da84df83499b9f943ax372x566.PNG"
    ]
  },
  {
    "text": "A 20-year-old patient presents to the OPD with complaints of limping. He gives a history of fracture a few months back. On examination, his left leg is shorter than his right leg. He undergoes the following procedure. Identify the incorrect statement regarding this procedure.",
    "choices": [
      {
        "id": 1,
        "text": "Distraction is done at a rate of 1 mm per day."
      },
      {
        "id": 2,
        "text": "It is based on the principle of callotaxis."
      },
      {
        "id": 3,
        "text": "It is contraindicated in the presence of osteomyelitis."
      },
      {
        "id": 4,
        "text": "It is used to perform arthrodesis."
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given image shows&nbsp;<strong>distraction osteogenesis</strong> using the <strong>Ilizarov apparatus</strong>. Osteomyelitis is <strong>not</strong> a contraindication for this procedure.</p>\n<p><strong>Distraction osteogenesis</strong>&nbsp;(distraction histogenesis) is the&nbsp;<strong>mechanical induction of new bone</strong>&nbsp;that occurs between bony surfaces that are <strong>gradually pulled apart</strong>. This is described as <strong>the tension stress effect</strong>.</p>\n<p>The most important application of the tension-stress principle is known as <strong>callus distraction</strong> (or <strong>callotaxis</strong>). A careful <strong>fracture of the bone is performed</strong>, followed by a short wait. The young callus formed is <strong>gradually distracted</strong> using a circular or unilateral external fixator. This is used in limb lengthening or for the filling of large segmental defects in the bone.</p>\n<p>Distraction or compression is carried out at the rate of <strong>1 mm per day</strong>. This is done in four sittings - 0.25 mm, <strong>four times a day</strong>. It is also used in the following scenarios:</p>\n<ul>\n<li>Non-union</li>\n<li>Deformity correction</li>\n<li><strong>Osteomyelitis</strong> - as it offers the possibility of liberal excision of bone</li>\n<li><strong>Arthrodesis</strong> - crushing articular surfaces can stimulate union between opposing bones</li>\n</ul>\n<p>An illustration of distraction osteogenesis using the <strong>Ilizarov apparatus&nbsp;</strong>and the radiograph depicts the procedure is given below:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c4a90fe535da4ed0b31990ecce0dfb7a.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9bccaf344b0540cca0439ea1c43fac7ex1280x2560.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8db40e3ca5594366825953493dbe051cx720x264.PNG"
    ]
  },
  {
    "text": "A patient undergoes bone grafting after losing a bone segment due to an open fracture. Which of the following is the best material that can be used to fill the defect?",
    "choices": [
      {
        "id": 1,
        "text": "Freeze dried allograft"
      },
      {
        "id": 2,
        "text": "rhBMP-7"
      },
      {
        "id": 3,
        "text": "Calcium phosphate"
      },
      {
        "id": 4,
        "text": "Autologous bone graft"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The <strong>autologous bone graft</strong> is the <strong>gold standard</strong>&nbsp;material for filling bone defects.</p>\n<p><strong>Bone grafts</strong> are used to<strong> fill the defects in bones</strong> caused due to a fracture or malignancy. Bone grafts work by various methods:</p>\n<ul>\n<li class=\"p1\"><strong>Osteoinduction</strong> is the <strong>recruitment and differentiation</strong> of pluripotent <strong>mesenchymal stem cells</strong> into bone-forming osteoprogenitor cells</li>\n<li class=\"p1\"><strong>Osteoconduction&nbsp;</strong>is the <strong>creation of the</strong> <strong>scaffold</strong> to support the ingrowth of blood vessels, perivascular tissue, and osteoprogenitor cells</li>\n<li class=\"p1\"><strong>Osteogenesis&nbsp;</strong>is the <strong>process of bone formation</strong> after the terminal differentiation of osteogenic progenitor cells into mature osteoblasts</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A polytrauma patient with femur fracture and massive hemorrhage presents to the emergency department after a road traffic accident. Which of the following is not an immediate treatment consideration in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Administration of IV crystalloids"
      },
      {
        "id": 2,
        "text": "Administration of tranexamic acid"
      },
      {
        "id": 3,
        "text": "Check coagulation with thromboelastography"
      },
      {
        "id": 4,
        "text": "Internal fixation of femur fracture"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The <strong>internal fixation</strong> of a femur fracture is <strong>not an immediate concern</strong> in a patient with <strong>polytrauma</strong> and <strong>hemodynamic instability</strong> secondary to <strong>severe blood loss</strong>. Instead, <strong>splinting</strong> is preferred until the patient has been stabilized.</p>\n<p><strong>Damage Control Orthopaedics (DCO) </strong>in unstable/borderline&nbsp;polytrauma patients involves 3 components:</p>\n<ul>\n<li>Stage 1: Resuscitative procedures for rapid hemorrhage control</li>\n<li>Stage 2: Restoration of normal physiologic parameters</li>\n<li>Stage 3: Definitive surgical management</li>\n</ul>\n<p class=\"p1\">The <strong>first stage</strong> is early temporary <strong>stabilization of unstable fractures</strong> and the <strong>control of the bleeding</strong>. In femur fracture, the most suited approach is temporary stabilization using an&nbsp;<strong>external fixator</strong>.&nbsp;</p>\n<p class=\"p1\">The <strong>second stage</strong>&nbsp;involves <strong>resuscitation and stabilization</strong> of the patients in the ICU.&nbsp;</p>\n<p class=\"p1\">Finally, the <strong>third stage</strong> involves <strong>delayed</strong> <strong>definitive fracture management</strong> after the patient&rsquo;s condition becomes suitable. In femur fracture, the definitive procedure is&nbsp;<strong>intramedullary nailing</strong> which is performed after the patient becomes stable.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '01 Basics Of Fracture And Its Management';
        let hierarchy = ["Marrow", "qBank", "Orthopedics"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>