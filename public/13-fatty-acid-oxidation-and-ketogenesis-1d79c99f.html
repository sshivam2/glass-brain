<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>13 Fatty Acid Oxidation And Ketogenesis - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Biochemistry
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following statements is false?",
    "choices": [
      {
        "id": 1,
        "text": "In beta oxidation, 2 carbon units are released as acetyl CoA per cycle."
      },
      {
        "id": 2,
        "text": "In alpha oxidation, one carbon is lost in the form of CO2 per cycle."
      },
      {
        "id": 3,
        "text": "Alpha oxidation is an energetic process."
      },
      {
        "id": 4,
        "text": "Beta oxidation is the major mechanism that occurs in the mitochondria matrix."
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Alpha oxidation is <strong>not</strong> an energy yielding process.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is true?",
    "choices": [
      {
        "id": 1,
        "text": "Propionyl CoA is produced by the oxidation of odd-chain fatty acids."
      },
      {
        "id": 2,
        "text": "Methylmalonyl CoA mutase is a biotin-dependent enzyme."
      },
      {
        "id": 3,
        "text": "Propionyl CoA is not glucogenic."
      },
      {
        "id": 4,
        "text": "Odd-chain fatty acids do not undergo oxidation."
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>\u00a0</p>\n<p>Note:\u00a0</p>\n<ul>\n<li><strong>Methylmalonyl CoA mutase</strong> is a <strong>vitamin B12-dependent</strong> enzyme.</li>\n<li><strong>Propionyl residue</strong> from an odd-chain fatty acid is the <strong>only part</strong> of a fatty acid that is <strong>glucogenic.</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d7364ea8ae2d46cd956b557bdcc91befx600x647.JPEG"
    ]
  },
  {
    "text": "ATP is hydrolyzed directly to AMP, with the release of PPi during a biochemical reaction catalyzed by which of the following enzymes?",
    "choices": [
      {
        "id": 1,
        "text": "Creatine kinase"
      },
      {
        "id": 2,
        "text": "Adenylate kinase"
      },
      {
        "id": 3,
        "text": "Myokinase"
      },
      {
        "id": 4,
        "text": "Acyl-CoA synthetase"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>ATP can also be hydrolyzed directly to AMP, with the release of PPi by the enzyme\u00a0<strong>Acyl-CoA synthetase.</strong></p>\n<p>This occurs in the <strong>activation of long-chain fatty acids</strong>. This reaction is accompanied by the\u00a0loss of free energy as heat, which ensures that the activation reaction will go to the right. It is further aided by the hydrolytic splitting of PPi, catalyzed by inorganic <strong>pyrophosphatase</strong>, a reaction that itself has a large \u0394G0\u2032 of \u221219.2 kJ/mol.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "For fatty acid oxidation which of the following intermediate is formed during the transport of acyl-CoA using a mitochondrial shuttle?",
    "choices": [
      {
        "id": 1,
        "text": "Acetyl-CoA"
      },
      {
        "id": 2,
        "text": "Acyl-coenzyme A"
      },
      {
        "id": 3,
        "text": "Acyl-carnitine"
      },
      {
        "id": 4,
        "text": "Aceto-acetyl-Coa"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In the fatty acid oxidation process, <strong>acyl-carnitine</strong> is formed as an intermediate during the transport of acyl-CoA using a mitochondrial shuttle.</p>\n<p>Acyl CoA is converted to acyl-carnitine, which is the active form of fatty acid during transport from the cytoplasm to the inside of the mitochondria for oxidation. The enzyme CPT-1 (<strong>carnitine palmitoyl transferase-I</strong>), present on the <strong>outer mitochondrial membrane</strong> catalyzes the reaction.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following enzymes is required for the only energy-requiring step of fatty acid oxidation?",
    "choices": [
      {
        "id": 1,
        "text": "Thiolase"
      },
      {
        "id": 2,
        "text": "Acyl CoA dehydrogenase"
      },
      {
        "id": 3,
        "text": "Thiokinase"
      },
      {
        "id": 4,
        "text": "Beta-hydroxy acyl Co A dehydrogenase"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The only<strong> energy-requiring</strong> step in fatty acid oxidation is catalyzed by the <strong>thiokinase</strong> enzyme.</p>\n<p>In the presence of <strong>ATP</strong> and <strong>coenzyme A</strong>, the enzyme&nbsp;<strong>acyl-CoA synthetase </strong>or&nbsp;<strong>thiokinase</strong> catalyses the conversion of a fatty acid&nbsp;to acyl-CoA, the active form of fatty acid for oxidation.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "How many molecules of acetyl-CoA are produced in \u03b2- oxidation of palmitic acid?",
    "choices": [
      {
        "id": 1,
        "text": "6"
      },
      {
        "id": 2,
        "text": "7"
      },
      {
        "id": 3,
        "text": "8"
      },
      {
        "id": 4,
        "text": "9"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In the \u03b2-oxidation of palmitic acid (C<sub>16</sub>),\u00a0<strong>8 molecules</strong> of acetyl-CoA are produced.</p>\n<p>In the beta-oxidation pathway, two carbons at a time are cleaved from acyl-CoA molecules between alpha(2) and beta(3) carbons, starting at the carboxyl end. The two-carbon units formed are called acetyl-CoA.</p>\n<p>Thus, in palmitic acid\u00a0<strong>(C<sub>16</sub>), 7 cycles\u00a0</strong>of\u00a0\u03b2-oxidation take place, releasing <strong>8 acetyl CoA</strong> molecules. In the first 6 cycles, 6 acetyl CoA molecules are released. In the 7<sup>th</sup> cycle, 2 acetyl CoA molecules are released.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Each cycle of \u03b2-oxidation produces ___________.",
    "choices": [
      {
        "id": 1,
        "text": "1 FADH2, 1 NAD+, and 1 acetyl-CoA"
      },
      {
        "id": 2,
        "text": "1 FADH2, 1 NADH, and 1 acetyl-CoA"
      },
      {
        "id": 3,
        "text": "1 FADH2, 1 NADH, and 2 CO2 molecules"
      },
      {
        "id": 4,
        "text": "1 FAD, 1 NAD+, and 2 CO2 molecules"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>One</strong> cycle of <strong>\u03b2-oxidation</strong> of <strong>fatty acids\u00a0</strong>produces\u00a0<strong>1 FADH<sub>2</sub>, 1 NADH, and 1 acetyl-CoA</strong>.</p>\n<ul>\n<li><strong>FADH<sub>2</sub></strong> is formed in the reaction catalyzed by <strong>acyl CoA dehydrogenase</strong>.</li>\n<li><strong>NADH</strong> is formed in the reaction catalyzed by\u00a0<strong>\u03b2-hydroxy acyl CoA dehydrogenase</strong></li>\n<li>In each cycle of\u00a0\u03b2-oxidation, the terminal two carbons are cleaved as acetyl CoA starting at carboxyl end.</li>\n</ul>\n<p>Thus, the overall reaction of each cycle of\u00a0\u03b2-oxidation can be summarized as follows:</p>\n<p><strong>(C<sub>n</sub>)</strong>acyl CoA + FAD + NAD<sup>+</sup>+ H<sub>2</sub>O + CoA \u2192 <strong>(C<sub>n-2</sub>)</strong>acyl CoA + FADH<sub>2\u00a0</sub>+ NADH + Acetyl CoA +H<sup>+</sup></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which is the rate-limiting enzyme in beta-oxidation of fatty acids?",
    "choices": [
      {
        "id": 1,
        "text": "Acyl CoA dehydrogenase"
      },
      {
        "id": 2,
        "text": "Thiolase"
      },
      {
        "id": 3,
        "text": "Thiokinase"
      },
      {
        "id": 4,
        "text": "Carnitine palmitoyl transferase-1"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Carnitine palmitoyl transferase-1</strong> (CPT-1), is the <strong>rate-limiting enzyme</strong> in the\u00a0beta-oxidation of fatty acids.</p>\n<p>CPT-1 is responsible for transferring the acyl group from CoA to carnitine, forming acylcarnitine which can enter the outer mitochondrial membrane. Thus the acyl group enters the mitochondria from the cytoplasm.</p>\n<p><strong>Malonyl CoA</strong> is an <strong>inhibitor</strong> of <strong>CPT-I</strong>. Thus,</p>\n<ul>\n<li>In the <strong>fed state</strong>, with high insulin: glucagon ratio, <strong>acetyl CoA carboxylase</strong> is <strong>active</strong> and <strong>malonyl CoA </strong>is<strong> produced</strong>, which inhibits \u03b2-oxidation.</li>\n<li>In the <strong>fasting state</strong>, with low insulin: glucagon ratio, <strong>acetyl CoA carboxylase</strong> is <strong>inactive</strong> and <strong>malonyl CoA </strong>is<strong> not produced</strong>. Hence,\u00a0\u03b2-oxidation takes place.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the net ATP yield in the beta-oxidation of a straight-chain fatty acid having 2N carbon atoms?",
    "choices": [
      {
        "id": 1,
        "text": "7N-6"
      },
      {
        "id": 2,
        "text": "14N-6"
      },
      {
        "id": 3,
        "text": "7N-3"
      },
      {
        "id": 4,
        "text": "14N-3"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p style=\"text-align: left;\">A <strong>straight-chain fatty acid </strong>comprising of <strong>2N</strong> <strong>carbon atoms</strong> will undergo [(2N \u00f7 2) -1] = <strong>(N-1) cycles of beta-oxidation</strong> and produce<strong> N number of acetyl CoA.</strong></p>\n<p style=\"text-align: left;\">Each <strong>acetyl CoA</strong> will undergo TCA cycle, producing <strong>10 ATP</strong>. On the other hand, <strong>each cycle</strong> of beta-oxidation also produces 1 FADH2 and 1 NADH generating 1.5 ATP and 2.5 ATP respectively. Therefore (N-1) cycles of beta-oxidation will produce (N-1) FADH2 and (N-1) NADH.</p>\n<p style=\"text-align: left;\">The energetics of\u00a0\u03b2-oxidation of a straight-chain fatty acid comprising of 2N carbon atoms can be summarized as follows:</p>\n<table style=\"height: 200px;\" width=\"575\">\n<tbody>\n<tr style=\"text-align: left;\">\n<td style=\"width: 136.75px;\">Intermediate produced</td>\n<td style=\"width: 136.75px;\">ATP yield per molecule</td>\n<td style=\"width: 136.75px;\">Total number produced</td>\n<td style=\"width: 136.75px;\">Total ATP</td>\n</tr>\n<tr style=\"text-align: left;\">\n<td style=\"width: 136.75px;\">FADH2</td>\n<td style=\"width: 136.75px;\">1.5</td>\n<td style=\"width: 136.75px;\">N-1</td>\n<td style=\"width: 136.75px;\">1.5(N-1)</td>\n</tr>\n<tr style=\"text-align: left;\">\n<td style=\"width: 136.75px;\">NADH</td>\n<td style=\"width: 136.75px;\">2.5</td>\n<td style=\"width: 136.75px;\">N-1</td>\n<td style=\"width: 136.75px;\">2.5(N-1)</td>\n</tr>\n<tr style=\"text-align: left;\">\n<td style=\"width: 136.75px;\">Acetyl CoA</td>\n<td style=\"width: 136.75px;\">10</td>\n<td style=\"width: 136.75px;\">N</td>\n<td style=\"width: 136.75px;\">10N</td>\n</tr>\n<tr>\n<td style=\"width: 136.75px; text-align: left;\">Total ATP</td>\n<td style=\"width: 136.75px; text-align: center;\" colspan=\"3\"><span style=\"font-size: 10pt;\">1.5(N-1) +2.5(N-1) +10N =(14N-4) \u00a0\u00a0</span></td>\n</tr>\n<tr>\n<td style=\"width: 136.75px; text-align: left;\">ATP used in activation</td>\n<td style=\"width: 136.75px; text-align: center;\" colspan=\"3\"><span style=\"font-size: 10pt;\">- 2</span></td>\n</tr>\n<tr>\n<td style=\"width: 136.75px; text-align: left;\">Net ATP yield\u00a0</td>\n<td style=\"width: 136.75px; text-align: center;\" colspan=\"3\"><span style=\"font-size: 10pt;\">(14N-4) -2 = 14N-6\u00a0</span></td>\n</tr>\n</tbody>\n</table>\n<p style=\"text-align: left;\">So, the <strong>net ATP yield</strong> after beta-oxidation of a straight-chain fatty acid having 2N carbon atoms will be (14N-4) - 2 = <strong>(14N- 6)</strong>We must keep in mind that during the<strong> initial activation</strong> of <strong>fatty acids</strong> (conversion of fatty acid to fatty acyl CoA), <strong>2 ATP is utilized</strong>.</p>\n<p style=\"text-align: left;\">This formula can be used to calculate net ATP yield from a straight-chain fatty acid having an<strong> even number</strong> of <strong>carbon atoms. </strong>For example,</p>\n<p style=\"text-align: left;\">Net ATP yield from beta-oxidation of palmitic acid (16 carbon) will be 106.</p>\n<p style=\"text-align: left;\">Calculation: Here, 2N = 16 i.e, N = 8 . Therefore net ATP yield = (14x8 - 6) = 112-6 = 106</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 28-year-old woman at 33 weeks of gestation presented with nausea and right upper quadrant abdominal pain. Her LFTs pointed towards a diagnosis of acute fatty liver of pregnancy. Which of the following enzyme deficiencies is most likely involved in the pathogenesis of this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Fetal medium-chain acyl CoA dehydrogenase"
      },
      {
        "id": 2,
        "text": "Maternal long-chain 3-hydroxy acyl CoA dehydrogenase"
      },
      {
        "id": 3,
        "text": "Fetal long-chain 3-hydroxy acyl CoA dehydrogenase"
      },
      {
        "id": 4,
        "text": "Maternal medium-chain acyl CoA dehydrogenase"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>A deficiency of <strong>fetal long-chain 3-hydroxy acyl CoA dehydrogenase</strong> (LCHAD) is involved in the pathogenesis of <strong>acute fatty liver of pregnancy.</strong></p>\n<p>Free fatty acids normally increase in pregnancy, particularly during late gestation to fuel fetoplacental growth and development. In fetuses<strong> homozygous </strong>for <strong>LCHAD deficiency</strong>, the fetoplacental unit is unable to undertake fatty acid metabolism adequately. This contributes to the accumulation of<strong> long-chain metabolites</strong> in maternal<strong> blood</strong> and <strong>hepatocytes</strong>, resulting in toxic effects.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An 8-month-old infant was brought to the pediatric emergency department with recurrent seizures and hypoglycemia. His family history revealed the sudden death of his sibling at the age of 3 months. Labs showed increased dicarboxylic acid in blood and urine. Which of the following is the pathophysiology behind this clinical manifestation?",
    "choices": [
      {
        "id": 1,
        "text": "Impaired alpha oxidation of branched-chain fatty acids"
      },
      {
        "id": 2,
        "text": "Impaired beta-oxidation of medium-chain fatty acids"
      },
      {
        "id": 3,
        "text": "Impaired omega oxidation of medium-chain fatty acids"
      },
      {
        "id": 4,
        "text": "Impaired peroxisomal oxidation of very long-chain fatty acids"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p style=\"text-align: left;\">The given clinical vignette is suggestive of<strong> medium-chain acyl-CoA dehydrogenase deficiency</strong> in which, there is<strong> impaired beta-oxidation</strong> of <strong>medium-chain fatty acids.\u00a0</strong>This leads to the accumulation of <strong>dicarboxylic acids</strong>\u00a0leading to <strong>dicarboxylic aciduria</strong>. It\u00a0is characterized by:</p>\n<ul>\n<li style=\"text-align: left;\">Excretion of C<sub>6</sub>-C<sub>10</sub> \u03c9-dicarboxylic acids (medium-chain) in the urine.</li>\n<li>Nonketotic <strong>hypoglycemia</strong>: due\u00a0to the lack of ATP and acetyl CoA from\u00a0\u03b2-oxidation (which is an activator of pyruvate carboxylase) to support gluconeogenesis.</li>\n</ul>\n<p style=\"text-align: left;\">Defects in\u00a0medium-chain acyl-CoA dehydrogenase have been identified as a cause of<strong>\u00a0</strong>sudden infant death syndrome (SIDS).</p>\n<p style=\"text-align: left;\">Omega-oxidation is an alternative way of fatty acid oxidation in the body when the beta-oxidation enzymes are either saturated or defective. Omega oxidation converts excess fatty acids to dicarboxylic acids that are soluble and hence can be excreted out via urine.</p>\n<p style=\"text-align: left;\">Other options:</p>\n<p style=\"text-align: left;\">Option A: <strong>Impaired Alpha oxidation</strong> leads to <strong>Refsum\u2019s disease. </strong>The manifestations of classic adult Refsum's disease include retinitis pigmentosa, peripheral neuropathy, ataxia, ichthyosis, anosmia, deafness and cardiac arrhythmias.</p>\n<p style=\"text-align: left;\">Option C: Medium-chain acyl CoA dehydrogenase deficiency will lead to <strong>increased</strong> (not impaired) utilization of the omega oxidation pathway, resulting in the overproduction of dicarboxylic acids.</p>\n<p style=\"text-align: left;\">Option D:<strong> Impaired peroxisomal oxidation</strong> of very long-chain<strong>\u00a0fatty acids</strong> (VLCFA) causes <strong>Zellweger (cerebrohepatorenal) syndrome.</strong> It is a rare inherited disorder characterized by the absence of peroxisomal enzymes in all tissues leading to the accumulation of C26\u2014C38 polyenoic acids in brain tissue. The clinical manifestation of Zellweger syndrome includes:</p>\n<ul>\n<li style=\"font-weight: 400; text-align: left;\" aria-level=\"1\">Facial deformities resembling Down syndrome (Mongoloid facies, Hypertelorism, Frontal bossing, Upslanting palpebral fissure)</li>\n<li style=\"font-weight: 400; text-align: left;\" aria-level=\"1\">Brush field spots</li>\n<li style=\"font-weight: 400; text-align: left;\" aria-level=\"1\">Hypotonia and hyporeflexia</li>\n<li style=\"font-weight: 400; text-align: left;\" aria-level=\"1\">Seizures</li>\n<li style=\"font-weight: 400; text-align: left;\" aria-level=\"1\">Neurodevelopmental delay</li>\n<li style=\"font-weight: 400; text-align: left;\" aria-level=\"1\">Liver enlargement</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An infant is being assessed for hypotonia, seizures, and neurodevelopmental delay. Clinical examination reveals facial deformities, hyporeflexia, and hepatomegaly. A congenital disorder affecting extramitochondrial lipid metabolism is suspected. Which of the following processes is impaired in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Acetyl CoA formation"
      },
      {
        "id": 2,
        "text": "H2O2 mediated breakdown of fatty acids"
      },
      {
        "id": 3,
        "text": "Transport of fatty acyl CoA using shuttle mechanism"
      },
      {
        "id": 4,
        "text": "Peroxisomal alpha oxidation of fatty acids"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The clinical vignette is suggestive of <strong>Zellweger (cerebrohepatorenal) syndrome</strong> in\u00a0which <strong>H2O2-mediated</strong> peroxisomal beta-oxidation of <strong>very-long-chain fatty acids</strong> (VLCFA) is impaired.</p>\n<p>Beta-oxidation in peroxisome is differentiated from that occurring in mitochondria by the formation of <strong>H2O2.</strong></p>\n<p><strong>Beta-oxidation</strong>\u00a0of fatty acid<strong>\u00a0</strong>in<strong> peroxisomes </strong>is<strong> not coupled </strong>to\u00a0<strong>ATP\u00a0synthesis.</strong>\u00a0The high-potential electrons are transferred to O<sub>2</sub>, which <strong>yields H<sub>2</sub>O<sub>2\u00a0</sub></strong>(instead of FADH2).\u00a0The enzyme\u00a0<strong>catalase</strong>, found exclusively in peroxisomes, converts the\u00a0hydrogen peroxide to end products water\u00a0and\u00a0oxygen.\u00a0</p>\n<p>Zellweger syndrome is a rare inherited disorder characterized by the <strong>absence</strong> of <strong>peroxisomal enzymes</strong> in all tissues leading to the accumulation of <strong>C26\u2014C38 polyenoic acids</strong> in brain tissue. The clinical manifestation of Zellweger syndrome includes:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Facial deformities resembling Down syndrome (Mongoloid facies, Hypertelorism, Frontal bossing, Upslanting palpebral fissure)</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Brush field spots</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Hypotonia and hyporeflexia</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Seizures</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Neurodevelopmental delay</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Liver enlargement</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 3-year-old child is being evaluated for anosmia, deafness, and unstable gait. Further investigation reveals retinitis pigmentosa on fundoscopy and cardiac rhythm abnormalities on ECG. A rare congenital disease affecting lipid metabolism is being suspected. Deficiency of which of the following enzymes is expected to be found in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Phytanoyl CoA \u03b1-hydroxylase"
      },
      {
        "id": 2,
        "text": "Acyl CoA synthetase"
      },
      {
        "id": 3,
        "text": "Phytanic acid synthetase"
      },
      {
        "id": 4,
        "text": "None"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p style=\"text-align: left;\">The given clinical vignette is suggestive of <strong>Refsum&rsquo;s disease</strong>, characterized by <strong>impaired alpha oxidation</strong> due to the <strong>deficiency of phytanoyl CoA &alpha;-hydroxylase</strong> (also known as phytanic acid alpha oxidase).</p>\n<p style=\"text-align: left;\">Refsum disease is a rare, <strong>autosomal recessive</strong> disorder caused by a deficiency of peroxisomal phytanoyl CoA &alpha;-hydroxylase, an enzyme involved in the alpha oxidation of phytanic acid (branched-chain fatty acid). This results in the <strong>accumulation </strong>of<strong> phytanic acid</strong> in the plasma and <strong>tissues</strong>.</p>\n<p style=\"text-align: left;\">The manifestation of classic adult Refsum disease includes</p>\n<ul style=\"text-align: left;\">\n<li style=\"font-weight: 400;\" aria-level=\"1\">Retinitis pigmentosa</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Peripheral neuropathy</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Ataxia</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Ichthyosis</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Anosmia</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Deafness</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Occasionally cardiac arrhythmias</li>\n</ul>\n<p style=\"text-align: left;\">Treatment: Restriction of dietary phytanic acid (found in dairy products and green leafy vegetables).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is a primary ketone body?",
    "choices": [
      {
        "id": 1,
        "text": "Acetone"
      },
      {
        "id": 2,
        "text": "Acetoacetate"
      },
      {
        "id": 3,
        "text": "Beta-hydroxybutyric acid"
      },
      {
        "id": 4,
        "text": "Acetyl CoA"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Thus, acetoacetate is the primary ketone body synthesized.</p>\n<p><strong>HMG CoA synthase</strong> is the <strong>rate-limiting step</strong> in ketone body synthesis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a69e8b5aaf1940888efebd938495c53bx600x940.JPEG"
    ]
  },
  {
    "text": "A 13 year-old-boy with type 1 diabetes presents with abdominal pain, severe nausea, and vomiting. He has a history of increased urine output over the past 2 days. ABG analysis reveals high anion gap metabolic acidosis. The given clinical condition is due to the over-activity of which of the following pathways?",
    "choices": [
      {
        "id": 1,
        "text": "HMP shunt"
      },
      {
        "id": 2,
        "text": "Gluconeogenesis"
      },
      {
        "id": 3,
        "text": "Lipolysis"
      },
      {
        "id": 4,
        "text": "Glycogenolysis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario is suggestive of <strong>diabetic ketoacidosis</strong> which is an <strong>insulin-deficient</strong> state leading to increased <strong>lipid breakdown (lipolysis)</strong> into fatty acids. This condition is also characterized by <strong>hyperglycemia</strong> and <strong>increased ketone body synthesis.</strong></p>\n<p>Type 1 diabetes mellitus is commonly found in the adolescent population.\u00a0 In response to certain precipitating factors, such patients may develop a severe insulin-deficient state. Since<strong> insulin </strong>is an <strong>inhibitor </strong>of <strong>hormone-sensitive lipase</strong> (HSL), an insulin-deficient state will cause <strong>HSL overactivity</strong> in adipocytes and the <strong>breakdown of lipid</strong> into fatty acids (<strong>lipolysis</strong>). Free fatty acids will undergo <strong>beta-oxidation</strong> and produce a large amount of <strong>acetyl CoA</strong>, which gets converted to <strong>ketone bodies</strong> ( acetoacetate, acetone, beta-hydroxybutyrate, etc.)\u00a0 Such ketone bodies will accumulate in the blood and cause <strong>high anion gap metabolic acidosis.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The rescue team has found a 33-year-old hiker who was stranded for 8 days. He was found in an extremely weak and dehydrated state. His breath has a fruity smell and urinalysis shows a positive ketostix test. The activity of which of the following enzymes is increased in him?",
    "choices": [
      {
        "id": 1,
        "text": "HMG CoA synthase"
      },
      {
        "id": 2,
        "text": "HMG CoA reductase"
      },
      {
        "id": 3,
        "text": "Acetyl CoA carboxylase"
      },
      {
        "id": 4,
        "text": "Pyruvate dehydrogenase"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>A <strong>fruity smell</strong> (presence of acetone in breath) and positive ketostix test (<strong>ketonuria</strong>) on the background of prolonged starvation is suggestive of <strong>starvation ketosis</strong>. This is characterized by <strong>increased</strong> activity of <strong>HMG CoA synthase</strong> enzyme.</p>\n<p>Prolonged starvation implies a <strong>catabolic state</strong> in which there is <strong>excessive \u03b2-oxidation</strong> leading to increased production of <strong>acetyl CoA</strong>. The excessive acetyl CoA is utilised by the hepatocytes to synthesise ketone bodies for extrahepatic utilisation.</p>\n<p><strong>HMG CoA synthase</strong> is the enzyme required for ketone body synthesis<strong>,\u00a0</strong>it is also the <strong>rate-limiting enzyme.</strong></p>\n<p>Other options:</p>\n<ul>\n<li><strong>HMG CoA reductase</strong> is involved in the <strong>synthesis of cholesterol</strong>.</li>\n<li><strong>Acetyl CoA carboxylase</strong> is involved in the\u00a0<strong>fatty acid synthesis.</strong></li>\n<li><strong>Pyruvate dehydrogenase</strong> converts <strong>pyruvate into acetyl CoA.</strong></li>\n</ul>\n<p>All three enzymes are <strong>inactive in low insulin state</strong> (such as prolonged starvation).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/246c55d37f2c4e2c876a41b04978129cx600x940.JPEG"
    ]
  },
  {
    "text": "Which of the following cannot utilize ketone bodies?",
    "choices": [
      {
        "id": 1,
        "text": "Brain"
      },
      {
        "id": 2,
        "text": "Skeletal muscle"
      },
      {
        "id": 3,
        "text": "Liver"
      },
      {
        "id": 4,
        "text": "Kidney"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The\u00a0<strong>liver</strong> cannot utilize ketone bodies.</p>\n<p>The ketone bodies synthesized in the liver mitochondria are transported in the blood to the peripheral tissues, where they are utilized by the following steps:</p>\n<ol>\n<li>\u03b2-hydroxybutyrate is oxidized to acetoacetate by\u00a0<strong>\u03b2-hydroxybutyrate dehydrogenase</strong> producing NADH.</li>\n<li>Acetoacetate is then activated to acetoacetyl CoA by transferring a CoA molecule from succinyl CoA by <strong>succinyl CoA-acetoacetate CoA transferase (thiophorase).</strong></li>\n<li>Acetoacetyl CoA is cleaved into two acetyl CoA molecules by <strong>thiolase</strong> and oxidized into CO<sub>2</sub> by the TCA cycle.</li>\n</ol>\n<p><strong>RBC</strong>s cannot utilize ketone bodies as they <strong>lack mitochondria</strong>.</p>\n<p>The <strong>liver</strong> cannot utilize ketone bodies as it\u00a0<strong>lacks the enzyme thiophorase.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A diabetic man presented with vomiting, abdominal pain, and polyuria. He gives a history of missing 2 doses of insulin since morning. He is hypotensive and tachycardic and his breath has a fruity odour. Blood glucose was 350 mg/dL. Which test, done here will give a positive result?",
    "choices": [
      {
        "id": 1,
        "text": "Hay's test"
      },
      {
        "id": 2,
        "text": "Fouchet's test"
      },
      {
        "id": 3,
        "text": "Ninhydrin test"
      },
      {
        "id": 4,
        "text": "Rothera\u2019s test"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The clinical picture is suggestive of diabetic <strong>ketoacidosis</strong> in which rothera\u2019s test will give positive results due to the presence of <strong>ketone bodies</strong> in urine.\u00a0</p>\n<p><strong>Rothera\u2019s test</strong>\u00a0by <strong>nitroprusside reagent</strong>\u00a0is a specific test used to detect whether <strong>acetone</strong> or <strong>acetoacetate</strong> is present in the given sample of urine. A <strong>purple ring</strong> at the junction of two liquids indicates a positive test.</p>\n<p>Note:\u00a0Rothera's test does <strong>not detect</strong>\u00a0\u03b2-hydroxybutyrate.\u00a0</p>\n<p>Other options:</p>\n<p>Option A<strong>: Hay's</strong> test is used to test for<strong> bile salts</strong>.</p>\n<p>Option B:<strong> Fouchet's</strong> test is used to test for <strong>bilirubin</strong>.</p>\n<p>Option C:<strong> Ninhydrin</strong> test is used to test for <strong>alpha-amino</strong> <strong>acids</strong>.<strong>\u00a0</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 12-year-old girl suffers from an inadequately treated type 1 diabetes mellitus. She is currently hyperglycemic. Which of the following is most likely to occur?",
    "choices": [
      {
        "id": 1,
        "text": "Glycogenesis in muscle"
      },
      {
        "id": 2,
        "text": "Increased protein synthesis"
      },
      {
        "id": 3,
        "text": "Increased conversion of fatty acids to acetyl-CoA"
      },
      {
        "id": 4,
        "text": "Decreased cholesterol synthesis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p style=\"text-align: left;\">With the background of inadequately treated <strong>type I diabetes mellitus</strong>, an <strong>insulin-deficient state</strong> in the body is expected which will lead to <strong>increased conversion </strong>of<strong> fatty acids to acetyl-CoA.</strong></p>\n<p style=\"text-align: left;\">Type 1 diabetes mellitus is commonly found in the adolescent population.\u00a0 In response to certain precipitating factors, such patients may develop a severe insulin-deficient state. Since<strong> insulin </strong>is an <strong>inhibitor </strong>of <strong>hormone-sensitive lipase</strong> (HSL), an insulin-deficient state will cause <strong>HSL overactivity</strong> in adipocytes and the <strong>breakdown of lipid</strong> into fatty acids (<strong>lipolysis</strong>). Free fatty acids will undergo <strong>beta-oxidation</strong> and produce a large amount of <strong>acetyl CoA</strong>, which gets converted to <strong>ketone bodies</strong> ( acetoacetate, acetone, beta-hydroxybutyrate, etc.)</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Ketosis is common in type 1 DM due to:",
    "choices": [
      {
        "id": 1,
        "text": "2,3 and 4"
      },
      {
        "id": 2,
        "text": "1,2,3 and 4"
      },
      {
        "id": 3,
        "text": "4 only"
      },
      {
        "id": 4,
        "text": "1 and 2 only"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>2, 3 and 4</strong> statements correctly explain the reason behind increased ketogenesis as seen in type1 DM.</p>\n<p><strong>Type 1 DM</strong> is characterized by a<strong> deficiency in insulin</strong> production. Since insulin is deficient, GLUT4 (insulin-dependent uptake) mediated glucose uptake is not possible in the heart or skeletal muscles. So <strong>adipose tissue mobilizes fat</strong> to be used as an energy source. These<strong> FFA</strong> (free fatty acids) are<strong> oxidized</strong> to <strong>acetoacetyl CoA</strong> which serves as a precursor for<strong> ketone body</strong> <strong>synthesis</strong>.</p>\n<p>As the level of serum FFA is raised, proportionately<strong> more</strong> of the <strong>acetyl-CoA</strong> produced from their breakdown is <strong>converted to ketone bodies</strong> and<strong> less</strong> is oxidized <strong>via the citric acid cycle</strong> to CO2.\u00a0A fall in the concentration of oxaloacetate, particularly within the mitochondria, can impair the ability of the citric acid cycle to metabolize acetyl-CoA and divert fatty acid oxidation toward ketogenesis. Such a fall may occur because of an <strong>increase in the (NADH)/(NAD+) ratio</strong> caused when increased \u03b2-oxidation alters the equilibrium between oxaloacetate and malate so that the <strong>concentration of oxaloacetate is decreased</strong>.\u00a0</p>\n<p><strong>Beta-hydroxy butyrate dehydrogenase</strong> is one of the enzymes used in ketone body synthesis. Increased rate of ketone body synthesis in <strong>insulin-deficient state</strong> implies an <strong>increased activity </strong>of<strong> beta-hydroxy butyrate dehydrogenase</strong> enzyme.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '13 Fatty Acid Oxidation And Ketogenesis';
        const quizFilename = '13-fatty-acid-oxidation-and-ketogenesis-1d79c99f.html';
        let hierarchy = ["Marrow", "qBank", "Biochemistry"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>