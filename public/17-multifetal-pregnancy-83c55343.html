<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>17 Multifetal Pregnancy - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Obstetrics & Gynecology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">26</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "What is the most common type of multifetal pregnancy?",
    "choices": [
      {
        "id": 1,
        "text": "Monozygotic dichorionic diamniotic"
      },
      {
        "id": 2,
        "text": "Dizygotic dichorionic diamniotic"
      },
      {
        "id": 3,
        "text": "Monozygotic monochorionic diamniotic"
      },
      {
        "id": 4,
        "text": "Monozygotic monochorionic monoamniotic"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The most common type of multifetal pregnancy is <strong>dizygotic</strong> twinning, which is always <strong>dichorionic diamniotic</strong>.&nbsp;</p>\n<p>The incidence of dizygotic twins is 80% among twins. Of the <strong>monozygotic</strong> twins, <strong>monochorionic diamniotic</strong> is the most common (13-14%).</p>\n<p><strong>Zygosity</strong> refers to the type of<strong> conception </strong>while<strong>&nbsp;chorionicity</strong> refers to the type of <strong>placentation</strong>.</p>\n<p>Types of twin pregnancies:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Dizygotic: 2 ova are fertilized by 2 sperms to form 2 separate zygotes.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Monozygotic: Single zygote (1 ovum fertilized by 1 sperm) divides into 2.</li>\n</ul>\n<table>\n<tbody>\n<tr>\n<td>Feature</td>\n<td>Monozygotic</td>\n<td>Dizygotic</td>\n</tr>\n<tr>\n<td>Phenotype</td>\n<td>Identical</td>\n<td>Non-identical</td>\n</tr>\n<tr>\n<td>Genotype</td>\n<td>Identical</td>\n<td>Non-identical</td>\n</tr>\n<tr>\n<td>Incidence</td>\n<td>1:250 (constant worldwide)</td>\n<td>Varies with demography</td>\n</tr>\n<tr>\n<td>Incidence after ART</td>\n<td>Increases</td>\n<td>Increases</td>\n</tr>\n<tr>\n<td>Perinatal complications</td>\n<td>High</td>\n<td>Low</td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/babb023570254f7d800dd842177cc733x1280x5795.JPEG"
    ]
  },
  {
    "text": "What is the time of division of the inner cell mass in a diamniotic monochorionic pregnancy?",
    "choices": [
      {
        "id": 1,
        "text": "1st - 2nd day"
      },
      {
        "id": 2,
        "text": "4th \u2013 8th day"
      },
      {
        "id": 3,
        "text": "8th - 12th day"
      },
      {
        "id": 4,
        "text": "10th - 14th day"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Diamniotic monochorionic</strong> pregnancy occurs if the division of inner cell mass takes place between <strong>4th - 8th day</strong> after fertilization.</p>\n<p>The timing of the division of zygote for each type of twinning is given below.</p>\n<table>\n<tbody>\n<tr>\n<td>Monozygotic twin types</td>\n<td>Time of zygote division</td>\n</tr>\n<tr>\n<td>Dichorionic diamniotic</td>\n<td>&lt;72 hours</td>\n</tr>\n<tr>\n<td>Monochorionic diamniotic (more common)</td>\n<td>4-8 days</td>\n</tr>\n<tr>\n<td>Monochorionic monoamniotic\u00a0</td>\n<td>8-12 days</td>\n</tr>\n<tr>\n<td>Conjoined twins</td>\n<td>&gt;12 days</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is false regarding multifetal pregnancies?",
    "choices": [
      {
        "id": 1,
        "text": "Number of embryos implanted affects the risk of twinning"
      },
      {
        "id": 2,
        "text": "Isograft is done between monozygotic twins"
      },
      {
        "id": 3,
        "text": "Twins of opposite sex are usually dizygotic"
      },
      {
        "id": 4,
        "text": "Same sex twins having same blood group are always monozygotic"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Same sex</strong> twins of the <strong>same blood group</strong> are not always monozygotic but can also be&nbsp;<strong>dizygotic twins</strong> as well. The genetic relationship between dizygotic twins is the same as any siblings.</p>\n<p>Option A: More the number of embryos transferred in IVF, more is the risk of twinning. Hence, <strong>single embryo transfer</strong> is being <strong>recommended</strong> by the American Society for Reproductive Medicine (2017) to prevent twin gestation.</p>\n<p>Option B: <strong>Isograft</strong> is done between monozygotic twins as they have <strong>HLA homology</strong>.</p>\n<p>Option C: Twins of the <strong>opposite sex</strong> are <strong>usually dizygotic</strong>. Rarely, somatic mutations or chromosomal aberrations can change the sex of 1 or both of the monozygotic twins.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The examination findings of a pregnant woman are suggestive of her having conjoined twins. Which is the most common type of such twins?",
    "choices": [
      {
        "id": 1,
        "text": "Craniopagus"
      },
      {
        "id": 2,
        "text": "Thoracopagus"
      },
      {
        "id": 3,
        "text": "Pyopagus"
      },
      {
        "id": 4,
        "text": "Cephalopagus"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Thoracopagus</strong> is the <strong>most common</strong> type of conjoined twins.</p>\n<p><strong>Division</strong> of the inner cell mass <strong>after</strong> the <strong>12th</strong> <strong>day</strong> of fertilization results in the development of <strong>conjoined</strong> or Siamese twins. Based on the parts of the body joined, they are of the following types:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Ventral</li>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"2\">Rostral</li>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"3\">Omphalopagus (abdomen)</li>\n<li style=\"font-weight: 400;\" aria-level=\"3\">Thoracopagus (upper chest)</li>\n<li style=\"font-weight: 400;\" aria-level=\"3\">Cephalopagus (head)</li>\n</ul>\n<li style=\"font-weight: 400;\" aria-level=\"2\">Caudal</li>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"3\">Ischiopagus (conjoined spines at 180 angle)</li>\n</ul>\n<li style=\"font-weight: 400;\" aria-level=\"2\">Lateral</li>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"3\">Paraphagus (side by side fusion with a shared pelvis)</li>\n</ul>\n</ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Dorsal</li>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"2\">Craniopagus (skull)</li>\n<li style=\"font-weight: 400;\" aria-level=\"2\">Rachipagus (vertebral arches)</li>\n<li style=\"font-weight: 400;\" aria-level=\"2\">Pyopagus (pelvis)</li>\n</ul>\n</ul>\n<p><strong>Sharing</strong> of <strong>organs</strong> is common among conjoined twins. <strong>MRI</strong> imaging is done later in pregnancy for the evaluation of organ sharing between conjoined twins who are being planned for <strong>surgical</strong> <strong>separation</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e4f444a1b9df414e95da20dae2ef92a7x1280x2558.JPEG"
    ]
  },
  {
    "text": "Which of the following can be used to calculate the incidence of multifetal gestation?",
    "choices": [
      {
        "id": 1,
        "text": "Tei index"
      },
      {
        "id": 2,
        "text": "Hellin's rule"
      },
      {
        "id": 3,
        "text": "CHOP score"
      },
      {
        "id": 4,
        "text": "Kleihauer-Betke test"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>incidence</strong> of multiple pregnancies is calculated by <strong>Hellin&rsquo;s rule</strong>.</p>\n<p>According to this rule, incidence= 1 : 80<sup>(n-1)</sup>, where n is the number of fetuses.</p>\n<p><strong>Factors affecting</strong> the <strong>incidence of twin pregnancies</strong> are:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Monozygotic</li>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"2\">ART</li>\n</ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Dizygotic</li>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"2\">Race</li>\n<li style=\"font-weight: 400;\" aria-level=\"2\">Heredity</li>\n<li style=\"font-weight: 400;\" aria-level=\"2\">Maternal age</li>\n<li style=\"font-weight: 400;\" aria-level=\"2\">Parity</li>\n<li style=\"font-weight: 400;\" aria-level=\"2\">Family history of twinning</li>\n<li style=\"font-weight: 400;\" aria-level=\"2\">Good nutritional status</li>\n<li style=\"font-weight: 400;\" aria-level=\"2\">Infertility therapy</li>\n</ul>\n</ul>\n<p>Option A: <strong>Tei index</strong> or myocardial performance index (MPI) is calculated using ventricular doppler imaging. It is used to assess <strong>cardiac function</strong> in <strong>TTTS</strong>.</p>\n<p>Option C: <strong>CHOP</strong> <strong>score</strong> is used for <strong>cardiac</strong> <strong>evaluation</strong> of recipient twin in <strong>TTTS</strong>.</p>\n<p>Option D: <strong>Kleihauer</strong>-<strong>Betke</strong> <strong>test</strong> is used to evaluate the approximate volume of <strong>fetomaternal hemorrhage</strong>&nbsp;in cases of Rh-D alloimmunization.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In which of the following instances is there an increased chance of twinning?",
    "choices": [
      {
        "id": 1,
        "text": "1, 4, 5"
      },
      {
        "id": 2,
        "text": "3, 4, 5"
      },
      {
        "id": 3,
        "text": "2, 3, 4"
      },
      {
        "id": 4,
        "text": "1, 2, 3"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Increasing maternal age, family history of twinning, and conception after stopping OCPs increase the risk of twinning.</p>\n<p><strong>Taller</strong>, <strong>well</strong>-<strong>built</strong> women have an <strong>increased</strong> risk of <strong>twinning</strong> compared to shorter undernourished women. IVF increases the risk of twinning but <strong>single</strong> <strong>embryo</strong> <strong>transfer</strong> <strong>reduces</strong> the risk of <strong>multifetal pregnancies</strong>.</p>\n<p>Factors affecting the incidence of twin pregnancies:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Monozygotic</li>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"2\">ART</li>\n</ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Dizygotic</li>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"2\">Race</li>\n<li style=\"font-weight: 400;\" aria-level=\"2\">Heredity</li>\n<li style=\"font-weight: 400;\" aria-level=\"2\">Maternal age</li>\n<li style=\"font-weight: 400;\" aria-level=\"2\">Parity</li>\n<li style=\"font-weight: 400;\" aria-level=\"2\">Family history of twinning</li>\n<li style=\"font-weight: 400;\" aria-level=\"2\">Good nutritional status</li>\n<li style=\"font-weight: 400;\" aria-level=\"2\">Infertility therapy</li>\n</ul>\n</ul>\n<p>Note- A family history of twinning (maternal and paternal) causes an increased chance of twinning. It is seen that maternal history of twinning has a higher chance of twinning as compared to a paternal history of twinning.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In superfecundation, which of the following is seen?",
    "choices": [
      {
        "id": 1,
        "text": "Fertilisation of 2 ova released at the same time by sperms released at single intercourse"
      },
      {
        "id": 2,
        "text": "Fertilisation of 2 ova released in the same cycle by sperms released at intercourse on 2 different occasion"
      },
      {
        "id": 3,
        "text": "Both of the above"
      },
      {
        "id": 4,
        "text": "None of the above"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Superfecundation </strong>is the fertilization of<strong> two</strong> different <strong>ova</strong> released in the <strong>same cycle</strong>, by two&nbsp;<strong>separate acts of coitus</strong> within a short period of time.</p>\n<p>Superfecundation is the fertilization of&nbsp;<strong>two different ova</strong>&nbsp;in the&nbsp;<strong>same menstrual cycle </strong>(as suggested by the same gestational age)<strong>&nbsp;</strong>by separate acts of coitus. It can occur even after <strong>artificial reproductive therapy.</strong> Hence, after embryo transfer, intercourse must be avoided. Heteropaternal superfecundation is used to refer to instances of two different males fathering fraternal twins. This leads to the possibility of twins also being half-siblings. This&nbsp;may give rise to the doubt of adultery and infidelity.&nbsp;</p>\n<p><strong>Superfetation </strong>is the fertilization of<strong> two ova</strong> released in <strong>different</strong> menstrual <strong>cycles</strong>. This is not seen in humans. The nidation and development of one fetus over another fetus is <strong>theoretically possible</strong> until the decidual space is obliterated by <strong>14-16 weeks of pregnancy.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is false regarding the condition given in the image?",
    "choices": [
      {
        "id": 1,
        "text": "It is more common in monochorionic pregnancies"
      },
      {
        "id": 2,
        "text": "It cannot be detected by sonography"
      },
      {
        "id": 3,
        "text": "It is diagnosed usually after delivery"
      },
      {
        "id": 4,
        "text": "Morbidity in the co-twin is due to hypotension"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The above image shows <strong>fetus compressus</strong> which appears as a tan ovoid mass compressed against the fetal membranes. It can be <strong>detected early</strong> by <strong>sonography</strong>.</p>\n<p>In multifetal pregnancies, if one of the fetuses dies early in pregnancy, the surviving fetus continues to develop normally. It can lead to the following outcomes:</p>\n<table>\n<tbody>\n<tr>\n<td>Outcome</td>\n<td>Type</td>\n</tr>\n<tr>\n<td>Disappears</td>\n<td>Vanishing twin</td>\n</tr>\n<tr>\n<td>Gets compressed</td>\n<td>Fetus compressus</td>\n</tr>\n<tr>\n<td>Flattened through desiccation</td>\n<td>Fetus papyraceus</td>\n</tr>\n</tbody>\n</table>\n<p>Factors affecting the prognosis of the surviving twin:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Gestational</strong> <strong>age</strong> at fetal death: 2nd and 3rd trimester deaths increase the risk of morbidity in the surviving twin</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Chorionicity</strong>: Monochorionic twins with early fetal death have an increased risk of morbidity in the surviving twin. This is due to neurological abnormality and vascular anastomoses.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Duration</strong> <strong>between</strong> fetal <strong>demise</strong> and <strong>delivery</strong> of surviving twin</li>\n<li>Surviving twin may be born&nbsp;<strong>preterm</strong> leading to an increased risk of fetal demise</li>\n</ul>\n<p>Death in the <strong>surviving</strong> <strong>twin</strong>&nbsp;occurs mostly due to vascular anastomoses between the twins. The surviving twin can develop&nbsp;<strong>sudden hypotension</strong>&nbsp;due to these anatomoses after fetal demise.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a20f96870cf14e34a003b078c6bbad5c.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A woman is diagnosed to have twins during her dating scan. What is the most common presentation in such pregnancies?",
    "choices": [
      {
        "id": 1,
        "text": "Both vertex"
      },
      {
        "id": 2,
        "text": "1st vertex and 2nd transverse"
      },
      {
        "id": 3,
        "text": "1st breech and 2nd vertex"
      },
      {
        "id": 4,
        "text": "1st vertex and 2nd breech"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The most common presentation in twins is <strong>both</strong>&nbsp;<strong>vertex</strong>/ <strong>cephalo-cephalic</strong> presentation (60%).&nbsp;The other presentations include:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Cephalo-Breech (20%)</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Breech-Cephalic (10%)</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Breech-Breech (6-10%)</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Transverse-Transverse (Rarest)</li>\n</ul>\n<p>Mode of delivery depends on the presentation of the 1st twin as:</p>\n<table>\n<tbody>\n<tr>\n<td>Presentation of the 1st twin</td>\n<td>Mode of delivery</td>\n</tr>\n<tr>\n<td>Vertex</td>\n<td>Vaginal</td>\n</tr>\n<tr>\n<td>Breech</td>\n<td>Caesarean section</td>\n</tr>\n<tr>\n<td>Transverse</td>\n<td>Caesarean section</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The best time to identify the type of twin pregnancy on ultrasound is:",
    "choices": [
      {
        "id": 1,
        "text": "18-22 weeks"
      },
      {
        "id": 2,
        "text": "24-28 weeks"
      },
      {
        "id": 3,
        "text": "11-14 weeks"
      },
      {
        "id": 4,
        "text": "14-18 weeks"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The best time to <strong>identify</strong> the<strong> type of twin</strong> pregnancy on ultrasound is <strong>11-14 weeks.</strong></p>\n<p>Twin pregnancies should ideally be dated when the <strong>crown&ndash;rump length</strong> (CRL) measurement is <strong>between 45 and 84 mm</strong> (i.e. 11 + 0 to 13 + 6 weeks of gestation).</p>\n<p>Chorionicity should be ideally determined between <strong>11 + 0</strong> and<strong> 13 + 6 weeks</strong> of gestation (the earliest time to identify chorionicity is 7 weeks). This is done using the membrane thickness at the site of insertion of the amniotic membrane into the placenta. The T\u2010sign (in monochorionic twins) or lambda sign (in dichorionic twins) can be seen here. As the determination of <strong>chorionicity</strong> is most accurate when the amnion and chorion have not yet been fused, the<strong> first\u2010trimester scan</strong> in twin pregnancy is highly important.</p>\n<p>Markers of <strong>dichorionicity</strong> include <strong>4 layers</strong> of membranes between the twins, membrane <strong>thickness <span style=\"text-decoration: underline;\">&gt;</span>2mm</strong>, <strong>different sex </strong>of twins, <strong>2</strong> different <strong>placentas,</strong> and <strong>positive twin peak</strong> sign.</p>\n<p>Women with an uncomplicated dichorionic twin pregnancy should have a first\u2010trimester scan, a detailed second\u2010trimester scan, and scans every 4 weeks thereafter.&nbsp;</p>\n<p>Women with uncomplicated monochorionic twins should have a first\u2010trimester scan and then scans every 2 weeks from 16 weeks onwards. This is done in order to detect TTTS and TAPS in a timely manner.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 35-year-old woman conceived after being treated for infertility. Her USG scan is given below. What is her diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Dichorionic diamniotic twins"
      },
      {
        "id": 2,
        "text": "Monochorionic diamniotic twins"
      },
      {
        "id": 3,
        "text": "Monochorionic monoamniotic twins"
      },
      {
        "id": 4,
        "text": "Singleton pregnancy with uterine septum"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Sonographic assessment of dichorionicity is done by observing the following:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Number of placental masses - 2</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Presence of intervening membrane - twin peak or lambda or delta sign</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Thickness of intervening membranes &ge; 2mm</li>\n</ul>\n<p>The best <strong>time of delivery</strong> of dichorionic diamniotic twins is <strong>38</strong> <strong>weeks</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a3b22a4fa04842d983d0ceae79706c8d.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2ed8c62006b348c6ad2e99a7182853a5x1280x1699.JPEG"
    ]
  },
  {
    "text": "A primigravida presents to the ANC clinic for the first time at 14 weeks of gestation. She complains of excessive nausea and vomiting. On examination, fundal height is midway between pubic symphysis and umbilicus. The T sign in seen on USG. What is her diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Dichorionic diamniotic twins"
      },
      {
        "id": 2,
        "text": "Monochorionic diamniotic  twins"
      },
      {
        "id": 3,
        "text": "Monochorionic monoamniotic twins"
      },
      {
        "id": 4,
        "text": "Dizygotic twins"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario and the<strong data-stringify-type=\"bold\"> T sign </strong>seen on&nbsp;USG points towards a diagnosis of<strong data-stringify-type=\"bold\">&nbsp;monochorionic diamniotic&nbsp;</strong>twins.</p>\n<p>The T sign is <strong>formed</strong> at the point at which the <strong>amnions meet</strong> the <strong>placenta</strong>. In monochorionic diamniotic twins, the separating membrane is made up only by the two amniotic membranes with no intervening chorion. This can be seen in the latter part of the first trimester or the beginning of the second trimester.</p>\n<p><strong>Symptoms</strong>&nbsp;of multifetal pregnancy:</p>\n<ul>\n<li aria-level=\"1\"><strong>Increased nausea and vomiting</strong> in early months</li>\n<li aria-level=\"1\">Palpitations and shortness of breath</li>\n<li aria-level=\"1\">Increased swelling of legs, varicose veins and haemorrhoids</li>\n<li aria-level=\"1\">Unusual rate of uterine growth</li>\n<li aria-level=\"1\">Excessive fetal movements</li>\n</ul>\n<p><strong>Signs</strong>&nbsp;of multifetal pregnancy:</p>\n<ul>\n<li aria-level=\"1\">Increased weight gain</li>\n<li aria-level=\"1\">Hypertension</li>\n<li aria-level=\"1\">Barrel shaped abdomen</li>\n<li aria-level=\"1\"><strong>Increased fundal height</strong> and abdominal girth</li>\n<li aria-level=\"1\">Multiple fetal parts</li>\n<li aria-level=\"1\">Palpation of 2 fetal heads&nbsp;</li>\n<li aria-level=\"1\">FHS at different spots with FHR difference of at least 10bpm</li>\n</ul>\n<p>Monochorionic diamniotic pregnancy is terminated between 34-37 weeks+6 days.</p>\n<p>The below image shows the T sign.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a2d552dd401d4bb4a0bed1a354d074edx510x396.GIF"
    ]
  },
  {
    "text": "Which of the following images depicts monochorionic diamniotic pregnancy?",
    "choices": [
      {
        "id": 1,
        "text": "3"
      },
      {
        "id": 2,
        "text": "4"
      },
      {
        "id": 3,
        "text": "1"
      },
      {
        "id": 4,
        "text": "2"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Sonographic assessment of <strong>monochorionicity</strong> is done by observing the following:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Single</strong> placental mass</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Presence of intervening membrane - <strong>T sign</strong></li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Thin intervening membrane <strong>&lt;2mm</strong></li>\n</ul>\n<p>The best time of delivery of monochorionic diamniotic twins is 34 - 37weeks + 6 days.</p>\n<p>Image 1: <strong>Dichorionic</strong> twins with twin peak or lambda sign</p>\n<p>Image 3: Monochorionic <strong>monoamniotic</strong> twins with no intervening membranes between them</p>\n<p>Image 4: <strong>Triplets</strong> with 3 separate gestational sacs</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/7535cfa87e964427be178ee8f8beeb04.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1739f341a8be4834b0e9b6d6bc8839b0x1280x1703.JPEG"
    ]
  },
  {
    "text": "A mother with twin pregnancy underwent routine USG. Estimated fetal weights were calculated for both twins. What is the criteria to diagnose pathological discordant growth in this pregnancy?",
    "choices": [
      {
        "id": 1,
        "text": "Difference of >25% with larger twin as index"
      },
      {
        "id": 2,
        "text": "Difference of <50% with larger twin as index"
      },
      {
        "id": 3,
        "text": "Difference of >50% with smaller twin as index"
      },
      {
        "id": 4,
        "text": "Difference of >20% with larger twin as index"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>A difference in estimated<strong> fetal weight</strong>\u00a0of <strong>&gt;20%</strong> with <strong>larger</strong> twin as <strong>index</strong> is one of the criteria for diagnosing discordant growth.</p>\n<p>Discordant growth is the <strong>unequal</strong> <strong>size/ weight</strong> among the fetuses in a multifetal gestation. It can be diagnosed by either of the following:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Estimated fetal weight difference &gt; 20%</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Discordance = (weight of larger twin - weight of smaller twin/weight of larger twin) x 100</li>\n</ul>\n<p>Discordant growth in <strong>monochorionic</strong> twins is due to placental <strong>vascular</strong> <strong>anastomoses</strong>. In <strong>dichorionic</strong> twins, it occurs due to differences in <strong>genetic</strong> growth <strong>potential</strong> and suboptimal <strong>implantation site</strong> for one of the fetuses.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In a woman receiving artificial reproductive therapy, the inner cell mass divides on the 7th day. Which of the following complications is not seen in the resulting multifetal pregnancy?",
    "choices": [
      {
        "id": 1,
        "text": "Twin twin transfusion syndrome"
      },
      {
        "id": 2,
        "text": "Discordant growth"
      },
      {
        "id": 3,
        "text": "Cord entanglement"
      },
      {
        "id": 4,
        "text": "Acardiac twin"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The division of the inner cell mass on the <strong>7th</strong> day will result in <strong>monochorionic</strong> <strong>diamniotic</strong>&nbsp;type of twin pregnancy. <strong>Cord entanglement</strong> is seen in <strong>monoamniotic</strong> twins and not in diamniotic twins.</p>\n<p>The timing of the division of zygote for each type of twinning is given below.</p>\n<table>\n<tbody>\n<tr>\n<td>Monozygotic types</td>\n<td>Time of zygote division</td>\n</tr>\n<tr>\n<td>Dichorionic diamniotic</td>\n<td>&lt;72 hours</td>\n</tr>\n<tr>\n<td>Monochorionic diamniotic (more common)</td>\n<td>4-8 days</td>\n</tr>\n<tr>\n<td>Monochorionic monoamniotic&nbsp;</td>\n<td>8-12 days</td>\n</tr>\n<tr>\n<td>Conjoined twins</td>\n<td>&gt;12 days</td>\n</tr>\n</tbody>\n</table>\n<p>Complications in<strong> monochorionic</strong> <strong>diamniotic</strong> twins occur due to placental vascular anastomoses. They include:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Twin-twin transfusion syndrome (TTTS)</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Twin reversed arterial perfusion (TRAP) or acardiac twin</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Twin anaemia polycythemia syndrome (TAPS)</li>\n</ul>\n<p><strong>Monochorionic</strong> <strong>monoamniotic</strong> twins have a high fetal death rate. This is due to the following complications:</p>\n<ul>\n<li>Preterm birth</li>\n<li>Congenital anomalies</li>\n<li>Low birth weight</li>\n<li>Cord entanglement</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the most common type of placental vascular anastomoses seen in monochorionic twin pregnancies?",
    "choices": [
      {
        "id": 1,
        "text": "Artery \u2013 vein"
      },
      {
        "id": 2,
        "text": "Vein \u2013 vein"
      },
      {
        "id": 3,
        "text": "Artery \u2013 artery"
      },
      {
        "id": 4,
        "text": "Both A and B"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Artery-vein</strong> anastomoses are <strong>most commonly</strong> seen in <strong>monochorionic</strong> pregnancies.\u00a0</p>\n<p>All monochorionic placentas have anastomoses that can be:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Superficial artery-vein</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Deep artery-vein</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Artery-artery</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Vein-vein</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">One vessel with connections to multiple arteries and veins</li>\n</ul>\n<p>These anastomoses are <strong>not functional</strong> as long as the <strong>fetuses</strong> are <strong>hemodynamically balanced</strong>. When a <strong>pressure gradient</strong> <strong>develops</strong> between the fetuses, <strong>complications</strong>\u00a0can occur like:</p>\n<ul>\n<li>TTTS - Twin-twin transfusion syndrome</li>\n<li>TAPS -\u00a0Twin anemia polycythemia sequence</li>\n<li>TRAP -\u00a0Twin reversed arterial perfusion</li>\n</ul>\n<p>The <strong>most common</strong> complication in monochorionic twins is twin-twin transfusion syndrome (<strong>TTTS</strong>). Deep artery-vein anastomosis is the pathology seen in this condition.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 26-year-old woman, pregnant with twins, is diagnosed to have twin-twin transfusion syndrome. Which of the following statements is true regarding the recipient twin in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Oliguria is seen"
      },
      {
        "id": 2,
        "text": "It is called the stuck twin"
      },
      {
        "id": 3,
        "text": "Pulmonary hypoplasia is seen"
      },
      {
        "id": 4,
        "text": "Congestive cardiac failure develops"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<div class=\"page\" title=\"Page 923\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Congestive heart failure</strong> is seen in the recipient twin.</p>\n<p>Twin-twin transfusion syndrome is a deep&nbsp;<strong>arteriovenous</strong> <strong>anastomotic</strong> complication seen in&nbsp;<strong>monochorionic</strong> <strong>diamniotic</strong> twins. Deoxygenated <strong>blood from</strong> the <strong>donor</strong> enters through the anastomosis into a shared cotyledon for oxygen exchange. Oxygenated blood is<strong> taken</strong> up <strong>by</strong> the <strong>recipient</strong> twin causing <strong>imbalance in</strong> the<strong> blood volumes</strong>.</p>\n<table>\n<tbody>\n<tr>\n<td>Donor twin characteristics</td>\n<td>Recipient twin characteristics</td>\n</tr>\n<tr>\n<td>Oliguria</td>\n<td>Polyuria</td>\n</tr>\n<tr>\n<td>Oligohydramnios</td>\n<td>Polyhydramnios</td>\n</tr>\n<tr>\n<td>Hypotension</td>\n<td>Hypertension</td>\n</tr>\n<tr>\n<td>Anaemia</td>\n<td>Polycythemia</td>\n</tr>\n<tr>\n<td>Activation of renin-angiotensin-aldosterone system (RAAS)</td>\n<td>Activation of atrial natriuretic peptide (ANP)</td>\n</tr>\n<tr>\n<td>Renal failure, growth restriction, pulmonary hypoplasia, contractures</td>\n<td>Congestive cardiac failure, premature rupture of membranes</td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;<strong>Diagnosis</strong> of TTTS depends on 2 USG criteria:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Monochorionic diamniotic gestation</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Hydramnios (DVP&gt;8cm) in one twin and oligohydramnios (DVP&lt;2cm) in the other twin</li>\n</ul>\n<p><strong>Treatment</strong> modalities for TTTS:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Serial amnioreduction</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Laser ablation of vascular placental anastomoses</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Selective fetal termination</li>\n</ul>\n<p>Note: <strong>Donor</strong> twin is called the <strong>stuck twin</strong> as the oligohydramnios limits fetal movement.</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The ultrasound findings in a monochorionic diamniotic twin pregnancy are indicative of poly-oli syndrome. What is the pathology seen in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Artery - artery anastomosis"
      },
      {
        "id": 2,
        "text": "Vein \u2013 vein anastomosis"
      },
      {
        "id": 3,
        "text": "Deep artery \u2013 vein anastomosis"
      },
      {
        "id": 4,
        "text": "Superficial artery - vein anastomosis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In <strong>poly - oli</strong> or polyhydramnios - oligohydramnios syndrome, the basic pathology is the presence of a <strong>deep</strong> <strong>artery-vein anastomosis</strong>.</p>\n<p><strong>TTTS</strong> can present as poly-oli syndrome or twin oligohydramnios polyhydramnios syndrome (TOPS). This is usually seen in mid-pregnancy. In this syndrome, there is decreased <strong>donor</strong> renal perfusion, causing oliguria and <strong>oligohydramnios</strong>. Because of the anastomosis, the <strong>recipient</strong> twin has increased renal perfusion and increased urine production causing <strong>polyhydramnios</strong>.</p>\n<table>\n<tbody>\n<tr>\n<td><strong>Donor twin characteristics</strong></td>\n<td><strong>Recipient twin characteristics</strong></td>\n</tr>\n<tr>\n<td>Oliguria</td>\n<td>Polyuria</td>\n</tr>\n<tr>\n<td>Oligohydramnios</td>\n<td>Polyhydramnios</td>\n</tr>\n<tr>\n<td>Hypotension</td>\n<td>Hypertension</td>\n</tr>\n<tr>\n<td>Anemia</td>\n<td>Polycythemia</td>\n</tr>\n<tr>\n<td>Renal failure</td>\n<td>Congestive cardiac failure</td>\n</tr>\n<tr>\n<td>Growth restriction</td>\n<td>Premature rupture of membranes</td>\n</tr>\n<tr>\n<td>Pulmonary hypoplasia</td>\n<td>Hyperbilirubinemia</td>\n</tr>\n<tr>\n<td>Contractures</td>\n<td>&nbsp;</td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Ultrasound findings in a twin pregnancy are given below:",
    "choices": [
      {
        "id": 1,
        "text": "Stage I"
      },
      {
        "id": 2,
        "text": "Stage II"
      },
      {
        "id": 3,
        "text": "Stage III"
      },
      {
        "id": 4,
        "text": "Stage IV"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given USG findings are indicative of <strong>twin-twin transfusion syndrome</strong> (TTTS) with twin A being the recipient and twin B being the donor twin. <strong>Oligohydramnios</strong> (AFI&lt;5cm), <strong>absent urine</strong> and <strong>abnormal</strong> <strong>Doppler</strong> flow findings in the donor twin indicate <strong>stage III</strong> of twin-twin transfusion syndrome according to Quintero staging.</p>\n<p><strong>Quintero</strong> <strong>staging</strong> system for <strong>TTTS</strong> classification:</p>\n<table>\n<tbody>\n<tr>\n<td>Stage</td>\n<td>USG findings</td>\n</tr>\n<tr>\n<td>I</td>\n<td>Discordant amniotic fluid volumes + urine visible in donor's bladder</td>\n</tr>\n<tr>\n<td>II</td>\n<td>Discordant amniotic fluid volumes + urine not visible in donor's bladder</td>\n</tr>\n<tr>\n<td>III</td>\n<td>Stage II + abnormal Doppler studies of umbilical artery/vein or ductus venosus</td>\n</tr>\n<tr>\n<td>IV</td>\n<td>Ascites or frank hydrops in either twin</td>\n</tr>\n<tr>\n<td>V</td>\n<td>Death of either twin</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An anxious mother pregnant with twins was recently diagnosed with twin-twin transfusion syndrome. She wants to know the possible fetal outcome of the pregnancy. Which of the following investigations can be used to predict this?",
    "choices": [
      {
        "id": 1,
        "text": "Deepest vertical pocket - USG"
      },
      {
        "id": 2,
        "text": "Fetal hemoglobin estimation"
      },
      {
        "id": 3,
        "text": "MPI - ventricle Doppler"
      },
      {
        "id": 4,
        "text": "Peak systolic velocity - MCA Doppler"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In twin-twin transfusion syndrome (TTTS), the<strong> fetal outcome</strong> depends on the <strong>cardiac function</strong> of the <strong>recipient</strong> twin. <strong>Tei index</strong> or <strong>myocardial performance index</strong> (MPI) is used to assess the ventricular function using doppler.</p>\n<p>Option A: Deepest vertical pocket on USG is used to diagnose polyhydramnios-oligohydramnios in TTTS.</p>\n<p>Options B and D: Fetal haemoglobin and MCA peak systolic velocity are used to diagnose TAPS (Twin anaemia polycythemia syndrome).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is/are the placental vascular abnormality that can be seen in the condition depicted in the image given below?",
    "choices": [
      {
        "id": 1,
        "text": "Artery \u2013 artery anastomosis"
      },
      {
        "id": 2,
        "text": "Vein \u2013 vein anastomosis"
      },
      {
        "id": 3,
        "text": "Artery \u2013 vein anastomosis"
      },
      {
        "id": 4,
        "text": "Both A and B"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>\u00a0</p>\n<p>Based on the supply of deoxygenated blood, the <strong>recipient twin</strong> might have the following <strong>fates</strong>:</p>\n<table>\n<tbody>\n<tr>\n<td>Fate</td>\n<td>Type</td>\n</tr>\n<tr>\n<td>Lower body is perfused with failed head growth</td>\n<td>Acardius acephalus</td>\n</tr>\n<tr>\n<td>Partially developed head with identifiable limbs</td>\n<td>Acardius myelecephalus</td>\n</tr>\n<tr>\n<td>No recognizable structure</td>\n<td>Acardius amorphous</td>\n</tr>\n</tbody>\n</table>\n<p>The <strong>donor</strong> twin develops high output<strong> cardiac failure</strong>.</p>\n<p>The<strong> treatment</strong>\u00a0for this condition is\u00a0<strong>radiofrequency ablation</strong> of the acardiac or recipient twin.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/22d48eae5f72400e996c5dc312c5d304.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/35e5b4c6d3b04f45a9c7ca25c4f9cfafx720x619.JPEG"
    ]
  },
  {
    "text": "A 25-year-old woman, pregnant with twins, goes into labour. Following the vaginal delivery of the first twin, she was taken to the OT for internal version. What could have been the possible indication for this procedure?",
    "choices": [
      {
        "id": 1,
        "text": "2nd twin breech presentation"
      },
      {
        "id": 2,
        "text": "2nd twin knee presentation"
      },
      {
        "id": 3,
        "text": "2nd twin transverse lie"
      },
      {
        "id": 4,
        "text": "2nd twin shoulder presentation"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The <strong>second</strong> <strong>twin</strong>&nbsp;being in <strong>transverse</strong> lie is the only indication for <strong>internal</strong> <strong>version</strong> in modern obstetrics.</p>\n<p>In a twin pregnancy, if the first twin has vertex presentation, vaginal delivery can be performed. Following the&nbsp;vaginal delivery of the first twin, if the second twin is in transverse lie, it is corrected by <strong>external</strong> <strong>version</strong> (preferably cephalic) into a longitudinal lie. If external version fails and the <strong>membranes</strong> are <strong>intact</strong>, <strong>internal version</strong>&nbsp;is done under general anaesthesia, followed by <strong>breech</strong> <strong>extraction</strong>.&nbsp;</p>\n<p>If the membranes are <strong>ruptured</strong>, <strong>caesarean</strong> section is done immediately.</p>\n<p>Mode of delivery depends on the presentation of the 1st twin:</p>\n<table>\n<tbody>\n<tr>\n<td>Presentation of the 1st twin</td>\n<td>Mode of delivery</td>\n</tr>\n<tr>\n<td>Vertex</td>\n<td>Vaginal</td>\n</tr>\n<tr>\n<td>Breech</td>\n<td>Caesarean section</td>\n</tr>\n<tr>\n<td>Transverse</td>\n<td>Caesarean section</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Identify this condition.",
    "choices": [
      {
        "id": 1,
        "text": "Twin to Twin Transfusion Syndrome"
      },
      {
        "id": 2,
        "text": "Monochorionic diamniotic pregnancy"
      },
      {
        "id": 3,
        "text": "Monochorionic monoamniotic pregnancy"
      },
      {
        "id": 4,
        "text": "Dichorionic diamniotic pregnancy"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The box below describes the type of amnion and chorion seen in different types of twins depending on the time of division.</p>\n<table style=\"width: 909px;\">\n<tbody>\n<tr>\n<td style=\"width: 345.5px;\">Dizygotic twins</td>\n<td style=\"width: 546.5px;\">Dichorionic diamniotic</td>\n</tr>\n<tr>\n<td style=\"width: 345.5px;\">\n<p>Monozygotic twins- division occurs within</p>\n<p>0-4 days</p>\n<p>4-8 days</p>\n<p>8-12 days</p>\n<p>&gt;13 days</p>\n</td>\n<td style=\"width: 546.5px;\">\n<p>&nbsp;</p>\n<p>Dichorionic diamniotic</p>\n<p>Monochorionic diamniotic</p>\n<p>Monochorionic monoamniotic</p>\n<p>Monochorionic monoamniotic conjoined twins</p>\n</td>\n</tr>\n</tbody>\n</table>\n<p><br /><br /></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/299f93b512f2498693c743c9fa249349.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6faf0d666866408e88d09d1ca99e6b1fx382x566.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1828892d8b264029afc5e0f9fdde741ex1280x5795.JPEG"
    ]
  },
  {
    "text": "A pregnant woman was diagnosed with triplets on ultrasound. The obstetrician has planned to do a selective fetal reduction of one of the fetuses to improve the outcome of the pregnancy. What is the ideal timing and the method for the procedure?",
    "choices": [
      {
        "id": 1,
        "text": "10-13 weeks with intracardiac KCl"
      },
      {
        "id": 2,
        "text": "7-9 weeks with intracardiac KCl"
      },
      {
        "id": 3,
        "text": "14-16 weeks with intraumbilical KCl"
      },
      {
        "id": 4,
        "text": "9-12 weeks with intraumbilical KCl"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Selective fetal reduction</strong> is done between <strong>10-13 weeks</strong>&nbsp;via&nbsp;<strong>intracardiac</strong>&nbsp;injection of<strong> KCl</strong>.</p>\n<p>In multi-chorionic <strong>multifetal</strong> gestations, selective reduction of the <strong>smallest</strong> or <strong>anomalous</strong> fetus/fetuses is done to increase the chance of survival of the other fetuses.&nbsp;</p>\n<p><strong>Laser ablation</strong> or <strong>bipolar coagulation</strong> of the <strong>umbilical cord</strong>&nbsp;of the targeted fetus is done. This protects the surviving fetuses from the adverse effects of the drug.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 35-year-old primigravida who conceived after in-vitro fertilization therapy came for an antenatal checkup at 38 weeks of gestation. Her obstetric history revealed that she was pregnant with DCDA twins. On examination, the first twin was found to be in a breech position and the maternal blood pressure was found to be greater than 140/90 mm Hg on two occasions with grade 1+ proteinuria. What should be done next?",
    "choices": [
      {
        "id": 1,
        "text": "Monitor BP and terminate pregnancy if BP rises"
      },
      {
        "id": 2,
        "text": "Immediate Caesarean section"
      },
      {
        "id": 3,
        "text": "Terminate pregnancy at 40 weeks of gestation"
      },
      {
        "id": 4,
        "text": "Induce labour with PGE2 gel"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Immediate cesarean section</strong> is done as the <strong>first</strong> <strong>twin</strong> is in <strong>breech</strong> presentation. <strong>Uncomplicated dichorionic diamniotic twin</strong> pregnancies are terminated at <strong>38</strong> <strong>weeks</strong> of gestation.&nbsp;</p>\n<p><strong>Timing of delivery</strong> depends on the type of twin pregnancy:</p>\n<table>\n<tbody>\n<tr>\n<td>Type of twin pregnancy</td>\n<td>Timing of delivery</td>\n</tr>\n<tr>\n<td>Dichorionic diamniotic</td>\n<td>38 weeks</td>\n</tr>\n<tr>\n<td>Monochorionic diamniotic</td>\n<td>34 - 37 weeks + 6 days</td>\n</tr>\n<tr>\n<td>Monochorionic monoamniotic</td>\n<td>32 - 34 weeks by Caesarean section</td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;The <strong>mode&nbsp;of delivery</strong> depends on the 1st twin:</p>\n<table>\n<tbody>\n<tr>\n<td>1st twin presentation</td>\n<td>Mode of delivery</td>\n</tr>\n<tr>\n<td>Vertex</td>\n<td>Vaginal</td>\n</tr>\n<tr>\n<td>Breech</td>\n<td>Cesarean section</td>\n</tr>\n<tr>\n<td>Transverse</td>\n<td>Cesarean section</td>\n</tr>\n</tbody>\n</table>\n<p>After delivery of 1st twin, if the 2nd twin is in breech, assisted breech delivery is done. If the 2nd twin is in a transverse lie, the internal podalic version is done under GA in the OT followed by breech extraction.</p>\n<p><strong>Complications</strong> in attempting vaginal delivery in non-vertex presentation (i.e) transverse and breech:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Interlocking of twins</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Fetal head trapping above the cervix</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Umbilical cord prolapse</li>\n</ul>\n<p>According to ACOG criteria (2019), preeclampsia requires proteinuria of grade 2+ or more. In the case of pre-eclampsia, termination of pregnancy must be done at 37 weeks. According to the updated criteria, this patient does not have pre-eclampsia. Hence, a Caesarean section can be done at 38 weeks as for any uncomplicated DCDA twin pregnancy.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 26-year-old primigravida with dichorionic diamniotic twins presents to the clinic in active labor. The first twin is delivered vaginally but the second has a transverse lie. A trial of ECV was unsuccessful. What is not a complication of the procedure performed next for the delivery of the second twin?",
    "choices": [
      {
        "id": 1,
        "text": "Face presentation"
      },
      {
        "id": 2,
        "text": "Uterine atony"
      },
      {
        "id": 3,
        "text": "Uterine rupture"
      },
      {
        "id": 4,
        "text": "Vaginal laceration"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p class=\"p1\">The given clinical procedure is suggestive of&nbsp;<strong>internal podalic version</strong> for the second twin.&nbsp;<strong>Shoulder presentation</strong>, and not face presentation, is a <strong>complication</strong> of this procedure.</p>\n<p>The <strong>complications</strong> seen with internal podalic version are as follows:&nbsp;</p>\n<ul>\n<li><strong>Maternal</strong>-\n<ul>\n<li>Failure of the procedure</li>\n<li>Uterine rupture</li>\n<li>Vaginal and perineal trauma</li>\n<li>Placental abruption</li>\n<li>Postpartum haemorrhage</li>\n<li>Ascending infection</li>\n<li>Anaesthetic risks</li>\n</ul>\n</li>\n<li><strong>Fetal-</strong>\n<ul>\n<li>Cord prolapse</li>\n<li>Shoulder presentation with prolapsed arm</li>\n<li>Skeletal injury (femur, hips, humerus, skull)</li>\n<li>Visceral injury (kidney, liver, spleen)</li>\n<li>Neural injury (facial nerve)</li>\n<li>Hypoxic brain injury</li>\n<li>Death</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '17 Multifetal Pregnancy';
        const quizFilename = '17-multifetal-pregnancy-83c55343.html';
        let hierarchy = ["Marrow", "qBank", "Obstetrics & Gynecology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>