<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ini-Cet Mini - 12 (20 Q) - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2020-21
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Choose the correctly matched pair:",
    "choices": [
      {
        "id": 1,
        "text": "Cord compression - late deceleration"
      },
      {
        "id": 2,
        "text": "Fetal hypoxia - variable deceleration"
      },
      {
        "id": 3,
        "text": "Head compression - early deceleration"
      },
      {
        "id": 4,
        "text": "Placental insufficiency - variable deceleration"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>The early deceleration</strong> pattern on CTG implies <strong>fetal head compression</strong>.</p>\n<p>Following are the various types of decelerations seen on CTG and their clinical significance:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/615d59af23b043beb82d8eb1e3c96039x1279x1228.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d6f71edf8414457495d1f8c5dfed2be5x720x637.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6a2c45ce32174ab4b931958b7ae7cbccx1280x1092.JPEG"
    ]
  },
  {
    "text": "A college-going student presents to you with the rapidly increasing power of glasses due to progressive myopia. You also noticed the following sign, when the patient was asked to look in a downward gaze. The ophthalmic examination in this patient usually reveals all the following signs except _______",
    "choices": [
      {
        "id": 1,
        "text": "Oil droplet reflex"
      },
      {
        "id": 2,
        "text": "Scissoring reflex"
      },
      {
        "id": 3,
        "text": "Haab\u2019s striae"
      },
      {
        "id": 4,
        "text": "Munson\u2019s sign"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Haab's striae are not seen in keratoconus.</p>\n<p><strong>Haab\u2019s striae</strong>\u00a0are<strong>\u00a0tears and breaks in Descemet's membrane</strong>\u00a0seen in\u00a0<strong>Congenital glaucoma.</strong></p>\n<p>Keratoconus is a progressive disorder in which central or paracentral corneal stromal thinning occurs, accompanied by apical protrusion and irregular astigmatism. <strong>Vogt's striae are seen in the keratoconus.</strong></p>\n<p>Keratoconus presents with the features of rapidly increasing power of the glasses and localised bulging of the lower lid when the patient looks down.</p>\n<p>The signs seen in keratoconus:</p>\n<ul>\n<li><strong>Direct ophthalmoscopy</strong>\u00a0from a distance of half a meter shows a fairly well-delineated\u00a0<strong>oil droplet reflex</strong></li>\n<li><strong>Fleischer's ring</strong>: Iron deposition on the epithelium</li>\n<li><strong>Munson\u2019s Sign</strong>: V-shaped deformity of the lower lid on downward gaze (as shown in the image )</li>\n<li><strong>Scissoring reflex\u00a0</strong>in retinoscopy</li>\n<li><strong>Vogt\u2019s striae</strong><strong>:\u00a0 Vertical</strong>\u00a0(rarely horizontal) fine, whitish lines in the deep/posterior stroma and Descemet's membrane.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/98e6f13d67c649719d1a627330da9625.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A middle-aged man presents with progressive difficulty in swallowing both solids and liquids for 8 months. A barium swallow was done and is given below. Upper GI endoscopy was normal. Which of the following correctly describes the manometric evaluation of this disorder?",
    "choices": [
      {
        "id": 1,
        "text": "High IRP, peristalsis absent"
      },
      {
        "id": 2,
        "text": "Low IRP, peristalsis absent"
      },
      {
        "id": 3,
        "text": "High IRP, peristalsis present"
      },
      {
        "id": 4,
        "text": "Low IRP, peristalsis present"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario and barium swallow image showing a <strong>bird beak appearance</strong> is suggestive of <strong>achalasia cardia</strong>. It is characterized by <strong>high median IRP</strong> and <strong>absent peristalsis</strong>.</p>\n<p>Disorders of esophageal motility can be classified as:</p>\n<p><strong>Disorders of esophago-gastric junction (EGJ) outflow: elevated IRP</strong></p>\n<ul>\n<li><strong>Achalasia cardia</strong>: elevated IRP and <strong>peristalsis absent</strong></li>\n<li>EGJ outflow obstruction: elevated IRP and <strong>peristalsis present</strong></li>\n</ul>\n<p><strong>Disorders of peristalsis: normal IRP</strong></p>\n<ul>\n<li>Absent contractility</li>\n<li>Distal esophageal spasm</li>\n<li>Hypercontractile esophagus</li>\n</ul>\n<p>Achalasia cardia occurs due to the <strong>loss of inhibitory ganglion cells</strong> in the <strong>myenteric plexus</strong> of GIT. During swallowing, the food bolus normally triggers a <strong>primary peristaltic wave</strong>, which is responsible for carrying the bolus to the stomach. This is accompanied by <strong>relaxation of the lower esophageal sphincter</strong>&nbsp;<strong>(LES)</strong> to allow esophageal emptying into the stomach. Achalasia is characterized by a disruption of this normal process. <strong>Failure of relaxation of the LES</strong> causes an <strong>elevated median IRP</strong>. Moreover, there is a complete <strong>failure of peristalsis</strong>. The esophagus becomes progressively more tortuous, leading to <strong>megaesophagus</strong>.</p>\n<p>On <strong>upper GI scopy</strong>, achalasia can show accumulated saliva or food residue in the lower part of the esophagus, but is <strong>often reported normal</strong>. Upper GI scopy is an important investigation t<strong>o rule out a mechanical cause of progressive dysphagia, such as a malignancy</strong>. Barium contrast studies show a hold-up of the contrast material in the distal esophagus, giving rise to the<strong> bird beak appearance</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/50563eec3f1e40e2b52020b0cd36d292.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 50-year-old diabetic female patient presents to you with complaints of greenish nipple discharge for the past few months. Examination reveals the presence of discharge from multiple ducts with para-areolar lump and advised for mammography. Which of the following mammography findings, you would expect in this case?",
    "choices": [
      {
        "id": 1,
        "text": "Popcorn calcification"
      },
      {
        "id": 2,
        "text": "Broken-needle type of calcification"
      },
      {
        "id": 3,
        "text": "Lead-pipe calcification"
      },
      {
        "id": 4,
        "text": "Tea-cup calcification"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario is suggestive of <strong>duct ectasia</strong> and mammogram of a patient with duct ectasia shows typical <strong>Broken-needle type of calcification.\u00a0 </strong>This is\u00a0due to the calcification of debris within dilated ducts.</p>\n<p>Duct ectasia is the dilatation of breast ducts. It is the\u00a0<strong>most common cause</strong>\u00a0of nipple discharge in\u00a0<strong>nonlactating\u00a0</strong>women. This condition is associated with\u00a0<strong>smoking</strong>\u00a0and diabetes.</p>\n<p>The initial stage of this disease consists of dilatation of one or more lactiferous ducts. These ducts get filled with stagnant brown or\u00a0<strong>green colored secretions</strong>. In the later stages, the accumulation of fluid in the lactiferous ducts leads to infection and inflammation, causing\u00a0<strong>periductal mastitis</strong>. The infections are most often mixed infections of aerobic and anaerobic flora of the skin.</p>\n<p>Initial episodes can be managed with antibiotics. Recurrent episodes of the disease are best managed by\u00a0<strong>Hadfield operation.</strong></p>\n<p>Other options:</p>\n<ul>\n<li><strong>Popcorn calcification</strong> is seen in <strong>fibroadenoma</strong>.</li>\n<li><strong>Egg-shell calcification</strong> is seen in <strong>traumatic fat necrosis</strong>.</li>\n<li><strong>Tea-cup calcification</strong> is seen in <strong>fibrocystic disease</strong>.</li>\n</ul>\n<p><strong>Popcorn calcification:</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3616de605ca64c728ba3caf7cd107245.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/47a9fc6819e745b5bcebdb85e43f79fex630x520.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e6a5446052284594900f5e6b5d44e4fcx172x227.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b95f21ef2bb94751b0ebc6e6ae44f1bax841x1024.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7296ae6662c446cb8341bdf47f5057bbx512x559.PNG"
    ]
  },
  {
    "text": "A 60-year-old patient with atrial fibrillation complains of sudden onset weakness of the right lower limb, with urinary and faecal incontinence. MRI shows an ischaemic stroke involving the left anterior cerebral artery. Which of the following features would you not expect to see in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Ataxia"
      },
      {
        "id": 2,
        "text": "Prosopagnosia"
      },
      {
        "id": 3,
        "text": "Abulia"
      },
      {
        "id": 4,
        "text": "Paratonic rigidity"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Prosopagnosia</strong>, also called <strong>face blindness</strong>, is the inability to recognize faces including one's own image. This occurs due to occipitotemporal lobe damage, seen in <strong>posterior cerebral artery (PCA) </strong>strokes involving cortical branch occlusion. <br />It is not seen in anterior cerebral artery strokes.\u00a0</p>\n<p>The anterior cerebral artery (ACA) supplies parts of the frontal lobe, corpus callosum, paracentral lobule, and other deeper structures.</p>\n<p>Signs and symptoms of <strong>ACA occlusion</strong> and structures involved:</p>\n<ul>\n<li><strong>Urinary incontinence, fecal incontinence</strong></li>\n<li>Paratonic rigidity</li>\n<li>Abulia (Akinetic mutism), lack of spontaneity, slowness</li>\n<li>Gait impairment</li>\n<li><strong>Paralysis of contralateral foot and leg</strong></li>\n<li>Paresis of the contralateral arm</li>\n<li>Cortical sensory loss over the contralateral lower limb</li>\n<li>Dyspraxia of left limbs, tactile aphasia in left limbs.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Identify the gas represented by the pin index shown in the image below.",
    "choices": [
      {
        "id": 1,
        "text": "Oxygen"
      },
      {
        "id": 2,
        "text": "Nitrous oxide"
      },
      {
        "id": 3,
        "text": "Air"
      },
      {
        "id": 4,
        "text": "Carbon Dioxide"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given pin index of <strong>3, 5</strong> is specific for <strong>nitrous oxide</strong>.</p>\n<p>The Pin Index Safety System (PISS)&nbsp;facilitates the proper connection between a particular gas cylinder and the delivery system&nbsp;of the gases. It is designed to <strong>prevent incorrect connections</strong> between gas cylinders in the anesthesia workstation.</p>\n<p>The pin index of other gases is mentioned in the pearl below.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3519bc549f234fa9bcc8223e3926c63d.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "You are assisting a surgeon performing a hepatic surgery and during the procedure, you suddenly encounter a significant amount of bleeding. To control the blood loss,  where should the clamp be applied?",
    "choices": [
      {
        "id": 1,
        "text": "Coeliac artery"
      },
      {
        "id": 2,
        "text": "Hepatic vein"
      },
      {
        "id": 3,
        "text": "Porta hepatis"
      },
      {
        "id": 4,
        "text": "Falciform ligament"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The clamp&nbsp;will be applied at the <strong>porta hepatis</strong> to minimize the blood loss.</p>\n<p><strong>Pringle maneuver:</strong>&nbsp;Rapid control of the vessels entering the <strong>porta hepatis</strong> can be obtained by <strong>compressing</strong> them in the free edge of the <strong>lesser omentum.</strong></p>\n<p><strong>Porta hepatis</strong> is a deep, transverse fissure that is situated on the <strong>inferior surface</strong> of the <strong>right lobe</strong> of the liver.</p>\n<p>Structures <strong>entering</strong> at porta hepatis:</p>\n<ul>\n<li>Portal vein</li>\n<li>Hepatic artery</li>\n<li>Hepatic nervous plexus</li>\n</ul>\n<p>Structures <strong>exiting</strong> the porta hepatis:</p>\n<ul>\n<li>Right and left hepatic bile ducts</li>\n<li>Lymphatics</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3845b7675e6e41d79d8786f5069f6f0fx1280x1623.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b92a2238cfd147e5af0ce3986069ce23x1280x1117.JPEG"
    ]
  },
  {
    "text": "A 40-year-old male patient presents with pain in the right hypochondrium and fever. He is also having mild jaundice. ERCP showed linear smooth filling defects. Which among the following is the most probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Bile duct stone"
      },
      {
        "id": 2,
        "text": "Pancreatic duct stone"
      },
      {
        "id": 3,
        "text": "Worm in the biliary tree"
      },
      {
        "id": 4,
        "text": "Biliary structure"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical features and <strong>linear smooth filling defects on ERCP</strong> is suggestive of <strong>worm in the biliary tree.</strong></p>\n<p>The worm may also be seen as <strong>parallel filling defects -</strong>&nbsp;<strong>railway track sign</strong>.&nbsp;Worms in the gall-bladder appear as the long tubular coiled echogenic structure which may be rapidly mobile and is easier to diagnose than biliary ductal ascariasis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f73fcdf312b148238a8b2949512a6572x430x315.JPEG"
    ]
  },
  {
    "text": "Match the following.",
    "choices": [
      {
        "id": 1,
        "text": "A-2, B-4, C-1, D-3"
      },
      {
        "id": 2,
        "text": "A-1, B-4, C-3, D-2"
      },
      {
        "id": 3,
        "text": "A-3, B-1, C-4, D-2"
      },
      {
        "id": 4,
        "text": "A-4, B-3, C-2, D-1"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>A-1, B-4, C-3, D-2</strong> is the correct answer.</p>\n<table style=\"height: 254px;\" width=\"574\">\n<tbody>\n<tr>\n<td style=\"width: 136.5px;\"><strong>Type of Naevus</strong></td>\n<td style=\"width: 136.5px;\"><strong>Presentation</strong></td>\n<td style=\"width: 136.5px;\"><strong>Pathology</strong></td>\n<td style=\"width: 136.5px;\"><strong>Dermoscopy</strong></td>\n</tr>\n<tr>\n<td style=\"width: 136.5px;\">\n<div class=\"page\" title=\"Page 3633\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Congenital naevi</strong></p>\n</div>\n</div>\n</div>\n</div>\n</td>\n<td style=\"width: 136.5px;\">\n<div class=\"page\" title=\"Page 3633\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Light to dark\u2010brown colour, flat or elevated, with a smooth to verrucous surface with defined borders, coarse hair may be present</p>\n</div>\n</div>\n</div>\n</div>\n</td>\n<td style=\"width: 136.5px;\">\n<div class=\"page\" title=\"Page 3633\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Deeper naevus cells tend to extend deeply in relation to skin appendages</p>\n</div>\n</div>\n</div>\n</div>\n</td>\n<td style=\"width: 136.5px;\">\n<div class=\"page\" title=\"Page 3633\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Reticular, globular or mixed pattern;<br />milia\u2010like cysts, perifollicular hypo\u2010/ hyperpigmentation, black or brown dots/ globules and hypertrichosis may be present</p>\n</div>\n</div>\n</div>\n</div>\n</td>\n</tr>\n<tr>\n<td style=\"width: 136.5px;\">\n<div class=\"page\" title=\"Page 3633\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Junctional naevus</strong></p>\n</div>\n</div>\n</div>\n</div>\n</td>\n<td style=\"width: 136.5px;\">\n<div class=\"page\" title=\"Page 3633\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Uniformly pigmented</strong> brown <strong>macule</strong>, 2\u201310 mm in diameter</p>\n</div>\n</div>\n</div>\n</div>\n</td>\n<td style=\"width: 136.5px;\">\n<div class=\"page\" title=\"Page 3633\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Benign proliferation of melanocytes in the <strong>epidermis</strong></p>\n</div>\n</div>\n</div>\n</div>\n</td>\n<td style=\"width: 136.5px;\">\n<div class=\"page\" title=\"Page 3633\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Globular, reticular, structureless brown and mixed patterns</p>\n</div>\n</div>\n</div>\n</div>\n</td>\n</tr>\n<tr>\n<td style=\"width: 136.5px;\">\n<div class=\"page\" title=\"Page 3633\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Compound naevus</strong></p>\n</div>\n</div>\n</div>\n</div>\n</td>\n<td style=\"width: 136.5px;\">\n<div class=\"page\" title=\"Page 3633\">\n<div class=\"page\" title=\"Page 3633\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Pigmented in <strong>variable shades</strong> of brown, oval or round, symmetrical\u00a0<strong>papule\u00a0</strong></p>\n</div>\n</div>\n</div>\n</div>\n</div>\n</td>\n<td style=\"width: 136.5px;\">\n<div class=\"page\" title=\"Page 3633\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Benign proliferation of melanocytes in the <strong>epidermis</strong>, <strong>migrating into the dermis</strong> with the maturation of those cells in the deeper dermis</p>\n</div>\n</div>\n</div>\n</div>\n</td>\n<td style=\"width: 136.5px;\">\n<div class=\"page\" title=\"Page 3633\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Globular, reticular, structureless, brown, multicomponent and mixed patterns</p>\n</div>\n</div>\n</div>\n</div>\n\u00a0</td>\n</tr>\n<tr>\n<td style=\"width: 136.5px;\">\n<div class=\"page\" title=\"Page 3633\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<div class=\"page\" title=\"Page 3633\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Intradermal/ dermal naevus</strong></p>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</td>\n<td style=\"width: 136.5px;\">\u00a0\n<div class=\"page\" title=\"Page 3633\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Flesh\u2010coloured</strong>, <strong>dome\u2010shaped, exophytic</strong> <strong>papule or nodule</strong></p>\n</div>\n</div>\n</div>\n</div>\n</td>\n<td style=\"width: 136.5px;\">\u00a0\n<div class=\"page\" title=\"Page 3633\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Benign proliferation of melanocytes that migrated into the have <strong>dermis</strong> and matured there.\u00a0 There is <strong>no epidermal proliferation</strong></p>\n</div>\n</div>\n</div>\n</div>\n</td>\n<td style=\"width: 136.5px;\">\n<div class=\"page\" title=\"Page 3633\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Symmetrical homogeneous pattern; may have a slight pigmented globular pattern or black dots. Comedo\u2010like openings, crypts and comma vessels may be present</p>\n</div>\n</div>\n</div>\n</div>\n\u00a0</td>\n</tr>\n</tbody>\n</table>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1e918be8496c4e3a811abd9c344dab3dx1280x2069.8448519040903.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8268d849ef484fd4b63a2c56ad6ab42ex1280x1187.0239774330041.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/875f59d87b4946dcbeca63c0ceb16342x1280x1368.5250529287227.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8e12149b8b73498581f25f87cafb9a53x1280x1367.5599435825106.JPEG"
    ]
  },
  {
    "text": "A child with ambiguous genitalia was diagnosed with 21 hydroxylase deficiency. Choose the correct statements which can be mentioned to the concerned parents about the management of the condition.",
    "choices": [
      {
        "id": 1,
        "text": "1, 4 and 5"
      },
      {
        "id": 2,
        "text": "2, 3, and 4"
      },
      {
        "id": 3,
        "text": "2, 4, and 5"
      },
      {
        "id": 4,
        "text": "1, 3 and 5"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Statements 1, 4 and 5 are the correct statements about the treatment of Congenital adrenal hyperplasia due to 21 hydroxylase deficiency.</p>\n<p>Congenital adrenal hyperplasia <strong>(CAH)/adrenogenital syndrome</strong>&nbsp;is a family of <strong>autosomal-recessive</strong> disorders associated with the diminished synthesis of cortisol and aldosterone. The most common cause of ambiguous genitalia in a newborn is a classic&nbsp;21-hydroxylase deficiency.</p>\n<p>Virilization is usually apparent at birth in females and within 2 to 3 years of life in males.&nbsp;</p>\n<p>Management:</p>\n<p>Glucocorticoids are the <strong>mainstay</strong> of treatment and are continued <strong>indefinitely</strong> for those with the classical disease. It treats cortisol deficiency and also suppresses excessive production of androgens, minimizing excessive growth and skeletal maturation, and virilization. Patients with salt-wasting and virilizing forms are treated with hydrocortisone and fludrocortisone.</p>\n<div class=\"page\" title=\"Page 1699\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<div class=\"page\" title=\"Page 1699\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<div class=\"page\" title=\"Page 1699\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>During periods of <strong>stress</strong>- such as infections or surgery, <strong>double</strong> or <strong>triple doses</strong> are indicated.</p>\n<div class=\"page\" title=\"Page 1699\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Males with 21-hydroxylase deficiency who have had <strong>inadequate</strong> corticosteroid therapy may develop <strong>testicular adrenal rest tumors</strong>. These usually regress following increased steroid dosage.</p>\n<div class=\"page\" title=\"Page 1699\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Surgical treatment is usually done between <strong>2-6 months of age</strong> for significantly <strong>virilized</strong> females.&nbsp;</p>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 43-year-old lady presents to the OPD with complaints of pain in her left hand.  On examination, there is swelling and tenderness over the radial styloid. The test shown in the image below results in acute pain, resulting from the involvement of the structures marked as A and B. Identify the structures.",
    "choices": [
      {
        "id": 1,
        "text": "A- Abductor pollicis longus and B- Extensor pollicis brevis"
      },
      {
        "id": 2,
        "text": "A -Extensor pollicis longus and B- abductor pollicis brevis"
      },
      {
        "id": 3,
        "text": "A- Abductor pollicis brevis and B- Extensor pollicis brevis"
      },
      {
        "id": 4,
        "text": "A- Extensor pollicis brevis and B- abductor pollicis longus"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The probable diagnosis is\u00a0<strong>De Quervain's disease, </strong>which is a stenosing tenosynovitis of the extensor tendons of the first dorsal compartment, namely <strong>extensor pollicis brevis </strong>(marked as A) and<strong> abductor pollicis longus </strong>(marked as B). It is prominent among females, especially women of childbearing age.</p>\n<p>The image shows<strong> Eichhof's test</strong>: performed by asking the patient to place the thumb within their palm and clench it with the other fingers after which the wrist is passively ulnar flexed by the examiner.\u00a0</p>\n<p>It is positive in the following conditions:</p>\n<ul>\n<li>De Quervain's tenosynovitis</li>\n<li>Arthritis in the intercarpal\u00a0and radiocarpal joints</li>\n<li>Superficial radial nerve entrapment\u00a0</li>\n<li>Intersection syndrome- A tenosynovitis occurring due to friction between the obliquely placed extensor and abductor pollicis tendons, and the\u00a0longitudinally placed extensor tendons.</li>\n</ul>\n<p>Other clinical features of De Quervain's disease include visible swelling over the radial styloid, palpable thickening of the tendon sheath, tenderness at the tip of the radial styloid and pain on resisted thumb extension (hitch-hiker\u2019s sign).</p>\n<p><strong>Treatment</strong>:</p>\n<ul>\n<li>The majority of the patients are treated conservatively with steroid injection and splinting.</li>\n<li style=\"font-weight: 400;\">Few require surgical release of the 1st dorsal compartment (housing the APL and EPB tendons).</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/90f739cee2c34a7cb8b7c504f4d766bb.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f9866c2d934744fa90e1c2da890673c0x1280x1492.JPEG"
    ]
  },
  {
    "text": "A patient with erectile dysfunction did not respond to PDE-5 inhibitor drugs. A second-line treatment involves the injection of prostaglandin into the part of the penis marked as X in the image below. Which is the prostaglandin used?",
    "choices": [
      {
        "id": 1,
        "text": "PGE2"
      },
      {
        "id": 2,
        "text": "PGI2"
      },
      {
        "id": 3,
        "text": "PGE1"
      },
      {
        "id": 4,
        "text": "PGF2\u03b1"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The part marked as X in the image is the <strong>corpus cavernosum</strong> and prostaglandin\u00a0indicated for direct intracavernosal injection for erectile dysfunction is<strong>\u00a0PGE1- Alprostadil.</strong></p>\n<p>It is a natural PGE1 preparation available as an intraurethral suppository and intracavernosal injection. It is usually <strong>used in patients who are not responding to PDE-5 inhibitors</strong> such as those with neurogenic and psychogenic erectile dysfunction.</p>\n<p><strong>Side effects</strong> of alprostadil include pain, bruising, and <strong>priapism</strong>. If priapism occurs, the patient will need urgent medical attention, which might include aspiration of blood, surgical shunt, or intracavernosal injection of phenylephrine for cavernosal vasoconstriction.</p>\n<p>Alprostadil is<strong> also</strong> used for<strong> temporarily</strong> maintaining the <strong>patency</strong> of a <strong>patent ductus arteriosus in neonates</strong>.</p>\n<p>Management of Erectile dysfunction:</p>\n<ul>\n<li>Lifestyle modifications</li>\n<li><strong>First-line</strong> pharmacological therapy consists of<strong> PDE-5 inhibitors like sildenafil, vardenafil, tadalafil</strong>.\n<ul>\n<li>Common side effects include headache, flushing, dyspepsia, nasal congestion, dizziness, and back pain. Blue green-tinted vision and blurred vision may be experienced with sildenafil and vardenafil. Priapism leading to ischemia may also occur.</li>\n<li><strong>PDE5 inhibitors potentiate the hypotensive effects</strong> of nitrates, leading to hypotension. It is contraindicated in patients receiving organic nitrates.</li>\n<li>CYP3A inhibitors (e.g., protease inhibitors, erythromycin, and cimetidine) inhibit the metabolism of PDE5 inhibitors and elevate their blood levels.</li>\n</ul>\n</li>\n<li><strong>Vacuum erection devices</strong>:\u00a0A cylindrical device placed over the penis and then pumped. It creates a negative pressure vacuum to draw blood into the penis. Side effects include\u00a0petechiae, hematomas, grey-blue color to the penis.</li>\n<li><strong>Second-line</strong> therapy:\n<ul>\n<li><strong>Intracavernosal injection</strong> (ICI) of vasoactive substances like\u00a0<strong>prostaglandin E1</strong>, papaverine, and phentolamine. They work alone or in combination to elicit an erection.\u00a0Prostaglandin PGE<sub>1</sub>\u00a0has been approved by the FDA as a single-agent ICI for erectile dysfunction to increase cAMP levels.</li>\n<li><strong>Intraurethral suppository of a prostaglandin E1</strong>: Can be inserted into the urethra before intercourse.\u00a0</li>\n</ul>\n</li>\n<li><strong>Surgical methods</strong>: Penile implants and penile revascularization.\u00a0</li>\n</ul>\n<p>Other Prostaglandins/ Prosatglandin analogs:</p>\n<ul>\n<li><strong>PGE1 analog</strong>: <strong>Misoprostol</strong> is approved for termination of pregnancy, and the prevention of NSAID induced gastric ulcers.</li>\n<li><strong>PGE2</strong>: <strong>Dinoprostone</strong> is used for cervical ripening, induction of labor, and as abortifacients in the second trimester of pregnancy.</li>\n<li><strong>PGI2</strong>: <strong>Epoprostenol</strong> improves symptoms and delays the need for lung or heart-lung transplantation in Pulmonary artery hypertension.</li>\n<li><strong>PGI2 analogs</strong>:\u00a0<strong>Iloprost</strong> and\u00a0<strong>Treprostinil\u00a0</strong>used in the management of pulmonary artery hypertension.</li>\n<li><strong>PGF2\u03b1</strong>: <strong>Carboprost</strong> is used to induce second-trimester abortions and to control postpartum hemorrhage. <strong>Latanoprost</strong> is a long-acting PGF2\u03b1 derivative, used for glaucoma. Similar prostanoids with ocular hypotensive effects include <strong>bimatoprost, tafluprost, </strong>and<strong> travoprost</strong>.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/17baf81019f9425e80405ae7f6728f40.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A patient admitted for hemoptysis experienced a bout of coughing, during which his blood-stained secretions came in contact with the nurse's eyes. On further probing, the patient revealed that he had been on antiretroviral therapy for 1 year. Identify the incorrect statements about post-exposure prophylaxis in this case.",
    "choices": [
      {
        "id": 1,
        "text": "1, 2, 4"
      },
      {
        "id": 2,
        "text": "1, 4, 5"
      },
      {
        "id": 3,
        "text": "2, 3, 4"
      },
      {
        "id": 4,
        "text": "1 and 5"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>1, 4 and 5 are the incorrect statements.</p>\n<p>Post Exposure Prophylaxis (PEP) for HIV should be initiated as early as possible, to all individuals with exposure&nbsp;<strong>ideally within 2 hours</strong> (<strong>but certainly within the first 72 hours</strong>) of exposure.</p>\n<p>Exposures that may warrant occupational PEP include:</p>\n<p>Parenteral or mucous membrane exposure (splashes to the eye, nose, or oral cavity. The following bodily fluids may pose a risk of HIV infection: blood, blood-stained saliva, breast milk, genital secretions, and cerebrospinal, amniotic, rectal, peritoneal, synovial, pericardial, or pleural fluids.</p>\n<p>Exposures that do not require PEP include:</p>\n<ul>\n<li>When the exposed individual is already HIV-positive</li>\n<li>When the source is established to be HIV-negative</li>\n<li>Exposure to bodily fluids that do not pose a significant risk: tears, non-blood-stained saliva, urine, and sweat.</li>\n</ul>\n<p><strong>3 drug PEP</strong> regimen is given irrespective of percutaneous or mucous membrane exposure and irrespective of mild, moderate or severe exposure. It is as follows:</p>\n<table style=\"height: 154px; width: 563px;\">\n<tbody>\n<tr>\n<td style=\"width: 234px;\">&nbsp; &nbsp; &nbsp; &nbsp; Drug combination</td>\n<td style=\"width: 223.978271484375px;\">&nbsp; Recommendation for PEP</td>\n<td style=\"width: 173.021728515625px;\">&nbsp; &nbsp; &nbsp; &nbsp; Duration</td>\n</tr>\n<tr>\n<td style=\"width: 234px;\">Tenofovir (TDF) 300 mg + Lamivudine(3TC) 300 mg + Dolutegravir (DTG) 50mg</td>\n<td style=\"width: 223.978271484375px;\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Once daily</td>\n<td style=\"width: 173.021728515625px;\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;4 weeks</td>\n</tr>\n</tbody>\n</table>\n<div class=\"page\" title=\"Page 39\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>DTG is recommended as the preferred third drug for HIV post-exposure prophylaxis.&nbsp;When available, ATV/r, DRV/r, LPV/r and RAL may be considered as alternative third drug options for post-exposure prophylaxis.</p>\n<p>Follow up: HIV antibody testing should be done for <strong>at least 6 months post-exposure</strong> (e.g. at baseline, 6 weeks, 3 months, and 6 months) to ensure no transmission has occurred. Blood donation should be avoided while the individual is taking PEP, and while still in the<strong> window period</strong> for HIV acquisition and testing.</p>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Identify the true statement about a polypeptide growth factor with an insulin-like activity. It is diminished or absent in African pygmies leading to the hereditary short stature.",
    "choices": [
      {
        "id": 1,
        "text": "Levels peak at puberty"
      },
      {
        "id": 2,
        "text": "It is produced in the choroid plexus"
      },
      {
        "id": 3,
        "text": "It has a short half life as it is tightly bound"
      },
      {
        "id": 4,
        "text": "Secretion is dependent on growth hormone in fetus"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<div class=\"page\" title=\"Page 900\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>The pygmies of Africa have a small stature due to the congenital inability to synthesize significant amounts of <strong>somatomedin C </strong>or<strong> IGF-1,&nbsp;</strong>the levels of which <strong>peak at puberty</strong>.</p>\n<div class=\"page\" title=\"Page 332\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Somatomedins</strong> are polypeptide growth factors secreted by the <strong>liver</strong> and other tissues, under the influence of growth hormone (GH). The only circulating somatomedins is insulin-like growth factor I (<strong>IGF-I, somatomedin C</strong>) and <strong>IGF-II</strong>.&nbsp;They are tightly bound to plasma proteins, <strong>prolonging</strong> their half-life in the circulation, with a longer duration of action than growth hormone. (Half-life is around <strong>20 hours</strong>, compared to that of GH which is 20 minutes)</p>\n<p><strong>IGF-I</strong> secretion is<strong> independent</strong> of growth hormone before birth but is stimulated by growth hormone <strong>after birth</strong>. Its levels rise in plasma during childhood, reach a <strong>peak at puberty</strong>, and then decline to <strong>low</strong> levels in <strong>old age</strong>. Some effects of IGF-1 are:</p>\n<ul>\n<li>Bone and cartilage growth</li>\n<li>Protein synthesis</li>\n<li>Insulin-like activity</li>\n<li>Anti lipolytic activity</li>\n</ul>\n<p>Clinical significance:</p>\n<ul>\n<li><strong>African pygmies</strong>: Normal growth hormone levels, a slight reduction in growth hormone-binding protein levels. Congenital inability to synthesize significant amounts of plasma <strong>IGF-I</strong> and concentration <strong>fails to increase at puberty</strong>.</li>\n<li>Growth hormone insensitivity or <strong>Laron dwarfism</strong>: Plasma <strong>IGF-I</strong> and its<strong> binding protein</strong> are<strong> reduced</strong> in this type of dwarfism</li>\n</ul>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The image given below is the structure of aggrecan, which is the principal proteoglycan found in cartilage. Identify the three glycosaminoglycans which are labeled as A, B, and C respectively.",
    "choices": [
      {
        "id": 1,
        "text": "Hyaluronic acid, keratan sulfate, and chondroitin sulfate"
      },
      {
        "id": 2,
        "text": "Chondroitin sulfate, dermatan sulfate, and keratan sulfate"
      },
      {
        "id": 3,
        "text": "Hyaluronic acid, keratan sulfate, and heparan sulfate"
      },
      {
        "id": 4,
        "text": "Heparan sulfate, chondroitin sulphate, and keratan sulfate"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Aggrecan</strong>\u00a0contains glycosaminoglycans\u00a0<strong>hyaluronic acid, chondroitin sulfate, </strong>and<strong> keratan sulfate</strong> along with link and core proteins. It is the principal proteoglycan found in cartilage.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/1bc37520168f427d9b3f4f9f606d2705.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ba9d2dbba065459ab6adee3b3054f996x1280x1125.6417489421722.JPEG"
    ]
  },
  {
    "text": "Match the following innate immunity receptors with the products that they detect:",
    "choices": [
      {
        "id": 1,
        "text": "A-1, B-2, C-3, D-4"
      },
      {
        "id": 2,
        "text": "A-4, B-3, C-2, D-1"
      },
      {
        "id": 3,
        "text": "A-3, B-1, C-2, D-4"
      },
      {
        "id": 4,
        "text": "A-2, B-3, C-4, D-1"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The correct answer is <strong>A-3, B-1, C-2, D-4</strong></p>\n<p><strong><span data-preserver-spaces=\"true\">RIG-like receptors (RLRs),</span></strong><span data-preserver-spaces=\"true\">&nbsp;are present in the&nbsp;</span><strong><span data-preserver-spaces=\"true\">cytosol</span></strong><span data-preserver-spaces=\"true\">&nbsp;of a majority of cells and&nbsp;</span><strong><span data-preserver-spaces=\"true\">detect nucleic acids of viruses</span></strong><span data-preserver-spaces=\"true\">&nbsp;that replicate in the cytoplasm of the infected cells. These receptors also stimulate the production of&nbsp;</span><strong><span data-preserver-spaces=\"true\">antiviral cytokines.</span></strong></p>\n<p><strong><span data-preserver-spaces=\"true\">Mannose receptors&nbsp;</span></strong><span data-preserver-spaces=\"true\">recognize&nbsp;</span><strong><span data-preserver-spaces=\"true\">microbial sugars</span></strong><span data-preserver-spaces=\"true\">&nbsp;which contain&nbsp;</span><strong><span data-preserver-spaces=\"true\">terminal mannose residues</span></strong><span data-preserver-spaces=\"true\">&nbsp;and induce phagocytosis of these microbes.</span></p>\n<p><strong>C-type lectin receptors (CLRs):&nbsp;</strong>Expressed on the plasma membrane of macrophages and dendritic cells. Detect <strong>fungal glycans</strong> and elicit inflammatory reactions to fungi.</p>\n<p><strong><span data-preserver-spaces=\"true\">NOD-like receptors (NLRs</span></strong><span data-preserver-spaces=\"true\">) are present in the&nbsp;</span><strong><span data-preserver-spaces=\"true\">cytosol</span></strong><span data-preserver-spaces=\"true\">, which recognize&nbsp;</span><strong><span data-preserver-spaces=\"true\">uric acid</span></strong><span data-preserver-spaces=\"true\">&nbsp;and&nbsp;</span><strong><span data-preserver-spaces=\"true\">released ATP</span></strong><span data-preserver-spaces=\"true\">&nbsp;(products of necrotic cells),&nbsp;</span><strong><span data-preserver-spaces=\"true\">ion disturbances</span></strong><span data-preserver-spaces=\"true\">&nbsp;(like loss of K+), and a few&nbsp;</span><strong><span data-preserver-spaces=\"true\">microbial products</span></strong><span data-preserver-spaces=\"true\">.</span></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following Anti-arrhythmic drugs cause potassium channel blockade?",
    "choices": [
      {
        "id": 1,
        "text": "3 and 4 only"
      },
      {
        "id": 2,
        "text": "1, 2 and 5 only"
      },
      {
        "id": 3,
        "text": "1 and 4 only"
      },
      {
        "id": 4,
        "text": "2, 3 and 5 only"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The correct option is <strong>1, 2, and 5 only</strong>.</p>\n<p><strong class=\"ng-binding\">Anti-arrhythmic drugs:\u00a0</strong>Class<strong> III</strong>: K+ Channel Blocker: Increase refractory period (prolong QT)</p>\n<p>Examples: Amiodarone, Sotalol, Ibutilide,\u00a0Dronedarone,\u00a0Dofetilide.</p>\n<p>Other options:\u00a0</p>\n<p>Flecainide and\u00a0Propafenone are a\u00a0<strong>Class IC\u00a0</strong>Anti-arrhythmic drug.\u00a0</p>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 72-year-old woman who was treated for COVID-19 one month back now presents with a black, foul-smelling discharge from the nose and suppuration of the left eye as shown below. There is significant visual impairment. On examination, there is a blackish necrotic mass filling the nasal cavity and eroding the septum and hard palate. Considering the suspected diagnosis, which of the following investigations would be done in her case?",
    "choices": [
      {
        "id": 1,
        "text": "1,3 beta D Glucan assay"
      },
      {
        "id": 2,
        "text": "Culture on Sabouraud's agar"
      },
      {
        "id": 3,
        "text": "Galactomannan assay"
      },
      {
        "id": 4,
        "text": "Enzyme immunoassay (EIA)"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><span data-preserver-spaces=\"true\">The given clinical scenario is suggestive of</span><strong><span data-preserver-spaces=\"true\">&nbsp;Mucormycosis.</span></strong>&nbsp;It can be isolated and cultured on<strong><span data-preserver-spaces=\"true\"> Sabouraud's agar for diagnosis.</span></strong></p>\n<p><span data-preserver-spaces=\"true\">Mucormycosis is an opportunistic infection caused principally by species of <strong>rhizopus, mucor,</strong> and<strong> lichtheimia</strong>. Among them, the most prevalent species are&nbsp;<strong>Rhizopus oryzae </strong>and <strong>R. delemar. </strong>It is&nbsp;seen in patients with <strong>diabetes mellitus</strong>, leukemias, lymphomas, long-term corticosteroid use, severe burns, and immunodeficiencies. </span></p>\n<p><span data-preserver-spaces=\"true\">The common clinical form is <strong>rhino-orbital-cerebral mucormycosis</strong> in which there is an <strong>invasion of the blood vessels</strong> in the nasal cavity, eyes, and brain causing thrombosis, infarction, and necrosis. They invade the tissues of patients with reduced host defense. From there, they enter the blood vessels and proliferate in the walls of blood vessels particularly paranasal sinuses and orbit.</span>&nbsp;<span data-preserver-spaces=\"true\">The <strong>blackish discoloration</strong> is due to arterial and venous <strong>thrombosis</strong> leading to gangrene.</span></p>\n<p><span data-preserver-spaces=\"true\"><strong>Invasive Mucormycosis</strong>&nbsp;has recently emerged as a life-threatening complication of COVID-19 in India. It is an opportunistic infection seen even in mild to moderate COVID patients with strong predisposing factors like hyperglycemia/uncontrolled diabetes. Diabetic patients receiving corticosteroids/immunosuppressants for COVID-19 treatment are exceptionally vulnerable to develop mucormycosis due to the risk of steroid-induced hyperglycemia.</span></p>\n<p><span data-preserver-spaces=\"true\"><strong>Diagnosis</strong>-&nbsp;</span>They can be stained with 10% potassium hydroxide and can be cultured. On Sabouraud agar at 30-37&deg;C<span class=\"s1\">, they appear as</span>&nbsp;<strong>grey-white&nbsp;colonies</strong> with a <strong>thick cottony<span class=\"s1\">, </span>fluffy surface</strong>. Under the microscope<span class=\"s1\">, they appear as&nbsp;</span><strong>nonseptate<span class=\"s1\">, irregularly branched&nbsp;</span>broad hyphae</strong> with aerial sporangiophores which end in a sporangium (a sac containing spores<span class=\"s1\">).&nbsp;</span></p>\n<p>Important aspects in the management of mucormycosis involve</p>\n<ul>\n<li>Initiation of antifungal therapy-&nbsp;<strong>Amphotericin B</strong>&nbsp;is the first line, antifungal agent. Other antifungal agents used are&nbsp;<strong>isavuconazole and posaconazole</strong></li>\n<li><strong>Treat</strong>ment of the&nbsp;<strong>underlying risk factors</strong></li>\n<li><strong>Surgical debridement</strong></li>\n</ul>\n<p><span data-preserver-spaces=\"true\">The below image shows broad aseptate and irregularly branched hyphae seen in mucormycosis</span></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/2d6c76d4a1834bc791d653d9c39bf915.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2b86dff074a84104877d8f4aea65ae46x800x600.JPEG"
    ]
  },
  {
    "text": "In a road traffic accident, a pedestrian was hit and he suffered the following injuries. Which of these sustained injuries are most likely to be secondary injuries?",
    "choices": [
      {
        "id": 1,
        "text": "1,3, and 5 only"
      },
      {
        "id": 2,
        "text": "2 and 4 only"
      },
      {
        "id": 3,
        "text": "2 and 3 only"
      },
      {
        "id": 4,
        "text": "1, 4 and 5 only"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The correct option is <strong>2 and 3 only.</strong></p>\n<ul>\n<li>Fractures of tibia and fibula- (Bumper injury: <strong>primary impact</strong> injury)</li>\n<li>Tire marks on the body- (<strong>secondary</strong> injuries)</li>\n<li>Head injury- (most common <strong>secondary</strong> injury)</li>\n<li>Lacerations by\u00a0particles of the broken windshield- (<strong>secondary impact</strong> injury)</li>\n<li>Patterned injuries of the radiator grill- (<strong>primary impact</strong> injury)</li>\n</ul>\n<p>Injuries to pedestrians:</p>\n<ul>\n<li><strong>Primary impact injuries</strong> are caused by the first impact of the vehicle on the victim. Eg: injuries produced are patterned injuries, and are due to the bumper, <strong>radiator grill</strong>, headlights, etc.</li>\n<li><strong>Secondary impact injuries</strong> are further injuries caused by the vehicle. Eg: Particles of the broken windshield, parts of the bonnet, etc. can produce contusions, <strong>lacerations</strong>, etc</li>\n<li><strong>Tertiary impact injuries (</strong><em>synonyms:</em><strong>\u00a0Secondary injuries)</strong>\u00a0are caused when the victim strikes other objects or falls on the ground after being hit by the vehicle. Eg:\u00a0<strong>Head injuries</strong> are the most common injuries of this group,\u00a0crush injuries, <strong>Tire marks</strong> seen on the body.</li>\n</ul>\n<p><strong>A note to clear the confusion:</strong> The question is asking for <strong>Secondary injuries</strong>, which is also called<strong> Tertiary <em>impact</em></strong> injuries, which happens when the victim strikes the ground. <strong>Secondary<em> impact</em></strong> injuries are the impact injuries caused by the vehicle apart from primary impact injuries. For example, lacerations produced by\u00a0particles of the broken windshield, in this case.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8993d8ac8f7949df8df87f2c2dd5bf36x1280x2559.0973201692523.JPEG"
    ]
  },
  {
    "text": "A 50-year-old lady was diagnosed with maxillary carcinoma. While explaining the prognosis of the condition, the doctor draws a line stating that tumors situated below the line have a better prognosis than those above. Which landmarks are used to draw this line?",
    "choices": [
      {
        "id": 1,
        "text": "Ala to tragus"
      },
      {
        "id": 2,
        "text": "Medial canthus to angle of manidble"
      },
      {
        "id": 3,
        "text": "Floor of the orbit to floor of antrum"
      },
      {
        "id": 4,
        "text": "Anterior semicircular canal to posterior semicircular canal"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The line used for the classification of maxillary carcinomas as described in the clinical vignette is <strong>Ohngren&rsquo;s line, which</strong>&nbsp;passes through the&nbsp;<strong>medial canthus of the eye&nbsp;</strong>and&nbsp;<strong>angle of the mandible</strong>. This classification is known as&nbsp;<strong>Ohngren&rsquo;s classification</strong>.</p>\n<ul>\n<li>Growth situated&nbsp;<strong>above</strong>&nbsp;the plane - Suprastructure<strong>&nbsp;- Poor Prognosis</strong></li>\n<li>Growth situated&nbsp;<strong>below</strong>&nbsp;the plane - Infrastructure<strong>&nbsp;- Good Prognosis</strong></li>\n</ul>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f2672f9fb2784571847b9e8b4118f8f1x1280x1712.3836389280677.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b7eceb6e86da40e393e5bc3f7e064319x1280x1424.428772919605.JPEG"
    ]
  }
];
        let quizName = 'Ini-Cet Mini - 12 (20 Q)';
        const quizFilename = 'ini-cet-mini-12-20-q-f7fa9df3.html';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2020-21"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>