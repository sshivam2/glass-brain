<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>23 Anaesthetic Implication Of Concurrent Diseases - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Anesthesia
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">32</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following agents is to be avoided in a hypertensive patient?",
    "choices": [
      {
        "id": 1,
        "text": "Thiopentone"
      },
      {
        "id": 2,
        "text": "Propofol"
      },
      {
        "id": 3,
        "text": "Ketamine"
      },
      {
        "id": 4,
        "text": "Etomidate"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p style=\"text-align: justify;\"><strong>Ketamine</strong>&nbsp;is avoided in a hypertensive patient as it has <strong>intrinsic sympathomimetic properties </strong>and hence can aggravate hypertension.</p>\n<p style=\"text-align: justify;\">Ketamine increases arterial blood pressure, heart rate, and cardiac output. This is due to <strong>central stimulation </strong>of the<strong> sympathetic nervous system </strong>and <strong>inhibition </strong>of the<strong> reuptake of norepinephrine</strong>. And hence it should be cautiously used in patients with uncontrolled hypertension, coronary artery disease, congestive heart failure and arterial aneurysms.</p>\n<p style=\"text-align: justify;\">Its stimulatory effects may be beneficial to patients with<strong> acute shock.&nbsp;</strong>All other intravenous induction agents like propofol, thiopentone and etomidate produce a fall in blood pressure.</p>\n<p style=\"text-align: justify;\">&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following muscle relaxants should be avoided in a hypertensive patient?",
    "choices": [
      {
        "id": 1,
        "text": "Pancuronium"
      },
      {
        "id": 2,
        "text": "Rocuronium"
      },
      {
        "id": 3,
        "text": "Vecuronium"
      },
      {
        "id": 4,
        "text": "Atracurium"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Pancuronium is avoided in hypertensive patients because it causes <strong>vagal blockade </strong>and<strong> sympathetic stimulation</strong> which&nbsp;can aggravate&nbsp;hypertension.</p>\n<p>For the same reason, it is to be cautiously used in patients with-</p>\n<ul>\n<li>Coronary artery disease</li>\n<li>Hypertrophic cardiomyopathy</li>\n<li>Aortic stenosis.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 4-year-old child is observed to have difficulty in breathing along with bluish discolouration of his lips and fingers while playing. It improves on adopting a knee-chest position. Which is the ideal induction agent of choice used for surgical correction of the condition suffered by this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Thiopentone"
      },
      {
        "id": 2,
        "text": "Propofol"
      },
      {
        "id": 3,
        "text": "Etomidate"
      },
      {
        "id": 4,
        "text": "Ketamine"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p style=\"text-align: justify;\"><strong>Ketamine</strong> is the induction agent of choice in this patient who is likely suffering from <strong>tetralogy of Fallot</strong> because it maintains or <strong>increases systemic vascular resistance </strong>and<strong> increases cardiac output. </strong></p>\n<p style=\"text-align: justify;\">Tetralogy of Fallot is characterized by sub pulmonic stenosis, right ventricular hypertrophy, ventricular septal defect and overriding of the aorta. This results in a <strong>right to left shunt</strong> through the ventricular septal defect and consequent cyanosis.</p>\n<p style=\"text-align: justify;\">The commonest symptoms are <strong>dyspnea on exertion</strong> and exercise intolerance and develop <strong>blue skin&nbsp;</strong>(cyanosis) when agitated and are known as <strong>tet spells</strong>. The patients assume a <strong>sitting posture (squatting) </strong>or <strong>knee-chest position</strong> as soon as they get dyspneic, which leads to <strong>temporary symptomatic relief.</strong></p>\n<p style=\"text-align: justify;\">Ketamine&nbsp;<strong>does not aggravate </strong>the<strong> right to left shunt</strong> seen in such cases. It also does not increase pulmonary vascular resistance in children as compared to adults and is hence safe to administer in children.</p>\n<p style=\"text-align: justify;\">Ketamine is the agent of choice in all cyanotic congenital heart diseases.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A child with a wide fixed split S2 on auscultation has been scheduled for a surgical repair for the condition. Which of the following is the inhalational agent of choice for induction in this procedure?",
    "choices": [
      {
        "id": 1,
        "text": "Desflurane"
      },
      {
        "id": 2,
        "text": "Sevoflurane"
      },
      {
        "id": 3,
        "text": "Isoflurane"
      },
      {
        "id": 4,
        "text": "Halothane"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p style=\"text-align: justify;\"><strong>Wide fixed split S2</strong> is suggestive of <strong>atrial septal defect (ASD) </strong>and <strong>sevoflurane</strong> is the\u00a0<strong>inhalational agent of choice</strong> for induction in a child undergoing <strong>cardiac surgery</strong>.</p>\n<p style=\"text-align: justify;\">Halothane and sevoflurane are non-pungent and hence can be used for induction in pediatric patients. Sevoflurane is not associated with significant myocardial depression as is seen with halothane. Hence, sevoflurane is preferred over halothane especially in all cardiovascular surgeries in the paediatric age group.</p>\n<div class=\"page\" title=\"Page 486\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p style=\"text-align: justify;\">Following induction, isoflurane and sevoflurane are the most commonly used inhalation agents for maintenance.</p>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient with severe aortic stenosis is posted for surgery. Which is the preferred anaesthetic technique used for this procedure?",
    "choices": [
      {
        "id": 1,
        "text": "General anesthesia"
      },
      {
        "id": 2,
        "text": "Spinal anesthesia"
      },
      {
        "id": 3,
        "text": "Epidural anesthesia"
      },
      {
        "id": 4,
        "text": "Intercostal nerve block"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p style=\"text-align: justify;\"><strong>General anaesthesia</strong> is preferred in patients with severe aortic stenosis.</p>\n<p style=\"text-align: justify;\">Spinal and epidural anaesthesia are <strong>relatively </strong>contraindicated. This is because <strong>regional anaesthesia</strong> produces&nbsp;profound hypotension which can lead to<strong>&nbsp;</strong>a<strong> fall in preload, afterload or both.</strong></p>\n<p style=\"text-align: justify;\">Most general anaesthetics especially the volatile agents also cause vasodilation and hypotension which can be treated with escalating doses of vasopressors like phenylephrine.</p>\n<p style=\"text-align: justify;\"><strong>Mild to moderate aortic stenosis</strong> are not contraindications to regional anaesthesia. In such situations, <strong>epidural anaesthesia</strong> is<strong> preferred over spinal</strong> because of its slower onset of hypotension which can be adequately corrected.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You are conducting the pre-anesthetic checkup for a patient who is scheduled for an elective cholecystectomy. He is a known hypertensive being treated with the following drugs. Which of the following drugs should be discontinued 24 hours before the procedure?",
    "choices": [
      {
        "id": 1,
        "text": "Calcium channel blocker"
      },
      {
        "id": 2,
        "text": "Centrally acting sympathomimetics"
      },
      {
        "id": 3,
        "text": "Beta blocker"
      },
      {
        "id": 4,
        "text": "ACE inhibitor"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The anti-hypertensive that is discontinued&nbsp;24hours before surgery is <strong>ACE inhibitor</strong> due to the <strong>risk of hemodynamic instability.</strong></p>\n<p>Although the continuation of ACE inhibitors or ARBs is controversial, among the given options this is the best answer. If these drugs are continued, vasopressin is the drug of choice for refractory hypotension.</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "During recovery from anaesthesia after a posterior cranial fossa surgery, the patient complained of a severe headache and was agitated. CT scan showed intracranial air accumulation. Which of the following agents is most likely responsible for this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Oxygen"
      },
      {
        "id": 2,
        "text": "Nitrous oxide"
      },
      {
        "id": 3,
        "text": "Desflurane"
      },
      {
        "id": 4,
        "text": "Sevoflurane"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given case scenario is suggestive of <strong>pneumocephalus</strong> and&nbsp;<strong>nitrous oxide</strong> is responsible for causing this condition.</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An awake craniotomy is being performed on a patient when there is a sudden drop in his blood pressure. The surgeon is suspecting a complication of venous air embolism (VAE). Which of the following is true about the condition?",
    "choices": [
      {
        "id": 1,
        "text": "All VAE can be detected clinically by a decrease in end tidal carbon dioxide"
      },
      {
        "id": 2,
        "text": "A decrease in oxygen saturation will not always be seen, even with larger emboli"
      },
      {
        "id": 3,
        "text": "Patients with left to right shunt, are susceptible to paradoxical air embolism"
      },
      {
        "id": 4,
        "text": "The surgeon has no role in the management of VAE"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<div class=\"ng-scope\">\n<div class=\"ng-scope\">\n<p class=\"ng-binding\" style=\"text-align: justify;\">The correct statement regarding venous air embolism (VAE) is, a decrease in oxygen saturation will not always be seen, even with larger emboli.</p>\n<p style=\"text-align: justify;\">VAE can occur when the pressure within an open vein is subatmospheric. It can occur in any position or procedure, whenever the wound is above the level of the heart. The<strong> incidence of venous air embolism </strong>is<strong> greater</strong> during <strong>sitting craniotomies</strong>&nbsp;than in craniotomies in any other position.&nbsp;</p>\n<p style=\"text-align: justify;\">Option A<strong>:&nbsp;</strong>Physiological monitors (heart rate, blood pressure, oxygen saturation, and end-tidal carbon dioxide)<strong>&nbsp;</strong>have <strong>poor sensitivity </strong>and <strong>specificity</strong> and the clinical signs are manifested late.&nbsp;<strong>Transesophageal echocardiogram</strong>&nbsp;(TEE) is the&nbsp;<strong>most sensitive</strong>&nbsp;method to monitor and can detect up to&nbsp;<strong>0.02ml/kg</strong>&nbsp;of air embolism.</p>\n<p style=\"text-align: justify;\">Option C<strong>:&nbsp;</strong>Patients with&nbsp;a <strong>right to left shunt&nbsp;</strong>are susceptible to&nbsp;<strong>paradoxical air emboli </strong>which&nbsp;can result in a stroke or coronary occlusion.</p>\n<p>Option D:<strong>&nbsp;</strong>The <strong>surgeon should be notified </strong>immediately&nbsp;so that he or she can flood the surgical field with saline or pack it with wet gauzes and apply bone wax to the skull edges until the entry site is identified and occluded.</p>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 40-year-old male in kidney failure with a serum creatinine of 2.1 mg/dl is scheduled for surgery. Which of the following muscle relaxants can be used?",
    "choices": [
      {
        "id": 1,
        "text": "1, 2 and 4"
      },
      {
        "id": 2,
        "text": "3,4 and 5"
      },
      {
        "id": 3,
        "text": "2 and 4"
      },
      {
        "id": 4,
        "text": "1 only"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p style=\"text-align: justify;\"><strong>Succinylcholine, atracurium</strong> and<strong> cis-atracurium</strong> can be used in this patient who has a&nbsp;<strong>renal failure</strong> with<strong> elevated serum creatinine</strong>(normal value- 0.8&ndash;1.3 mg/dL in men and 0.6&ndash;1 mg/dL in women).</p>\n<p style=\"text-align: justify;\">Succinylcholine can be<strong> safely administered</strong> to patients with <strong>diminished </strong>or<strong> absent kidney function</strong> provided serum<strong> potassium levels </strong>are<strong> normal</strong>. If the serum potassium is increased, then a non-depolarizing muscle relaxant like atracurium or cisatracurium which is non-dependent on renal excretion is to be used. <strong>Atracurium </strong>or <strong>cisatracurium</strong> undergo <strong>Hofmann elimination</strong> which is non-enzymatic spontaneous degradation.</p>\n<p style=\"text-align: justify;\">Pancuronium is almost entirely dependent on the kidney for excretion (60&ndash;90%). Pancuronium has a prolonged elimination half-life in renal failure patients and thus should be used very cautiously.</p>\n<p style=\"text-align: justify;\">40-60% of d-tubocurarine is excreted via the kidney and so prolonged effects are seen with renal insufficiency</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient is scheduled to undergo transurethral resection of the prostate. Which is the preferred anaesthetic technique for this procedure?",
    "choices": [
      {
        "id": 1,
        "text": "General anesthesia"
      },
      {
        "id": 2,
        "text": "Spinal anesthesia"
      },
      {
        "id": 3,
        "text": "Epidural anesthesia"
      },
      {
        "id": 4,
        "text": "Local infiltration"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p style=\"text-align: justify;\"><strong>Spinal anaesthesia</strong> is the preferred choice of anaesthetic for the <strong>TURP </strong>procedure.</p>\n<p style=\"text-align: justify;\"><strong>Regional anaesthesia</strong> is <strong>preferred</strong> over general anaesthesia in TURP due to the following reasons:</p>\n<ul>\n<li>Less likely to mask the symptoms of TURP syndrome</li>\n<li><span style=\"text-align: justify;\">Helps assess patients mental status as an&nbsp;<strong>a</strong></span><strong style=\"text-align: justify;\">lteration in mental status</strong><span style=\"text-align: justify;\"> is an </span><strong style=\"text-align: justify;\">early sign</strong><strong><span style=\"text-align: justify;\"> of TURP</span></strong></li>\n<li>A <strong>lesser</strong> amount of<strong> operative blood loss</strong> and lesser <strong>risk of</strong> <strong>DVT</strong>.</li>\n<li>Less likely to mask symptoms of bladder perforation like nausea, abdominal pain, dyspnea, shoulder pain, and hiccups.</li>\n<li>Decreased need for analgesics in the immediate post-operative period.</li>\n</ul>\n<p style=\"text-align: justify;\"><strong>Spinal anaesthesia is preferred</strong> <strong>over epidural anaesthesia due to</strong>:</p>\n<ul style=\"text-align: justify;\">\n<li>Easier to perform in elderly patients.</li>\n<li>Duration of surgery is not usually long, so an epidural is not required.</li>\n<li>Epidural anaesthesia may incompletely block the sacral nerve roots which can be avoided with spinal anaesthesia.</li>\n</ul>\n<p style=\"text-align: justify;\"><strong>Caudal anaesthesia </strong>may be used in high-risk patients undergoing<strong> laser prostatectomy</strong> as it provides the advantage of <strong>hemodynamic stability</strong>. Local infiltration does not provide sufficient operative analgesia as spinal anaesthesia.</p>\n<p style=\"text-align: justify;\">&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 55-year-old female was diagnosed to have primary biliary cirrhosis and requires liver transplantation. Which of the following neuromuscular blocker of choice can be used in this patient during the transplantation procedure?",
    "choices": [
      {
        "id": 1,
        "text": "Cisatracurium"
      },
      {
        "id": 2,
        "text": "Pancuronium"
      },
      {
        "id": 3,
        "text": "Vecuronium"
      },
      {
        "id": 4,
        "text": "Rocuronium"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p style=\"text-align: justify;\">The neuromuscular blocker (NMB) of choice in a cirrhotic patient is <strong>cisatracurium.</strong>&nbsp;</p>\n<p style=\"text-align: justify;\">It&nbsp;is used as NMB of choice because&nbsp;of its <strong>nonhepatic metabolism.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is an inhalational agent of choice for a patient posted for liver transplantation?",
    "choices": [
      {
        "id": 1,
        "text": "Enflurane"
      },
      {
        "id": 2,
        "text": "Halothane"
      },
      {
        "id": 3,
        "text": "Sevoflurane"
      },
      {
        "id": 4,
        "text": "Isoflurane"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p style=\"text-align: justify;\"><strong>Sevoflurane</strong> is the inhalational anaesthetic agent of choice during<strong> liver transplantation</strong>\u00a0because it is superior\u00a0to other inhalational agents in preserving<strong>\u00a0</strong>hepatic arterial blood flow and hepatic oxygen delivery.</p>\n<p style=\"text-align: justify;\">The liver has an <strong>autoregulatory mechanism</strong> called the <strong>hepatic arterial buffer response(HABF)</strong>- when <strong>portal blood flow decreases</strong> due to decreased cardiac output or hypovolemia, the <strong>hepatic arterial blood flow increases</strong> in order to maintain total hepatic blood flow. This response is preserved in sevoflurane.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 71-year-old male is posted for total hip arthroplasty. What is the preferred anaesthetic technique for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "General anesthesia"
      },
      {
        "id": 2,
        "text": "Spinal anesthesia"
      },
      {
        "id": 3,
        "text": "Local infiltration"
      },
      {
        "id": 4,
        "text": "Paracervical block"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p style=\"text-align: justify;\"><strong>Spinal anaesthesia</strong> is preferred in <strong>elderly patients</strong> undergoing major vascular and orthopaedic surgeries.</p>\n<p style=\"text-align: justify;\">They are preferred over general anaesthesia due to:</p>\n<ul style=\"text-align: justify;\">\n<li>Decreased incidence of deep vein thrombosis and pulmonary embolism&nbsp;</li>\n<li>Local anaesthetics used will inhibit platelet aggregation and stabilize endothelial cells</li>\n<li>Regional anaesthesia is associated with less surgical blood loss</li>\n<li>Lower&nbsp;incidence of hypoxemia as it avoids airway instrumentation</li>\n</ul>\n<p style=\"text-align: justify;\">But the disadvantage with regional anaesthesia is that due to <strong>hypotension</strong>, patients with coronary artery disease will have increased oxygen demand due to reflex tachycardia and reduced coronary perfusion.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 71-year-old patient underwent hip replacement surgery. Postoperatively, a target control infusion (TCI) pump was set up to administer an opioid analgesic. Which is the most suitable opioid used for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Morphine"
      },
      {
        "id": 2,
        "text": "Pethidine"
      },
      {
        "id": 3,
        "text": "Fentanyl"
      },
      {
        "id": 4,
        "text": "Remifentanyl"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Remifentanil</strong> is the opioid that was most likely used in this elderly patient.</p>\n<p style=\"text-align: justify;\">Remifentanil is hydrolysed by <strong>plasma </strong>and <strong>tissue esterases </strong>and so its metabolism is independent of hepatic and renal function- no dose adjustment is required and is <strong>safe</strong> in <strong>liver failure</strong> patients and <strong>renal failure</strong> patients.</p>\n<p style=\"text-align: justify;\">Because of this hydrolysis, it has a <strong>high clearance</strong> and is <strong>eliminated</strong> <strong>rapidly</strong> with a quick recovery<strong> ( half-life<sup>&nbsp;</sup>less than 10 minutes)</strong> and thus is preferred in elderly patients.&nbsp;</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 39-year-old man had sustained major injuries in an accident as his legs were trapped under the wheel of a car. Which of the following agents can be ideally used by the EMS personnel to provide sedation and pain relief to the patient while shifting him to the hospital?",
    "choices": [
      {
        "id": 1,
        "text": "Propofol"
      },
      {
        "id": 2,
        "text": "Thiopentone"
      },
      {
        "id": 3,
        "text": "Midazolam"
      },
      {
        "id": 4,
        "text": "Ketamine"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p style=\"text-align: justify;\"><strong>Ketamine</strong> is the ideal agent&nbsp;of choice to provide sedation and&nbsp;analgesia in the<strong> prehospital setting.</strong></p>\n<p style=\"text-align: justify;\">Drugs that can be used by nurses and paramedics in the prehospital setting like the site of RTA/Trauma should have-</p>\n<ul>\n<li style=\"text-align: justify;\">Wide safety margin, even for inexperienced providers</li>\n<li style=\"text-align: justify;\">Hemodynamic stability</li>\n<li style=\"text-align: justify;\">Minimal respiratory depression</li>\n<li style=\"text-align: justify;\">Ease of administration</li>\n<li style=\"text-align: justify;\">Early-onset of action</li>\n</ul>\n<p style=\"text-align: justify;\">Ketamine provides potent analgesia and sedation for entrapped patients with trauma during extrication. It&nbsp;<strong>maintains hemodynamic stability</strong> in patients with hypovolemic shock, is a <strong>potent bronchodilator</strong>, and causes <strong>minimal respiratory depression</strong>. Because of its hallucinogenic properties, <strong>benzodiazepines </strong>should be<strong> co-administered</strong>. In larger doses, it can be used for induction of anaesthesia.</p>\n<p style=\"text-align: justify;\">Option C: Benzodiazepines like diazepam and <strong>midazolam&nbsp;</strong>have wide safety margins and can be administered via many routes and can be used to provide sedation, but <strong>lack</strong> an<strong> analgesic action.</strong></p>\n<p style=\"text-align: justify;\">Option A and B: Propofol causes hemodynamic instability and respiratory depression and thiopentone produces effects similar to propofol.</p>\n<p style=\"text-align: justify;\">&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 40-year-old patient is brought to the ER with hematemesis. The patient goes into haemorrhagic shock and requires emergency surgical intervention. Which of the following agents is not ideal for induction in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Propofol"
      },
      {
        "id": 2,
        "text": "Etomidate"
      },
      {
        "id": 3,
        "text": "Ketamine"
      },
      {
        "id": 4,
        "text": "None of the above"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Propofol is not an ideal agent for induction in a patient with haemorrhagic shock.</p>\n<p><strong>Propofol </strong>when&nbsp;given to a patient in hemorrhagic shock will lead to<strong> worsening of shock</strong>&nbsp;due to the&nbsp;<strong>profound hypotensive action</strong> because of its <strong>vasodilatory </strong>and<strong> negative inotropic effects.</strong></p>\n<p>Option B: Etomidate&nbsp;<strong>preserves </strong>the<strong> sympathetic tone</strong> and has <strong>cardiovascular stability</strong>. Thus it is safer to use than propofol.</p>\n<p>Option C: Ketamine has been effectively used in trauma patients because it is a CNS stimulant. It has indirect cardiovascular effects due to central stimulation of the<strong> sympathetic nervous system</strong> and <strong>inhibition </strong>of the <strong>reuptake of norepinephrine</strong> which is beneficial in acute shock.&nbsp;</p>\n<div class=\"page\" title=\"Page 192\">&nbsp;</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Shambu, a 55-year-old man met with a road traffic accident and was brought to the casualty. Radiographs revealed multiple rib fractures. Which of the following methods is used to treat this patient?",
    "choices": [
      {
        "id": 1,
        "text": "General anaesthesia with endotracheal intubation"
      },
      {
        "id": 2,
        "text": "Spinal anaesthesia"
      },
      {
        "id": 3,
        "text": "Epidural anaesthesia"
      },
      {
        "id": 4,
        "text": "Infraclavicular block"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p style=\"text-align: justify;\"><strong>Epidural anaesthesia </strong>is used to provide adequate analgesia which is the mainstay of treatment in patients with multiple rib fractures.</p>\n<p style=\"text-align: justify;\">The complications can be minimized by adequate pain relief with epidural anaesthesia. Rib fracture patients will have the following complications due to splinting and pain:</p>\n<ul style=\"text-align: justify;\">\n<li>Hypoventilation</li>\n<li>Hypoxia</li>\n</ul>\n<p style=\"text-align: justify;\">Other techniques to provide analgesia following rib fractures are&nbsp;<strong>intercostal nerve block </strong>and<strong> intrapleural&nbsp;block</strong> which&nbsp;necessitates <strong>multiple injections</strong>, which increases the risk for complications.</p>\n<p style=\"text-align: justify;\">The complications include<strong>&nbsp;vascular puncture, pneumothorax</strong>, patient discomfort due to the need for palpation of the fractured rib during local anaesthetic (LA) administration. Also, <strong>LA toxicity</strong> can occur because of the high systemic absorption.&nbsp;</p>\n<p style=\"text-align: justify;\">Option A: General Anaesthesia is more invasive to manage patient with multiple rib fractures and has potentially more side effects and complications than Epidural Anaesthesia. Endotracheal intubation as treatment is reserved only for patients who cannot maintain an airway or maintain sufficient oxygen saturation.</p>\n<p style=\"text-align: justify;\">Option B<strong>: </strong>Spinal anaesthesia involves a high level of anaesthesia which is required to cover the thoracic dermatomes which would lead to high spinal or total spinal anaesthesia.</p>\n<p style=\"text-align: justify;\">Option D: Infraclavicular block&nbsp;is a brachial plexus block that is used for the upper limbs.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 30-year-old male is scheduled for an open reduction of a fractured nose. The preferred technique of anaesthesia in this patient would be?",
    "choices": [
      {
        "id": 1,
        "text": "General anaesthesia"
      },
      {
        "id": 2,
        "text": "Local infiltration"
      },
      {
        "id": 3,
        "text": "Regional anaesthesia"
      },
      {
        "id": 4,
        "text": "Topical anaesthesia"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>General anaesthesia</strong> is preferred in this patient because of the insufficient block and patient discomfort associated with local anaesthesia.</p>\n<p><strong>Local anaesthesia</strong> may be suitable for simple procedures such as-</p>\n<ul>\n<li>Cauterization</li>\n<li>Polypectomy</li>\n<li>Turbinectomy&nbsp;</li>\n</ul>\n<p><strong>General anaesthesia </strong>may be used for<strong>&nbsp;</strong>the following procedures-</p>\n<ul>\n<li>Open nasal fracture reduction</li>\n<li>Septoplasty</li>\n<li>Rhinoplasty</li>\n</ul>\n<p>Note<strong>- Closed nasal fracture </strong>reduction is performed with<strong> propofol sedation</strong> as the procedure is extremely painful.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 55-year-old chronic smoker has been diagnosed with epiglottic carcinoma. The ENT surgeon has scheduled a CO2 laser excision surgery. Which of the following anaesthetic gases needs to be avoided during the procedure?",
    "choices": [
      {
        "id": 1,
        "text": "Sevoflurane"
      },
      {
        "id": 2,
        "text": "Oxygen"
      },
      {
        "id": 3,
        "text": "Nitrous oxide"
      },
      {
        "id": 4,
        "text": "Halothane"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Nitrous oxide is avoided in laser surgeries as it supports combustion.</p>\n<p>Oxygen concentration should be limited to the lowest, so as to maintain acceptable saturation levels to prevent the possibility of fire while using lasers.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A stapedectomy has been scheduled for a patient suffering from M\u00e9ni\u00e8re\u2019s disease. Which is the preferred intravenous induction agent for the procedure?",
    "choices": [
      {
        "id": 1,
        "text": "Thiopentone"
      },
      {
        "id": 2,
        "text": "Propofol"
      },
      {
        "id": 3,
        "text": "Etomidate"
      },
      {
        "id": 4,
        "text": "Ketamine"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Propofol</strong> is preferred for induction in patients undergoing stapedectomy or any ear surgery, especially the inner ear.</p>\n<p>Surgeries that can be conducted with propofol as induction agent-</p>\n<ul>\n<li>Stapedectomy or stapedotomy</li>\n<li>Tympanoplasty</li>\n<li>Mastoidectomy</li>\n<li>Myringotomy&nbsp;with insertion of tympanostomy tubes</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 32-year-old male is suffering from chronic suppurative otitis media of the right ear. He is scheduled for a tympanoplasty surgery. Which of the following agents should be avoided during the procedure?",
    "choices": [
      {
        "id": 1,
        "text": "Propofol"
      },
      {
        "id": 2,
        "text": "Ketamine"
      },
      {
        "id": 3,
        "text": "Oxygen"
      },
      {
        "id": 4,
        "text": "Nitrous oxide"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p style=\"text-align: justify;\"><strong>Nitrous oxide</strong> is avoided in middle ear surgeries.</p>\n<p style=\"text-align: justify;\">This is because nitrous oxide can <strong>increase middle ear pressure</strong> as it can diffuse into air-containing cavities because it is more soluble in blood than nitrogen.</p>\n<p style=\"text-align: justify;\">If nitrous oxide had been used in an <strong>overlay procedure</strong>, it would&nbsp;lead to<strong> pressure build-up </strong>inside the middle ear and displacement of the graft.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following agents should not be used during superficial parotidectomy surgery scheduled for a case of pleomorphic adenoma?",
    "choices": [
      {
        "id": 1,
        "text": "Inhalational anaesthetics"
      },
      {
        "id": 2,
        "text": "Opioids"
      },
      {
        "id": 3,
        "text": "Antibiotics"
      },
      {
        "id": 4,
        "text": "Muscle relaxants"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p style=\"text-align: justify;\"><strong>Muscle relaxants</strong> are avoided during a procedure of parotidectomy.&nbsp;</p>\n<p style=\"text-align: justify;\">The most common surgery for pleomorphic adenoma is <strong>superficial parotidectomy </strong>with<strong> facial nerve dissection.</strong> It is essential to preserve the facial nerve and hence, nerve stimulators are used during the surgery to identify the facial nerve and its branches. This cannot be possible if muscle relaxation is present.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 23-year-old woman wants to undergo an aesthetic rhinoplasty. Which of the following is the safest drug that can be used during the surgery for topical vasoconstriction?",
    "choices": [
      {
        "id": 1,
        "text": "Lidocaine"
      },
      {
        "id": 2,
        "text": "Phenylephrine"
      },
      {
        "id": 3,
        "text": "Cocaine"
      },
      {
        "id": 4,
        "text": "Oxymetazoline"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Oxymetazoline</strong> is the preferred topical vasoconstrictor in ENT surgeries due to the safety profile and easy availability of the drug.</p>\n<p><strong>0.05%</strong> solution is administered as 3 nasal sprays in each nostril before any nasal procedure. It should be<strong> avoided </strong>in patients who are on<strong> monoamine oxidase inhibitors </strong>as the interaction can result in <strong>high blood pressure.</strong></p>\n<p>Option B: Phenylephrine is an &alpha;-adrenergic agonist topical vasoconstrictor. It can cause severe hypertension and blood pressure monitoring is required.</p>\n<p>Option C<strong>: </strong>Cocaine has cardiovascular effects- it is <strong>sympathomimetic </strong>and when administered at a <strong>concentration of 4%</strong>, it inhibits the reuptake of norepinephrine at sympathetic nerve terminals thus making it <strong>unsafe </strong>in patients with <strong>coronary artery disease</strong> or those on monoamine oxidase inhibitors.&nbsp;</p>\n<p>Option A: Lidocaine as such does not have vasoconstrictor properties&nbsp;but may be used with phenylephrine.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following agents cannot be used to achieve hypotensive anaesthesia during nasopharyngeal carcinoma surgery?",
    "choices": [
      {
        "id": 1,
        "text": "Phentolamine"
      },
      {
        "id": 2,
        "text": "Halothane"
      },
      {
        "id": 3,
        "text": "Sodium nitroprusside"
      },
      {
        "id": 4,
        "text": "Phenylephrine"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Phenylephrine cannot be used to achieve controlled hypotension during nasopharyngeal carcinoma surgeries.</p>\n<p>Phenylephrine is a <strong>selective &alpha;\u2081-adrenergic receptor agonist</strong> of the phenethylamine class and can cause an increase in blood pressure. Hence it cannot be used to achieve hypotensive anaesthesia in any procedures.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "During a squint surgery, the ophthalmologist hooks a muscle that causes sudden significant bradycardia in the patient. Atropine is given and the heart rhythm returns to normal. This reflex is most likely seen with traction on which muscle?",
    "choices": [
      {
        "id": 1,
        "text": "Superior rectus"
      },
      {
        "id": 2,
        "text": "Inferior rectus"
      },
      {
        "id": 3,
        "text": "Medial rectus"
      },
      {
        "id": 4,
        "text": "Lateral rectus"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p style=\"text-align: justify;\">The <strong>medial rectus</strong> muscle is the most likely muscle to elicit bradycardia <strong>(oculocardiac reflex)&nbsp;</strong>when stimulated.</p>\n<p style=\"text-align: justify;\">Traction on the extraocular muscles or pressure on the globe causes bradycardia, atrioventricular block, ventricular ectopy, or asystole and is known as oculocardiac reflex. In particular, it is seen with traction on the <strong>medial rectus muscle</strong>, but it can occur with stimulation of any of the orbital contents, including the periosteum.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A child while undergoing enucleation of his right eye due to bacterial endophthalmitis, suddenly developed bradycardia. Manipulation of which of the following structures would have led to the bradycardia?",
    "choices": [
      {
        "id": 1,
        "text": "Orbital periosteum"
      },
      {
        "id": 2,
        "text": "Inferior oblique"
      },
      {
        "id": 3,
        "text": "Medial rectus"
      },
      {
        "id": 4,
        "text": "Any of the above"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p style=\"text-align: justify;\">Stimulation of any of the orbital contents&nbsp;can cause oculocardiac reflex.&nbsp;</p>\n<p style=\"text-align: justify;\">Traction on the extraocular muscles or pressure on the globe causes bradycardia, atrioventricular block, ventricular ectopy, or asystole and is known as oculocardiac reflex. In particular, it is seen with traction on the <strong>medial rectus muscle</strong>, but it can occur with stimulation of any of the orbital contents, including the periosteum. &nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 60-year-old female patient needs to undergo cataract surgery. Before initiating the surgery, the following procedure is performed. What is the most common complication seen in the procedure?",
    "choices": [
      {
        "id": 1,
        "text": "Proptosis"
      },
      {
        "id": 2,
        "text": "Subconjunctival hemorrhage"
      },
      {
        "id": 3,
        "text": "Optic nerve damage"
      },
      {
        "id": 4,
        "text": "Retrobulbar hemorrhage"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p style=\"text-align: justify;\">The most common complication seen in the procedure of retrobulbar block is <strong>retrobulbar haemorrhage</strong>.</p>\n<p style=\"text-align: justify;\">The image shown above depicts the&nbsp;technique of <strong>retrobulbar block </strong>which is a regional anaesthesia technique used in ophthalmic surgery. It involves the injection of a local anaesthetic into the extraocular muscle cone. The <strong>needle penetrates</strong> the <strong>lower lid</strong> at the junction of the<strong> middle </strong>and<strong> lateral one-third </strong>of the orbit.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/5eb4eeb027f8404bbbb71475c1295991.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "In which of the following conditions is a retrobulbar block not contraindicated?",
    "choices": [
      {
        "id": 1,
        "text": "High myopia"
      },
      {
        "id": 2,
        "text": "Coagulopathy"
      },
      {
        "id": 3,
        "text": "Penetrating eye injury"
      },
      {
        "id": 4,
        "text": "Enucleation"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Retrobulbar blocks</strong> are not contraindicated in enucleation of the eyes.</p>\n<p>The Retrobulbar block is a regional anesthesia technique used in ophthalmic surgical procedures which involves the injection of a local anesthetic into the extraocular muscle cone.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 13-year-old boy was accidentally shot in the eye by his brother while playing with a pellet gun. Examination reveals intraocular contents presenting at the wound. He is scheduled for emergency repair of the ruptured globe. What is the ideal anaesthetic technique to be used?",
    "choices": [
      {
        "id": 1,
        "text": "General anesthesia"
      },
      {
        "id": 2,
        "text": "Retrobulbar block"
      },
      {
        "id": 3,
        "text": "Subtenon block"
      },
      {
        "id": 4,
        "text": "Peribulbar block"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p style=\"text-align: justify;\"><strong>General anaesthesia</strong> is the <strong>ideal anaesthetic technique</strong> to be used in a person who has to undergo surgery for a <strong>penetrating eye injury</strong>.</p>\n<p style=\"text-align: justify;\"><strong>Regional anaesthesia</strong>&nbsp;is<strong> relatively contraindicated</strong> in patients with penetrating eye injuries because injecting local anaesthetic behind the globe increases intraocular pressure and may lead to the expulsion of intraocular contents.</p>\n<p style=\"text-align: justify;\">Therefore these patients require general anaesthesia&mdash;despite the increased risk of aspiration pneumonia when it is administered.</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A child presenting with open globe injury. Which induction agent should be avoided?",
    "choices": [
      {
        "id": 1,
        "text": "Propofol"
      },
      {
        "id": 2,
        "text": "Ketamine"
      },
      {
        "id": 3,
        "text": "Etomidate"
      },
      {
        "id": 4,
        "text": "Thiopentone"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Ketamine&nbsp;should be avoided in a&nbsp;child presenting with open globe injury as it can <strong>increase intraocular pressure.</strong></p>\n<p>It usually raises arterial blood&nbsp;pressure and also does not relax extraocular muscles and&nbsp;may cause <strong>nystagmus</strong> and <strong>blepharospasm</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The best type of anesthesia for pre eclampsia is:",
    "choices": [
      {
        "id": 1,
        "text": "Spinal anesthesia"
      },
      {
        "id": 2,
        "text": "Epidural anesthesia"
      },
      {
        "id": 3,
        "text": "General anesthesia"
      },
      {
        "id": 4,
        "text": "Caudal block"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Continuous epidural anesthesia is the first choice for most patients with preeclampsia during labor, vaginal delivery, and cesarean section.</p>\n<p>Pre-eclampsia patients have a risk of\u00a0<strong>severe airway edema</strong>, which makes intubation difficult. Thus continuous epidural anesthesia is advantageous as it avoids the need for intubation. Besides, continuous epidural anesthesia can\u00a0<strong>improve uteroplacental perfusion</strong>\u00a0and also decrease catecholamine secretion.</p>\n<p>But one major prerequisite for regional anesthesia in preeclamptic patients is normal platelet count and normal coagulation. Coagulopathy is a contraindication for regional anesthesia.</p>\n<p><strong>Minimal platelet count for regional anesthesia is 100,000/\u03bcL,</strong>\u00a0but some cases can be taken up with a platelet count as low as 70,000/\u03bcL.</p>\n<p><strong>General anesthesia</strong>\u00a0is indicated in patients with\u00a0<strong>coagulopathy</strong>\u00a0and in\u00a0<strong>severe pre-eclampsia\u00a0</strong>with complications.</p>\n<p><strong>Spinal anesthesia</strong>\u00a0can be given in mild pre-eclampsia but hypotension associated with spinal anesthesia limits its use in moderate to severe pre-eclampsia.\u00a0</p>\n<p>Since the severity of pre-eclampsia or the type of delivery (vaginal or cesarean) is not mentioned, epidural anesthesia has an advantage over other techniques for above-mentioned reasons. Hence the best option here would be epidural anesthesia.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Three combat wounded soldiers with uncontrolled blood loss are brought to the base camp. Damage control resuscitation(DCR) is initiated for the soldiers. What is the correct ratio of PRBCs, FFP, and platelets that can be used for DCR?",
    "choices": [
      {
        "id": 1,
        "text": "4:2:1"
      },
      {
        "id": 2,
        "text": "1:2:4"
      },
      {
        "id": 3,
        "text": "2:1:2"
      },
      {
        "id": 4,
        "text": "1:1:1"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>In <strong>DCR</strong>, the ratio of PRBC: fresh frozen plasma: platelets is <strong>1:1:1</strong>.&nbsp;</p>\n<p>Administering blood products in the appropriate ratios in order to facilitate resuscitation from trauma and avert trauma-induced coagulopathy is termed <strong>damage control resuscitation(DCR)</strong>.</p>\n<p>The rationale behind 1:1:1 ratio-&nbsp;</p>\n<ul>\n<li>The red blood cell component will improve oxygen delivery to ischemic tissues.</li>\n<li>Fresh frozen plasma improves clotting by providing clotting <strong>factors V and VIII and fibrinogen.</strong></li>\n<li>Platelet transfusion is required if the platelet count is <strong>below 50,000</strong> / high power field, significant blood loss or prolonged resuscitation.</li>\n</ul>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '23 Anaesthetic Implication Of Concurrent Diseases';
        const quizFilename = '23-anaesthetic-implication-of-concurrent-diseases-ad8fd92f.html';
        let hierarchy = ["Marrow", "qBank", "Anesthesia"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>