<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loss Of Vision Mini Test - -Tmt - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2024-25
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A diagnosis of retinal detachment is made in a patient who presented with the complaint of sudden painless loss of vision. A senior resident shows Shaffer's sign to all the interns, which is seen in this patient. As you were one of the interns, you were shown _________",
    "choices": [
      {
        "id": 1,
        "text": "Presence of shifting fluid in superonasal retinal breaks"
      },
      {
        "id": 2,
        "text": "Presence of shifting fluid in superotemporal retinal breaks"
      },
      {
        "id": 3,
        "text": "Presence of pigment cells in posterior vitreous"
      },
      {
        "id": 4,
        "text": "Presence of pigment cells in anterior vitreous"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Shaffer\u2019s sign\u00a0</strong>seen on slit-lamp examination\u00a0refers to the\u00a0<strong>presence of pigment cells in anterior vitreous</strong> in the case of rhegmatous retinal detachment.</p>\n<p>It is also known as\u00a0<strong>tobacco dusting.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d2999144be3b4e03a5745bc887463ad7x406x368.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e9ab7ebd62cf46878b66296f5df2993bx1280x2442.JPEG"
    ]
  },
  {
    "text": "A 65-year-old diabetic woman presents with painless loss of vision. The ocular findings are shown in the image below. Which of the following is true about this condition?",
    "choices": [
      {
        "id": 1,
        "text": "1, 3"
      },
      {
        "id": 2,
        "text": "2, 4"
      },
      {
        "id": 3,
        "text": "1, 2, 3"
      },
      {
        "id": 4,
        "text": "1, 3, 4"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical scenario and the above image are suggestive of an<strong> immature senile cataract. </strong>Here,\u00a0<strong>iris shadows</strong> are <strong>present</strong> on examination.</p>\n<p>An immature senile cataract is characterized by <strong>partial opacification </strong>of the lens. The <strong>cuneiform</strong> and <strong>cupuliform</strong> patterns of opacification may be seen which later become diffuse and irregular. The lens appears <strong>greyish-white</strong>. Both immature senile cataract and nuclear sclerosis without cataract present with painless <strong>progressive loss of vision</strong> and appear <strong>grey</strong> in color on <span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">oblique illumination examination. </span>They can be differentiated based on the following points:</p>\n<table style=\"border-collapse: collapse; width: 49.021%; height: 286.372px;\" border=\"1\">\n<tbody>\n<tr style=\"height: 44.8011px;\">\n<td style=\"width: 30.8691%; height: 44.8011px;\">\u00a0</td>\n<td style=\"width: 32.9313%; height: 44.8011px;\">Immature senile cataract</td>\n<td style=\"width: 35.9482%; height: 44.8011px;\">Nuclear sclerosis</td>\n</tr>\n<tr style=\"height: 22.4006px;\">\n<td style=\"width: 30.8691%; height: 22.4006px;\">Iris shadow</td>\n<td style=\"width: 32.9313%; height: 22.4006px;\">Present</td>\n<td style=\"width: 35.9482%; height: 22.4006px;\">Absent</td>\n</tr>\n<tr style=\"height: 43.1903px;\">\n<td style=\"width: 30.8691%; height: 43.1903px;\">\n<div class=\"page\" title=\"Page 205\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Distant direct ophthalmoscopy</p>\n</div>\n</div>\n</div>\n</td>\n<td style=\"width: 32.9313%; height: 43.1903px;\">\n<div class=\"page\" title=\"Page 205\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Black spots against red glow</strong> are observed</p>\n</div>\n</div>\n</div>\n</td>\n<td style=\"width: 35.9482%; height: 43.1903px;\">\n<div class=\"page\" title=\"Page 205\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>No black spots are seen against the red glow</p>\n</div>\n</div>\n</div>\n</td>\n</tr>\n<tr style=\"height: 99.1903px;\">\n<td style=\"width: 30.8691%; height: 99.1903px;\">\n<div class=\"page\" title=\"Page 205\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Slit-lamp examination</p>\n</div>\n</div>\n</div>\n</td>\n<td style=\"width: 32.9313%; height: 99.1903px;\">\n<div class=\"page\" title=\"Page 205\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Areas of cataractous cortex seen</p>\n</div>\n</div>\n</div>\n</td>\n<td style=\"width: 35.9482%; height: 99.1903px;\">\n<div class=\"page\" title=\"Page 205\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Clear lens with nuclear sclerosis seen</p>\n</div>\n</div>\n</div>\n</td>\n</tr>\n<tr style=\"height: 76.7898px;\">\n<td style=\"width: 30.8691%; height: 76.7898px;\">\n<div class=\"page\" title=\"Page 205\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Visual acuity on pin-hole testing</p>\n</div>\n</div>\n</div>\n</td>\n<td style=\"width: 32.9313%; height: 76.7898px;\">\n<div class=\"page\" title=\"Page 205\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Does not improve</strong></p>\n</div>\n</div>\n</div>\n</td>\n<td style=\"width: 35.9482%; height: 76.7898px;\">\n<div class=\"page\" title=\"Page 205\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Usually improves</p>\n</div>\n</div>\n</div>\n</td>\n</tr>\n</tbody>\n</table>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/23ef80aa9bf04206a2ffe2eae89b7720.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "At an eye camp, a 75-year-old man, who is a chronic smoker and has hypertension and a BMI of 35 kg/m2, presents with complaints of diminishing vision over the past 25 years in the right eye. His visual acuity is 6/36, and the anterior segment appears normal. The OCT image obtained is shown below. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Cystoid macular edema"
      },
      {
        "id": 2,
        "text": "Macular hole"
      },
      {
        "id": 3,
        "text": "Dry age-related macular degeneration"
      },
      {
        "id": 4,
        "text": "Exudative age-related macular degeneration"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The clinical scenario along with the OCT image showing\u00a0<strong>drusen</strong>\u00a0are suggestive of\u00a0<strong>dry</strong>\u00a0or\u00a0<strong>non-exudative age-related macular degeneration (AMD</strong>).\u00a0Drusen are the\u00a0<strong>earliest visible clinical signs</strong>\u00a0of AMD. They are composed of lipids, amyloid, complement factors, and associated cellular components.</p>\n<p><strong>Age-related macular degeneration (AMD)</strong>, a degenerative disorder of\u00a0the macula, is characterized by the presence of\u00a0<strong>drusen</strong> and <strong>retinal pigment epithelium (RPE) changes.\u00a0</strong>It is the most common cause of permanent central vision loss in the elderly.</p>\n<div>Risk factors:</div>\n<ul>\n<li>Age</li>\n<li>White race</li>\n<li>Family history</li>\n<li>Smoking</li>\n<li>Hypertension</li>\n<li>Cardiovascular diseases</li>\n<li>Obesity</li>\n<li>Aspirin intake\u00a0</li>\n</ul>\n<p>There are\u00a0two types of ARMD:</p>\n<ul>\n<li><strong>Dry\u00a0AMD\u00a0</strong>(non-exudative, non-neovascular)<strong>\u00a0</strong>is the\u00a0<strong>most common</strong>\u00a0form, comprising around\u00a090%\u00a0of the diagnosed cases. It is initially characterized by macular\u00a0<strong>drusens,</strong>\u00a0which later progresses to\u00a0<strong>geographical atrophy.\u00a0</strong>Geographic atrophy (GA) is the\u00a0<strong>advanced stage</strong>\u00a0of dry AMD.\u00a0</li>\n<li><strong>Wet\u00a0AMD\u00a0</strong>(exudative, neovascular)<strong>\u00a0</strong>is much\u00a0<strong>less common</strong>\u00a0than the dry type, but it is associated with\u00a0<strong>more rapid progression</strong>\u00a0to advanced sight loss. It presents with painless progressive visual loss\u00a0<strong>over months</strong>, central scotoma, and the fundoscopy showing sub-retinal hemorrhage near the macula (Option D).</li>\n</ul>\n<p>Treatment:</p>\n<p><strong>Dry\u00a0AMD</strong>:\u00a0No effective treatment is available. Antioxidants like lutein and zeaxanthin\u00a0are given as prophylaxis.</p>\n<p><strong>Wet\u00a0AMD</strong><strong>:\u00a0</strong>Treatment depends on the location of the choroidal neovascularization membrane.</p>\n<ul>\n<li>For extrafoveal membrane \u2013 laser photocoagulation</li>\n<li>For subfoveal and juxta foveal treatment options are as follows:\n<ul>\n<li>Intravitreal injection of anti-VEGF</li>\n<li>Photodynamic therapy \u2013 dye used is verteporfin followed by exposure to light from the diode</li>\n<li>Transpupillary thermotherapy</li>\n</ul>\n</li>\n</ul>\n<p>The image below shows <strong>drusens</strong> in the macular area in dry macular degeneration:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/98dcdd305e2c436a891f9d0129255748.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/58aab91b063a4110b1a44736041df2fbx800x721.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/dd50d142ec5a496096cf11cb49dd0dc2x209x109.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/da03316357d54ac2a7f8b2db44008733x1280x1637.JPEG"
    ]
  },
  {
    "text": "A 65-year-old woman presented with progressive, painless loss of vision in the right eye. There was no history of associated photopsia. On examination, a shifting fluid sign is present. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Breaks in Descemet membrane"
      },
      {
        "id": 2,
        "text": "Rhegmatogenous retinal detachment"
      },
      {
        "id": 3,
        "text": "Tractional retinal detachment"
      },
      {
        "id": 4,
        "text": "Exudative retinal detachment"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical scenario with\u00a0the\u00a0<strong>presence of shifting fluid\u00a0</strong>is suggestive of\u00a0<strong>exudative retinal detachment (ED).\u00a0</strong></p>\n<p><strong>Exudative RD</strong> is characterized by the accumulation of fluid beneath the retina in the absence of a retinal break or traction. Fluid leaks outside the vessels and accumulates under the retina. RD does not occur as long as the retinal pigment epithelium is pumping the leaking fluid into the choroidal circulation.\u00a0</p>\n<p>Causes:</p>\n<ul>\n<li>Inflammatory conditions like choroiditis, posterior scleritis</li>\n<li>Choroidal tumors like melanoma</li>\n<li>Toxemia of pregnancy</li>\n<li>Central serous retinopathy</li>\n<li>Coats disease</li>\n</ul>\n<p>Patients may present with painless progressive visual field defects without photopsia. Floaters may be present if there is an associated vitritis.</p>\n<p>Clinical signs include</p>\n<ul>\n<li>Convex configuration of the retinal detachment, with a smooth surface</li>\n<li>A detached retina is very mobile</li>\n<li><strong>Shifting fluid sign\u00a0</strong>- Subretinal fluid causes detachment of the retinal portion under which it accumulates. In the upright position, the fluid collects under the inferior retina. But in the supine position, the inferior retina flattens and the fluid shifts posteriorly, which leads to detachment of the superior retina.</li>\n<li>The cause of the RD may be apparent.\u00a0</li>\n<li>Leopard spots - Scattered areas of clumped subretinal pigment may be seen after the detachment has flattened.</li>\n</ul>\n<p>Retinal detachment (RD) is the result of the accumulation of fluid between the retina and the retinal pigment epithelium. It\u00a0is classified into the following:</p>\n<ul>\n<li>Rhegmatogenous RD - due to a tear or break in the retina</li>\n<li>Secondary RD - due to some other preceding event\n<ul>\n<li>Exudative RD</li>\n<li>Tractional RD</li>\n</ul>\n</li>\n</ul>\n<p>The image shows the shifting fluid sign and late-phase\u00a0fluorescein angiogram showing hyperfluorescent spots with a<strong> leopard spot pattern</strong> in the posterior fundus and staining of the arteries and an avascular area in the nasal region, respectively.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5a4caf57913f418ca464aef9775b85d1x1280x2442.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4870055146b847f2860659b8b46c858ex507x199.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6f47f74016cb4ae1b2ea4e460fb304b6x512x357.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/760de8d761fd4ec887a17fc4722cd008x720x723.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d1cd244e8bef4295b9e5f9f91908ac7ax512x124.PNG"
    ]
  },
  {
    "text": "A 58-year-old man after his retirement party came with the complaint of sudden painless loss of vision in his left eye for the past 2 hours. The fundoscopic examination picture shows a Hollenhorst plaque as shown below.  Which of the other following fundoscopic findings does not align with the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Direct pupillary reflex is present"
      },
      {
        "id": 2,
        "text": "Milky white appearance of the retina"
      },
      {
        "id": 3,
        "text": "Cattle-trucking is seen in the retinal vessels"
      },
      {
        "id": 4,
        "text": "Cherry red spot at the centre of the macula"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The clinical scenario of <strong>sudden painless loss of vision</strong> with the presence of a <strong>Hollenhorst plaque</strong> is suggestive of <strong>central retinal artery occlusion</strong> (CRAO). <strong>Direct</strong> pupillary reflex is <strong>absent</strong> in these cases; hence, it does not align with the diagnosis.</p>\n<p>Retinal artery occlusion can occur due to emboli from the carotids, atherosclerosis-related thrombosis, retinal arteritis, raised intraocular pressure, etc. Emboli are the most common cause. They may be:</p>\n<ul>\n<li><strong>Cholestrol emboli</strong> or <strong>Hollenhorst plaque</strong>- at retinal vessel bifurcation, from carotid artery atheromas</li>\n<li>Calcium emboli from cardiac valves</li>\n<li>Platelet fibrin emboli from carotid atheromas</li>\n</ul>\n<p>Patients present with sudden painless loss of vision and may have a past history of transient visual loss (amaurosis fugax). On examination, visual acuity is diminished, the <strong>direct pupillary reflex </strong>is<strong> lost</strong> and the relative afferent pupillary defect<strong> </strong>is positive. On funduscopy, the following findings are seen:</p>\n<ul>\n<li>Narrowed retinal arteries and veins</li>\n<li><strong>Milky white appearance</strong> of the retina due to oedema (Option B)</li>\n<li><strong>Cherry red spot </strong>at the centre of the macula (Option D)</li>\n<li><strong>Cattle trucking</strong> or segmentation of the blood column in the retinal veins (Option C)</li>\n</ul>\n<p>CRAO is treated with immediate lowering of intraocular pressure, intermittent <strong>ocular massage</strong>, IV <strong>mannitol</strong>, and IV acetazolamide. <strong>Vasodilators</strong> like nitroglycerine and oral isosorbide dinitrate are helpful. Steroids for arteritis, <strong>fibrinolytic</strong> therapy, and laser <strong>photodisruption</strong> of the embolus may be done.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c9d59181490e4164995d6af24aa084db.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A  post-cataract surgery patient who had the surgery 3 months back presents with complaints of blurring of vision for the past 2 weeks. On fundoscopy, there is a honeycomb appearance. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Cystoid macular edema"
      },
      {
        "id": 2,
        "text": "Macular hole"
      },
      {
        "id": 3,
        "text": "Central serous retinopathy"
      },
      {
        "id": 4,
        "text": "After cataract"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The clinical scenario of a&nbsp;<strong>post-cataract surgery</strong> patient presenting with a blurring of vision and a <strong>honeycomb appearance on fundoscopy</strong>&nbsp;is suggestive of&nbsp;<strong>cystoid macular edema</strong> (CME).</p>\n<p>Common causes of CME include previous <strong>cataract surgery</strong>, uveitis, central retinal vein occlusions, <strong>diabetic retinopathy</strong>, retinitis pigmentosa, retinopathy of prematurity, and topical <strong>prostaglandins</strong>. Cystoid macular edema in post-cataract surgery patients is termed as <strong>Irvine-Gass</strong> syndrome.&nbsp;</p>\n<p>In CME, optical coherence tomography (OCT) shows loss of foveal depression, <strong>intraretinal cystoid spaces</strong>, and retinal thickening. CME occurs due to a break in the <strong>inner and outer blood-retinal barrier</strong>. Due to retinal vessel leak fluid or exudate comes out and forms cystic space in the central retina. Mostly it gets <strong>accumulated</strong> in the <strong>outer plexiform</strong> (Henle's layer) and <strong>inner nuclear layers</strong> of the retina.&nbsp;</p>\n<p>On fundoscopy, the multiple cystoid oval spaces in CME appear as a&nbsp; <strong>honeycomb appearance</strong>. In Fundus fluorescein angiography fluid accumulation in the outer plexiform, layer shows a characteristic <strong>flower petal pattern</strong> (<strong>petaloid appearance</strong>) as shown below:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/75f339fe6bc94e2eb96be8fd4804c332x204x136.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/07394bd891a14ccc920a99f2a2b06eb9x338x106.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1abc1b9b97c648928ab85cd932d22189x800x502.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/43c02c0a5ddf428b9a63dd42becec01fx1279x1441.JPEG"
    ]
  },
  {
    "text": "A 40-year-old man presents with blurring of vision and the presence of a dark spot with distorted vision in his right eye for the past week. He has been taking steroid tablets for asthma. His best corrected visual acuity measured 6/24 in his right eye and 6/6 in his left eye. Posterior segment examination is shown in the image. What is the first-line management for this case?",
    "choices": [
      {
        "id": 1,
        "text": "Discontinue steroid use"
      },
      {
        "id": 2,
        "text": "Laser photocoagulation"
      },
      {
        "id": 3,
        "text": "Photodynamic therapy"
      },
      {
        "id": 4,
        "text": "Anti-vascular endothelial growth factor (VEGF)"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The above clinical scenario with visual abnormalities, history of steroid intake, and the fundal image depicting <strong>focal fundal detachment</strong> are suggestive of <strong>central serous retinopathy. Discontinuation of steroid use </strong>is the first line of management in this case.</p>\n<div><strong>Central serous chorioretinopathy (CSR)</strong> is an idiopathic disorder\u00a0characterized by a localized <strong>serous detachment of the sensory\u00a0retina at the macula.</strong></div>\n<p>Recent studies implicate\u00a0<strong>abnormal choroidal circulation</strong> as the cause of CSR.\u00a0</p>\n<p>Risk factors:</p>\n<ul>\n<li>Age: young adults (20\u201350 years)</li>\n<li>Sex: male &gt; female</li>\n<li><strong>Steroid intake\u00a0</strong></li>\n<li>Emotional stress</li>\n<li>Pregnancy</li>\n<li>Cushing's syndrome</li>\n<li>Hypertension</li>\n<li>Sleep apnea syndrome</li>\n</ul>\n<p>Clinical features:</p>\n<ul>\n<li>Mostly unilateral</li>\n<li>Retinal detachment -\u00a0<strong>Sudden painless loss</strong>\u00a0of vision</li>\n<li>Relative positive scotoma</li>\n<li>Micropsia</li>\n<li>Metamorphopsia</li>\n</ul>\n<p>Investigations:</p>\n<ul>\n<li>Ophthalmoscopy - circular <strong>ring reflex present</strong> and\u00a0<strong>foveal reflex absent</strong></li>\n<li>FFA - <strong>enlarging inkblot pattern</strong>\u00a0or\u00a0<strong>smoke stack pattern</strong></li>\n<li><strong>OCT -\u00a0</strong>optically empty neurosensory elevation at macular region.</li>\n</ul>\n<p><strong>Spontaneous resolution</strong> is seen in most cases and hence <strong>observation</strong> is enough.\u00a0<strong>Steroids\u00a0</strong>are\u00a0<strong>contraindicated</strong>. The disease is usually self-limiting but<strong> may recur</strong>.</p>\n<p>Other treatment options for <strong>recurrent and chronic cases:</strong>\u00a0Laser photocoagulation, photodynamic therapy, and intravitreal anti-VEGF.</p>\n<p>The image below depicts fundus fluorescein angiography (FFA), showing an enlarging\u00a0<strong>ink-blot pattern/ enlarging dot sign\u00a0</strong>- A small hyperfluorescent spot that gradually enlarges in size - seen in <strong>Central Serous Retinopathy (CSR).</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/db59786ba9484ef4a810cbb257604932.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/cf71fca6a66a4916be96b5d82c78e4c9x720x564.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/38184b9945584227960cb9ea2b3e809bx221x148.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0ac1b61154a4439e9f02c9a85ba482dfx300x188.JPEG"
    ]
  },
  {
    "text": "A patient presents with a sudden onset of nausea and pain in his right eye associated with blurring of vision and halos. On examination, ciliary congestion, corneal oedema, and a mid-dilated pupil are observed. Gonioscopy reveals a closed angle of the anterior chamber. All of the following are sequelae to this episode except _____.",
    "choices": [
      {
        "id": 1,
        "text": "Patches of iris atrophy"
      },
      {
        "id": 2,
        "text": "Ciliary body shut down"
      },
      {
        "id": 3,
        "text": "Glaukomflecken"
      },
      {
        "id": 4,
        "text": "Iris bombe"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>All of the above are sequelae to this episode, except <strong>iris bombe </strong>as it is<strong> </strong>implicated<strong> </strong>in<strong> </strong>the<strong> pathogenesis </strong>of<strong> angle closure glaucoma, </strong>not<strong> </strong>a<strong> sequel.</strong></p>\n<p>The clinical vignette of acute onset ocular pain with nausea or vomiting, blurring of vision with halos with ciliary congestion, corneal edema, and a mid-dilated pupil on examination are all indicative of <strong>acute angle-closure glaucoma</strong>.</p>\n<p>It is an ocular emergency that causes acute red-eye and is associated with at least <strong>two</strong> of the following symptoms: acute onset ocular pain with nausea or vomiting, intermittent blurring of vision with halos, photophobia, or loss of vision.</p>\n<p>It is also associated with <strong>three</strong> of the following signs: ciliary congestion, corneal edema and subsequent haziness, fixed and mid-dilated, usually oval pupil, a shallow anterior chamber, and intraocular pressure elevated above 40 mmHg.</p>\n<div class=\"page\" title=\"Page 2\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>The clinical status of the eye subsequent to an attack of acute angle-closure glaucoma is considered as the <strong>sequelae</strong> of the attack, regardless of whether the patient has been treated or not. These include:</p>\n<ol>\n<li>Post-surgical acute primary angle-closure</li>\n<li>Spontaneous angle reopening</li>\n<li><strong>Ciliary body shut down</strong></li>\n<li>Vogt's triad, which includes <strong>glaukomflecken</strong> i.e anterior subcapsular lenticular opacity, <strong>patches</strong> of <strong>iris atrophy,</strong> and slightly dilated non-reacting pupil.</li>\n</ol>\n</div>\n</div>\n</div>\n<p><strong>Iris bombe</strong> is not a part of the sequelae of acute angle-closure glaucoma. It refers to the collection of aqueous in the posterior chamber pushing the peripheral flaccid iris anteriorly resulting in appositional angle closure.</p>\n<p>The below image shows features of angle closure glaucoma.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/247da9b45c19443e93e144c23f3584d3x720x550.PNG"
    ]
  },
  {
    "text": "A 65-year-old  female patient presented with sudden painless loss of vision. She has had type 2 diabetes mellitus for 12 years. Ophthalmoscopy shows evidence of loss of fundal features, floating debris and a dark red glow. Which of the following is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Retinal detachment"
      },
      {
        "id": 2,
        "text": "Vitreous haemorrhage"
      },
      {
        "id": 3,
        "text": "Age related macular degeneration"
      },
      {
        "id": 4,
        "text": "Central retinal vein occlusion"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>This patient with <strong>sudden</strong>, <strong>painless</strong> vision loss, floating debris and a <strong>dark red glow</strong> on fundoscopic examination is most likely suffering from <strong>vitreous hemorrhage</strong>. Image below shows an example depicting the same.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5a5ff18936a944318b58aa92fbea2659x1280x1113.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/519a8dc341024acbb1b9491d17cdb368x648x484.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/135e6bf37e214045b6fbf1567a009bd6x400x343.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b7861ad10b42459c984b4f7c7e194d4ax325x294.PNG"
    ]
  },
  {
    "text": "A young male patient is admitted with sudden onset of loss of vision, restricted movements, and severe pain in his right eye, following a penetrating injury. Slit-lamp examination shows a cloudy cornea and pus in the anterior chamber. Visual acuity shows no light perception. What is the treatment of choice for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Evisceration"
      },
      {
        "id": 2,
        "text": "Enucleation"
      },
      {
        "id": 3,
        "text": "Exenteration"
      },
      {
        "id": 4,
        "text": "Debulking"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given scenario of a patient presenting with <strong>sudden loss of vision</strong> and <strong>severe eye pain</strong> following a <strong>penetrating eye injury,</strong> along with features of restricted eye movements, pus in the anterior chamber, and cloudy cornea, is suggestive of<strong> panophthalmitis.</strong> The treatment of choice for panophthalmitis is\u00a0<strong>evisceration</strong>.</p>\n<p>In <strong>evisceration, </strong>the <strong>contents of the eyeball</strong> are removed, leaving behind the<strong> sclera.\u00a0</strong>It is done\u00a0to avoid the risk of intracranial dissemination of infection.\u00a0</p>\n<p><strong>Panophthalmitis </strong>is an intense purulent inflammation of the <strong>entire\u00a0eyeball,</strong> including the Tenon\u2019s capsule.\u00a0Infection can occur as a result of <strong>exogenous</strong> penetrating injuries, perforation of corneal ulcers, <strong>hematogenous spread</strong>\u00a0of infections, or <strong>direct spread</strong> of infection from surrounding structures (e.g. orbital cellulitis).\u00a0</p>\n<p>Clinical features\u00a0include</p>\n<ul>\n<li>Severe <strong>ocular pain</strong> and headache</li>\n<li>Complete <strong>loss of vision</strong></li>\n<li>Marked redness and swelling of eyes</li>\n<li>Profuse watering, purulent discharge</li>\n<li>Constitutional symptoms - fever, malaise</li>\n</ul>\n<p><strong>Ocular examination:</strong></p>\n<ul>\n<li>Vision -<strong> no perception of light</strong></li>\n<li>Lids - <strong>edematous</strong>, hyperemia</li>\n<li>Eyeball - proptosis</li>\n<li>Ocular motility - <strong>grossly restricted, painful</strong></li>\n<li>Conjunctiva - chemosis, congestion</li>\n<li>Cornea -<strong> cloudy, edematous</strong></li>\n<li>Anterior chamber - <strong>hypopyon</strong></li>\n<li>Intra-ocular pressure - <strong>raised</strong></li>\n</ul>\n<p><strong>Treatment</strong></p>\n<ol>\n<li>Anti-inflammatory drugs and analgesics to relieve pain</li>\n<li>Broad-spectrum antibiotics</li>\n<li><strong>Evisceration</strong> is the <strong>definitive surgical procedure</strong> and the treatment of choice since it has\u00a0<strong>superior long-term cosmetic outcomes</strong> and <strong>faster recovery</strong> when compared with enucleation.</li>\n</ol>\n<p>Other options:</p>\n<p>Option B:<strong> Enucleation -</strong>\u00a0This procedure involves the removal of the <strong>entire eyeball</strong>\u00a0with the major part of the <strong>optic nerve,\u00a0</strong>leaving behind the\u00a0extraocular muscles. It is done in cases of\u00a0<strong>retinoblastoma</strong> and<strong> malignant melanoma.\u00a0</strong>It can be done with a painful blind eye but evisceration is the treatment of choice.</p>\n<p>Option C<strong>: Exenteration</strong>- This is a mutilating surgery in which all the orbits' contents and<strong>\u00a0periorbita</strong> are<strong> removed</strong>. It is indicated for<strong> malignant tumors</strong> arising from the orbital structures or spreading from the eyeball.</p>\n<p>Option D:<strong> Debulking-</strong>\u00a0This procedure is done for the reduction of as much of the bulk (volume) of a tumor as possible. Nowadays,<strong> debulking</strong> of the orbit is<strong> preferred</strong> over<strong> exenteration</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 70-year-old lady presented with a progressive diminution of central vision in the right eye. On examination, her visual acuity was 6/60 and Amsler's grid test showed central scotoma. Fundus examination revealed the following findings. Which of the following features will be seen if a fundus fluorescein angiography(FFA) is done?",
    "choices": [
      {
        "id": 1,
        "text": "Smokestack appearance"
      },
      {
        "id": 2,
        "text": "Flower petal pattern"
      },
      {
        "id": 3,
        "text": "Early foveal hyperfluorescence without leak"
      },
      {
        "id": 4,
        "text": "Stars in the sky appearance"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given scenario of an <strong>elderly female</strong> with <strong>progressive</strong> diminution of <strong>central</strong> vision, <strong>decreased</strong> visual acuity<strong> </strong>(6/60)<strong> </strong>and <strong>amsler's</strong> grid test showing <strong>central scotoma</strong> point towards the diagnosis of <strong>macular hole</strong>. The fundus showing a <strong>full-thickness</strong> macular hole with a surrounding cuff of subretinal fluid confirms the diagnosis.</p>\n<p>Fundus fluorescein angiography(FFA), shows <strong>early foveal hyperfluorescene without a leak</strong>.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/703088055b1842f7b2ae73192a7f3b03.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/38ab25f29668419ab3e7f8723fd4015cx1269x1130.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/168085e473a844b4bb61862d90d24954x360x104.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5584dfd6d3184499be8b06d12c3e695dx362x280.PNG",
      "https://cdn1.dailyrounds.org/uploads/fbc54987b79647b6a8bd0e4e678201b8.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/10f9591e367c4165a3da3cdc3fde8b00x500x375.JPEG"
    ]
  },
  {
    "text": "A patient comes with complaints of frequent changes in her presbyopic glasses. On gonioscopy, the anterior chamber angle appears normal. Perimetry shows a small wing-shaped paracentral scotoma. IOP is measured to be 23mmHg. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Primary angle-closure glaucoma"
      },
      {
        "id": 2,
        "text": "Primary open-angle glaucoma"
      },
      {
        "id": 3,
        "text": "Ocular hypertension"
      },
      {
        "id": 4,
        "text": "Normal-tension glaucoma"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>A history of <strong>frequent changes </strong>of <strong>presbyopic glasses</strong> with an <strong>increased IOP</strong> and <strong>paracentral scotoma</strong> suggests a likely diagnosis of <strong>primary\u00a0open-angle glaucoma</strong>.</p>\n<p>Primary open-angle glaucoma/<strong>chronic simple glaucoma</strong>\u00a0occurs due to reduced aqueous outflow facility which is caused by trabecular meshwork stiffening. It is characterized by <strong>open </strong><strong>anterior chamber angle</strong>, <strong>characteristic optic disc cupping</strong>, <strong>specific\u00a0visual field defects</strong>, and a slowly <strong>progressive increase of IOP</strong>.\u00a0\u00a0</p>\n<p><strong>Symptoms</strong> such as<strong> new-onset headache/eye ache</strong> are present. However, patients most commonly present with <strong>frequent changes in presbyopic glasses.</strong></p>\n<p>The optic disc changes are progressive with an <strong>increasing cup: disc (C/D) ratio</strong> (<strong>normal</strong> is<strong> 0.3 to 0.4</strong>),\u00a0<strong>nasal shifting of retinal vessels\u00a0</strong>(<strong>Bayonetting sign</strong>), and finally resulting in\u00a0<strong>glaucomatous optic atrophy</strong> where the <strong>optic disc</strong> appears <strong>excavated</strong>. Visual field defects, such as <strong>small wing-shaped paracentral scotoma</strong>,\u00a0is the\u00a0<strong>earliest clinically significant scotoma.</strong>\u00a0</p>\n<p><strong>Tonometry</strong> and <strong>central corneal thickness measurement</strong> should be done to correctly measure IOP. <strong>Normal IOP</strong> ranges from <strong>11- 21mmHg</strong>. To rule out other glaucomas\u00a0<strong>gonioscopy</strong> is done. Visual field defects are detected by <strong>perimetry</strong>.</p>\n<p>Medical therapy such as<strong> prostaglandin analogs</strong>, <strong>t</strong><strong>opical beta-blockers</strong>, etc are used in treatment.\u00a0<strong>Laser trabeculoplasty </strong>and\u00a0<strong>trabeculotomy</strong>\u00a0can be required if it is not managed medically.</p>\n<p>Other options:</p>\n<p>Option A: <strong>Primary angle-closure glaucoma</strong> occurs due to <strong>slow synechiae closure </strong>of the <strong>anterior chamber angle</strong>. Otherwise, other presentations are similar to open-angle glaucoma with optic disc cupping and visual field defects.\u00a0</p>\n<p>Option C: <strong>Ocular hypertension</strong> is defined as a<strong> persistent increase of IOP</strong> <strong>without optic disc changes </strong>and<strong> visual field defects</strong>.\u00a0</p>\n<p>Option D: <strong>Normal-tension glaucoma</strong> occurs when the <strong>IOP is normal</strong> and below 21mmHg, but there is <strong>typical glaucomatous change and visual field defects</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 28-year-old woman presents with progressively worsening pain, redness in the right eye for the last two days. She has a history of sarcoidosis. On examination, the right eye is inflamed around the cornea, the pupil is constricted, and reacts sluggishly to light. The iris appears muddy. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Acute bacterial conjunctivitis"
      },
      {
        "id": 2,
        "text": "Anterior uveitis"
      },
      {
        "id": 3,
        "text": "Endophthalmitis"
      },
      {
        "id": 4,
        "text": "Acute primary angle-closure glaucoma"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>This patient with progressively worsening eye pain and redness, constricted pupil reacting sluggishly to light, muddy iris, and a history of sarcoidosis is likely to have<strong> anterior uveitis</strong>.\u00a0</p>\n<p>Sarcoidosis is a systemic inflammatory disorder characterized by the formation of <strong>non-caseating granulomas</strong>.\u00a0Anterior uveitis is often a presenting symptom of sarcoidosis.</p>\n<p>Anterior uveitis presents with blurred vision, pain, photophobia, <strong>circumcorneal conjunctival injection</strong> (around the limbus) with an <strong>aqueous flare and keratin precipitates.</strong> The pupil is constricted and reacts sluggishly to light. The clear pattern of the <strong>iris</strong> is lost and it appears <strong>muddy.</strong></p>\n<p><strong>Slit-lamp examination</strong> shows the following <strong>signs </strong>in anterior uveitis:</p>\n<p>Corneal signs:\u00a0</p>\n<ul>\n<li>Keratic precipitates</li>\n</ul>\n<p>Anterior chamber signs:\u00a0</p>\n<ul>\n<li>Hypopyon</li>\n<li>Aqueous cells</li>\n<li>Aqueous flare</li>\n<li>Deep and irregular anterior chamber due to posterior synechiae</li>\n</ul>\n<p>Iris signs:\u00a0</p>\n<ul>\n<li>Loss of normal pattern</li>\n<li>Change in color \"muddy iris\"</li>\n<li>Posterior synechiae</li>\n</ul>\n<p>Pupillary signs:\u00a0</p>\n<ul>\n<li>Constricted pupil</li>\n<li>Irregular pupil shape</li>\n<li>Ectropion of uveal pigment</li>\n<li>Occlusion pupillae - blocked pupil due to extensive exudate</li>\n</ul>\n<div class=\"ng-scope\">\n<div class=\"ng-scope\">\n<p>Steroids and cycloplegics are the mainstay of management for uveitis.</p>\n</div>\n</div>\n<p><strong>Cycloplegics</strong></p>\n<ul>\n<li><strong>atropine</strong></li>\n<li><strong>Relieves spasm</strong> of iris sphincter and ciliary muscle</li>\n<li>Prevents the formation of synechiae</li>\n</ul>\n<p><strong>Steroids </strong>reduce inflammation by their anti-inflammatory effect<strong>\u00a0</strong></p>\n<p><strong>Systemic therapy</strong><strong>\u00a0</strong></p>\n<ul>\n<li>Steroids</li>\n<li>NSAIDs</li>\n<li><strong>Immunosuppressants</strong>\n<ul>\n<li>Used in severe cases</li>\n</ul>\n</li>\n</ul>\n<p>Other options:</p>\n<p>Option A: <strong>Acute bacterial conjunctivitis</strong> presents with pain, irritation, photophobia with hyperemia (<strong>pink eye</strong>), and <strong>purulent exudate</strong>. There is a diffuse conjunctival injection which is less seen in the circum-corneal region (as opposed to anterior uveitis)</p>\n<p>Option C: <strong>Endophthalmitis</strong> is the infection of the intra-ocular cavities which presents with <strong>severe pain</strong>, <strong>loss of vision, and lid edema.</strong> It is usually seen in post-operative cases of ocular trauma (exogenous) and patients hospitalized with severe bacterial, viral, or fungal infections (endogenous).</p>\n<p>Option D: <strong>Acute primary angle-closure glaucoma</strong> presents with severe <strong>unilateral eye pain</strong>, associated with headache and <strong>loss of vision</strong>. The examination shows a <strong>red congested eye</strong>, corneal edema with a<strong> shallow anterior chamber,</strong> and a\u00a0<strong>mid-dilated pupil</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You suspect non-arteritic anterior ischemic optic neuropathy and advise Fundus fluorescein angiography(FFA) in a 50-year-old hypertensive male patient, who presented with the following visual field defect. Presence of which of the following finding in FFA would help you to confirm the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Early disc filling"
      },
      {
        "id": 2,
        "text": "Delayed disc filling"
      },
      {
        "id": 3,
        "text": "Early choroidal and disc filling"
      },
      {
        "id": 4,
        "text": "Delayed choroidal and disc filling"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Fundus fluorescein angiography in a patient with <strong>non-arteritic anterior ischemic optic neuropathy</strong> would reveal <strong>delayed disc filling.</strong></p>\n<p><strong>Altitudinal hemianopia</strong>\u00a0is defined as hemianopia<strong>\u00a0</strong>affecting the upper or lower half of the visual field<strong>.\u00a0</strong>The above image depicts <strong>altitudinal hemianopia</strong>\u00a0( involving lower half of the visual field),<strong>\u00a0</strong>which is present in both <strong>a</strong><strong>rteritic and non-arteritic ischemic optic neuropathy.</strong></p>\n<p>Clinical features:</p>\n<table style=\"width: 442px; height: 698px;\">\n<tbody>\n<tr>\n<td style=\"width: 114.062px;\">\n<p><strong>Features</strong></p>\n</td>\n<td style=\"width: 144.859px;\">\n<p><strong>Arteritic AION</strong></p>\n</td>\n<td style=\"width: 140.688px;\">\n<p><strong>Non-arteritic AION</strong></p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 114.062px;\">\n<p><strong>Age</strong></p>\n</td>\n<td style=\"width: 144.859px;\">\n<p>Usually &gt;60 years(mean 70 years)</p>\n</td>\n<td style=\"width: 140.688px;\">\n<p>Usually 40-60 years</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 114.062px;\">\n<p><strong>Sex</strong></p>\n</td>\n<td style=\"width: 144.859px;\">\n<p>F &gt; M</p>\n</td>\n<td style=\"width: 140.688px;\">\n<p>F = M</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 114.062px;\">\n<p><strong>Risk factors</strong></p>\n</td>\n<td style=\"width: 144.859px;\">\u00a0\n<p class=\"p1\">Giant Cell Arteritis</p>\n</td>\n<td style=\"width: 140.688px;\">\n<p><strong>Associated with hypertension</strong>, diabetes, nocturnal hypotension.</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 114.062px;\">\n<p><strong>Optic disc</strong></p>\n</td>\n<td style=\"width: 144.859px;\">\n<p>Pale disc edema</p>\n</td>\n<td style=\"width: 140.688px;\">\n<p>Hyperemic disc edema</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 114.062px;\">\n<p><strong>ESR</strong></p>\n</td>\n<td style=\"width: 144.859px;\">\n<p>ESR &gt;40mm in the first hour</p>\n</td>\n<td style=\"width: 140.688px;\">\n<p>ESR 20-40mm in the first hour.</p>\n<p>\u00a0</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 114.062px;\">\n<p><strong>FFA</strong></p>\n</td>\n<td style=\"width: 144.859px;\">\n<p>Disc Delay and</p>\n<p>Choroidal delay</p>\n</td>\n<td style=\"width: 140.688px;\">\n<p><strong>Only disc delay</strong></p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 114.062px;\">\n<p><strong>Treatment</strong></p>\n</td>\n<td style=\"width: 144.859px;\">\n<p>Corticosteroids</p>\n</td>\n<td style=\"width: 140.688px;\">\n<p>Levodopa\u2013carbidopa combination for 3 weeks and then double dose for 1 month</p>\n</td>\n</tr>\n</tbody>\n</table>\n<p>\u00a0</p>\n<p><strong>Features common to both</strong></p>\n<ul>\n<li>Sudden painless loss of vision</li>\n<li>Reduced color vision,</li>\n<li>Altitudinal hemianopia</li>\n</ul>\n<p>Note:</p>\n<p><strong>Altitudinal hemianopia</strong>\u00a0is defined as hemianopia<strong>\u00a0</strong>affecting the upper or lower half of the visual field<strong>.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/74f1a40e657e40fd938fd024c0f925e9.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 34-year-old man developed a painless diminution of vision in his right eye 6 months ago but did not seek medical attention. Two weeks ago, he started to notice mild blurring in his left eye and has now come for evaluation. According to him, his elder brother and maternal uncle also had similar vision problems. Which fundus finding would point towards Leber\u2019s hereditary optic neuropathy in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Sectoral optic atrophy"
      },
      {
        "id": 2,
        "text": "Disc leakage on fluorescein angiography"
      },
      {
        "id": 3,
        "text": "Hyperemic optic disc with telangiectatic capillaries"
      },
      {
        "id": 4,
        "text": "Papilledema and macular star"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Hyperemic optic disc with telangiectatic capillaries</strong> would be suggestive of LHON. \u00a0</p>\n<p>LHON is related to a mitochondrial DNA mutation. This results in impaired mitochondrial adenosine triphosphate production, which affects the highly energy-dependent optic nerve. \u00a0</p>\n<p>In the acute phase, the optic disc is <strong>hyperemic</strong> and swollen with <strong>telangiectatic </strong>capillaries. However, the optic disc <strong>does not leak</strong> on fluorescein angiography. Later stages may show primary optic atrophy.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Match the following visual field defects with the likely site of the lesion:",
    "choices": [
      {
        "id": 1,
        "text": "1-A, 2-B, 3-E, 4-D, 5-C"
      },
      {
        "id": 2,
        "text": "1-C, 2-B, 3-E, 4-D, 5-A"
      },
      {
        "id": 3,
        "text": "1-C, 2-E, 3-B, 4-D, 5-A"
      },
      {
        "id": 4,
        "text": "1-D, 2-B, 3-E, 4-C, 5-A"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The correct match is&nbsp;<strong>1-C, 2-B, 3-E, 4-D, 5-A</strong>.</p>\n<table style=\"height: 133px; width: 350.781px;\">\n<tbody>\n<tr style=\"height: 18px;\">\n<td style=\"width: 153px; text-align: center; height: 18px;\"><strong>Lesion site</strong></td>\n<td style=\"width: 184px; text-align: center; height: 18px;\"><strong>Fibers affected</strong></td>\n<td style=\"width: 36.7812px; text-align: center; height: 18px;\"><strong>Visual defect</strong></td>\n</tr>\n<tr style=\"height: 63px;\">\n<td style=\"width: 153px; height: 63px;\">A - Left optic nerve</td>\n<td style=\"width: 184px; height: 63px;\">Left nasal,<br /><br />Left temporal fibers&nbsp;</td>\n<td style=\"width: 36.7812px; height: 63px;\">5. Left-sided complete anopia</td>\n</tr>\n<tr style=\"height: 90px;\">\n<td style=\"width: 153px; height: 90px;\">B - Left optic tract</td>\n<td style=\"width: 184px; height: 90px;\">Left temporal,<br /><br />Right nasal fibers</td>\n<td style=\"width: 36.7812px; height: 90px;\">2. Right-sided homonymous hemianopia</td>\n</tr>\n<tr style=\"height: 66px;\">\n<td style=\"width: 153px; height: 66px;\">C -&nbsp;Left Meyer's loop</td>\n<td style=\"width: 184px; height: 66px;\">Left inferior temporal, <br /><br />Right inferior nasal fibers&nbsp;</td>\n<td style=\"width: 36.7812px; height: 66px;\">\n<p>1. Right superior homonymous&nbsp; quadrantanopia <br /><br />(<strong>Pie in the sky</strong>)&nbsp;</p>\n</td>\n</tr>\n<tr style=\"height: 88px;\">\n<td style=\"width: 153px; height: 88px;\">D -Left Baum's loop</td>\n<td style=\"width: 184px; height: 88px;\">Left superior temporal,<br /> <br />Right superior nasal fibers</td>\n<td style=\"width: 36.7812px; height: 88px;\">4.&nbsp;Right inferior homonymous quadrantanopia&nbsp;<br /><br />(<strong>Pie in the floor</strong>)</td>\n</tr>\n<tr style=\"height: 97.3672px;\">\n<td style=\"width: 153px; height: 97.3672px;\">E -Left visual cortex sparing the macula</td>\n<td style=\"width: 184px; height: 97.3672px;\">Left temporal,<br /><br />Right nasal fibers, except the macular fibers</td>\n<td style=\"width: 36.7812px; height: 97.3672px;\">3. Right homonymous hemianopia with macular sparing</td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3258c4f60865483d93c82ad5e920e7cf.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A farmer presents with a progressive blurring of vision in his left eye. He said that a branch of a plant injured his eye 1 week ago while working in his field. On examination, an ulcer is seen in his cornea with feathery margins. Microscopy of the ulcer scraping showed branched septate hyphae. He was started on natamycin 5% eye drops. Which adjuvant drug can be given to this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Pilocarpine eye drops"
      },
      {
        "id": 2,
        "text": "Lignocaine eye drops"
      },
      {
        "id": 3,
        "text": "Dexamethasone eye drops"
      },
      {
        "id": 4,
        "text": "Atropine sulfate eye drops"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The clinical scenario is suggestive of a<strong> fungal corneal ulcer. </strong>The adjuvant drug that can be given to this patient is<strong> atropine sulfate </strong>eye drops<strong>.</strong></p>\n<p>Fungal corneal ulcers are usually caused due to injury to the eye with <strong>vegetable matter</strong>. The signs are more pronounced but the<strong>\u00a0symptoms\u00a0</strong>are\u00a0<strong>mild.\u00a0</strong></p>\n<p>Examination findings include:</p>\n<ul>\n<li><strong>Dry-looking</strong> ulcer with <strong>feathery margins</strong></li>\n<li>Sterile circular corneal infiltrates - <strong>Wessely's immune ring</strong> due to the deposition of immune complexes</li>\n<li>Satellite lesions</li>\n<li>Thick, non-sterile <strong>hypopyon</strong></li>\n</ul>\n<p><strong>Specific treatment </strong>of fungal corneal ulcer:</p>\n<ul>\n<li>Topical drugs: Natamycin, voriconazole, or amphotericin B drops against <em>Aspergillus</em> and <em>Fusarium</em> and nystatin against <em>Candida</em>.</li>\n<li>Systemic drugs: Oral ketoconazole or voriconazole for ulcers that are severe with hypopyon, perforated, or with suspicion of endophthalmitis.</li>\n</ul>\n<p><strong>Non-specific supportive treatment:</strong></p>\n<ul>\n<li><strong>Atropine</strong>\u00a0(1%) drops or ointment should be instilled in the affected eye two or three times a day to prevent complications like ciliary spasm posterior synechiae formation.</li>\n<li>Local heat</li>\n</ul>\n<p><strong>Steroids are contraindicated</strong> in the treatment of fungal corneal ulcers because fungi, which are <strong>usually symbiotic saprophytes</strong> under normal conditions,\u00a0<strong>become facultative pathogens</strong> in the presence of steroids and can <strong>cause perforation.</strong></p>\n<p>Image showing a fungal corneal ulcer with feathery margins and a non-sterile hypopyon:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/59ab8434e5364ccda36ed49cb9315867x720x582.JPEG"
    ]
  },
  {
    "text": "A 60-year-old man presents with complaints of eye ache and decreasing vision in his left eye. He underwent phacoemulsification with intraocular lens implantation in the same eye 2 days back. Examination of his left eye appears as shown in the image given below. A slit lamp examination revealed cells and flares in the anterior chamber. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Toxic anterior segment syndrome"
      },
      {
        "id": 2,
        "text": "Anterior scleritis"
      },
      {
        "id": 3,
        "text": "Posterior capsular opacification"
      },
      {
        "id": 4,
        "text": "Endophthalmitis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The above clinical scenario, along with the image showing <strong>inflammation </strong>of the eyeball and<strong> hypopyon,&nbsp;</strong>in a patient 2 days <strong>after cataract surgery</strong> is suggestive of acute postoperative <strong>endophthalmitis</strong>.</p>\n<p>Endophthalmitis is defined as&nbsp;an<strong> intraocular inflammation</strong>,&nbsp;which predominantly affects the&nbsp;inner spaces of the eye and their contents, i.e., the <strong>vitreous </strong>and/or the<strong> anterior chamber</strong>. <em><strong>Staphylococcus epidermidis</strong></em> is the most common organism involved in pathogenesis.</p>\n<p>Clinically, patients present with symptoms of <strong>pain</strong>, swelling of the eyelid, decrease in vision 48 to 72 hours after surgery.</p>\n<p>Signs include conjunctival chemosis, corneal edema and haziness, and<strong> hypopyon</strong>&nbsp;due to the&nbsp;pouring of exudates in the vitreous cavity, anterior chamber,&nbsp;and posterior chamber.</p>\n<p><strong>Slit-lamp examination</strong> usually reveals <strong>white blood cells</strong> (cells) and <strong>protein</strong> (flare) within the anterior chamber. The <strong>diagnosis</strong> is confirmed by positive aqueous or vitreous <strong>culture</strong>.</p>\n<p><strong>Intravitreal </strong>injections of<strong> antibiotics</strong> like ceftazidime and vancomycin should be administered immediately after culture specimens have been obtained. Other treatments include:</p>\n<ul>\n<li>Topical antibiotic</li>\n<li>Topical mydriatics and cycloplegics</li>\n<li>Oral steroids</li>\n<li>Pars plana vitrectomy.</li>\n</ul>\n<p>Other options:</p>\n<p>Option A: <strong>Toxic anterior segment syndrome</strong> (TASS) is a <strong>sterile postoperative inflammation</strong> of the anterior segment caused by either the ethylene gas used for sterilizing intraocular lens (in early cases) or by the lens material (in late cases). It is characterized by increased intraocular pressure, <strong>no hypopyon</strong>, and no vitreal inflammation. It responds well to steroids.</p>\n<p>Option B: <strong>Anterior scleritis</strong> is characterized by edema and inflammation of the sclera and is more commonly associated with <strong>autoimmune conditions</strong>.</p>\n<p>Option C: <strong>Posterior capsular opacification</strong> also called<strong>&nbsp;after cataract,</strong>&nbsp;is the opacification that follows extracapsular extraction of the lens. It occurs due to the proliferation of lens particles left over from surgery.</p>\n<p>The illustration given below shows different types of after-cataract.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/50688c02bd084a5a832dafd31265aa53.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/15d7e3bdba414847b80f4d8f2a1d83adx1279x1981.JPEG"
    ]
  },
  {
    "text": "For a patient presenting with gradual, painless diminution of vision, the differential diagnosis would not include _________.",
    "choices": [
      {
        "id": 1,
        "text": "Optic atrophy"
      },
      {
        "id": 2,
        "text": "Corneal dystrophy"
      },
      {
        "id": 3,
        "text": "Primary open angle glaucoma"
      },
      {
        "id": 4,
        "text": "Methyl alcohol amblyopia"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Methyl alcohol amblyopia</strong> causes<strong> sudden painless</strong>\u00a0diminution of vision.</p>\n<p>It is a toxic neuropathy of the optic nerve.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 20-year-old male patient came with complaints of a sudden decreased vision in both eyes and pain while moving his eyeballs. On examination, vision in both eyes is 3/60. He finds it difficult to read Ishihara\u2019s chart.  Fundus examination showed normal discs and vessels. What is the most probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Eale\u2019s disease"
      },
      {
        "id": 2,
        "text": "Papilloedema"
      },
      {
        "id": 3,
        "text": "Retrobulbar neuritis"
      },
      {
        "id": 4,
        "text": "Papillitis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario is suggestive of\u00a0<strong>retrobulbar neuritis.</strong>\u00a0The <strong>normal optic disc</strong> is an important pointer toward retrobulbar neuritis.</p>\n<p>Optic neuritis is of\u00a0<strong>three</strong> types, based on the appearance of optic disc on fundoscopy:</p>\n<ul>\n<li>Retrobulbar neuritis - <strong>Normal</strong> optic disc because optic nerve head is not involved.</li>\n<li>Papillitis - <strong>Hyperemic</strong> and <strong>edematous</strong> disc with peripapillary <strong>flame-shaped</strong> hemorrhages.</li>\n<li>Neuroretinitis - <strong>Macular star</strong> appearance due to involvement of nerve fiber layer (NFL)</li>\n</ul>\n<p>The clinical features of retrobulbar neuritis include sudden painful vision loss, decreased color contrast sensitivity, Marcus Gunn pupil and pain on movement of eyeballs.</p>\n<p><strong>Demyelinating disorders </strong>like\u00a0multiple sclerosis are the most common cause of retrobulbar neuritis.</p>\n<p><strong>Steroids</strong> are the mainstay of treatment for such demyelinating causes.</p>\n<p>Option A: <strong>Eale's disease</strong> is characterized by <strong>recurrent vitreous hemorrhages</strong>. Due to this, the <strong>fundoscopic</strong> findings will <strong>not</strong> be <strong>normal</strong>. It is a type of hypersensitivity reaction to tubercular proteins. This causes periphlebitis leading to hemorrhages.</p>\n<p>Option B: <strong>Papilloedema</strong> is swelling of the optic nerve head due to raised intracranial pressure (ICP). Here also the optic disc would not be normal. The patient will have symptoms of raised ICP such as headache, nausea, deterioration of consciousness, etc.</p>\n<p>Option D: <strong>Papillitis</strong>\u00a0will have an abnormal optic disc as described above.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = 'Loss Of Vision Mini Test - -Tmt';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2024-25"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>