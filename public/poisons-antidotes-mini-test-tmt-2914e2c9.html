<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Poisons & Antidotes Mini Test - -Tmt - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2023-24
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "The posture seen in the image is characteristic of which poisoning?",
    "choices": [
      {
        "id": 1,
        "text": "Datura"
      },
      {
        "id": 2,
        "text": "Oleander"
      },
      {
        "id": 3,
        "text": "Tetrodotoxin"
      },
      {
        "id": 4,
        "text": "Strychnine"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The image shows Opisthotonus posturing.It is a characteristic occurrence of<strong> strychnine poisoning.</strong><br /><br />Risus sardonicus/Lockjaw is another feature that may be seen, but is not specific for strychnine poisoning.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/0c6f712ae5264bfa8bb9d3254b87f445.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7dbc798ca2c849309e3e49fd36369284x403x600.PNG"
    ]
  },
  {
    "text": "A 10-year-old boy accidentally ate the fruit shown in the image below. He presents with blurred vision, slurred speech, urinary retention, and confusion. On examination, the pupils are dilated, the mouth is dry, and the face appears flushed. What is the antidote of choice for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Atropine"
      },
      {
        "id": 2,
        "text": "Pralidoxime"
      },
      {
        "id": 3,
        "text": "Sodium amytal"
      },
      {
        "id": 4,
        "text": "Physostigmine"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The clinical scenario and the image of a cherry-like, highly toxic fruit<strong>&nbsp;</strong>are suggestive of<strong>&nbsp;<em>Atropa belladonna</em></strong>&nbsp;poisoning. It is a deliriant poison. The appropriate antidote of choice is&nbsp;<strong>physostigmine.</strong></p>\n<p><em>Atropa belladonna</em> acts by <strong>inhibiting</strong> the<strong> muscarinic effects of acetylcholine.</strong> All the parts of the plants are toxic. The active principle is <strong>1-hyoscyamine.</strong></p>\n<p>The signs and symptoms, treatment, and postmortem appearances are similar to those associated with <em>Datura </em>poisoning.&nbsp;Clinical manifestations can be remembered with 9D's: dryness of mouth, dysarthria, dysphagia, dilation of cutaneous blood vessels, diplopia, dry hot skin, drunken gait, delirium, and drowsiness. On examination, dilation of the pupils, flushing of the face, and congestion of the cornea can be seen.</p>\n<p><strong>Note:</strong></p>\n<p>Deliriant poisons are poisons that produce a well-marked deliriant or confusional stage, like <em>Datura</em>, <em>Belladonna</em>, <em>Hyoscyamus</em>, <em>Cannabis</em>, and cocaine.</p>\n<p>Other options</p>\n<p>Options A and B- <strong>Atropine</strong> and <strong>pralidoxime</strong> are antidotes used in <strong>organophosphorus</strong> poisoning.</p>\n<p>Option C- <strong>Sodium amytal</strong> is used as an antidote for&nbsp;<strong>strychnine&nbsp;</strong>which is a&nbsp;<strong>spinal poison.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3ebdff9b445a4ab3a8f9d6a9204f9c5c.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Activated charcoal is a:",
    "choices": [
      {
        "id": 1,
        "text": "Chemical antidote"
      },
      {
        "id": 2,
        "text": "Mechanical antidote"
      },
      {
        "id": 3,
        "text": "Chelating agent"
      },
      {
        "id": 4,
        "text": "Demulcent"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Activated charcoal acts as a <strong>mechanical antidote</strong>.</p>\n<p><strong>Mechanical antidotes</strong>- They neutralise poisons by mechanical action or prevention of their absorption.</p>\n<ul>\n<li><strong>Activated charcoal</strong>- It acts mechanically by adsorbing and retaining organic and mineral poisons within its pores and thus delays the absorption from the stomach.</li>\n<li><strong>Demulcents</strong>- substances that coat the gastric mucous membrane and thus do not permit the poisons to\u00a0\u00a0\u00a0 cause any damage, e.g. milk, starch, egg-white, mineral oil, milk of magnesia, aluminium hydroxide gel, etc</li>\n<li><strong>Bulky food</strong>\u00a0is the mechanical antidote to glass powder, wherein it acts by imprisoning its particles within its meshes.</li>\n</ul>\n<p><strong>Chemical antidotes</strong>- They neutralise poison by forming harmless or insoluble compounds or by oxidation when it is brought in contact with them.</p>\n<ul>\n<li>Common salt decomposes silver nitrate, forming the insoluble silver chloride.</li>\n<li>Potassium permanganate has oxidising properties. 1:5000 solution is used in opium poisoning.</li>\n</ul>\n<p><strong>Chelating agents</strong> (metal complexing agents) are used in the treatment of heavy metal poisoning. The metal-agent complex is more water-soluble than the metal itself, resulting in higher renal excretion of the complex.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You were asked to conduct an autopsy of a 32-year-old man who succumbed to death due to poisoning. His organs can be preserved in rectified spirit in poisoning due to any of the following agents except?",
    "choices": [
      {
        "id": 1,
        "text": "Lead"
      },
      {
        "id": 2,
        "text": "Arsenic"
      },
      {
        "id": 3,
        "text": "Mercury"
      },
      {
        "id": 4,
        "text": "Kerosene"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<div class=\"page\" title=\"Page 133\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>The organs can be preserved in rectified spirit, <strong>except</strong> in cases of suspected poisoning by<strong> kerosene</strong>.</p>\n<p>Rectified spirit can be used to preserve tissue and organs in most cases of suspected poisoning. In suspected poisoning with the following, preservation with rectified spirit should be <strong>avoided</strong>:</p>\n<ul>\n<li>Alcohol</li>\n<li>Kerosene</li>\n<li>Chloroform, ether</li>\n<li>Chloral hydrate</li>\n<li>Formic acid, Formaldehyde</li>\n<li>Acetic acid</li>\n<li>Phenol</li>\n<li>Phosphorus, and</li>\n<li>Paraldehyde</li>\n</ul>\n</div>\n</div>\n</div>\n<p>Other preservatives used in toxicology postmortem include:</p>\n<ul>\n<li>Saturated NaCl solution: Avoided in poisoning from corrosive acids, alkalis, corrosive sublimate, and aconite.</li>\n<li>10 mg/ml of sodium or potassium fluoride and potassium oxalate (anti-coagulant) to preserve blood.</li>\n<li>Fluoride should be added to urine, CSF, and vitreous humor if alcohol estimation is required and if analysis for cocaine, cyanide, and CO is being done.</li>\n</ul>\n<p>A preservative is not necessary if :</p>\n<ul>\n<li>The viscera can be analyzed in 24 hours</li>\n<li>If the sample can be stored in a refrigerator or icebox</li>\n<li>Bone, hair, nails specimens</li>\n<li>Lung for inhaled poisons</li>\n</ul>\n<p>The viscera should not be preserved in formaldehyde because extraction of non-volatile poisons becomes difficult.</p>\n<p>In cases of chronic poisoning with heavy metals such as lead, arsenic, mercury, antimony, copper, etc.,&nbsp;the shaft of a long bone, strands of scalp hair, fingernails or toenails, and a wedge of the quadriceps muscle should also be taken for sampling.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 45 year old iron smelter, presents to the OPD with history of rice water diarrhoea. The image shows the clinical finding that the doctor notes during examination. Which of the following clinical features would be consistent with the probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Hypothermia"
      },
      {
        "id": 2,
        "text": "Hypopigmentation"
      },
      {
        "id": 3,
        "text": "Hyperphagia"
      },
      {
        "id": 4,
        "text": "Tremors"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The image shows <strong>transverse white lines </strong>(Leukonychia striata) called <strong>Aldrich Mees Lines </strong>typically seen in&nbsp;<strong>arsenic poisoning.&nbsp;Tremors</strong> are consistent with a diagnosis of <strong>arsenic poisoning</strong> which should be suspected in a patient of with Aldrich Mees lines, red velvety mucosa, and rice water stools.</p>\n<p><strong>Hyper</strong>pyrexia, <strong>Hyper</strong>pigmentation, and <strong>Anorexia</strong> are associated features.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/8dedee851a5d41ecbcea535e2ea04ae3.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 22-year-old mother of a newborn is brought to the emergency department with nausea, abdominal cramps, and massive desquamation of the skin. The patient presents with a red skin rash,  affecting mainly the soles, palms, and buttocks. Further probing reveals that she had consumed the substance shown in the image below. What is the likely diagnosis in this case?",
    "choices": [
      {
        "id": 1,
        "text": "Pink disease"
      },
      {
        "id": 2,
        "text": "Blackfoot disease"
      },
      {
        "id": 3,
        "text": "Boiled lobster syndrome"
      },
      {
        "id": 4,
        "text": "Erethism"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><span data-preserver-spaces=\"true\">The given clinical features suggest&nbsp;</span><strong><span data-preserver-spaces=\"true\">boiled lobster syndrome</span></strong><span data-preserver-spaces=\"true\">&nbsp;seen in poisoning with&nbsp;</span><strong><span data-preserver-spaces=\"true\">boric acid,</span></strong><span data-preserver-spaces=\"true\">&nbsp;a common household poison commonly seen in b</span>aby powders, lotions, and antiseptics used in the treatment of diaper dermatitis.</p>\n<p><strong><span data-preserver-spaces=\"true\">Boric acid</span></strong><span data-preserver-spaces=\"true\">&nbsp;is used as an antiseptic and insecticide.</span></p>\n<p><span data-preserver-spaces=\"true\">In severe poisoning with boric acid,&nbsp;</span><strong><span data-preserver-spaces=\"true\">a red skin rash,</span></strong> most often affecting <strong><span data-preserver-spaces=\"true\">palms, soles, </span></strong>and<strong><span data-preserver-spaces=\"true\"> buttocks,</span></strong><span data-preserver-spaces=\"true\">&nbsp;can be seen. The characteristic appearance is known as&nbsp;<strong>\"boiled lobster appearance,\"</strong>&nbsp;which is marked by&nbsp;</span>intense erythema, followed by extensive exfoliation.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ff279a0902304d1facabc5faed3f31f0.jpeg"
    ],
    "explanation_images": []
  },
  {
    "text": "A 35-year-old woman came to the emergency department with severe pain in both legs, after she underwent an induced abortion using ergotamine. On examination, her legs were cold and pale, and peripheral arterial pulses were not felt. Which of the following drugs can be used as an antidote in treating the condition?",
    "choices": [
      {
        "id": 1,
        "text": "Sumatriptan"
      },
      {
        "id": 2,
        "text": "Bromocriptine"
      },
      {
        "id": 3,
        "text": "Nitroprusside"
      },
      {
        "id": 4,
        "text": "Ephedrine"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Nitroprusside</strong> can be used as an antidote to reverse the ergot-induced vasospasm.</p>\n<p>Nitroprusside is a non-selective vasodilator. It acts by releasing NO, which activates the guanylyl cyclase - cyclic GMP \u2013 protein kinase G pathway, leading to vasodilation. This mechanism mimics the production of NO by vascular endothelial cells.</p>\n<p><strong>Therapeutic uses:</strong></p>\n<ul>\n<li>It is primarily used in the treatment of <strong>hypertensive</strong> <strong>emergencies</strong>.</li>\n<li>To lower blood pressure during <strong>aortic</strong> <strong>dissection</strong>. It is important to administer beta blocker with nitroprusside in aortic dissection to reduce heart rate, because if nitroprusside is given alone, it causes increased myocardial contractility, which in turn increases the rate of increase in aortic pressure and may further aggravate the dissection.</li>\n<li>To improve cardiac output in patients with <strong>congestive</strong> <strong>heart</strong> <strong>failure</strong>, especially with hypertension and pulmonary edema, who are refractory to other treatments.</li>\n<li>To decrease myocardial oxygen demand after <strong>myocardial</strong> <strong>infarction</strong>.</li>\n<li>To induce controlled hypotension during anesthesia, and reduce bleeding during <strong>surgical</strong> <strong>procedures</strong>.</li>\n<li>To reverse the vasospastic action of the <strong>ergot</strong> <strong>alkaloids</strong>, such as ergotamine and ergonovine.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 30-year-old drowsy male was brought to the casualty. His pulse was 130/min, respiratory rate -30/min. His lab reports are given below.  He showed improvement on nasogastric aspiration and administration of sodium bicarbonate, calcium gluconate, and 4-methyl pyrazole. What substance did he most likely consume?",
    "choices": [
      {
        "id": 1,
        "text": "Formaldehyde"
      },
      {
        "id": 2,
        "text": "Ethylene glycol"
      },
      {
        "id": 3,
        "text": "Paraldehyde"
      },
      {
        "id": 4,
        "text": "Methyl alcohol"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given scenario point towards <strong>ethylene glycol poisoning</strong>.</p>\n<p><strong>Ethylene glycol&nbsp;</strong>is converted to<strong>&nbsp;glyoxyaldehyde</strong>&nbsp;by alcohol dehydrogenase.&nbsp;Glyoxyaldehyde causes <strong>kidney damage.</strong>&nbsp;</p>\n<p><strong>Methanol</strong> is converted to <strong>formaldehyde</strong>&nbsp;by alcohol dehydrogenase. Formaldehyde causes <strong>retinal damage</strong>&nbsp;like blurring of vision/loss of vision.</p>\n<p>The principles of <strong>treatment</strong> for both these conditions are the same. It predominantly involves using <strong>fomipezole</strong> or ethanol to inhibit the metabolic conversion of these relatively non-toxic alcohols to their toxic metabolites.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 35-year-old man with suspected poisoning was brought to the casualty by his friends. On examination, the finding shown below is seen. Which of the following is the likely poisoning in this case?",
    "choices": [
      {
        "id": 1,
        "text": "Sulphuric acid"
      },
      {
        "id": 2,
        "text": "Oxalic acid"
      },
      {
        "id": 3,
        "text": "Hydrochloric acid"
      },
      {
        "id": 4,
        "text": "Nitric acid"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The above image shows a <strong>carpopedal spasm</strong> which is seen in <strong>hypocalcemia</strong>. <strong>Oxalic acid poisoning</strong> is associated with hypocalcemia.</p>\n<p>In oxalic acid poisoning, those who survive for a few hours develop hypocalcemia, because <strong>oxalic acid</strong> readily<strong> combines</strong> with the<strong> calcium</strong> ion in the body tissues and\u00a0forms calcium oxalate.</p>\n<p>The features of oxalic acid poisoning include tenderness in the epigastrium, nausea,\u00a0followed by<strong>\u00a0coffee ground-colored vomitus</strong>, severe thirst, diarrhea, electrolyte imbalance, and death.</p>\n<p><strong>Acute features </strong>of oxalic acid poisoning are mainly due to <strong>hypocalcemia</strong> such as:\u00a0</p>\n<ul>\n<li>Muscle irritability</li>\n<li>Tenderness</li>\n<li>Tetany</li>\n<li>Convulsions</li>\n<li>Tingling of extremities</li>\n<li>Coma</li>\n<li>Collapse and death</li>\n</ul>\n<p><strong>Delayed features\u00a0</strong>of oxalic acid poisoning include\u00a0<strong>uremia</strong>. Urine is scanty\u00a0with traces of albumin, blood, and <strong>calcium oxalate crystals</strong> (seen microscopically as envelope-shaped crystals). Large doses of oxalic acid cause shock and lead to death.\u00a0</p>\n<p><strong>Antidotes:</strong>\u00a0Lime water, calcium lactate, calcium gluconate, calcium chloride, and chalk suspension in water or milk\u00a0may be given orally, and act as specific antidotes, which form insoluble calcium oxalate and are excreted easily.</p>\n<p><strong>Medicolegal importance:\u00a0</strong>Oxalic acid is used to erase writing in attempts at forgery.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/03c0b6a1954f4c6fa84a7f07965a2504.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A worker found in a burning chemical factory is brought to the emergency in a state of hypotension and is suspected to have been exposed to hydrogen cyanide gas. Which of the following is best avoided during his management?",
    "choices": [
      {
        "id": 1,
        "text": "3% Sodium nitrite solution"
      },
      {
        "id": 2,
        "text": "25% solution Sodium thiosulfate"
      },
      {
        "id": 3,
        "text": "5 g Hydroxocobalamin"
      },
      {
        "id": 4,
        "text": "Sodium bicarbonate"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Nitrites</strong> should be avoided in patients with\u00a0<strong>cyanide toxicity</strong> presenting with <strong>hypotension,\u00a0</strong>especially in the setting of concomitant carbon monoxide exposure.</p>\n<p>Burning buildings are a source of carbon monoxide exposure and can result in carboxyhaemoglobin. Nitrites are used in cyanide poisoning because of their ability to form methemoglobin, which binds cyanide more avidly than the ferric iron of cytochrome oxidase. <strong>Nitrite therapy</strong> should be <strong>avoided</strong> for those with <strong>both cyanide and CO poisoning</strong> because these compounds work by inducing methemoglobin formation, which further reduces the oxygen content of blood in patients with carboxyhemoglobin accumulation.</p>\n<p>Treatment of <strong>Cyanide Poisoning</strong> in <strong>Adults</strong></p>\n<ol>\n<li>100% oxygen</li>\n<li>IV crystalloids and vasopressors for hypotension</li>\n<li>Sodium bicarbonate for acidemia</li>\n<li class=\"p1\"><strong>Either</strong> Cyanide antidote kit\n<ul>\n<li>Amyl nitrite inhaler - crack vial and inhale over 30 s.</li>\n<li>3% solution Sodium nitrite\u00a0 -300 mg IV given over no less than 5 min.</li>\n<li>25% solution Sodium thiosulfate: 12.5 g IV.\u00a0</li>\n</ul>\n</li>\n<li><strong>Or</strong> Hydr<strong>oxo</strong>cobalamin -\u00a05 g IV over 15 min, up to 10 g.\u00a0</li>\n</ol>\n<p>Hydr<strong>oxo</strong>cobalamin(Vitamin B12a) is a <strong>metalloprotein</strong> with a cobalt center that <strong>binds cyanide</strong>, thereby removing it from cytochrome oxidase and <strong>forming cyanocobalamin</strong>. It is FDA-approved for the management of cyanide poisoning and is considered <strong>ideal in</strong> cases where the <strong>diagnosis</strong> of cyanide poisoning is <strong>uncertain</strong> <strong>or</strong> in cases where the <strong>methemoglobinemia induction would be detrimental,\u00a0</strong>i.e.,\u00a0concomitant exposure to carbon monoxide as in building fires.</p>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 38-year-old woman was found unconscious in her room by her husband. Beside her, he found an empty bottle of phenobarbital which she was prescribed for seizures. He rushed her to the ER. All of the following can be done to manage this case except:",
    "choices": [
      {
        "id": 1,
        "text": "Gastric lavage by activated charcoal"
      },
      {
        "id": 2,
        "text": "Hemodialysis to remove the drug"
      },
      {
        "id": 3,
        "text": "Flumazenil as an antidote"
      },
      {
        "id": 4,
        "text": "Alkaline diuresis to excrete the drug"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario suggests <strong>barbiturate poisoning</strong>.<strong> Flumazenil&nbsp;</strong>is a <strong>benzodiazepine antagonist</strong> and has no effect on barbiturate toxicity.&nbsp;There is no antidote for barbiturate poisoning.</p>\n<p>Management of barbiturate poisoning:</p>\n<ul>\n<li>Maintain airway, breathing, circulation</li>\n<li>Electrolyte balance</li>\n<li>Gastric lavage</li>\n<li>Alkaline diuresis by giving sodium bicarbonate</li>\n<li>Hemodialysis in severe cases</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient was brought to the emergency room with complaints of headache, vomiting, and blurring of vision after he consumed a bottle of illicit liquor. His ABG shows metabolic acidosis. Which of the following is used for the treatment of his condition?",
    "choices": [
      {
        "id": 1,
        "text": "Fomepizole"
      },
      {
        "id": 2,
        "text": "Flumazenil"
      },
      {
        "id": 3,
        "text": "N-acetyl cysteine"
      },
      {
        "id": 4,
        "text": "Naloxone"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<div class=\"ng-scope\">\n<p class=\"ng-binding\">The above clinical scenario and the Arterial blood gas analysis (ABG) showing metabolic acidosis is suggestive of&nbsp;<strong>methanol toxicity.&nbsp;</strong><strong>Fomepizole</strong> is used for the treatment of this condition.</p>\n<p class=\"ng-binding\"><strong>Methanol poisoning</strong> is caused due to ingestion of illicit liquor which contains ethanol adulterated with methanol. Methanol is metabolized to formaldehyde and formic acid by alcohol and aldehyde dehydrogenases, respectively. The metabolites of methanol are responsible for the toxic effects.</p>\n<p class=\"ng-binding\">Clinically, patients present with <strong>headache, vomiting,</strong> abdomen pain, uneasiness, confusion, delirium, and coma. Formic acid specifically damages the retina and optic nerve and results in <strong>blurring of vision</strong> and blindness.</p>\n<p class=\"ng-binding\">Elevated levels of formic acid and other organic acids result in<strong>&nbsp;metabolic acidosis</strong> on ABG.</p>\n<p class=\"ng-binding\">Treatment of methanol poisoning includes keeping the patient in a quiet, dark room to protect the eyes from the light. <strong>Gastric lavage</strong> with <strong>sodium bicarbonate</strong> if the patient is brought within 2 hours of ingesting methanol to combat acidosis. <strong>Ethanol infusion</strong> since ethanol is preferentially metabolized by alcohol dehydrogenase over methanol and helps by reducing the rate of generation of formaldehyde and formic acid.</p>\n<p class=\"ng-binding\"><strong>Fomepizole</strong> is a specific inhibitor of alcohol dehydrogenase and the drug of choice for methanol poisoning. Folate therapy with calcium leucovorin reduces blood formate levels by enhancing its oxidation. <strong>Hemodialysis</strong> is used in <strong>severe cases</strong> of methanol toxicity.</p>\n<p>Other options:&nbsp;</p>\n<div class=\"ng-scope\">\n<p class=\"ng-binding\">Option B: <strong> Flumazenil </strong>is the inverse agonist of benzodiazepine receptors and is used for the treatment of <strong>benzodiazepine</strong> overdose.</p>\n<p class=\"ng-binding\">Option C: <strong>N-acetyl cysteine </strong>is used as an antidote for the treatment of <strong>paracetamol</strong> poisoning.</p>\n<p class=\"ng-binding\">Option D: <strong>Naloxone </strong>is a competitive opioid antagonist used for the treatment of <strong>opioid</strong> overdose.</p>\n<div class=\"ng-scope\">&nbsp;</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following drugs can be used as an antidote for fibrinolytic therapy?",
    "choices": [
      {
        "id": 1,
        "text": "Protamine"
      },
      {
        "id": 2,
        "text": "Streptokinase"
      },
      {
        "id": 3,
        "text": "Heparin"
      },
      {
        "id": 4,
        "text": "\u03b5-Aminocaproic acid"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>&epsilon;-Aminocaproic acid</strong> can be used as an antidote for fibrinolytic therapy.</p>\n<p>It is a lysine analog that binds competitively to plasminogen, blocking plasminogen from binding to fibrin and the subsequent conversion to plasmin. This activity subsequently results in the <strong>inhibition of fibrinolysis.</strong></p>\n<p>It should not be given unless hemorrhage is life-threatening because it inhibits intrinsic fibrinolytic activity and <strong>can precipitate DIC.</strong>&nbsp;Fresh frozen plasma and cryoprecipitate may also be used to replenish fibrin and clotting factors.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/114b5293e3404eddbd69d440272edb0ex1280x1988.JPEG"
    ]
  },
  {
    "text": "A 27-year-old male patient on anticoagulant therapy for his DVT started coughing up blood. He has a history of irregular warfarin intake. Workup revealed elevated INR and diffuse alveolar hemorrhage. Which of the following agents would be the best choice for immediate reversal of bleeding?",
    "choices": [
      {
        "id": 1,
        "text": "Cryoprecipitate"
      },
      {
        "id": 2,
        "text": "Fresh frozen plasma"
      },
      {
        "id": 3,
        "text": "Prothrombin complex concentrates"
      },
      {
        "id": 4,
        "text": "Vitamin K1"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Immediate or urgent reversal of <strong>warfarin-induced bleeding</strong> is best achieved by the administration of <strong>prothrombin complex concentrates</strong> (PCC).</p>\n<p>These are highly purified concentrates prepared from pooled plasma and contain&nbsp;<strong>factors II, IX, and X</strong>. Factor VII may be included or produced separately.</p>\n<p>Option D<strong>: Vitamin K1</strong>&nbsp;is the specific antidote for warfarin-induced bleeding, but it <strong>takes 6-24 hours</strong> for the clotting factors to be resynthesized and released in blood after Vitamin K administration and hence its action is delayed for several hours.&nbsp;&nbsp;</p>\n<p>Option A: Cryoprecipitate mainly contains factor VIII and fibrinogen and therefore is not suitable for warfarin-induced bleeding, as warfarin inhibits factors II,&nbsp;VII,&nbsp;IX, X.</p>\n<p>Option B: Fresh frozen plasma can also be used but prothrombin complex concentrate normalizes the INR more rapidly.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Acrodynia is seen in poisoning with which of the following metals?",
    "choices": [
      {
        "id": 1,
        "text": "Arsenic"
      },
      {
        "id": 2,
        "text": "Cadmium"
      },
      {
        "id": 3,
        "text": "Lead"
      },
      {
        "id": 4,
        "text": "Mercury"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Acrodynia,</strong> or pink disease, is seen in <strong>chronic</strong>\u00a0<strong>mercury poisoning</strong>.</p>\n<p>Acrodynia<strong>\u00a0</strong>is the <strong>dermatological manifestation</strong> of mercury poisoning. Children are usually affected by this <strong>hypersensitivity reaction</strong>. It is characterized by sweating and skin rash, with hands and feet becoming puffy, pinkish, and painful. Associated paresthesia and skin peeling are also seen.</p>\n<p>Features of <strong>chronic mercury poisoning\u00a0</strong>include:</p>\n<ul>\n<li><strong>Hydrargyrism</strong> - These patients have <strong>Danbury tremors</strong>, which are coarse, intentional tremors. The advanced condition is called Hatter's shakes/ Glass blower's shakes</li>\n<li><strong>Acrodynia</strong> (pink disease)</li>\n<li><strong>Minimata disease</strong> - caused by the eating of fish poisoned by mercury</li>\n<li><strong>Erethism</strong> - these are<strong> </strong>psychological symptoms due to mercury toxicity seen in mirror manufacturing firms. It is characterised by shyness, timidity, irritability, loss of confidence, mental depression, loss of memory, and insomnia</li>\n<li><strong>Mercuria lentis</strong> - pecul<strong>iar eye changes</strong> due to exposure to mercury vapor.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Identify the medical presentations associated with the deliriant poison derived from the plant given below.",
    "choices": [
      {
        "id": 1,
        "text": "1, 4, and 5 only"
      },
      {
        "id": 2,
        "text": "2 and 3 only"
      },
      {
        "id": 3,
        "text": "3, 4, and 5 only"
      },
      {
        "id": 4,
        "text": "1 and 2 only"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given plant is&nbsp;<strong><em>Erythroxylum coca</em>.&nbsp;</strong><strong>Cocaine</strong> is the principal alkaloid found in the cultivated varieties of coca.&nbsp;The correct answer is<strong> 1, 4, and 5 only.</strong></p>\n<div>\n<p>Cocaine&nbsp;is a&nbsp;<strong>CNS stimulant.&nbsp;</strong>CNS stimulation (anxiety, hyperactivity), CVS overactivity (tachycardia, hypertension), and increased respiratory rate are seen in poisoning with cocaine causing sympathetic toxidrome.</p>\n<p>The water-soluble form (-hydrochloride) can be&nbsp;<strong>injected or snorted</strong>. Tattoos may be made to cover the injection marks. Whilst another form (-sulfate) can be smoked. It gives a cracking sound when burnt. It&nbsp;<strong>inhibits</strong>&nbsp;the&nbsp;<strong>uptake</strong>&nbsp;of&nbsp;<strong>dopamine, norepinephrine, and serotonin</strong>. It thus, enhances the action of these neurotransmitters.</p>\n<div>It causes digestive disturbances, anorexia, salivation, tachycardia, tachypnoea, and insomnia. The face is pale, eyes sunken, pupils dilated, and the <strong>gaze is shifty</strong>.&nbsp;</div>\n<div>&nbsp;</div>\n<div><strong>Magnan's syndrome</strong>&nbsp;or <strong>cocaine bugs</strong>&nbsp;is a characteristic feature in which there is a feeling as if grains of sand are under the skin or as if small insects are creeping on the skin, giving rise to an itching sensation (formication, tactile hallucination) and resultant excoriation, which leads to irregular scratches&nbsp;and ulcers.</div>\n<div>&nbsp;</div>\n<div>It is a drug of addiction and causes a lowering of moral tone and <strong>loss of decency</strong> and<strong> self-respect</strong>. Sniffing habits leads to <strong>nasal septum ulceration.</strong></div>\n<p>Initial management involves the administration of activated charcoal and gastric lavage if it has been ingested.</p>\n<p><strong>Treatment</strong>&nbsp;involves the administration of&nbsp;<strong>benzodiazepines</strong>&nbsp;to control heart rate/ seizures, propranolol to control cardiac arrhythmia, and haloperidol to treat psychosis. Counseling needs to be done to avoid resisting the urge for repetitive usage.&nbsp;</p>\n<p>Other options: Run amok and amotivational syndrome are associated with chronic poisoning with <em><strong>Cannabis sativa</strong></em>.</p>\n<ul>\n<li><strong>Amotivational syndrome&nbsp;</strong>- Chronic use of&nbsp;<strong><em>Cannabis</em>&nbsp;</strong>may lead to amotivational syndrome with lethargy, and lack of interest in day-to-day activities.</li>\n<li><strong>Run-amok&nbsp;</strong>-&nbsp;Run-amok is a psychic disturbance resulting from the continued use or sudden consumption of <em><strong>Cannabis</strong></em>&nbsp;and is characterized by a peculiar homicidal mania. The person is not held responsible for his acts since &lsquo;run amok&rsquo; is considered a disorder of mind and not intoxication.</li>\n</ul>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/8c3618dcd5494e39bbcaa39d8432bd08.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A young man was brought dead following deliberate consumption of the given plant. All of the aspects of this plant are true, except ______.",
    "choices": [
      {
        "id": 1,
        "text": "Smoke from burning plant carries the toxic material"
      },
      {
        "id": 2,
        "text": "Can be detected even from the burnt dead body"
      },
      {
        "id": 3,
        "text": "The nectar yields poisonous honey"
      },
      {
        "id": 4,
        "text": "Only the flowers are poisonous"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given plant is <em><strong>Nerium odorum</strong></em>, <strong>all parts</strong> of the <strong>plant </strong>are<strong> poisonous,</strong> except the roots.</p>\n<p><strong>Oleanders:\u00a0</strong>They are of two varieties -\u00a0</p>\n<ul>\n<li>Nerium odorum or <strong>white oleander</strong> -\n<ul>\n<li>Bears with white or pink flowers</li>\n<li>All parts of the plant are poisonous except the roots</li>\n<li>They contain cardiac glycosides - primarily<strong> oleandroside (oleandrin)</strong> and <strong>nerioside (nerin)</strong></li>\n<li>The <strong>nectar </strong>of the flower <strong>yields poisonous honey</strong></li>\n</ul>\n</li>\n<li><em><strong>Cerbera thevetia</strong></em> or yellow oleander -\n<ul>\n<li>All parts of the plant are poisonous</li>\n<li>All active principles are glycosides</li>\n</ul>\n</li>\n</ul>\n<p>The<strong>\u00a0manifestations\u00a0</strong>of\u00a0<em>Nerium odorum</em> poisoning includes <strong>contact dermatitis,\u00a0</strong>headache, dizziness, respiratory difficulty and nausea. Ingestion may lead to vomiting, abdominal pain, frothy salivation and diarrhea. Initially, there is bradycardia followed by tachycardia and again weak pulses. Other changes include hypotension, fibrillation, AV block, mydriasis, tetanic spasms, lock-jaw, drowsiness, and coma.<strong> Death</strong> is usually from <strong>cardiac failure</strong>.\u00a0</p>\n<p>The manifestation of <em>Cerbera thevetia</em> poisoning include <strong>burning sensation</strong> in the mouth, tingling of the tongue, dryness of the throat, vomiting, diarrhea, headache, dilated pupils, irregular action of the heart followed by drowsiness, coma, collapse, and death.</p>\n<p>Postmortem appearances: Organs appear congested. The <strong>Nerium resists heat</strong>, therefore can be detected even from the burnt dead body.</p>\n<div class=\"page\" title=\"Page 548\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Medicolegal aspects: Suicide with this is common among villagers, accidental poisoning can also be seen, but homicide is rare. It is also used as cattle poison. <strong>Smoke</strong> from <strong>burning plants </strong>carries<strong>\u00a0toxic material</strong>.</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/df77b01bc6de4b3ab59db31cc5812049.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A person has been bitten by the following snake. Which of the following options describe the symptoms seen classically in this snake bite?",
    "choices": [
      {
        "id": 1,
        "text": "Anaphylaxis"
      },
      {
        "id": 2,
        "text": "Intravascular hemolysis"
      },
      {
        "id": 3,
        "text": "Myoglobinuria"
      },
      {
        "id": 4,
        "text": "Neurotoxicity and muscle paralysis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The image given above shows <strong>common krait,</strong> which is <strong>neurotoxic</strong> and shows classical symptoms such as\u00a0<strong>muscle paralysis</strong>.</p>\n<p>The neurotoxicity symptoms that would be seen in the patient include:\u00a0</p>\n<ul>\n<li>headache</li>\n<li>blurred vision</li>\n<li>perioral paraesthesia</li>\n<li>hyperacusis</li>\n<li>dizziness</li>\n<li>vertigo</li>\n<li>gooseflesh</li>\n<li>vomiting</li>\n<li>hypersalivation</li>\n</ul>\n<p>Neurotoxicity effects are <strong>completely reversible</strong> in response to antivenom or anticholinesterase or they may wear off spontaneously in about a week.</p>\n<p>Other options:</p>\n<p>Option A: <strong>Anaphylaxis</strong> is seen in poisoning due to <strong>stiletto snakes</strong>. Other symptoms include pain, swelling, blisters and local lymph node enlargements.</p>\n<p>Option B: Systemic bleeding such as <strong>intravascular hemolysis</strong>, ecchymosis and incoagulable blood is seen in bites due to <strong>back fanged snakes.</strong></p>\n<p>Option C: <strong>Myoglobinuria</strong> is seen in poisoning due to <strong>sea snakes.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c2ad706972aa493e8bec936acaf2b4fe.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 22-year-old man comes to the emergency room with profound drowsiness. On examination, he is found to have respiratory depression, with a respiratory rate of 5 cycles/minute. His symptoms are traced back to a drug derived from the plant shown below. Which of the following is the antidote to this patient's condition?",
    "choices": [
      {
        "id": 1,
        "text": "Flumazenil"
      },
      {
        "id": 2,
        "text": "Naloxone"
      },
      {
        "id": 3,
        "text": "Physostigmine"
      },
      {
        "id": 4,
        "text": "Atropine"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The suitable antidote to this patient presenting with features of\u00a0<strong>opiate intoxication\u00a0</strong>is\u00a0<strong>naloxone.\u00a0</strong>The derivative drug,\u00a0<strong>opium\u00a0</strong>is derived from the\u00a0<strong>Papaver somniferum\u00a0</strong>plant as shown in the clinical vignette.</p>\n<p>Toxic parts of the plant include the unripe fruit capsule and the latex juice. Active principles of opium are grouped under\u00a0<strong>phenanthrenes (morphine, codeine, heroin)\u00a0</strong>and\u00a0<strong>benzyl-isoquinolones</strong> <strong>(papaverine, narcotin)</strong>.</p>\n<p>These drugs act on mu, kappa, delta receptors in the CNS and mediate the effects of euphoria, analgesia, respiratory depression, gastrointestinal dysmotility, and miosis.\u00a0</p>\n<p>The antidote to opiate intoxication is a <strong>competitive opiate antagonist</strong> named\u00a0<strong>naloxone\u00a0</strong>which competes with opioids at their receptor sites. Dose: 0.4-2 mg IV (It may be repeated every 10-15 minutes up to a maximum dose of 10 mg).</p>\n<p>Other options:</p>\n<p>Option A - <strong>Flumazenil</strong> is the<strong> antidote to treat benzodiazepine (BZD)</strong> intoxication. Benzodiazepines (alprazolam, flunitrazepam) are sedative-hypnotics and symptoms of intoxication include normal vital signs, sedation, diplopia, ataxia, slurred speech, and impaired motor function. Flumazenil acts as a competitive antagonist at the site of BZD action, which is the gamma-aminobutyric acid receptor.\u00a0</p>\n<p>Option C - <strong>Physostigmine </strong>is used in the <strong>treatment of anticholinergic toxicity due to atropine</strong>. Atropine is the anticholinergic active principle derived from tropane alkaloids such as Datura stramonium and Atropa belladonna. Toxidrome consists of features such as tachycardia, hyperthermia, agitation, delirium, mydriasis, dry flushed skin, and urinary retention. Physostigmine is a reversible acetylcholine esterase inhibitor that increases acetylcholine concentrations in the synaptic cleft to mitigate the effects of atropine toxicity.\u00a0</p>\n<p>Option D - <strong>Atropine</strong> is used in the<strong> treatment of cholinergic toxicity due to organophosphates (DDT, parathion, malathion)</strong>. Symptoms of cholinergic toxicity include bradycardia, respiratory depression, and autonomic symptoms of salivation, lacrimation, urination, defecation. Atropine used in association with pralidoxime act as competitive inhibitors at the nicotinic and muscarinic acetylcholine receptors to neutralize the toxicity.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/6c7565a36e314be5ad62f6660249c864.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A patient on anticoagulant therapy presented to the casualty with an uncontrolled bleeding episode and was given IV protamine sulfate. However, the patient did not respond to the treatment. Which of the following anticoagulant agents was most likely being used by the patient?",
    "choices": [
      {
        "id": 1,
        "text": "Unfractionated heparin"
      },
      {
        "id": 2,
        "text": "Enoxaparin"
      },
      {
        "id": 3,
        "text": "Dalteparin"
      },
      {
        "id": 4,
        "text": "Fondaparinux"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p style=\"text-align: justify;\">Since <strong>no effect</strong>&nbsp;was noted with <strong>protamine sulfate</strong>, the likely anticoagulant in use must be <strong>fondaparinux</strong>.<strong>&nbsp;</strong>This is because&nbsp;protamine sulfate <strong>fails to bind</strong> the drug.&nbsp;</p>\n<p style=\"text-align: justify;\">Protamine sulfate binds tightly to <strong>heparin</strong> and <strong>neutralizes</strong> its anticoagulant effect. It&nbsp;<strong>partially reverses</strong> the anticoagulant activity of <strong>LMWH</strong>&nbsp;also. But it has no effect on fondaparinux.</p>\n<p style=\"text-align: justify;\">There is <strong>no known specific antidote</strong> approved for use in fondaparinux overdose. Fondaparinux-associated bleeding complications are managed by treatment discontinuation and search for the primary cause. Surgical hemostasis, blood replacements, fresh plasma transfusion, plasmapheresis should be considered.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = 'Poisons & Antidotes Mini Test - -Tmt';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2023-24"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>