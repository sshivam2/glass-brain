<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Renal Tubular Disorders Mini Test - -Tmt - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2024-25
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A patient is suspected to have renal tubular acidosis. His lab parameters show elevated potassium levels and metabolic acidosis. Identify the correct pair describing the diagnosis from the following options.",
    "choices": [
      {
        "id": 1,
        "text": "Renal tubular acidosis 4 - Hyperaldosteronism"
      },
      {
        "id": 2,
        "text": "Renal tubular acidosis 1 - Impaired H+ secretion"
      },
      {
        "id": 3,
        "text": "Renal tubular acidosis 4 - Hypoaldosteronism"
      },
      {
        "id": 4,
        "text": "Renal tubular acidosis 2 - Impaired HCO3- reabsorption"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Renal tubular acidosis 4 - hypoaldosteronism is the correct pair that explains the diagnosis of the given patient.</p>\n<p><strong>RTA 4</strong> (hyperkalemic renal tubular acidosis) is associated with <strong>aldosterone deficiency or resistance</strong>, leading to <strong>impaired potassium excretion</strong>, leading to <strong>hyperkalemia</strong> and <strong>metabolic acidosis</strong>.</p>\n<p>RTA refers to a group of disorders with impaired tubular transport of H+ and/or HCO3- despite relatively well-preserved renal function. There are <strong>4 types</strong>:</p>\n<ul>\n<li>Type I - impaired H+ secretion (distal), leading to decreased HCO3- production</li>\n<li>Type II - impaired HCO3- reabsorption (proximal)</li>\n<li>Type III - carbonic anhydrase deficiency causing defects in the transport of both H+ and HCO3- (mixed)</li>\n<li>Type IV - hypoaldosteronism (hyperkalemic)</li>\n</ul>\n<p>The overall deficiency of HCO3- in all the types is compensated by Cl- secretion. Hence, the serum anion gap remains normal.</p>\n<p>Other options:</p>\n<p>Option A: <strong>RTA 4 </strong>causes features of hypoaldosteronism and <strong>not hyperaldosteronism</strong>. So, this option is incorrect.</p>\n<p>Option B: <strong>RTA 1</strong> (Distal Renal Tubular Acidosis): This condition is characterised by <strong>impaired acid secretion</strong> in the <strong>distal renal tubules</strong>, leading to metabolic acidosis. <strong>Hypokalemia</strong> can occur due to the compensatory secretion of potassium to maintain electroneutrality.\u00a0</p>\n<p>Option D:<strong> RTA 2</strong> (Proximal Renal Tubular Acidosis): This condition involves <strong>impaired bicarbonate reabsorption</strong> in the <strong>proximal tubules</strong>, leading to metabolic acidosis. <strong>Hypokalemia</strong> can occur due to urinary losses of potassium.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient is undergoing evaluation for an inherited renal tubular disorder. Physical examination showed normal blood pressure. Further tests showed metabolic alkalosis and hypokalemia with hypercalciuria. The affected part of this disorder is  ___",
    "choices": [
      {
        "id": 1,
        "text": "Distal convoluted tubule"
      },
      {
        "id": 2,
        "text": "Ascending limb of Henle"
      },
      {
        "id": 3,
        "text": "Proximal convoluted tubule"
      },
      {
        "id": 4,
        "text": "Collecting duct"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The affected part of this disorder is the <strong>a</strong><strong>scending limb of Henle.</strong> The clinical scenario of a <strong>renal tubular disorder</strong> causing polyuria, polydipsia, <strong>normal blood pressure</strong>, <strong>metabolic alkalosis, and hypokalemia </strong>with <strong>hypercalciuria</strong> is suggestive of <strong>Bartters syndrome. </strong>Inherited renal tubular disorders are a diverse group of genetic conditions affecting the renal tubules.</p>\n<p>Bartter Syndrome is a group of 4 disorders affecting sodium, potassium, and chloride channels in the <strong>thick ascending limb of Henle.</strong>\u00a0 It causes <strong>h</strong><strong>ypokalemia, metabolic alkalosis, hypercalciuria, and normal to low blood pressure</strong>.</p>\n<p>Other options:</p>\n<p>Option A: <strong>Distal convoluted tubule: Gitelman syndrome </strong>affects the distal convoluted tubule due to a mutation in the gene encoding the thiazide-sensitive Na-Cl cotransporter. It causes <strong>hypokalemia, hypomagnesemia, hypocalciuria,</strong> and <strong>metabolic alkalosis.</strong></p>\n<p>Option C: <strong>Proximal convoluted tubule</strong>: A generalized reabsorption defect in the proximal convoluted tubule causes <strong>glycosuria, aminoaciduria, phosphaturia, bicarbonaturia,</strong> and <strong>proximal renal tubular acidosis</strong> (type II). This happens in <strong>Fanconi Syndrome,</strong> which can be associated with genetic conditions like cystinosis, Lowe syndrome, Wilson disease, and galactosemia.\u00a0</p>\n<p>Option D:<strong>\u00a0Collecting Duct:</strong> The epithelial sodium channels <strong>(ENaC)</strong> in the <strong>principal cells</strong> of the collecting ducts are affected in<strong> Liddle Syndrome</strong>. It is pseudohyperaldosteronism due to mutations in the SCNN1B or SCNN1G genes leading to <strong>hypertension, hypokalemia,</strong> and <strong>metabolic alkalosis.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 32-year-old man was referred to cardiology OPD for the management of hypertension. His BP was not controlled with spironolactone and laboratory investigations revealed hypokalemia & metabolic alkalosis. His BP comes down when spironolactone is replaced with amiloride. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Syndrome of apparent mineralocorticoid excess"
      },
      {
        "id": 2,
        "text": "Liddle syndrome"
      },
      {
        "id": 3,
        "text": "Addison disease"
      },
      {
        "id": 4,
        "text": "Bartter syndrome"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In the given clinical scenario of a young patient with <strong>hypertension</strong>, <strong>hypokalemia</strong>, and <strong>metabolic alkalosis</strong>, <strong>responding to amiloride</strong> but <strong>not spironolactone</strong>, a diagnosis of&nbsp;<strong>Liddle syndrome</strong> (also known as <strong>pseudohyperaldosteronism)&nbsp;</strong>is most likely.</p>\n<p>Liddle syndrome is due to the autosomal dominant <strong>gain of function</strong> mutation in epithelium sodium channel, <strong>ENaC,</strong>&nbsp;in collecting tubules. It classically causes <strong>hypertension </strong>in<strong> young </strong>patients<strong>, </strong>along with<strong> hypokalemia </strong>and<strong> metabolic alkalosis. </strong>The disease&nbsp;<strong>responds to amiloride</strong> but is&nbsp;<strong>resistant to spironolactone</strong>. Although its presentation is similar to primary hyperaldosteronism, <strong>aldosterone</strong> is nearly <strong>undetectable</strong> in the serum due to negative feedback. Hence it is also known as pseudohyperaldosteronism.</p>\n<p>Other options:</p>\n<p>Option A: <strong>Syndrome of apparent mineralocorticoid excess (SAME)</strong> occurs due to the <strong>activation</strong> <strong>of</strong> <strong>mineralocorticoid</strong> <strong>receptors</strong> by cortisol, like in 11-&beta;-hydroxysteroid dehydrogenase deficiency. It also presents with <strong>hypertension</strong>, <strong>hypokalemia,</strong> and <strong>metabolic alkalosis</strong>, but mineralocorticoid receptor blockade with spironolactone is successful in treating SAME. Spironolactone does not work in Liddle syndrome because the defect is downstream to where spironolactone acts.</p>\n<p>Option C: <strong>Addison's disease</strong> refers to adrenal insufficiency and <strong>decreased</strong> levels of <strong>aldosterone</strong>. It presents with <strong>hyponatremic volume contraction</strong> (which may lead to hypotension), <strong>hyperkalemia,</strong> and <strong>metabolic acidosis</strong>.</p>\n<p>Option D: <strong>Bartter syndrome</strong> is an autosomal recessive renal tubular reabsorption <strong>defect in Na<sup>+</sup>/K<sup>+</sup>/2Cl<sup>-</sup> channel</strong>. It causes <strong>hypokalemia</strong>, hypercalciuria, and <strong>metabolic alkalosis</strong>. But <strong>BP is usually low to normal</strong>. It mimics chronic loop diuretic use.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An infant under evaluation was found to have autosomal recessive defects in the gene for the enzyme carbonic anhydrase II. The diagnosis of Marble brain disease or Guibaud-Vainsel syndrome is made. Which of the following is not seen in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "RTA type 3"
      },
      {
        "id": 2,
        "text": "Cranial nerve defects"
      },
      {
        "id": 3,
        "text": "Osteopenia"
      },
      {
        "id": 4,
        "text": "Cerebral calcification"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The clinical manifestation that is not typically associated with <strong>marble brain disease (osteopetrosis)</strong> is <strong>osteopenia.</strong></p>\n<p>Osteopenia refers to <strong>lower-than-normal bone density</strong> but is not a feature of marble brain disease, which is characterized by increased bone density and abnormal bone formation (<strong>osteopetrosis</strong>).</p>\n<p><strong>Marble brain disease or Guibaud-Vainsel syndrome</strong> is a <strong>rare genetic disorder</strong> caused by<strong> a defect in osteoclasts,</strong> leading to excessive bone formation and brittle, dense bones. It is due to an<strong> autosomal recessive</strong>, inherited <strong>carbonic anhydrase-2 (CA-2) deficiency.</strong> <strong>Carbonic anhydrase II</strong> is required by osteoclasts and renal tubular cells to generate protons from carbon dioxide and water <strong>(acidification).</strong> The absence of carbonic anhydrase II <strong>prevents</strong> osteoclasts from<strong> acidifying the resorption pit</strong> and <strong>dissolution of calcium hydroxyapatite</strong> within the bone matrix. It also <strong>blocks the acidification of urine </strong>by the renal tubular cells. This leads to<strong> reduced bone resorption</strong> and <strong>diffuse symmetric skeletal sclerosis</strong>.</p>\n<p>This abnormal bone growth can result in various clinical manifestations.</p>\n<ul>\n<li>Cerebral calcifications</li>\n<li>Mental retardation\u00a0</li>\n<li>Cranial nerve defects</li>\n<li>Mixed RTA (Type 3 RTA)</li>\n<li>Osteopetrosis</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A young patient presented with hypokalemia and metabolic acidosis. Which of the following is the likely underlying abnormality?",
    "choices": [
      {
        "id": 1,
        "text": "Fanconi syndrome"
      },
      {
        "id": 2,
        "text": "Gitelman syndrome"
      },
      {
        "id": 3,
        "text": "Bartter syndrome"
      },
      {
        "id": 4,
        "text": "Liddle syndrome"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Fanconi syndrome</strong> presents with <strong>type 2 renal tubular acidosis (RTA)</strong> and causes <strong>hypokalemia</strong> and <strong>metabolic acidosis</strong>.</p>\n<p><strong>Type 2 RTA</strong> occurs because of a <strong>defect in the proximal tubule HCO<sub>3</sub><sup>-</sup> reabsorption.</strong> There is i<strong>ncreased excretion of HCO<sub>3</sub><sup>-</sup></strong>, leading to <strong>metabolic acidosis</strong>. There is<strong> increased delivery of</strong> the <strong>tubular fluid to</strong> the <strong>distal tubule</strong>, leading to <strong>increased Na<sup>+</sup> reabsorption</strong> and <strong>K<sup>+</sup> secretion</strong> in the distal tubule under the effect of aldosterone. Note that the effect of HCO<sub>3</sub><sup>-</sup> loss overpowers the H<sup>+</sup> loss in the distal tubule due to aldosterone, and thus the net result is metabolic acidosis. The <strong>urine pH is mostly &lt;5.5</strong> because of the <strong>depletion of the HCO<sub>3</sub><sup>-</sup> stores</strong> in the body, but it <strong>can be &gt;5.5 early in the disease</strong> course due to excess filtered HCO<sub>3</sub><sup>-</sup>. The <strong>causes of type 2 RTA</strong> include <strong>Fanconi syndrome</strong>, <strong>multiple myeloma</strong>, and <strong>Wilson's disease</strong>.</p>\n<p>Other options:</p>\n<p>Option B: <strong>Gitelman syndrome </strong>causes <strong>increased fluid delivery</strong> to the distal tubule, leading to more Na+ absorption, and increased H+ and K+ secretion under the influence of aldosterone. Thus, it causes <strong>metabolic alkalosis</strong> and <strong>hypokalemia.</strong></p>\n<p>Option C: <strong>Bartter syndrome</strong>\u00a0also causes <strong>increased\u00a0Na<sup>+</sup> absorption</strong>, and <strong>increased H<sup>+</sup> and K<sup>+</sup> secretion</strong> under the influence of aldosterone, thus, causing<strong> metabolic alkalosis and hypokalemia</strong>.</p>\n<p><strong>\u00a0</strong>Option D:\u00a0<strong> Liddle syndrome</strong>\u00a0occurs due to a <strong>gain of function mutation in the ENaC</strong> channels in the distal tubule. It also causes <strong>metabolic alkalosis</strong> and <strong>hypokalemia</strong> by similar mechanisms.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following agents is administered in the management of a patient with proximal renal tubular acidosis?",
    "choices": [
      {
        "id": 1,
        "text": "Potassium citrate"
      },
      {
        "id": 2,
        "text": "Fludrocortisone"
      },
      {
        "id": 3,
        "text": "Furosemide"
      },
      {
        "id": 4,
        "text": "Patiromer"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>A combination of <strong>sodium</strong> and <strong>potassium citrate</strong> is administered in the management of a patient with<strong> proximal renal tubular acidosis</strong>. Here, <strong>citrate</strong> acts as a <strong>source of bicarbonate</strong> ions.</p>\n<p><strong>Proximal renal tubular acidosis</strong> (RTA) is caused by the <strong>defective reabsorption of bicarbonate ions</strong> in the<strong> proximal tubule.</strong> <strong>Administration of alkali </strong>to correct the bicarbonate loss causes <strong>hypokalemia</strong> and hence potassium is given along with a source of bicarbonate ions. Proximal RTA is <strong>usually associated with Fanconi syndrome</strong> characterized by glycosuria, phosphaturia, and aminoaciduria in addition to bicarbonaturia.</p>\n<p>Fludrocortisone (Option B), furosemide (Option C), and Patiromer (Option D) (calcium-potassium cation exchange polymer) are administered in <strong>generalised distal RTA (type 4 RTA)</strong> to correct hyperkalemia and metabolic acidosis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 40-year-old female has complaints of marked dryness in her mouth associated with difficulty in swallowing. Schirmer's test is suggestive of severe dry eye. An immunoassay shows the presence of anti-Ro/SS-A and anti-La/SS-B antibodies. Which of the following types of renal tubular acidosis is likely to be seen in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Type 4 RTA"
      },
      {
        "id": 2,
        "text": "Type 3 RTA"
      },
      {
        "id": 3,
        "text": "Type 2 RTA"
      },
      {
        "id": 4,
        "text": "Type 1 RTA"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The clinical symptoms together with the presence of\u00a0anti-Ro/SS-A and anti-La/SS-B antibodies are suggestive of <strong>Sjogren syndrome. Type 1 (distal) RTA\u00a0</strong>can be seen in this patient.</p>\n<p>The causes of type 1 RTA are as follows</p>\n<p>Primary</p>\n<ul>\n<li>Sporadic</li>\n<li>Inherited (autosomal dominant and autosomal recessive)</li>\n</ul>\n<p>Secondary</p>\n<ul>\n<li>Systemic genetic diseases such as osteoporosis, elliptocytosis, Ehler-Danlos syndrome, Primary hyperoxaluria type 2</li>\n<li>Acquired conditions such as\n<ul>\n<li><strong>Autoimmune diseases: </strong>Sjogren's syndrome, rheumatoid arthritis, hyperglobulinemia</li>\n<li>Renal transplantation</li>\n<li>Medullary sponge kidney</li>\n<li>Hyperthyroidism</li>\n<li>Malnutrition</li>\n<li>Drugs and toxics - amphotericin B, lithium salts, amiloride, toluene</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An adolescent boy presents with recurrent kidney stones composed of calcium oxalate. Laboratory tests reveal elevated levels of oxalate in the urine. Genetic testing confirms deficiency of enzyme alanine glyoxalate transferase. Which of the following is not a management option in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Increased fluid intake"
      },
      {
        "id": 2,
        "text": "Thiazide diuretics"
      },
      {
        "id": 3,
        "text": "Vitamin B-6"
      },
      {
        "id": 4,
        "text": "Loop diuretics"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The adolescent boy described has <strong>primary hyperoxaluria type 1 (PH1)</strong>, a genetic disorder caused by a <strong>deficiency</strong> of the enzyme <strong>alanine glyoxalate aminotransferase (AGT)</strong>. <strong>Loop diuretics</strong> are not a management option in this condition.</p>\n<p>Primary hyperoxaluria type 1 results in <strong>excessive oxalate production</strong>, due to a genetic deficiency of the enzyme alanine glyoxalate transferase, leading to high levels of oxalate in the urine <strong>(hyperoxaluria).</strong> The excess oxalate can combine with calcium to form <strong>calcium oxalate crystals</strong>, which can deposit in the kidneys and other organs, leading to recurrent kidney stones, nephrocalcinosis, and potentially end-stage renal disease.\u00a0<strong>Loop diuretics increase calcium excretion </strong>in the urine, potentially exacerbating the formation of calcium oxalate stones.</p>\n<p>The enzyme alanine-glyoxylate aminotransferase helps in the <strong>conversion of glyoxylic acid to glycine.</strong> In the absence of this enzyme glyoxylic acid is transferred to the cytoplasm and is oxidized to oxalic acid.</p>\n<p>Presenting symptoms include <strong>colicky abdominal pain, hematuria dysuria</strong>, etc. There is gradual deterioration of renal function which manifests as <strong>growth failure</strong> and <strong>uremia.</strong> Other manifestations include failure to thrive, short stature, arterial calcifications, arrhythmia, heart failure, hypothyroidism, and skin nodules.</p>\n<p>Treatment options include <strong>increased fluid intake, pyridoxine (Vitamin B6),</strong> potassium or sodium citrate, <strong>dietary modifications, thiazide diuretics, orthophosphate, </strong>and in severe cases, liver and kidney transplantation.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 20-year-old male patient presented with muscle weakness, abnormal tingling sensation over the face, and pain and swelling over the knee joint for 3 months. On examination, his blood pressure is 90/60 mm Hg. Investigations show hypokalemia, hypomagnesemia, and hypocalciuria with metabolic alkalosis. His x-ray knee is given below. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Bartter's syndrome"
      },
      {
        "id": 2,
        "text": "Gitelman's syndrome"
      },
      {
        "id": 3,
        "text": "Liddle's syndrome"
      },
      {
        "id": 4,
        "text": "Fanconi's syndrome"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The clinical scenario of a young male presenting with muscle weakness, paresthesia over the face, <strong>hypotension</strong>, <strong>hypokalemia</strong>, <strong>hypomagnesemia</strong>, hypocalciuria, metabolic alkalosis, and x-ray knee showing <strong>chondrocalcinosis</strong> as punctate density on the cartilage are suggestive of <strong>Gitelman's syndrome</strong>.\u00a0</p>\n<p><strong>Gitelman's syndrome</strong>\u00a0is an autosomal recessive salt-losing renal tubulopathy. It occurs due to a mutation of<strong>\u00a0Na<sup>+</sup>-Cl<sup>\u2013</sup>\u00a0co-transporter </strong>(NCCT)<strong> in the distal tubule</strong>.\u00a0</p>\n<p><strong>NCCT</strong> helps in the <strong>absorption of sodium and chloride</strong> ions from the lumen of the distal tubule. In Gitelman's syndrome, due to the<strong> loss of function</strong> of NCCT, there will be <strong>increased sodium and chloride delivery to collecting duct and volume retraction</strong>. This results in <strong>increased</strong> renin and <strong>aldosterone secretion</strong>. Aldosterone act on epithelial sodium channels in the collecting duct causing increased reabsorption of sodium and increased excretion of potassium and hydrogen ions leading to <strong>hypokalemia and metabolic alkalosis</strong>.</p>\n<p>Downregulation of magnesium-permeable channels in Gitelman syndrome leads to urinary loss of magnesium resulting in <strong>hypomagnesemia</strong>.</p>\n<p>There is increased passive reabsorption of calcium in the proximal convoluted tubule in Gitelman syndrome resulting in <strong>hypocalciuria</strong>.\u00a0</p>\n<p>Hypomagnesemia impairs the function of calcitropic hormones and down-regulates the normal inverse association between ionized calcium, parathyroid hormone, and calcitriol. This results in reduced skeletal sensitivity of PTH and impaired intestinal calcium transport and explains the <strong>lack of hypercalcemia</strong> response to hypocalciuria.\u00a0</p>\n<p>Low magnesium levels result in the reduction of pyrophosphate activity that could promote pyrophosphate crystallization in joints causing joint pains and <strong>chondrocalcinosis</strong>.</p>\n<p>Even though patients present above the age of 6 years, the diagnosis in most cases is established during adulthood. Patients often present with signs of tetany, paresthesias, and chondrocalcinosis, as a result of hypomagnesemia and fatiguability.\u00a0</p>\n<p>Hypomagnesemia and hypokalemia prolong the duration of the action potential of cardiomyocytes and consequently increase the risk of ventricular arrhythmia.\u00a0</p>\n<p>Other options:</p>\n<p>Option A: <strong>Bartter's syndrome</strong> affects the\u00a0<strong>Na<sup>+</sup>/K<sup>+</sup>/Cl<sup>-</sup>\u00a0 co-transporter</strong> in the <strong>thick ascending loop of Henle</strong>. It causes hypocalcemia and <strong>hypercalciuria</strong>.</p>\n<p>Option C: <strong>Liddle's syndrome</strong> causes increased activation of\u00a0<strong>epithelial sodium channel</strong>\u00a0(<strong>ENaC</strong>) channels expressed on the apical membrane of principal cells of the <strong>collecting duct</strong>. It results in <strong>severe hypertension</strong> with hypokalemia.</p>\n<p>Option D: <strong>Fanconi's syndrome</strong> occurs due to a <strong>defect</strong> in the <strong>proximal tubular</strong> function\u00a0that prevents the absorption of electrolytes and other substances that are normally absorbed by the proximal tubule. It results in hypokalemia and\u00a0<strong>metabolic acidosis</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/5add4ec0eb1c45b2a93cac8e9c381aec.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "An obese diabetic patient comes with complaints of abdominal pain, nausea, and vomiting. His arterial blood pH is 7.2 and his urine is positive for glucose and ketones. His blood glucose level is 130 mg/dL. Which anti-diabetic drug was the patient likely on?",
    "choices": [
      {
        "id": 1,
        "text": "Vildagliptin"
      },
      {
        "id": 2,
        "text": "Metformin"
      },
      {
        "id": 3,
        "text": "Canagliflozin"
      },
      {
        "id": 4,
        "text": "Pioglitazone"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario is suggestive of <strong>diabetic ketoacidosis with euglycemia</strong>, which is an adverse effect of <strong>sodium-glucose co-transporter 2 (SGLT2) inhibitors</strong> such as <strong>canagliflozin</strong>.&nbsp;</p>\n<p>Inhibition of SGLT2 and consequent decrease in blood glucose levels stimulates <strong>glucagon</strong>. Glucagon <strong>increases</strong> the production of <strong>glucose</strong> and <strong>ketones</strong> in the liver. <strong>SGLT2 inhibitors</strong> can cause <strong>euglycemic diabetic ketoacidosis (DKA)</strong> because of the increased excretion of glucose in the urine. Euglycemic DKA can occur at times of stress or when ongoing glycosuria masks the stress-induced requirements of insulin. This is why SGLT2 inhibitors should <strong>not</strong> be <strong>prescribed</strong> to patients with<strong> type I diabetes mellitus</strong> or <strong>pancreatogenic forms of diabetes mellitus</strong> which are associated with insulin deficiency.</p>\n<p>SGLT2 is a Na<sup>+</sup>-glucose&nbsp;<strong>cotransporter</strong>&nbsp;that is located in the&nbsp;<strong>proximal convoluted tubule&nbsp;</strong>of the kidney. They reabsorb glucose and sodium from the tubular lumen back into the blood through the epithelial cells. SGLT2 inhibitors block the transport of glucose&nbsp;in the proximal tubule and promote&nbsp;<strong>glycosuria</strong>&nbsp;and hence lower blood glucose. The currently available SGLT2 inhibitors are <strong>canagliflozin</strong>, <strong>dapagliflozin</strong>, and <strong>empagliflozin</strong>. Other than decreasing blood glucose they also <strong>decrease systolic blood pressure</strong> and cause&nbsp;<strong>weight loss</strong>. <strong>Empagliflozin</strong> and <strong>canagliflozin</strong> <strong>reduce</strong> <strong>the risk of major cardiovascular events</strong> in patients with established diabetes mellitus. All SGLT2 inhibitors have been shown to <strong>reduce</strong> the incidence of hospitalization in <strong>CHF</strong>&nbsp;and reduced the progression of <strong>diabetic kidney disease</strong>.</p>\n<p>The main side effect of SGLT2 inhibitors because of their glycosuric properties is an increase in&nbsp;<strong>lower urinary tract infections</strong> and genital mycotic infections. <strong>Dapagliflozin</strong> is associated with a possible risk of <strong>bladder cancer</strong>, while <strong>canagliflozin</strong> is associated with an <strong>increased risk of fractures</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 45-year-old male patient with Type II Diabetes mellitus on insulin comes for a routine examination. Physical examination reveals an ulcer on the base of the great toe, pulse rate - 80/minute, blood pressure - 140/80 mm Hg. Laboratory investigations show HbA1c of 6.7% and findings consistent with renal tubular acidosis type IV. Which of the following is not associated with this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Low serum renin levels"
      },
      {
        "id": 2,
        "text": "Elevated serum potassium"
      },
      {
        "id": 3,
        "text": "Urinary pH < 5.5"
      },
      {
        "id": 4,
        "text": "Increased urinary ammonium excretion"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Type IV renal tubular acidosis</strong> (hyporeninemic hypoaldosteronism) may occur in Type 1 or 2 diabetes mellitus. <strong>Decreased urinary excretion of ammonium</strong> will be seen in these patients.</p>\n<p>Causes for <strong>decreased renin activity</strong> that is commonly seen in patients with diabetes mellitus:</p>\n<ul>\n<li>Injury to the juxtaglomerular apparatus (like afferent arteriolar hyalinization)</li>\n<li>Defects in the stimulation factors and <strong>defective conversion</strong> of prorenin to renin</li>\n<li>Autonomic dysfunction</li>\n<li><strong>Increase</strong> in renal <strong>salt retention</strong> with volume expansion, which suppresses renin synthesis paradoxically when compared to patients without DM</li>\n<li>An <strong>increase</strong> in the secretion of <strong>atrial natriuretic peptide</strong> in these patients suppresses both renin and aldosterone.</li>\n</ul>\n<p>The clinical features seen in Type IV RTA are:</p>\n<ul>\n<li><strong>Hyperkalemia</strong>: Aldosterone increases the number of open sodium channels which leads to reabsorption of sodium. This in turn creates an electrochemical gradient that favours the secretion of potassium. In the absence of this effect due to low aldosterone, there will be an increase in potassium concentration</li>\n<li><strong>Metabolic acidosis</strong>: Due to diminished ammonium production in the proximal tubule, decreased ammonium excretion, and impaired NH<sub>4</sub> transport.</li>\n<li><strong>Urinary pH&lt;5.5</strong>: The principal buffers in the urine are ammonia and phosphate. Hyperkalemia seen in RTA Type 4 causes impaired ammonia genesis in the proximal tubule and reduces the availability of NH<sub>3</sub> to buffer H<sup>+</sup> ions. This decreased ammonia leads to excess protons in the renal tubules decreasing the urinary pH.</li>\n</ul>\n<p><strong>Causes of Type IV RTA:</strong></p>\n<ul>\n<li><strong>Diabetes</strong> and renal insufficiency</li>\n<li>NSAIDs</li>\n<li>Calcineurin inhibitors</li>\n<li>Angiotensin inhibitors</li>\n<li>Heparin and low-molecular-weight heparin</li>\n<li>Primary adrenal insufficiency</li>\n<li>Severe illness</li>\n<li>Inherited conditions\n<ul>\n<li>Congenital isolated hypoaldosteronism</li>\n<li>Pseudohypoaldosteronism Type 2 (Gordon's syndrome)</li>\n</ul>\n</li>\n<li>Aldosterone resistance\n<ul>\n<li>Potassium-sparing diuretics</li>\n<li>Antibiotics: Trimethoprim and pentamidine</li>\n<li>Pseudohypoaldosteronism Type 1</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The ABG findings of a patient are given below. Which of the following metabolic abnormality is present in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Metabolic acidosis"
      },
      {
        "id": 2,
        "text": "Metabolic alkalosis and respiratory acidosis"
      },
      {
        "id": 3,
        "text": "Metabolic alkalosis and respiratory alkalosis"
      },
      {
        "id": 4,
        "text": "Metabolic alkalosis with compensatory respiratory alkalosis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given scenario reveals <strong>metabolic alkalosis and respiratory alkalosis.</strong></p>\n<p><strong>Interpretation of ABG:</strong></p>\n<p><strong>Step 1:</strong></p>\n<table style=\"width: 402px;\" border=\"1\">\n<tbody>\n<tr>\n<td style=\"width: 148.586px;\">Value in the question</td>\n<td style=\"width: 138.414px;\">Normal value</td>\n<td style=\"width: 90px;\">Interpretation</td>\n</tr>\n<tr>\n<td style=\"width: 148.586px;\">pH = 7.50</td>\n<td style=\"width: 138.414px;\">(7.35 \u2013 7.45) <strong>7.4</strong></td>\n<td style=\"width: 90px;\"><strong>Increased</strong></td>\n</tr>\n<tr>\n<td style=\"width: 148.586px;\">paCO<sub>2 </sub>= 35\u00a0</td>\n<td style=\"width: 138.414px;\">(35 \u2013 45) <strong>40</strong></td>\n<td style=\"width: 90px;\">Normal</td>\n</tr>\n<tr>\n<td style=\"width: 148.586px;\">HCO<sub>3</sub><sup>- </sup>= 30\u00a0</td>\n<td style=\"width: 138.414px;\">(22 \u2013 28) <strong>25</strong></td>\n<td style=\"width: 90px;\"><strong>Increased</strong></td>\n</tr>\n</tbody>\n</table>\n<p>The values clearly suggest<strong>\u00a0metabolic alkalosis.</strong></p>\n<p><strong>Step 2:</strong></p>\n<p>Calculating the respiratory compensation:</p>\n<p>In <strong>metabolic alkalosis</strong>, Compensation formula is as follows:</p>\n<p><strong>\u2206 [HCO3-] = </strong>Increase in <strong>HCO<sub>3</sub></strong>-, in above case is\u00a0 = 30 - 25 = <strong>5</strong></p>\n<p>So,\u00a0<strong>compensatory increase of CO<sub>2</sub></strong> should be = 0.7 x 5<strong>\u00a0= 3.5</strong></p>\n<p>Applying the above, the compensation value of CO<sub>2</sub> should lie between</p>\n<p>40 + 3.5 = <strong>43.5 or approx. 44</strong></p>\n<p>Taking +/- 3 into consideration,\u00a0 <strong>Compensatory values of CO<sub>2</sub></strong><sub> = </sub><strong>41 \u2013 47</strong></p>\n<p><strong>Step 3:</strong></p>\n<p>Since <strong>CO<sub>2</sub></strong> = <strong>35 which is below the compensatory values</strong>, hence this is <strong>not compensated.</strong></p>\n<p>It suggests that there is a simultaneous <strong>respiratory alkalosis.</strong></p>\n<p><strong>Step 4:</strong></p>\n<p><strong>Looking for anion gap:</strong></p>\n<p>Anion gap should be looked for only in cases of:</p>\n<ul>\n<li>Metabolic acidosis</li>\n<li>Normal pH</li>\n</ul>\n<p>Since the primary disorder is <strong>metabolic alkalosis</strong>, anion gap is not looked into.</p>\n<p>A situation like this is seen with <strong>liver disease and diuretics administration.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 35-year-old woman, diagnosed with bipolar disorder is under treatment with lithium for the past 2 months. She now presents with excessive thirst and frequent urination and a diagnosis of nephrogenic diabetes insipidus was made. The administration of desmopressin did not increase the specific gravity of urine. Which is the most appropriate treatment in this case?",
    "choices": [
      {
        "id": 1,
        "text": "Thiazides"
      },
      {
        "id": 2,
        "text": "Amiloride"
      },
      {
        "id": 3,
        "text": "Furosemide"
      },
      {
        "id": 4,
        "text": "Chlorpropamide"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The most appropriate treatment for&nbsp;<strong>lithium-induced nephrogenic diabetes insipidus </strong>(NDI)<strong>&nbsp;</strong>is&nbsp;<strong>amiloride.</strong></p>\n<p>Lithium&nbsp;is a <strong>mood stabilizer</strong> with a very narrow therapeutic index hence regular determination of serum concentrations is important. Its use is approved by FDA in acute mania and the prevention of recurrences of bipolar illness in adults or adolescents.</p>\n<p>Important side effects of lithium are-</p>\n<ul>\n<li><strong>Fine&nbsp;</strong>tremors in&nbsp;<strong>therapeutic dose</strong></li>\n<li><strong>Nephrogenic diabetes insipidus</strong></li>\n<li>Hypothyroidism</li>\n<li>T wave flattening</li>\n<li aria-level=\"1\">CNS toxicity manifests as coarse tremors, giddiness, ataxia, motor incoordination, nystagmus, mental confusion, slurred speech, and hyperreflexia.</li>\n</ul>\n<p>The development of NDI is related to the accumulation of Li<sup>+</sup> in<strong> distal tubular cells</strong> and subsequent inhibition of GSK-3&beta;, leading to <strong>vasopressin insensitivity </strong>and downregulation of<strong> aquaporin-2 channels.</strong> Amiloride is a <strong>potassium-sparing diuretic</strong> that <strong>blocks entry of Li<sup>+</sup></strong> into<strong>&nbsp;</strong>collecting duct cells&nbsp;and thus can be used to treat lithium-induced NDI.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 7-year-old child presented with the deformity shown in the image. Subsequent investigations revealed a mutation in the PHEX\u00a0gene and increased levels of fibroblast growth factor-23 (FGF 23). Which of the following is the likely set of reports for the patient?",
    "choices": [
      {
        "id": 1,
        "text": "1"
      },
      {
        "id": 2,
        "text": "2"
      },
      {
        "id": 3,
        "text": "3"
      },
      {
        "id": 4,
        "text": "4"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical scenario with the image showing the <strong>wind-swept deformity</strong> (characteristic of rickets in a pediatric patient)\u00a0and <strong><em>PHEX</em> gene</strong> mutation is suggestive of <strong>X-linked dominant\u00a0hypophosphatemic rickets</strong>. This patient's laboratory reports will show<strong> low phosphate</strong> levels, normal calcium levels, parathyroid hormone levels, and normal pH.\u00a0</p>\n<p><strong>Hypophosphatemic rickets:</strong></p>\n<p>X-linked dominant hypophosphatemic rickets is the\u00a0<strong>most common genetic cause</strong> of rickets. <strong>PHEX\u00a0gene</strong> (<strong>ph</strong>osphate-regulating <strong>e</strong>ndopeptidase on\u00a0<strong>x</strong>\u00a0chromosome) products are responsible for the\u00a0<strong>inactivation of phosphatonin</strong>. Mutation of this\u00a0<em>PHEX</em> leads to increased phosphatonin (FGF 23) levels, and hence, the excretion of phosphorous is increased. This is impaired renal tubular reabsorption of phosphate.</p>\n<p>Other causes of hypophosphatemic rickets include:</p>\n<ul>\n<li>Autosomal dominant hypophosphatemic rickets</li>\n<li>Autosomal recessive hypophosphatemic rickets</li>\n<li>Hereditary hypophosphatemic rickets with hypercalciuria</li>\n<li>Tumor-induced rickets</li>\n<li>Fanconi Syndrome</li>\n</ul>\n<p>The chart attached below summarizes the evaluation of hypophosphatemic rickets:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/292214116f4d4b5bb60866a85c5f53d2.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/da232099312d413db328feba43e9666fx1280x1838.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7ff4e4536b9a45368e5a72050a744e4fx1280x1326.JPEG"
    ]
  },
  {
    "text": "What is incorrect regarding aminoglycoside-mediated nephrotoxicity?",
    "choices": [
      {
        "id": 1,
        "text": "It causes tubular necrosis"
      },
      {
        "id": 2,
        "text": "It causes oliguric AKI"
      },
      {
        "id": 3,
        "text": "AKI can present even after the drug is discontinued"
      },
      {
        "id": 4,
        "text": "Hypomagnesemia is a common finding"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Aminoglycosides</strong>\u00a0cause\u00a0<strong>non-oliguric</strong> (urine volume &gt;400 mL/day) acute kidney injury (AKI).</p>\n<p><strong>Aminoglycoside-mediated nephrotoxicity</strong>:</p>\n<ul>\n<li>It causes <strong>tubular necrosis</strong>.</li>\n<li>It causes <strong>non-oliguric AKI</strong>.</li>\n<li>It is freely filtered across the glomerulus and accumulates within the renal cortex.</li>\n<li>AKI occurs after 5\u20137 days of therapy, and it can present<strong> even after </strong>the drug has been<strong> discontinued.\u00a0</strong></li>\n<li><strong>Hypomagnesemia </strong>is a common finding.</li>\n</ul>\n<p>Nephrotoxic drugs include the following:</p>\n<ul>\n<li>NSAIDs: <strong>Prerenal</strong> AKI &gt; acute tubulointerstitial nephritis</li>\n<li>Antifungals (amphotericin B): Acute tubular necrosis</li>\n<li>Antibiotics\n<ul>\n<li><strong>Aminoglycosides</strong>: Acute tubular necrosis</li>\n<li>Vancomycin: AKI</li>\n<li>Cephalosporins: Acute interstitial nephritis</li>\n<li>Sulfonamides: Acute interstitial nephritis\u00a0</li>\n</ul>\n</li>\n<li>Antivirals\n<ul>\n<li>Acyclovir: Precipitates in tubules and causes obstruction, hence <strong>oliguric</strong> AKI</li>\n<li>Foscarnet: Tubular toxicity</li>\n</ul>\n</li>\n<li>Chemotherapy drugs\n<ul>\n<li>Ifosfamide: Hemorrhagic cystitis and tubular toxicity.\u00a0</li>\n<li>Platins: Necrosis and apoptosis of proximal tubular cells.</li>\n</ul>\n</li>\n<li>Immunosuppressants (cyclosporine)</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The type of acidosis seen in renal tubular acidosis is:",
    "choices": [
      {
        "id": 1,
        "text": "Normal anion gap hyperchloremic metabolic acidosis"
      },
      {
        "id": 2,
        "text": "High anion gap hyperchloremic metabolic acidosis"
      },
      {
        "id": 3,
        "text": "Normal anion gap hypochloremic metabolic acidosis"
      },
      {
        "id": 4,
        "text": "High anion gap hypochloremic metabolic acidosis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The type of acidosis seen in <strong>renal tubular acidosis</strong> (RTA) is <strong>normal anion gap hyperchloremic metabolic acidosis</strong>.&nbsp;</p>\n<p><strong>RTA&nbsp;</strong>refers to a group of disorders in which <strong>acidosis</strong> occurs because of the <strong>inability</strong> of the <strong>tubules</strong> of the kidney to perform normal functions required to <strong>maintain acid-base balance</strong>. In this disorder, the glomerular filtration rate (GFR) is relatively well-preserved.</p>\n<p>The defect is either<strong> inability</strong> to <strong>excrete hydrogen ions</strong> (inadequate generation of new bicarbonate ions) or <strong>inadequate reabsorption</strong> of <strong>bicarbonate</strong> <strong>ions</strong>.&nbsp;</p>\n<p>Types of RTA:</p>\n<ul>\n<li><strong>Type I</strong>&nbsp;- <strong>distal RTA </strong>or<strong>&nbsp;classical RTA&nbsp;</strong>is characterised by the&nbsp;<strong>inability</strong> to <strong>excrete H+ ions</strong> by the distal nephron. The urinary <strong>pH </strong>is <strong>&gt;5.5</strong>, as the<strong>&nbsp;</strong>urine cannot be fully acidified, despite systemic acidosis.&nbsp;</li>\n<li><strong>Type II</strong>&nbsp;- <strong>proximal RTA</strong> is characterised by the inability to<strong> reabsorb filtered bicarbonate&nbsp;</strong>by the&nbsp;proximal tubule.</li>\n<li><strong>Type III </strong>-<strong>&nbsp;mixed type</strong>,<strong>&nbsp;</strong>similar to both type I and II.</li>\n<li><strong>Type IV</strong>&nbsp;- is the <strong>most common type</strong> of <strong>RTA</strong> in clinical practice. This is a disorder of <strong>hyperkalemia</strong>, that occurs due to <strong>decreased aldosterone</strong>, which inhibits ammonium production.</li>\n</ul>\n<p>The anion gap is the difference between readily measured anions and cations.&nbsp;The <strong>normal anion gap</strong> is <strong>12 &plusmn; 4 mEq/L</strong>. The overall deficiency of&nbsp;HCO<sub>3</sub><sup>-</sup>&nbsp;in all the types of RTA is&nbsp;<strong>compensated</strong>&nbsp;by&nbsp;<strong>Cl<sup>-</sup>&nbsp;secretion</strong>. Hence, the serum anion gap remains normal. This kind of metabolic abnormality is also seen in <strong>gastrointestinal losses</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 25-year-old female presents with weakness and fatigue. On examination, her blood pressure is low. Laboratory investigations reveal metabolic alkalosis, hypokalemia, hypomagnesemia, hypocalciuria, and high urine chloride. Based on these findings, which of the following renal ion channels are affected in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Epithelial sodium channels"
      },
      {
        "id": 2,
        "text": "NaCl Cotransporter"
      },
      {
        "id": 3,
        "text": "Na+/K+/2Cl- Cotransporter"
      },
      {
        "id": 4,
        "text": "Sodium bicarbonate Cotransporter"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>This is a clinical vignette of <strong>Gitelman syndrome</strong> caused by <strong>mutations</strong> in the <strong>NaCl Co-transporter</strong> (sodium chloride cotransporter)<strong> </strong>located in the <strong>distal convoluted</strong> <strong>tubule</strong>. Excessive renal wasting of sodium, chloride, and potassium, leads to <strong>hypokalemic metabolic alkalosis</strong>. Other hallmark laboratory findings include <strong>hypomagnesemia</strong>, <strong>hypocalciuria</strong>, and <strong>high urine chloride levels</strong>.</p>\n<p>Gitelman syndrome is an <strong>autosomal recessive</strong> <strong>salt-losing renal tubulopathy</strong>. Patients often present with signs of <strong>tetany</strong>, <strong>paresthesias</strong>, and <strong>chondrocalcinosis</strong>.\u00a0NCCT helps in the absorption of sodium and chloride ions from the lumen of the distal tubule. Due to the <strong>loss of function</strong> of <strong>NCCT</strong>, there will be <strong>increased sodium</strong> and <strong>chloride delivery</strong> to the <strong>collecting duct</strong> and volume retraction, leading to <strong>increased renin</strong> and <strong>aldosterone</strong> <strong>secretion</strong>. Aldosterone acts on epithelial sodium channels in the collecting duct causing increased reabsorption of sodium and increased excretion of potassium and hydrogen ions leading to <strong>hypokalemia</strong> and <strong>metabolic alkalosis</strong>.\u00a0</p>\n<p>Despite increased renin and aldosterone levels, patients generally have <strong>low/normal blood pressure</strong>.</p>\n<p><strong>Increased urinary loss</strong> of magnesium results in <strong>hypomagnesemia</strong> and <strong>increased passive reabsorption</strong> of calcium in the proximal convoluted tubule results in <strong>hypocalciuria</strong>.\u00a0</p>\n<p>Other options:\u00a0</p>\n<p>Option A: <strong>Epithelial sodium channels</strong> (ENaC) in the <strong>distal tubule</strong> are affected in <strong>Liddle syndrome</strong> which occurs due to a <strong>gain of function</strong> mutation. It also causes <strong>metabolic alkalosis</strong>. There is increased reabsorption of Na+ exchanged for K+ causing <strong>hypokalemia</strong>. Increased Na absorption leads to <strong>hypertension</strong>.</p>\n<p>Option C: The defect in the <strong>Na+/K+/2Cl- Cotransporter </strong>(Sodium, Potassium Chloride Cotransporter)<strong> </strong>in the thick ascending loop of Henle is seen in <strong>Bartter syndrome </strong>which results in polyuria, polydipsia, natriuresis with <strong>high aldosterone </strong>(due to RAAS activation), hypokalemia, metabolic alkalosis, <strong>hypomagnesemia</strong>, <strong>hypocalcemia</strong> and <strong>hypercalciuria</strong>. The combination of <strong>hypokalemia</strong> and <strong>alkalosis</strong> in a <strong>normotensive</strong>, nonedematous patient can be due to either Bartter or Gitelman syndrome. However, the key <strong>difference</strong> in Bartter syndrome is that hypercalciuria is seen.</p>\n<p>Option D: <strong>Sodium bicarbonate cotransporter</strong> is mutated in <strong>proximal renal tubular acidosis </strong>(Type II RTA).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 38-year-old male patient has the following laboratory findings: pH 7.2, plasma sodium 136 mEq/L, chloride 110 mEq/L, bicarbonate 15 mEq/L, and potassium 2.6 mEq/L. Urine studies show a pH of 5.1. Following the administration of intravenous sodium bicarbonate, the urine pH is 5.8. Which of the following conditions is the most likely underlying cause?",
    "choices": [
      {
        "id": 1,
        "text": "Type I renal tubular acidosis"
      },
      {
        "id": 2,
        "text": "Type II renal tubular acidosis"
      },
      {
        "id": 3,
        "text": "Diabetic ketoacidosis"
      },
      {
        "id": 4,
        "text": "Lactic acidosis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The laboratory findings are most likely suggestive of <strong>type II (proximal) renal tubular acidosis.</strong></p>\n<p>The arterial blood gas analysis shows <strong>normal anion gap metabolic acidosis (NAGMA).</strong></p>\n<p><strong>Interpretation:</strong></p>\n<p><strong>Step 1:</strong> The<strong> pH </strong>is<strong> 7.2</strong> (&lt;7.35) suggestive of acidosis</p>\n<p><strong>Step 2:</strong> Plasma bicarbonate is 15 mEq/L indicating metabolic acidosis</p>\n<p><strong>Step 3:</strong> A<strong>ssessment of the anion gap:</strong></p>\n<p>\u202fAnion gap = [Na+] &ndash; ([Cl-] + [HCO3-])</p>\n<p>= 136 - (110 + 15)</p>\n<p>= 136 - 125</p>\n<p>= 11 mEq/L (Normal range: 8-12&nbsp;mEq/L)</p>\n<p>Hence, the laboratory findings are suggestive of <strong>normal anion gap metabolic acidosis.</strong></p>\n<p><strong>Renal tubular acidosis</strong> is one of the common causes of NAGMA. The serum potassium is low (<strong>hypokalemia</strong>), suggestive of <strong>either type I or type II renal tubular acidosis.</strong> Type III RTA is rare and is seen mostly in children, while type IV RTA is associated with hyperkalemia.</p>\n<p>The urine pH is initially 5.1 (&lt;5.5, acidic), which increased to 5.8 (&gt;5.5) following administration of sodium bicarbonate (alkali therapy), suggestive of <strong>poor bicarbonate reabsorption</strong> in the proximal tubules of the kidney, making the diagnosis of <strong>type II (proximal) renal tubular acidosis.</strong></p>\n<p><strong>Type II RTA&nbsp;</strong>is commonly caused due to generalized proximal tubular dysfunction, associated with&nbsp;<strong>Fanconi syndrome (glycosuria, aminoaciduria,</strong> and <strong>phosphaturia).</strong> The bicarbonate is poorly reabsorbed in the proximal convoluted tubule, leading to its increased excretion <strong>(bicarbonaturia).</strong> This leads to decreased plasma bicarbonate levels and metabolic acidosis.</p>\n<p>As the plasma bicarbonate levels fall below the renal threshold for reabsorption of the HCO<sub>3</sub><sup>- </sup>in patients with type II RTA, all the bicarbonate is reabsorbed thus maintaining the urinary pH acidic (&lt;5.5). When sodium bicarbonate is administered intravenously, it increases the plasma bicarbonate levels above the limited renal threshold, leading to increased excretion of HCO<sub>3</sub><sup>-&nbsp;</sup>causing increased urinary pH (&gt; 5.5).</p>\n<p><strong>Alkali therapy</strong>&nbsp;for correcting plasma bicarbonate in type II RTA should be carried out with caution, as sudden increased availability of HCO<sub>3</sub><sup>- </sup>to the distal tubules stimulates the secretion of potassium, further exaggerating the <strong>hypokalemia</strong>. Hence, potassium salts are usually administered along with alkali therapy. An oral solution of a combination of<strong> sodium and potassium citrate</strong> is commonly prescribed alkali therapy for this reason.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The acid-base abnormality seen in Bartter's syndrome corresponds to which of the following areas of the nomogram?",
    "choices": [
      {
        "id": 1,
        "text": "D"
      },
      {
        "id": 2,
        "text": "C"
      },
      {
        "id": 3,
        "text": "B"
      },
      {
        "id": 4,
        "text": "A"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Bartter's syndrome</strong> leads to the <strong>loss of H<sup>+</sup></strong> ions resulting in <strong>metabolic alkalosis</strong> corresponding to the area marked as '<strong>C'</strong> in the normogram.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/90774cafd27d44048f9c1ef78c1b6ceb.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/57ff06a34f154db39cd8ca4b607c32ffx1280x1452.JPEG"
    ]
  },
  {
    "text": "A 25-year-old overweight male patient was referred for the evaluation of renal stones. He complains of severe abdominal pain and urinary disturbances. His urine microscopy shows the following type of crystals and an ultrasound of the kidney revealed a renal stone of size 2.5 cm. What is the preferred treatment for this man?",
    "choices": [
      {
        "id": 1,
        "text": "Extracorporeal shockwave lithotripsy (ESWL)"
      },
      {
        "id": 2,
        "text": "Percutaneous nephrolithotomy (PCNL)"
      },
      {
        "id": 3,
        "text": "Open surgery"
      },
      {
        "id": 4,
        "text": "Ureteroscopy assisted removal"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><span data-preserver-spaces=\"true\"><strong>Urine microscopy</strong> shows\u00a0<strong>h</strong></span><strong><span data-preserver-spaces=\"true\">exagonal crystals</span></strong><span data-preserver-spaces=\"true\">, typical of\u00a0</span><strong><span data-preserver-spaces=\"true\">cystine stones\u00a0</span></strong><span data-preserver-spaces=\"true\">that are</span><strong><span data-preserver-spaces=\"true\">\u00a0radio-opaque\u00a0</span></strong><span data-preserver-spaces=\"true\">(due to high sulfur content)</span><strong><span data-preserver-spaces=\"true\">.\u00a0</span></strong><span data-preserver-spaces=\"true\">The preferred treatment for a cystine renal calculus of size<strong>\u00a02.5 cm</strong> is<strong>\u00a0percutaneous nephrolithotomy (PCNL) </strong>as <strong>cystine stones</strong> are relatively <strong>resistant to ESWL</strong> (extracorporeal shockwave lithotripsy)<strong>\u00a0due to</strong> their <strong>hardness.</strong></span></p>\n<p><strong>PCNL</strong>\u00a0is the preferred treatment for -large renal stones of a diameter of more than 1.5-2.5 cm, in the presence of multiple stones, and in cases like this patient where it is a smaller, harder stone, not responsive to ESWL (like cystine, struvite, and calcium oxalate stones).\u00a0</p>\n<p><strong>Technique:\u00a0</strong>Endoscopic instruments are passed into the kidney using a percutaneous technique and stones are removed.</p>\n<p class=\"p1\"><strong>Complications</strong>\u00a0of percutaneous nephrolithotomy include <strong>haemorrhage</strong>\u00a0from the punctured renal parenchyma, <strong>perforation </strong>of the<strong> collecting system</strong>\u00a0with extravasation of saline irrigant, and <strong>perforation </strong>of the<strong> colon </strong>or<strong> pleural cavity</strong>\u00a0during placement of the percutaneous track.\u00a0<br /><br /><strong>Cystinuria</strong> occurs due to a <strong>hereditary defect</strong> in an amino acid transporter in the renal <strong>proximal convoluted tubule</strong> and intestine. This prevents the reabsorption of amino acids like <strong>cystine</strong>, ornithine, lysine, and arginine. The only known complication of this disease is the <strong>formation of calculi</strong>, because of the low solubility of cystine in the urine. Cystine is more likely to precipitate in acidic urine.</p>\n<p>Prevention of stone formation in patients with cystinuria can be done by <strong>increasing fluid intake</strong> and <strong>alkalinization of the urine</strong> with sodium bicarbonate or sodium citrate. Chelating agents such as <strong>penicillamine</strong> have also been found to be useful. <strong>Tiopronin</strong> is currently the best choice drug for cystine reduction, but side effects like nephrotic syndrome may limit its long-term use. A <strong>diet low in methionine</strong> may theoretically reduce the excretion of cystine in the urine by directly reducing its formation.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/7735db3047d74ef99c2883935ec90f2e.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3a0e9b1f9b2d410bb9eb75427f29a656x1280x1688.JPEG"
    ]
  }
];
        let quizName = 'Renal Tubular Disorders Mini Test - -Tmt';
        const quizFilename = 'renal-tubular-disorders-mini-test-tmt-d9c760de.html';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2024-25"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>