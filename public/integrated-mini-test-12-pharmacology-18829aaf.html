<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Integrated Mini Test 12 - Pharmacology - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2024-25
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A 27-year-old male patient presents with bands of pruritic, flagellate, and erythematous lesions over the trunk and extremities. He is a known case of Hodgkin\u2019s lymphoma and is on treatment with an ABVD regimen for the past 4 months. What is the drug responsible for the presenting features?",
    "choices": [
      {
        "id": 1,
        "text": "Adriamycin"
      },
      {
        "id": 2,
        "text": "Bleomycin"
      },
      {
        "id": 3,
        "text": "Vinblastine"
      },
      {
        "id": 4,
        "text": "Dacarbazine"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The above clinical scenario is suggestive of <strong>flagellate dermatitis.&nbsp;</strong>It is a specific adverse effect of <strong>bleomycin.</strong></p>\n<p><strong>Bleomycin</strong>&nbsp;is an anticancer antibiotic. It acts by generating free radicals by binding with a reducing agent (iron) in the presence of oxygen. This metal-drug complex cleaves the DNA of the tumor cell.</p>\n<p>It is used as a component in the treatment regimens of&nbsp;<strong>Hodgkin's lymphoma</strong> and<strong> testicular cancer</strong>.</p>\n<p>Bleomycin has a&nbsp;<strong>bone marrow&ndash;sparing</strong>&nbsp;effect. The major adverse events include&nbsp;<strong>flagellate dermatitis</strong> and <strong>pulmonary toxicity</strong>, which may progress to pulmonary fibrosis<strong>.</strong></p>\n<p>Flagellate dermatitis starts as bands of<strong> pruritic,</strong> flagellate, and erythematous lesions over the trunk and extremities. These rashes heal with <strong>persistent flagellate hyperpigmentation.&nbsp;</strong>No treatment is necessary since the lesions usually disappear on the stoppage of the drug. These lesions respond to topical corticosteroids.</p>\n<p>The image given below shows flagellate dermatitis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a67fb430face4bcd855de9119d4db775x360x98.JPEG"
    ]
  },
  {
    "text": "A patient diagnosed with renal cell carcinoma was started on a tyrosine kinase inhibitor that acts by inhibiting VEGF. He is now being evaluated for increasing protein excretion in his urine. Which of the following drugs was prescribed to the patient?",
    "choices": [
      {
        "id": 1,
        "text": "Ramucirumab"
      },
      {
        "id": 2,
        "text": "Sunitinib"
      },
      {
        "id": 3,
        "text": "Aflibercept"
      },
      {
        "id": 4,
        "text": "Pembrolizumab"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Sunitinib</strong> is a small molecule, <strong>multi-targeted kinase antagonist/inhibitor</strong> and has been shown to have <strong>anti-tumor activity </strong>in <strong>renal cell carcinoma (RCC)</strong>, <strong>gastrointestinal stromal tumor</strong> (GIST) and <strong>pancreatic neuroendocrine tumors</strong> (pNETs). <strong>Proteinuria</strong> is a common adverse effect of the drug.\u00a0</p>\n<p><strong>Pharmacology</strong> of sunitinib:</p>\n<ul>\n<li>Molecular targets of sunitinib are <strong>c-Kit, VEGFR-2, PDGFR-\u03b2</strong> and <strong>Flt-3.</strong></li>\n<li>Sunitinib targets mutations in the RET gene.</li>\n<li>The <strong>mechanisms</strong> of <strong>sunitinib\u2019s action</strong> are:Inhibition of activated c-Kit and PDGFR in GIST</li>\n<li>Inhibition of VEGFR in advanced RCC</li>\n</ul>\n<p><strong>Adverse effects:</strong></p>\n<ul>\n<li><strong>Its</strong> specific adverse effects include <strong>neutropenia, diarrhea</strong> and <strong>fatigue.</strong></li>\n<li>Generally, the other common side effects of agents having anti-VEGFR activity are <strong>hypertension</strong> and <strong>proteinuria.</strong></li>\n<li>Rarely, they cause <strong>bleeding</strong> and <strong>clotting disorders,</strong> and <strong>perforation</strong> of <strong>scarred gastrointestinal lesions.</strong></li>\n<li>Hand-foot syndrome has also been noted in the use of these agents, with erythema and desquamation of distal extremities.</li>\n</ul>\n<p><strong>Administration:</strong> In advanced RCC and in adjuvant therapy, sunitinib is given <strong>orally,</strong> at a dose of <strong>50mg per day,</strong> once daily, with or without food, for <strong>4 weeks</strong> out of 6 (nine 6-week cycles in adjuvant therapy).</p>\n<p>Uses:</p>\n<ul>\n<li>In <strong>metastatic GIST,</strong> the main chemotherapeutic agent used is imatinib, which is a selective inhibitor of the c-kit tyrosine kinase. Patients whose tumors have become refractory to imatinib benefit from agents like sunitinib, which also inhibits c-kit tyrosine kinase.</li>\n<li>It is now undergoing studies for efficacy in hepatocellular carcinoma.</li>\n</ul>\n<p>Update:</p>\n<ul>\n<li>The drug was previously approved for use by various regulatory bodies in 2006, for conditions like GIST and advanced RCC.</li>\n<li>In 2017, <strong>sunitinib maleate</strong> was approved by the FDA for use as <strong>adjuvant therapy</strong> for patients at risk for <strong>recurrence</strong> of <strong>RCC</strong> after a kidney has been removed <strong>(nephrectomy).</strong></li>\n<li>This was based on a multi-center, international, double-blinded, placebo-controlled trial among 615 patients with high risk of recurrent RCC following nephrectomy.</li>\n</ul>\n<p>Other options:\u00a0</p>\n<p>Option A: <strong>Ramucirumab</strong> is a human IgG1 monoclonal antibody that targets <strong>VEGFR2,</strong> preventing <strong>VEGFR</strong> ligand binding and thereby reducing ligand-induced activity in endothelial cells. It is used in combination with docetaxel to treat patients with metastatic non-small cell lung cancer (NSCLC). Adverse effects include <strong>hypertension</strong> and <strong>diarrhea.</strong></p>\n<p>Option C: <strong>Aflibercept</strong> is a recombinant fusion protein that functions as a VEGF trap by sequestering VEGF using the VEGFR1-binding domain. It is used in treating metastatic colorectal cancer</p>\n<p>Option D: <strong>Pembrolizumab</strong> is a humanized monoclonal IgG4\u03ba isotype antibody that prevents the interaction between programmed cell death protein 1 (PD-1) and its ligands. It is used in the treatment of non-small cell lung cancer, either before or after chemotherapy with platinum. It is also used in the treatment of melanoma, urothelial cancer, Merkel cell carcinoma and Hodgkin lymphoma. Serious adverse events include <strong>pneumonitis, colitis</strong> and <strong>hepatitis.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient was started on a drug for the treatment of glaucoma. He presents with complaints of extensive loss of orbital fat giving the appearance of a sunken eye. Which of the following drugs is most likely to cause this side effect?",
    "choices": [
      {
        "id": 1,
        "text": "Timolol"
      },
      {
        "id": 2,
        "text": "Pilocarpine"
      },
      {
        "id": 3,
        "text": "Acetazolamide"
      },
      {
        "id": 4,
        "text": "Latanoprost"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical scenario is suggestive of orbital fat atrophy and it is seen with&nbsp;<strong>topical PGF2&alpha; (prostaglandin) analogs&nbsp;</strong>like<strong>&nbsp;latanoprost.</strong></p>\n<p>Topical PGF2 alpha (prostaglandin) analogs are used as a first line in glaucoma.&nbsp;<strong>Latanoprost</strong>&nbsp;is the<strong>&nbsp;most&nbsp;commonly</strong>&nbsp;used anti-glaucoma medication. Other prostaglandin analogues are travoprost, bimatoprost, tafluprost, and unoprostone.</p>\n<p>Mechanism of action: It&nbsp;<strong>reduces intraocular pressure</strong>&nbsp;by altering the ciliary muscle tension and improving the&nbsp;<strong>outflow</strong>&nbsp;of the aqueous humor.</p>\n<p>Adverse effects:</p>\n<ul>\n<li>Blurring of vision</li>\n<li>Iris pigmentation</li>\n<li>Thickening and darkening of eyelashes</li>\n<li>Macular edema&nbsp;especially in aphakic patients.&nbsp;</li>\n<li><strong>Orbital fat atrophy</strong></li>\n</ul>\n<p>Other options:</p>\n<p>Option A:<strong> Timolol</strong>&nbsp;is a&nbsp;<strong>non-selective beta-blocker</strong>&nbsp;used topically in glaucoma. Ocular adverse effects of beta-blockers include&nbsp;<strong>dryness</strong>&nbsp;and&nbsp;<strong>redness</strong>&nbsp;of the eye, stinging, corneal hypoesthesia, blurred vision, and allergic blepharoconjunctivitis. Systemic side effects like bradycardia and bronchospasm may be seen due to absorption through the nasolacrimal duct.</p>\n<p>Option B: <strong>Pilocarpine</strong>&nbsp;is a&nbsp;<strong>miotic</strong>&nbsp;agent and adverse effects are corneal edema, miosis, induced myopia, and retinal detachment.</p>\n<p>Option C:<strong> Acetazolamide</strong>&nbsp;is a&nbsp;<strong>carbonic anhydrase inhibitor&nbsp;</strong>and reduces intraocular pressure by&nbsp;<strong>reducing&nbsp;</strong>the<strong>&nbsp;aqueous humor formation.&nbsp;</strong>It&nbsp;is given orally and the systemic adverse effects are anorexia, paresthesia, hypokalemia, acidosis, and depression.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 30-year-old female patient presents to the emergency department with complaints of chest pain and palpitations. ECG strip obtained is shown in the image below. His BP is 120/76 mm Hg. Vagal maneuvers were tried but failed. What is the drug of choice for this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Lidocaine"
      },
      {
        "id": 2,
        "text": "Esmolol"
      },
      {
        "id": 3,
        "text": "Digoxin"
      },
      {
        "id": 4,
        "text": "Adenosine"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>This ECG strip&nbsp;is suggestive of the AV nodal reentry (<strong>AVNRT</strong>) variant of&nbsp;<strong>paroxysmal supraventricular tachycardia (PSVT). </strong>The drug of choice for the termination of PSVT is <strong>adenosine.</strong><strong>&nbsp;</strong></p>\n<div class=\"O0\">\n<p>PSVT spans a variety of tachycardia that differ based on the pathway of impulse conduction. They include AV node reentry, AV reentry via an accessory pathway, and atrial tachycardia. AVNRT is the most commonly seen pattern of PSVT in healthy adults, especially in women. This form of PSVT is due to the re-entry of the electrical impulse from the AV node to the right atrium via either of the 2 pathways (superior fast pathway and inferior slow pathway).</p>\n<p>The given ECG strip shows changes suggestive of <strong>AV node reentry tachycardia</strong> based on the following findings-</p>\n<ul>\n<li><strong>Narrow QRS complex</strong> tachycardia (green arrows) at 150 bpm - indicative of a regular atrial rate (<strong>1:1 AV response</strong>). Heart rate is calculated by dividing 300 by the number of large boxes between 2 consecutive R waves. The ECG strip shows the presence of roughly 2 large boxes between 2 consecutive R waves, thereby making the HR ~150 bpm.&nbsp;</li>\n<li><strong>No visible P waves</strong> - indicative of dual conduction pathways (slow and fast) that cause simultaneous atrial and ventricular activation.</li>\n<li>The P wave may sometimes be seen at the end of the QRS complex as a <strong>pseudo-r' wave (V1)</strong>&nbsp;(black arrow) and <strong>pseudo-S wave (II, III, aVF)&nbsp;</strong>(blue arrows).&nbsp;</li>\n</ul>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/fbcd52b7772648e9a6a49d11b9f4fb45.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1124ef0817754554a5b835c82e1377d2x1280x644.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/73866a11df3b4cba923658ca97b6c962x510x812.PNG"
    ]
  },
  {
    "text": "A 23-year-old pregnant woman presented with features suggestive of thyrotoxicosis. Which of the following is not a treatment option for her condition?",
    "choices": [
      {
        "id": 1,
        "text": "Methimazole"
      },
      {
        "id": 2,
        "text": "Propylthiouracil"
      },
      {
        "id": 3,
        "text": "Radioactive iodine"
      },
      {
        "id": 4,
        "text": "Subtotal thyroidectomy"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Radioactive iodine therapy</strong> is<strong> contraindicated</strong> during pregnancy and lactation. Therefore, it is not a treatment option in this patient.</p>\n<p>Thyrotoxicosis in pregnancy:</p>\n<p>The <strong>drug of choice</strong> for the treatment of thyrotoxicosis during the<strong> first trimester </strong>of pregnancy is <strong>propylthiouracil (PTU).</strong></p>\n<p>Methimazole and its prodrug (carbimazole) are usually avoided in the first trimester due to <strong>teratogenic risk.</strong>&nbsp;However, methimazole is used for the remainder of the pregnancy due to the concern for <strong>PTU-associated liver failure.</strong>&nbsp;</p>\n<p><strong>Subtotal thyroidectomy</strong> can be performed during the <strong>mid-trimester.</strong></p>\n<p><strong>Radioactive iodine </strong>crosses the placenta and causes the destruction of the fetal thyroid. Therefore, it&nbsp;is<strong> contraindicated</strong> during pregnancy and lactation.</p>\n<p>Treatment of thyrotoxicosis in pregnancy</p>\n<table style=\"height: 108px; width: 381px;\">\n<tbody>\n<tr style=\"height: 46px;\">\n<td style=\"width: 137.828125px; height: 46px; text-align: center;\"><strong>Trimester</strong></td>\n<td style=\"width: 227.1875px; height: 46px; text-align: center;\"><strong>Treatment for thyrotoxicosis</strong></td>\n</tr>\n<tr style=\"height: 46px;\">\n<td style=\"width: 137.828125px; height: 46px;\"><strong>First trimester</strong></td>\n<td style=\"width: 227.1875px; height: 46px;\">\n<ul>\n<li>Propylthiouracil</li>\n</ul>\n</td>\n</tr>\n<tr style=\"height: 64px;\">\n<td style=\"width: 137.828125px; height: 64px;\"><strong>Second trimester</strong></td>\n<td style=\"width: 227.1875px; height: 64px;\">\n<ul>\n<li>Methimazole</li>\n<li>Subtotal thyroidectomy</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td style=\"width: 137.828125px;\"><strong>Third trimester</strong></td>\n<td style=\"width: 227.1875px;\">\n<ul>\n<li>Methimazole</li>\n</ul>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 64-year-old male is diagnosed with chronic congestive heart failure and is started on beta-blockers. His symptoms fail to improve, and he is started on a new drug. His BP is 132/80 mmHg, and his heart rate is 84 beats/minute. He now complains of visual disturbances characterized by a transiently enhanced brightness in particular areas of the visual field. What is the drug he was likely to have been started on?",
    "choices": [
      {
        "id": 1,
        "text": "Ranolazine"
      },
      {
        "id": 2,
        "text": "Ivabradine"
      },
      {
        "id": 3,
        "text": "Trimetazidine"
      },
      {
        "id": 4,
        "text": "Fasudil"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The patient was likely started on<strong><span data-preserver-spaces=\"true\">&nbsp;ivabradine.&nbsp;</span></strong></p>\n<p><span data-preserver-spaces=\"true\">Ivabradine may be used in chronic heart failure patients who</span><strong><span data-preserver-spaces=\"true\">&nbsp;do not tolerate &beta; blockers</span></strong><span data-preserver-spaces=\"true\">&nbsp;or have a&nbsp;</span>heart rate of<strong><span data-preserver-spaces=\"true\"> &gt;75 </span></strong>beats/min even <strong>with<span data-preserver-spaces=\"true\">&nbsp;&beta; blocker </span></strong>administration<span data-preserver-spaces=\"true\">. One of its common side effects includes the development of <strong>phosphenes</strong>. Phosphenes are transiently enhanced brightness in specific areas of the visual field.</span></p>\n<p><span data-preserver-spaces=\"true\">Ivabradine selectively blocks the hyperpolarization-activated sodium channels (HCN) in the SA node to reduce the pacemaker current&nbsp;I<sub>f</sub>&nbsp;(Na<sup>+</sup>&nbsp;funny current channel) and <strong>decreases heart rate. </strong>It</span><span data-preserver-spaces=\"true\">&nbsp;</span>reduces heart rate without affecting myocardial contractility, ventricular repolarization, or intracardiac conduction.<span data-preserver-spaces=\"true\">&nbsp;The&nbsp;</span><strong><span data-preserver-spaces=\"true\">antianginal effect</span></strong><span data-preserver-spaces=\"true\">&nbsp;is mainly by reducing heart rate and thereby decreasing the O<sub>2</sub> demand of the myocardium.</span></p>\n<p><span data-preserver-spaces=\"true\">Other side effects include bradycardia, QT prolongation, and atrial fibrillation.</span></p>\n<p><span data-preserver-spaces=\"true\">The hyperpolarization cyclic nucleotide (HCN) channels are also present on the retina. These channels on continuous blockade by ivabradine are&nbsp;</span><strong><span data-preserver-spaces=\"true\">hyperpolarized&nbsp;</span></strong>and lead to<strong><span data-preserver-spaces=\"true\"> increased brightness </span></strong>in restricted areas of the visual field. These phenomena are known as<strong><span data-preserver-spaces=\"true\"> phosphenes.&nbsp;</span></strong></p>\n<p><span data-preserver-spaces=\"true\">Normally, the signal transduction pathway in the retina involves the opening of HCN channels. This leads to the influx of calcium to activate cGMP and causes recovery from light to dark. In cases where HCN channels are blocked, this pathway is affected and recovery from light to dark takes time resulting in increased brightness. The image attached below shows a normal transduction pathway.</span></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a50eb5d73a8541fea55a3ea5b54bb2ffx1280x541.PNG"
    ]
  },
  {
    "text": "A 35-year-old woman came to the emergency department with severe pain in both legs, after she underwent an induced abortion using ergotamine. On examination, her legs were cold and pale, and peripheral arterial pulses were not felt. Which of the following drugs can be used as an antidote in treating the condition?",
    "choices": [
      {
        "id": 1,
        "text": "Sumatriptan"
      },
      {
        "id": 2,
        "text": "Bromocriptine"
      },
      {
        "id": 3,
        "text": "Nitroprusside"
      },
      {
        "id": 4,
        "text": "Ephedrine"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Nitroprusside</strong> can be used as an antidote to reverse the ergot-induced vasospasm.</p>\n<p>Nitroprusside is a non-selective vasodilator. It acts by releasing NO, which activates the guanylyl cyclase - cyclic GMP \u2013 protein kinase G pathway, leading to vasodilation. This mechanism mimics the production of NO by vascular endothelial cells.</p>\n<p><strong>Therapeutic uses:</strong></p>\n<ul>\n<li>It is primarily used in the treatment of <strong>hypertensive</strong> <strong>emergencies</strong>.</li>\n<li>To lower blood pressure during <strong>aortic</strong> <strong>dissection</strong>. It is important to administer beta blocker with nitroprusside in aortic dissection to reduce heart rate, because if nitroprusside is given alone, it causes increased myocardial contractility, which in turn increases the rate of increase in aortic pressure and may further aggravate the dissection.</li>\n<li>To improve cardiac output in patients with <strong>congestive</strong> <strong>heart</strong> <strong>failure</strong>, especially with hypertension and pulmonary edema, who are refractory to other treatments.</li>\n<li>To decrease myocardial oxygen demand after <strong>myocardial</strong> <strong>infarction</strong>.</li>\n<li>To induce controlled hypotension during anesthesia, and reduce bleeding during <strong>surgical</strong> <strong>procedures</strong>.</li>\n<li>To reverse the vasospastic action of the <strong>ergot</strong> <strong>alkaloids</strong>, such as ergotamine and ergonovine.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient with chronic pain was prescribed a drug that inhibits the reuptake of serotonin and norepinephrine. Identify the prescribed drug.",
    "choices": [
      {
        "id": 1,
        "text": "Hydromorphone"
      },
      {
        "id": 2,
        "text": "Tramadol"
      },
      {
        "id": 3,
        "text": "Buprenorphine"
      },
      {
        "id": 4,
        "text": "Hydrocodone"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Tramadol </strong>is a synthetic codeine analog<strong>. </strong>Mechanism of action is a combination of effects as mentioned below-</p>\n<ul>\n<li>Weak agonist action on the mu-opioid receptor</li>\n<li><strong>Inhibition of serotonin reuptake</strong> transporter (moderate action) and<strong> norepinephrine reuptake</strong> transporter (weak action).&nbsp;</li>\n</ul>\n<p>It is used to induce analgesia for moderate pain and can be used as an adjunct to opioid therapy in chronic pain conditions.&nbsp;</p>\n<p>Other options:&nbsp;They do not affect serotonin and norepinephrine reuptake</p>\n<p>Option A:<strong> Hydromorphone&nbsp;</strong>is a phenanthrene drug with <strong>strong mu-opioid agonist</strong> action with a variable affinity for delta and kappa receptors. It is similar to morphine.&nbsp;&nbsp;</p>\n<p>Option C:<strong> Buprenorphine&nbsp;</strong>is also a phenanthrene derivative that has <strong>mixed opioid agonist-antagonist</strong> activity. It is a partial mu-agonist and has antagonist activity at delta and kappa receptors. While it can serve as an analgesic, it antagonizes the action of strong mu-agonists such as morphine. It is used to treat moderate pain and reduced cravings in patients recovering from alcoholism.</p>\n<p>Option D:<strong> Hydrocodone&nbsp;</strong>is a phenanthrene drug with&nbsp;<strong>mild-moderate mu-opioid agonist&nbsp;</strong>action. It is less efficacious than morphine.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 58-year-old patient came to the hospital with complaints of sudden onset of severe pain in the right side of lips, gums, and cheek. It occurs during both day and night and lasts for 2-3 min and has been present for 3 weeks. What is the primary agent in the treatment of this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Zonisamide"
      },
      {
        "id": 2,
        "text": "Carbamazepine"
      },
      {
        "id": 3,
        "text": "Sodium valproate"
      },
      {
        "id": 4,
        "text": "Vigabatrin"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The clinical symptoms are suggestive of trigeminal neuralgia<strong>. Carbamazepine</strong> is the <strong>primary agent</strong> for the treatment of <strong>trigeminal neuralgia</strong>. If carbamazepine is not effective then second-line<strong>\u00a0</strong>agents like lamotrigine and phenytoin are used.\u00a0</p>\n<p><strong>Trigeminal neuralgia</strong> is more common in women over <strong>50 years</strong> of age. It is characterized by unilateral lancinating <strong>facial pain</strong>, most commonly involving the second and/or third divisions of the trigeminal nerve territory. Bilateral or early onset is associated with multiple sclerosis. Unilateral trigeminal nerve compresion can be due to superior cerebellar artey.</p>\n<p>The pain is <strong>repetitive, severe</strong>, and very brief. This occurs spontaneously or is triggered by <strong>touch, cold wind</strong>, or <strong>eating</strong>. Physical signs are usually absent, although the spasms may make the patient wince and sit silently (tic douloureux). There are no objective signs of sensory loss.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 33-year-old female patient comes to your clinic with crampy abdominal pain, constipation, and bloating on and off for the past 10 years. Pain occurs frequently after meals and is relieved after defecation without any bleeding while defecating. On examination, the abdomen is soft and non-tender. Which of the following drugs is the most appropriate management for this patient's condition?",
    "choices": [
      {
        "id": 1,
        "text": "Lubiprostone"
      },
      {
        "id": 2,
        "text": "Loperamide"
      },
      {
        "id": 3,
        "text": "Alosetron"
      },
      {
        "id": 4,
        "text": "Rifaximin"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>This patient's condition is irritable bowel syndrome with constipation and the drug used for this condition is <strong>lubiprostone.</strong></p>\n<p>The <strong>ROME IV criteria</strong>\u00a0is\u00a0used to diagnose<strong> irritable bowel syndrome</strong>, which requires at least 3 days a month in the last 3 months associated with 2 or more of\u00a0the following:</p>\n<ul>\n<li>improvement in abdominal pain or discomfort with defecation</li>\n<li>onset associated with a change in frequency of stool</li>\n<li>and/or an onset accompanied by a change in form or appearance of stool</li>\n</ul>\n<p>It is\u00a0approved for<strong> chronic idiopathic constipation </strong>and<strong> constipation-predominant irritable bowel syndrome</strong> (in female patients &gt;18 years). It acts by stimulating the Cl-channels opening in the intestine and increasing liquid secretion in the gut. This decreases the transit time.</p>\n<p>Other options:</p>\n<p>Alosetron is a 5-HT3 receptor antagonist which is indicated only for women with severe diarrhea-predominant IBS who have chronic IBS symptoms ( lasting 6 months or longer) and have not responded adequately to conventional therapy. Serious GI adverse reactions like ischemic colitis, serious complications of constipation have been associated with its usage.</p>\n<p>Rifaximin is indicated for irritable bowel syndrome with diarrhea (IBS-D) in adult men and women.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Your friend is planning a trip to the mountains but is concerned because of her history of severe nausea and vomiting while traveling anywhere. Which of the following drugs would be the least effective in managing her condition?",
    "choices": [
      {
        "id": 1,
        "text": "Scopalamine"
      },
      {
        "id": 2,
        "text": "Ondansetron"
      },
      {
        "id": 3,
        "text": "Meclizine"
      },
      {
        "id": 4,
        "text": "Diphenhydramine"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Among the given options, ondansetron is the least effective\u00a0in managing motion sickness.</p>\n<p><span data-preserver-spaces=\"true\">Ondansetron is a</span><strong><span data-preserver-spaces=\"true\">\u00a05 HT<sub>3</sub> receptor antagonist</span></strong>. It blocks impulses at the peripheral origin in GIT and does not suppress vomiting caused by motion sickness.\u00a0<span data-preserver-spaces=\"true\">It is most commonly indicated for the treatment of\u00a0</span><strong><span data-preserver-spaces=\"true\">postoperative\u00a0</span></strong><span data-preserver-spaces=\"true\">and <strong>chemotherapy</strong>-<strong>induced</strong></span><strong><span data-preserver-spaces=\"true\">\u00a0nausea </span></strong>and <strong><span data-preserver-spaces=\"true\">vomiting.\u00a0</span></strong></p>\n<p>Drugs used in the treatment of motion sickness are:</p>\n<ul>\n<li><strong><span data-preserver-spaces=\"true\">Anticholinergic</span></strong><span data-preserver-spaces=\"true\">\u00a0agents (muscarinic receptor antagonists) such as\u00a0<strong>scopolamine</strong> (<strong>hyoscine</strong>) and dicyclomine.</span></li>\n<li><strong><span data-preserver-spaces=\"true\">Antihistamines</span></strong> (H1 antagonists)<strong><span data-preserver-spaces=\"true\">\u00a0</span></strong><span data-preserver-spaces=\"true\">are primarily used for treating\u00a0</span><strong><span data-preserver-spaces=\"true\">motion sickness\u00a0</span></strong><span data-preserver-spaces=\"true\">and</span><strong><span data-preserver-spaces=\"true\">\u00a0postoperative emesis.\u00a0\u00a0</span></strong></li>\n</ul>\n<p><span data-preserver-spaces=\"true\"><strong><span data-preserver-spaces=\"true\">Scopolamine transdermal patches\u00a0</span></strong><span data-preserver-spaces=\"true\">should be given\u00a0<strong>prophylactically</strong>\u00a0as it is less effective once symptoms start. It is\u00a0<strong>applied behind the ear</strong>\u00a0at least\u00a0<strong>4-12</strong>\u00a0<strong>hours before</strong>\u00a0an anticipated exposure to motion.\u00a0</span><strong><span data-preserver-spaces=\"true\">Dry</span></strong><span data-preserver-spaces=\"true\">\u00a0</span><strong><span data-preserver-spaces=\"true\">mouth\u00a0</span></strong>and<strong><span data-preserver-spaces=\"true\">\u00a0sedation</span></strong><span data-preserver-spaces=\"true\">\u00a0are common side effects.</span></span></p>\n<p><span data-preserver-spaces=\"true\">First-generation antihistamines such as <strong>promethazine,</strong> dimenhydrinate, chlorpheniramine, <strong>diphenhydramine</strong>, cyclizine, and <strong>meclizine</strong> are effective in controlling nausea and vomiting in motion sickness.\u00a0</span><strong><span data-preserver-spaces=\"true\">Sedation</span></strong><span data-preserver-spaces=\"true\">\u00a0is a common side effect of these drugs. Second-generation antihistamines like cetirizine and fexofenadine are ineffective in the treatment of motion sickness.</span></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient was given metoclopramide for severe vomiting.  After which he developed symptoms like acute dystonia, bradykinesia, and tremors. The observed adverse effects are due to?",
    "choices": [
      {
        "id": 1,
        "text": "Agonistic action on serotonin 5HT4 receptor"
      },
      {
        "id": 2,
        "text": "Antagonist action on dopamine receptors"
      },
      {
        "id": 3,
        "text": "Antagonistic action on serotonin 5HT3 receptor"
      },
      {
        "id": 4,
        "text": "Sensitization of muscarinic receptors"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In the above scenario, the patient has developed&nbsp;<strong>extrapyramidal</strong> adverse effects like <strong>acute dystonia,</strong> <strong>bradykinesia</strong>, and<strong> tremors. </strong>This is likely due to<strong>&nbsp;</strong>the&nbsp;<strong>antagonist</strong> action on <strong>dopamine receptors</strong> by <strong>metoclopramide.</strong></p>\n<p>Metoclopramide is a <strong>prokinetic</strong> and <strong>antiemetic.</strong> It has the following <strong>pharmacological actions:</strong></p>\n<ul>\n<li><strong>Dopamine</strong> receptor <strong>antagonist</strong>&nbsp;</li>\n<li>Serotonin (<strong>5HT4</strong>) receptor <strong>agonist</strong>&nbsp;</li>\n<li>Serotonin (<strong>5HT3</strong>) <strong>antagonist</strong></li>\n<li><strong>Sensitization</strong> of <strong>muscarinic receptors</strong> on <strong>smooth muscle.</strong> This results in <strong>increased</strong> lower <strong>esophageal sphincter tone</strong> and stimulates gastric antral contractions.</li>\n</ul>\n<p>Metoclopramide acts on both the gastrointestinal system and central nervous system. It is used as an upper antiemetic for many types of vomiting, especially migraine, drug-induced, and<strong> chemotherapy-induced</strong>. It is also used as a prokinetic in <strong>gastroparesis</strong> to increase gastric emptying.</p>\n<p>Adverse effects of metoclopramide are mainly extrapyramidal effects, and these include <strong>acute dystonia, Parkinson</strong><strong>-like</strong> symptoms (tremors, bradykinesia, rigidity), tardive dyskinesia,<strong> galactorrhea </strong>due to hyperprolactinemia, and methemoglobinemia in neonates.</p>\n<p>Extrapyramidal symptoms can be <strong>treated</strong> by <strong>discontinuation</strong> of metoclopramide and administration of anticholinergics or antihistaminics.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 55-year-old post-menopausal woman with a family history of breast cancer presents with persistent lower backache. Her bone mineral density is measured, and the T-score is -2.6. She is prescribed raloxifene. Which of the following effects of this drug should the patient be informed about?",
    "choices": [
      {
        "id": 1,
        "text": "Decreases incidence of hot flashes"
      },
      {
        "id": 2,
        "text": "Increases incidence of endometrial hyperplasia"
      },
      {
        "id": 3,
        "text": "Increases incidence of venous thrombosis"
      },
      {
        "id": 4,
        "text": "Increases incidence of breast carcinoma"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<div class=\"page\" title=\"Page 818\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>This post-menopausal patient with a family history of breast cancer, with osteoporosis&nbsp;(low back pain, a T-score of -2.6), has been recommended to take raloxifene. Raloxifene causes a <strong>3-fold increase </strong>in <strong>deep vein thrombosis</strong> and pulmonary embolism.</p>\n<p>It is a selective estrogen receptor modulator&nbsp;<strong>(SERM)</strong> with the following actions-</p>\n</div>\n</div>\n</div>\n</div>\n<p>Agonist actions:</p>\n<ul>\n<li>Bone: Increases bone mineral density and <strong>reduces </strong>the risk of<strong> vertebral fractures</strong></li>\n<li>Lipids: Reduces total cholesterol and low-density lipoprotein. However, it does not increase HDL cholesterol.</li>\n<li>Increases the <strong>risk</strong> of <strong>deep vein thrombosis</strong> and<strong> pulmonary embolism.&nbsp;</strong></li>\n</ul>\n<p>Antagonist action:</p>\n<ul>\n<li>Breast: <strong>Incidence of breast carcinoma is reduced</strong> (option D).&nbsp;Raloxifene has an antiproliferative effect on ER-positive breast tumors and significantly reduces the risk of ER-positive but not ER-negative breast cancer.</li>\n<li>Uterus: does <strong>not</strong> stimulate&nbsp;<strong>endometrial proliferation</strong>&nbsp;(option B)</li>\n</ul>\n<p>Note: Raloxifene does not help with vasomotor symptoms, and some people might experience hot flashes&nbsp;(option A).</p>\n<table style=\"width: 420.297px; height: 164px;\">\n<tbody>\n<tr>\n<td style=\"width: 80px;\">SERM</td>\n<td style=\"width: 105px;\">Effect on breast&nbsp;</td>\n<td style=\"width: 104px;\">Effect on endometrium</td>\n<td style=\"width: 94.2969px;\">Effect on bone</td>\n</tr>\n<tr>\n<td style=\"width: 80px;\">Tamoxifen</td>\n<td style=\"width: 105px;\">Inhibits proliferation</td>\n<td style=\"width: 104px;\"><strong>Stimulates proliferation</strong></td>\n<td style=\"width: 94.2969px;\">Antiresorptive</td>\n</tr>\n<tr>\n<td style=\"width: 80px;\">Raloxifene</td>\n<td style=\"width: 105px;\">Inhibits proliferation</td>\n<td style=\"width: 104px;\"><strong>Inhibits proliferation</strong></td>\n<td style=\"width: 94.2969px;\">Antiresorptive</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 20-year-old male patient presents to the emergency department with complaints of breathing difficulty, facial swelling, and palpitations following a bee sting. He was immediately given an intramuscular injection of a drug in 1:1000 dilution. The drug acts on which of the following receptor to improve the patient's breathing difficulty?",
    "choices": [
      {
        "id": 1,
        "text": "Beta 2"
      },
      {
        "id": 2,
        "text": "Beta 1"
      },
      {
        "id": 3,
        "text": "Alpha 2"
      },
      {
        "id": 4,
        "text": "Alpha 1"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The patient's complaints of\u00a0breathing difficulty, facial swelling, and palpitations following a bee sting are suggestive of anaphylactic shock. The <strong>drug\u00a0of choice</strong> for anaphylaxis is <strong>intramuscular adrenaline</strong> (<strong>0.5ml in 1:1000 dilution</strong>). Activation of <strong>beta 2</strong> receptors causes<strong> bronchodilation</strong>. Hence, adrenaline action on the beta 2 receptors improves the breathing difficulty in this patient. Apart from this, beta 2 receptors also inhibit the secretion from mast cells.</p>\n<p><strong>Other options:</strong></p>\n<table style=\"height: 99px;\" width=\"456\">\n<tbody>\n<tr>\n<td style=\"width: 86.28125px;\"><strong>Receptor</strong></td>\n<td style=\"width: 157.734375px;\"><strong>Action</strong></td>\n<td style=\"width: 190.015625px;\"><strong>Use in anaphylaxis treatment\u00a0</strong></td>\n</tr>\n<tr>\n<td style=\"width: 86.28125px;\">Alpha 1 and Alpha 2</td>\n<td style=\"width: 157.734375px;\">Vasoconstriction</td>\n<td style=\"width: 190.015625px;\">Increase in BP</td>\n</tr>\n<tr>\n<td style=\"width: 86.28125px;\">Beta 1</td>\n<td style=\"width: 157.734375px;\">Cardiac stimulation</td>\n<td style=\"width: 190.015625px;\">Increase in BP</td>\n</tr>\n<tr>\n<td style=\"width: 86.28125px;\">Beta 2</td>\n<td style=\"width: 157.734375px;\">Bronchodilation</td>\n<td style=\"width: 190.015625px;\">Reverse bronchoconstriction\u00a0</td>\n</tr>\n</tbody>\n</table>\n<p><br />The net effect of adrenaline on BP: Adrenaline rapidly <strong>increases blood pressure</strong> by reversing vasodilation and improving cardiac output. This is critical for preventing shock and ensuring adequate perfusion to vital organs during anaphylaxis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A pregnant woman presents to your OPD with severe constipation. After ruling out pathological causes, which of the following is the safest to prescribe?",
    "choices": [
      {
        "id": 1,
        "text": "Senna"
      },
      {
        "id": 2,
        "text": "Bisacodyl"
      },
      {
        "id": 3,
        "text": "Docusates"
      },
      {
        "id": 4,
        "text": "Lactulose"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Lactulose</strong> is safe to use in pregnant women with constipation.</p>\n<p><strong>Constipation in pregnancy:</strong></p>\n<p>Constipation is a common occurrence in pregnancy because of dietary alterations, anatomic impingement of a large uterus on the rectosigmoid, fluid shifts, decreased exercise levels, and reduced mobility. Pregnancy and pregnancy-related constipation increases the risk for developing haemorrhoids.</p>\n<p>Treatment options include</p>\n<ul>\n<li>Dietary changes - increased water intake, increased fibre in diet</li>\n<li>Gentle exercises</li>\n<li>Laxatives - <strong>Lactulose, </strong>an osmotic purgative,<strong>&nbsp;</strong>and <strong>Ispaghula,</strong> a bulk forming agent, are safe to use in pregnancy.&nbsp;</li>\n</ul>\n<p>Senna, bisacodyl, docusates and saline laxatives&rsquo; <strong>safety</strong> is <strong>unknown</strong> and hence it is better to <strong>avoid</strong> them.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which one of the following conditions requires treatment with pulsatile doses of GnRH agonists?",
    "choices": [
      {
        "id": 1,
        "text": "Male infertility"
      },
      {
        "id": 2,
        "text": "Precocious puberty"
      },
      {
        "id": 3,
        "text": "Prostate cancer"
      },
      {
        "id": 4,
        "text": "Endometriosis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The pulsatile dose of GnRH agonist is used in the treatment of male infertility.</p>\n<p><strong>Pulsatile</strong> <strong>administration</strong> of GnRH agonist <strong>increases FSH and LH</strong> secretion and is used to<strong> treat male and female infertility</strong>.</p>\n<p>A non-pulsatile or a continuous dose of GnRH agonist results in suppression and decreased concentrations of gonadotropins (LH and FSH). Hence, it cannot be used in the treatment of male infertility.\u00a0</p>\n<p>Non-pulsatile (Continuous) administration of GnRH analogs used in:\u00a0</p>\n<ul>\n<li>Endometriosis</li>\n<li>Uterine fibroids</li>\n<li>Central precocious puberty</li>\n<li>Ca prostate</li>\n<li>Ca ovary and breast</li>\n<li>Controlled ovary stimulation</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 68-year-old male patient came to the physician with complaints of chronic back pain and easy fatigability.  An X-ray of his skull is shown below. Laboratory investigations show decreased hemoglobin, hypercalcemia, normal alkaline phosphatase, elevated ESR. He should be started on which of the following combination therapy?",
    "choices": [
      {
        "id": 1,
        "text": "Thalidomide + Cyclophosphamide"
      },
      {
        "id": 2,
        "text": "Rituximab+ Cyclophosphamide"
      },
      {
        "id": 3,
        "text": "Bortezomib + Rituximab"
      },
      {
        "id": 4,
        "text": "Lenalidomide + Bortezomib+Dexamethasone"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>This patient's history and clinical findings are suggestive of multiple myeloma.<strong><span data-preserver-spaces=\"true\"> Lenalidomide +Bortezomib+Dexamethasone </span></strong>is the treatment of choice in<strong><span data-preserver-spaces=\"true\">\u00a0multiple myeloma.</span></strong></p>\n<p><span data-preserver-spaces=\"true\">This patient's anemia, hypercalcemia, normal alkaline phosphatase, elevated ESR are consistent with the diagnosis of multiple myeloma. The <strong>skull</strong> demonstrates the typical\u00a0<strong>\u201cpunched out\u201d lesions</strong>\u00a0characteristic of multiple myeloma.\u00a0</span></p>\n<p><span data-preserver-spaces=\"true\">Multiple myeloma is a malignant <strong>plasma cell dyscrasia</strong> with the proliferation of plasma cells derived from a single clone. Bone pain is the most common presenting symptom in multiple myeloma.\u00a0</span>The next most common clinical problem in patients with myeloma is susceptibility to bacterial infections. The most common infections are pneumonia and pyelonephritis, and the most frequent pathogens are <em>Streptococcus pneumoniae</em>, <em>Staphylococcus aureus</em>, and <em>Klebsiella pneumoniae</em> in the lungs and <em>Escherichia coli</em> and other gram-negative organisms in the urinary tract.</p>\n<p><span data-preserver-spaces=\"true\"><strong>Chemotherapy</strong> followed by <strong>a</strong><strong>utologous stem cell transplantation</strong>\u00a0prolongs overall survival in multiple myeloma patients.</span></p>\n<p><span data-preserver-spaces=\"true\">The combination of lenalidomide, bortezomib, and dexamethasone achieves close to a 100% response rate making it one of the preferred induction regimens in transplant-eligible patients.</span></p>\n<p><span data-preserver-spaces=\"true\">NOTE: The U.S. FDA has approved ABECMA, the first cell-based gene therapy to treat adult patients with multiple myeloma who have not responded to, or whose disease has returned after, at least four prior lines (different types) of therapy.</span></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/349c22547afe4047b9d2175715221f38.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e607b9cda8ba4e52913d9b4df17e2270x1280x2516.JPEG"
    ]
  },
  {
    "text": "A patient with pulmonary hypertension comes for a vasoreactivity test. What drugs can be used if the test is negative?",
    "choices": [
      {
        "id": 1,
        "text": "1, 2, 3 & 5"
      },
      {
        "id": 2,
        "text": "1, 3 & 5"
      },
      {
        "id": 3,
        "text": "1, 3, 4 & 5"
      },
      {
        "id": 4,
        "text": "1, 2, 3, 4 & 5"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The drugs used for pulmonary hypertension if vasoreactivity test is negative are<strong> 1, 3, and 5.</strong></p>\n<div class=\"page\" title=\"Page 95\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Bosentan</strong> is an <strong>endothelin receptor antagonist, sildenafil</strong> is a <strong>phosphodiesterase-5 (PDE5) inhibitor,</strong> and <strong>riociguat&nbsp;</strong>is a <strong>soluble guanylyl cyclase stimulator&nbsp;</strong>used to treat pulmonary arterial hypertension</p>\n</div>\n</div>\n</div>\n</div>\n<p><strong>Vasoreactivity testing</strong> involves the administration of inhaled nitric oxide, IV epoprostenol, or adenosine.&nbsp;The<strong>&nbsp;</strong>test is considered<strong> positive</strong> if the mean pulmonary arterial pressure (mPAH)<strong> decreases.</strong></p>\n<ul>\n<li><strong>Positive vasoreactivity </strong>test:&nbsp;<strong>Calcium channel blockers&nbsp;</strong>(CCB) are indicated. Nifedipine, diltiazem or <strong>amlodipine</strong> are used.</li>\n<li><strong>Negative vasoreactivity</strong> test: Drugs other than CCBs are used.</li>\n</ul>\n<p>Latanoprost is a prostaglandin analog that is a PGF2&alpha; derivative. It reduces intraocular pressure by increasing uveoscleral outflow. It is not used in the treatment of&nbsp;pulmonary hypertension.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e78da2196a8f48dc97e5db27603061c7x1280x1794.JPEG"
    ]
  },
  {
    "text": "Arrange the following insulin preparations in ascending order of their respective duration of action.",
    "choices": [
      {
        "id": 1,
        "text": "3-5-4-1-2"
      },
      {
        "id": 2,
        "text": "4-2-5-3-1"
      },
      {
        "id": 3,
        "text": "3-4-5-2-1"
      },
      {
        "id": 4,
        "text": "4-5-2-3-1"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The\u00a0insulin preparations in <strong>ascending order</strong> of their respective <strong>duration of action</strong> are as follows:</p>\n<ol>\n<li>Afrezza</li>\n<li>Aspart</li>\n<li>Regular</li>\n<li>Glargine</li>\n<li>Degludec</li>\n</ol>\n<table style=\"height: 206px;\" width=\"453\">\n<tbody>\n<tr style=\"height: 18px;\">\n<td style=\"width: 106.499px; height: 18px;\">\n<p class=\"p1\">Preparation</p>\n</td>\n<td style=\"width: 106.499px; height: 18px;\">\n<p class=\"p1\">Onset (h)</p>\n</td>\n<td style=\"width: 106.499px; height: 18px;\">\n<p class=\"p1\">Peak (h)</p>\n</td>\n<td style=\"width: 106.513px; height: 18px;\">\n<p class=\"p1\">Effective Duration (h)</p>\n</td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 106.499px; height: 18px;\" colspan=\"4\">Short-acting\u00a0\u00a0\u00a0</td>\n</tr>\n<tr style=\"height: 132px;\">\n<td style=\"width: 106.499px; height: 132px;\">\n<p>\u00a0</p>\n<ul>\n<li><strong>Aspart</strong></li>\n<li>Glulisine</li>\n<li>Lispro</li>\n</ul>\n</td>\n<td style=\"width: 106.499px; height: 132px;\">\n<p class=\"p1\">&lt;0.25</p>\n</td>\n<td style=\"width: 106.499px; height: 132px;\">\n<p class=\"p1\">0.5\u20131.5</p>\n</td>\n<td style=\"width: 106.513px; height: 132px;\">\n<p class=\"p1\"><strong>3\u20134</strong></p>\n</td>\n</tr>\n<tr style=\"height: 64px;\">\n<td style=\"width: 106.499px; height: 64px;\">\n<p><strong>Regular</strong></p>\n</td>\n<td style=\"width: 106.499px; height: 64px;\">\n<p class=\"p1\">0.5\u20131.0</p>\n</td>\n<td style=\"width: 106.499px; height: 64px;\">\n<p class=\"p1\">2\u20133</p>\n</td>\n<td style=\"width: 106.513px; height: 64px;\">\n<p class=\"p1\"><strong>4\u20136</strong></p>\n</td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 106.499px; height: 18px;\" colspan=\"4\">Long-acting</td>\n</tr>\n<tr style=\"height: 31.5753px;\">\n<td style=\"width: 106.499px; height: 31.5753px;\">\n<p class=\"p1\">Detemir</p>\n</td>\n<td style=\"width: 106.499px; height: 67.5753px;\" rowspan=\"3\">\u00a0\n<p class=\"p1\">1\u20134</p>\n</td>\n<td style=\"width: 106.499px; height: 67.5753px;\" rowspan=\"3\">\u00a0Minimal peak activity at steady state</td>\n<td style=\"width: 106.513px; height: 31.5753px;\">\n<p class=\"p1\">12\u201320</p>\n</td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 106.499px; height: 18px;\"><strong>Glargine</strong></td>\n<td style=\"width: 106.513px; height: 18px;\"><strong>\u00a012\u201324</strong></td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 106.499px; height: 18px;\"><strong>Degludec</strong></td>\n<td style=\"width: 106.513px; height: 18px;\"><strong>\u00a024\u201342</strong></td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 106.499px; height: 18px;\">NPH</td>\n<td style=\"width: 106.499px; height: 18px;\">\u00a01\u20132</td>\n<td style=\"width: 106.499px; height: 18px;\">\u00a06\u201310</td>\n<td style=\"width: 106.513px; height: 18px;\">\u00a010\u201316</td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 106.499px; height: 18px;\" colspan=\"4\">Insulin combinations</td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 106.499px; height: 18px;\">\u00a0\n<p class=\"p1\">Mixture:</p>\n<p class=\"p1\">Short-acting (25%\u201350%) and Long acting (50%\u201376%)</p>\n</td>\n<td style=\"width: 106.499px; height: 18px;\">\u00a0&lt;0.25\u20131.0</td>\n<td style=\"width: 106.499px; height: 18px;\">\u00a0Depends on preparation</td>\n<td style=\"width: 106.513px; height: 18px;\">\u00a0Up to 10\u201316</td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 106.499px; height: 18px;\" colspan=\"4\">Inhaled insulin</td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 106.499px; height: 18px;\"><strong>Afrezza</strong></td>\n<td style=\"width: 106.499px; height: 18px;\">&lt;0.25</td>\n<td style=\"width: 106.499px; height: 18px;\">0.5\u20131.5</td>\n<td style=\"width: 106.513px; height: 18px;\"><strong>2\u20133</strong></td>\n</tr>\n</tbody>\n</table>\n<p>\u00a0</p>\n<p>A graphical plot of various preparations of insulin vs time is as follows:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c5a000b0a75e4c4387bf23f0c11b5725x720x854.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3600afa8b9b5452e9ec20f692fbf0ed7x1279x884.JPEG"
    ]
  },
  {
    "text": "At around 11.30 PM, a 45-year-old man is wheeled into the casualty with anginal pain for which the consultant advises nitrates. On administration of nitrates, his BP suddenly drops and the patient goes into sudden hypotension. On probing into his medical history, his wife mentions that he has been taking a drug for erectile dysfunction. What is the likely mechanism of the action of this drug?",
    "choices": [
      {
        "id": 1,
        "text": "Phosphodiesterase 3 inhibitors"
      },
      {
        "id": 2,
        "text": "Phosphodiesterase 5 inhibitors"
      },
      {
        "id": 3,
        "text": "Phosphodiesterase 2 inhibitors"
      },
      {
        "id": 4,
        "text": "Phosphodiesterase 4 inhibitors"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Erectile dysfunction</strong>&nbsp;is treated by <strong>phosphodiesterase 5 </strong>(PDE-5)<strong> inhibitors</strong> like <strong>sildenafil, vardenafil, </strong>and <strong>tadalafil. </strong>PDE-5 inhibitors and nitrates should <strong>not</strong> be prescribed together due to<strong>&nbsp;an increased risk </strong>of<strong> hypotension</strong>.</p>\n<p>The corpus cavernosum produces nitric oxide during arousal that stimulates the formation of cGMP. cGMP causes relaxation of the smooth muscle of the corpus cavernosum and penile arteries, engorgement of the corpus cavernosum, and erection.&nbsp;<strong>PDE-5 inhibitors </strong>enhance the <strong>accumulation </strong>of <strong>cGMP </strong>and are, therefore, used in the management of erectile dysfunction.</p>\n<p><strong>Drug interactions </strong>of PDE-5 and nitrates<strong>-&nbsp;</strong>PDE-5 inhibitors enhance the accumulation of cGMP by preventing its degradation and therefore cause vasodilation. Since nitrates also act by increasing cyclic GMP mechanism, they can therefore potentiate the effects of PDE-5 inhibitors. Hence, men treated with PDE-5 inhibitors and nitrates are at risk for<strong> severe hypotension </strong>and<strong> syncope.</strong></p>\n<p><strong>Adverse effects of PDE-5 inhibitors-</strong></p>\n<ul>\n<li>The most common side effects reported include headache, flushing, nasal congestion, nasopharyngitis, and dyspepsia. Rare but serious reports of prolonged erections lasting more than 4 hours and priapism (painful erections lasting more than 4 hours) have been reported with PDE<sub>5</sub>&nbsp;inhibitors.&nbsp;</li>\n<li><strong>Sildenafil </strong>and<strong> vardenafil</strong>&nbsp;also cause retinal PDE-6 inhibition and can result in blurring of vision and <strong>blue-green tinting of the vision</strong>.&nbsp;</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = 'Integrated Mini Test 12 - Pharmacology';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2024-25"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>