<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>14 Metabolic Disorders Of Amino Acids - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Pediatrics
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">26</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A mother reports to the OPD with the complaint that her child smells funny. On examination, you notice that the child has a global developmental delay and smells mousy. What is your probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Phenylketonuria"
      },
      {
        "id": 2,
        "text": "Tyrosinemia"
      },
      {
        "id": 3,
        "text": "Hawkinsinuria"
      },
      {
        "id": 4,
        "text": "Hypermethioninemia"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Mousy odor</strong> is characteristically seen in <strong>phenylketonuria</strong> due to <strong>excess phenylacetate&nbsp;</strong>(phenyl ketone) formed in the body.</p>\n<p>In the absence of phenylalanine hydroxylase, phenylalanine enters into alternate metabolic pathways which result in the formation of phenyl lactate, phenylacetate, and phenylacetylglutamine.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A boy who attends school is sent to the principal's office as he often distracts others by rhythmically rocking back and forth on his seat. His mother worried about his behavior brings him to you. She also gives you a history of seizures. On examination, you notice he has blonde hair, fair skin, microcephaly, prominent maxillae with widely spaced teeth, and growth retardation. His urine changes its color transiently to blue-green on the addition of 1ml ferric chloride solution. What is the cause of CNS symptoms in this child?",
    "choices": [
      {
        "id": 1,
        "text": "Hyperphenylalaninemia"
      },
      {
        "id": 2,
        "text": "Hypotyrosinemia"
      },
      {
        "id": 3,
        "text": "Phenyl-pyruvate"
      },
      {
        "id": 4,
        "text": "Phenyl-acetate"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The clinical vignette describes a case of<strong> phenylketonuria. CNS damage</strong> in patients with phenylketonuria (PKU) <strong>is caused by hyperphenylalaninemia</strong> in brain tissue.</p>\n<p>High blood levels of phenylalanine<strong> saturate the transport system</strong> across the blood-brain barrier causing inhibition of the cerebral uptake of other large neutral amino acids such as tyrosine and tryptophan <strong>impairing</strong> brain protein synthesis.&nbsp;</p>\n<p>Microcephaly, prominent maxillae with widely spaced teeth, enamel hypoplasia, and growth retardation are other common findings in untreated children. Low bone mineral density and osteopenia have been reported in affected individuals of all ages.</p>\n<p>Excess phenylalanine is metabolized to<strong> phenyl ketones (phenylpyruvate and phenylacetate)</strong> that are excreted in the urine. However, these metabolites have <strong>no role</strong> in the pathogenesis of <strong>CNS damage</strong>; their presence in body fluids simply signifies the severity of the condition.</p>\n<p>Hypotyrosinemia can be partially responsible for the signs and symptoms but the primary cause is hyperphenylalaninemia.</p>\n<p>Laboratory diagnoses of phenylketonuria include:</p>\n<ul>\n<li>Guthrie's test: growth of bacillus subtilis is seen</li>\n<li>Ferric chloride urine test: transient blue-green color&nbsp;</li>\n<li>Blood phenylalanine levels: elevated</li>\n<li>Enzyme studies</li>\n<li>Genetic mutation studies</li>\n<li>Tandem mass spectrometry: Gold standard screening method for all metabolic disorders.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An infant with severe vomiting who was misdiagnosed as a case of hypertrophic pyloric stenosis is being screened for metabolic disorders. Screening reveals hyperphenylalaninemia. On ordering an enzyme study, you would include all of the following enzymes except:",
    "choices": [
      {
        "id": 1,
        "text": "Phenylalanine hydroxylase (PAH)"
      },
      {
        "id": 2,
        "text": "Dihydropteridine reductase"
      },
      {
        "id": 3,
        "text": "Dihydropteroate synthase"
      },
      {
        "id": 4,
        "text": "GTP cyclohydrolase"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Defects</strong> of either <strong>phenylalanine hydroxylase</strong> (PAH) or <strong>tetrahydrobiopterin(BH4)</strong> can cause hyperphenylalaninemias.</p>\n<p>PAH deficiency is diagnosed as <strong>phenylketonuria.</strong></p>\n<p>Malignant hyperphenylalaninemias include three enzyme defects, dihydropteridine reductase,pyruvoyl tetrahydropterin synthase, and GTP cyclohydrolase which help in BH4 synthesis. The deficiency of BH4 impairs three hydroxylase(phenylalanine, tyrosine, and tryptophan), and severe neurological symptoms develop because of the lack of neurotransmitters.</p>\n<p><strong>Dihydropteroate synthase</strong> is present only in <strong>bacteria</strong> and this makes it a useful target for<strong> sulfonamide antibiotics</strong>, which compete with the PABA precursor.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "As a physician treating a 2-month-old baby with phenylketonuria what will be your mainstay of treatment?",
    "choices": [
      {
        "id": 1,
        "text": "Phenylalanine\u2013free diet"
      },
      {
        "id": 2,
        "text": "Low phenylalanine diet"
      },
      {
        "id": 3,
        "text": "High phenylalanine diet"
      },
      {
        "id": 4,
        "text": "Tyrosine supplementation"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>A low-phenylalanine diet</strong> is the mainstay of treatment of PKU.</p>\n<p>The goal of therapy is to reduce phenylalanine levels in the plasma and brain. Because phenylalanine is not synthesized endogenously, <strong>small amounts of phenylalanine should be added</strong> to the diet to prevent phenylalanine deficiency. Dietary deficiency of this amino acid is manifested by lethargy, failure to thrive, anorexia, anemia, rashes, diarrhea, and even death; moreover, tyrosine becomes an essential amino acid in this disorder and its adequate intake must be ensured.</p>\n<p><strong>Sapropterin dihydrochloride</strong> , a synthetic form of <strong>BH4</strong>, which acts as a cofactor in patients with residual PAH activity, is approved by the U.S. Food and Drug Administration (FDA) to reduce phenylalanine levels in PKU.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An infant born out of a second-degree consanguineous marriage presents with jaundice, irritability, and vomiting. His mother gives a history of fever for the past 4 days. On examination, petechiae are present, he has hepatomegaly and extensor hypertonia of the neck and trunk. Labs reveal elevated serum transaminases, hypophosphatemia, and elevated levels of succinylacetone in serum and urine. Which of the following enzymes is deficient?",
    "choices": [
      {
        "id": 1,
        "text": "Tyrosine hydroxylase"
      },
      {
        "id": 2,
        "text": "Tyrosine aminotransferase"
      },
      {
        "id": 3,
        "text": "4-HPPD"
      },
      {
        "id": 4,
        "text": "Fumarylacetoacetate hydrolase"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The clinical vignette describes a case of<strong> Hereditary tyrosinemia type 1</strong> is caused by the\u00a0deficiency of <strong>fumarylacetoacetate hydrolase</strong> (FAAH).</p>\n<p>Elevated levels of <strong>succinylacetone</strong> in serum and urine are diagnostic for tyrosinemia type I.</p>\n<p><strong>Liver</strong>(jaundice, acute hepatic crisis, elevated serum transaminases), <strong>kidney</strong>(hypophosphatemia), and <strong>nerve damage</strong>(extensor hypertonia of neck and trunk) are caused by metabolites of tyrosine degradation, especially fumarylacetoacetate and succinylacetone, and is usually precipitated by minor infections.</p>\n<p>A diet low in phenylalanine and tyrosine can slow but does not halt the progression of the condition. The treatment of choice is<strong> nitisinone (NTBC)</strong>, which inhibits 4-HPPD and reduces the flux of tyrosine metabolites to FAH, thus decreasing the production of the offending compounds, fumarylacetoacetate, and succinylacetone.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/15442df649224826ba9b3a91b75753a2x1280x2566.JPEG"
    ]
  },
  {
    "text": "A father while changing his child's diaper observes a boiled cabbage odor emanating from it. Curious about the smell, he calls you. As a pediatrician, you investigate the child thoroughly and conclude that the child is suffering from Type 1 Tyrosinemia. As the child grows all of the following complications can occur except:",
    "choices": [
      {
        "id": 1,
        "text": "Hepatocellular carcinoma"
      },
      {
        "id": 2,
        "text": "Paralytic ileus"
      },
      {
        "id": 3,
        "text": "Fanconi-like syndrome"
      },
      {
        "id": 4,
        "text": "Corneal ulceration"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Corneal ulceration i</strong>s not a feature of hereditary tyrosinemia type 1. In fact, ocular manifestations are a feature of<strong> hereditary tyrosinemia type 2 </strong>which presumably occur due to tyrosine deposition.</p>\n<p><strong>Boiled cabbage odor</strong> may be present in tyrosinemia resulting from increased <strong>methionine metabolites</strong> (sulfur-containing compounds).</p>\n<p><strong>Features of hereditary tyrosinemia type 1 (hepatorenal tyrosinemia)</strong>:</p>\n<ul>\n<li>An <strong>acute hepatic crisis</strong>&nbsp;commonly heralds the onset of disease, which may progress to liver failure,<strong> hepatocellular carcinoma</strong>, and death.</li>\n<li>Episodes of <strong>acute peripheral neuropathy resembling porphyrias</strong>&nbsp;often triggered by a minor infection, such crisis can be associated with<strong> paralytic ileus</strong></li>\n<li><strong>Renal involvement,</strong> which is manifested as a <strong>Fanconi-like syndrome</strong> with hyperphosphaturia, hypophosphatemia, normal anion gap metabolic acidosis, and vitamin D&ndash;resistant rickets</li>\n</ul>\n<p><strong>The treatment of choice for HT Type 1 is nitisinone,</strong> which blocks early steps in the tyrosine degradation pathway and limits the formation of toxic tyrosine metabolites.</p>\n<p>Note:</p>\n<p>Boiled cabbage odor can also be found in cases of <strong>Hypermethioninemia.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 2-year-old girl presented with photophobia and speech delay. On examination, she had bilateral herpetiform corneal ulcers and painful hyperkeratotic plaques on the palms and soles. Which among the following is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "HSV type 1"
      },
      {
        "id": 2,
        "text": "HSV type 2"
      },
      {
        "id": 3,
        "text": "Hereditary Tyrosinemia Type 1"
      },
      {
        "id": 4,
        "text": "Hereditary Tyrosinemia Type 2"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Palmar and plantar hyperkeratosis, herpetiform corneal ulcers, and intellectual disability are seen in <strong>hereditary tyrosinemia type 2</strong> <strong>(Richner&ndash;Hanhart syndrome</strong>/ oculocutaneous tyrosinemia)</p>\n<p>Treatment with a diet low in tyrosine and phenylalanine aiming to achieve plasma tyrosine levels &lt;500 &micro;mol/L improves skin and eye manifestations.</p>\n<p>The image below shows herpetiform corneal ulcer:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d3592349a17649a495f7368eaed11e0cx853x788.JPEG"
    ]
  },
  {
    "text": "A child who was being evaluated for hypertyrosinemia is diagnosed with Richner-Hanhart syndrome. Which of the following enzyme deficiencies is the likely cause of hypertyrosinemia in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Tyrosine hydroxylase"
      },
      {
        "id": 2,
        "text": "Tyrosine aminotransferase"
      },
      {
        "id": 3,
        "text": "4-Hydroxyphenylpyruvate dioxygenase (HPPD)"
      },
      {
        "id": 4,
        "text": "Fumarylacetoacetate hydrolase"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Oculocutaneous tyrosinemia/Richner-Hanhart syndrome</strong> (type II) is caused by the deficiency of<strong> tyrosine aminotransferase</strong>.</p>\n<div class=\"page\" title=\"Page 3146\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>It is a rare autosomal recessive disorder characterized by palmar and plantar hyperkeratosis, herpetiform corneal ulcers, and intellectual disability.Untreated patients have marked&nbsp;<strong>hypertyrosinemia. </strong>In contrast to tyrosinemia type I, liver and kidney function are normal, as are serum concentrations of other amino acids and succinylacetone.</p>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/693a33ca3b6a4737b4fa7e69784ef75bx1280x2566.JPEG"
    ]
  },
  {
    "text": "A 15-month-old baby who presented with seizures and self-injurious behavior has increased plasma tyrosine levels. Urine metabolic screening reveals the presence of 4-hydroxyphenylpyruvic acid and its metabolites 4-hydroxyphenyllactic and 4-hydroxyphenyl acetic acids. Which of the following in-born errors of metabolism is the child suffering from?",
    "choices": [
      {
        "id": 1,
        "text": "Hereditary tyrosinemia type 1"
      },
      {
        "id": 2,
        "text": "Hereditary tyrosinemia type 2"
      },
      {
        "id": 3,
        "text": "Hereditary tyrosinemia type 3"
      },
      {
        "id": 4,
        "text": "Hawkinsinuria"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Primary deficiency of <strong>4-hydroxyphenylpyruvate dioxygenase (4-HPPD)</strong> causes <strong>hereditary tyrosinemia type 3.&nbsp;</strong>The diagnosis is suspected in children with sustained moderate<strong> increases in plasma levels of tyrosine (</strong>typically 350-700 &micro;mol/L on a normal diet) and the presence of <strong>4-hydroxyphenylpyruvic acid and its metabolites</strong> 4-hydroxyphenyllactic and 4-hydroxyphenylacetic acids <strong>in urine.</strong></p>\n<p>Asymptomatic infants with 4-HPPD deficiency have been identified by neonatal screening for hypertyrosinemia.&nbsp;In symptomatic patients, developmental delay, seizures, intermittent ataxia, and self-injurious behavior have been reported. Liver and renal abnormalities are absent.</p>\n<p>Note:</p>\n<p><strong>Transient tyrosinemia of the newborn</strong> is the most common acquired cause for increased plasma tyrosine levels. Seen in <strong>premature infants</strong> receiving a<strong> high protein diet</strong> and&nbsp;<strong>due to the immaturity of&nbsp;4-HPPD enzyme.&nbsp;</strong>Mostly <strong>asymptomatic</strong>, but sometimes manifested by lethargy, poor feeding, and decreased motor activity. Hypertyrosinemia usually <strong>resolves</strong><br /><strong>spontaneously</strong> in the<strong> first 2 months of life.&nbsp;</strong>Treatment includes a low protein diet and vitamin C.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ba209c653194433b8b58f9631be18047x1280x2566.JPEG"
    ]
  },
  {
    "text": "A 4-month-old infant who was started on a high-protein diet after weaning from breastfeeding developed severe metabolic acidosis, ketosis, failure to thrive, mild hepatomegaly, and an unusual swimming pool odor. A history of similar illness was noticed in his siblings and his father. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Maple syrup urine disease"
      },
      {
        "id": 2,
        "text": "Isovaleric acidemia"
      },
      {
        "id": 3,
        "text": "Hawkinsinuria"
      },
      {
        "id": 4,
        "text": "Phenylketonuria"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The clinical vignette and the characteristic<strong>&nbsp;swimming pool odor</strong>&nbsp;describe&nbsp;<strong>Hawkinsinuria</strong>.</p>\n<p><strong>Hawkinsinuria&nbsp;</strong><strong>is an autosomal-dominant</strong>&nbsp;condition&nbsp;caused by <strong>mutations in the gene for 4-HPPD</strong>.</p>\n<p>In infants, this disease&nbsp;causes severe metabolic acidosis, ketosis, failure to thrive, mild hepatomegaly, and swimming pool odor. Mental development is usually normal. Affected individuals excrete <strong>hawkinsin</strong> (4-hydroxyphenylpyruvic acid), and its metabolites.</p>\n<p><strong>Treatment </strong>consists of a <strong>low-protein diet during infancy</strong>. Breastfeeding is encouraged. A trial with large doses of vitamin C (up to 1,000 mg/24 hour) is also recommended.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The following findings in an 18-year-old are characterized by a deficiency of _________",
    "choices": [
      {
        "id": 1,
        "text": "Beta-carotene"
      },
      {
        "id": 2,
        "text": "Tyrosine aminotransferase"
      },
      {
        "id": 3,
        "text": "L-ascorbic acid"
      },
      {
        "id": 4,
        "text": "Homogentisic acid oxidase"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The following condition is characterized by the&nbsp;<strong>deficiency of homogentisic acid oxidase.</strong></p>\n<p>The image represents <strong>ochronosis:</strong>&nbsp;Bluish-black pigmentation of the ear cartilage and/or sclera due to deposits of accumulated homogentisic acid.</p>\n<p>This is characteristically seen in<strong>&nbsp;alkaptonuria.&nbsp;</strong>It is a rare autosomal-recessive disorder is caused by the&nbsp;<strong>deficiency of homogentisic acid oxidase.&nbsp;</strong>Large amounts of homogentisic acid are formed, which are excreted in urine or deposited in tissues. Clinical manifestations of alkaptonuria consist of <strong>ochronosis and arthritis in adulthood</strong>. Arthritis predominantly involves the&nbsp;spine, hip, and knee. Radiologically, it is characterized by <strong>intervertebral calcifications.&nbsp;</strong>In <strong>children, blackening of the urine on standing</strong>&nbsp;is observed; it is caused by the oxidation and polymerization of homogentisic acid.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d3628da1061f46b1ac88b36975e7a73f.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A patient presented to the OPD with complaints of pigmentation of the face and severe backache and stiffness. The X-Ray image of the spine is as shown. Her urine color changes to brownish-black on standing. Which of the following drugs can be used in her treatment?",
    "choices": [
      {
        "id": 1,
        "text": "Nitisinone"
      },
      {
        "id": 2,
        "text": "Thiamine"
      },
      {
        "id": 3,
        "text": "Folic acid"
      },
      {
        "id": 4,
        "text": "Pyridoxine"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The clinical image shows the accumulation of<strong>&nbsp;alkapton bodies in connective tissues&nbsp;</strong>on the face and <strong>urine turning brownish-black </strong>on standing are associated with<strong>&nbsp;alkaptonuria.&nbsp;</strong><strong>X-ray&nbsp;</strong>shows<strong>&nbsp;calcification of intervertebral discs</strong>&nbsp;called&nbsp;<strong>ochronotic spondyloarthropathy</strong>&nbsp;also seen in&nbsp;<strong>alkaptonuria. Nitisinone can be used in the treatment of alkaptonuria.&nbsp;</strong></p>\n<p><strong>Nitisinone,</strong> formerly known as NTBC, inhibits 4-hydroxyphenylpyruvate dioxygenase (HPPD) (early step in the tyrosine degradation pathway) and&nbsp;efficiently reduces homogentisic acid production in alkaptonuria. Treatment of arthritis is symptomatic. In presymptomatic individuals, treatment using a combination of nitisinone with phenylalanine and a tyrosine restricted diet can be tried.</p>\n<p>The patient&rsquo;s urine contains elevated levels of homogentisic acid, which is oxidized to a dark pigment on standing as shown below in the image:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a1a699fb62c84247ac6fca75c713bfaf.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/82bdc630e0a746fca5aea7b05dd9eedex425x394.PNG"
    ]
  },
  {
    "text": "A 10-year-old boy presented with right-sided weakness and deviation of angle of mouth to the left is diagnosed to have a metabolic disorder. Diffusion-weighted MRI reveals diffusion restriction along the left middle cerebral artery. Which of the following defects can be responsible for the boy's condition?",
    "choices": [
      {
        "id": 1,
        "text": "2,5"
      },
      {
        "id": 2,
        "text": "1,3,5"
      },
      {
        "id": 3,
        "text": "1,2,3"
      },
      {
        "id": 4,
        "text": "1,2,3,4"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Metabolic disorders which can cause stroke include:</p>\n<ul>\n<li><strong>Homocystinuria</strong></li>\n<li>MELAS (metabolic encephalopathy, lactic acidosis, and stroke-like episodes)</li>\n<li>Leigh syndrome</li>\n<li>Fabry's disease</li>\n<li>Propionic acidemia</li>\n<li>Glutaric aciduria</li>\n</ul>\n<p>&nbsp;Vitamin C deficiency increases the risk of hemorrhagic stroke.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7489347dbfa1440f9032a8fafda3a616x1280x1922.2582921665492.JPEG"
    ]
  },
  {
    "text": "An 8-month-old boy presented with lethargy, failure to thrive, and developmental delay. On investigation, he had elevated levels of homocysteine in blood and homocystinuria. As the child grows, which of the following features is least likely to develop?",
    "choices": [
      {
        "id": 1,
        "text": "Ectopia lentis"
      },
      {
        "id": 2,
        "text": "Intellectual disability"
      },
      {
        "id": 3,
        "text": "Short stature"
      },
      {
        "id": 4,
        "text": "Myocardial infarction"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The above findings support a diagnosis of <strong>homocystinuria.</strong> <strong>Short stature</strong> is <strong>not</strong> a manifestation of homocystinuria.</p>\n<p>Manifestations of homocystinuria:</p>\n<ul>\n<li><strong>Ectopia lentis</strong> - downward and inward subluxation (<strong>inferonasal).</strong></li>\n<li><strong>Intellectual disability</strong> and <strong>psychiatric and behavioral</strong> disorders</li>\n<li>Thromboembolic episodes like stroke and<strong> MI</strong></li>\n<li>Skeletal abnormalities resembling those of Marfan syndrome: <strong>They are tall and thin, (NOT short)</strong> with elongated limbs and arachnodactyly.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 16-year-old boy with frequent episodes of photosensitive dermatitis, diarrhea, and depression is diagnosed to have a metabolic disorder. Metabolism of which of the following amino acids is affected?",
    "choices": [
      {
        "id": 1,
        "text": "Tyrosine"
      },
      {
        "id": 2,
        "text": "Tryptophan"
      },
      {
        "id": 3,
        "text": "Threonine"
      },
      {
        "id": 4,
        "text": "Phenylalanine"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Pellagra-like symptoms</strong>- photosensitive dermatitis, diarrhea, and episodic depression are seen in the <strong>deficiency of tryptophan.</strong></p>\n<p><strong>Niacin</strong> is not strictly a vitamin, since it can be <strong>synthesized</strong> in the body <strong>from</strong> the essential amino acid <strong>tryptophan;</strong>&nbsp;deficiency of&nbsp;tryptophan causes <strong>pellagra</strong>-like symptoms.</p>\n<p>Treatment with n<strong>icotinic acid or nicotinamide (50-300 mg/24 hr)</strong> and a <strong>high protein diet</strong> results in a favorable response in symptomatic patients with <strong>Hartnup disease.</strong></p>\n<p>The image below shows&nbsp;<strong>Casal's necklace,</strong>&nbsp;a lesion seen around the neck&nbsp;which is caused due to the deficiency of niacin or nicotinic acid.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a1d3c85dff1a4d959927c5fcf7c9944dx1280x1266.JPEG"
    ]
  },
  {
    "text": "Which of the following is false regarding Hartnup disease?",
    "choices": [
      {
        "id": 1,
        "text": "Defect in the transport of monoamino-monocarboxylic amino acids, including tryptophan, is seen"
      },
      {
        "id": 2,
        "text": "Defect in the B0AT1 protein occurs in the intestine and renal tubules"
      },
      {
        "id": 3,
        "text": "Pellagra-like rash may develop in symptomatic patients"
      },
      {
        "id": 4,
        "text": "Treatment is with supplementation of tryptophan"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The treatment of Hartnup disease is not with the supplementation of tryptophan.</p>\n<p><strong>Hartnup disease</strong></p>\n<ul>\n<li>It is caused by a\u00a0<strong>defect in the transport of monoamino-monocarboxylic (neutral) amino acids,</strong> including <strong>tryptophan</strong>, by the intestinal mucosa and renal tubules.</li>\n<li>There is a\u00a0defect in\u00a0\u00a0<strong>B0AT1 protein</strong> in the intestine/ renal tubules or both, which is caused\u00a0by a mutation in <em><strong>SLC6A19.</strong></em></li>\n<li>Tryptophan is an essential amino acid and a precursor for nicotinic acid (niacin) and serotonin. Decreased intestinal absorption of tryptophan in conjunction with its increased renal loss causes reduced availability of tryptophan for niacin synthesis in affected individuals.</li>\n<li><strong>A pellagra-like rash</strong> may develop in symptomatic patients, and some patients may have intermittent ataxia.</li>\n<li><strong>Diagnosis</strong>\u00a0is based on aminoaciduria and increased excretion of indole compounds detected by\u00a0<strong>Obermeyer test</strong>.</li>\n<li><strong>Treatment is with nicotinic acid or nicotinamide</strong> and a high-protein diet.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An infant with poor feeding is suspected to have an inborn error of metabolism. Further evaluation reveals hyperammonemia +, acidosis +, ketosis +. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Tyrosinemia"
      },
      {
        "id": 2,
        "text": "Galactosemia"
      },
      {
        "id": 3,
        "text": "Phenylketonuria"
      },
      {
        "id": 4,
        "text": "Organic aciduria"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>In this case, <strong>hyperammonemia +, acidosis +, ketosis +.\u00a0</strong>This is seen in <strong>organic aciduria</strong>.\u00a0</p>\n<p><strong>Organic acidemias</strong> most commonly present in infancy with poor feeding, vomiting, hypotonia, high anion gap metabolic acidosis, hepatomegaly, seizures. Organic acid accumulation <strong>inhibits gluconeogenesis</strong> and <strong>inhibits the urea cycle</strong> leading to hyperammonemia.</p>\n<p>Common organic acidurias:</p>\n<ul>\n<li>Methylmalonic aciduria</li>\n<li>Propionic aciduria</li>\n<li>Isovaleric aciduria</li>\n<li>Maple syrup urine disease</li>\n<li>Glutaric aciduria type I</li>\n<li>Multiple carboxylase deficiency</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5c94e0de48234302b7988871f127ec04x1280x2560.0.JPEG"
    ]
  },
  {
    "text": "A 10-day-old male infant presented with poor feeding, and recurrent generalized convulsions. On examination, the pediatrician notices repetitive movements of the extremities \u2013appears to be boxing and bicycling and a peculiar burnt sugar odor was present in urine. What is the deficient enzyme in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Branched-chain \u03b1-ketoacid dehydrogenase"
      },
      {
        "id": 2,
        "text": "Isovaleryl CoA dehydrogenase"
      },
      {
        "id": 3,
        "text": "Pyruvate carboxylase"
      },
      {
        "id": 4,
        "text": "Acetyl CoA carboxylase"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The diagnosis is maple syrup urine disease (<strong>MSUD</strong>) which is due to deficiency of<strong>&nbsp;branched-chain &alpha;-ketoacid dehydrogenase (BCKDH)</strong>.</p>\n<p>Leucine, isoleucine, and valine are the 3 essential amino acids, which are branched-chain amino acids.&nbsp;Their decarboxylation is accomplished by BCKDH using <strong>thiamine</strong> (vitamin B1) pyrophosphate as a <strong>coenzyme</strong>.</p>\n<p><strong>Leucine</strong> is metabolized by BCAA aminotransferase to<strong> &alpha;-ketoisocaproic acid</strong>, which leads to the disrupted metabolism of neurotransmitters and amino acids (glutamate, GABA, glutamine, alanine, and aspartate). &alpha;-Ketoisocaproic acid can reversibly inhibit oxidative phosphorylation and result in cerebral lactic acidosis. Collectively, these processes are detrimental to the normal function of neurons and glia, clinically manifesting as encephalopathy and brain edema and referred to as<strong> leucinosis</strong>.</p>\n<p>Treatment options include hemodialysis, restricting dietary substances, thiamine for milder forms, and orthotopic liver transplant.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "While doing your morning rounds in the pediatrics department, you notice a  peculiar rancid cheese odor emanating from a six-month-old girl who was admitted for respiratory distress. Second-degree consanguinity was documented between the parents. Urine organic acid analysis by gas chromatography-mass spectrometry showed marked excretion of 3-hydroxybutyric acid along with moderate excretion of 3- hydroxy-isovaleric acid. What is the most likely condition is she suffering from?",
    "choices": [
      {
        "id": 1,
        "text": "Tyrosinemia"
      },
      {
        "id": 2,
        "text": "Multiple carboxylase deficiency"
      },
      {
        "id": 3,
        "text": "Trimethylaminuria"
      },
      {
        "id": 4,
        "text": "Isovaleric acidemia"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The clinical vignette suggests a diagnosis of <strong>isovaleric acidemia. Sweaty-feet</strong> odor or <strong>rancid cheese odor</strong> may be present.</p>\n<p>Isovaleric acidemia is caused by the&nbsp;<strong>deficiency</strong> of the <strong>enzyme isovaleryl CoA dehydrogenase</strong>, which affects&nbsp;the breakdown pathway of&nbsp;<strong>l</strong><strong>eucine </strong>leading to the accumulation of intermediates.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A mother brings her  3-year-old boy with the complaints that her child's urine smells like her tomcat's urine. She also gives a history of generalized seizures and perioral desquamating lesions. On examination, the child has global developmental delay and diffuse thinning of the scalp. Investigations reveal multiple carboxylase deficiency. What is the treatment of choice?",
    "choices": [
      {
        "id": 1,
        "text": "Thiamine"
      },
      {
        "id": 2,
        "text": "Pyridoxine"
      },
      {
        "id": 3,
        "text": "Biotin"
      },
      {
        "id": 4,
        "text": "Methylcobalamin"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Biotin</strong> is the treatment of choice for <strong>multiple carboxylase deficiency.</strong></p>\n<p>Multiple carboxylase deficiency refers to one of two inherited <strong>defects of biotin metabolism. Tomcat urine</strong> is characteristically seen in multiple carboxylase deficiency.</p>\n<ul>\n<li style=\"font-weight: 400;\"><strong>Neonatal/infantile</strong> form is caused by a deficiency of holocarboxylase synthetase and presents in the first week of life with lethargy, poor muscle tone, and vomiting.</li>\n<li style=\"font-weight: 400;\"><strong>Juvenile/late</strong> form is caused by <strong>biotinidase deficiency</strong> and is associated with a slow but progressive loss of biotin in the urine, leading to organic aciduria. It is characterized by <strong>alopecia</strong>, ataxia, ketoacidosis, <strong>dermatitis, seizures</strong>, myoclonus, and nystagmus.</li>\n</ul>\n<p>Both infantile and late-onset multiple carboxylase deficiency can be treated with pharmacological doses of biotin.</p>\n<p>It is called multiple carboxylase deficiency because biotin is a water-soluble vitamin that is a <strong>cofactor for all 4 carboxylase enzymes</strong> in humans:</p>\n<ul>\n<li>Pyruvate carboxylase</li>\n<li>Acetyl CoA carboxylase</li>\n<li>Propionyl CoA carboxylase</li>\n<li>3-methylcrotonyl CoA carboxylase</li>\n</ul>\n<p>Note:&nbsp;</p>\n<p><strong>Acquired deficiency of biotin</strong> may occur in infants receiving <strong>total parenteral nutrition without added biotin</strong>, in patients with <strong>prolonged use of antiepileptic drugs (phenobarbital, phenytoin, primidone, carbamazepine</strong>), and in children with short bowel syndrome or chronic diarrhea who are receiving formulas low in biotin.<strong> Excessive ingestion of raw eggs</strong> may also cause biotin deficiency because the protein avidin in egg white binds biotin, decreasing its absorption. Infants with a biotin deficiency may develop dermatitis, alopecia, and candidal skin infections. This condition readily responds to treatment with oral biotin.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is the most common acquired cause of increased plasma tyrosine levels?",
    "choices": [
      {
        "id": 1,
        "text": "Hepatorenal tyrosinemia"
      },
      {
        "id": 2,
        "text": "Oculocutaneous tyrosinemia"
      },
      {
        "id": 3,
        "text": "Alkaptonuria"
      },
      {
        "id": 4,
        "text": "Transient tyrosinemia of the newborn"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Transient tyrosinemia of the newborn is the most common acquired cause for increased plasma tyrosine levels. Seen in premature infants receiving a high protein diet and&nbsp;<strong>due to the immaturity of&nbsp;4-HPPD enzyme.&nbsp;</strong>Mostly asymptomatic, but sometimes manifested by lethargy, poor feeding, and decreased motor activity. Treatment includes low protein diet and vitamin C.</p>\n<p>Options A and B, i.e., hepatorenal tyrosinemia and oculocutaneous&nbsp;tyrosinemia, are&nbsp;hereditary causes of increased tyrosine levels.</p>\n<p>Option C: Tyrosine levels are normal in alkaptonuria.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Richner-Hanhart syndrome is  _____.",
    "choices": [
      {
        "id": 1,
        "text": "Hereditary tyrosinemia type 1"
      },
      {
        "id": 2,
        "text": "Hereditary tyrosinemia type 2"
      },
      {
        "id": 3,
        "text": "Hereditary tyrosinemia type 3"
      },
      {
        "id": 4,
        "text": "Hawkinsinuria"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Richner&ndash;Hanhart syndrome is hereditary tyrosinemia type 2 (oculocutaneous tyrosinemia).</strong>&nbsp;</p>\n<ul>\n<li>It is a rare autosomal-recessive disorder is caused by the&nbsp;deficiency of <strong>tyrosine aminotransferase</strong>.</li>\n<li>It is characterized by ocular manifestations, skin lesions, and mild to moderate intellectual disability in ~50% of the patients.</li>\n<li>It is diagnosed by an assay of plasma tyrosine concentration.</li>\n<li><strong>Treatment </strong>includes a diet low in tyrosine and phenylalanine.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In phenylketonuria, which of the following phenyl ketones is excreted in urine?",
    "choices": [
      {
        "id": 1,
        "text": "Phenylalanine"
      },
      {
        "id": 2,
        "text": "Phenylpyruvate"
      },
      {
        "id": 3,
        "text": "Acetoacetate"
      },
      {
        "id": 4,
        "text": "Both b and c"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In phenylketonuria, <strong>phenylpyruvate</strong> is excreted in the urine.</p>\n<p>In phenylketonuria (PKU), excess phenylalanine in the blood is metabolized to phenyl <strong>ketones,</strong> namely,&nbsp;<strong>phenylpyruvate</strong> and <strong>phenylacetate</strong>, which are excreted in the urine, giving rise to the term <strong>phenylketonuria</strong> (PKU).</p>\n<p>Acetoacetate and beta-hydroxybutyrate are keto-acids but are not phenyl ketones. These are not excreted in phenylketonuria.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 2-month-old infant presented with abdominal distention and increased irritability for 10 days. Physical examination showed jaundice, hepatomegaly, and a boiled cabbage odor. Which among the following is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Tyrosinemia"
      },
      {
        "id": 2,
        "text": "Isovaleric acidemia"
      },
      {
        "id": 3,
        "text": "Hawkinsinuria"
      },
      {
        "id": 4,
        "text": "Phenylketonuria"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The clinical vignette is in favor of<strong> tyrosinemia</strong>. <strong>Boiled cabbage odor</strong> may be present in tyrosinemia resulting from increased <strong>methionine metabolites</strong> (sulfur-containing compounds).</p>\n<p>Note:</p>\n<p>Boiled cabbage odor can also be found in cases of <strong>Hypermethioninemia.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A neonate born out of a second-degree consanguineous marriage is suspected to have an inborn error of metabolism. He can present with all of the following except:",
    "choices": [
      {
        "id": 1,
        "text": "Irritability and incessant crying"
      },
      {
        "id": 2,
        "text": "Poor feeding"
      },
      {
        "id": 3,
        "text": "Vomiting"
      },
      {
        "id": 4,
        "text": "Convulsions"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Irritability and incessant crying</strong> are not classical features of inborn errors of metabolism (IEM).</p>\n<p>Clinical clues suggesting IEM in a <strong>neonate</strong> are:</p>\n<ul>\n<li><strong>Unexpected deterioration</strong> after a normal initial period.</li>\n<li>Nonspecific, unexplained features such as poor feeding, lethargy, vomiting, hypotonia, failure to thrive, respiratory abnormalities, apnea, bradycardia, and hypothermia.&nbsp;</li>\n<li><strong>Family history</strong> of similar illnesses, unexplained sibling deaths, or progressive neurological disease.</li>\n<li><strong>Parental consanguinity:</strong> Most acutely presenting metabolic disorders are autosomal recessive.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A worried mother brings her 2-year-old child with the complaints that he hasn't begun walking or talking. On examination, there is microcephaly, fair hair, light-colored skin, and blue eyes. What is the most probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Oculocutaneous albinism"
      },
      {
        "id": 2,
        "text": "Phenylketonuria"
      },
      {
        "id": 3,
        "text": "Alkaptonuria"
      },
      {
        "id": 4,
        "text": "Tyrosinemia"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical manifestations point to the diagnosis of&nbsp;<strong>Phenylketonuria&nbsp;</strong>(PKU).</p>\n<p>Characteristic clinical findings in Phenylketonuria:</p>\n<ul>\n<li>Mental retardation</li>\n<li><strong>Failure to walk or talk</strong></li>\n<li>Seizures</li>\n<li>Hyperactivity</li>\n<li>Tremor</li>\n<li><strong>Microcephaly</strong></li>\n<li>Failure to grow</li>\n<li><strong>Deficiency of pigmentation (fair hair, light skin color, and blue eyes)</strong></li>\n</ul>\n<p><strong>Oculocutaneous albinism</strong>&nbsp;(OCA) is a group of inherited disorders characterized by a reduction or complete lack of melanin pigment in the skin, hair, and eyes.</p>\n<p>Its symptoms are <strong>albinism with vision problems, </strong>which include:</p>\n<div class=\"RqBzHd\">\n<ul class=\"i8Z77e\">\n<li class=\"TrT0Xe\">Strabismus</li>\n<li class=\"TrT0Xe\">Photophobia</li>\n<li class=\"TrT0Xe\">Nystagmus</li>\n<li class=\"TrT0Xe\">Impaired vision or blindness</li>\n<li class=\"TrT0Xe\">Astigmatism</li>\n</ul>\n<p>Neuropsychiatric manifestations are not seen.</p>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '14 Metabolic Disorders Of Amino Acids';
        let hierarchy = ["Marrow", "qBank", "Pediatrics"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>