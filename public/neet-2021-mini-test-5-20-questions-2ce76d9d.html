<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neet 2021 Mini Test 5  (20 Questions) - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2020-21
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following drugs acts by causing irreversible inhibition of the initiation complex through binding of the 30S ribosomal subunit?",
    "choices": [
      {
        "id": 1,
        "text": "Chloramphenicol"
      },
      {
        "id": 2,
        "text": "Clindamycin"
      },
      {
        "id": 3,
        "text": "Gentamicin"
      },
      {
        "id": 4,
        "text": "Vancomycin"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Aminoglycosides</strong>&nbsp;like <strong>gentamicin&nbsp;</strong>act by causing irreversible inhibition of the initiation complex through binding of the <strong>30S ribosomal subunit</strong>. They cause <strong>misreading</strong> and <strong>premature termination</strong> of <strong>mRNA translation.&nbsp;</strong></p>\n<p>Aminoglycosides include streptomycin, gentamicin, tobramycin, amikacin, and kanamycin. They are <strong>bactericidal</strong> and the killing is <strong>concentration-dependent.</strong></p>\n<p>They are used in the treatment of <strong>aerobic gram-negative bacterial</strong> infections such as urinary tract infections, mycobacterial infections, tularemia, respiratory infections in cystic fibrosis, and other pseudomonal infections. Anaerobic bacteria are intrinsically resistant to aminoglycosides because the&nbsp;<strong>transport </strong>of aminoglycosides&nbsp;across the cytoplasmic membrane<strong> requires oxygen</strong>. &nbsp;</p>\n<p>The adverse effects of aminoglycosides include-</p>\n<ul>\n<li><strong>Ototoxicity</strong>&nbsp;is characterized by irreversible <strong>high-frequency hearing loss</strong> and <strong>vestibular dysfunction. Streptomycin</strong> and <strong>gentamicin</strong> are the most <strong>vestibulotoxic.</strong> Amikacin, kanamycin, and neomycin mainly affect auditory functions.&nbsp;</li>\n<li><strong>Nephrotoxicity&nbsp;</strong>due to <strong>damage</strong> to <strong>proximal tubular cells.</strong> Neomycin is the most nephrotoxic. Streptomycin is the least nephrotoxic.</li>\n<li><strong>Acute neuromuscular blockade</strong> and apnea. Neuromuscular blockade may be <strong>reversed</strong> by <strong>intravenous</strong> administration of a <strong>Ca2+</strong> salt.&nbsp;</li>\n</ul>\n<div class=\"page\" title=\"Page 1046\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Other options</p>\n</div>\n</div>\n</div>\n</div>\n<p>Options A and B- <strong>Chloramphenicol</strong> and <strong>clindamycin</strong> act by binding to the <strong>50S</strong> subunit of the ribosome.</p>\n<p>Option D-&nbsp;<strong>Vancomycin</strong>&nbsp;is a glycopeptide that inhibits cell wall synthesis. It binds to terminal dipeptide D-Ala-D-Ala of peptidoglycan to inhibit cell wall synthesis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following measures will you take for effective control of Hepatitis A disease outbreak?",
    "choices": [
      {
        "id": 1,
        "text": "1 only"
      },
      {
        "id": 2,
        "text": "1,2,4"
      },
      {
        "id": 3,
        "text": "1,3,4"
      },
      {
        "id": 4,
        "text": "1,2,3,4"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given scenario of Hepatitis A outbreak is a type of common source multiple exposure epidemic. It can be controlled by identification of the source(water body/supply/restaurant), confirm contamination, suggest disinfection of water with adequate chlorination, and usage of boiled water for consumption in the meanwhile.\u00a0</p>\n<p>\u00a0</p>\n<p><strong>Hepatitis A</strong></p>\n<p><strong>Modes of transmission</strong></p>\n<ul>\n<li>Fecal-oral route: This is the major route of transmission. It can occur directly (handshake after toilet) or indirectly via contaminated food, water, or milk.</li>\n<li>Parenteral route: This is very rare and occurs during the viral dissemination phase. It occurs during the prodromal phase and not when patients are symptomatic and admitted to the hospital. As a result, healthcare workers are not at increased risk.</li>\n<li>Sexual transmission may occur in individuals practicing oro-anal methods (usually homosexual men). It however would not cause an outbreak.</li>\n</ul>\n<p><strong>Incubation period:</strong></p>\n<ul>\n<li>10 to 50 days (usually 14-28 days). Isolation is not an effective measure to control outbreaks as the shedding of the virus is maximum during the early stages of illness when clinical illness may not have started and many patients are asymptomatic yet continue to shed the virus.</li>\n</ul>\n<p><strong>Clinical spectrum:</strong></p>\n<ul>\n<li>The onset of jaundice is preceded by gastrointestinal symptoms such as nausea, vomiting, anorexia, and mild fever.</li>\n<li>Jaundice may appear within a few days of the prodromal period, but anicteric hepatitis is more common.</li>\n<li>Hepatitis A resolves completely in 98 percent of cases but relapse of symptoms are noted in 3-20 percent of cases</li>\n</ul>\n<p><strong>Diagnosis:</strong></p>\n<ul>\n<li>Laboratory diagnosis of hepatitis A can be obtained by\n<ul>\n<li>Demonstration of HAV particles or specific viral antigens in the feces, bile, and blood.</li>\n<li>Anti-HAV appears in the lgM fraction during the acute phase, peaking about 2 weeks after the elevation of liver enzymes. ELISA is the method of choice for measuring HAV antibodies.</li>\n</ul>\n</li>\n</ul>\n<p><strong>Prevention and containment:</strong></p>\n<ul>\n<li>Control of reservoir: Use of 0.5 percent sodium hypochlorite has been strongly recommended as an effective disinfectant</li>\n<li>Control of transmission: personal and community hygiene. Hand hygiene before food and after the toilet is highly recommended.</li>\n<li>1 mg/L of free residual chlorine can cause the destruction of the virus in 30 minutes at pH values of 8.5 or less. Hence adequate chlorination can be helpful.</li>\n<li>Patients with chronic liver disease are at increased risk for fulminant hepatitis A and should be vaccinated. Use of hepatitis A vaccine should be considered for pre-exposure(for travelers) and post-exposure(close contacts of affected individuals)prophylaxis.</li>\n</ul>\n<p><strong>Vaccines: </strong></p>\n<ul>\n<li>Two types of hepatitis A vaccines are currently used\n<ul>\n<li>Formaldehyde-inactivated vaccines</li>\n<li>Live attenuated vaccines</li>\n</ul>\n</li>\n<li>The complete vaccination schedule consists of 2 dose administration into the deltoid muscle. The interval between the first (primary) dose and second (booster) dose is commonly 6-12 months.</li>\n<li>Following 2 doses of vaccine, the protective efficacy is about 94 percent.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 52-year-old diabetic male patient was found to have a bilateral loss of peripheral visual fields. On tonometry, intraocular pressure was raised. Fundoscopy showed cupping and pallor of the optic disc. Iridocorneal angle was normal on gonioscopy. He is started on a topical drug that reduces the intraocular pressure by increasing the uveoscleral flow. Identify the drug.",
    "choices": [
      {
        "id": 1,
        "text": "Dorzolamide"
      },
      {
        "id": 2,
        "text": "Latanoprost"
      },
      {
        "id": 3,
        "text": "Mannitol"
      },
      {
        "id": 4,
        "text": "Pilocarpine"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The topical drug<strong>&nbsp;</strong>started<strong>&nbsp;</strong>that<strong>&nbsp;</strong>reduces intraocular pressure by increasing the uveoscleral flow<strong>&nbsp;</strong>is<strong>&nbsp;latanoprost, </strong>a<strong> prostaglandin</strong> <strong>analog</strong>.<strong>&nbsp;</strong>It<strong>&nbsp;</strong>is used in the treatment of open-angle glaucoma.&nbsp;</p>\n<p>This patient's findings of peripheral vision loss, increased intraocular pressure (IOP) with optic disc cupping, and a normal iridocorneal angle is suggestive of <strong>open-angle glaucoma.</strong></p>\n<p><strong>Topical prostaglandins</strong> like latanoprost, travoprost, bimatoprost, and tafluprost are now used as <strong>first-line agents</strong> to lower IOP. The major mechanism of action is by&nbsp;enhancing the <strong>uveoscleral outflow </strong>though they also increase <strong>trabecular outflow</strong>.</p>\n<p>The most common ocular side effects are conjunctival hyperemia, eyelash thickening, <strong>iris hyperpigmentation</strong>, and loss of periorbital fat. These drugs are administered <strong>once every day</strong> at <strong>bedtime</strong> and are used with caution in inflamed eyes.</p>\n<p>The systemic side effects are uncommon and include occasional headaches, malaise, myalgia, skin rash, and mild upper respiratory infections. <strong>Latanoprost</strong> is preferred as the first-line due to <strong>fewer</strong> ocular <strong>side effects</strong>.</p>\n<p>Other options:</p>\n<p>Option A: <strong>Dorzolamide</strong> is a <strong>carbonic anhydrase inhibitor</strong>. It reduces IOP by <strong>decreasing aqueous production</strong>.&nbsp;</p>\n<p>Option C: <strong>Mannitol</strong> is an <strong>osmotic agent</strong>, which lowers IOP by creating an osmotic gradient so that water is pulled from the vitreous into the blood vessels. It is used as a <strong>short-term treatment</strong> to reduce IOP in <strong>acute</strong> angle-closure glaucoma or prior to intraocular surgery.</p>\n<p>Option D: <strong>Pilocarpine</strong> is a <strong>miotic</strong> that acts as a <strong>cholinergic agonist</strong>. In <strong>angle-closure glaucoma</strong>, cholinergic agents open the angle by contraction of the sphincter pupillae, pulling the iris away from the trabecula.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 50-year-old female presented with low-grade fever, easy fatiguability, and pain in the right hypochondrium.  A contrast-enhanced CT scan is given below. Which of the following is the most common cause of this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Colorectal carcinoma"
      },
      {
        "id": 2,
        "text": "Thyroid carcinoma"
      },
      {
        "id": 3,
        "text": "Breast carcinoma"
      },
      {
        "id": 4,
        "text": "Lung carcinoma"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The<strong>&nbsp;</strong>given clinical scenario and contrast-enhanced CT showing<strong> non-enhancing</strong> <strong>lesions&nbsp;</strong>in the liver are suggestive of <strong>liver metastasis</strong>.&nbsp;<strong>Colorectal carcinoma</strong> is the most common cause of metastatic lesions in the liver.</p>\n<p>The&nbsp;most common site of distant metastasis&nbsp;of colorectal cancer is the&nbsp;<strong>liver.&nbsp;</strong>These metastases arise from&nbsp;<strong>hematogenous spread</strong> via the<strong> portal venous system</strong>. The lung is the next most common site for metastasis.</p>\n<p><strong>Metastatic malignancy</strong>&nbsp;of the liver is more common than primary hepatic neoplasia. The most common primary sources are the&nbsp;<strong>colon, breast, lung,</strong>&nbsp;and&nbsp;<strong>pancreas.&nbsp;</strong>However, primary malignancy from any organ may spread to the liver.</p>\n<p>On CT, most metastases are low attenuation on unenhanced images and portal phase images. Features of metastatic lesions:</p>\n<ul>\n<li>Multiple</li>\n<li>Variable size</li>\n<li>Growth in serial imaging</li>\n</ul>\n<p>In most cases, multiple nodular metastases may be seen, causing&nbsp;<strong>hepatomegaly.</strong>&nbsp;The liver weight can exceed several kilograms. In some cases, a solitary metastatic nodule may be present, which can be surgically resected. Massive destruction of hepatocytes or direct obstruction of major bile ducts may cause&nbsp;<strong>jaundice.</strong></p>\n<p><strong>Resection</strong> with a negative surgical margin of 1 cm (R0) has always been considered the gold standard but with&nbsp;<strong>chemotherapy,</strong> patients with R1 (microscopically negative) resection have similar survival to those with R0 resections.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/2aaba62fb6d344c38e050e69973c2e6e.jpg"
    ],
    "explanation_images": []
  },
  {
    "text": "Identify the structure marked in red arrow:",
    "choices": [
      {
        "id": 1,
        "text": "Inferior mesenteric artery"
      },
      {
        "id": 2,
        "text": "Superior mesenteric artery"
      },
      {
        "id": 3,
        "text": "Splenic artery"
      },
      {
        "id": 4,
        "text": "Left gonadal artery"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The marked structure can be identified as the<strong> superior mesenteric artery,</strong> as it lies <strong>anterior and superior to the left renal vein.</strong></p>\n<p>The superior mesenteric artery originates from the <strong>abdominal aorta at the level of the L1 vertebra.</strong></p>\n<p>Its branches include:</p>\n<ul>\n<li>Jejunal branches</li>\n<li>Ileal branches</li>\n<li>Middle colic artery</li>\n<li>Right colic artery</li>\n<li>Ileocolic artery</li>\n<li>Inferior pancreaticoduodenal artery</li>\n</ul>\n<p><strong>Clinical note: Nutcracker syndrome:</strong></p>\n<ul>\n<li>The compression of the left renal vein between the abdominal aorta and the superior mesenteric artery, appears in the sagittal plane, as if a nutcracker is crushing a nut (left renal vein).</li>\n<li>This condition is called nutcracker (left renal vein entrapment) syndrome.</li>\n</ul>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/fae087068bec46fcb69a98a5ce636d15.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1576dc7e4b6b4d4cb3bbf606d7c13c2dx800x600.JPEG"
    ]
  },
  {
    "text": "Which of the following drugs used in the treatment of alcohol abuse causes reduced craving by blocking the opioid receptor?",
    "choices": [
      {
        "id": 1,
        "text": "Chlordiazepoxide"
      },
      {
        "id": 2,
        "text": "Acamprosate"
      },
      {
        "id": 3,
        "text": "Naltrexone"
      },
      {
        "id": 4,
        "text": "Disulfiram"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Naltrexone</strong> causes reduced reward response to drinking and reduced craving by blocking the opioid receptor.</p>\n<p><strong>Before prescribing:</strong> Evaluate for possible current opioid use; consider a urine toxicology screen for opioids, including synthetic opioids. Obtain liver function tests and follow up periodically.</p>\n<p>Acamprosate, naltrexone, and disulfiram are used in the<strong> treatment of alcohol dependence.</strong></p>\n<p>Other options:</p>\n<p>Option A:&nbsp;<strong>Chlordiazepoxide</strong> is a benzodiazepine used in the treatment of alcohol withdrawal.</p>\n<p>Option B:&nbsp;<strong>Acamprosate</strong> affects glutamate and GABA neurotransmitter systems, but its alcohol-related action is unclear.</p>\n<p>Option D:<strong>&nbsp;Disulfiram</strong> inhibits the intermediate metabolism of alcohol which causes a build-up of acetaldehyde and a reaction of flushing, sweating, nausea, and tachycardia if a patient drinks alcohol.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 72-year old man presented with complaints of reduced vision in the right eye. Kinetic perimetry revealed right homonymous hemianopia. What is the most likely location of the defect in the optic pathway?",
    "choices": [
      {
        "id": 1,
        "text": "Optic chiasma"
      },
      {
        "id": 2,
        "text": "Optic tract"
      },
      {
        "id": 3,
        "text": "Optic nerve"
      },
      {
        "id": 4,
        "text": "Retina"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The most likely defect in this patient presenting with <strong>right homonymous hemianopia</strong> is in the <strong>left optic tract.&nbsp;</strong><strong>Homonymous hemianopia</strong> involves a loss of vision on the same side of the visual field in both eyes.</p>\n<p>Other options:</p>\n<p>Option A - A lesion affecting the <strong>optic chiasma</strong> produces <strong>heteronymous hemianopia</strong>. It involves loss of vision on the opposite sides of visual fields in both eyes.&nbsp;</p>\n<p>Options C and D - Lesions of the retina and <strong>optic nerve</strong> affect the visual field of only that eye. The visual field of the opposite eye is normal.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 26-year-old man comes to see you in your clinic. His wife noticed an area of circular hair loss over the back of his head. There is no other significant past medical history. On examination, there is a 2 cm area of complete, smooth, and circular hair loss with distinct margins. There is no scaling or inflammation present in and around the area of hair loss. Which among the given options is the best treatment for this patient's condition?",
    "choices": [
      {
        "id": 1,
        "text": "Topical antifungals"
      },
      {
        "id": 2,
        "text": "Intralesional corticosteroids"
      },
      {
        "id": 3,
        "text": "Oral corticosteroids"
      },
      {
        "id": 4,
        "text": "Oral tacrolimus"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical vignette is strongly suggestive of&nbsp;<strong>alopecia areata.&nbsp;</strong>In this patient, with limited patchy hair loss, the treatment of choice is <strong>intralesional corticosteroids</strong>.</p>\n<p>Clinically, it is characterized by <strong>discrete, smooth,</strong> and<strong> circular </strong>areas of hair loss. It develops over weeks to months and most patients will see regrowth of hair in the affected region over time. However, recurrence is common. Alopecia areata can affect any part of the body. In rare cases, it may extend to involve the entire scalp (called<strong> alopecia totalis</strong>) or loss of all hair on the body (called <strong>alopecia universalis</strong>). The pathology is most likely <strong>autoimmune</strong> suggested by the infiltration of activated<strong> T-cells</strong> in and around the hair-bulbs. Features of alopecia areata include-</p>\n<ul>\n<li><strong>No scaling</strong> or<strong> inflammation</strong> in the area of hair loss.</li>\n<li><strong>Sparing </strong>of <strong>white hair</strong></li>\n<li><strong>Exclamation mark hair&nbsp;</strong>are often seen at the margins of the bald patches during active phases of the disease</li>\n<li><strong>Preservation</strong> of <strong>hair follicles</strong> in the affected area and the follicular orifices may appear as yellow dots on dermoscopy</li>\n<li>Nail changes associated ranging from roughening of the nail plate to a more well-defined <strong>fine stippled pitting</strong>.</li>\n</ul>\n<p>Treatment for alopecia areata depends on the extent of the disease-</p>\n<ul>\n<li>Local patchy involvement-\n<ul>\n<li><strong>Intralesional corticosteroids </strong>(<strong>Triamcinolone</strong>) are the preferred treatment for limited patchy alopecia areata.&nbsp;After treatment, new hair growth is typically seen in six to eight weeks. Treatment can be repeated every four to six weeks until regrowth is achieved.</li>\n<li><strong>Topical high potency corticosteroids</strong> with <strong>clobetasol.</strong></li>\n<li>Second-line drugs for the localized disease include topical agents such as anthralin and minoxidil.</li>\n</ul>\n</li>\n<li>Extensive involvement-\n<ul>\n<li><strong>Contact/topical immunotherapy</strong> with agents such as dinitrochlorobenzene (DNCB), diphenylcyclopropenone (DPCP)<strong>.</strong> They are <strong>potent contact allergens</strong> that have an immunomodulatory role.&nbsp;</li>\n<li>Systemic corticosteroids may be used for a short bout to slow hair loss in patients with severe rapidly progressing, extensive hair loss. It is not preferred for long-term treatment as the risks of systemic corticosteroids outweigh the benefits.</li>\n</ul>\n</li>\n</ul>\n<p>&nbsp;Localized alopecia areata in a patient-</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f5855b68c56341f8995cd608e28ff742x720x770.JPEG"
    ]
  },
  {
    "text": "During a central line insertion, the patient suffers a pleural puncture and develops breathing difficulty and sharp pain. There is an absence of breath sounds on the right side. A chest X-ray is done and appears as shown below.  A needle is inserted in the 2nd intercostal space as an emergency measure. However, the breathing difficulty persists and a decision to insert an intercostal drain is taken. You would insert the chest drain into the triangle that lies _________.",
    "choices": [
      {
        "id": 1,
        "text": "1, 4, 5"
      },
      {
        "id": 2,
        "text": "2, 3, 5"
      },
      {
        "id": 3,
        "text": "1, 3, 6"
      },
      {
        "id": 4,
        "text": "2, 3, 6"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<div class=\"page\" title=\"Page 202\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>The given clinical scenario and chest X-ray is suggestive of<strong>&nbsp;tension pneumothorax.&nbsp;</strong>The safest site for insertion of a chest drain is the<strong> triangle of safety</strong> which lies:</p>\n<ul>\n<li><strong>Anterior</strong> to the mid-axillary line;</li>\n<li><strong>Above</strong> the level of the <strong>nipple</strong>;</li>\n<li>Below and lateral to the pectoralis major muscle.</li>\n</ul>\n<p>This will be present in the fifth intercostal space.</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d65880b1be0b4c83a6a578cecb9bddc7.png"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7741e856286d452389aa27f873233ca6x600x577.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6892dafc7d1f463db4f783919b42714ex600x1759.JPEG"
    ]
  },
  {
    "text": "An 11-year-old boy presenting with fever and pain over the right thigh. X-ray of the right femur revealed an onion skin appearance. Biopsy from the lesion is as shown below. This tumor is most likely to be found in the __________",
    "choices": [
      {
        "id": 1,
        "text": "Proximal femoral epiphysis"
      },
      {
        "id": 2,
        "text": "Distal femoral metaphysis"
      },
      {
        "id": 3,
        "text": "Proximal femoral metaphysis"
      },
      {
        "id": 4,
        "text": "Diaphysis of the femur"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The <strong>most common site of presentation of Ewing's sarcoma</strong> is <strong>femoral diaphysis.</strong></p>\n<p>Ewing's sarcoma is a <strong>primary malignant bone tumor</strong> seen in children. It affects <strong>boys more than girls.</strong></p>\n<p>Ewing's sarcoma is most commonly seen in the <strong>diaphysis of long tubular bones</strong> like the <strong>femur</strong> and flat bones of the pelvis. It presents with pain and swelling in the affected site which is usually warm and tender. Systemic symptoms may be present. On X-ray, the characteristic <strong>onion peel appearance</strong> is seen due to periosteal reaction producing layers of reactive bone.</p>\n<p>The tumor is soft and tan-white on gross appearance with multiple areas of hemorrhage and necrosis. On histopathology, sheets of <strong>small round cells</strong> with scant cytoplasm, which may appear clear because it is rich in <strong>glycogen</strong>. The presence of <strong>Homer-Wright rosettes</strong>, (tumor cells arranged in a circle about a central fibrillary space) is indicative of neuroectodermal differentiation.</p>\n<p>Other options:</p>\n<p>Option A: <strong>Clear cell chondrosarcoma</strong> is a tumor that commonly arises in the <strong>proximal femoral epiphysis</strong>. It is <strong>commonly seen in adulthood</strong> in the 3<sup>rd</sup>-5<sup>th</sup>&nbsp;decades.</p>\n<p>Options B and C: <strong>Osteosarcoma</strong> is the <strong>most common primary malignant bone tumor seen in children</strong> and it is <strong>metaphyseal</strong> in origin. The most common presenting site is the distal femoral metaphysis. X-ray shows a typical <strong>sun-burst appearance</strong> and histopathology shows anaplastic cells with pleomorphism. Other tumors commonly seen in the metaphysis of long bones are osteochondroma, simple bone cysts, and aneurysmal bone cysts. These tumors are most commonly seen in persons &lt; 20 years of age. However, this patient's X-ray and biopsy from the tumor are typical of Ewing's sarcoma.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/11c5eed3f3d54660be5bfc3e5213a583.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following manifestations do you expect to see in a patient with ferrochelatase deficiency?",
    "choices": [
      {
        "id": 1,
        "text": "Increased urinary ALA and coproporphyrin III"
      },
      {
        "id": 2,
        "text": "Increased urinary ALA and porphyrobilinogen III (PBG)"
      },
      {
        "id": 3,
        "text": "Increased urinary ALA, PBG, and coproporphyrin III and fecal coproporphyrin III"
      },
      {
        "id": 4,
        "text": "Increased fecal and red cell protoporphyrin IX"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Increased fecal and red cell protoporphyrin IX</strong> is seen in&nbsp;<strong>ferrochelatase deficiency</strong>. This leads to&nbsp;<strong>Protoporphyria.</strong></p>\n<p>Other options:</p>\n<p>Option A: Increased <strong>urinary ALA</strong> and <strong>coproporphyrin III</strong> are seen in <strong>ALA dehydratase deficiency</strong>.</p>\n<p>Option B: Increased <strong>urinary ALA</strong> and <strong>porphyrobilinogen III (PBG)</strong> are seen in <strong>uroporphyrinogen I synthase deficiency</strong> causing <strong>acute intermittent porphyria</strong>. This enzyme is also called PBG deaminase or hydroxymethylbilane synthase.</p>\n<p>Option C: Increased <strong>urinary ALA, PBG,</strong> and <strong>coproporphyrin III,</strong> and <strong>fecal coproporphyrin III</strong> is seen in <strong>coproporphyrinogen oxidase deficiency</strong> causing <strong>hereditary coproporphyria</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 25-year-old female comes for a routine gynecological examination. She has no significant past history. She is sexually active with her partner and uses condoms inconsistently. She has regular menstrual cycles and her last menstrual period was 6 days ago. Her external genitalia appears normal. On colposcopy, there are multiple small warty growths on the posterior vaginal wall which appear as patches of raised white epithelium on the application of acetic acid. Which of the following is the best recommendation for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Local trichloroacetic acid + fluorouracil application"
      },
      {
        "id": 2,
        "text": "Local podophylline cream application"
      },
      {
        "id": 3,
        "text": "Reassurance and observation"
      },
      {
        "id": 4,
        "text": "Laser ablation"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Local trichloroacetic acid+ fluorouracil application </strong>is the best recommendation for this patient with<strong> multiple small warty growths</strong> on the posterior wall of the vagina. In a sexually active female, these lesions are most likely to be&nbsp;<strong>condyloma acuminata.</strong></p>\n<p>The verrucous growths may appear discrete or coalesce to form large cauliflower-like growths. Human papillomaviruses (<strong>HPV</strong>) strains 6, 16, and 18 are implicated in causing condyloma acuminatum. On the application of acetic acid, these warts appear as raised projections of white epithelium giving a speckled appearance on colposcopy.&nbsp;</p>\n<p>Topical application of 25% trichloroacetic acid plus 5% fluorouracil causes sloughing off of small warts in 3-4 days. The treatment has to be <strong>repeated weekly</strong> as <strong>warts recur in 3-6 weeks' time. </strong>The sexual partner should be treated simultaneously and advised to use condoms to stop the spread of infection. Cesarian section is mandated in pregnant women with vulval or vaginal warts to avoid papilloma laryngitis in neonates.</p>\n<p>Condyloma is associated with vaginal, vulval and cervical cancer in 20% of the cases. Lately, interferon local ointment or intralesional injections are in use. Interferon inhibits viral and cellular growth.&nbsp;</p>\n<p>Other options:&nbsp;</p>\n<p>Option B: <strong>Local podophyllin application</strong> is also useful in the treatment of small anogenital warts in condyloma acuminata. However, local application of podophyllin is <strong>contraindicated in vaginal and cervical lesions</strong> as it provokes a severe inflammatory reaction <strong>damaging the mucosa</strong>. It is <strong>also contraindicated in the first trimester of pregnancy</strong> as it can be absorbed into the circulation and is cytotoxic.&nbsp;</p>\n<p>Option C: Reassurance and observation is recommended in women with flat lesions especially during pregnancy as they tend to disappear in 6 months.</p>\n<p>Option D: Laser ablation is recommended for larger lesions or small lesions not responsive to medical therapy.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Identify the following instrument.",
    "choices": [
      {
        "id": 1,
        "text": "Lempert\u2019s curette"
      },
      {
        "id": 2,
        "text": "Myringotome"
      },
      {
        "id": 3,
        "text": "MacEwen\u2019s curette"
      },
      {
        "id": 4,
        "text": "Tilley\u2013Lichtwiz trocar"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The instrument shown in the image is a <strong>myringotome</strong>. It is a sharp surgical knife used for paracentesis of the eardrum during <strong>myringotomy</strong>.&nbsp;</p>\n<p>Other options-</p>\n<p>Option A-&nbsp;<strong>Lempert&rsquo;s curette</strong>&nbsp;(scoop) is used for the removal of bony septa and granulations in mastoid surgery.</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/925aa0ed139649dfb3dedf91f3c96283.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/dbfee477f7e147e3917d9f19279b1d73x1279x839.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/afb9b82e33964942a2fa7d788d2330f5x720x372.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b5fc23b546674dda916bebe2ee7880d4x1279x745.JPEG"
    ]
  },
  {
    "text": "A 68-year-old male came to the physician with complaints of chronic back pain and easy fatigability. He has also been treated twice for urinary tract infections in the last 3 months. An x-ray of his skull is shown below. Which of the following laboratory parameters is consistent with this diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Hypercalcemia, high alkaline phosphatase and normal ESR"
      },
      {
        "id": 2,
        "text": "Hypercalcemia, high alkaline phosphatase, elevated ESR"
      },
      {
        "id": 3,
        "text": "Hypercalcemia, normal alkaline phosphatase, normal ESR"
      },
      {
        "id": 4,
        "text": "Hypercalcemia, normal alkaline phosphatase, elevated ESR"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical scenario and the skull radiograph showing <strong>punched-out lesions</strong> suggest <strong>multiple myeloma.&nbsp;</strong><strong>Hypercalcemia, normal alkaline phosphatase,</strong> and<strong> elevated ESR</strong> are the laboratory parameters consistent with a diagnosis of multiple myeloma.</p>\n<p><strong>Multiple myeloma</strong> is a <strong>malignant</strong> <strong>plasma cell dyscrasia</strong> with the proliferation of plasma cells derived from a single clone. <strong>Bone pain</strong> is the <strong>most common symptom</strong> of multiple myeloma. Tumor cells release <strong>osteoclast activating factors (OAFs)</strong>, which <strong>increased osteoclast activity</strong> and accelerated bone destruction. Furthermore, there is <strong>suppression of osteoblast activity</strong> to form new bone. <strong>Lysis of the bone</strong> leads to <strong>hypercalcemia</strong>. Patients with multiple myeloma also have an <strong>increased susceptibility to infections</strong> because of diffuse <strong>hypogammaglobulinemia</strong> (decreased production and increased destruction) of normal antibodies.&nbsp;</p>\n<p>Other important features of multiple myeloma include:&nbsp;</p>\n<ul>\n<li><strong>Renal failure</strong></li>\n<li>Normocytic and normochromic anemia</li>\n<li>Hyperviscosity syndromes</li>\n<li><strong>Elevated ESR</strong></li>\n<li><strong>Normal</strong>&nbsp;<strong>alkaline phosphatase </strong>due to<strong>&nbsp;</strong>suppression of osteoblast activity.</li>\n<li style=\"text-align: left;\"><strong>Serum protein electrophoresis</strong> shows the presence of <strong>monoclonal protein</strong></li>\n<li style=\"text-align: left;\"><strong>Urinalysis</strong> shows free <strong>kappa </strong>and<strong> lambda&nbsp;light chains</strong> <strong>(Bence-Jones proteins)</strong></li>\n</ul>\n<div class=\"page\" title=\"Page 3332\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Diagnostic Criteria for Multiple Myeloma include:&nbsp;</p>\n</div>\n</div>\n</div>\n</div>\n<p><strong>Clonal bone marrow plasma cells</strong>&nbsp;<strong>&ge;10%</strong> (or) biopsy-proven bony or extramedullary plasmacytoma</p>\n<p><strong>plus</strong></p>\n<p>Any one<strong> or more</strong>&nbsp;of the following&nbsp;<strong>myeloma-defining events</strong>:</p>\n<ul>\n<li><strong>Evidence of end-organ damage</strong> attributable to the underlying plasma cell proliferative disorder, specifically: (<strong>CRAB</strong>&nbsp;features)\n<ul>\n<li>Hyper<strong>c</strong>alcemia: Serum calcium level &gt;1 mg/dL higher than the upper limit of normal or <strong>&gt;11 mg/dL</strong></li>\n<li><strong>R</strong>enal insufficiency: Serum creatinine <strong>&gt;2 mg/dL</strong></li>\n<li><strong>A</strong>nemia: Hemoglobin level of &gt;2 g/dL below the lowest limit of normal, or Hb <strong>&lt;10 g/dL</strong></li>\n<li><strong>B</strong>one lesions: <strong>One</strong> or more osteolytic lesions on radiography, computed tomography (CT), or positron emission tomography (PET).</li>\n</ul>\n</li>\n</ul>\n<ul>\n<li><strong>Any one or more</strong>&nbsp;of the following biomarkers of malignancy:\n<ul>\n<li>Clonal bone marrow plasma cells <strong>&ge; 60%</strong></li>\n<li>Serum <strong>involved / uninvolved</strong> free<strong> light-chain ratio</strong> of <strong>100 or greater.</strong></li>\n<li><strong>&gt;1</strong> <strong>focal lesion</strong> on magnetic resonance imaging (MRI).</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d2f6f1d3435644818e7079eaaefc6920.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 36-year-old obese woman, G3P2L2 at 38 weeks gestation is brought to the labor room with painless bleeding from the vagina following sexual intercourse with her husband. The patient has not had any antenatal care during this pregnancy except for her first dating scan which was normal. Her previous two pregnancies needed cesarian deliveries due to fetal distress. She is a chronic smoker. On examination, her vitals are stable. The uterus is soft, and non-tender. The fetal heart tracing shows a baseline heart rate of 150 beats/ min with accelerations, moderate variability, and no decelerations. Which of the following is the next best step in the management of this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Transvaginal ultrasound"
      },
      {
        "id": 2,
        "text": "Biophysical profile"
      },
      {
        "id": 3,
        "text": "Fetal fibronectin testing"
      },
      {
        "id": 4,
        "text": "Immediate vaginal delivery"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong><span data-preserver-spaces=\"true\">Transvaginal ultrasound </span></strong>is the next best step in the management of this patient presenting with painless vaginal bleeding at &gt;20 weeks of gestation which is suspicious of <strong>placenta previa</strong>.</p>\n<p>Placenta previa is defined as the implantation of the placenta partially or completely over the lower uterine segment, either over or adjacent to the internal os. Common risk factors for placenta previa include previous cesarian section or myomectomy, advanced maternal age (&gt;35 years), smoking, multiple gestation, multiparity, and prior curettage.</p>\n<p>In this patient, with advanced maternal age, previous two cesarian sections, and smoking history, the coital act could have led to the separation of the placenta leading to painless vaginal bleeding. Other causes of bleeding in placenta previa include physiological spontaneous separation, per vaginal examination, external cephalic version, and high rupture of membranes.</p>\n<p>The next best step in this patient will be to <strong>confirm the diagnosis</strong> of placenta previa and <strong>localization</strong> through sonography. In transvaginal ultrasonography, the probe will be placed in the vagina without touching the endocervix. It is <strong>more accurate</strong> than transabdominal ultrasound (TAS) which also necessitates a full bladder for adequate visualization. Maternal obesity and posterior situation of the placenta also result in poor imaging in transabdominal ultrasonography.</p>\n<p>Other options:</p>\n<p>Option B: <strong>Fetal biophysical profile</strong> is done as a test of uteroplacental insufficiency in fetuses with a&nbsp;<strong>non-reactive non-stress test (NST)</strong>. This fetus has a normal baseline heart rate (110-160 bpm) with accelerations, moderate variability, and no declarations. This is a reactive NST and does not need any further testing. This fetus is not in distress.</p>\n<p>Option C: <strong>Fetal fibronectin</strong> is a glycoprotein that binds the fetal membranes to the decidua. The presence of fetal fibronectin in the cervical or vaginal discharge between 24-34 weeks of pregnancy is an <strong>indicator of preterm labor</strong>. It is normally found before 22 weeks and after 37 weeks of pregnancy and hence has no significance in this patient.</p>\n<p>Option D: <strong>Vaginal delivery</strong> is <strong>contraindicated</strong> in placenta previa especially with a previous history of cesarian section. It may be considered if when the placental edge is clearly 2-3 cm away from the internal os as seen on USG. Further, this patient is hemodynamically stable and there is no evidence of fetal distress to necessitate immediate delivery. Definitive delivery through a Cesarian section after localizing the placenta is advisable.</p>\n<p><strong><span data-preserver-spaces=\"true\">Note: </span></strong>Per-Vaginal Examination should not be done<span data-preserver-spaces=\"true\">&nbsp;in suspected placenta previa. In case of unavailability of USG or inconclusive ultrasonography it can be only done in the operation theatre with all the arrangements for Cesarian Section.</span></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 23-year-old girl who is an alleged victim of rape is brought to the casualty. Samples are collected for the detection of semen. Which of the following tests is not useful in the detection of semen?",
    "choices": [
      {
        "id": 1,
        "text": "Teichmann test"
      },
      {
        "id": 2,
        "text": "P30 assay"
      },
      {
        "id": 3,
        "text": "Barberio test"
      },
      {
        "id": 4,
        "text": "Acid phosphatase test"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Amongst the given tests, the Teichmann test is not used for semen detection.&nbsp;</p>\n<p>The <strong>Teichmann test</strong>&nbsp;or hemin crystal test is used to <strong>detect</strong> suspected <strong>bloodstains</strong>. It is performed by placing a small piece of suspected material on a glass slide. Then, 2-3 drops of<strong> glacial acetic acid</strong> and a small crystal of <strong>sodium chloride</strong> are added to the glass slide and covered with a coverslip. The slide is then heated.</p>\n<p>If bloodstain is present, faint<strong> yellowish-red</strong> to <strong>brownish-black</strong> <strong>rhombic</strong> <strong>crystals</strong> of <strong>hemin</strong> or <strong>hematin chloride appear.&nbsp;</strong>When <strong>hydrogen</strong> <strong>peroxide</strong> is added, the hematin crystals produce bubbles of gas.</p>\n<p>Other options:</p>\n<p>Option B:&nbsp;<strong>P30 assay </strong>is a test to look for&nbsp;a <strong>glycoprotein</strong> produced by the <strong>prostate gland</strong> present in the semen (even of aspermic male), blood, and urine of a male. It may be found in the vagina up to 27 hours after intercourse. It is a <strong>reliable indicator</strong> of semen irrespective of acid phosphatase levels or the presence of sperm.&nbsp;</p>\n<p>Option C:&nbsp;<strong>Barberio test&nbsp;</strong>is used to detect seminal fluid and probably detect the presence of <strong>prostatic secretions</strong>. When a saturated aqueous or alcoholic solution of<strong> picric acid </strong>is added to the spermatic fluid<strong>,</strong> <strong>yellow needle-shaped </strong>rhombic crystals of <strong>spermine picrate </strong>are produced.</p>\n<p>Option D:&nbsp;<strong>Acid phosphatase test</strong>&nbsp;detects the presence of<strong> high levels</strong> of <strong>acid phosphatase</strong> in seminal stains (low levels may be present in the vagina). Positive reactions are found till 36 hours, after which the levels fall and disappear within 72 hours.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 14-year-old boy comes to your clinic with his mother, with complaints of fever, headache, and cough for the past week. He had returned from a school trip about two weeks ago. On examination, his pulse was 100 beats per minute, BP was 100/70 mm of Hg, temperature was 99.8F. Auscultation revealed occasional rales and wheezes. Laboratory investigations revealed hemoglobin of 11g/dL and reticulocytosis and increased indirect bilirubin. Gram stain of the sputum was negative. Sputum cultures on blood agar were also negative. X-ray shows diffuse reticular nodular opacities and patchy consolidations. Which among the following antibiotics is the best among the given options for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Doxycycline"
      },
      {
        "id": 2,
        "text": "Amoxicillin"
      },
      {
        "id": 3,
        "text": "Cephalexin"
      },
      {
        "id": 4,
        "text": "Imipenem"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario is strongly suggestive of <strong>Mycoplasma pneumonia</strong>. The most appropriate antibiotic among the given options for the treatment of mycoplasma pneumonia is <strong>doxycycline</strong>.&nbsp;</p>\n<p>Mycoplasma pneumonia are <strong>small</strong>, <strong>pleomorphic</strong>, <strong>cell wall deficient</strong> bacteria, and are the smallest free-living organisms in nature that can be grown in a cell-free medium. They are covered by a soft membrane containing <strong>sterols</strong>.&nbsp;</p>\n<p>They are a common cause of <strong>community-acquired atypical pneumonia</strong> which&nbsp;is more commonly seen in the first two decades of life. It is transmitted through droplets and are hence more likely affects people who live in close quarters with each other such as schools, hostels, and military camps.&nbsp;</p>\n<p>Clinically, patients present with-</p>\n<ul>\n<li>Non-specific symptoms- Such as fever, fatigue, cough, and malaise. While the patient may have only mild cough and fever, with clinical exam findings showing only scattered rales and wheezes,&nbsp;the<strong> X-ray </strong>will be<strong> strikingly worse</strong> with <strong>reticulonodular opacities</strong> and <strong>patchy consolidation.&nbsp;</strong></li>\n<li>Extrapulmonary complications-\n<ul>\n<li>Hematological manifestations- Include immune hemolysis due to the formation of <strong>cold agglutinins</strong>. It is seen in more than half of the patients. Cold agglutinins are IgM antibodies&nbsp;against the I antigen present on RBCs. They are called cold agglutinins because they cause agglutination of RBCs at&nbsp;4&deg;C which is reversible at 37&deg;C. Other hematological manifestations include&nbsp;aplastic anemia, disseminated intravascular coagulation, and hypercoagulopathy.</li>\n<li>Other extrapulmonary manifestations include erythema multiforme major, and more rarely bullous myringitis, meningitis, meningoencephalitis, myocarditis, pericarditis, and arthritis.</li>\n</ul>\n</li>\n</ul>\n<p>Investigations include serological testing through <strong>enzyme-linked immunoassay (EIA)</strong> and <strong>polymerase chain reaction (PCR)</strong>. Although not routinely used for clinical diagnosis, mycoplasma can be cultured in fluid or solid media that is<strong> enriched </strong>with <strong>serum </strong>and<strong> yeast extract</strong>, as they have a specific requirement of sterols for growth and membrane synthesis. Colonies tend to have a characteristic <strong>\"fried-egg\"</strong> appearance and may be best studied by staining using the Dienes method.</p>\n<p>Treatment of mycoplasma includes <strong>tetracyclines, macrolides, </strong>or <strong>fluoroquinolones</strong>. They are completely<strong> resistant </strong>to<strong> beta-lactam antibiotics</strong> such as penicillins and cephalosporins because they <strong>lack </strong>a<strong> cell wall</strong>.&nbsp;</p>\n<p>Other options- Amoxicillin, cephalexin, and imipenem are beta-lactam antibiotics are hence not effective in the treatment of mycoplasma pneumonia.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 50-year-old female presented with multiple joint pains and easy fatiguability. On examination, the following finding was seen. An X-ray was performed and is given below. Her lab findings are shown below. What is the most probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Iron deficiency anemia"
      },
      {
        "id": 2,
        "text": "Anemia of chronic disease"
      },
      {
        "id": 3,
        "text": "Sideroblastic anemia"
      },
      {
        "id": 4,
        "text": "Thalassemia"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In the given clinical scenario, the image shows swan neck deformity with <strong>low MCV</strong>, <strong>low TIBC,&nbsp;</strong>and <strong>low transferrin saturation</strong> pointing towards the diagnosis of <strong>anemia of chronic disease</strong> secondary to <strong>Rheumatoid Arthritis</strong>.&nbsp;</p>\n<p>The chronic illnesses associated with &nbsp;anemia of chronic disease can be grouped into&nbsp;<strong>three categories:</strong></p>\n<ol>\n<li>Chronic&nbsp;<strong>microbial infections</strong>, such as osteomyelitis, bacterial endocarditis, and lung abscess</li>\n<li>Chronic&nbsp;<strong>immune disorders</strong>, such as rheumatoid arthritis and regional enteritis</li>\n<li><strong>Neoplasms</strong>, such as carcinomas of the lung and breast and Hodgkin lymphoma</li>\n</ol>\n<p><strong>Interleukin-6 (IL-6), stimulates&nbsp;</strong>an increase in the hepatic<strong>&nbsp;production of hepcidin.&nbsp;</strong><strong>Hepcidin&nbsp;</strong>inhibits ferroportin function in macrophages and<strong>&nbsp;reduces the transfer of iron&nbsp;</strong>from the storage pool to developing erythroid precursors in the bone marrow<strong>.</strong></p>\n<p><strong>Erythropoietin</strong>&nbsp;levels are<strong>&nbsp;inappropriately low</strong>&nbsp;for the degree of anemia.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a4429d61f57d4be5a123190be3b4632f.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8a3783c2e1594956a9df6555e3cf6a71x1279x1210.JPEG"
    ]
  },
  {
    "text": "A plain radiograph of a patient who was involved in a road traffic accident is as given below. During clinical examination his limb would be found to be:",
    "choices": [
      {
        "id": 1,
        "text": "Abducted and internally rotated"
      },
      {
        "id": 2,
        "text": "Adducted and externally rotated"
      },
      {
        "id": 3,
        "text": "Abducted and externally rotated"
      },
      {
        "id": 4,
        "text": "Adducted and internally rotated"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The plain radiograph of this patient shows&nbsp;<strong>anterior dislocation</strong> of the <strong>hip</strong>. On physical examination,&nbsp;the affected limb will be<strong>&nbsp;abducted </strong>and<strong> externally rotated.&nbsp;</strong></p>\n<p>Other findings in anterior dislocation of the hip joint include a slightly<strong> flexed</strong> limb and a prominent anterior bulge in the pubic or groin region.&nbsp;According to the position assumed by the femoral head, anterior dislocation of the hip can further be classified as -</p>\n<ul>\n<li>Type I - If the femoral head is felt anteriorly it is called as the&nbsp;<strong>superior/pubic&nbsp;type</strong></li>\n<li>Type II - If the femoral head is felt in the groin it is called as the&nbsp;<strong>inferior/obturator type</strong></li>\n</ul>\n<p>On an X-ray, the displaced <strong>femoral head</strong> will appear<strong> larger</strong> than the normal side. A lateral view X-ray will be confirmatory.&nbsp;</p>\n<p>The&nbsp;most common nerve&nbsp;injured in an anterior hip dislocation is the&nbsp;<strong>femoral nerve</strong>.</p>\n<p>Treatment of anterior dislocation includes a closed reduction under sedation or general anesthesia. If closed reduction fails, an open procedure may be planned.&nbsp;</p>\n<p>The image below shows, a patient with an externally rotated, abducted, and slightly flexed left leg due to <strong>anterior dislocation of the hip</strong>:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/9dda8b971a7a485aa96aae38ab8f7e67.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c2fa78bf3f8d482f9adc155598c46553x285x174.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/68244c381a904bc789612797b4312f1ax781x600.PNG"
    ]
  },
  {
    "text": "A 46-year-old female came with complaints of a dry nagging cough and breathlessness on walking for a short distance. She is a chronic smoker and smokes 1 pack per day.  On examination, there was dullness to percussion and reduced breath sounds on the right side. Chest X-ray showed moderate pleural effusion. Thoracocentesis was performed under ultrasound guidance, which relieved her symptoms. The lab investigations are given below. Which of the following is the most probable diagnosis in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Parapneumonic pleural effusion"
      },
      {
        "id": 2,
        "text": "Malignant pleural effusion"
      },
      {
        "id": 3,
        "text": "Congestive heart failure"
      },
      {
        "id": 4,
        "text": "Tubercular pleural effusion"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>This patient's clinical presentation and laboratory findings are suggestive of <strong>malignant pleural effusion.</strong></p>\n<p>In this patient,&nbsp;</p>\n<ul>\n<li>Pleural fluid protein/serum protein ratio : 0.64 <strong>(&gt;0.5)</strong></li>\n<li>Pleural fluid LDH/serum LDH : 7.1&nbsp;<strong>(&gt;0.6)</strong></li>\n<li>Pleural fluid LDH is <strong>&gt; 2/3<sup>rd</sup> the upper limit of normal serum LDH </strong>(normal serum LDH - 50-150 U/L)</li>\n</ul>\n<p>In this patient, according to&nbsp;<strong>Light's criteria</strong>, the pleural effusion is <strong>exudative.</strong></p>\n<p>Malignant pleural effusions secondary to metastatic disease are the second most common cause of exudative pleural effusions. In malignant pleural effusions, the dyspnea is out of proportion to the volume of effusion. Characteristics of malignant pleural effusion include:</p>\n<ul>\n<li>Appearance may be cloudy or straw-colored or bloody</li>\n<li>pH &lt; 7.2</li>\n<li>Glucose &lt; 60 mg/dL</li>\n<li>Cell counts - RBC count ranges from 100 to several hundred thousand, WBC count ranges from 1000 - 100,000&nbsp;cells/&mu;L with a predominance of lymphocytes</li>\n<li><strong>Cytology</strong> of pleural fluid is the <strong>gold standard</strong> of diagnosis of malignant pleural effusion. <strong>Abnormal cells</strong> with multiple nucleoli and figures of mitosis are diagnostic of malignant pleural effusion.</li>\n</ul>\n<p>Management of malignant pleural effusion includes therapeutic thoracocentesis followed by insertion of a small indwelling catheter or tube thoracostomy with instillation of sclerosing agents.</p>\n<p>Other options:</p>\n<p>Option A: In <strong>parapneumonic pleural effusion</strong> too, the effusion is exudative with pH &lt; 7.2 and glucose &lt; 60 mg/dL. However, the WBC count is usually &gt;10,000 cells/&mu;L with a <strong>predominance of neutrophils</strong>. Appearance is generally cloudy.</p>\n<p>Option C: Pleural effusion associated with <strong>congestive heart failure</strong> is <strong>transudative</strong> in nature.</p>\n<p>Option D: Although tubercular pleural effusion is also exudative with a predominance of lymphocytes, <strong>adenosine deaminase levels &lt; 40 U/L</strong> as in this patient <strong>rules out tubercular effusion.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = 'Neet 2021 Mini Test 5  (20 Questions)';
        const quizFilename = 'neet-2021-mini-test-5-20-questions-2ce76d9d.html';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2020-21"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>