<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>08 Non-Infectious Disorders Of Cornea - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Ophthalmology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">26</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Deposition of which of the following is responsible for band-shaped keratopathy?",
    "choices": [
      {
        "id": 1,
        "text": "Amyloid"
      },
      {
        "id": 2,
        "text": "Calcium"
      },
      {
        "id": 3,
        "text": "Monopolysaccharide"
      },
      {
        "id": 4,
        "text": "Cholesterol"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Band-shaped keratopathy</strong> is caused by pathological&nbsp;<strong>calcium deposition</strong> on the cornea in the form of a band.</p>\n<p>On exam, there is a <strong>white band-like formation </strong>of calcium across the corneal surface <strong>with irregular borders </strong>and a <strong>peripheral clearing</strong> of cornea between the calcium deposits and the limbus. The calcium deposition is typically found beneath the epithelial layer within <strong>Bowman&rsquo;s layer</strong> but may extend into the anterior stroma.</p>\n<p>Once the visual axis starts to get involved, there will be progressive loss of vision. Recurrence is common unless the predisposing cause is identified and treated.</p>\n<p>Local causes such as&nbsp;chronic ocular irritation or inflammatory conditions and systemic diseases&nbsp;that elevate serum calcium levels are the main causes for band-shaped keratopathy. It can rarely have hereditary causes as well.</p>\n<p>Image given below shows&nbsp;band-shaped keratopathy.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://cdn1.dailyrounds.org/uploads/eefde464ecf143fa91fc3a07a3ae5d00x483x427.PNG"
    ]
  },
  {
    "text": "A patient was with the given finding has been having painless and slowly progressive vision loss for the past 10 years. Which of the following diseases is not associated with the given condition?",
    "choices": [
      {
        "id": 1,
        "text": "Systemic lupus erythematosus"
      },
      {
        "id": 2,
        "text": "Sarcoidosis"
      },
      {
        "id": 3,
        "text": "Juvenile rheumatoid arthritis"
      },
      {
        "id": 4,
        "text": "Chronic renal failure"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Based on the given clinical scenario and ocular finding depicted here, it is suggestive of <strong>band-shaped keratopathy, </strong>and <strong>systemic lupus erythematosus</strong> is<strong> not </strong>associated with this condition.<strong>\u00a0</strong></p>\n<p>Band-shaped keratopathy (BSK) is due to <strong>calcium deposition</strong>, primarily in the form of hydroxyapatite, in the epithelial basement membrane, Bowman's layer, and the anterior stroma. Initially, these deposits are grey but may become chalky-white as the degeneration progresses.</p>\n<p>lt typically presents as a <strong>band-shaped opacity</strong> in the interpalpebral zone with a clear interval between the ends of the band and the limbus. The condition begins at the periphery and gradually progresses towards the centre. The surface of this opaque band is stippled due to holes in the calcium plaques in the area of <strong>nerve canals </strong>of <strong>Bowman's membrane.</strong></p>\n<p>Causes of band-shaped keratopathy include\u00a0<strong>local causes</strong> such as\u00a0<strong>chronic ocular irritation </strong>or<strong> inflammatory</strong> conditions and<strong> systemic diseases</strong>\u00a0that <strong>elevate serum calcium</strong> levels:</p>\n<table style=\"height: 146px; width: 558px;\">\n<tbody>\n<tr>\n<td style=\"width: 246.309px;\"><strong>Local causes</strong></td>\n<td style=\"width: 142.691px;\"><strong>Systemic diseases</strong></td>\n</tr>\n<tr>\n<td style=\"width: 246.309px;\">\n<ul>\n<li>Chronic anterior uveitis (especially in <strong>Juvenile Idiopathic Arthritis</strong>)</li>\n<li>Interstitial keratitis</li>\n<li>Superficial keratitis</li>\n<li>Phthisis bulbi</li>\n<li>End-stage glaucoma</li>\n<li>Silicone oil left in the aphakic eye</li>\n</ul>\n</td>\n<td style=\"width: 142.691px;\">\n<ul>\n<li>Hyperparathyroidism</li>\n<li><strong>Sarcoidosis</strong></li>\n<li>Multiple myeloma</li>\n<li>Hypophosphatemia</li>\n<li>Paget disease</li>\n<li><strong>Chronic renal failure</strong></li>\n</ul>\n\u00a0</td>\n</tr>\n</tbody>\n</table>\n<p>Treatment:</p>\n<ul>\n<li>Medical management- <strong>Chelation</strong>\u00a0using topical\u00a0<strong>ethylenediaminetetraacetic acid (EDTA) 1.5\u20133.0%</strong>\u00a0</li>\n<li>Surgical management- Photorefractive keratectomy (PRK) using excimer laser or manual superficial keratectomy\u00a0</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/1cb109a5bc8f4c2fbcd79c5eff79ccab.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 64-year-old woman was brought by her son, during a cataract outreach camp.  She gives a history of trauma to her left eye, one year back and a complete loss of vision in that eye since then. Her image is given below. Which of the following statement is true about her condition?",
    "choices": [
      {
        "id": 1,
        "text": "Corneal tattooing is a treatment option in this lady."
      },
      {
        "id": 2,
        "text": "The given lesion is an adherent leucoma."
      },
      {
        "id": 3,
        "text": "It is due to scars involving Bowman's layer and superficial stroma."
      },
      {
        "id": 4,
        "text": "Excimer laser phototherapeutic keratectomy is the current treatment of choice."
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The above image shows a\u00a0<strong>dense white opacity,</strong> which results from<strong>\u00a0</strong>the<strong> scarring of more than half of the stroma,</strong><strong> \u00a0</strong>characteristic of <strong>leucoma</strong>.</p>\n<p>Corneal tattooing is a treatment option in patients\u00a0with corneal opacities, who have <strong>lost their vision or who do not expect to recover it</strong>. It improves <strong>cosmetic</strong> appearance by altering the white colour of the opacity and blending it to normal eye colour.</p>\n<p>Depending on the density, corneal opacities are graded as nebula, macula and leucoma.\u00a0</p>\n<ul>\n<li><strong>Nebular</strong> corneal opacity (fog or mist):\n<ul>\n<li>Hard-to-see corneal scar, due to superficial scars involving Bowman's layer and superficial stroma.</li>\n<li>Slit-lamp detection is required.</li>\n<li>A thin, diffuse nebula covering the pupillary area interferes more with vision than the localised leucoma away from the pupillary area. Nebula produces more discomfort due to blurred image (irregular astigmatism).</li>\n</ul>\n</li>\n<li><strong>Macular</strong> corneal opacity:\n<ul>\n<li>Semi-dense opacity that can be seen with proper illumination.</li>\n<li>Due to scarring involving about half the corneal stroma.</li>\n</ul>\n</li>\n<li><strong>Leucomatous</strong> corneal opacity (leucoma simplex):\n<ul>\n<li>White scar that is easily seen just by looking at the eye.</li>\n<li>Due to scarring of more than half of the stroma\u00a0</li>\n</ul>\n</li>\n<li><strong>Adherent</strong> <strong>leucoma</strong>:\n<ul>\n<li>It results when healing occurs after perforation of the cornea with incarceration of iris</li>\n</ul>\n</li>\n</ul>\n<p><strong>Secondary changes</strong> in corneal opacity\u00a0which may be seen in long-standing cases include hyaline degeneration, calcareous degeneration, pigmentation and atheromatous ulceration.</p>\n<p>Treatment:</p>\n<ul>\n<li><strong>Keratoplasty</strong> is the treatment of choice in leucomatous corneal opacities.</li>\n<li><strong>Optical iridectomy</strong> may be performed in cases with central adherent leucomas</li>\n<li><strong>Phototherapeutic keratectomy (PTK)</strong> performed with excimer laser is useful only in superficial (nebular) corneal opacities.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/96e71c62bdce44aa91af1c78d68af339.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following conditions is least likely to be associated with bilateral corneal opacities in a neonate?",
    "choices": [
      {
        "id": 1,
        "text": "Sclerocornea"
      },
      {
        "id": 2,
        "text": "Birth trauma"
      },
      {
        "id": 3,
        "text": "Peter's anomaly"
      },
      {
        "id": 4,
        "text": "Keratoglobus"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Keratoglobus</strong> is least likely to be associated with bilateral corneal opacities in a neonate. Here, the cornea is <strong>clear.\u00a0</strong></p>\n<p>Keratoglobus is a rare noninflammatory, familial disorder marked by generalised thinning and globular protrusion of the cornea. It can be congenital or acquired. The thinning is usually greatest at corneal periphery or midperiphery. It can cause refractive errors, otherwise, cornea is clear, normal angle of anterior chamber, normal intraocular pressure with no optic disc cupping.</p>\n<p>Intrastromal ring segments and cross-linking can be used for management.</p>\n<p>Other options:\u00a0</p>\n<p>Option B<strong>: Birth injuries </strong>resulting in <strong>Descemet's membrane tears </strong>can also cause corneal opacities.</p>\n<p>Option C:<strong> Peter's anomaly,</strong> also known as iridocorneal adhesions or keratolenticular adhesions, is a posterior corneal defect with an overlying stromal opacity.</p>\n<p>Option D:<strong> Sclerocornea</strong>\u00a0is a congenital disorder in which the cornea is opaque and resembles the sclera, making the limbus indistinct. The central cornea is clearer than the periphery.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What causes neurotrophic keratopathy?",
    "choices": [
      {
        "id": 1,
        "text": "Facial nerve palsy"
      },
      {
        "id": 2,
        "text": "Bell's palsy"
      },
      {
        "id": 3,
        "text": "Trigeminal nerve palsy"
      },
      {
        "id": 4,
        "text": "Third nerve palsy"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Neurotrophic keratopathy is caused by<strong> trigeminal nerve palsy</strong>.</p>\n<p>Lesions of the <strong>fifth cranial nerve</strong> from the<strong> trigeminal nucleus</strong> to the cornea may lead to abnormalities of the normal corneal sensation and trophic stimulation.</p>\n<p>Causes:</p>\n<ul>\n<li><strong>Varicella-zoster (</strong><strong>most common cause)</strong></li>\n<li>Herpes simplex keratitis</li>\n<li>Trauma</li>\n<li>Irradiation to the eye</li>\n<li>Aneurysm/stroke</li>\n<li>Multiple sclerosis</li>\n</ul>\n<p><strong>Mackie</strong> characterized<strong> three stages</strong> of neurotrophic keratitis.</p>\n<ul>\n<li><strong>Stage I </strong>is characterized<strong>\u00a0</strong>by an\u00a0irregular corneal surface, which later develops into an easily recognized punctate keratitis.</li>\n<li><strong>Stage II</strong> is characterized by a frank epithelial defect, which\u00a0is typically associated with mild anterior\u00a0stromal oedema and inflammation.</li>\n<li><strong>Stage III</strong>\u00a0involves stromal melting and occasionally perforation.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Paralysis of which of the following nerves is responsible for exposure keratopathy?",
    "choices": [
      {
        "id": 1,
        "text": "Trigeminal nerve"
      },
      {
        "id": 2,
        "text": "Optic nerve"
      },
      {
        "id": 3,
        "text": "Facial nerve"
      },
      {
        "id": 4,
        "text": "Oculomotor nerve"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Exposure keratopathy</strong> is caused by paralysis of the&nbsp;<strong>facial nerve</strong>.&nbsp;&nbsp;</p>\n<p>It is the result of incomplete lid closure (lagophthalmos) resulting in drying of the cornea (despite normal tear&nbsp;production).</p>\n<p>Causes:</p>\n<ul>\n<li>Neuroparalytic, e.g.,&nbsp;<strong>facial nerve palsy</strong></li>\n<li>Reduced muscle tone as&nbsp;in <strong>parkinsonism</strong></li>\n<li>Mechanical such as lid scarring</li>\n<li>Proptosis</li>\n</ul>\n<p>Note: <strong>Neurotrophic keratopathy</strong> is due to <strong>loss of trigeminal nerve innervation</strong> resulting in partial or complete loss of sensation.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following drugs is least likely to cause the given condition?",
    "choices": [
      {
        "id": 1,
        "text": "Amiodarone"
      },
      {
        "id": 2,
        "text": "Erythromycin"
      },
      {
        "id": 3,
        "text": "Tamoxifen"
      },
      {
        "id": 4,
        "text": "Chloroquine"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Erythromycin</strong> is least likely associated with <strong>cornea verticillata/vortex keratopathy</strong>, a whorl-like opacity in corneal epithelium, as shown in the image above.\u00a0</p>\n<p>Vortex keratopathy occurs due to corneal deposits in the basal epithelium. They are almost always bilateral and are readily recognisable by their distinct appearance as <strong>fine, golden-brown or grey opacities</strong>\u00a0that branch out from a central whorl, usually across the inferior cornea.\u00a0Opacity due to drugs is\u00a0<strong>reversible</strong> upon stopping the drug.</p>\n<p>Causes:</p>\n<ul>\n<li><strong>Amiodarone (most common) </strong>(Option A)</li>\n<li><strong>Tamoxifen </strong>(Option C)</li>\n<li>Indomethacin</li>\n<li><strong>Chloroquine </strong>(Option D)</li>\n<li>Chlorpromazine (rarely)</li>\n<li>Fabry\u2019s disease</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/edc8011cdb1345aebb3910baf56ab72b.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 30-year-old albino woman presents with a characteristic finding as shown below. Which of the following statements are true regarding the suspected condition?",
    "choices": [
      {
        "id": 1,
        "text": "1, 3, 5"
      },
      {
        "id": 2,
        "text": "Only 2"
      },
      {
        "id": 3,
        "text": "2 and 4"
      },
      {
        "id": 4,
        "text": "1 and 3"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>A 30-year-old individual with corneal changes, as shown above, known as <strong>gerontoxon</strong> or<strong> arcus lipoides</strong>, may <strong>require screening</strong> for<strong> underlying lipid disorder.</strong></p>\n<p>Arcus senilis (AS), also known as gerontoxon, arcus lipoides or arcus cornealis, is usually an age-related lipid degeneration of the peripheral cornea that forms a<strong> light grey or bluish ring.</strong>\u00a0It is the most common peripheral corneal opacity, typically benign, occurring bilaterally and prevalent among the elderly.</p>\n<p>However, when observed in individuals<strong> under 50</strong>, termed <strong>arcus juvenilis</strong>, it may indicate underlying lipid disorder and an increased risk of cardiovascular disease, warranting lipid profile screening. Unilateral cases of arcus senilis may indicate <strong>contralateral carotid artery stenosis</strong> due to decreased ophthalmic blood flow on the ipsilateral side, resulting in protection from forming arcus in the ipsilateral eye.</p>\n<p>The condition results from the leakage of lipoproteins (phospholipids and cholesterol) from limbal capillaries into the corneal stroma, initiating deposition at the superior and inferior cornea. Over time, the ring progresses circumferentially, sparing a clear corneal zone adjacent to the limbus called the <strong>interval of Vogt.</strong></p>\n<p>The following opacities and rings can resemble arcus senilis:</p>\n<ul>\n<li><strong>Kayser- Fleischer (KF) ring</strong>: A dark brown ring caused by the <strong>deposition of excess copper </strong>in <strong>Descemet's membrane</strong>, classically seen in Wilson's disease. It may also be seen in certain chronic, cholestatic liver conditions such as primary biliary cirrhosis.\u00a0</li>\n<li><strong>Limbus sign: </strong>Caused by <strong>dystrophic calcification,\u00a0</strong>seen as a \"milky precipitate\" at the corneal limbus. It can sometimes be confused with AS in the elderly population.</li>\n<li><strong>Pseudo-gerontoxon:</strong> A greyish peri-limbal band of superficial scarring adjacent to a previously inflamed segment of the limbus resembling AS, seen in vernal keratoconjunctivitis.</li>\n</ul>\n<p>The image below depicts the Kayser\u2013Fleischer ring and anterior capsule of the crystalline lens (Sunflower cataract) seen in Wilson's disease.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/2025237224b049a88dbca3340f73cc29.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/994eb1428ad147109b0bb6e68767aff7x1280x622.72.JPEG"
    ]
  },
  {
    "text": "A young male labourer presents to the casualty with severe bilateral eye pain that woke him from sleep. He reports welding the previous afternoon without a face shield and symptoms of photophobia, blurry vision, tearing, and worsening pain in bright light. Examination reveals mild conjunctival injection and diffuse punctate epithelial erosions on the cornea. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Severe retinal bleaching"
      },
      {
        "id": 2,
        "text": "Photophthalmia"
      },
      {
        "id": 3,
        "text": "Infra-red keratitis"
      },
      {
        "id": 4,
        "text": "Macular burn"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The described corneal findings, with his classic history of welding less than 12 hours prior to presentation, are suggestive of <strong>photophthalmia</strong>.\u00a0</p>\n<p>Photophthalmia<strong>\u00a0</strong>is produced due to exposure to short-wavelength <strong>ultraviolet</strong> (UV-B) rays. The <strong>cornea</strong><strong>\u00a0absorbs</strong>\u00a0the majority of\u00a0<strong>UV light</strong> (especially 311 to 290 nm). It results in desquamation of the epi\u00adthelium leading to multiple painful corneal erosions. Causes of of UV keratitis:</p>\n<div class=\"page\" title=\"Page 214\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<table style=\"height: 218.586px; width: 440px;\" width=\"547\">\n<tbody>\n<tr style=\"height: 22.3984px;\">\n<td style=\"width: 195.477px; text-align: center; height: 22.3984px;\"><strong>Artificial causes </strong></td>\n<td style=\"width: 215.93px; text-align: center; height: 22.3984px;\"><strong>\u00a0Natural causes</strong></td>\n</tr>\n<tr style=\"height: 196.188px;\">\n<td style=\"width: 195.477px; height: 196.188px;\">\n<ul>\n<li><strong>Arc welding</strong></li>\n<li>Flash from short-circuits,</li>\n<li>Damaged metal halide lamps</li>\n<li>Tanning beds</li>\n<li>UV germicidal lamps.</li>\n</ul>\n</td>\n<td style=\"width: 215.93px; height: 196.188px;\">\n<ul>\n<li>Exposure to strong solar radiation at high altitudes especially on snow-covered terrain (<strong>snow blindness</strong>)\u00a0</li>\n<li>Prolonged viewing of a solar eclipse without proper eye protection.\u00a0</li>\n</ul>\n</td>\n</tr>\n</tbody>\n</table>\n<div class=\"page\" title=\"Page 214\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>The symptoms appear characteristically after a <strong>latent period </strong>of<strong> 4- 5 hours of exposure</strong> to ultraviolet light. There is intense burning pain, foreign body sensation, and watering of the eyes. There may be associated marked photophobia and blepharospasm. On slit-lamp examination, corneal epithelium shows a breach in continuity and takes up fluorescein stain.\u00a0</p>\n<p>Management comprises cold compresses, lubricant eye drops and bandaging eyes for 24 hours with antibiotic eye ointment and cycloplegic. Avoid local surface topical anaesthesia.\u00a0<strong>Crooke\u2019s glass</strong> is a prophylactic aid consisting of a spectacle lens combined with metallic oxides to absorb ultraviolet or infrared rays and should be used by those who are prone to exposure.</p>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n<p><strong>Note</strong>: Photoretinitis and macular burns are often a result of infrared radiation.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is a method for long-term preservation of cornea?",
    "choices": [
      {
        "id": 1,
        "text": "Cryopreservation"
      },
      {
        "id": 2,
        "text": "MK medium"
      },
      {
        "id": 3,
        "text": "Moist chamber"
      },
      {
        "id": 4,
        "text": "Organ culture method"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Cryopreservation</strong>&nbsp;is used for&nbsp;<strong>long-term</strong> preservation of cornea, up to 1 year.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is the most common cause of infection following corneal transplantation in India?",
    "choices": [
      {
        "id": 1,
        "text": "Staphylococcus epidermidis"
      },
      {
        "id": 2,
        "text": "Streptococcus pyogenes"
      },
      {
        "id": 3,
        "text": "Streptococcus pneumoniae"
      },
      {
        "id": 4,
        "text": "Staphylococcus aureus"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><em><strong>Staphylococcus epidermidis</strong></em> is the most common cause of <strong>infectious keratitis</strong> after corneal transplantation in <strong>developing</strong> countries.</p>\n<p><em><strong>Pneumococcus</strong></em>\u00a0spp. and <em><strong>Staphylococcus aureus</strong></em> have been found to be the most common causes of post-corneal transplant infections in <strong>developed</strong> countries.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following techniques is the gold standard for assessing corneal thickness?",
    "choices": [
      {
        "id": 1,
        "text": "Confocal microscopy"
      },
      {
        "id": 2,
        "text": "Binocular keratometry"
      },
      {
        "id": 3,
        "text": "Ultrasound pachymetry"
      },
      {
        "id": 4,
        "text": "Corneal topography"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>\u00a0The gold standard technique for assessing corneal thickness is <strong>ultrasound pachymetry,</strong> which uses\u00a0a corneal <strong>pachymeter</strong>.</p>\n<p>Measurement of the corneal thickness (pachymetry) indirectly reflects endothelial function. The <strong>average central corneal thickness</strong> is around <strong>0.5</strong> <strong>mm</strong>, which gradually increases toward the <strong>periphery</strong> to around <strong>0.7 mm</strong>. Normally, as a <strong>diurnal variation</strong>, corneas tend to be <strong>slightly thicker</strong> just after a person awakes in the <strong>morning</strong>.</p>\n<p>Other options:\u00a0</p>\n<p>Option A: <strong>Confocal microscopy</strong> is an imaging technique that allows in vivo examination of corneal structures at high magnification and resolution. It is used to assess corneal nerve morphology and corneal endothelium.</p>\n<p>Option B:<strong> Keratometry</strong> measures the anterior corneal curvature and is traditionally performed with a manual <strong>keratometer</strong>, also known as an <strong>ophthalmometer</strong>.</p>\n<p>Option D: <strong>Corneal</strong> <strong>topography</strong> is used to assess the anterior corneal surface, its shape and thickness.\u00a0</p>\n<p>The image below shows a corneal pachymeter.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e844b063620047ea9925af27abfd8407x506x253.PNG"
    ]
  },
  {
    "text": "Your aunt recently shared that it is becoming cumbersome for her to frequently change her glasses. You suggested a referral and the rapid change in power was diagnosed to be due to keratoconus. The following image shows the results of one of the investigations done on her. What is the name of the investigation?",
    "choices": [
      {
        "id": 1,
        "text": "Pachymetry"
      },
      {
        "id": 2,
        "text": "Keratometry"
      },
      {
        "id": 3,
        "text": "Specular microscopy"
      },
      {
        "id": 4,
        "text": "Corneal topography"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The investigation shown in the image is <strong>c</strong><strong>orneal topography, </strong>and it is used for conditions like <strong>keratoconus,\u00a0</strong>as seen in this clinical scenario.</p>\n<p>Corneal topography captures the shape of the cornea by projecting concentric rings of light onto its anterior surface, forming a Placido disc pattern. the reflected light is analyzed with specialised software to create a detailed map of the corneal curvature.\u00a0</p>\n<p>Uses:</p>\n<ul>\n<li>Detection of corneal ectasia, mainly keratoconus</li>\n<li>To measure <strong>corneal thickness</strong></li>\n<li>Prior to <strong>refractive surgery</strong></li>\n<li>Sometimes prior to contact lens fitting</li>\n</ul>\n<p>The image shows a <strong>Placido</strong> or <strong>Keratoscopic disc</strong> which is used for corneal surface assessment.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/54663919188d422781ea841d0c516367.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/626b23b59bb249889010dcadcea2be85x720x459.JPEG"
    ]
  },
  {
    "text": "A 20-year-old girl with high myopia was referred by the optometrist for further evaluation. She has a history of recurrent allergic conjunctivitis and persistent eye rubbing. An image is given below. Which of the following statements are true about the given condition?",
    "choices": [
      {
        "id": 1,
        "text": "2, 4, 5"
      },
      {
        "id": 2,
        "text": "1, 3, 4"
      },
      {
        "id": 3,
        "text": "1 and 2"
      },
      {
        "id": 4,
        "text": "3 and 5"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Keratoconus</strong> is a progressive bilateral corneal ectatic disorder. &nbsp;It manifests as characteristic cone-like steepening of the cornea associated with irregular stromal thinning, resulting in a cone-like bulge (protrusion) and significant loss of vision.</p>\n<p>The pathogenesis is not fully known. Several associations have been identified, which include <strong>rigid contact lens</strong> wear, <strong>chronic eye rubbing</strong>, Down's syndrome, <strong>atopic</strong> disease, Leber's congenital amaurosis, and connective tissue disease.</p>\n<p>It is a non-inflammatory disease. With the exception of the significant loss of vision, other classic signs of inflammation are <strong>not</strong> usually present. The asymmetrical thinning and the highly irregular corneal topography often causes <strong>significant myopia</strong> and<strong> irregular astigmatism.</strong>&nbsp;</p>\n<p><strong>Corneal topography</strong> is the primary diagnostic tool for KCN&nbsp;detection.&nbsp;</p>\n<p>Whereas <strong>keratoplasty</strong>, historically has been the mainstay of treatment for keratoconus, it is now generally reserved for eyes that are unable to achieve functional vision with other surgical or non-surgical modalities&nbsp;and is only considered only as a last resort, in very advanced disease. It is the <strong>definitive</strong> treatment for keratoconus, <strong>not the treatment of choice</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/cfcb1963942c49e2b4c19a561f89dc58.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a72670d0754845faa814c5cc4a1bba86x1280x761.JPEG"
    ]
  },
  {
    "text": "Which of the following is not a treatment option in advanced keratoconus?",
    "choices": [
      {
        "id": 1,
        "text": "Toric soft contact lens"
      },
      {
        "id": 2,
        "text": "Vaulting scleral contact lens"
      },
      {
        "id": 3,
        "text": "Rigid gas permeable contact lenses"
      },
      {
        "id": 4,
        "text": "Collagen cross-linking"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Vision correction with <strong>spectacles</strong> with <strong>spherical/toric soft contact lenses</strong> is suboptimal and only applicable to the <strong>early</strong> stages of keratoconus, not in the advanced stages.</p>\n<p>Keratoconus is a progressive, non-inflammatory, bilateral corneal ectasia characterized by cone-like steepening due to irregular stromal thinning. This leads to a conical corneal protrusion, significant vision loss, myopia and irregular astigmatism.\u00a0</p>\n<p>The available options for the management of keratoconus are highly dependent on the stage of the disease and its progression. If the disease is stabilized (no progression), the emphasis is given to correcting the vision. If the disease is progressing, the emphasis is on slowing (arresting) the progression.</p>\n<p>Treatment options in moderate-to-advanced keratoconus:</p>\n<ul>\n<li><strong>Rigid gas-permeable contact lenses</strong> and <strong>vaulting scleral lenses</strong> are the mainstays of vision treatment for moderate to advanced KCN. Their main advantage is the creation of a tear pool between the lens and the cornea, which naturally neutralizes the ocular aberrations associated with keratoconus. (Option B and C)</li>\n<li><strong>Intra-corneal ring segments (INTACS)</strong>- small curved PMMA ring or set of rings that are implanted in the cornea to help flatten corneal curvature to improve vision.</li>\n<li><strong>Corneal transplantation</strong>- Deep anterior lamellar keratoplasty (DALK) and penetrating keratoplasty (PKP)</li>\n</ul>\n<p><strong>Corneal collagen cross-linking</strong> with <strong>riboflavin</strong> (CXL or C3R) and <strong>u</strong><strong>ltraviolet-A rays</strong> arrest the progression of the disease. (Option D)</p>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 40-year old male with progressive loss of vision in his left eye was diagnosed with against-the-rule astigmatism. Examination revealed peripheral corneal thinning, but there was no inflammation. Which of the following is least likely to be the cause?",
    "choices": [
      {
        "id": 1,
        "text": "Terrien's marginal degeneration"
      },
      {
        "id": 2,
        "text": "Pellucid marginal degeneration"
      },
      {
        "id": 3,
        "text": "Dellen"
      },
      {
        "id": 4,
        "text": "Peripheral ulcerative keratitis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The examination in a 40-year-old male revealed peripheral corneal thinning with no inflammation, making <strong>peripheral ulcerative keratitis</strong>, an inflammatory condition, the least likely cause.</p>\n<p><strong>Peripheral ulcerative keratitis</strong> is a <strong>destructive</strong> <strong>inflammatory</strong> disease involving the peripheral cornea. It is associated with signs and symptoms of inflammation.\u00a0The other options are causes of peripheral thinning in a quiet eye.\u00a0</p>\n<p>Other options:</p>\n<p>Options A and B: <strong>Terrien's</strong> and <strong>Pellucid marginal degeneration</strong> are <strong>noninflammatory</strong> corneal degenerations. Pellucid degeneration causes bilateral, inferior corneal thinning that leads to marked, irregular, against-the-rule astigmatism. Terrien's degeneration usually begins in the superior cornea.\u00a0</p>\n<p>Option C: <strong>Dellen</strong> is a <strong>localized</strong> <strong>thinning</strong> of the <strong>peripheral cornea</strong> associated with the <strong>drying of a focal area</strong>. Usually associated with an <strong>adjacent elevated lesion</strong> (e.g.,\u00a0<strong>pinguecula</strong> or a large subconjunctival haemorrhage) that impairs physiological lubrication.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 47-year-old woman presented with tearing, irritation, and photophobia of the left eye. On examination, a paracentral, crescent-shaped corneal melt was noted. Peripheral ulcerative keratitis (PUK) was suspected. What is the most likely cause of this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Pseudomonas aeruginosa"
      },
      {
        "id": 2,
        "text": "Staphylococcus epidermidis"
      },
      {
        "id": 3,
        "text": "Rheumatoid arthritis"
      },
      {
        "id": 4,
        "text": "Ankylosing spondylitis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Rheumatoid arthritis</strong> is commonly associated with peripheral ulcerative keratitis (PUK). It is also the <strong>most common</strong> cause.&nbsp;</p>\n<p>PUK is a group of destructive inflammatory diseases involving the peripheral cornea, characterized by the sloughing of corneal epithelium and keratolysis (corneal melting). It can lead to corneal perforation. The causes can be divided into:</p>\n<ul>\n<li>Infectious- bacterial, viral, protozoal, fungal.</li>\n<li>Non-infectious- rheumatoid arthritis, Wegener's granulomatosis, SLE, rosacea, psoriasis etc.</li>\n</ul>\n<p>Ophthalmologic manifestations of rheumatoid arthritis (due to type III and IV hypersensitivity reactions):</p>\n<ul>\n<li>dry eye</li>\n<li>scleritis</li>\n<li>stromal keratitis</li>\n<li>peripheral ulcerative keratitis</li>\n<li>paracentral keratolysis</li>\n</ul>\n<p>Treatment of PUK includes protection of the surface from drying and exposure; systemic corticosteroids and immunomodulatory; use of adjuncts such as amniotic membrane grafts to promote healing; and in some situations, tectonic keratoplasty.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 54-year-old school teacher presented with a chief complaint of pain in the eyes and intermittent blurry vision which was worse in the mornings. Generalized corneal haze was noted in both eyes but was more significant in the left. Examination findings are given below. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Lattice dystrophy"
      },
      {
        "id": 2,
        "text": "Meesmann dystrophy"
      },
      {
        "id": 3,
        "text": "Fuch\u2019s dystrophy"
      },
      {
        "id": 4,
        "text": "Reis-Buckler\u2019s dystrophy"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario along with beaten metal appearance on slit lamp and reduced endothelial cell density with coalescing guttata on specular microscopy is suggestive of <strong>Fuch's endothelial dystrophy.</strong></p>\n<p>Fuchs endothelial dystrophy is a bilateral, slowly progressive, often asymmetric corneal disease. It is characterized by deterioration of endothelial cells and development of <strong>guttata</strong>, which are excrescences of Descemet\u2019s membrane (seen on specular or confocal microscopy). <strong>Females</strong>\u00a0are affected more than males. It is more common in the <strong>4<sup>th</sup>\u00a0decade</strong> or later.\u00a0</p>\n<p>Endothelial layer dysfunction causes loss of corneal deturgescence, and bilateral oedema of the stroma, leading to ocular pain, glare, halos, and decreased visual acuity. Patients have a <strong>worse vision in the morning</strong> because of the eyes being closed during the night causing a buildup of corneal oedema.</p>\n<p>Stages of\u00a0Fuch\u2019s endothelial dystrophy:</p>\n<ul>\n<li>Stage 1: Central corneal guttata that spreads peripherally</li>\n<li>Stage 2: Corneal oedema -\u00a0<strong>beaten metal-like appearance</strong>\u00a0</li>\n<li>Stage 3: Bullous keratopathy</li>\n<li>Stage 4: Subepithelial scarring and superficial vascularization</li>\n</ul>\n<p><strong>Treatment:</strong></p>\n<ul>\n<li>Conservative option-<strong> topical hypertonic </strong>(saline sodium chloride 5% drops or 6% ointment) and <strong>bandage contact lenses.</strong></li>\n<li>The definitive treatment is <strong>endothelial keratoplasty</strong>: Descemet\u2019s stripping endothelial keratoplasty (DSEK/DSAEK) or Descemet membrane Endothelial keratoplasty (DMEK).</li>\n</ul>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/5ff0c59783744cf392e79a79550ab609.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not true about macular corneal dystrophy?",
    "choices": [
      {
        "id": 1,
        "text": "Spares the peripheral limbus"
      },
      {
        "id": 2,
        "text": "Cause profound visual impairment"
      },
      {
        "id": 3,
        "text": "Associated with mucopolysaccharidoses"
      },
      {
        "id": 4,
        "text": "Autosomal recessive"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Macular dystrophy </strong>does not spare the peripheral cornea.<strong>\u00a0</strong></p>\n<p>It\u00a0is the<strong> least common </strong>corneal dystrophy. It has an <strong>autosomal recessive</strong> inheritance. Most other corneal dystrophies are autosomal dominant. It is associated with<strong> mucopolysaccharidoses</strong> and is characterized by the deposition of <strong>glycosaminoglycans </strong>in the stroma and staining by <strong>Alcian blue. </strong>It develops in <strong>childhood </strong>and is progressive,<strong> </strong>resulting in<strong> profound visual impairment </strong>in early adult life.</p>\n<p>Clinical examination reveals superficial whitish fleck-like opacities. These opacities <strong>extend peripherally to the limbus</strong> and the deep stroma down to Descemet\u2019s membrane. The intervening corneal stroma develops a progressive and diffuse haze.\u00a0</p>\n<p><strong>Note:</strong></p>\n<ul>\n<li>Most common dystrophy overall-\u00a0Microcystic/fingerprint/map-dot dystrophy</li>\n<li>Most common stromal dystrophy-\u00a0Lattice dystrophy</li>\n<li>Dystrophy with corectopia-\u00a0Posterior polymorphous dystrophy</li>\n<li>Autosomal recessive dystrophy- Macular\u00a0dystrophy</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following stains is used in identifying granular dystrophy of the cornea?",
    "choices": [
      {
        "id": 1,
        "text": "Congo-red"
      },
      {
        "id": 2,
        "text": "Periodic acid Schiff"
      },
      {
        "id": 3,
        "text": "Alcian blue"
      },
      {
        "id": 4,
        "text": "Masson's trichrome"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Masson trichrome</strong>\u00a0stains stromal hyaline deposits in granular dystrophy of the cornea.</p>\n<p>Granular corneal dystrophy belongs to the <strong>stromal dystrophy</strong> of the cornea. It is of <strong>autosomal dominant </strong>inheritance and is caused by a defect in the TGFB1 gene.</p>\n<p>Granular corneal dystrophy is characterized by <strong>milky, granular, hyaline deposits </strong>in the anterior stroma, which may coalesce into irregular shapes. The peripheral cornea and the area between the opacities/deposits remain clear. Early symptoms may involve light sensitivity, glare, ocular discomfort, pain, and watering. As opacification progresses with age, visual acuity decreases.</p>\n<p>The following image shows numerous irregularly shaped discrete crumb-like corneal opacities of Granular dystrophy, which stain <strong>bright red</strong> with Masson trichrome.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f571ce4e19924568b1ca2ecb38681c72x500x500.JPEG"
    ]
  },
  {
    "text": "Which of the following is implicated in the pathogenesis of oil-droplet keratopathy?",
    "choices": [
      {
        "id": 1,
        "text": "Deposition of lipid in the anterior stroma"
      },
      {
        "id": 2,
        "text": "Exposure to UV rays"
      },
      {
        "id": 3,
        "text": "Lagophthalmos"
      },
      {
        "id": 4,
        "text": "Trigeminal nerve palsy"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Other options:\u00a0</p>\n<p>Option A:<strong> Lipid keratopathy</strong> involves the accumulation of whitish or yellow fat deposits, mainly cholesterol and fatty acids, which begin intracellularly and later move extracellularly due to necrosis of corneal stromal cells. It can be primary (rare, in the cornea free of vascularization) or secondary (common, in the vascularized cornea).</p>\n<p>Option C: <strong>Exposure keratopathy</strong> results from lagophthalmos (incomplete eyelid closure), causing corneal dryness despite normal tear production. Causes include neuroparalytic conditions (like facial nerve palsy), reduced muscle tone in Parkinsonism, lid scarring, post-blepharoplasty and proptosis.\u00a0</p>\n<p>Option D: <strong>Neurotrophic keratopathy</strong> results from loss of trigeminal nerve innervation to the cornea, affecting both sensation and healing. This disruption can cause corneal dryness, ulceration, exfoliation, and edema. It is commonly linked to conditions such as trigeminal ganglion surgical ablation for neuralgia, stroke, diabetes, herpes simplex and herpes zoster keratitis.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://cdn1.dailyrounds.org/uploads/e5d52393d728406cbc159d44f04c7153x433x270.PNG"
    ]
  },
  {
    "text": "Which of the following statements regarding intracorneal ring segment (ICRS) implantation is false?",
    "choices": [
      {
        "id": 1,
        "text": "The procedure is reversible."
      },
      {
        "id": 2,
        "text": "It is used in the management of keratoconus."
      },
      {
        "id": 3,
        "text": "Corneal perforation is a very common complication."
      },
      {
        "id": 4,
        "text": "It is made of polymethyl methacrylate."
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Corneal perforation may occur but is quite <strong>rare </strong>in intracorneal ring segment (ICRS) implantation.</p>\n<p>Salient points on ICRS:</p>\n<ul>\n<li>These segments are made of <strong>polymethyl methacrylate </strong>(PMMA) and are implanted into the mid-peripheral corneal stroma.</li>\n<li>These are used in the management of <strong>keratoconus</strong> and low myopia.</li>\n<li>Improvement in visual acuity and refraction after ICRS implantation is accomplished by a shortening of collagen lamellae along the arc length of the ring. There is a redistribution of corneal stress due to a change in the curvature of the cornea after implantation of the ICRS.</li>\n<li><strong>Decreased corneal sensation</strong> can be a postoperative complication.</li>\n<li>More than 90% of<strong> patients have &lt;1 D change</strong> in refraction at 1-year postoperative follow-up.</li>\n</ul>\n<p>\u00a0The image shows the intrastromal corneal ring segment.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9d980bbd5403415da1907918344de9f1x754x629.PNG"
    ]
  },
  {
    "text": "A 29-year-old woman with normal visual acuity undergoes a routine eye exam. Slit-lamp examination reveals numerous crumb-like centrally dense deposits in the anterior corneal stroma, bilaterally symmetrical, with clear intervening stroma. Which of the following statements is likely to be true?",
    "choices": [
      {
        "id": 1,
        "text": "Histopathology specimen will stain positive with alcian blue"
      },
      {
        "id": 2,
        "text": "Histopathologic review will reveal amyloid deposits on congo red staining"
      },
      {
        "id": 3,
        "text": "Histopathologic review will reveal hyaline deposits on the Masson trichrome stain"
      },
      {
        "id": 4,
        "text": "Endothelium will show \u201cbeaten metal\u201d appearance"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario, with the given image showing multiple breadcrumb-like deposits, is suggestive of <strong>granular corneal dystrophy, </strong>where<strong> </strong>histopathology reveals <strong>hyaline deposits on the Masson trichrome stain.</strong></p>\n<p>Granular corneal dystrophy belongs to the <strong>stromal dystrophy</strong> of the cornea. It is of autosomal dominant inheritance and is caused by a defect in the TGFB1 gene.</p>\n<p>In granular corneal dystrophy, opacities form due to the abnormal accumulation of hyaline protein, assuming a discrete granular form and subsequently coalescing into various irregular shapes. The cornea between the opacities and the peripheral cornea remains clear. The condition is characterised by <strong>milky granular hyaline deposits </strong>in the anterior stroma.</p>\n<p>In many patients, no symptoms occur, whereas some patients develop recurrent erosions. In the fifth decade or later, some patients develop sufficient visual difficulties to require keratoplasty. Treatment is usually keratoplasty for severe visual handicaps.</p>\n<p>Note: The beaten metal appearance on the slit lamp and reduced endothelial cell density with coalescing guttata on specular microscopy is suggestive of <strong>Fuch's endothelial dystrophy.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://daily-rounds-staging.s3.amazonaws.com/uploads/a37b75f744ac4264bb5a58c8c4a8c737.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 6-month-old infant is brought with a history of diffuse, ground glass-like corneal haze in both eyes. The corneas are thickened with normal diameters and associated nystagmus. Which one of the following statements is true regarding this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Intraocular pressure (IOP) is likely to be elevated."
      },
      {
        "id": 2,
        "text": "The corneal stroma shows abnormal deposits that stain with amyloid."
      },
      {
        "id": 3,
        "text": "It could be a bilateral choristoma."
      },
      {
        "id": 4,
        "text": "Descemet\u2019s membrane may be thickened due to an abnormal endothelium."
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical scenario most likely suggest <strong>congenital hereditary endothelial dystrophy</strong> (CHED), where <strong>Descemet\u2019s membrane</strong> is abnormally <strong>thickened</strong>.\u00a0</p>\n<p>CHED is a rare disorder characterized by focal or diffuse thickening of the Descemet membrane and endothelial degeneration. The key features of this condition include <strong>corneal thickness, which is two to three times</strong> the normal, <strong>normal intraocular pressure</strong> (IOP) and <strong>normal</strong> <strong>corneal diameter</strong>. Associated features are corneal pannus, <strong>nystagmus</strong>, and esotropia.</p>\n<p>Treatment usually involves corneal transplantation (lamellar or penetrating keratoplasty) for visual rehabilitation.</p>\n<p>Other options:</p>\n<p>Option A: As the corneal diameters are normal, and there are no typical symptoms, congenital glaucoma is ruled out.</p>\n<p>Option B: Amyloid deposits in the corneal stroma are seen in Lattice stromal dystrophy.</p>\n<p>Option C: Choristomas are congenital lesions representing normal tissue(s) in an abnormal location. They are the most common epibulbar and orbital tumors in children. It usually arises at the limbus of the eye and may include dermoid tissue, lipodermoid or other tissues.</p>\n<p>Note: The combination of congenital endothelial dystrophy and progressive neural deafness, is known as <strong>Harboyan syndrome</strong>. This disorder must be distinguished from another autosomal recessive disorder,<strong> congenital endothelial dystrophy</strong>, in which deafness does not occur.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is true about Mooren's ulcer?",
    "choices": [
      {
        "id": 1,
        "text": "Painless superficial ulcer that can perforate"
      },
      {
        "id": 2,
        "text": "Associated with autoimmune and rheumatological conditions"
      },
      {
        "id": 3,
        "text": "Characterized by a steep, overhanging edge"
      },
      {
        "id": 4,
        "text": "Ulcerative process begins centrally and then moves circumferentially"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Moorens\u2019s ulcer/ulcus roden\u00a0</strong>is characterized by a<strong> steep, overhanging edge.</strong></p>\n<p>It is described as a <strong>chronic serpiginous ulcer of the cornea.</strong>\u00a0It is a subtype of peripheral ulcerative keratitis (PUK). It is defined as an\u00a0<strong>idiopathic</strong> condition without associated systemic or rheumatological conditions and hence is a diagnosis of exclusion.\u00a0The pathophysiology is thought to be due to autoimmune.</p>\n<p>Clinical features include redness, tearing, and photophobia, but <strong>pain</strong> is typically the outstanding feature. The pain often is incapacitating and may well be out of proportion to the inflammation. There may also be a complaint of decreased visual acuity, which may be secondary to associated iritis or central corneal involvement.\u00a0</p>\n<p>Initially, the ulcerative process<strong>\u00a0spreads circumferentially. </strong>Later, it moves<strong>\u00a0centrally</strong> to involve the entire cornea. In contrast to other forms of PUK, the\u00a0<strong>limbus\u00a0</strong>is involved. The end-stage result is typically a <strong>scarred, vascularized cornea </strong>that may be<strong> thinned</strong> to less than half of its original thickness.\u00a0</p>\n<p>Treatment involves corticosteroids and excision of a strip of adjacent conjunctiva, which eliminates the conjunctival sources of collagenase and proteoglycanase.\u00a0\u00a0</p>\n<p>The image shows a perforated Mooren's ulcer.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/82d2bac6ec7a4e308fe82b412d80e266x455x438.PNG"
    ]
  },
  {
    "text": "Which layer of the cornea is affected in Reis\u2013Buckler dystrophy?",
    "choices": [
      {
        "id": 1,
        "text": "Epithelium"
      },
      {
        "id": 2,
        "text": "Stroma"
      },
      {
        "id": 3,
        "text": "Bowman\u2019s membrane"
      },
      {
        "id": 4,
        "text": "Endothelium"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The corneal layer involved in Reis\u2013Buckler dystrophy is\u00a0<strong>Bowman\u2019s membrane</strong>.</p>\n<p><strong>Corneal dystrophies</strong> are primarily a\u00a0<strong>bilateral</strong>, inherited, <strong>non-inflammatory</strong> condition specific to the cornea.</p>\n<p>Reis\u2013Buckler dystrophy, an <strong>autosomal dominant disorder,</strong> is an anterior variant of granular stromal dystrophy, characterised by the replacement of the Bowman layer with connective tissue bands, primarily affecting the Bowman layer and superficial stroma. Several recurrent corneal erosions may occur in childhood along with visual impairment.\u00a0</p>\n<p>In this condition, there are <strong>grey-white, geographic subepithelial opacities </strong>(that are most dense centrally and increase over time, eventually forming a reticular pattern. Additionally, corneal sensation is reduced as the disease progresses.\u00a0</p>\n<p>The image below shows Reis\u2013buckler corneal dystrophy on slit-lamp examination:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6319332561284fdab6d8176abb663065x301x300.PNG"
    ]
  }
];
        let quizName = '08 Non-Infectious Disorders Of Cornea';
        let hierarchy = ["Marrow", "qBank", "Ophthalmology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>