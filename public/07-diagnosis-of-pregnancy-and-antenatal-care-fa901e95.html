<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>07 Diagnosis Of Pregnancy And Antenatal Care - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Obstetrics & Gynecology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">21</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "What is the duration of the 4th trimester in pregnancy?",
    "choices": [
      {
        "id": 1,
        "text": "6 weeks postpartum"
      },
      {
        "id": 2,
        "text": "12 weeks postpartum"
      },
      {
        "id": 3,
        "text": "4 weeks postpartum"
      },
      {
        "id": 4,
        "text": "38 to 40 weeks of pregnancy"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The duration of the fourth trimester is <strong>12 weeks postpartum</strong>.</p>\n<p><br />The concept of fourth trimester was introduced to address common concerns raised by women in puerperium such as <strong>post-partum pain, breastfeeding related problems, stress</strong> and <strong>postpartum depression, </strong>and<strong> lack of awareness</strong> <strong>of newborn care</strong>.&nbsp;The components of postpartum care for the 4th trimester include:&nbsp;</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Dedicated care team</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Lactation support</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Infant feeding plan</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Reproductive life plan</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Contraception</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Addressing complications of pregnancy&nbsp;</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Assessment of cardiovascular risk</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Mental health assessment&nbsp;</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Chronic health conditions</li>\n</ul>\n<p><br />ACOG recommendation for postpartum visits:&nbsp;</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Initial visit:&nbsp;<strong>3 weeks postpartum</strong></li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Final visit: <strong>12 weeks postpartum</strong></li>\n</ul>\n<p><br />Government of India recommendation for postpartum visits.</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">First visit: <strong>1st day </strong>after delivery&nbsp;</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Second visit: <strong>3rd day </strong>after delivery&nbsp;</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Third visit: <strong>7th day </strong>after delivery</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Fourth visit: <strong>6 weeks </strong>after delivery</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the ideal number of antenatal visits?",
    "choices": [
      {
        "id": 1,
        "text": "12-14"
      },
      {
        "id": 2,
        "text": "6-8"
      },
      {
        "id": 3,
        "text": "7-9"
      },
      {
        "id": 4,
        "text": "10-11"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The ideal number of antenatal visits is <strong>12-14</strong>.</p>\n<p>The antenatal visits should ideally be: <strong>monthly once</strong> up to <strong>28</strong> weeks, <strong>once</strong> in <strong>two</strong> weeks&nbsp;between <strong>28-36</strong> weeks, and <strong>once weekly</strong> visits from <strong>36 weeks</strong> onwards.</p>\n<p>This translates to a total of <strong>12-15 visits</strong>.</p>\n<p>The&nbsp;<strong>WHO</strong>&nbsp;increased the&nbsp;<strong>minimum</strong> number of antenatal visits from 4 to&nbsp;<strong>8</strong>&nbsp;visits&nbsp;to reduce perinatal mortality.</p>\n<p>In the <strong>Indian scenario</strong>, the earlier minimum of 4 visits were implemented as follows:</p>\n<ul>\n<li>1st&nbsp;visit: within 12 weeks (preferably as soon as pregnancy is suspected)</li>\n<li>2nd&nbsp;visit: between 14-26 weeks</li>\n<li>3rd&nbsp;visit: between 28-34 weeks</li>\n<li>4th&nbsp;visit: between 36 weeks and term</li>\n</ul>\n<p>A <strong>booked case</strong> is one that has <strong>at least</strong> <strong>3 antenatal visits</strong> with two visits in the third trimester.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is not true about parity?",
    "choices": [
      {
        "id": 1,
        "text": "Parity refers to the number of previous pregnancies reaching viability"
      },
      {
        "id": 2,
        "text": "If a woman has twins, the parity remains one"
      },
      {
        "id": 3,
        "text": "If a woman has a stillborn child, her parity decreases"
      },
      {
        "id": 4,
        "text": "Multipara is a woman who has completed 2 or more pregnancies past the period of viability"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>If a female has stillbirth, her parity does not decrease.\u00a0</p>\n<p><strong>Parity </strong>is determined by the<strong> number of previous pregnancies </strong>reaching a period of<strong> viability</strong>,\u00a0which is 28 weeks in India.\u00a0</p>\n<p><strong>Multifetal</strong> pregnancies, such as twins or triplets,<strong> count as one</strong>\u00a0for the purpose of this notation.\u00a0The<strong> current pregnancy</strong>\u00a0is<strong>\u00a0not included </strong>in this count.</p>\n<p><strong>Multipara</strong> refers to a woman who has completed <strong>two</strong> <strong>or more</strong> pregnancies past the period of <strong>viability</strong>.\u00a0When the pregnancy is preceded by<strong> five </strong>or more previous viable pregnancies, the woman is called a <strong>grand multipara</strong>.</p>\n<p>Note: <strong>Gravida</strong>\u00a0indicates the <strong>number of times</strong> the mother has been <strong>pregnant</strong>, regardless of whether these pregnancies were carried to term. The<strong>\u00a0current pregnancy</strong>\u00a0is<strong> included </strong>in this count.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 30-year-old woman came to the OPD with a twin pregnancy at 10 weeks of gestation. She has a 3-year-old female child who was born at term and had 2 first trimester abortions previously. Which of the following is the correct representation of her obstetric score.",
    "choices": [
      {
        "id": 1,
        "text": "G4 P2 L1 A2"
      },
      {
        "id": 2,
        "text": "G4 P1 A2 L1"
      },
      {
        "id": 3,
        "text": "G5 P0 L1 A2"
      },
      {
        "id": 4,
        "text": "G5 P1 A2 L1"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The obstetric score is G4 P1 A2 L1.\u00a0</p>\n<p>The obstetric score is used to summarise the past obstetric history as follows:</p>\n<ul>\n<li>G -\u00a0<strong>Gravidity,\u00a0</strong>denoting the <strong>total</strong> number of <strong>pregnancies</strong>, including the present one</li>\n<li>P -\u00a0<strong>Parity,</strong><strong>\u00a0</strong>denoting the total number of <strong>pregnancies</strong> crossing the period of <strong>viability</strong>\u00a0\n<ul>\n<li>This includes both live births and stillbirths</li>\n<li>The current pregnancy is not included</li>\n</ul>\n</li>\n<li>A - Abortus or the number of pregnancies that were lost for any reason, including induced abortions or miscarriages.</li>\n<li>L - Living children</li>\n</ul>\n<p><strong>Multifetal</strong>\u00a0pregnancies<strong>\u00a0count as one </strong>for both gravida and para.\u00a0A pregnant woman who delivers twins will be expressed as primipara.</p>\n<p>The GTPAL system includes the following:</p>\n<ul>\n<li>Gravida</li>\n<li>Term (&gt;37 weeks)</li>\n<li>Preterm (20w - 36w 6d)</li>\n<li>Abortions (&lt;20 weeks)</li>\n<li>Number of living children</li>\n</ul>\n<p>Note: The<strong> period of viability</strong> is when the fetus is capable of independent existence. The <strong>WHO</strong> defines it to be <strong>24 weeks</strong> while the <strong>Indian</strong> definition is <strong>28 weeks</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A lady who is 38 weeks pregnant comes to the OPD for a routine checkup. She has a history of normal twin delivery at term 4 years ago. What is her gravida and para score?",
    "choices": [
      {
        "id": 1,
        "text": "G2P2"
      },
      {
        "id": 2,
        "text": "G2P1"
      },
      {
        "id": 3,
        "text": "G3P2"
      },
      {
        "id": 4,
        "text": "G3P1"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The woman has had <strong>two pregnancies in total</strong> - the previous twin pregnancy and the current pregnancy, hence the <strong>gravida score is 2</strong>. The <strong>first pregnancy</strong> resulted in delivery at <strong>term</strong> (crossed viable period), hence her <strong>para score is 1</strong> (parity <strong>doesn't include current pregnancy</strong>).&nbsp; Hence, her obstetric score would be <strong>G2P1</strong> (Gravida - 2, Para - 1).&nbsp;</p>\n<p><strong>Multifetal&nbsp;pregnancies</strong>&nbsp;<strong>count as one</strong>&nbsp;for both gravida and para.&nbsp;A pregnant woman who delivers twins for the first time is expressed as primipara.</p>\n<p>The obstetric score is used to summarise the past obstetric history as follows:</p>\n<ul>\n<li>G -&nbsp;<strong>Gravidity</strong>,&nbsp;denoting the&nbsp;<strong>total</strong>&nbsp;number of&nbsp;<strong>pregnancies</strong>, including the present one</li>\n<li>P -&nbsp;<strong>Parity</strong>,<strong>&nbsp;</strong>denoting the total number of&nbsp;<strong>pregnancies</strong>&nbsp;crossing the period of&nbsp;<strong>viability</strong>.&nbsp;This includes both live births and stillbirths. The current pregnancy is not included.&nbsp;</li>\n<li>A -&nbsp;Abortion is the termination of pregnancy, either spontaneous or induced, <strong>before fetal viability</strong>.</li>\n<li>L - <strong>Living children.</strong></li>\n</ul>\n<p>The <strong>GTPAL</strong> system includes the following:</p>\n<ul>\n<li><strong>G</strong>ravida</li>\n<li><strong>T</strong>erm (&gt;37 weeks)</li>\n<li><strong>P</strong>reterm (20w - 36w 6d)</li>\n<li><strong>A</strong>bortions (&lt;20 weeks)</li>\n<li>Number of <strong>l</strong>iving children</li>\n</ul>\n<p>Note: The period of <strong>viability</strong> is when the fetus is capable of independent existence. The <strong>WHO</strong> defines it to be <strong>24 weeks</strong> while the <strong>Indian</strong> definition is <strong>28 weeks</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A woman whose obstetric score is G2 P1 L1 had an LMP of Jan 9th 2017. Calculate the EDD according to Naegele\u2019s rule.",
    "choices": [
      {
        "id": 1,
        "text": "September 19"
      },
      {
        "id": 2,
        "text": "October 19"
      },
      {
        "id": 3,
        "text": "October 16"
      },
      {
        "id": 4,
        "text": "September 16"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>As per Naegele&rsquo;s rule, the EDD&nbsp;(expected date of delivery) of this woman is<strong>&nbsp;October 16</strong>, 2017.</p>\n<p><strong>Naegele&rsquo;s rule</strong>&nbsp;states that EDD is obtained by <strong>adding</strong> <strong>7 days </strong>and<strong> subtracting 3 months </strong>from the LMP (the 1st day of the last menstrual period).&nbsp;Another method is adding&nbsp;9 months and 7 days&nbsp;to&nbsp;LMP.&nbsp;Less than 5% of births follow Naegele's rule.&nbsp;</p>\n<p>It is based on a 28-day regular cycle. If the cycle is shorter/longer than 28 days, <strong>corrected EDD</strong> is calculated as follows:</p>\n<ul>\n<li>For a 35-day cycle, add another 7 (35-28=7) days to the calculated EDD to get the corrected EDD.</li>\n<li>For a 25-day cycle, subtract 3 (28-25=3) days from the calculated EDD to get the corrected EDD.</li>\n</ul>\n<p>Naegele&rsquo;s rule cannot be followed in IVF pregnancies. Considering the human embryo takes 266 days to develop, <strong>EDD is calculated in IVF pregnancies</strong> by the following method:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Same day as fertilization (day 0)</strong>: EDD = date of transfer + 266 days&nbsp;</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>3 days after fertilization (day 3)</strong>: EDD = date of transfer + 263 days</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>5 days after fertilization (day 5)</strong>: EDD = date of transfer + 261 days</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The recommended calorie intake for a pregnant woman in the second trimester, who is a sedentary worker would increase by _______.",
    "choices": [
      {
        "id": 1,
        "text": "600 kcal/day"
      },
      {
        "id": 2,
        "text": "520 kcal/day"
      },
      {
        "id": 3,
        "text": "450 kcal/day"
      },
      {
        "id": 4,
        "text": "350 kcal/day"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The recommended calorie intake for a pregnant woman in the second trimester would increase by ~&nbsp;<strong>350 kcal/day</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A pregnant lady of 49 kg is in her first trimester. What are her additional calorie requirements in this trimester?",
    "choices": [
      {
        "id": 1,
        "text": "500"
      },
      {
        "id": 2,
        "text": "300"
      },
      {
        "id": 3,
        "text": "Continue same diet"
      },
      {
        "id": 4,
        "text": "600"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The pregnant lady can <strong>continue the same diet</strong>&nbsp;since&nbsp;there are no additional calorie requirements in the <strong>first trimester.</strong></p>\n<p>Pregnancy requires an additional 80,000 kcal, mostly during the last 20 weeks. To meet this demand, a caloric increase of 100 to 300 kcal/d is recommended&nbsp;during pregnancy. This greater intake, however, should not be divided equally during the course of pregnancy. The Institute of Medicine (2006) recommends adding <strong>0, 340, and 452 kcal/d</strong> to the estimated nonpregnant energy requirements in the<strong> first, second, and third trimesters</strong>&nbsp;respectively.&nbsp;</p>\n<p>Whenever caloric intake is inadequate, protein is metabolized rather than being spared for its vital role in fetal growth and development.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 22-year-old pregnant woman at 13 weeks of gestation informs you about accidental exposure to radiation from a chest X-ray at 7 weeks of gestation. What should be the next step advised to her?",
    "choices": [
      {
        "id": 1,
        "text": "Continue pregnancy"
      },
      {
        "id": 2,
        "text": "Terminate pregancy"
      },
      {
        "id": 3,
        "text": "Pre-invasive diagnostic test"
      },
      {
        "id": 4,
        "text": "Chromosome screening"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p class=\"p1\">In the given clinical case, the patient should be advised to <strong>continue the pregnancy</strong>.</p>\n<p class=\"p1\">The radiation dose to the fetus during the declared term of pregnancy should be <strong>less than 1 mSv</strong>.&nbsp;In <strong>chest X-ray</strong> PA view, the absorbed dose of radiation by the fetus is less than 0.1 mSv. Hence, pregnancy can be continued.</p>\n<p class=\"p1\">An X-ray has a very limited role in obstetric imaging. There are very few indications where an X-ray will be useful:&nbsp;</p>\n<ul>\n<li class=\"p1\">Fetal: congenital malformation of the fetus and neonates, skeletal malformations, birth injuries like fractures or dislocations.</li>\n<li class=\"p1\">Maternal:&nbsp; Patients having cardiopulmonary disease may require an X-ray chest during pregnancy and that should be done beyond 12 weeks.&nbsp;</li>\n</ul>\n<p>Radiation can cause fetal morbidity (FGR, genetic mutations, neurologic abnormalities, mental retardation, childhood leukemia) and mortality. The risks are high with radiation after the first 2 weeks postconception and within the first trimester (period of organogenesis).</p>\n<p>Radiation during pregnancy can damage the early phase of the embryo but the risk can be minimized by using the <strong>&lsquo;10-day rule&rsquo;.</strong> This rule states that no woman should be exposed to an X-ray for a nonurgent indication outside 10 days from her last period during the reproductive period unless the pregnancy is excluded.&nbsp;</p>\n<p>The given table below shows the absorbed radiation by the fetus in different diagnostic radiation procedures:</p>\n<p><strong>1 cGy = 10 mSv</strong></p>\n<table style=\"height: 345.977px; width: 29.9456%;\">\n<tbody>\n<tr style=\"height: 22.3984px;\">\n<td style=\"width: 57.5688%; height: 22.3984px;\"><strong>Procedure&nbsp;</strong></td>\n<td style=\"width: 33.7667%; height: 22.3984px;\"><strong>Dose (cGy)</strong></td>\n</tr>\n<tr style=\"height: 44.7969px;\">\n<td style=\"width: 57.5688%; height: 44.7969px;\"><br />Abdominal X-ray</td>\n<td style=\"width: 33.7667%; height: 44.7969px;\">0.1-0.3</td>\n</tr>\n<tr style=\"height: 44.7969px;\">\n<td style=\"width: 57.5688%; height: 44.7969px;\"><br />Pelvic X-ray</td>\n<td style=\"width: 33.7667%; height: 44.7969px;\">0.5-1.1</td>\n</tr>\n<tr style=\"height: 44.7969px;\">\n<td style=\"width: 57.5688%; height: 44.7969px;\"><br />Chest X-ray&nbsp;</td>\n<td style=\"width: 33.7667%; height: 44.7969px;\">&lt;0.001</td>\n</tr>\n<tr style=\"height: 44.7969px;\">\n<td style=\"width: 57.5688%; height: 44.7969px;\"><br />Abdominal CT&nbsp;</td>\n<td style=\"width: 33.7667%; height: 44.7969px;\">0.4-0.8</td>\n</tr>\n<tr style=\"height: 44.7969px;\">\n<td style=\"width: 57.5688%; height: 44.7969px;\"><br />Chest CT</td>\n<td style=\"width: 33.7667%; height: 44.7969px;\">0.002-0.02</td>\n</tr>\n<tr style=\"height: 44.7969px;\">\n<td style=\"width: 57.5688%; height: 44.7969px;\"><br />Abdominopelvic CT</td>\n<td style=\"width: 33.7667%; height: 44.7969px;\">2.5-3.5</td>\n</tr>\n<tr style=\"height: 44.7969px;\">\n<td style=\"width: 57.5688%; height: 44.7969px;\"><br />Ventilation scan</td>\n<td style=\"width: 33.7667%; height: 44.7969px;\">0.007-0.05</td>\n</tr>\n<tr style=\"height: 10px;\">\n<td style=\"width: 57.5688%; height: 10px;\"><br />PET scan</td>\n<td style=\"width: 33.7667%; height: 10px;\">1-1.5</td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;</p>\n<p>&nbsp;</p>\n<p>&nbsp;</p>\n<p class=\"p1\">&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You notice an obstetrics resident performing the following manoeuvres on a 37-week primigravida. Choose the correctly matched set.",
    "choices": [
      {
        "id": 1,
        "text": "1-a, 2-c, 3-b, 4-d"
      },
      {
        "id": 2,
        "text": "1-a, 2-b, 3-c, 4-d"
      },
      {
        "id": 3,
        "text": "1-b, 2-a, 3-d, 4-c"
      },
      {
        "id": 4,
        "text": "1-c, 2-b, 3-a, 4-d"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Fetal pole, lie, presenting part, engagement, and attitude of fetal head are assessed by&nbsp;<strong>Leopold's manoeuvres:</strong></p>\n<ol>\n<li><strong>Fundal grip&nbsp;</strong>(first Leopold):\n<ul>\n<li>Assesses the uterine&nbsp;<strong>fundus</strong>.</li>\n<li>Helps in identification of&nbsp;<strong>fetal lie</strong>&nbsp;and determination of <strong>fetal pole</strong> at the <strong>fundus</strong>.</li>\n<li>The<strong>&nbsp;</strong>breech<strong>&nbsp;</strong>gives the sensation of a<strong>&nbsp;</strong>large, irregular mass.&nbsp;</li>\n<li>The<strong>&nbsp;</strong>head<strong>&nbsp;</strong>feels<strong>&nbsp;</strong>hard and round<strong>&nbsp;</strong>and is<strong>&nbsp;</strong>more mobile.<strong><br /><br /></strong></li>\n</ul>\n</li>\n<li><strong>Lateral grip&nbsp;</strong>(second Leopold):&nbsp;\n<ul>\n<li>Assesses the fetal<strong>&nbsp;orientation</strong>.</li>\n<li>The palms are placed on either side of the maternal abdomen, and gentle but deep pressure is exerted.</li>\n<li>The&nbsp;<strong>back</strong>&nbsp;is felt on one side as a&nbsp;<strong>hard</strong>, resistant structure.</li>\n<li>The&nbsp;<strong>fetal extremities</strong>&nbsp;are felt on the other side as&nbsp;<strong>numerous</strong>&nbsp;small, irregular,&nbsp;<strong>mobile parts</strong>&nbsp;are felt.</li>\n<li>Fetal orientation can be determined by noting whether the back is directed anteriorly, transversely, or posteriorly.</li>\n<li>The&nbsp;<strong>position&nbsp;</strong>of the<strong>&nbsp;anterior shoulder</strong>&nbsp;is mainly assessed by this grip.<br /><br /></li>\n</ul>\n</li>\n<li><strong>Pawlik's grip&nbsp;</strong>/ 1st pelvic grip (third Leopold):\n<ul>\n<li>Assesses the&nbsp;<strong>presenting</strong>&nbsp;<strong>part</strong>&nbsp;in respect to the true pelvis.</li>\n<li>The thumb and fingers of one hand grasp the lower portion of the maternal abdomen just above the symphysis pubis.</li>\n<li>If the presenting part is not engaged, a movable mass will be felt,&nbsp;usually the head.<br /><br /></li>\n</ul>\n</li>\n<li><strong>Deep pelvic grip&nbsp;</strong>/ 2nd pelvic grip (fourth Leopold):\n<ul>\n<li>Assesses the&nbsp;<strong>engagement,</strong>&nbsp;attitude of the fetal head and determine the <strong>degree of descent</strong>.</li>\n<li>The examiner faces the mother's feet, and the fingertips of both hands are positioned on either side of the presenting part.</li>\n<li>They exert inward pressure and then slide along the axis of the pelvic inlet.</li>\n<li>If the head has already descended into the pelvis, the anterior shoulder or the space created by the neck may be differentiated readily from the head.</li>\n<li>It is the only grip performed&nbsp;<strong>facing</strong> the <strong>feet</strong>.</li>\n</ul>\n</li>\n</ol>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b885e649fff04f0bbadb36456c9baf42.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e215ce79339c433da605c48ea10b4cc7x600x3241.JPEG"
    ]
  },
  {
    "text": "A dusky hue of the vestibule and anterior vaginal wall visible at about 8 weeks of pregnancy is called _____.",
    "choices": [
      {
        "id": 1,
        "text": "Hegar's sign"
      },
      {
        "id": 2,
        "text": "Chadwick's sign"
      },
      {
        "id": 3,
        "text": "Osiander's sign"
      },
      {
        "id": 4,
        "text": "Palmer's sign"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>A <strong>dusky hue</strong> of the <strong>vestibule and anterior vaginal wall</strong>&nbsp;visible at about 8th week of pregnancy is called <strong>Chadwick&rsquo;s sign</strong> or <strong>Jacquemier&rsquo;s sign</strong>. The discoloration is due to local vascular congestion.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A primigravida comes for a routine ANC visit at 22 weeks of gestation. Which of the following signs would you not expect?",
    "choices": [
      {
        "id": 1,
        "text": "Chloasma"
      },
      {
        "id": 2,
        "text": "Quickening"
      },
      {
        "id": 3,
        "text": "Lightening"
      },
      {
        "id": 4,
        "text": "Braxton Hick's contraction"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Lightening</strong>&nbsp;is felt in the <strong>3rd trimester</strong> (38th week) in a primigravida. It is a sense of relief from the pressure symptoms due to engagement of the presenting part.</p>\n<p>The <strong>2nd trimester</strong> of pregnancy is characterised by the following:&nbsp;</p>\n<table style=\"width: 729px;\">\n<tbody>\n<tr>\n<td style=\"width: 207px;\">\n<p><strong>Sign</strong></p>\n</td>\n<td style=\"width: 280px;\">\n<p><strong>Feature</strong></p>\n</td>\n<td style=\"width: 236px;\">\n<p><strong>Seen at</strong></p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 207px;\">\n<p>Chloasma</p>\n</td>\n<td style=\"width: 280px;\">\n<p>Pigmentation over forehead and cheeks</p>\n</td>\n<td style=\"width: 236px;\">\n<p>24 weeks</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 207px;\">\n<p>Breast changes</p>\n</td>\n<td style=\"width: 280px;\">\n<p>Appearance of secondary areola.</p>\n</td>\n<td style=\"width: 236px;\">\n<p>20 weeks</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 207px;\">\n<p>Uterine changes- size and Braxton Hick contractions</p>\n</td>\n<td style=\"width: 280px;\">\n<p>Irregular, infrequent spasmodic and painless contractions without any effect on dilatation of cervix.</p>\n</td>\n<td style=\"width: 236px;\">\n<p>Begin in early pregnancy and continue till term</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 207px;\">\n<p>Palpation of fetal parts and active fetal movements</p>\n</td>\n<td style=\"width: 280px;\">&nbsp;</td>\n<td style=\"width: 236px;\">\n<p>20 weeks</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 207px;\">\n<p>Ballotment of uterus</p>\n</td>\n<td style=\"width: 280px;\">\n<p>Feeling of floating object inside uterus on bimanual examination. Not exclusive to pregancy</p>\n</td>\n<td style=\"width: 236px;\">\n<p>16 to 20 weeks</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 207px;\">\n<p>Auscultation of fetal heart sounds</p>\n</td>\n<td style=\"width: 280px;\">\n<p>Most <strong>conclusive</strong> sign of pregnancy</p>\n</td>\n<td style=\"width: 236px;\">\n<p>18 to 20 weeks by stethoscope and 10 weeks by doppler</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 207px;\">\n<p>Quickening</p>\n</td>\n<td style=\"width: 280px;\">\n<p>Feeling of life inside womb</p>\n</td>\n<td style=\"width: 236px;\">\n<p>16 to 20 weeks</p>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is not true regarding uterine souffle?",
    "choices": [
      {
        "id": 1,
        "text": "It is a soft blowing systolic murmur heard on the sides of pregnant uterus"
      },
      {
        "id": 2,
        "text": "The sound is synchronous with the maternal pulse"
      },
      {
        "id": 3,
        "text": "It is due to increased blood flow through the umbilical arteries"
      },
      {
        "id": 4,
        "text": "It can also be heard in a large fibroid"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Uterine souffle</strong> is due to an increase in&nbsp;blood flow through the <strong>dilated uterine vessels,</strong>&nbsp;not umbilical vessels.</p>\n<p>It&nbsp;is a soft blowing systolic murmur heard low down at the sides of the uterus, better heard on the left side.</p>\n<table style=\"width: 471px;\">\n<tbody>\n<tr>\n<td style=\"width: 224px;\">\n<p><strong>Uterine Souffle</strong></p>\n</td>\n<td style=\"width: 239px;\">\n<p><strong>Fetal/Funic Souffle</strong></p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 224px;\">\n<p>Soft, blowing sound</p>\n</td>\n<td style=\"width: 239px;\">\n<p>Sharp, whistling sound</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 224px;\">\n<p>Synchronous with <strong>maternal pulse</strong></p>\n</td>\n<td style=\"width: 239px;\">\n<p>Synchronous with <strong>fetal pulse.</strong></p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 224px;\">\n<p>Caused by the passage of blood through dilated <strong>uterine vessels</strong></p>\n</td>\n<td style=\"width: 239px;\">\n<p>Caused by the rush of blood through the <strong>umbilical arteries</strong></p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 224px;\">\n<p>It can also be heard in a large uterine fibroid</p>\n</td>\n<td style=\"width: 239px;\">\n<p>When present it is <strong>diagnostic of pregnancy</strong></p>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 32-year-old woman nearing her due date was admitted following regular contractions. You note that the head is at +1 station. Where is the exact position of the head?",
    "choices": [
      {
        "id": 1,
        "text": "At the perineum"
      },
      {
        "id": 2,
        "text": "Just below ischial spine"
      },
      {
        "id": 3,
        "text": "Just above ischial spine"
      },
      {
        "id": 4,
        "text": "High up in the false pelvis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>+1 station of the fetal head refers to it being&nbsp;<strong>just below</strong> the <strong>ischial spine</strong>.</p>\n<p>The station of the head is expressed in relation to ischial spines as they are the most prominent bony projections felt on internal examination.&nbsp;The level of <strong>ischial spines</strong> is halfway between the pelvic inlet and outlet. This level is known as <strong>station zero</strong> (0).</p>\n<p>The station is stated in <strong>minus</strong> figures if it is <strong>above</strong> the spines (&ndash;1 cm, &ndash;2 cm, &ndash;3 cm, &ndash;4 cm and &ndash;5 cm) and in <strong>plus</strong> figures if it is <strong>below</strong> the spines (+1 cm, +2 cm, +3 cm, +4 cm and +5 cm).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/05defb3ad0774d3ea6a0792048ad719ax1200x1287.JPEG"
    ]
  },
  {
    "text": "While examining a pregnant woman, you measure her fundal height to be 32 cm and the station of the fetal head is at -2. What could be the probable weight of the fetus?",
    "choices": [
      {
        "id": 1,
        "text": "2.3Kg"
      },
      {
        "id": 2,
        "text": "3.5Kg"
      },
      {
        "id": 3,
        "text": "3.1Kg"
      },
      {
        "id": 4,
        "text": "4.0Kg"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The fetal weight in the above case is<strong> 3.1Kg.</strong></p>\n<p>In the above case, fetal weight can be estimated using&nbsp;<strong>Johnson's formula</strong>. Height of uterus is 32cm, the station is &ndash;2 implying the head is above the ischial spines. Therefore, it is calculated as follows:&nbsp;[32-12] x 155 = 3100 grams = 3.1Kg</p>\n<p>Estimation of fetal weight:</p>\n<ul>\n<li><strong>Johnson&rsquo;s formula:&nbsp;</strong>This is only applicable in vertex presentation.\n<ul>\n<li>If station of head is <strong>below</strong> the level of the ischial spine: [Height of uterus above pubic symphysis (in cm)<strong>-11</strong>] x 155 in grams</li>\n<li>If station of head is <strong>above</strong> the level of the ischial spine: [Height of uterus above pubic symphysis (in cm)<strong>-12</strong>] x 155 in grams</li>\n</ul>\n</li>\n<li><strong>Sonography:</strong>&nbsp;Fetal weight has been estimated by combining a number of biometric data, e.g. biparietal diameter (BPD), head circumference (HC),&nbsp;abdominal circumference (AC) and femur length (FL), using the following formulae:\n<ul>\n<li>Shepard&rsquo;s formula</li>\n<li>Hadlock&rsquo;s formula.</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ae395dfdcef14bedb1eec4ec4edde0ffx1280x1373.JPEG"
    ]
  },
  {
    "text": "All of the following are components of Manning score except ______.",
    "choices": [
      {
        "id": 1,
        "text": "Non stress test (NST)"
      },
      {
        "id": 2,
        "text": "Oxytocin challenge test"
      },
      {
        "id": 3,
        "text": "Fetal body movement"
      },
      {
        "id": 4,
        "text": "Respiratory activity of fetus"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The oxytocin challenge test is not a component of Manning score.&nbsp;</p>\n<p>Earlier, oxytocin challenge test/contraction stress test was done after a non-reactive NST to confirm the diagnosis of hypoxia. However, it is associated with the risk of initiating labor and is hence not done.</p>\n<p>Biophysical profile <strong>(BPP)/Manning score </strong>components:&nbsp;(Mnemonic: BATMaN)</p>\n<ul>\n<li>Breathing movements of the fetus</li>\n<li>Amniotic fluid voulme</li>\n<li>Tone of fetus</li>\n<li>Movements of fetus</li>\n<li>Non-stress Test (NST)</li>\n</ul>\n<p>Normal score: 8-10;&nbsp;Abnormal: &lt;5</p>\n<p><strong>Modified Biophysical score:</strong></p>\n<ul>\n<li>VAST (Vibroacoustic stimulation test)/NST</li>\n<li>Amniotic fluid index</li>\n</ul>\n<p>A score &lt;4 indicates the need for urgent delivery.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 28-year-old G2P1 woman presents to the antenatal clinic at 24 weeks for a routine check-up. USG shows a normal for gestational age fetus in frank breech position, with no other abnormalities. What is the next best step in \u200bmanagement?",
    "choices": [
      {
        "id": 1,
        "text": "75gm oral glucose tolerance test"
      },
      {
        "id": 2,
        "text": "Non-stress test"
      },
      {
        "id": 3,
        "text": "External cephalic version"
      },
      {
        "id": 4,
        "text": "Immediate lower segment Caesarean section"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>75gm </strong>oral glucose tolerance test (<strong>OGTT</strong>)<strong>&nbsp;</strong>is the most appropriate next step of management.&nbsp;The <strong>screening</strong> strategy for detecting gestational diabetes mellitus (<strong>GDM</strong>) recommends performing blood glucose testing at <strong>24-28 weeks</strong> in case of average risk.</p>\n<p>Breech presentation at 24 weeks is not a cause for concern because it can spontaneously rotate and becomes cephalic at term. Hence, external cephalic version (ECV) and immediate caesarean section are not indicated at this time.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following vaccines is absolutely contraindicated in pregnancy?",
    "choices": [
      {
        "id": 1,
        "text": "Hepatitis B"
      },
      {
        "id": 2,
        "text": "Cholera"
      },
      {
        "id": 3,
        "text": "Rabies"
      },
      {
        "id": 4,
        "text": "MMR"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>MMR</strong> is absolutely contraindicated in pregnancy.&nbsp;</p>\n<p><strong>Killed vaccines</strong> are <strong>safe</strong> in pregnancy while <strong>live vaccines</strong> (MMR, BCG, varicella) are <strong>contraindicated</strong> in pregnancy.&nbsp;</p>\n<p>Even though yellow fever vaccine is a live vaccine, it is recommended in endemic areas or during outbreaks. Pregnant women and nursing mothers should be counselled on the potential benefits and risks of vaccination.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A newly married couple planning for pregnancy has come to your clinic for preconception counselling. Which of the following drugs will you prescribe to the patient to decrease the chances of having neural tube defects in the baby?",
    "choices": [
      {
        "id": 1,
        "text": "Vitamin B9"
      },
      {
        "id": 2,
        "text": "Vitamin B12"
      },
      {
        "id": 3,
        "text": "Vitamin C"
      },
      {
        "id": 4,
        "text": "Vitamin B6"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Preconceptional intake of <strong>vitamin B9 (folic acid)</strong> results in decreased incidence of&nbsp;neural tube defects like spina bifida, encephalocele, and anencephaly.</p>\n<p>All women of reproductive age should be given <strong>400 &micro;g</strong> of folic acid daily.&nbsp; Women, who had fetal neural tube defects in the previous pregnancy, should be given <strong>4 mg</strong> of folic acid daily beginning 1 month before conception to about 12 weeks of pregnancy.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following conditions would not cause raised beta-hCG levels in pregnancy?",
    "choices": [
      {
        "id": 1,
        "text": "Down's syndrome"
      },
      {
        "id": 2,
        "text": "Multifetal pregnancy"
      },
      {
        "id": 3,
        "text": "Spontaneous abortion"
      },
      {
        "id": 4,
        "text": "Rh-incompatibility"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Beta-hCG levels are <strong>reduced</strong> in the case of spontaneous abortion.</p>\n<p>Human chorionic gonadotropin (hCG) is <strong>detectable</strong> in the plasma of pregnant women as early as 7-8 days after conception by radioimmunoassay. It <strong>doubles every 2 days</strong> and reaches a <strong>maximum</strong> level at <strong>9 weeks</strong>. Thereafter, it declines to reach the lower level at 20 weeks and disappears from circulation 2 weeks postpartum.</p>\n<p><strong>Increased levels</strong> of beta-hCG are found in:</p>\n<ul>\n<li>Multiple preganancies</li>\n<li>Rh isoimmunization</li>\n<li>Down's syndrome</li>\n<li>Choriocarcinoma</li>\n<li>Hydatidiform mole</li>\n</ul>\n<p><strong>Decreased levels</strong> of beta-hCG are found in:</p>\n<ul>\n<li>Ectopic pregnancies</li>\n<li>Impending spontaneous abortion</li>\n<li>Missed abortion</li>\n<li>Edward syndrome.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not considered as a factor for a high-risk pregnancy?",
    "choices": [
      {
        "id": 1,
        "text": "Obesity"
      },
      {
        "id": 2,
        "text": "Polyhydramnios"
      },
      {
        "id": 3,
        "text": "Anaemia"
      },
      {
        "id": 4,
        "text": "Previous manual removal of placenta"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Previous manual removal of the placenta does not indicate a high-risk pregnancy.</p>\n<p>The <strong>high-risk pregnancies</strong> according to the&nbsp;Pregnancy Risk Assessment Monitoring System by the CDC are<strong>:</strong></p>\n<table style=\"height: 446px; width: 615.283px;\">\n<tbody>\n<tr>\n<td style=\"width: 159px;\"><strong>Current pregnancy complications</strong></td>\n<td style=\"width: 153px;\"><strong>Obstetric history</strong></td>\n<td style=\"width: 132.283px;\">Other disorders</td>\n</tr>\n<tr>\n<td style=\"width: 159px;\">\n<p>Preterm labor (&lt;37 Wks) and Post-term (&gt;&nbsp;42 wk)</p>\n</td>\n<td style=\"width: 153px;\">\n<p>Intrauterine growth restriction</p>\n</td>\n<td style=\"width: 132.283px;\"><strong>Cardiovascular&nbsp; </strong>factors<strong>&nbsp;</strong>like chronic hypertension, severe heart failure,&nbsp;and<strong> renal</strong> disorders</td>\n</tr>\n<tr>\n<td style=\"width: 159px;\">Preterm premature rupture of membranes</td>\n<td style=\"width: 153px;\">Stillbirth</td>\n<td style=\"width: 132.283px;\"><strong>Metabolic </strong>disorders<strong>&nbsp;</strong>like&nbsp;Obesity,<br />Insulin-dependent diabetes, Previous endocrine ablation, Thyroid disorders</td>\n</tr>\n<tr>\n<td style=\"width: 159px;\">Moderate to severe preeclampsia</td>\n<td style=\"width: 153px;\">Late abortion (16&ndash;20 wk)</td>\n<td style=\"width: 132.283px;\"><strong>Hematological</strong> problems like sickle cell disease, severe anemia<br />Thrombophilia</td>\n</tr>\n<tr>\n<td style=\"width: 159px;\">Polyhydramnios (hydramnios) or oligohydramnios</td>\n<td style=\"width: 153px;\">Fetal exchange transfusion (Rh incompatibility)</td>\n<td style=\"width: 132.283px;\"><strong>Infections&nbsp;</strong>(malaria, HIV)&nbsp;and&nbsp;<strong>Autoimmune</strong> disorders</td>\n</tr>\n<tr>\n<td style=\"width: 159px;\">Uterine rupture</td>\n<td style=\"width: 153px;\">Multifetal pregnancy</td>\n<td style=\"width: 132.283px;\"><strong>Epilepsy</strong></td>\n</tr>\n<tr>\n<td style=\"width: 159px;\">Antepartum hemorrhage (Placenta previa, and Abruptio placenta)&nbsp;</td>\n<td style=\"width: 153px;\">Previous brachial plexus injury</td>\n<td style=\"width: 132.283px;\"><strong>Anatomic</strong> abnormalities<strong>&nbsp;</strong>like uterine malformation<br />and cervical incompetence</td>\n</tr>\n<tr>\n<td style=\"width: 159px;\">Fetal tachycardia or bradycardia for&nbsp;&nbsp;&gt;30 min</td>\n<td style=\"width: 153px;\">Abnormal fetal position</td>\n<td style=\"width: 132.283px;\">Exposure to<strong> teratogens&nbsp;</strong>like alcohol, drugs, smoking</td>\n</tr>\n<tr>\n<td style=\"width: 159px;\">Fetal weight&nbsp;&lt;&nbsp;2.5 kg or &gt;4kg</td>\n<td style=\"width: 153px;\">Previous h/o myomectomy, repair of complete perineal tear, vesicovaginal fistula,&nbsp;and stress incontinence</td>\n<td style=\"width: 132.283px;\"><strong>Family</strong> history of diabetes, hypertension or <br />multiple pregnancy and congenital malformation</td>\n</tr>\n<tr>\n<td style=\"width: 159px;\">Chorioamnionitis</td>\n<td style=\"width: 153px;\">&nbsp;</td>\n<td style=\"width: 132.283px;\"><strong>Low</strong> socioeconomic status</td>\n</tr>\n<tr>\n<td style=\"width: 159px;\">Prolapsed cord</td>\n<td style=\"width: 153px;\">&nbsp;</td>\n<td style=\"width: 132.283px;\">Abnormal cervical cytologic findings</td>\n</tr>\n<tr>\n<td style=\"width: 159px;\">Fetal acidosis pH&nbsp;&le;7</td>\n<td style=\"width: 153px;\">&nbsp;</td>\n<td style=\"width: 132.283px;\">&nbsp;</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '07 Diagnosis Of Pregnancy And Antenatal Care';
        let hierarchy = ["Marrow", "qBank", "Obstetrics & Gynecology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>