<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clinical Images Mini Test - -Tmt - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2023-24
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A 40-year-old chronic alcoholic presents with sudden onset abdominal pain in the epigastric region radiating to the back.  Investigations revealed elevated amylase levels and total WBC count. Identify the following sign seen on examination.",
    "choices": [
      {
        "id": 1,
        "text": "Coopernails sign"
      },
      {
        "id": 2,
        "text": "Cullen\u2019s sign"
      },
      {
        "id": 3,
        "text": "Fox sign"
      },
      {
        "id": 4,
        "text": "Grey turner sign"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The above scenario is suggestive of <strong>acute pancreatitis.</strong> The sign shown in the image is <strong>Cullen&rsquo;s sign</strong>. It is a bluish discoloration around the&nbsp;<strong>umbilicus.</strong></p>\n<p><strong>Coopernail&rsquo;s sign</strong> refers to the&nbsp;<strong>ecchymosis</strong> of the <strong>perineum</strong> and scrotum or labia due to <strong>pelvic</strong> <strong>fracture</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ec3951ca5c15465ea93434d0ca029a3b.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "The image given below depicts a skin manifestation of a neurocutaneous disorder. Which of the following conditions given below are not associated with this neurocutaneous disorder?",
    "choices": [
      {
        "id": 1,
        "text": "Adenoma sebaceum"
      },
      {
        "id": 2,
        "text": "Lisch nodules"
      },
      {
        "id": 3,
        "text": "Cortical tuber"
      },
      {
        "id": 4,
        "text": "Periungal fibroma"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The image shows the&nbsp;<strong>shagreen patch</strong> seen in <strong>tuberous sclerosis</strong>. Out of the given options, Lisch nodules is not associated with tuberous sclerosis<strong>. Lisch nodules</strong> are associated with <strong>neurofibromatosis.</strong></p>\n<p><strong>Clinical features of tuberous sclerosis:</strong></p>\n<ul>\n<li>CNS involvement (hallmark of tuberous sclerosis)\n<ul>\n<li><strong>Subependymal nodules</strong>&nbsp;are lesions found along the wall of the lateral ventricles where they undergo calcification</li>\n<li>These benign subependymal nodules lesions can grow into subependymal giant cell astrocytomas (<strong>SEGA</strong>)</li>\n<li>The characteristic brain lesion is a&nbsp;<strong>cortical tuber&nbsp;</strong>(white matter lesion)</li>\n</ul>\n</li>\n<li>Skin\n<ul>\n<li>Facial angiofibroma (adenoma sebaceum)</li>\n<li><strong>Periungual fibroma</strong></li>\n<li>Shagreen patch</li>\n<li>Confetti skin lesions</li>\n</ul>\n</li>\n<li>Others\n<ul>\n<li><strong>Renal angiomyolipoma</strong></li>\n<li>Cardiac rhabdomyoma</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d9898874c9de44708498525c8be03994.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7c08c879ad5c453e9625b2a0c648e361x939x616.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5676334a0949411bae2cf98fde092de5x887x981.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4e35801355764d65b0586245a6d8ae72x939x658.PNG"
    ]
  },
  {
    "text": "The following image is suggestive of:",
    "choices": [
      {
        "id": 1,
        "text": "Posterior dislocation of hip"
      },
      {
        "id": 2,
        "text": "Central dislocation of hip"
      },
      {
        "id": 3,
        "text": "Anterior dislocation of hip"
      },
      {
        "id": 4,
        "text": "Fracture neck of femur"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Typical appearance of<strong> hip flexion and abduction</strong> is seen in <strong>anterior hip dislocations</strong>.</p>\n<p>In posterior hip dislocations, attitude is that of flexion, adduction and internal rotation. In the central dislocation, there will be shortening of the limb. In fracture neck of femur, there will be a minimal external rotation of the limb with or without shortening.</p>\n<table style=\"width: 417px;\" border=\"1\">\n<tbody>\n<tr>\n<td style=\"width: 163px;\">\n<p style=\"text-align: center;\"><strong>Deformities</strong></p>\n</td>\n<td style=\"width: 248px; text-align: center;\">\n<p><strong>Diagnosis</strong></p>\n</td>\n</tr>\n<tr style=\"text-align: center;\">\n<td style=\"width: 163px;\">\n<p>Wry neck</p>\n</td>\n<td style=\"width: 248px;\">\n<p>Cervical spine injuries</p>\n</td>\n</tr>\n<tr style=\"text-align: center;\">\n<td style=\"width: 163px;\">\n<p>Drooping of shoulder</p>\n</td>\n<td style=\"width: 248px;\">\n<p>Clavicle fracture</p>\n</td>\n</tr>\n<tr style=\"text-align: center;\">\n<td style=\"width: 163px;\">\n<p>Flat shoulder</p>\n</td>\n<td style=\"width: 248px;\">\n<p>Anterior dislocation of shoulder</p>\n</td>\n</tr>\n<tr style=\"text-align: center;\">\n<td style=\"width: 163px;\">\n<p>S-shaped deformity of humerus</p>\n</td>\n<td style=\"width: 248px;\">\n<p>Supracondylar humerus fracture</p>\n</td>\n</tr>\n<tr style=\"text-align: center;\">\n<td style=\"width: 163px;\">\n<p>Dinner fork deformity</p>\n</td>\n<td style=\"width: 248px;\">\n<p>Colles&rsquo; fracture</p>\n</td>\n</tr>\n<tr style=\"text-align: center;\">\n<td style=\"width: 163px;\">\n<p>Boutonniere deformity</p>\n</td>\n<td style=\"width: 248px;\">\n<p>Rupture of central extensor slips of finger</p>\n</td>\n</tr>\n<tr style=\"text-align: center;\">\n<td style=\"width: 163px;\">\n<p>Mallet finger</p>\n</td>\n<td style=\"width: 248px;\">\n<p>Rupture of distal end of index extensor</p>\n</td>\n</tr>\n<tr style=\"text-align: center;\">\n<td style=\"width: 163px;\">\n<p>Jersey finger</p>\n</td>\n<td style=\"width: 248px;\">\n<p>Rupture of distal end of flexor digitorum profundus of index finger</p>\n</td>\n</tr>\n<tr style=\"text-align: center;\">\n<td style=\"width: 163px;\">\n<p>Flexion adduction and internal rotation of lower limb</p>\n</td>\n<td style=\"width: 248px;\">\n<p>Posterior dislocation of the hip</p>\n</td>\n</tr>\n<tr style=\"text-align: center;\">\n<td style=\"width: 163px;\">\n<p>Flexion Abduction and external rotation of lower limb</p>\n</td>\n<td style=\"width: 248px;\">\n<p>Anterior dislocation of hip</p>\n</td>\n</tr>\n<tr style=\"text-align: center;\">\n<td style=\"width: 163px;\">\n<p>Incomplete external rotation of lower limbs</p>\n</td>\n<td style=\"width: 248px;\">\n<p>Fracture neck of femur (intracapsular)</p>\n</td>\n</tr>\n<tr style=\"text-align: center;\">\n<td style=\"width: 163px;\">\n<p>Complete external rotation of lower limbs</p>\n</td>\n<td style=\"width: 248px;\">\n<p>Fracture trochanter, and shaft of femur, Fractures of leg bones</p>\n</td>\n</tr>\n<tr style=\"text-align: center;\">\n<td style=\"width: 163px;\">\n<p>S-shaped ankle</p>\n</td>\n<td style=\"width: 248px;\">\n<p>Ankle dislocations</p>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e14103ad40a8470ba673d1e6e0d188dc.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 6-year-old boy is brought to the clinic with the findings below. The patient's mother gives a history of a fever the previous week along with bilateral conjunctival injection. She took the child to a clinic nearby and he was given some medications. Physical examination also reveals the presence of cervical lymphadenopathy.  From the option below, choose the correct statements about his patient's diagnosis.",
    "choices": [
      {
        "id": 1,
        "text": "1, 3 and 4 are correct"
      },
      {
        "id": 2,
        "text": "3 and 5 are correct"
      },
      {
        "id": 3,
        "text": "1, 2 and 3 are correct"
      },
      {
        "id": 4,
        "text": "4 and 5 are correct"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical vignette describes a case of <strong>Kawasaki disease</strong> (KD). Elevated acute phase reactants aid in the diagnosis and untreated patients develop long-term cardiovascular complications that could potentially be fatal.</p>\n<p>KD is the most common vasculitis in the pediatric age group. The condition reflects widespread inflammation of the medium-sized arteries. It is a self-limited condition and the acute-phase inflammation usually lasts about 12 days without therapy.</p>\n<p><strong>Clinical features:</strong></p>\n<ul>\n<li>Fever is the most consistent manifestation of KD. It remains above 101.3F during most of the illness and is minimally responsive to antipyretics</li>\n<li>Bilateral <strong>nonexudative</strong> conjunctivitis which begins within days of onset of fever is seen in the majority of these patients. It starts as a bulbar injection that appears as brilliant erythema that characteristically spares the limbus</li>\n<li>Cracked red lips and a <strong>strawberry tongue</strong> is seen. It is a result of the sloughing of papillae on the tongue</li>\n<li>A polymorphous rash, which starts as perineal erythema and desquamation, followed by macular, morbilliform, or targetoid skin lesions of the trunk and extremities. The rash may be confused with that of scarlet fever.</li>\n<li>Changes in the extremities include <strong>swelling of the hands and feet</strong> which occurs during the <strong>acute phase of the illness</strong> and <strong>desquamation</strong> of the hands and feet (as seen in this patient) which are seen in the<strong> convalescent phase</strong>.</li>\n<li>Cervical lymphadenopathy is seen in some patients but is not a consistent finding</li>\n<li>The presence of <strong>distinct oral lesions and tonsillar exudate</strong> suggests and <strong>alternative diagnosis</strong></li>\n<li>Other nonspecific findings include arthritis, cardiovascular manifestations, diarrhea, irritability, cough, and decreased intake</li>\n</ul>\n<p><strong>Labs:</strong></p>\n<ul>\n<li>Elevated acute-phase reactants (ESR, CRP, ferritin, and reactive thrombocytosis)</li>\n<li>Normocytic normochromic anemia</li>\n<li>Pyuria</li>\n<li>Hyponatremia</li>\n<li>Abnormalities in the lipid profile</li>\n</ul>\n<p><strong>Diagnosis:</strong></p>\n<p>Requires the presence of fever and four of five clinical findings (conjunctivitis, mucosal changes, rash, extremity changes, and cervical lymphadenopathy)&nbsp;</p>\n<p>In addition, ECHO should be performed in all patients to rule out complications</p>\n<p><strong>Treatment:</strong></p>\n<ul>\n<li>Aspirin</li>\n<li>IVIG to prevent complications</li>\n</ul>\n<p><strong>Complications:</strong></p>\n<p>20% of untreated patients develop cardiovascular sequelae, ranging from asymptomatic coronary arteritis to coronary artery ectasia, to giant coronary artery aneurysms (7 to 8 mm) leading to rupture or thrombosis, myocardial infarction, and sudden death.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/4ed6f1f014be4423a616d87bccc43b37.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A patient with an acute attack of trigeminal neuralgia was treated with an anti-epileptic drug intravenously. The next day, he developed pain, swelling, and purple discolouration of his hand, distal to the site of injection as shown below. Identify the drug administered.",
    "choices": [
      {
        "id": 1,
        "text": "Carbamazepine"
      },
      {
        "id": 2,
        "text": "Zonisamide"
      },
      {
        "id": 3,
        "text": "Phenytoin"
      },
      {
        "id": 4,
        "text": "Clonazepam"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><span data-preserver-spaces=\"true\">The&nbsp;drug administered was <strong>phenytoin</strong>.</span></p>\n<p><span data-preserver-spaces=\"true\">The clinical vignette of the patient developing pain, swelling, and purple discoloration of the skin, subsequent to intravenous administration of an antiepileptic drug for trigeminal neuralgia are indicative of <strong>purple glove syndrome</strong>&nbsp;due to&nbsp;phenytoin. </span></p>\n<p><span data-preserver-spaces=\"true\">Purple glove syndrome is a rare complication that may follow the intravenous administration of phenytoin.&nbsp;It typically presents with pain, edema, and discoloration at the injection site that spreads distally.</span></p>\n<p><span data-preserver-spaces=\"true\">Phenytoin is a hydantoin derivative that acts by&nbsp;</span>slowing the rate of recovery of <strong>voltage-gated Na<sup>+</sup> channels</strong> from inactivation and subsequently limits the repetitive firing of action potentials.</p>\n<div class=\"page\" title=\"Page 320\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Phenytoin is extensively bound to plasma proteins, mainly <strong>albumin,</strong> and is metabolized by hepatic CYPs.<br /><br />Despite its narrow therapeutic index, phenytoin is used in the treatment of generalized tonic-clonic seizures, complex partial seizures, <strong>status epilepticus</strong>, trigeminal neuralgia, and behavioral disorders.</p>\n<div class=\"page\" title=\"Page 321\">&nbsp;</div>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/f9792b2528634f19ae792bee5ca0cd80.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ba900be5bbed454fa5b7dd868789c481x303x519.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1d44fcd3228b4cfdb54c1c3a53bcf7dfx1280x2129.JPEG"
    ]
  },
  {
    "text": "A patient has been treated for the lesion shown in the picture below for the past 12 months but there has been no response to treatment. What is the next line of treatment for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Intralesional injection of steroids"
      },
      {
        "id": 2,
        "text": "Pressure treatment"
      },
      {
        "id": 3,
        "text": "Surgical excision with adjuvant therapy"
      },
      {
        "id": 4,
        "text": "Surgical excision only"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The clinical vignette of a patient with keloid, <strong>refractory</strong> to the first line of treatment <strong>after 12 months</strong> of therapy should be considered for <strong>surgical exci\u00adsion in combination with adjuvant therapy\u00a0</strong>(postoperative electron beam irradiation).</p>\n<p>A keloid scar is defined as excessive scar tissue that<strong>\u00a0extends beyond the boundaries of the original incision or wound</strong>. Its etiology is unknown, but is associated with <strong>elevated levels of growth factor</strong>, deeply pigmented skin, and inherited tendency and certain areas of the body (triangle whose points are the xiphisternum and each shoulder tip).</p>\n<p>Keloid scars do not improve spontaneously with time and\u00a0<strong>excision of the keloid scar has a high rate of recurrence</strong>.</p>\n<p><strong>Treatment of keloids</strong> :</p>\n<ul>\n<li>First-line treatments include silicones in combination with <strong>pressure therapy</strong> and <strong>intralesional corticosteroid</strong> <strong>injections.</strong></li>\n<li>Intralesional 5-fluorouracil, bleomycin, and verapamil should be used in accordance with established treatment protocols.</li>\n<li><strong>Refractory cases\u00a0</strong>after <strong>12 months</strong> of therapy should be considered for surgical <strong>excision</strong> in combination with <strong>adjuvant therapy</strong>.</li>\n<li>Excision alone results in a <strong>high recurrence rate</strong> of 50% to 100% and enlargement of the keloid.</li>\n<li>Immediate postoperative electron beam irradiation or brachytherapy with iridium-192 reduces recurrence rates. The risk of malignancy attributable to keloid radiation therapy is minimal.</li>\n<li>An additional new invasive treatment modality is <strong>internal cryotherapy</strong>, in which a metal rod is introduced into the keloid and the subsequent extreme cooling leads to tissue necrosis.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/8bbbcfc6926e4b1eb82835d7876d951a.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 31-year-old male patient presents with mildly pruritic plaques in the left axilla for 2 weeks. Wood\u2019s lamp examination showed coral red fluorescence. What is the most likely causative organism?",
    "choices": [
      {
        "id": 1,
        "text": "Corynebacterium diphtheriae"
      },
      {
        "id": 2,
        "text": "Corynebacterium minutissimum"
      },
      {
        "id": 3,
        "text": "Corynebacterium tenuis"
      },
      {
        "id": 4,
        "text": "Bacillus anthracis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The above image along with <strong>coral-red</strong>\u00a0<strong>fluorescence</strong> under Wood\u2019s lamp is suggestive of <strong>erythrasma</strong>. It is caused by<em> <strong>Corynebacterium</strong> <strong>minutissimum</strong>.</em></p>\n<p>Erythrasma is a mild, chronic, superficial infection of the skin. It affects the <strong>axillae</strong>, groins, toe webs, inter-gluteal and submammary regions. Lesions may be symptomless or show mild discomfort and itching.</p>\n<p>The lesions may be of <strong>irregular shape</strong> with <strong>sharp margins</strong>. They may start as smooth, red patches and then become brown. The lesions are more likely to be <strong>pruritic</strong> in the tropical regions and may be asymptomatic in the temperate climate.\u00a0</p>\n<p><strong>Coral\u2010red fluorescence</strong> with Wood\u2019s light is due to <strong>coproporphyrin III</strong> and suggests erythrasma. The fluorescence may persist after the eradication of the disease.\u00a0</p>\n<p>Treatment is required otherwise the lesions may persist with fluctuations in severity. Treatment involves <strong>topical clotrimazole </strong>and<strong> miconazole</strong> for two weeks. For more extensive lesions, <strong>erythromycin</strong> can be administered. Relapse can occur. In these cases, long-term povidone-iodine administered topically with drying agents are given. Photodynamic therapy can also be attempted.\u00a0</p>\n<p>Other options:<br /><br />Option A: <strong>Corynebacterium diphtheria</strong> causes <strong>diphtheria</strong> and the typical lesion early in the disease is a superficial ulcer, oval, rounded, or irregularly linear in shape with a clearly defined, overhanging edge. The ulcer may later become deeper and the edge becomes rolled, raised, and avascular. It is usually seen around the umbilicus, behind the ears, genito-crural flexure, or in the clefts.</p>\n<p>Option C:\u00a0<strong>Corynebacterium tenuis</strong> can give rise to <strong>trichomycosis axillaris</strong>, a superficial infection of axillary and pubic hairs with the formation of an adherent granular nodule which can be yellow, black, or red in color, on the hair shaft.</p>\n<p>Option D: <strong>Bacillus anthracis</strong> causes <strong>anthrax</strong>, which upon introduction of endospores into areas of exposed skin like the face, neck, hands, or arms gives rise to a typical 'malignant pustule'. It starts as a papule that turns into a bulla on erythematous skin which ruptures to form a <strong>hemorrhagic crust</strong> surrounded by edema, erythema, and vesicles. The lesions may be single or many.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/335b519f9e504cf9875eeb07369dc18f.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Identify the condition given in the image.",
    "choices": [
      {
        "id": 1,
        "text": "Symblepharon"
      },
      {
        "id": 2,
        "text": "Ankyloblepharon"
      },
      {
        "id": 3,
        "text": "Congenital blepharophimosis"
      },
      {
        "id": 4,
        "text": "Congenital ptosis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The condition given in the image is&nbsp;<strong>ankyloblepharon.&nbsp;</strong>It is the<strong>&nbsp;</strong>adhesion between the&nbsp;<strong>margins</strong> of the&nbsp;<strong>upper and lower eyelids.</strong></p>\n<p>It may occur as a <strong>congenital</strong> anomaly or as <strong>acquired</strong> adhesions after healing of <strong>chemical burns</strong>, ulcers, or traumatic wounds of the lid margins.&nbsp;</p>\n<p>Treatment is the <strong>excision</strong> of the adhesions between lid margins. <strong>Epithelial grafts</strong> should be used if adhesions extend to angles.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ddd304e8f8b34187b287619fdc560dc4.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/fd987f90cc184588ab1f655f350b11f9x328x256.PNG"
    ]
  },
  {
    "text": "A 35-year-old male patient presented with a history of tremors, palpitation, and difficulty in closing his eyes for the past 1 month. On examination, you note the following finding as shown in the image given below. What is this sign called?",
    "choices": [
      {
        "id": 1,
        "text": "Dalrymple\u2019s sign"
      },
      {
        "id": 2,
        "text": "Enroth's sign"
      },
      {
        "id": 3,
        "text": "Gifford's sign"
      },
      {
        "id": 4,
        "text": "Mobius sign"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given image shows lid retraction in the right eye, which is known as&nbsp;<strong>Dalrymple's sign.</strong></p>\n<p>It is the&nbsp;<strong>commonest</strong>&nbsp;and&nbsp;<strong>earliest sign</strong>&nbsp;of&nbsp;<strong>Grave's ophthalmopathy</strong>. It is due to overactivity of levator aponeurosis and M&uuml;ller's muscle. Here the upper lid margin is at level with or above the superior limbus, causing the upper sclera to become visible (scleral show).</p>\n<p><strong>Grave's disease</strong>&nbsp;is an<strong>&nbsp;autoimmune</strong>&nbsp;disorder that results in&nbsp;<strong>hyperthyroidism.</strong>&nbsp;In this condition, autoantibodies bind to thyroid-stimulating hormone (TSH) receptors and stimulate the secretion of thyroid hormone.&nbsp;</p>\n<p>Thyroid ophthalmopathy or thyroid eye disease can be seen in Graves' disease or even in euthyroid/ hypothyroid patients.&nbsp;<strong>Women&nbsp;</strong>and&nbsp;<strong>smokers</strong>&nbsp;are at higher risk of developing Grave's ophthalmopathy (otherwise known as<strong>&nbsp;</strong>thyroid eye disease).&nbsp;</p>\n<p><strong>Thyroid function tests&nbsp;</strong>and a&nbsp;<strong>thyroid autoantibody assay&nbsp;</strong>should be done to assess thyroid hormone status.&nbsp;</p>\n<p>Control of hyperthyroidism is effective in management. Injecting botulinum toxin to levator aponeurosis and M&uuml;ller's muscle may be done as a temporary measure.&nbsp;</p>\n<p>The other options are all signs associated with Grave's disease but do not correlate with the given image.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c1108ee6d3e643d59050309dd57625e5.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Choose the correctly matched pair among the following nail changes with their respective diseases.",
    "choices": [
      {
        "id": 1,
        "text": "2"
      },
      {
        "id": 2,
        "text": "1"
      },
      {
        "id": 3,
        "text": "4"
      },
      {
        "id": 4,
        "text": "3"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Image 1 is correctly matched.&nbsp;It<strong>&nbsp;</strong>shows <strong>trachonychia,</strong> which is<strong>&nbsp;</strong>most commonly seen in<strong>&nbsp;alopecia areata.</strong></p>\n<div>\n<p>Trachyonychia presents as a <strong>rough surface</strong> affecting the entire nail plate and up to 20 nails <strong>(20\u2010nail dystrophy).&nbsp;</strong>It is&nbsp;mainly associated with <strong>alopecia areata</strong>, psoriasis, and lichen&nbsp;planus.</p>\nOther nail findings in alopecia areata:</div>\n<ul>\n<li>fine stippled pitting of the nails</li>\n<li>atrophic dystrophy</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d4c66246ba8a474297a74e867c032c2b.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7654f1f3ed7148d0b4eb7e539572bcabx800x533.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/46ccc6f1f1be4db8b46397fa03f11d0ax720x465.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/56d8544881334b5992772e8a0380048bx512x348.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/dd2355eb10884b7eb2b3b4cc568c5354x512x478.PNG"
    ]
  },
  {
    "text": "Identify the test shown in the given image.",
    "choices": [
      {
        "id": 1,
        "text": "Wright's test"
      },
      {
        "id": 2,
        "text": "Roos test"
      },
      {
        "id": 3,
        "text": "Adson's test"
      },
      {
        "id": 4,
        "text": "Halstead test"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The test shown in the given image is <strong>Adson's test&nbsp;</strong>done for thoracic outlet syndrome.</p>\n<p><strong>Thoracic outlet syndrome</strong> occurs due to compression of the lower trunk of the brachial plexus(C8 and T1) and subclavian vessels between the clavicle and the first rib. This produces neurological vascular symptoms. The compression can be due to an extra rib or due to abnormal scalene muscles, etc.</p>\n<p>Clinical features:</p>\n<p>Even though the anomalies responsible for this condition are congenital, symptoms appear during the <strong>third decade.</strong> This is because the blood vessels that supply the trunk level of the brachial plexus become less compliant in the third decade.&nbsp;</p>\n<p>The patient presents with <strong>pain</strong> and <strong>paresthesia</strong> along the <strong>ulnar aspect</strong> of the arm and the medial two fingers. Ulnar clawing and wasting of the intrinsic muscles of the hand may be seen. Vascular signs are less common but the presence of <strong>unilateral Raynauds phenomenon</strong> should raise suspicion of thoracic outlet syndrome.&nbsp;</p>\n<p>Tests for thoracic outlet syndrome are provocative maneuvers that are performed to reproduce the signs and symptoms of this condition.</p>\n<p>These provocative tests are not sensitive nor specific to making a diagnosis of thoracic outlet syndrome.</p>\n<p>Treatment:</p>\n<p>Conservative management consists of shoulder muscle strengthening, postural training, and analgesics for pain.</p>\n<p>Surgical management is indicated if there is severe pain, obvious muscle wasting, or presence of vascular disturbances. The <strong>cervical rib is removed</strong> via a supraclavicular or trans-axillary approach.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/edac78ecddf745c4bc38c0fb0d54f551.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 40-year-old woman presents with complaints of dysphagia. She also says that her hands and feet turn cold and blue when she goes to visit her daughter who lives in a hill station. Her examination findings are as given in the image. What is the earliest cutaneous manifestation that can be seen in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Reduced hair growth"
      },
      {
        "id": 2,
        "text": "Reduced sweating"
      },
      {
        "id": 3,
        "text": "Thickening of skin"
      },
      {
        "id": 4,
        "text": "Non-pitting edema"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical scenario is suggestive of <strong>systemic sclerosis</strong>.\u00a0The earliest cutaneous manifestations in systemic sclerosis are<strong> non-pitting edema and puffiness</strong> <strong>of the fingers, hands, and face.\u00a0</strong></p>\n<p>The image shows a woman with <strong>mask-like facies</strong> with stretched, shiny skin, and loss of normal facial lines, <strong>microstomia,</strong>\u00a0and resorption of distal phalanges of the fingers. The clinical history describes Raynaud's phenomenon (hands and feet turn cold and blue in cold climate) and hence, the probable diagnosis is systemic sclerosis.</p>\n<p><strong>Systemic sclerosis</strong> is an autoimmune rheumatic disease in which there is a <strong>4: 1 female predominance</strong>.</p>\n<p>Cutaneous features:</p>\n<ul>\n<li>Hands and feet - <strong>Raynaud's phenomenon</strong>, non-pitting edema, painful ulcerations which heal with<strong> pitted scars,</strong> sclerodactyly, contractures,<strong> loss of sweat glands</strong>, bone resorption.</li>\n<li>Face - periorbital edema, <strong>mask-like facies</strong>, telangiectasia, and <strong>diffuse hyperpigmentation.</strong></li>\n<li>Trunk - firm, shiny, and thickened skin.</li>\n<li><strong>Reduced hair growth</strong> is seen.</li>\n</ul>\n<p>Systemic features:</p>\n<ul>\n<li>GIT- <strong>dysphagia</strong>, GERD, diminished peristalsis, malabsorption</li>\n<li>Lungs- pulmonary fibrosis and alveolitis</li>\n<li>Heart- cardiac conduction defects, heart failure</li>\n<li>Kidney- uremia, malignant hypertension</li>\n<li>Musculoskeletal- weakness, carpal tunnel syndrome.</li>\n</ul>\n<p>Using\u00a0<strong>modified Rodnan skin score</strong>\u00a0<strong>(MRSS</strong>). the\u00a0<strong>degree of skin sclerosis is scored from 0 to 3</strong>\u00a0by manual palpation at\u00a0<strong>17</strong>\u00a0different body sites. The\u00a0<strong>maximum score</strong>\u00a0that can be attained is\u00a0<strong>51</strong>. This method has been shown to correlate with skin biopsy thickness, disease severity, and long\u2010term outcome of the disease.</p>\n<p>The scoring of each skin region is determined by\u00a0<strong>skin thickness and tethering</strong>:<br />0 = Normal<br />1 = Possible thickening<br />2 = Unable to pinch the skin<br />3 = Unable to move the skin (which is fixed to deeper tissues)</p>\n<p>This modified score does not include the assessment of the neck and back. If these areas are included, the maximum attainable score increases to 57.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3f2da3fded314623b678615432dba9d3.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "What is the most likely diagnosis of the lesion shown in the image below?",
    "choices": [
      {
        "id": 1,
        "text": "Ischemic ulcer"
      },
      {
        "id": 2,
        "text": "Neuropathic ulcer"
      },
      {
        "id": 3,
        "text": "Venous ulcer"
      },
      {
        "id": 4,
        "text": "Tuberculous ulcer"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The most likely diagnosis of the lesion is a <strong>neuropathic ulcer</strong>.</p>\n<p>A neuropathic ulcer is one that occurs due to&nbsp;<strong>peripheral neuropathy</strong>. In peripheral neuropathy, lack of sensation over the pressure points leads to cumulative microtrauma, minor wounds, or cuts that go unnoticed eventually developing into ulcers. They are <strong>painless</strong>, <strong>punched out</strong>&nbsp;with regular margins,&nbsp;on the <strong>plantar surface</strong> of the foot, and show the presence of<strong> calluses.</strong><strong>&nbsp;</strong></p>\n<p>Management of neuropathic ulcer: Debridement of all necrotic or hyperkeratotic wound tissue, proper cultures to be done if an infection is suspected for microbiological analysis. Any ulcerations subjected to sustained pressure should be subjected to pressure reduction&nbsp;by mechanical offloading which includes wedge shoes, total contact cast, cast walkers, etc.</p>\n<table style=\"height: 901px; width: 646px; float: left;\">\n<tbody>\n<tr style=\"height: 60px;\">\n<td style=\"width: 120.641px; height: 60px;\"><strong>Type of Ulcer</strong></td>\n<td style=\"width: 170.906px; height: 60px;\"><strong>Ischaemic/ Arterial</strong></td>\n<td style=\"width: 92.5px; height: 60px;\"><strong>Venous</strong></td>\n<td style=\"width: 112.594px; height: 60px;\"><strong>Neuropathic</strong></td>\n<td style=\"width: 115.359px; height: 60px;\"><strong>Tuberculous&nbsp;&nbsp;</strong></td>\n</tr>\n<tr style=\"height: 72px;\">\n<td style=\"width: 120.641px; height: 72px;\"><strong>Underlying condition</strong></td>\n<td style=\"width: 170.906px; height: 72px;\">\n<p>Peripheral vascular disease- atherosclerosis, thromboangiitis obliterans, cervical rib, Raynaud's phenomenon</p>\n</td>\n<td style=\"width: 92.5px; height: 72px;\">Varicose veins, previous deep vein thrombosis</td>\n<td style=\"width: 112.594px; height: 72px;\">Diabetes, peripheral neuropathy</td>\n<td style=\"width: 115.359px; height: 72px;\">Tuberculosis lymph nodes, cold abscess from bone and joint tuberculosis</td>\n</tr>\n<tr style=\"height: 79px;\">\n<td style=\"width: 120.641px; height: 79px;\"><strong>Location</strong></td>\n<td style=\"width: 170.906px; height: 79px;\">Toes, feet, legs, or even upper limb digits.</td>\n<td style=\"width: 92.5px; height: 79px;\">The lower limb, commonly on the medial side of the ankle, is never above the middle third of the leg</td>\n<td style=\"width: 112.594px; height: 79px;\">The plantar surface of the foot, toes</td>\n<td style=\"width: 115.359px; height: 79px;\">Neck, axilla, and groin, tip or anterior 2/3rd of the tongue.</td>\n</tr>\n<tr style=\"height: 126.390625px;\">\n<td style=\"width: 120.641px; height: 126.391px;\"><strong>Characteristics</strong></td>\n<td style=\"width: 170.906px; height: 126.391px;\">\n<p>Deep, penetrating the fascia exposes the tendons, muscles, and underlying bone.</p>\n<p>The ulcer is <strong>painful</strong>, with irregular margin tenderness, and hyperesthetic.&nbsp;</p>\n</td>\n<td style=\"width: 92.5px; height: 126.391px;\">Vertically oval, and <strong>painless</strong>, the floor may have pale to no granulation tissue, induration, and tenderness at the base.</td>\n<td style=\"width: 112.594px; height: 126.391px;\"><strong>painless</strong>, punched-out with regular calloused margins.&nbsp;</td>\n<td style=\"width: 115.359px; height: 126.391px;\">\n<div class=\"page\" title=\"Page 74\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Edges are thin, reddish blue, and undermined with pale granulation tissue, scanty discharge on the floor, and slight induration at the base.</p>\n</div>\n</div>\n</div>\n</td>\n</tr>\n<tr style=\"height: 121px;\">\n<td style=\"width: 120.641px; height: 121px;\"><strong>Other features</strong></td>\n<td style=\"width: 170.906px; height: 121px;\">Features of ischemia in adjacent areas, like pallor, dry skin, brittle nails, loss of hair</td>\n<td style=\"width: 92.5px; height: 121px;\">Inguinal lymph nodes enlarged, usually the vertical group, the ulcer is recurrent, forms again after healing</td>\n<td style=\"width: 112.594px; height: 121px;\">\n<p>Dry, warm foot</p>\n<p>Loss of sensation, vibration, and reflexes.</p>\n<p>Bony deformities may be present.</p>\n</td>\n<td style=\"width: 115.359px; height: 121px;\">Regional lymph nodes are enlarged, non-tender, matted</td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;</p>\n<p>&nbsp;</p>\n<p>&nbsp;</p>\n<p>&nbsp;</p>\n<p>&nbsp;</p>\n<p>&nbsp;</p>\n<p>&nbsp;</p>\n<p>&nbsp;</p>\n<p>&nbsp;</p>\n<p>&nbsp;</p>\n<p>&nbsp;</p>\n<p>&nbsp;</p>\n<p>&nbsp;</p>\n<p>&nbsp;</p>\n<p>&nbsp;</p>\n<p>&nbsp;</p>\n<p>&nbsp;</p>\n<p>&nbsp;</p>\n<p>&nbsp;</p>\n<p>&nbsp;</p>\n<p>&nbsp;</p>\n<p>&nbsp;</p>\n<p>&nbsp;</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/54f061ad470b4cfb822066a3e7eaa99e.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/370782681457420a93952f2cc2b6edddx750x563.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c5c5c5422e0e4a40974986655549438dx473x612.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6041dbd7a88b4a698c8a86e29e657dd5x900x1200.JPEG"
    ]
  },
  {
    "text": "A dentist presents with painful lesions on his fingertip as shown in the image given below. What is the most likely etiology for his condition?",
    "choices": [
      {
        "id": 1,
        "text": "Pox virus"
      },
      {
        "id": 2,
        "text": "Herpes simplex virus"
      },
      {
        "id": 3,
        "text": "Human papilloma virus"
      },
      {
        "id": 4,
        "text": "Human herpes virus-7"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The above clinical scenario along with the image<strong>&nbsp;</strong>showing <strong>vesicles</strong> and <strong>cloudy blisters</strong> at the <strong>pulp of fingers</strong> is suggestive of <strong>herpetic whitlow</strong>. It is caused by the<strong> herpes simplex virus</strong>.</p>\n<p><strong>Herpetic whitlow</strong> is most commonly contracted by <strong>dental workers</strong> and medical workers exposed to<strong> oral secretions</strong>. Clinical features include painful <strong>deep vesicles</strong> at the site of inoculation (in this case fingertips) which coalesce to form large bullae or a honeycomb appearance. Fever and constitutional symptoms are mild.</p>\n<p>Whitlow can lead to necrosis of the <strong>distal 4/5<sup>th</sup></strong> of the <strong>terminal phalanx.&nbsp;</strong>It does not cause necrosis of the entire phalanx because the proximal 1/5<sup>th</sup>&nbsp;escapes as in this part the <strong>artery does not cross</strong> the fibrous <strong>septa</strong>.</p>\n<p>The pulp space of fingers contains&nbsp;<strong>subcutaneous fat</strong> arranged in <strong>tight compartments</strong>. These compartments are formed by <strong>fibrous septa</strong> extending from the skin to the periosteum of the terminal phalanx.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c30a4f719a0c4208a3c08df102209076.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7c8b653c19c94746a50fb2443ec2f380x600x593.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/669aefa0cb3e4c1eaf66a600ac6b34d5x510x460.GIF"
    ]
  },
  {
    "text": "A woman who was started on treatment for leprosy recently presents with the following painful lesions that developed over the existing hypopigmented lesions. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Erythema nodosum leprosum"
      },
      {
        "id": 2,
        "text": "Stevens-Johnson Syndrome"
      },
      {
        "id": 3,
        "text": "Reversal reaction"
      },
      {
        "id": 4,
        "text": "Lucio reaction"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Development of <strong>ulcerating lesions</strong>&nbsp;over the leprosy skin lesions following initiation of treatment for leprosy is suggestive of a<strong>&nbsp;severe type 1 lepra reaction/ reversal reaction.&nbsp;</strong></p>\n<p>Lepra 1 reactions are due to an <strong>enhanced</strong> cell-mediated <strong>immune response</strong> to <em>M. leprae. </em>They&nbsp;usually present <strong>abruptly</strong> with redness and <strong>inflammation</strong> of <strong>existing lesions</strong> but can cause ulceration in severe cases. It occurs due to a&nbsp;<strong>large amount</strong> of <em>M. leprae</em> <strong>antigens&nbsp;</strong>in these patients which results in&nbsp;prolonged and repeated reactions during treatment.&nbsp;They are commonly seen in the <strong>borderline</strong> spectrum but are <strong>most severe</strong> in <strong>borderline lepromatous</strong>&nbsp;leprosy.</p>\n<p>Another form of lepra reaction with ulcerating lesions is the&nbsp;<strong>Lucio reaction</strong>. It is a rare type of lepra reaction that is seen in patients with lepra bonita. It is often the initial presentation in <strong>untreated patients.</strong>&nbsp;It is common over extremities and spreads in an ascending fashion. It&nbsp;presents as tender nodules that form jagged ulcers. &nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/19db40e8badb497280eecbb42089246f.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A patient complains of hair loss over the back of her head. On examination, a 2 cm area of complete, smooth, circular hair loss with distinct margins and exclamation mark hairs is seen without scaling or inflammation. On further examination, the nail finding is shown in the image below. Which of the following is false about the condition responsible for this finding?",
    "choices": [
      {
        "id": 1,
        "text": "Non- pigmemted hair is primarily affected"
      },
      {
        "id": 2,
        "text": "Condition can be associated with thyroiditis"
      },
      {
        "id": 3,
        "text": "T-cell mediated inflammatory disease"
      },
      {
        "id": 4,
        "text": "Exclamation mark hairs are seen"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The image shows <strong>fine stippled pitting</strong> of nails, and the non-scarring type of hair loss associated with it is <strong>alopecia areata</strong>. The <strong>false statement</strong> about it is that <strong>non-pigmented&nbsp;hair is primarily affected</strong>.</p>\n<p><strong>Alopecia areata</strong> is a chronic inflammatory disease that causes <strong>non-scarring hair loss</strong>.&nbsp;It is a <strong>T-cell-mediated inflammatory disease.&nbsp;</strong>It is associated with several autoimmune diseases including <strong>thyroiditis</strong>, lupus erythematosus, vitiligo, and psoriasis.</p>\n<p>It mainly affects the&nbsp;<strong>scalp, </strong>but can also affect the <strong>beard, eyebrows, </strong>and<strong> eyelashes.&nbsp;</strong>In some cases, this progresses to a total loss of scalp hair <strong>(alopecia totalis)</strong> or a loss of all hair on the body<strong> (alopecia universalis)</strong>. The lesions of alopecia areata are characterized by a&nbsp;<strong>smooth circumscribed patch </strong>of<strong> alopecia. </strong>Some broken hairs can be seen, which are&nbsp;called&nbsp;<strong>exclamation marks. </strong>They are easily extractable. It preferentially&nbsp;<strong>affects pigmented hair</strong> and <strong>spares non-pigmented or white hair</strong>.</p>\n<p>A <strong>perifollicular</strong> and <strong>intrafollicular inflammatory cell infiltrate</strong> that is focused in and around the hair bulb can be seen in anagen follicles near the edges of growing regions of alopecia areata. The predominant component of the inflammatory infiltration is <strong>activated T lymphocytes</strong>, with predominant CD4 cells, macrophages, Langerhans cells, and cells that exhibit NK cell markers.</p>\n<p><strong>Spontaneous remission</strong> occurs in a majority of patients with hair loss that is patchy and is of shorter duration.&nbsp;<strong>Topical steroids</strong> like<strong> clobetasol</strong> can be useful in patchy alopecia areata. Intralesional steroids are the most effective treatment for patchy alopecia areata.&nbsp;</p>\n<p>Severe and long-standing alopecia areata requires oral&nbsp;<strong>corticosteroids.</strong></p>\n<p>The image below shows a clinical picture of alopecia areata with a patch of alopecia with a smooth surface of the scalp-</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/66c6b8d1c00a46a08910cbdd03c029a1.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0e228debbfce427888f6ce363b09fc50x1280x1453.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/05f85157dcc74d539b1e8d3f92fbd235x1280x1458.JPEG"
    ]
  },
  {
    "text": "Identify the following deformity seen in a patient complaining of pain and swelling of her hands.",
    "choices": [
      {
        "id": 1,
        "text": "Swan neck deformity"
      },
      {
        "id": 2,
        "text": "Boutonni\u00e8re deformity"
      },
      {
        "id": 3,
        "text": "Bouchard's nodes"
      },
      {
        "id": 4,
        "text": "Hitchhiker's deformity"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The image is showing&nbsp;<strong>flexion of the PIP</strong> joint with <strong>hyperextension of the DIP</strong> joint is suggestive of&nbsp;<strong>Boutonni&egrave;re deformity </strong>seen in patients with <strong>rheumatoid arthritis.</strong></p>\n<p>Heberden&rsquo;s&nbsp;and&nbsp;Bouchard&rsquo;s<strong>&nbsp;</strong>nodes are nodules in osteoarthritis that are palpable in the distal interphalangeal joint and proximal interphalangeal joints respectively.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d41db27579814e5c96499ea3664417d9.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A young girl presents with leukotrichia and lesions as shown in the image. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Focal vitiligo"
      },
      {
        "id": 2,
        "text": "Segmental vitiligo"
      },
      {
        "id": 3,
        "text": "Piebaldism"
      },
      {
        "id": 4,
        "text": "Nevus depigmentosus"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The image shows areas of <strong>localized, unilateral depigmented macules.&nbsp;</strong>This feature, along with a history of leukotrichia suggest that the patient is suffering from <strong>segmental</strong>&nbsp;<strong>vitiligo</strong>. It occurs due to a&nbsp;<strong>lack of melanocytes</strong> in the basal layer of the epidermis.</p>\n<p>It is a localised depigmentation that occurs due to a <strong>progressive loss in the melanocytes.</strong> It is classified as</p>\n<ul>\n<li><strong>Segmental vitiligo</strong>- which appears as <strong>unilateral</strong> maculae in a segmented or band-shaped pattern</li>\n<li><strong>Non-segmental vitiligo</strong>- which appears as <strong>bilateral</strong> maculae distributed in an acrofacial pattern or scattered symmetrically over the entire body</li>\n</ul>\n<p>The lesions become apparent between 20-30 years of age.&nbsp;</p>\n<p class=\"p1\">Hypopigmented macules in vitiligo are commonly found in the <strong>hips, dorsum of the hands/fingers</strong>, <strong>feet, elbows, knees, and ankle areas.</strong> These are the areas of repeated friction. Rarely there may be complete vitiligo (vitiligo universalis), or trichrome vitiligo where there are areas of depigmentation, hyperpigmentation, along with the normal skin are present. The <strong>Koebner phenomenon</strong> is the development of&nbsp;<strong>lesions at the site of trauma</strong> on the uninvolved skin.</p>\n<p>Several autoimmune conditions can be associated with vitiligo. They are:</p>\n<ul>\n<li class=\"p1\">Thyroid disease<span class=\"s1\">&nbsp;</span>(hyperthyroidism and hypothyroidism )</li>\n<li class=\"p1\">Pernicious anemia</li>\n<li class=\"p1\">Addison disease</li>\n<li class=\"p1\">Diabetes</li>\n<li class=\"p1\">Hypoparathyroidism</li>\n</ul>\n<p>Under the Wood's lamp examination&nbsp;the depigmented areas emit a bright <strong>blue-white fluorescence</strong> and <strong>appear sharply demarcated.&nbsp;</strong></p>\n<p>Treatment involves cosmetic camouflage and the use of sunscreen. The topical application of <strong>corticosteroids</strong> is the <strong>first line of treatment</strong>. Topical calcineurin inhibitors like&nbsp;pimecrolimus, tacrolimus have also shown to be successful. <strong>Psoralen photochemotherapy,</strong> khellin, selective <strong>ultraviolet B therapy</strong>&nbsp;are used as <strong>second-line treatment</strong>. In patients who do not respond to this treatment, surgical grafting techniques can be used, where the melanocytes from a normal pigmented area are transferred to a non pigmented area. In patients with extensive vitiligo where only a few pigmented areas are left, depigmentation can be done.</p>\n<p style=\"text-align: center;\">&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/128713be3d6d433a9d382853858a7923.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ca3f74c7155b465283dd1ff0677a5e1ax720x1440.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7f3ba8a5c000485d928e7c7c3ac394d7x1024x768.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/aa5902707aae41afb9e5454dd77afa78x505x246.PNG"
    ]
  },
  {
    "text": "A patient presented with a history of fever, myalgia, and severe arthralgia. She also developed pigmentation on the nose after a few days of the onset of these symptoms as shown below. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Melasma"
      },
      {
        "id": 2,
        "text": "Melanocytic papillomatous naevi"
      },
      {
        "id": 3,
        "text": "Actinic keratosis"
      },
      {
        "id": 4,
        "text": "Chikungunya"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given history of fever, myalgia, severe arthralgia, and nose hyperpigmentation (<strong>chik sign</strong>) points towards a diagnosis of <strong>chikungunya.\u00a0</strong></p>\n<p>Chik sign refers to a central facial pigmentation predominantly on the nose which develops during\u00a0the acute phase of the disease. It helps in the retrospective diagnosis of Chikungunya infection<strong>.\u00a0</strong>It\u00a0most commonly affects the <strong>nose</strong> and <strong>cheeks.</strong> It\u00a0appears as the fever subsides.</p>\n<p>Chikungunya fever is due to infection with Chikungunya virus, spread by mosquitos and direct contact between humans. The <strong>Aedes aegypti</strong> and <strong>Aedes albopictus</strong> mosquitoes are the most common vectors.</p>\n<p>It presents as an acute onset of fever, arthralgia, and myalgia with other flu symptoms such as headache, loss of appetite, and nausea. A maculopapular rash develops, which is <strong>more pronounced on the trunk.\u00a0</strong>The rash may occasionally progress to petechiae and purpura.\u00a0</p>\n<div class=\"page\" title=\"Page 642\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Diagnosis is mainly clinical, however, a definitive diagnosis can be made by the detection of IgM antibodies in the serum with ELISA or RTPCR.</p>\n</div>\n</div>\n</div>\n</div>\n<p>Treatment is supportive with acetaminophen and NSAIDs. The rash can be managed with saline compresses and emollients. Persistent non-healing ulcers can be managed by topical or systemic antibiotics. Most of the skin lesions resolve within 2 weeks.</p>\n<p>Other options:</p>\n<p>Option A-\u00a0Hyperpigmentation\u00a0of the centrofacial face (nose and cheeks) mimics <strong>melasma</strong> and may be misdiagnosed if proper history is not taken. Melasma is hyperpigmented macules of the face that increase after sun exposure.\u00a0</p>\n<p>The following image shows the hyperpigmentation of the face seen in melasma.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c13ce66d7e6b46eb9562898e9d6b8b45.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/28af6e2015984d1cb20cddf2af16c161x720x543.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/733881afd10043ddbf56d43ee94af92cx1280x960.JPEG"
    ]
  },
  {
    "text": "Which of the following statements is false about the conditions given below?",
    "choices": [
      {
        "id": 1,
        "text": "It is more common in girls than boys"
      },
      {
        "id": 2,
        "text": "It is more common bilaterally"
      },
      {
        "id": 3,
        "text": "Haab striae is seen in late stages"
      },
      {
        "id": 4,
        "text": "Prognosis is worse if glaucoma is present since birth."
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Congenital glaucoma <strong>occurs more often in boys than in girls</strong> and is commonly seen <strong>bilaterally</strong>.</p>\n<p>The first sign may be an edema of the cornea with watering of the eyes and marked photo\u00ad phobia. At a <strong>later stage</strong>, rupture of Descemet's membrane causes more discrete corneal opacities (Haab\u2019s striae.)</p>\n<p>The Prognosis is</p>\n<ul>\n<li>Worst \u2013 if glaucoma is present since birth.</li>\n<li>Best \u2013 if present from 2 months to 1 year. <strong>\u00a0</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/094187cbaad2455b978ac86a4658c23d.JPEG"
    ],
    "explanation_images": []
  }
];
        let quizName = 'Clinical Images Mini Test - -Tmt';
        const quizFilename = 'clinical-images-mini-test-tmt-60e28b43.html';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2023-24"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>