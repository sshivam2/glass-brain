<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Integrated Mini Test 9 - Microbiology - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2024-25
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A young female patient with a recent travel history comes to the OPD with a history of prolonged abdominal pain, diarrhea, and fever gradually increasing in a step ladder pattern. On examination, faint, salmon-colored macules are seen on the trunk. A serological test is used to confirm the diagnosis. This test is an example of",
    "choices": [
      {
        "id": 1,
        "text": "Agglutination test"
      },
      {
        "id": 2,
        "text": "Tube flocculation test"
      },
      {
        "id": 3,
        "text": "Slide flocculation test"
      },
      {
        "id": 4,
        "text": "Ring precipitation test"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The above clinical scenario is suggestive of enteric fever/ typhoid fever.&nbsp;<strong>Widal test </strong>is an <strong>agglutination test</strong> done in case of <strong>typhoid fever.</strong></p>\n<p>Typhoid fever is caused by<strong>&nbsp;<em>Salmonella typhi</em></strong><em>.&nbsp;</em>The clinical course may vary from mild undifferentiated pyrexia to a rapidly fatal disease.&nbsp;Clinical manifestations include malaise,&nbsp;<strong>step ladder pyrexia, abdominal pain, diarrhea,</strong> and myalgia.&nbsp;<strong>Hepatosplenomegaly</strong>&nbsp;is a common finding on examination.&nbsp;<strong>Rose spots&nbsp;</strong>are small erythematous maculopapular lesions that are seen on the chest and abdomen that fade on pressure. They appear in the second week and are seen as shown below</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f02aaf8a71aa40518a848887aaeac3e1x720x482.JPEG"
    ]
  },
  {
    "text": "A patient presents with low-grade fever, chest pain, cough, and hemoptysis. Radiological examination of the chest reveals cavity formation with lung abscess. The culture of the specimen shows the appearance given in the image, at 37\u00b0C. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "South American blastomycosis"
      },
      {
        "id": 2,
        "text": "North American blastomycosis"
      },
      {
        "id": 3,
        "text": "Darling's disease"
      },
      {
        "id": 4,
        "text": "Valley fever"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <span data-preserver-spaces=\"true\">above clinical scenario and the</span><span data-preserver-spaces=\"true\">&nbsp;image above showing thick-walled round yeast cells with<strong> single broad-based budding</strong>&nbsp;depicting the&nbsp;<strong>figure of 8 appearance</strong>,<strong> </strong>in the culture at<strong> 37&deg;C</strong> is suggestive of <em><strong>Blastomycosis dermatitidis</strong></em></span>.<strong> </strong>It<span data-preserver-spaces=\"true\"> causes&nbsp;</span><span data-preserver-spaces=\"true\"><strong>North American blastomycosis</strong>.</span></p>\n<p><strong>Blastomycosis</strong>&nbsp;is a chronic infection caused by a&nbsp;<strong>dimorphic fungus</strong>&nbsp;called&nbsp;<strong><em>Blastomyces dermatitidis.&nbsp;</em></strong>It is characterized by the formation of&nbsp;<strong>suppurative and granulomatous lesions</strong>&nbsp;in the lungs and skin. It is most common in North America and is also called&nbsp;<strong>North American Blastomycosis.</strong></p>\n<p>Humans are infected by the<strong>&nbsp;inhalation of spores</strong>&nbsp;in contaminated soil.</p>\n<p>Blastomycosis can present in&nbsp;<strong>three&nbsp;</strong>forms:</p>\n<ul>\n<li><strong>Pulmonary infection</strong> - can be asymptomatic, focal or diffuse consolidation, miliary lesions or abscess formation.&nbsp;</li>\n<li><strong>Disseminated disease</strong>&nbsp;- can lead to multiple abscesses and has high fatality.</li>\n<li><strong>Cutaneous disease</strong>&nbsp;over the skin of the face. Lesions may be a papule, around which secondary nodules develop and coalesce to form elevated ulcerative lesions.&nbsp;</li>\n</ul>\n<p><em>B. dermatitidis&nbsp;</em>when cultured at 37&deg;C shows&nbsp;<strong>thick-walled round yeast cells</strong>&nbsp;with a&nbsp;<strong>single broad-based bud.</strong></p>\n<p>Localized lesions are effectively managed with<strong>&nbsp;itraconazole</strong>&nbsp;for 6 months. Invasive&nbsp;or severe cases are treated with&nbsp;<strong>amphotericin B</strong>.</p>\n<p>Other Options:</p>\n<p>Option A: <span data-preserver-spaces=\"true\"><strong><em>Paracoccidioides brasiliensis</em>&nbsp;</strong>causes&nbsp;<strong>Brazilian/South American blastomycosis</strong>.</span></p>\n<p>Option C: <span data-preserver-spaces=\"true\"><em><strong>Histoplasma capsulatum</strong></em>&nbsp;causes histoplasmosis/<strong>Darling's disease</strong>.</span></p>\n<p><span data-preserver-spaces=\"true\">Option D: <strong><em>Coccidioides immitis</em>&nbsp;</strong>causes<strong>&nbsp;valley fever</strong>. </span></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/347908b05c9648b3a060942e9d64ce0c.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 75 year old man, who was on a tapering dose of methylprednisolone presented with complaints of non productive cough and chest pain. A chest CT scan revealed heterogeneous consolidation in the left upper lobe with cavitation. A biopsy showed the presence of a fungus, as seen in the image below. Voriconazole was started empirically for the infection. Identify the fungus based on its microscopic appearance:",
    "choices": [
      {
        "id": 1,
        "text": "Aspergillus fumigatus"
      },
      {
        "id": 2,
        "text": "Aspergillus flavus"
      },
      {
        "id": 3,
        "text": "Aspergillus niger"
      },
      {
        "id": 4,
        "text": "Penicillium"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario of a fungal respiratory infection in a patient taking corticosteroids along with the biopsy findings is suggestive of i<span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">nvasive aspergillosis caused by <strong>Aspergillus niger.</strong></span></p>\n<p>The microscopic appearance of <strong>Aspergillus niger\u00a0</strong>is characterized by:</p>\n<ul>\n<li>The vesicle is globular shaped</li>\n<li>Phialides are in<strong> two rows</strong></li>\n<li>Conidia arise from the entire vesicle and are <strong>black</strong></li>\n</ul>\n<div class=\"page\" title=\"Page 712\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Invasive disease may develop as an acute pneumonic process following the inhalation and germination of these conidia. Patients at risk for i<span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">nvasive aspergillosis</span> are</p>\n<ul>\n<li>lymphocytic or myelogenous <strong>leukemia</strong> and <strong>lymphoma</strong></li>\n<li><strong>stem cell transplant</strong> recipients</li>\n<li>individuals taking <strong>corticosteroids</strong></li>\n<li><strong>AIDS</strong> patients with CD4 cell counts less than 50 CD4 cells/\u03bcL</li>\n</ul>\n<p>Patients may present with fever, <strong>cough</strong>, dyspnea, and <strong>hemoptysis</strong>. Hyphae may <strong>invade</strong> the lumens and walls of blood vessels leading to thrombosis, infarction, and necrosis. R<span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">apid administration of native or lipid formulation of <strong>amphotericin B</strong> or <strong>voriconazole</strong> is indicated in these cases.</span></p>\n<p><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">Other options:</span></p>\n<p><strong>Option A: Aspergillus fumigatus</strong></p>\n<ul>\n<li>Vesicle is <strong>conical</strong> or <strong>flask</strong> shaped.</li>\n<li>Phialides are arranged in a<strong> single row.</strong></li>\n<li>Conidia arise from<strong> upper third of the vesicle</strong>, and are <strong>hyaline</strong>.</li>\n</ul>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d9aa932030944fe58831109c1bc75e4e.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b67117809ebb429e8055514f44a45151x250x167.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a97be645f58e42b78d5b157e435f191dx600x600.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/307a3c43b25c42ffafdc24f8c0b2446dx886x1200.JPEG"
    ]
  },
  {
    "text": "A 5-year-old child is crying uncontrollably and is complaining of ear pain. He has a high-grade fever, cold, and nose block. The otoscopic examination showed the following finding. Which of the following organisms is the most common cause of this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Moraxella catarrhalis"
      },
      {
        "id": 2,
        "text": "Streptococcus pneumoniae"
      },
      {
        "id": 3,
        "text": "Haemophilus influenzae"
      },
      {
        "id": 4,
        "text": "Staphylococcus aureus"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The clinical features of <strong>severe ear pain, fever, and cold</strong> with the otoscopic image showing <strong>red and bulging tympanic membrane</strong>\u00a0are likely to be <strong>acute suppurative otitis media</strong>. <em><strong>Streptococcus pneumoniae</strong></em> is the\u00a0most common cause of this condition. Other organisms that can cause these are:</p>\n<ul>\n<li><em><strong> Haemophilus influenzae</strong></em></li>\n<li><em><strong> Moraxella catarrhalis</strong></em></li>\n<li><em>Streptococcus pyogenes</em></li>\n<li><strong><em>Staphylococcus aureus</em></strong></li>\n<li><em>Pseudomonas aeruginosa</em></li>\n</ul>\n<p>Clinical features: The child may present with a cold, fever, and earache. If the tympanic membrane ruptures, ear discharge might also be there.</p>\n<p>In the stage of presuppuration, there might be a leash of blood vessels that appear along with the handle of the malleus and at the periphery of the tympanic membrane giving it a <strong>cart-wheel appearance</strong>. Later, the entire tympanic membrane becomes red.</p>\n<p>Management:</p>\n<p>Since the most common organism responsible are<em>\u00a0<strong>Streptococcus pneumonia\u00a0</strong></em>and\u00a0<em>Haemophilus influenza</em>, antibiotics should be started. The effective drugs in acute otitis media are <strong>ampicillin</strong> (50 mg/kg/day in four divided doses) and <strong>amoxicillin</strong> (40 mg/kg/day in three divided doses).</p>\n<p><strong>Decongestant nasal drops</strong>- ephedrine, oxymetazoline, and xylometazoline nasal drops can be used to decrease the edema of the eustachian tube, and promote middle ear ventilation.</p>\n<p><strong>Oral nasal decongestants</strong> like pseudoephedrine in combination with an antihistamine are effective in treating nasal blockade.</p>\n<p><strong>Analgesics and antipyretics</strong> are used to relieve pain and fever</p>\n<p>If there is ear discharge, it has to be mopped with sterile cotton buds. An antibiotic wick may also be inserted.</p>\n<p><strong>Myringotomy:</strong>\u00a0It is incising the eardrum to evacuate pus and is indicated when the drum is bulging and there is acute pain, incomplete resolution despite antibiotics, persistent conductive hearing loss, and persistent effusion beyond 12 weeks.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/fe537394c2744585acb91a66369ac282.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 44-year-old cave explorer presents with a non-productive cough and progressively worsening breathing difficulty. Chest x-ray shows diffuse bilateral interstitial infiltrates along with a pneumatocele. Findings of microscopic examination of the bronchoalveolar lavage are shown below. Identify the organism and the stain used.",
    "choices": [
      {
        "id": 1,
        "text": "Pneumocystis jirovecii, Methenamine silver stain"
      },
      {
        "id": 2,
        "text": "Histoplasma capsulatum, Methenamine silver stain"
      },
      {
        "id": 3,
        "text": "Pneumocystis jirovecii, Giemsa stain"
      },
      {
        "id": 4,
        "text": "Histoplasma capsulatum, Giemsa stain"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical picture and the staining showing the black stained cysts resembling the&nbsp;crushed ping-pong balls are suggestive of <strong><em>Pneumocystis</em> pneumonia (PCP). </strong>It is caused by <strong><em>Pneumocystis jirovecii</em>.&nbsp;</strong>The stain used for staining the causative organism is&nbsp;<strong>Gomori&rsquo;s methenamine silver stain</strong>.</p>\n<p>Patients with PCP generally present with fever and cough that is usually non-productive. The chest x-ray is normal in case of mild symptoms and shows&nbsp;<strong>diffuse&nbsp;bilateral interstitial infiltrates</strong> that are perihilar and symmetric in later stages.&nbsp;<span style=\"font-size: 14px;\"><strong>Pneumatocele</strong>&nbsp;and pneumothorax are characteristic chest radiographic findings.</span>&nbsp;Trimethoprim-sulfamethoxazole (<span style=\"font-size: 14px;\">TMP-SMX)&nbsp;</span><span style=\"font-size: 14px;\">or pentamidine is the treatment. HIV patients with CD4 count &lt;200/</span><span style=\"font-size: 14px;\">&mu;L should be started on prophylaxis with TMP-SMX.</span></p>\n<p><em>Histoplasma capsulatum</em> spreads by inhalation of spores from bat or bird droppings. It causes&nbsp;<span style=\"font-size: 14px;\">flu-like illness, anorexia, dry cough, dyspnea, and chest pain. X-ray shows signs of pneumonitis with prominent hilar or mediastinal adenopathy and not pneumatocele. It is also stained with&nbsp;</span><span style=\"font-size: 14px;\">methenamine silver or Giemsa</span><span style=\"font-size: 14px;\">&nbsp;stain.</span></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b7cb244996964b4ebdb34ebdd75de645.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 23-year-old male patient presents with fever and altered sensorium for two days, with the following rash on his trunk and legs. His BP is 70/50 mmHg and neck stiffness is present. Lumbar puncture reveals cloudy CSF with 4200 cells/\u03bcL, a protein level of 198 mg/dL, and a glucose level of 21 mg/dL. Which of the following correctly describes the organisms causing this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Gram-positive cocci, catalase negative, bacitracin sensitive"
      },
      {
        "id": 2,
        "text": "Gram-negative diplococci, oxidize glucose and maltose"
      },
      {
        "id": 3,
        "text": "Gram-negative diplococci, oxidase negative, catalase negative"
      },
      {
        "id": 4,
        "text": "Gram-negative diplococci, oxidize lactose and sucrose"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical vignette and the image showing <strong>petechial rashes</strong> are suggestive of<strong>\u00a0</strong>fulminant <strong>meningococcemia</strong>. This condition is caused by Neisseria meningitidis/meningococci- <strong>gram-negative diplococci </strong>that<strong> oxidize glucose</strong> and <strong>maltose</strong>.</p>\n<p><em><strong>Neisseria meningitidis </strong></em>is an<strong>\u00a0</strong>aerobic, gram-negative, nonmotile diplococcus. They are <strong>catalase</strong> and<strong> oxidase positive</strong>.<strong> Glucose </strong>and<strong> maltose are oxidized</strong>, but lactose and sucrose are not oxidized.</p>\n<div class=\"page\" title=\"Page 307\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>The cocci spread from the nasopharynx to the meninges by traveling along the perineural sheath of the olfactory nerve with an initial flu-like infection. \u00a0<strong>Meningococcemia </strong>presents as an acute onset fever with chills, malaise<strong>\u00a0</strong>with a<strong> petechial rash </strong>in early disease. The patient develops signs of meningitis, such as intense headache, vomiting, photophobia, confusion, and a stiff neck. It may progress to a coma within a few hours.</p>\n<p><strong>Fulminant meningococcemia</strong> is more severe, presenting with a high fever and a hemorrhagic rash; the patient may also develop disseminated intravascular coagulation and ultimate circulatory collapse with bilateral hemorrhagic necrosis of the adrenal glands with subsequent adrenal failure, also known as <strong>Waterhouse-Friderichsen syndrome</strong>.\u00a0</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3331d2b9463a4383bcefd4cc421dcca0.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "During antibody screening for Hepatitis B infection, the following class of antibodies against HbcAg was detected in high titres in a patient. What is the most probable Hepatitis B infection status of this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Recent infection"
      },
      {
        "id": 2,
        "text": "Remote infection"
      },
      {
        "id": 3,
        "text": "Vaccinated against Hep B"
      },
      {
        "id": 4,
        "text": "Hepatitis B carrier state"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given image shows a <strong>pentameric immunoglobulin</strong>, hence it is an\u00a0<strong>IgM antibody</strong>.\u00a0High titers of IgM antibodies signify a\u00a0<strong>recent infection</strong>.</p>\n<p>IgM antibody acts against the core antigen (IgM anti-Hbc) of Hepatitis B virus (HBV) and is predominant in <strong>acute</strong> infections. Later, it is replaced by IgG antibodies (IgG\u00a0anti-Hbc).</p>\n<div class=\"page\" title=\"Page 559\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Specific diagnosis of hepatitis B rests on the serological demonstration of the viral markers:</p>\n<ul>\n<li><strong>HBsAg</strong> is the <strong>first marker</strong> seen in the blood following infection and can be detected prior to the clinical manifestation and elevation of transaminases. Typically, they\u00a0<strong>disappear\u00a0</strong>within about <strong>two months</strong> of the start of clinical disease, but may sometimes persist for six months. Anti-HBs antibodies appear when the antigens are no longer detectable and they remain for very long periods. <strong>Anti-HBs</strong> are the <strong>protective antibody</strong>.</li>\n<li><strong>HBcAg</strong>\u00a0cannot be demonstrated\u00a0in circulation since it lies enclosed within the HBsAg coat, but its antibody, <strong>anti-HBc</strong>\u00a0is the <strong>earliest marker </strong>seen in blood a week or two after the appearance of HBsAg. It remains for a lifetime and thus indicates a <strong>prior infection.</strong></li>\n<li><strong>HBeAg</strong> appears in blood <strong>along</strong>\u00a0with <strong>HBsAg</strong> or following its appearance. Circulating HBeAg is an indicator of active intrahepatic <strong>viral replication</strong>, and the presence of DNA polymerase, HBV DNA, and virions, reflect <strong>high infectivity</strong>.</li>\n</ul>\n</div>\n</div>\n</div>\n<p>Other options:</p>\n<p>Option B:\u00a0<strong>Remote HBV infection </strong>is characterized by the presence of <strong>IgG</strong> <strong>anti-Hbc</strong> antibodies.</p>\n<p>Option C:<strong> People vaccinated against Hep B</strong> will have antibodies only against surface antigen <strong>HbsAg</strong>, and not against the core antigen.\u00a0</p>\n<p>Option D:<strong> Hepatitis B</strong> <strong>carriers</strong> have IgG and HBsAg seen.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/0d095506022f42ffb36fa726c7296ab9.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 24-year-old man came to the dermatology clinic with complaints of brittle hair and hair loss. Hair under microscopy is as given below. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Black Piedra"
      },
      {
        "id": 2,
        "text": "Tinea nigra"
      },
      {
        "id": 3,
        "text": "Menke's syndrome"
      },
      {
        "id": 4,
        "text": "Trichorrhexis nodosa"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The presence of firmly adherent,<strong> black</strong>,<strong> gritty</strong>,<strong> hard nodules</strong> along the hair shaft is suggestive of\u00a0<strong>black piedra</strong>. The causative agent of this condition is\u00a0<strong><em>Piedraia hortae</em></strong>.</p>\n<p>Piedra is a superficial fungal infection of the hair shaft. It is of\u00a0two types:</p>\n<ul>\n<li><strong>Black piedra:</strong> It is characterized by firmly adherent, black, gritty, hard nodules along the hair shaft. <strong>Scalp hair</strong> is most often affected. <strong>Hair</strong> becomes <strong>brittle</strong> and breaks easily leading to complaints of hair loss. It is caused by <em><strong>Piedraia hortae</strong></em>.</li>\n<li><strong>White piedra: </strong>It is characterized by <strong>soft</strong>,<strong> white</strong>, or light brown transparent <strong>nodules</strong> that are easily detached from the hair. It affects <strong>pubic</strong>,<strong> axillary</strong>,<strong> </strong>and <strong>facial hair</strong> more commonly than scalp hair. It is<strong>\u00a0</strong>caused by\u00a0<em><strong>Trichosporon</strong> <strong>beigelii</strong></em>.</li>\n</ul>\n<p>Management involves shaving or cutting off the affected hair along with topical antifungals.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/8288534559e6429da8b0d0a3a9a07d9b.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/70fcb06a51bf420e92549747150fa77fx1280x1086.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/19f2c4e30ea84ca49b405ff619ab9844x1280x1073.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/cca3b6c960cb42ca98409f300990c908x720x544.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b4122fff0680487bb4b1e5fa66c4f6a5x444x483.JPEG"
    ]
  },
  {
    "text": "A 56-year-old woman presented to the OPD with dysuria and frequent micturition. Urinalysis showed pus cells. The culture on MacConkey agar showed the appearance of non-lactose fermenting colonies. Phenyl pyruvic acid (PPA) Reaction is positive. What is the most likely organism implicated in this case?",
    "choices": [
      {
        "id": 1,
        "text": "Proteus"
      },
      {
        "id": 2,
        "text": "Escherichia"
      },
      {
        "id": 3,
        "text": "Shigella"
      },
      {
        "id": 4,
        "text": "Klebsiella"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The clinical scenario indicating, <strong>non-lactose fermenting </strong>colonies on <strong>MacConkey agar</strong>, and a<strong><span data-preserver-spaces=\"true\"> positive Phenyl pyruvic acid (PPA) Reaction</span></strong><span data-preserver-spaces=\"true\">\u00a0in a patient with lower urinary tract symptoms is suggestive of\u00a0</span><strong><span data-preserver-spaces=\"true\">Proteus infection.</span></strong></p>\n<p>Proteus is a <strong>gram-negative bacillus</strong><span data-preserver-spaces=\"true\">. All members of the tribe Protea have the enzyme\u00a0</span><strong><span data-preserver-spaces=\"true\">phenylalanine deaminase</span></strong><span data-preserver-spaces=\"true\">\u00a0which converts phenylalanine to phenyl pyruvic acid. This is called the PPA reaction.</span></p>\n<p><span data-preserver-spaces=\"true\">Proteus can cause urinary tract infections. Struvite stones (triple phosphate stones) are usually seen in a setting of infection with urease-producing bacteria like Proteus, Pseudomonas, and Staphylococcus.</span><strong><span data-preserver-spaces=\"true\">\u00a0</span></strong><span data-preserver-spaces=\"true\">Production of\u00a0</span><strong><span data-preserver-spaces=\"true\">urease</span></strong><span data-preserver-spaces=\"true\">\u00a0enzyme by Proteus, which\u00a0</span><strong><span data-preserver-spaces=\"true\">hydrolyses urea to ammonia\u00a0</span></strong><span data-preserver-spaces=\"true\">causes\u00a0</span><strong><span data-preserver-spaces=\"true\">alkalinization</span></strong><span data-preserver-spaces=\"true\">\u00a0of urine. Alkalinization of urine leads to the precipitation of organic and inorganic compounds which contributes to the formation of\u00a0</span><strong><span data-preserver-spaces=\"true\">Struvite stones</span></strong>.</p>\n<p>Image showing a positive PPA reaction:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3b3f2c7efe8f4cb9a2cb930667a3f237x1280x2122.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6b560485e82b476785ac234566ea112fx720x628.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/92845087d8754d6fb26ce4ab049d9a31x1280x1280.JPEG"
    ]
  },
  {
    "text": "A patient presents with the complaints of a painless ulcer on his penis. The complement fixation test is found to be positive. All of the following immunoglobulins are involved in this reaction, except:",
    "choices": [
      {
        "id": 1,
        "text": "IgG3"
      },
      {
        "id": 2,
        "text": "IgG4"
      },
      {
        "id": 3,
        "text": "IgG1"
      },
      {
        "id": 4,
        "text": "IgG2"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>All the given immunoglobulins are involved in complement fixation except IgG4.</p>\n<p>A painless ulcer over the penis with a positive complement fixation test is suggestive of the diagnosis of <strong>syphilis</strong>.</p>\n<p>Complement cannot bind to the free antigen or antibodies directly. It can bind to those antibodies that have combined with their antigen. The ability of these <strong>antigen-antibody complexes</strong> to bind or fix complement is utilized in the <strong>complement fixation test</strong>. The test is performed in two steps and involves five reagents: antigen, antibody, complement, sheep erythrocytes, and an amboceptor (rabbit antibody to sheep RBCs).\u00a0</p>\n<p>Compliment fixation involves the immunoglobulins <strong>IgM, IgG3, IgG1, </strong>and <strong>IgG2</strong> (in this order).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/881f5649dc15483d8e26e5e4c4a53297x1280x4005.JPEG"
    ]
  },
  {
    "text": "A diabetic patient is admitted with symptoms of ear pain and ear discharge.  A swab was taken and cultured, the isolate is a strict aerobe, catalase positive, and shows the following motility. Which of the following is responsible for its pathogenicity?",
    "choices": [
      {
        "id": 1,
        "text": "Inactivation of the 60s ribosomal subunit"
      },
      {
        "id": 2,
        "text": "Exotoxin A and a slime layer"
      },
      {
        "id": 3,
        "text": "Preformed Type A enterotoxin."
      },
      {
        "id": 4,
        "text": "\u03b1-toxin having lecithinase activity"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical features, laboratory findings and the video shows <strong>swarming motility</strong> of the bacterial growth on a solid agar plate are suggestive of&nbsp;<strong>malignant otitis externa</strong>&nbsp;caused by&nbsp;<em><strong>Pseudomonas aeruginosa. </strong></em>Diphtheria-like<strong> exotoxin A </strong>and a <strong>slime layer&nbsp;</strong>are responsible for its pathogenicity.&nbsp;</p>\n<p><strong>Pseudomonas aeruginosa&nbsp;</strong>is a <strong>strict aerobe,&nbsp;</strong>gram-negative, <strong>catalase-positive, oxidase-positive&nbsp;</strong>bacteria that shows <strong>swarming motility</strong>. They produce a characteristic blue-green pigment called&nbsp;<strong>pyocyanin</strong>&nbsp;and a greenish-yellow pigment called&nbsp;<strong>fluorescein/pyoverdin.</strong>&nbsp;Other pigments produced by these organisms include<strong> pyorubin</strong>&nbsp;(Red), <strong>pyomelanin</strong>&nbsp;(Brown).&nbsp;It&nbsp;shows a&nbsp;<strong>positive oxidase reaction </strong>and&nbsp;is<strong>&nbsp;non-lactose fermenting&nbsp;</strong>in nature.</p>\n<p>Diseases caused by Pseudomonas aeruginosa include-</p>\n<ul>\n<li>Malignant otitis externa in diabetics</li>\n<li>Pneumonia and sepsis in cystic fibrosis</li>\n<li>Wound infection and sepsis in burns</li>\n<li>Hot tub folliculitis/Pseudomonas aeruginosa folliculitis/&nbsp;Jacuzzi syndrome is a type of folliculitis, occurring after hot tub exposure</li>\n<li>Shanghai fever is a febrile illness that manifests as severe enteric disease, sepsis with invasive disease.</li>\n<li>Ecthyma gangrenosum</li>\n</ul>\n<p>Pathogenesis - It is an&nbsp;<strong>obligate aerobe</strong>&nbsp;that exerts its pathogenicity by the production of&nbsp;diphtheria-like<strong> exotoxin A </strong>and a <strong>slime layer</strong>. Breach in primary body defenses as in burns predisposes to Pseudomonas infection.</p>\n<p>Clinical features - It is characterized by&nbsp;<strong>blue-green pus.&nbsp;</strong>It is notorious for being&nbsp;<strong>resistant to antimicrobials and antiseptics</strong>&nbsp;and hence is a frequent&nbsp;<strong>contaminant in hospital samples</strong>. Repeated isolation and associated clinical features should prompt the diagnosis of Pseudomonas.</p>\n<p>Diagnosis - It&nbsp;grows well on most media&nbsp;and&nbsp;<strong>pigment production</strong>&nbsp;makes its identification easy.&nbsp;Species identification is made possible by biochemical tests -&nbsp;<strong>arginine hydrolysis </strong>and<strong> oxidase reaction</strong>.&nbsp;</p>\n<p>Other options-</p>\n<p>Option A:&nbsp;<strong>Shiga toxin</strong>&nbsp;acts by&nbsp;<strong>inactivating the 60s ribosomal</strong>&nbsp;subunit thereby inhibiting protein synthesis.&nbsp;<em><strong>Shigella dysenteriae&nbsp;</strong></em>causes acute onset of symptoms(fever, abdominal cramps) with dysentery and tenesmus.</p>\n<p>Option C:&nbsp;<em><strong>Staphylococcus aureus&nbsp;</strong></em>which acts via&nbsp;<strong>preformed Type A enterotoxin</strong>. Staphylococcus causes&nbsp;<strong>nausea, vomiting</strong>, and&nbsp;<strong>diarrhea</strong>&nbsp;<strong>2-6 hrs</strong>&nbsp;after the consumption of contaminated food.</p>\n<p>Option D:&nbsp;The<strong> &alpha;-toxin</strong> of&nbsp;<strong><em>C. perfringens</em></strong>&nbsp;has&nbsp;<strong>lecithinase</strong>&nbsp;activity.&nbsp;<strong>Gas gangrene</strong>&nbsp;is caused most often by<strong>&nbsp;<em>Clostridium perfringens</em></strong>&nbsp;species.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/9afe3f6014024be48971d1fe7c802cf1.GIF"
    ],
    "explanation_images": []
  },
  {
    "text": "A 42-year-old patient presents with multiple superficial nodular lesions. A picture of his lesions is shown below. The lepromin test is negative and he is diagnosed with lepromatous leprosy. Which of the following is not consistent with his form of disease?",
    "choices": [
      {
        "id": 1,
        "text": "Due to deficient cell mediated immunity"
      },
      {
        "id": 2,
        "text": "Lesions contain predominantly CD4+ T cells"
      },
      {
        "id": 3,
        "text": "Lesions contain predominantly CD8+ T cells"
      },
      {
        "id": 4,
        "text": "Not more susceptible to viral opportunistic infections"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The statement 'lesions contain predominantly CD4+ T cells' is not consistent with lepromatous leprosy. It is associated with<strong> CD8+ T cells.</strong></p>\n<p>The given image depicts a male patient with <strong>cutaneous nodules</strong> over the face and <strong>loss of eyebrows</strong>, consistent with nodular lepromatous leprosy.&nbsp;</p>\n<p><strong>Mycobacterium leprae</strong> is a gram-positive, acid-fast bacillus that causes leprosy. Leprosy is a <strong>chronic granulomatous disease</strong> that affects the skin and peripheral nerves.&nbsp;</p>\n<p>There are different forms of leprosy <strong>depending on the immune status</strong> of the person who is infected.&nbsp;</p>\n<p>The lepromatous form occurs when there is <strong>poor cell-mediated immunity</strong> (Option A). It is termed as '<strong>multibacillary disease'</strong> as there are numerous bacilli seen within the lesions. The lepromata (superficial nodular granulomatous lesions) that develop contain vacuolated cells in different stages of development.&nbsp;The bacteria are also shed in nasal and oral secretions. The lepromatous form is considered to be very infectious.&nbsp;</p>\n<p>Within the lepromatous granulomas, there is an <strong>infiltrate of CD8+ T cells</strong> (Option C).&nbsp;In the tuberculous type, there are predominantly CD4+ T cells.&nbsp;</p>\n<p>In lepromatous leprosy, there is a deficiency in cell-mediated immunity. However, the deficiency is specifically for the lepra antigens. Individuals with this form <strong>are not more susceptible to other viral or parasitic infections</strong> (Option D) even though cell-mediated immunity is required.&nbsp;</p>\n<p>In <strong>tuberculoid leprosy</strong>, individuals have <strong>good resistance</strong>. There are not many lesions and if present, they are sharply demarcated. The lesions do not have extensive bacilli presence and it is <strong>not very infective</strong>. This form is termed '<strong>paucibacillary disease</strong>'.</p>\n<p>Other forms of leprosy also exist such as borderline, borderline tuberculous, borderline lepromatous types based on the <strong>Ridley-Jopling classification</strong>. These contain features of both tuberculous and lepromatous types.&nbsp;</p>\n<p>The <strong>lepromin test</strong> is one way to understand the immunity in a patient with leprosy. Lepromin antigens from <strong>armadillo-derived lepra bacilli</strong> are used and injected into the skin. It has two reactions: the <strong>early</strong> <strong>reaction (Fernandez)</strong> and the <strong>late reaction (Mitsuda).</strong> The early reaction develops within 1-2 days and will persist for 3-5 days. It is characterized by <strong>erythema </strong>and<strong> induration</strong>. The late reaction starts 1-2 weeks later with a peak at 4 weeks and then subsides. Here, there is an indurated nodule that may ulcerate.</p>\n<p>The presence of a Mitsuda reaction is a measure of the cell-mediated immunity. It is not used to diagnose. It is used to classify, assess prognosis, resistance, and verify the identity of candidate lepra bacilli. The test is <strong>positive in tuberculoid leprosy</strong> and <strong>negative in lepromatous leprosy</strong> as seen in our patient. A positive reaction demonstrated good prognosis and resistance.&nbsp;</p>\n<p>The below image shows a histopathological slide of lepromatous leprosy. Here, large groups of <strong>lipid-laden macrophages</strong>&nbsp;filled with globi of&nbsp;pink/red&nbsp;<strong>acid-fast bacilli</strong>&nbsp;are seen.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/739f516f8fc8414999b0ba0356911f6c.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b66d5b7096844d97a24e74e51464066ex957x691.JPEG"
    ]
  },
  {
    "text": "An 18-year-old girl presents with swelling in the lips, and face for the last 2 days. She gives a history of multiple similar episodes in the past and also says some of her relatives have similar complaints. On examination, non-pruritic subcutaneous edema is noted. This condition is associated with the deficiency of which of the following complements?",
    "choices": [
      {
        "id": 1,
        "text": "C1 esterase Inhibitor"
      },
      {
        "id": 2,
        "text": "C5 C6 C7 C8"
      },
      {
        "id": 3,
        "text": "C1, C2, C4"
      },
      {
        "id": 4,
        "text": "C3b inactivator"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario is suggestive of <strong>Hereditary angioneurotic edema</strong>, which is associated with a deficiency of<strong> C1 esterase inhibitor</strong>.&nbsp;</p>\n<p>Hereditary angioneurotic edema&nbsp;(HAE) is an autosomal dominant condition due to low levels of plasma protein C1 inhibitor. Deficiencies of C1 inhibitors facilitate the unchecked activation of the classic complement pathway and biochemical systems including bradykinin systems. Bradykinin is an inflammatory mediator that caused neutrophil chemotaxis, capillary dilatation with plasma leakage, and smooth muscle relaxation.</p>\n<p>Hereditary angioneurotic edema&nbsp;is characterized by episodic <strong>angioedema of the subcutaneous tissue</strong> like the face, hands, arms, genitals, or of the <strong>mucosa of the respiratory</strong> or <strong>alimentary</strong> tracts. They can present with <strong>non-pruritic</strong> subcutaneous tissue edema, <strong>paroxysmal colicky pain</strong>, or <strong>laryngeal edema</strong>.</p>\n<p>Drugs like ecallantide, icatibant, C1-inhibitor derived from human plasma, or recombinant C1- inhibitor are used for acute attacks.&nbsp;Recombinant C1-inhibitor can be used for attacks and prophylaxis. Avoidance of triggers, estrogens, and ACE-inhibitors are included in the management plan.&nbsp;</p>\n<p>Clinical syndromes associated with genetic deficiencies of complement components are as follows:</p>\n<table style=\"width: 368px;\">\n<tbody>\n<tr>\n<td style=\"width: 144px;\"><strong>Deficiency</strong></td>\n<td style=\"width: 216px;\"><strong>Syndrome</strong></td>\n</tr>\n<tr>\n<td style=\"width: 144px;\">C1 esterase inhibitor</td>\n<td style=\"width: 216px;\">Hereditary angioneurotic edema</td>\n</tr>\n<tr>\n<td style=\"width: 144px;\">C1, C2, C4</td>\n<td style=\"width: 216px;\">SLE and other collagen vascular diseases</td>\n</tr>\n<tr>\n<td style=\"width: 144px;\">\n<p>C3 and its regulatory protein</p>\n<p>C3b inactivator</p>\n</td>\n<td style=\"width: 216px;\">Severe recurrent pyogenic infections</td>\n</tr>\n<tr>\n<td style=\"width: 144px;\">C5 to C8</td>\n<td style=\"width: 216px;\">Bacteremia, mainly with gram-negative diplococci, toxoplasmosis</td>\n</tr>\n<tr>\n<td style=\"width: 144px;\">C9</td>\n<td style=\"width: 216px;\">No particular disease</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A stool sample of a person suffering from rice-water diarrhea is stained and observed under the microscope, which shows the following image. Which of the following is a selective medium for the growth of the organism shown in the given image?",
    "choices": [
      {
        "id": 1,
        "text": "Thayer-Martin medium"
      },
      {
        "id": 2,
        "text": "Thiosulfate-Citrate-Bile-Sucrose agar"
      },
      {
        "id": 3,
        "text": "Lowenstein-Jensen medium"
      },
      {
        "id": 4,
        "text": "Venkatraman-Ramakrishnan medium"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The clinical vignette consisting of watery stools and the image showing the characteristic\u00a0<strong>fis</strong><strong>h-in-stream appearance</strong>\u00a0is suggestive of\u00a0<strong><em>Vibrio cholerae</em></strong> for which <strong>Thiosulfate-Citrate-Bile-Sucrose agar</strong> is the selective medium.</p>\n<p>Selective media contain an inhibiting substance that is added to a solid medium. This inhibits the growth of commensals and favors the growth of the required bacterium.\u00a0</p>\n<p><em>Vibrio cholerae </em>is\u00a0aerobic, with scanty slow growth anaerobically. Growth is better in an alkaline medium. NaCl in 0.5\u20131% concentration is required for optimum growth.</p>\n<p><em>Vibrio</em> colonies can be identified by the <strong>string test.\u00a0</strong>A loopful of the growth is mixed with\u00a0sodium deoxycholate in saline on a slide. If the test is positive, the suspension loses its turbidity and forms a string when the loop is slowly pulled away from the suspension.</p>\n<div class=\"page\" title=\"Page 322\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><em>V. cholerae</em> causes a diarrheal disease called cholera. It presents as profuse, painless, watery diarrhea, and vomiting. The pathogenesis involves the production of the <strong>cholera toxin</strong> which attaches to <strong>GM-1 ganglioside</strong> receptors on the jejunal epithelium cells.</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b943067723ab4dcfa20185551e7ff1fc.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/80decf3ade114d2ea550982283945dc8x720x720.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c4f71d310681458f8709dbb3df33a4e9x720x832.JPEG"
    ]
  },
  {
    "text": "A 35-year-old farmer presented with a 6-month history of soft tissue swelling on the right jaw. On examination, a discharging sinus was found as seen below. On microscopic examination of the pus, sulfur granules appearance was seen. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Actinomycosis"
      },
      {
        "id": 2,
        "text": "Chromoblastomycosis"
      },
      {
        "id": 3,
        "text": "Cutaneous anthrax"
      },
      {
        "id": 4,
        "text": "Sporotrichosis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>A farmer with a lumpy jaw &amp; discharging sinuses, with the pus having a sulfur granule appearance is characteristic of\u00a0<strong>cervicofacial</strong>\u00a0<strong>actinomycosis</strong>.</p>\n<p>Actinomycosis typically presents as a\u00a0<strong>painless nodule that indurates,</strong>\u00a0with<strong>\u00a0purulent discharge</strong>\u00a0that contains\u00a0<strong>sulfur granules.\u00a0</strong>Sulfur granules are composed of a matrix of\u00a0<strong>bacteria, calcium phosphate, and host tissue.\u00a0</strong>It\u00a0is an indolent, slowly progressive, suppurative, and granulomatous\u00a0infection that produces pyogenic lesions, with interconnecting\u00a0sinus tracts that contain\u00a0<strong>sulfur granules.</strong></p>\n<p>It is caused by\u00a0<strong>anaerobic or microaerophilic</strong>\u00a0bacteria, primarily of the genus\u00a0<em><strong>Actinomyces.\u00a0</strong></em>It presents as one of the following clinical types:</p>\n<ul>\n<li class=\"p1\"><strong>Cervicofacial actinomycosis</strong>- (<strong>most common site)</strong>\u00a0fluctuant mass in the jaw area producing draining fistulas. (<strong>lumpy jaw)</strong></li>\n<li class=\"p1\"><strong>Thoracic actinomycosis</strong>- pulmonary infection with fever, cough, and purulent sputum.\u00a0</li>\n<li class=\"p1\"><strong>Abdominal actinomycosis</strong>- following ruptured appendix or ulcer. It may involve multiple organs.</li>\n<li class=\"p1\"><strong>Pelvic</strong>\u00a0<strong>actinomycosis</strong>- due to the colonization of intrauterine contraceptive device.</li>\n<li class=\"p1\">Actinomycosis can spread to<strong>\u00a0bones</strong>\u00a0and surrounding tissue, and produce\u00a0<strong>multiple discharging sinuses.</strong></li>\n</ul>\n<p class=\"p1\">Diagnosis:</p>\n<ul>\n<li class=\"p1\">Gram staining of sulfur granules shows a dense network of thin\u00a0<strong>gram-positive filaments</strong>, surrounded by\u00a0<strong>club-shaped</strong>\u00a0structures (<strong>Sunray appearance</strong>).</li>\n<li class=\"p1\">Culture shows a\u00a0<strong>molar tooth</strong>\u00a0appearance of the colonies.</li>\n</ul>\n<p>The image below shows the\u00a0<strong>molar tooth</strong>\u00a0appearance of <em>Actinomyces</em> colonies.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e200615dfbe84e568a38b7abada8aaea.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/60a07fef674445a1b03aca863f115365x720x483.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0a214151e0274bdf9a5b60fd78fadde1x1024x768.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6cd1e7fd1059438a9449713b38605fcex700x460.JPEG"
    ]
  },
  {
    "text": "A middle-aged farmer, presented with fever, chills, and tender inguinal lymphadenopathy. The smear prepared from the discharge was stained with Wayson stain and the finding is given below. Which bioterrorism category does the causative organism belong to?",
    "choices": [
      {
        "id": 1,
        "text": "Category A"
      },
      {
        "id": 2,
        "text": "Category B"
      },
      {
        "id": 3,
        "text": "Category C"
      },
      {
        "id": 4,
        "text": "Category D"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario of <strong>fever, chills</strong>,<strong> tender inguinal lymphadenopathy</strong>, and a smear showing a characteristic\u00a0<strong>safety</strong>\u00a0<strong>pin</strong>\u00a0<strong>appearance</strong><strong>\u00a0</strong>on\u00a0<strong>Wayson stain</strong>\u00a0is suggestive of <strong>bubonic plague</strong> caused by <em><strong>Yersinia pestis</strong></em>. It belongs to\u00a0<strong>category A</strong>\u00a0bioterrorism.</p>\n<p><strong>Plague\u00a0</strong>is a zoonotic disease caused by <em><strong>Yersinia pestis</strong></em>.\u00a0It is a gram-negative, non-motile, coccobacillus. The reservoirs of infection are\u00a0<strong>wild rodents</strong> like\u00a0field mice, gerbils, skunks, etc.\u00a0The important vector of plague is <strong>rat flea</strong> (<em><strong>Xenopsylla cheopis</strong>).\u00a0</em>Humans acquire the disease by the bite of an infected flea, by direct contact with the tissues of the infected animal, or by droplet infection from cases of pneumonic plague.\u00a0</p>\n<p class=\"p1\">Human plague mainly presents as:</p>\n<ol>\n<li><strong>Bubonic plague\u00a0</strong>- This is the <strong>most common</strong> type of disease. The patient develops a <strong>sudden fever, chills, headache</strong>,\u00a0and painful<strong> lymphadenitis</strong>. Within a few days, the <strong>lymph nodes</strong> in the <strong>groin</strong>, axilla, or neck enlarge and are called <strong>buboes</strong>. This is followed by the suppuration of the buboes.\u00a0</li>\n<li><strong>Pneumonic plague\u00a0</strong>- Occurs as a complication of septic plague or bubonic plague and bacilli can be isolated from sputum as well.</li>\n<li><strong>Septic plague</strong> - It occurs when the infection spreads to the blood.</li>\n</ol>\n<p>Investigations include the demonstration of bacillus from the samples of\u00a0<strong>blood, sputum, and buboes</strong>.\u00a0<em>Yersinia</em>\u00a0is a coccobacillus that exhibits\u00a0<strong>bipolar</strong>\u00a0staining with\u00a0<strong>Wayson's stain</strong>. Culture and serology can also be done.\u00a0<strong>Streptomycin</strong>\u00a0is the<strong> drug of choice</strong> to treat plague, and it should be given intramuscularly in two doses (30 mg/kg).\u00a0Other preventive measures include regular usage of\u00a0<strong>rodenticides,</strong>\u00a0proper application of effective\u00a0<strong>insecticides,</strong>\u00a0and disinfection. If a patient is suspected to have symptoms suggestive of plague,\u00a0<strong>isolation</strong>\u00a0is advised.</p>\n<p><strong>Bioterrorism</strong>\u00a0is the deliberate\u00a0release of an agent by attackers\u00a0that causes one or\u00a0more of a variety of different diseases. The agents of bioterrorism are classified into 3 categories:</p>\n<ul>\n<li><strong>Category A</strong>\u00a0bioterrorism agents are those which are\u00a0<strong>easily transmitted</strong>\u00a0from one person to the other and are associated with\u00a0<strong>high mortality</strong>\u00a0rates and thus have the potential to cause major public health impacts. Examples include\u00a0<em><strong>Bacillus anthracis, Clostridium botulinum,</strong></em>\u00a0and\u00a0<em><strong>Yersinia pestis</strong>.</em></li>\n<li><strong>Category B</strong>\u00a0bioterrorism agents are those which are moderately easy to disseminate and are associated with\u00a0<strong>moderate morbidity</strong>\u00a0and\u00a0<strong>low mortality rates</strong>. Examples include\u00a0<em><strong>Coxiella burnetti</strong></em>\u00a0and<em><strong>\u00a0Brucella</strong>.</em></li>\n<li><strong>Category C\u00a0</strong>bioterrorism agents are those which are emerging pathogens that could be engineered for mass dissemination in the future due to ease of availability, high mortality and morbidity rates, and ease of production and dissemination. Examples include\u00a0<em><strong>Nipah</strong></em>\u00a0and <em><strong>Hanta viruses</strong></em>.\u00a0</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b2a6eea811244e4f99868636ac2f7223.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 21-year-old male patient presents with recurrent bouts of vomiting and abdominal cramps over the past three hours. He gives a history of consumption of fried rice at a restaurant 5 hours back. Which of the following is the most probable causative organism?",
    "choices": [
      {
        "id": 1,
        "text": "Clostridium perfringens"
      },
      {
        "id": 2,
        "text": "Enterotoxigenic Escherichia coli"
      },
      {
        "id": 3,
        "text": "Staphylococcus aureus"
      },
      {
        "id": 4,
        "text": "Bacillus cereus"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The above clinical vignette showing food poisoning<strong> within 2 hours</strong> of consumption of <strong>fried rice</strong>/ Chinese street food is strongly suggestive of <strong><em>Bacillus cereus</em> (serotypes 1, 3, 5)</strong> food poisoning.</p>\n<p>Two mechanisms of action have been described for the enterotoxin of <em>B. cereus:</em>&nbsp;one involves the stimulation of the cyclic adenosine monophosphate (<strong>cAMP</strong>) system and the other is independent of it.</p>\n<p>Food poisoning&nbsp;after eating food contaminated with<strong>&nbsp;<em>B. cereus</em>&nbsp;</strong>is of two types:</p>\n<table style=\"height: 242px; width: 385.933px;\">\n<tbody>\n<tr>\n<td style=\"width: 118px;\"><em><strong>Bacillus cereus</strong></em></td>\n<td style=\"width: 130px;\"><strong>Diarrheal type</strong></td>\n<td style=\"width: 112.933px;\"><strong>Emetic type</strong></td>\n</tr>\n<tr>\n<td style=\"width: 118px;\">Incubation period</td>\n<td style=\"width: 130px;\">8&ndash;16 hours</td>\n<td style=\"width: 112.933px;\"><strong>1&ndash;5 hours</strong></td>\n</tr>\n<tr>\n<td style=\"width: 118px;\">Toxin</td>\n<td style=\"width: 130px;\">Secreted in intestine</td>\n<td style=\"width: 112.933px;\">Preformed</td>\n</tr>\n<tr>\n<td style=\"width: 118px;\">Heat</td>\n<td style=\"width: 130px;\">Heat labile</td>\n<td style=\"width: 112.933px;\">Heat stable</td>\n</tr>\n<tr>\n<td style=\"width: 118px;\">Food items</td>\n<td style=\"width: 130px;\">Meat</td>\n<td style=\"width: 112.933px;\">Rice</td>\n</tr>\n<tr>\n<td style=\"width: 118px;\">Clinical feature</td>\n<td style=\"width: 130px;\">Diarrhea, abdominal cramps</td>\n<td style=\"width: 112.933px;\"><strong>Vomiting,</strong> abdominal cramps</td>\n</tr>\n</tbody>\n</table>\n<p><em>B. cereus</em> produces lecithinase and <strong>ferments glucose</strong> but not mannitol. The presence of <strong>1,00,000</strong> or <strong>more bacteria per gram of stool</strong> is diagnostic. Anything less than that may be present as normal flora in the gut. Both types of illnesses are mild and self-limiting, requiring no specific treatment.</p>\n<p>Other options:</p>\n<p>Option A: Food poisoning by <em><strong>Clostridium perfringens</strong></em> is usually caused by the consumption of <strong>cold or warmed-up meat dishes</strong>. After an incubation period of <strong>8-24 hours</strong>, abdominal pain, diarrhea, and vomiting set in. Isolating heat-resistant <em>C. perfringens</em> type A from feces and food is used for the diagnosis.</p>\n<p>Option B: <strong>Enterotoxigenic <em>Escherichia coli</em></strong> is endemic in developing countries of the tropics, seen in all age groups. Its severity varies from mild&nbsp;<strong>watery diarrhea</strong> to a fatal disease indistinguishable from cholera. It has an incubation period of<strong> &gt;16 hours</strong>. Demonstration of the enterotoxins is helpful to establish the diagnosis. It causes <strong>traveler's diarrhea</strong> in people from non-endemic areas visiting endemic areas.</p>\n<p>Option C: <em><strong>Staphylococcus aureus</strong></em>&nbsp;enterotoxin is responsible for staphylococcal food poisoning. It presents with nausea, vomiting, and diarrhea after&nbsp;<strong>2&ndash;6 hours</strong> of consuming contaminated food. <strong>Meat, fish, milk, </strong>and<strong> milk products</strong>&nbsp;that are cooked and left at room temperature after contamination with <em>Staphylococci</em>, for a long enough time for the toxin to accumulate, are usually responsible. The source of infection is usually a food handler who is a<strong> carrier</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 16-year-old boy is admitted with fever, icterus, and headache for the past 5 days. The life cycle of the causative organism is given below. Which serological test should be done for diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Widal test"
      },
      {
        "id": 2,
        "text": "Microscopic agglutination test"
      },
      {
        "id": 3,
        "text": "Weil felix reaction"
      },
      {
        "id": 4,
        "text": "Paul Bunnell test"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>&nbsp;The given clinical scenario and the life cycle shown in the image is suggestive of&nbsp;<strong>leptospirosis (Weil's disease).</strong> A<strong> microscopic agglutination test</strong>&nbsp;is used for the diagnosis of leptospirosis.</p>\n<p>Leptospirosis is a <strong>zoonotic</strong> disease caused by <strong>leptospira</strong>. Humans are <strong>infected</strong> when the leptospires in<strong> water contaminated</strong> by the urine of carrier animals enter the body through cuts or abrasions on the skin or through the intact mucosa of the mouth, nose, or conjunctiva.</p>\n<p>Clinical features include fever, jaundice, vomiting, headache, and intense injection of the eyes. Some may present as aseptic meningitis or with hepatorenal damage (Weil's disease).</p>\n<p>Diagnosis includes:</p>\n<ul>\n<li><strong>Microscopy</strong> -\n<ul>\n<li>Examination of blood - Leptospires may be demonstrated under the <strong>dark field microscope</strong> or by immunofluorescence. The organism disappears from blood after 1 week.</li>\n<li>Examination of urine: Leptospires appear in the urine in the second week of the disease. Centrifuged deposit of the urine may be examined under dark ground illumination.</li>\n</ul>\n</li>\n<li><strong>Culture</strong> - With semisynthetic media like <strong>EMJH</strong> (Ellinghausen, McCullough, Johnson, Harris) or Korthof's, Stuart's, and Fletcher's media.</li>\n<li><strong>Serotype-specific</strong> tests:&nbsp;\n<ul>\n<li><strong>Microscopic</strong> <strong>agglutination test</strong>&nbsp;(more specific)</li>\n<li>Macroscopic agglutination test &nbsp;</li>\n<li>A rapid diagnostic test to detect leptospira-specific IgM antibody in human sera.</li>\n</ul>\n</li>\n</ul>\n<p>The treatment of choice is<strong>&nbsp;IV penicillin </strong>or<strong> IV ceftriaxone.&nbsp;</strong>Doxycycline 200 mg orally given once a week is effective in prophylaxis.</p>\n<p>Option A: <strong>Widal test</strong> is used to screen for typhoid fever.</p>\n<p>Option C: <strong>Weil-Felix reaction</strong> is used to diagnose rickettsial fevers &nbsp;</p>\n<p>Option D: <strong>Paul-Bunnell test</strong> is the investigation of choice for infectious mononucleosis.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/4f137f036bc340aeb58cb0faf66abfdc.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Match the following images of genital tract infections to their microscopic images.",
    "choices": [
      {
        "id": 1,
        "text": "i-A; ii-C; iii-B"
      },
      {
        "id": 2,
        "text": "i-C; ii-A; iii-B"
      },
      {
        "id": 3,
        "text": "i-B;  ii-A; iii- C"
      },
      {
        "id": 4,
        "text": "i-A; ii-B; iii-C"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Image (i)</strong> is of a <strong>strawberry cervix</strong>, which matches <strong>image C</strong> for <em><strong>Trichomas vaginalis.\u00a0</strong>Trichomonas vaginalis\u00a0</em>can be identified by the presence of racquet shaped protozoan with four anterior flagella and one posterior flagellum.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/28353eb25e3a4f649012610194c9f801.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/faf783a4a7b846ad91bcc2a51d3ec702x1280x548.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6d8f12f71c864c939ecefa0d49c2f40cx1280x745.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/cc2a04ccb22340cdb95c1c80d3dadc4dx1280x565.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/05ff7f684d9b43c5ab589a2a29cc22acx512x387.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1a8dcbee74524ce781349e5aa17c799cx720x740.JPEG"
    ]
  },
  {
    "text": "A 48-year-old alcoholic presented to the casualty with fever, productive cough and dyspnea. Chest X-Ray was performed which showed the following finding. Sputum culture was sent which showed lactose fermenting, mucoid colonies on MacConkey agar. What is the causative organism?",
    "choices": [
      {
        "id": 1,
        "text": "Streptococcus pneumoniae"
      },
      {
        "id": 2,
        "text": "Klebsiella pneumoniae"
      },
      {
        "id": 3,
        "text": "Pseudomonas aeruginosa"
      },
      {
        "id": 4,
        "text": "Haemophilus influenzae"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario and chest X-ray showing <strong>bulging fissure sign</strong> are highly suggestive of <strong>lobar pneumonia</strong> caused by<em>\u00a0</em><strong><em>Klebsiella pneumonia.</em></strong></p>\n<p><em>K. pneumoniae</em> causes lobar pneumonia\u00a0in <strong>alcoholics</strong> and diabetics. The patient characteristically presents with\u00a0fever, dyspnea, and a productive cough with<strong>\u00a0red currant jelly sputum.</strong></p>\n<p>Classic <strong>chest X-ray</strong> findings include:</p>\n<ul>\n<li><strong>Upper lobe consolidation</strong> - classically on the right side.</li>\n<li>Cavitation</li>\n<li><strong>Bulging fissure sign</strong> - expansive lobar consolidation and inflammatory exudates cause the lower border of the upper lobe to bulge. It can also be seen with space-occupying lesions of the lung, such as pulmonary hemorrhage, lung abscess, and tumor.\u00a0</li>\n</ul>\n<p>The following image shows bulging fissure sign.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/91403ef1642848a896cc0ac697d9ab82.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f45b18e9b6fb4c68b2447b502c2dee40x720x842.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b1884ee13c8642a18c403ee9b11614dbx800x479.JPEG"
    ]
  }
];
        let quizName = 'Integrated Mini Test 9 - Microbiology';
        const quizFilename = 'integrated-mini-test-9-microbiology-9d2dcc36.html';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2024-25"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>