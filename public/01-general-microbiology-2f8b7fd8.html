<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>01 General Microbiology - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Microbiology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">23</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Identify the condenser in the following image.",
    "choices": [
      {
        "id": 1,
        "text": "Above the stage"
      },
      {
        "id": 2,
        "text": "Below the stage"
      },
      {
        "id": 3,
        "text": "Near the eyepiece"
      },
      {
        "id": 4,
        "text": "Above the objective lenses"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The purpose of the condenser lens is to <strong>focus </strong>the light from the illuminator onto the <strong>specimen</strong>. Microscopes with a stage condenser lens render a <strong>sharper image</strong> than those with no condenser lens.</p>\n<p>The <strong>simple microscope</strong> was invented first by\u00a0<strong>Antonie van Leeuwenhoek, </strong>the father of microscopy and microbiology. It uses <strong>1 lens</strong> for magnification. The <strong>compound microscope</strong>, introduced by Hans and Zacharias Janssen uses <strong>2 lenses</strong>, an objective lens and an eyepiece, to provide <strong>better magnification</strong> power than the simple microscope.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/7ff62277586e4d888e78c475ea63dc96.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/abe685cceae541b586b31df0d6b9d8d7x600x619.JPEG"
    ]
  },
  {
    "text": "A 28-year-old sex worker presented with a painless ulcer on her vulva. On examination, inguinal lymphadenopathy is present. Which of the following methods has been used to demonstrate the causative agent as per the given image?",
    "choices": [
      {
        "id": 1,
        "text": "Dark-field microscopy"
      },
      {
        "id": 2,
        "text": "Phase contrast microscopy"
      },
      {
        "id": 3,
        "text": "Fluorescent microscopy"
      },
      {
        "id": 4,
        "text": "Electron microscopy"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>A painless genital ulcer with inguinal lymphadenopathy with the presence of spiral organisms on microscopy is suggestive of <strong>syphilis.</strong> It is caused by <em><strong>Treponema pallidum,\u00a0</strong></em>demonstrated by\u00a0<strong>d</strong><strong>ark-field microscopy.\u00a0</strong></p>\n<p>Dark-field microscopy images have a <strong>dark background</strong> with a <strong>refractile organism</strong>. The dark ground microscope has an optical system that <strong>enhances</strong> the<strong> contrast</strong>\u00a0of\u00a0<strong>unstained</strong> bodies. It uses reflected light and has a higher resolving power than the light microscope. Dark-field microscopy is the the most specific and sensitive technique to visualize <em>Treponema pallidum</em> when an active chancre or condyloma lata is present.</p>\n<p>Other options:</p>\n<p>Option B: <strong>Phase contrast </strong>microscopy improves the contrast to delineate structures within cells. A dark image is formed on a light background.</p>\n<p>Option C: <strong>Fluorescent</strong> microscopy uses fluorescent dyes like auramine-rhodamine to appreciate Mycobacterial species and malarial parasites.\u00a0</p>\n<p>Option D: The<strong>\u00a0electron microscope</strong>, invented by\u00a0Ernst Ruska, helps in appreciating <strong>viral structures.\u00a0</strong>It has a very high resolving power.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/9344114b08274ce392d349a6a9c5a28b.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which among the following statements is false?",
    "choices": [
      {
        "id": 1,
        "text": "Muramic acid is present in prokaryotes"
      },
      {
        "id": 2,
        "text": "Mitotic division is present in eukaryotes"
      },
      {
        "id": 3,
        "text": "80S ribosome is present in prokaryotes"
      },
      {
        "id": 4,
        "text": "Multiple linear chromosomes present in eukaryotes"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>80S ribosome</strong> is present in <strong>e</strong><strong>ukaryotes</strong>, while <strong>70S ribosome</strong> is present in <strong>p</strong><strong>rokaryotes</strong>.</p>\n<p>80S ribosome has subunits 60S and 40S, while 70S has subunits 50S and 30S.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8568a624eb0441ec9428839975d407fdx1280x1114.JPEG"
    ]
  },
  {
    "text": "Which of the following methods will not help you visualize the bacterial cell wall?",
    "choices": [
      {
        "id": 1,
        "text": "Fluorescence microscopy"
      },
      {
        "id": 2,
        "text": "Electron microscopy"
      },
      {
        "id": 3,
        "text": "Differential staining"
      },
      {
        "id": 4,
        "text": "Simple staining"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The <strong>cell wall</strong> of bacteria <strong>cannot\u00a0</strong>be seen with<strong>\u00a0simple stains</strong>\u00a0or<strong>\u00a0direct light microscopy.</strong></p>\n<p>The bacterial cell wall is present outside the plasma membrane and confers strength and shape to the cell. It is composed of <strong>peptidoglycans</strong>. The cell wall can be demonstrated by the following methods:</p>\n<ul>\n<li>Plasmolysis</li>\n<li>Microdissection</li>\n<li>Reaction with specific antibodies</li>\n<li>Mechanical rupture of the cell</li>\n<li><strong>Differential staining</strong> procedures (E.g. Chance's method)</li>\n<li><strong>Electron microscopy</strong></li>\n<li><strong>Fluorescence microscopy</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In which of the following phases of the bacterial growth curve does sporulation occur?",
    "choices": [
      {
        "id": 1,
        "text": "D"
      },
      {
        "id": 2,
        "text": "A"
      },
      {
        "id": 3,
        "text": "C"
      },
      {
        "id": 4,
        "text": "B"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Sporulation</strong> occurs in the\u00a0<strong>stationary phase</strong>\u00a0of the bacterial growth curve, which is marked as <strong>C</strong>\u00a0in the image.</p>\n<p>The bacterial growth curve is obtained when a batch of bacteria is seeded in a liquid medium and incubated. It consists of 4 distinct phases:</p>\n<ol>\n<li><strong>Lag</strong> phase (A) - The bacteria adapt to a new environment. They synthesize and accumulate enzymes and metabolic intermediates required for multiplication. Thus, there is no increase in cell number but cell size increases. <strong>Maximum cell size</strong> is obtained towards the end of this phase.</li>\n<li><strong>Log </strong>or\u00a0<strong>exponential </strong>phase<strong>\u00a0</strong>(B) - The bacteria<strong> </strong>start <strong>dividing</strong> and their <strong>numbers increase</strong> exponentially with time. Cells are smaller and stain uniformly. The growth rate is constant.\u00a0</li>\n<li><strong>Stationary </strong>phase<strong> </strong>(C) - There is depletion of nutrients and accumulation of toxic products. Thus, cell division reduces and a state of <strong>equilibrium </strong>is attained, where the number of new cells formed equals the number that die. Growth rate is zero. <strong>Sporulation</strong> occurs during this phase.\u00a0Many bacteria produce secondary metabolic products such as <strong>exotoxins</strong> and <strong>antibiotics.</strong></li>\n<li><strong>Death</strong> phase or the<strong> </strong>phase of<strong> decline\u00a0</strong>(D) - Growth rate is negative. The <strong>population decreases</strong> due to cell death from nutritional exhaustion, toxin accumulation and the action of autolytic enzymes. Involution forms are common.</li>\n</ol>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/eea81ca0bb234241a3a29f89de33fd42.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0c3dcc2e65fe4335a5e221dc2852bfc7x1280x1252.JPEG"
    ]
  },
  {
    "text": "Which organism has the following cell wall structure?",
    "choices": [
      {
        "id": 1,
        "text": "Gram-positive organism"
      },
      {
        "id": 2,
        "text": "Gram-negative organism"
      },
      {
        "id": 3,
        "text": "Fungi"
      },
      {
        "id": 4,
        "text": "Mycobacteria"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Other options:</p>\n<p>Option C: The cell wall of <strong>fungi</strong> consists of chitin, mannan, and polysaccharides (glucan).</p>\n<p>Option D: The cell wall of <strong>mycobacteria</strong> have mycolic acid, which is responsible for acid fastness.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/4f723f7564bb4eeead08c6a350412652.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c71e961d160a417b927611ccc62306a8x1280x1114.JPEG"
    ]
  },
  {
    "text": "Which of the following helps in bacterial adhesion?",
    "choices": [
      {
        "id": 1,
        "text": "Cytoplasmic membrane"
      },
      {
        "id": 2,
        "text": "Mesosomes"
      },
      {
        "id": 3,
        "text": "Fimbriae"
      },
      {
        "id": 4,
        "text": "Lipopolysaccharides"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p class=\"p1\"><strong>Fimbriae</strong> help in <strong>bacterial adhesion</strong>.</p>\n<p class=\"p1\">Fimbriae, also called <strong>pili</strong>,<strong> </strong>are hair-like surface appendage that projects from the cell surface as straight filaments. They are primarily seen in Gram-negative bacteria. They are polymers of <strong>pilin</strong>. Fimbriae are classified based on the function as ordinary pili - for adhesion - and sex pili - involved in bacterial conjugation. The functions of pili are given below:</p>\n<ul>\n<li class=\"p1\"><strong>Bacterial conjugation </strong>through sex pili, which transfer of genetic material occurs.</li>\n<li class=\"p1\"><strong>Bacterial adhesion</strong> of symbiotic and pathogenic bacteria to host cells using adhesins.</li>\n<li class=\"p1\">Resistance to phagocytosis.</li>\n<li class=\"p1\">Antigenic pilin\u00a0proteins are responsible for the immune response.</li>\n<li class=\"p1\">Twitching motility to bacteria.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Pasteurization is done at  ______.",
    "choices": [
      {
        "id": 1,
        "text": "73 degree Celsius for 20 minutes"
      },
      {
        "id": 2,
        "text": "63 degree Celsius for 30 minutes"
      },
      {
        "id": 3,
        "text": "72 degree Celsius for 30 seconds"
      },
      {
        "id": 4,
        "text": "63 degree Celsius for 30 seconds"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Pasteurization </strong>is done at 63 degree Celsius for 30 minutes.</p>\n<p>Pasteurization is the process of applying heat to milk to kill or stunt the growth of pathogenic bacteria. It was developed by Louis Pasteur. There are two methods for pasteurization:</p>\n<ul>\n<li><strong>Holder</strong> method: Milk is heated at 63\u00b0C for 30 minutes</li>\n<li><strong>Flash </strong>process: Milk is heated to 72\u00b0C for 15\u201320 seconds</li>\n</ul>\n<p>Once heated appropriately, the milk is\u00a0<strong>cooled</strong>\u00a0quickly to\u00a0<strong>13\u00b0C</strong> or lower. All the\u00a0<strong>non-sporing</strong> pathogens (mycobacteria, brucellae, salmonellae) are killed in pasteurization. In the Holder method, heat resistant<em> </em><strong><em>Coxiella burnetti</em> </strong>may survive.\u00a0</p>\n<p>Note: <strong>Louis Pasteur</strong> pioneered the techniques of pasteurization and sterilization. He also first advanced the <strong>germ theory</strong> of<strong> </strong>disease which states that most diseases were caused by microorganisms. Furthermore, he disproved the theory of spontaneous generation and developed <strong>vaccines</strong> for<strong> </strong>rabies and fowl cholera. He is thus known as the<strong> father</strong> of <strong>modern microbiology.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following methods of sterilization involves exposure to 100 \u00b0C for 20 minutes on 3 successive days?",
    "choices": [
      {
        "id": 1,
        "text": "Autoclaving"
      },
      {
        "id": 2,
        "text": "Tyndallization"
      },
      {
        "id": 3,
        "text": "Pasteurization"
      },
      {
        "id": 4,
        "text": "Inspissation"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The method of sterilization that involves exposure at <strong>100\u00b0C </strong>for <strong>20 minutes</strong> for<strong> 3 successive days </strong>is called <strong>ty</strong><strong>ndallization </strong>or<strong> intermittent sterilization.</strong>\u00a0</p>\n<p>Tyndallization, which utilizes steam, was used for sterilization of media containing gelatin, egg, serum, or sugar. This method may not kill spores of certain anaerobes and thermophiles.\u00a0<strong>Autoclaving </strong>has<strong> replaced</strong> this method<strong> </strong>now.\u00a0</p>\n<p>Other options:</p>\n<p>Option A: <strong>Autoclaving</strong> involves heating at 121\u00b0C for 15 minutes at a pressure of 15psi. This is the used for intruments, linen, laboratory ware.</p>\n<p><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">Option C: In <strong>pasteurization</strong>, milk is heated at either 63\u00b0C for 30 minutes (the holder method) or at 72\u00b0C for 15\u201320 seconds (the flash process), followed by cooling quickly to 13\u00b0C or lower.\u00a0</span></p>\n<p>Option D: Heating an article at 80\u201385 \u00b0C\u00a0for 30 minutes on 3 consecutive days is called <strong>inspissation</strong>.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following works by disrupting the cell membrane?",
    "choices": [
      {
        "id": 1,
        "text": "Lysol"
      },
      {
        "id": 2,
        "text": "Povidone-iodine"
      },
      {
        "id": 3,
        "text": "Thiomersal"
      },
      {
        "id": 4,
        "text": "Ethylene oxide"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Lysol</strong>\u00a0works by disrupting the <strong>cell membrane.</strong>\u00a0</p>\n<p>Lysol is a<strong> phenol </strong>compound, which is obtained by distillation of coal tar. Phenols cause cell membrane damage and inactivate membrane-bound oxidases and dehydrogenases. This causes lysis and release of cell contents. Low concentrations of phenol can precipitate proteins. They are not inactivated by organic matter and are thus useful disinfectants.\u00a0</p>\n<p>The mechnisms of action of other disinfecting agents are:</p>\n<ol>\n<li>DNA damage\n<ul>\n<li>Ionizing radiation</li>\n<li>Ultraviolet light</li>\n<li>Hydrogen peroxide</li>\n<li>DNA reactive chemicals like acriflavin.\u00a0</li>\n</ul>\n</li>\n<li>Protein modification\n<ul>\n<li>Alcohol</li>\n<li>Chlorine</li>\n<li><strong>Iodine</strong></li>\n<li>Heavy metals (e.g. <strong>thiomersal</strong>)</li>\n<li>Hydrogen peroxide</li>\n<li>Formaldehyde</li>\n<li>Glutaraldehyde</li>\n<li><strong>Ethylene oxide</strong></li>\n<li>Acids and alkalis</li>\n</ul>\n</li>\n</ol>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following methods is used in the test shown below?",
    "choices": [
      {
        "id": 1,
        "text": "Streak culture"
      },
      {
        "id": 2,
        "text": "Lawn culture"
      },
      {
        "id": 3,
        "text": "Stroke culture"
      },
      {
        "id": 4,
        "text": "Stab culture"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given image shows\u00a0<strong>antibiotic sensitivity testing </strong>which uses the <strong>lawn culture</strong> method.</p>\n<p>Lawn or carpet culture is the method in which a uniform surface growth of bacterium is present on the medium. It is used for antibiotic sensitivity testing (disc method) and bacteriophage typing. <strong>Stab culture</strong> (option D) is used for demonstration of gelatin liquefaction and oxygen requirements of bacterium, for maintenance of stock cultures.\u00a0<strong>Streak culture</strong> (option A) is routinely used for the isolation of bacteria in pure culture from clinical specimens. <strong>Stroke culture</strong> (option C) is used for providing pure growth of bacterium for slide agglutination and other diagnostic tests. Other methods of culture include:\u00a0</p>\n<ul>\n<li>Liquid culture - These are preferred for inocula containing antibiotics and other inhibitory substances.</li>\n<li>Pour plate culture - It gives an estimate of viable bacterial count in a suspension.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/cfa87a4962524d5ba3ed7a6f17ad729d.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5793b45ab13a4ab28d3726faf4cdec52x1280x7594.JPEG"
    ]
  },
  {
    "text": "In which of the following organisms will the following phenomenon not be observed in?",
    "choices": [
      {
        "id": 1,
        "text": "Bacillus anthracis"
      },
      {
        "id": 2,
        "text": "Klebsiella pneumoniae"
      },
      {
        "id": 3,
        "text": "Neisseria gonorrheae"
      },
      {
        "id": 4,
        "text": "Hemophilus influenzae"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given image shows <strong>Quellung</strong> reaction (halo around the bacteria) and is seen in <strong>capsulated bacteria</strong>.\u00a0<strong><em>Neisseria</em> </strong><em><strong>gonorrhoeae</strong>\u00a0</em>is <strong>not capsulated,\u00a0</strong>therefore Quellung reaction will not be observed in it.\u00a0</p>\n<p>In Quellung reaction, a suspension of a capsulated bacterium is mixed with its specific anticapsular serum and examined under the microscope. The anticapsular antibodies bind to the capsule and thus the capsule becomes very prominent and appears swollen. Capsulated organisms can be remembered with the following mnemonic:\u00a0</p>\n<p><strong>S</strong>ome -<em><strong> S</strong>treptococcus pneumoniae</em></p>\n<p><strong>K</strong>illers - <em><strong>K</strong>lebsiella pneumoniae</em></p>\n<p><strong>H</strong>ave - <em><strong>H</strong>aemophilus influenzae</em></p>\n<p><strong>N</strong>ice -<em><strong> N</strong>eisseria meningitidis</em></p>\n<p><strong>C</strong>apsules - <em><strong>C</strong>ryptococcus neoformans</em></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d54e9fd513524dc88676ccce220cdfbb.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 32-year-old laborer working at a construction site presented with fever and hemoptysis. The sputum sample collected for examination showed the following. The smear will be stained by which of the following sequences?",
    "choices": [
      {
        "id": 1,
        "text": "Gentian violet - iodine - alcohol - saffranin"
      },
      {
        "id": 2,
        "text": "Methylene blue - malachite green- acetic acid-water"
      },
      {
        "id": 3,
        "text": "Methanol-methylene blue-acid-water"
      },
      {
        "id": 4,
        "text": "Carbol fuschin - acid-alcohol - methylene blue"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Option A: It depicts the order of Gram staining, which was discovered by <strong>Hans Christian Gram</strong> in 1884.</p>\n<ul>\n<li>Primary staining\u00a0with\u00a0para-rosaniline dye (crystal violet, methyl violet or gentian violet).</li>\n<li>Application of\u00a0dilute solution of iodine.</li>\n<li>Decolorisation\u00a0with an\u00a0organic solvent (ethanol, acetone, aniline).</li>\n<li>Counterstaining\u00a0with the dye of\u00a0contrasting colour (carbol fuchsin, safranine, neutral red).</li>\n</ul>\n<p>\u00a0Option B: It includes the steps for performing <strong>Albert's stain\u00a0</strong>which is used for detected <em>Corynebacterium diphtheriae.\u00a0</em></p>\n<ul>\n<li>A heavy smear of the bacterial isolate is prepared on a glass slide and allowed to dry without fixing.</li>\n<li>Albert\u2019s stain is applied for (3-4) minutes. Then it is washed with water and Albert\u2019s iodine is applied for one minute.</li>\n<li>Wash with water and let dry with blotting paper.</li>\n<li>Examine the slide under oil immersion.</li>\n</ul>\n<p><em>Corynebacterium diphtheriae</em>\u00a0are slender bacilli with an arrangement resembling the letters V or L. They have metachromatic granules at the poles of bacilli which are also called polar bodies, volutin, or Babes-Ernst granules.\u00a0Albert staining is useful in the demonstration of metachromatic granules. The presence of metachromatic granules helps to distinguish C.diphtheriae from diphtheroids which lack them.\u00a0The images below show<em>\u00a0Corynebacterium diphtheriae.</em>\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/df1dfb0b7ef84d8aad96e9d50c301105.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8edb42ebf48a4090ad31422bf13da0c3x799x599.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9c9e7a83cf584598971f5a3b436ef50ax1280x2413.JPEG"
    ]
  },
  {
    "text": "Given are a few case scenarios. The etiological agents of which of the following are microaerophilic?",
    "choices": [
      {
        "id": 1,
        "text": "2 and 5"
      },
      {
        "id": 2,
        "text": "3 and 4"
      },
      {
        "id": 3,
        "text": "1 and 4"
      },
      {
        "id": 4,
        "text": "1 and 2"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The aetiological agents of <strong>1</strong> and <strong>2</strong> are<strong>\u00a0microaerophilic</strong>.\u00a0</p>\n<p>The given case scenarios are:</p>\n<p>1. A businessman with epigastric pain and positive urease test has <strong>peptic ulcer disease</strong>, caused by <strong><em>Helicobacter pylori</em></strong>. It is <strong>microaerophilic</strong>.<br />2. Diarrhea caused by Gram-negative, small, spirally curved rod-like, motile bacilli describes <em><strong>Campylobacter jejuni</strong></em>. It is <strong>microaerophilic</strong>.<br />3. Rice-water diarrhea and Gram-negative curved bacilli with 'fish-in-stream' appearance describes <strong>cholera</strong> caused by <em><strong>Vibrio cholerae</strong></em>. It is a facultative anaerobe.<br />4. Nasopharyngeal swab from a child with paroxysmal cough showing 'mercury drops' colonies describes <strong><em>Bordetella pertussis</em></strong>. It is an obligate aerobe.<br />5. Dry, rough, raised, irregular colonies on LJ medium describes <em><strong>Mycobacerium tuberculosis</strong></em>. It is an obligate aerobe<strong>.</strong></p>\n<p><strong>Microaerophilic</strong> organisms grow best in <strong>low oxygen </strong>tension (2-10% oxygen).</p>\n<p>Note: Mycobacteria, such as <em>M. bovis,</em>\u00a0can grow at oxygen tensions ranging from atmospheric to microaerophilic conditions. However,<em> M. tuberculosis</em> is an obligate aerobe.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The given image shows a culture medium with lactose fermenting and non-lactose fermenting bacteria. Which of the following is not a component of the culture medium?",
    "choices": [
      {
        "id": 1,
        "text": "Taurocholate"
      },
      {
        "id": 2,
        "text": "Peptone"
      },
      {
        "id": 3,
        "text": "Neutral red"
      },
      {
        "id": 4,
        "text": "Cysteine"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given image shows <strong>MacConkey agar</strong>. <strong>Cysteine</strong> is <strong>not</strong> a constituent of MacConkey agar.\u00a0</p>\n<p>MacConkey agar is a <strong>differential</strong> or <strong>indicator </strong>medium. <strong>Lactose-fermenting</strong> organisms (Eg: <em>E. coli</em>) produce a <strong>pink</strong> color, and <strong>non-lactose fermenting</strong> organisms (<em>Shigella</em> sp., <em>Salmonella</em> sp.) <strong>do not change</strong> the color.\u00a0Contents of MacConkey agar include <strong>p</strong>eptone,<strong> l</strong>actose, <strong>a</strong>gar, <strong>n</strong>eutral red and <strong>s</strong>odium taurocholate (Mnemonic- PLANT). MacConkey agar is also a <strong>selective</strong> medium i.e. the bile salts (sodium taurocholate) and dyes (neutral red) inhibit the growth of Gram-positive organisms and Gram-negative cocci.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ed5014b9750f49e289f0d7723daef45b.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following is an enrichment medium?",
    "choices": [
      {
        "id": 1,
        "text": "B"
      },
      {
        "id": 2,
        "text": "C"
      },
      {
        "id": 3,
        "text": "A"
      },
      {
        "id": 4,
        "text": "D"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The image 'A' represents <strong>alkaline peptone water</strong>, which is\u00a0an <strong>enrichment medium</strong> used for <em><strong>Vibrio cholerae.</strong></em></p>\n<p>The other images represent:</p>\n<p>Image B- Blood agar with <em>P. aeruginosa</em> colonies\u00a0</p>\n<p>Image C- Loeffler's serum slope, which is used to isolate <em>C. diphtheriae</em></p>\n<p>Image D- Chocolate agar with <em>F. tularensis</em> colonies</p>\n<p>Enrichment media suppress the growth of commensal bacteria and allow for the growth of certain organisms. These media are used for samples with mixed flora e.g. stool. They are always <strong>liquid</strong> media, like alkaline peptone water. Other examples include <strong>tetrathionate broth</strong>\u00a0and <strong>selenite-F broth</strong> for <em>Salmonella sp.</em> and <em>Shigella sp.</em></p>\n<p><strong>Enriched medium</strong> are those media to which additional nutrients such as blood, serum, or egg are added. They're used to grow bacteria with specific nutritional requirements. Examples include <strong>blood agar </strong>to test the hemolytic property of bacteria, <strong>chocolate agar</strong> for isolation of <em>H. influenzae </em>and\u00a0<strong>Loeffler's serum slope</strong> for isolation of <em>C. diphtheriae</em>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/6f7e786d805848d8874befe09700754a.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A microbiologist observes the following growth on a blood agar plate. Which of the following will not be the etiological agent?",
    "choices": [
      {
        "id": 1,
        "text": "Clostridium tetani"
      },
      {
        "id": 2,
        "text": "Corynebacterium diphtheriae"
      },
      {
        "id": 3,
        "text": "Proteus mirabilis"
      },
      {
        "id": 4,
        "text": "Bacillus cereus"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The above image shows a\u00a0<strong>swarming type</strong> of growth on the agar plate. It will not be caused by<strong><em> Corynebacterium diphtheriae.</em></strong></p>\n<p>Swarming is the growth of motile bacteria in the form of a thin film on solid culture media. It is exhibited by the following:</p>\n<ul>\n<li>Gram-positive bacilli - <em><strong>Clostridium tetani</strong></em> (option A),\u00a0<em><strong>Bacillus cereus\u00a0</strong></em>(option D)</li>\n<li>Gram-negative bacilli - <em><strong>Proteus mirabilis</strong></em><strong> </strong>(option C),\u00a0<em>Proteus vulgaris</em></li>\n<li>Gram-negative\u00a0halophilic bacteria-\u00a0<em>Vibrio parahaemolyticu</em>s\u00a0</li>\n</ul>\n<p>Swarming can be<strong> inhibited</strong> by increasing the concentration of agar (6%), alcohol, sodium azide,\u00a0boric acid,\u00a0chloral hydrate,\u00a0sulfonamide, and surface-active agents.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/4822703d654c43d195961fb46450518b.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Bacterial transduction occurs by",
    "choices": [
      {
        "id": 1,
        "text": "Plasmids"
      },
      {
        "id": 2,
        "text": "Sex pili"
      },
      {
        "id": 3,
        "text": "Bacteriophage"
      },
      {
        "id": 4,
        "text": "Uptake of genetic material by other bacteria."
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Bacterial transduction occurs by<strong> bacteriophages</strong>.</p>\n<p><strong>Transduction</strong> is a process of <strong>acquiring bacterial DNA</strong> from a bacteriophage (virus) that has incorporated bacterial DNA from previous host bacteria.</p>\n<p>Other methods of exchange of genetic material are transformation and conjugation.\u00a0<strong>Transformation </strong>involves the <strong>uptake </strong>of genetic material from the\u00a0<strong>environment,</strong> which is released by other bacteria.\u00a0<strong>Conjugation</strong>\u00a0is the <strong>direct transfer</strong> of DNA from one bacterial cell to another bacterial cell through a <strong>sex pilus</strong> or bridge. The transferred DNA is a\u00a0plasmid, a circle of DNA that is distinct from the main bacterial chromosome.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ef1f4b7b9c344fd59397dc29e3b6f8f3x1117x517.JPEG"
    ]
  },
  {
    "text": "Which of the following principles is primarily used in polymerase chain reaction?",
    "choices": [
      {
        "id": 1,
        "text": "Transcription of DNA"
      },
      {
        "id": 2,
        "text": "It can amplify small amounts of DNA"
      },
      {
        "id": 3,
        "text": "It can amplify small amounts of RNA"
      },
      {
        "id": 4,
        "text": "Reverse transcription of RNA"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The primary principle used in <strong>polymerase chain reaction </strong>(PCR)\u00a0is the\u00a0<strong>amplification</strong> of small amounts of <strong>DNA</strong>.\u00a0</p>\n<p>PCR is an automated process in which a <strong>single</strong> or a few copies of a DNA piece is amplified to generate of <strong>thousands</strong> to millions of <strong>copies</strong> of that particular DNA sequence. There are 3 basic steps are involved in PCR:</p>\n<ul>\n<li>DNA extraction from microorganism</li>\n<li>Amplification of extracted DNA - Denaturation (95\u00b0C), Primer annealing (55\u00b0C), Extension (72\u00b0C)</li>\n<li>Gel electrophoresis of the amplified product</li>\n</ul>\n<p>PCR is used in rapid diagnostic tests for infections (e.g. HIV DNA), forensic investigations etc.\u00a0The <strong>founder</strong> of <strong>PCR</strong> is <strong>Karry B Mullis.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/51b31ae886574e26aab977cc1df3bed4x1280x667.PNG"
    ]
  },
  {
    "text": "Which of the following describes the reverse transcriptase enzyme used in RT-PCR correctly?",
    "choices": [
      {
        "id": 1,
        "text": "DNA-dependent RNA polymerase"
      },
      {
        "id": 2,
        "text": "RNA-dependent DNA polymerase"
      },
      {
        "id": 3,
        "text": "DNA-dependent DNA polymerase"
      },
      {
        "id": 4,
        "text": "RNA-dependent RNA polymerase"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The enzyme involved in RT-PCR is <strong>reverse transcriptase</strong> (RT) which has <strong>RNA-dependent DNA polymerase</strong> activity.</p>\n<p>In reverse transcription-polymerase chain reation (RT-PCR), reverse transcriptase <strong>synthesizes DNA </strong>from the RNA template. RT-PCR can be used for the demonstration of poliovirus RNA, causing paralytic poliomyelitis, in <strong>CSF</strong>. It can also be used for the detection of viruses from <strong>nasopharyngeal swabs</strong> (SARS-CoV2, H1N1).</p>\n<p>In real-time RT-PCR, <strong>fluorescent dyes</strong> or <strong>DNA probes</strong> are used to<strong> </strong>quantify the pathogen DNA load in the specimen. So, it can be used to quantify viral loads in HIV, hepatitis B, etc., and is also called<strong> quantitative PCR</strong> (qPCR).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/fe6e0e0a13f640ba90841a195d16aa7ex335x424.JPEG"
    ]
  },
  {
    "text": "What are jumping genes known as?",
    "choices": [
      {
        "id": 1,
        "text": "Episomes"
      },
      {
        "id": 2,
        "text": "Plasmids"
      },
      {
        "id": 3,
        "text": "Transposons"
      },
      {
        "id": 4,
        "text": "Cosmids"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Jumping genes</strong> are also called <strong>transposons</strong>.</p>\n<p>Transposons are genetic elements that can move between chromosomal and extra-chromosomal DNA molecules. Insertion of a transposon leads to acquisition of <strong>new characteristics</strong> by the recipient DNA. Transposons contain several genes, including those necessary for their <strong>migration </strong>from one genetic locus to another. They may contain genes for specialised functions like antibiotic resistance. However, they do not contain genes for their replication.</p>\n<p>Jumping genes were discovered by <strong>Barbara McClintock</strong> and she was awarded the\u00a0Nobel Prize in Physiology or Medicine 1983 for the same.\u00a0</p>\n<p>Other options:\u00a0</p>\n<p>Options A and B: The cytoplasmic carriers of\u00a0genetic information are termed <strong>plasmids</strong> or <strong>episomes.</strong></p>\n<p>Option D:\u00a0A <strong>cosmid</strong> is a type of hybrid plasmid that contains a Lambda phage cos sequence. (Cos sites + plasmid = cosmids).\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In which of the following situations will you use a sanitizer?",
    "choices": [
      {
        "id": 1,
        "text": "A, B & C only"
      },
      {
        "id": 2,
        "text": "A & B only"
      },
      {
        "id": 3,
        "text": "A, B C & D"
      },
      {
        "id": 4,
        "text": "C & D only"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Note: </strong>Disinfectants like chlorhexidine and alexidine have a biguanide functional group. They are mostly used as oral disinfectants and hand products. They are bactericidal but not sporicidal. Mycobacteria are also resistant to these compounds.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ed49ba92c81c422786618535b1224e46x1280x1901.JPEG"
    ]
  },
  {
    "text": "An orthopedician is performing the following procedure to visualize the anterior cruciate ligament in a patient. Which of the following will be used to sterilise the instrument used?",
    "choices": [
      {
        "id": 1,
        "text": "Ethylene oxide"
      },
      {
        "id": 2,
        "text": "Gamma rays"
      },
      {
        "id": 3,
        "text": "Hydrogen peroxide"
      },
      {
        "id": 4,
        "text": "Ultraviolet rays"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given image shows arthroscopy being performed. <strong>Arthroscopes</strong> are sterilized using <strong>plasma sterilization\u00a0</strong>which utilises <strong>hydrogen peroxide.\u00a0</strong></p>\n<p>In plasma sterilisation,<strong> radiofrequency energy</strong> is applied to create an <strong>electromagnetic field</strong> through which hydrogen peroxide vapours are passed. This generates <strong>plasma</strong> which<strong> </strong>contains <strong>free radicals</strong> of hydrogen and oxygen. Plasma denatures all organisms and is used\u00a0sterilize<strong> arthroscopes</strong> and <strong>ureteroscopes</strong>.\u00a0Sterilization control is monitored by <em>Geobacillus stearothermophilus</em> and\u00a0<em>Bacillus atrophaeus.\u00a0</em></p>\n<p>Option A: <strong>Ethylene oxide</strong> has both microbicidal and sporicidal activity. It is used for sterilisation heat-sensitive equipment like heart-lung machines, respirators, suture materials etc. Sterilization control is monitored by <em>Bacillius atrophaeus</em> and <em>Bacillus subtilus.</em></p>\n<p>Option B:<strong> Gamma rays</strong> cause breakage of DNA. It destroys spores and vegetative cells, but is not effective against viruses. It is referred to as cold sterilisation and is used in commercial plants to sterilize plastics, syringes, swabs. Sterilization control is monitored by <em>Bacillus pumilius</em>.\u00a0</p>\n<p>Option D: <strong>Ultraviolet rays</strong> are used to sterilise biosafety cabinets, entryways, operation theatres and laboratories.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/07713fe813f44bdab8c336a521cb14ff.PNG"
    ],
    "explanation_images": []
  }
];
        let quizName = '01 General Microbiology';
        let hierarchy = ["Marrow", "qBank", "Microbiology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>