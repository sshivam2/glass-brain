<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>04 Injuries Of  Clavicle, Shoulder And Arm - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Orthopedics
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">19</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which part of the clavicle is most commonly fractured?",
    "choices": [
      {
        "id": 1,
        "text": "Medial third"
      },
      {
        "id": 2,
        "text": "Middle third"
      },
      {
        "id": 3,
        "text": "Lateral third"
      },
      {
        "id": 4,
        "text": "Medial half"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The<strong>&nbsp;middle third&nbsp;</strong>of the clavicle<strong>&nbsp;</strong>is<strong> most commonly fractured</strong>.&nbsp;</p>\n<p>The middle third of the clavicle is&nbsp;<strong>narrowest</strong> and has the <strong>least</strong> amount of<strong> surrounding</strong> <strong>soft tissue </strong>structures. Therefore, 80% of fractures are seen in this area.</p>\n<p>Within the middle-third of the clavicle, the <strong>junction</strong> of the <strong>medial 3/5<sup>th</sup></strong>&nbsp;and the <strong>lateral 2/5<sup>th</sup></strong>&nbsp;has been described to be the <strong>weakest point</strong>.&nbsp;Lateral third fractures are the second most common type of clavicular fractures.</p>\n<p>Fall on the shoulder (direct impact) and fall on the outstretched hand are the most common causes of clavicle fracture.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/64339b793eec494d9e37e8f26b20cadax1280x1209.JPEG"
    ]
  },
  {
    "text": "A biker fell on his shoulder due to an accident. Chest X-ray revealed a fracture of the middle third of the clavicle with the lateral fragment displaced inferiorly. What is the reason for this displacement?",
    "choices": [
      {
        "id": 1,
        "text": "Pull of the sternocleidomastoid muscle"
      },
      {
        "id": 2,
        "text": "Pull of the teres minor muscle"
      },
      {
        "id": 3,
        "text": "Pull of gravity on the arm"
      },
      {
        "id": 4,
        "text": "Pull of the pectoralis muscle"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The <strong>lateral fragment</strong> in a clavicle fracture is <strong>displaced inferiorly</strong> due to the force of&nbsp;<strong>gravity </strong>acting on the <strong>ipsilateral arm</strong>.</p>\n<p>The&nbsp;<strong>medial fragment</strong> is <strong>held up</strong> by the action of the <strong>sternocleidomastoid&nbsp;</strong>muscle.&nbsp;</p>\n<p>&nbsp;</p>\n<p>(Note:&nbsp;Both Pectoralis muscle and the weight of arm are responsible, but since the weight of arm is superior to the muscle bulk and even as per standard reference we would go with the rational explanation.)</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7d7f84b0d50746108ac666ef086befaex1280x1574.JPEG"
    ]
  },
  {
    "text": "Which of the following statements is false regarding clavicular shaft fracture?",
    "choices": [
      {
        "id": 1,
        "text": "The most commonly fractured bone is clavicle"
      },
      {
        "id": 2,
        "text": "Non-union is the most common complication"
      },
      {
        "id": 3,
        "text": "Neurological deficit is rarely seen"
      },
      {
        "id": 4,
        "text": "Displaced fractures are treated with intramedullary nails"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Non-union</strong> is a relatively<strong> rare</strong> complication in clavicle shaft fracture.&nbsp;<strong>Malunion</strong> is the <strong>most common complication</strong> in clavicle fractures</p>\n<p>The <strong>most common</strong> bone to be <strong>fractured</strong> is the <strong>clavicle</strong>. It is also the&nbsp;most common bone to be fractured during birth.&nbsp;<strong>Neurological deficit</strong> is <strong>rare</strong> in clavicular shaft fractures.&nbsp;</p>\n<p><strong>Undisplaced fractures</strong> are treated with a<strong> sling</strong> or <strong>figure of eight bandages</strong> for 2-3 weeks. This is followed by mobilization of the limb as the pain subsides.&nbsp;</p>\n<p><strong>Displaced fractures</strong> are treated with internal fixation either by <strong>contoured locking plates</strong> or <strong>intramedullary nails</strong>. &nbsp;&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e58a38bb574b4d4780d49db1c9cd725ex1280x1280.JPEG"
    ]
  },
  {
    "text": "In which of the following conditions is a Velpeau bandage not used?",
    "choices": [
      {
        "id": 1,
        "text": "Humerus shaft fracture"
      },
      {
        "id": 2,
        "text": "Posterior shoulder dislocation"
      },
      {
        "id": 3,
        "text": "Glenoid fossa fractures"
      },
      {
        "id": 4,
        "text": "Acromioclavicular dislocation"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Velpeau bandage is not used in <strong>glenoid fossa fractures</strong> as they require <strong>surgical fixation</strong> because they are <strong>intra-articular</strong>.</p>\n<p><strong>Velpeau bandaging</strong> is done by keeping the patient's<strong> elbow flexed</strong> and the<strong>&nbsp;forearm</strong> placed <strong>against the chest</strong>.&nbsp;A sling is then applied to support the weight of the arm. Several layers of restrictive bandages are then applied around the arm and the torso.&nbsp;</p>\n<p>Velpeau bandage is commonly used for:</p>\n<ul>\n<li>Acromioclavicular dislocations</li>\n<li>Humeral shaft fractures&nbsp;</li>\n<li>After open reduction of posterior&nbsp;shoulder dislocation</li>\n</ul>\n<p><strong>Acromioclavicular joint injuries&nbsp;</strong>are usually seen with<strong> direct injury</strong> to the <strong>lateral shoulder</strong>. They are also seen after fall on an&nbsp;outstretched arm with the elbow locked in extension.</p>\n<p>They are classified into six types using the <strong>Rockwood classification</strong>.<strong>&nbsp;Type 1-3</strong> is managed conservatively using the <strong>Velpeau bandage</strong>. <strong>Type 4-6</strong> is treated by <strong>open reduction</strong> and <strong>internal fixation</strong>. &nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d55356f2a34248ed8ccdf83fcb813411x1280x1400.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d04ac4113ee646afaba2fe59a1aff948x499x306.JPEG"
    ]
  },
  {
    "text": "Which is the most important ligament for maintaining shoulder joint stability?",
    "choices": [
      {
        "id": 1,
        "text": "Superior glenohumeral ligament"
      },
      {
        "id": 2,
        "text": "Middle glenohumeral ligament"
      },
      {
        "id": 3,
        "text": "Inferior glenohumeral ligament"
      },
      {
        "id": 4,
        "text": "Coracoacromial ligament"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The<strong> inferior glenohumeral ligament&nbsp;</strong>is the <strong>most important</strong> in maintaining shoulder joint stability. It&nbsp;is the <strong>main stabilizer </strong>when the <strong>shoulder</strong> is&nbsp;abducted&nbsp;and in extreme ranges of motion.&nbsp;</p>\n<p>The shoulder joint is anatomically unstable. Only 25% of the humeral head articulates with the glenoid.</p>\n<p>The joint is reinforced by:</p>\n<ul>\n<li><strong>Static stabilizers</strong> (3 capsular thickenings or ligaments):\n<ul>\n<li>Superior glenohumeral ligament (SGHL)</li>\n<li>Middle&nbsp;glenohumeral ligament (MGHL)</li>\n<li>Inferior glenohumeral ligament (IGHL)</li>\n</ul>\n</li>\n</ul>\n<ul>\n<li><strong>Dynamic stabilizers&nbsp;</strong>(rotator cuff muscles)<strong>:</strong>&nbsp;\n<ul>\n<li><strong>S</strong>upraspinatus</li>\n<li><strong>I</strong>nfraspinatus</li>\n<li><strong>T</strong>eres minor</li>\n<li><strong>S</strong>ubscapularis&nbsp;</li>\n<li>The long head of biceps &nbsp;</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c384ee67b1ff4f5cbcaa0cf5ee3cce24x1280x1433.JPEG"
    ]
  },
  {
    "text": "A young cricketer presented with severe pain and deformity of the shoulder following bowling practice. The AP-view radiograph of the affected shoulder is given below. Which of the following statements is false regarding this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Bankart lesion may occur as a complication"
      },
      {
        "id": 2,
        "text": "Recurrence is associated with Hill-Sachs lesion"
      },
      {
        "id": 3,
        "text": "Radial nerve is most commonly injured"
      },
      {
        "id": 4,
        "text": "It can also be caused by a fall on the hand"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>This radiograph shows <strong>anterior dislocation</strong> of the shoulder. The nerve <strong>commonly injured</strong> in anterior dislocation is the&nbsp;<strong>axillary nerve</strong>, not the radial nerve.<strong>&nbsp;</strong></p>\n<p class=\"p1\">The radiograph shows the disturbed articulation between the humeral head and glenoid fossa. The <strong>humeral head</strong> is seen <strong>below</strong> and <strong>medial</strong> <strong>to</strong> the <strong>glenoid</strong> socket. This suggests anterior dislocation of the shoulder joint.&nbsp;</p>\n<p class=\"p1\"><strong>Common cause</strong> for anterior dislocation:</p>\n<ul>\n<li class=\"p1\">Young adults&nbsp;-&nbsp;athletic injuries</li>\n<li class=\"p1\">Elderly -&nbsp;falls&nbsp;</li>\n</ul>\n<p><strong>Bankart lesion</strong> is a tear in the <strong>anteroinferior</strong> part of the <strong>glenoid labrum</strong> caused by the head of the humerus during anterior dislocation.&nbsp;</p>\n<p><strong>Hill-Sachs lesion </strong>is&nbsp;a compression fracture on the<strong> posterolateral aspect </strong>of the <strong>humeral head</strong>. It is&nbsp;caused by the pressure of the anterior glenoid rim on the humeral head in recurrent dislocations.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b0b278ff872648eda76e7f37b83d662a.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/305e0e0636314cada3db6466cacc0f38x1280x2125.JPEG"
    ]
  },
  {
    "text": "Which of the following best describes the bony Bankart lesion?",
    "choices": [
      {
        "id": 1,
        "text": "Avulsion fracture of the glenoid rim"
      },
      {
        "id": 2,
        "text": "Stripping of the antero-inferior glenoid labrum"
      },
      {
        "id": 3,
        "text": "Rupture of inferior glenohumeral ligament complex"
      },
      {
        "id": 4,
        "text": "Avulsion of posterior capsular periosteum"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The<strong> bony bankart lesion</strong> is a small, <strong>avulsion fracture</strong> of the\u00a0<strong>glenoid rim</strong>.</p>\n<p>During an <strong>anterior shoulder dislocation</strong>, the head of the humerus can <strong>tear</strong> the <strong>anteroinferior</strong> part of the <strong>glenoid labrum</strong>. This is known as <strong>Bankart lesion</strong>. In some cases, a small fragment of bone from the glenoid rim can also get avulsed. This is known as a <strong>bony</strong> <strong>Bankart</strong> lesion.</p>\n<p>Avulsion of posterior capsular periosteum is seen in reverse Bankart lesion.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/808b47390d0b416390aebb7db595e4fdx1280x2051.JPEG"
    ]
  },
  {
    "text": "An elderly man presented with pain and inability to move his shoulder after a fall. On examination, loss of normal contour of the shoulder was noted. Which of the following tests cannot be used to diagnose the likely condition?",
    "choices": [
      {
        "id": 1,
        "text": "Gerber test"
      },
      {
        "id": 2,
        "text": "Bryant test"
      },
      {
        "id": 3,
        "text": "Callaway test"
      },
      {
        "id": 4,
        "text": "Dugas test"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The above clinical scenario is suggestive of&nbsp;<strong>anterior shoulder dislocation</strong>. It cannot be diagnosed with the help of <strong>Gerber's test</strong>. This test is used to diagnose <strong>impingement</strong> between the <strong>rotator cuff</strong> and the <strong>coracoid</strong> process.&nbsp;</p>\n<p><strong>Four tests</strong>&nbsp;can be used to diagnose <strong>anterior dislocation </strong>of&nbsp;the<strong> shoulder</strong>:</p>\n<ul>\n<li>Bryant's test</li>\n<li>Dugas test</li>\n<li>Hamilton ruler test&nbsp;</li>\n<li>Callaway test &nbsp;&nbsp;</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient is diagnosed with anterior shoulder dislocation after a fall. You are about to reduce the dislocation using Kocher\u2019s maneuver. What is the order of steps you will follow to do this?",
    "choices": [
      {
        "id": 1,
        "text": "Traction, external rotation, abduction, medial rotation"
      },
      {
        "id": 2,
        "text": "Traction, extension, adduction, medial rotation"
      },
      {
        "id": 3,
        "text": "Traction, abduction,  medial rotation, extension"
      },
      {
        "id": 4,
        "text": "Traction, external rotation, adduction, medial rotation"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The correct order of steps in <strong>Kocher's manoeuvre</strong>&nbsp;is<strong>&nbsp;traction</strong>&nbsp;<strong>&rarr;</strong>&nbsp;<strong>external rotation</strong>&nbsp;<strong>&rarr;</strong>&nbsp;<strong>adduction</strong>&nbsp;<strong>&rarr;</strong>&nbsp;<strong>medial rotation</strong> (TEAM). This is used for the&nbsp;<strong>reduction</strong> of <strong>anterior shoulder dislocation</strong>.</p>\n<p>Other maneuvers used in anterior dislocation of the shoulder include:</p>\n<ul>\n<li>Stimson&rsquo;s gravity method</li>\n<li>Hippocratic method (traction counter-traction)&nbsp;</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following muscles is tightened during Putti-Platt\u2019s operation?",
    "choices": [
      {
        "id": 1,
        "text": "Supraspinatus"
      },
      {
        "id": 2,
        "text": "Subscapularis"
      },
      {
        "id": 3,
        "text": "Infraspinatus"
      },
      {
        "id": 4,
        "text": "Teres minor"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Putti-Platt&rsquo;s operation</strong>&nbsp;for&nbsp;shoulder instability involves&nbsp;overlapping and tightening of the <strong>subscapularis tendon</strong> and capsule. It is not commonly done anymore.</p>\n<p><strong>Surgeries done for shoulder instability</strong> include:</p>\n<ul>\n<li><strong>Bankart&rsquo;s</strong> <strong>operation&nbsp;</strong>(most common): The glenoid labrum and the capsule are re-attached to the front of the glenoid rim.&nbsp;</li>\n<li>Laterjet-Bristow&rsquo;s operation: The coracoid process is osteotomized and transplanted along with its muscle attachments to the anterior rim of the glenoid.</li>\n<li>Neer&rsquo;s capsular shift: The shoulder joint capsule is detached from the neck of the humerus and shifted inferior to the neck.&nbsp;</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient who had just undergone electro-convulsive therapy presented to the casualty with pain over the shoulder.  The arm was held in internal rotation and could not be rotated back to the normal position. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Superior dislocation of the shoulder"
      },
      {
        "id": 2,
        "text": "Posterior dislocation of shoulder"
      },
      {
        "id": 3,
        "text": "Anterior dislocation of shoulder"
      },
      {
        "id": 4,
        "text": "Inferior dislocation of shoulder"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The history and clinical features are suggestive of<strong> posterior dislocation of shoulder</strong>.&nbsp;</p>\n<p>Posterior dislocation of the shoulder usually occurs with an<strong> indirect force</strong> causing&nbsp;<strong>marked internal</strong> <strong>rotation</strong> and <strong>adduction. </strong>This condition can be<strong>&nbsp;</strong>seen after a <strong>convulsion</strong>, or an <strong>electric shock</strong>. It can also occur after&nbsp;a fall on the flexed and adducted arm, or after a direct blow to the front of the shoulder.</p>\n<p>The classical attitude of the<strong> arm</strong> is <strong>internal rotation</strong> and <strong>locked</strong> in that position. The examiner will be unable to externally rotate the arm back to normal position. &nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient who suffered an epileptic attack at home presented with pain over the left shoulder. An  AP view  X-ray of the shoulder was done as given below. Which sign is seen here?",
    "choices": [
      {
        "id": 1,
        "text": "Comolli's sign"
      },
      {
        "id": 2,
        "text": "Light bulb sign"
      },
      {
        "id": 3,
        "text": "Destot's sign"
      },
      {
        "id": 4,
        "text": "Oliver's sign"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Other<strong> radiological signs</strong> described in <strong>posterior dislocation</strong> of the shoulder in the AP view are as follows:</p>\n<ul>\n<li>The <strong>rim sign</strong>: Widening of the glenohumeral joint space &gt; 6 mm</li>\n<li>The <strong>vacant glenoid sign</strong>: The&nbsp;glenoid fossa looks empty as the humeral head has moved away from it</li>\n<li>The <strong>trough sign</strong>: A vertical line is seen on the&nbsp;anteromedial part of humeral head due to the impression fracture by the glenoid labrum &nbsp;&nbsp;</li>\n</ul>\n<p>Option A:&nbsp;Comolli's sign is seen in scapular fracture.</p>\n<p>Option C:&nbsp;Destot's sign is seen in pelvic fracture.</p>\n<p>Option D: Oliver's sign is seen in aortic aneurysm.&nbsp;&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/6ff47d73791242b490d9fd2f07f2a906.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/26709570d5eb4b7faa7455d8bb37e209x1280x1511.GIF"
    ]
  },
  {
    "text": "On which aspect of the humeral head is reverse Hill-Sachs lesion seen?",
    "choices": [
      {
        "id": 1,
        "text": "Posterolateral"
      },
      {
        "id": 2,
        "text": "Anteromedial"
      },
      {
        "id": 3,
        "text": "Posteromedial"
      },
      {
        "id": 4,
        "text": "Anterolateral"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The<strong> reverse Hill-Sachs </strong>lesion is seen on the <strong>anteromedial</strong> aspect of the <strong>humeral head</strong>.</p>\n<p>It is also known as <strong>McLaughlin lesion.</strong>&nbsp;it refers to an<strong> impaction fracture</strong> of the&nbsp;anteromedial aspect of the humeral head.</p>\n<p>It is seen following a <strong>posterior dislocation</strong> of the humerus. This occurs due to the impact of the glenoid rim on the humeral head.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 22-year old man presented with pain and abduction deformity of the right shoulder after falling on the abducted arm. His AP-view shoulder radiograph is given below. What is the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Anterior dislocation"
      },
      {
        "id": 2,
        "text": "Posterior dislocation"
      },
      {
        "id": 3,
        "text": "Inferior dislocation"
      },
      {
        "id": 4,
        "text": "Superior dislocation"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In the above clinical scenario, the history and radiograph suggest an&nbsp;<strong>inferior</strong>&nbsp;<strong>dislocation</strong> of the<strong> shoulder</strong>,&nbsp;which is also known as <strong>luxatio erecta</strong>.</p>\n<p>Inferior dislocation is<strong> rare</strong> and occurs when the arm is forcefully pulled up when in full abduction (<strong>hyper-abduction force</strong>). The <strong>head of</strong> the <strong>humerus</strong> gets forced out of the inferior part of the capsule and comes to lie <strong>below</strong> the <strong>glenoid</strong>.</p>\n<p>The patient will present with the <strong>arm locked in abduction</strong>. On examination, the <strong>humeral head</strong> may be felt <strong>in</strong> or below the <strong>axilla</strong>. &nbsp;&nbsp;</p>\n<p>The X-ray below shows disturbed articulation between the humeral head and glenoid. The humeral head is seen below the glenoid. The humerus shaft is in the abducted position. This is characteristic of luxatio erecta.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/5431db1b10914ebfbf9c81513dbaa84b.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/067abb4f28c54ff695b8b1387316fce9x720x991.JPEG"
    ]
  },
  {
    "text": "The most common sequela of traumatic dislocation of the shoulder in young adults is_____.",
    "choices": [
      {
        "id": 1,
        "text": "Subscapular tendinitis"
      },
      {
        "id": 2,
        "text": "Rotator cuff injury"
      },
      {
        "id": 3,
        "text": "Recurrent dislocation of shoulder"
      },
      {
        "id": 4,
        "text": "Frozen shoulder"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The <strong>most common sequela</strong> of traumatic shoulder dislocation in young adults is <strong>recurrent dislocations</strong> of the shoulder joint.</p>\n<p><strong>Traumatic shoulder</strong> <strong>dislocation</strong> is associated with<strong> tear</strong> of the<strong> glenoid labrum</strong> (Bankart lesion). This&nbsp;results in <strong>loss of attachment</strong>&nbsp;of the <strong>inferior glenohumeral ligament</strong>, which is the primary static stabilizer of the shoulder.</p>\n<p>In addition, there is a&nbsp;loss of&nbsp;concavity&nbsp;due to damage to the labrum. Therefore, the <strong>shoulder joint</strong> becomes <strong>unstable</strong>. This predisposes the person to repeated shoulder dislocations. Shoulder instability/recurrent dislocation is an indication for surgical intervention.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 56-year-old woman presented with pain and decreased movement of the right arm after a fall. On examination, there was swelling and tenderness over the right shoulder region. However, the normal contour of the shoulder is maintained. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Acromio-clavicular dislocation"
      },
      {
        "id": 2,
        "text": "Fracture of the clavicle"
      },
      {
        "id": 3,
        "text": "Shoulder dislocation"
      },
      {
        "id": 4,
        "text": "Proximal humerus fracture"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>In the above clinical scenario, the history and examination findings suggest a <strong>fracture </strong>of the<strong> proximal humerus</strong>.&nbsp;It is most commonly seen in&nbsp;<strong>osteoporotic, postmenopausal women</strong>.</p>\n<p class=\"p1\">The most common mechanism of injury in fracture of the proximal humerus<strong>&nbsp;</strong>is falling<strong>&nbsp;</strong>on the outstretched hand. The patient usually presents with<strong> localized shoulder pain</strong> and <strong>limitation of movement</strong> in the affected arm.</p>\n<p class=\"p1\"><strong>Clinical features:</strong></p>\n<ul>\n<li class=\"p1\">Soft tissue swelling and ecchymosis</li>\n<li class=\"p1\">Bony tenderness over the upper part of the humerus</li>\n<li class=\"p1\"><strong>Normal contour</strong> of the shoulder is<strong> retained</strong> ( maybe lost in severe fractures and fracture-dislocations)&nbsp;</li>\n<li class=\"p1\"><strong>Axillary nerve</strong> is the <strong>most common</strong> nerve to be<strong> injured</strong> in proximal humerus fractures&nbsp;</li>\n</ul>\n<p class=\"p1\"><strong>Management:</strong></p>\n<ul>\n<li class=\"p1\"><strong>Undisplaced</strong> proximal humerus fractures are treated using an <strong>arm pouch</strong> or sling.</li>\n<li class=\"p1\"><strong>Displaced</strong> and unstable fractures are treated by <strong>open reduction</strong> and <strong>internal fixation</strong>.&nbsp;</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/26c7055e58c849e0a13904d009f094cdx1280x1174.JPEG"
    ]
  },
  {
    "text": "What is the most commonly used classification system for proximal humerus fractures?",
    "choices": [
      {
        "id": 1,
        "text": "Neer's classification"
      },
      {
        "id": 2,
        "text": "Garden's classification"
      },
      {
        "id": 3,
        "text": "Gartland's classification"
      },
      {
        "id": 4,
        "text": "Bado's classification"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The <strong>most commonly used</strong> classification system for proximal humeral fractures is <strong>Neer's classification</strong>.</p>\n<p>Neer classification is based on the <strong>displacement </strong>of <strong>4 major anatomical components</strong> of&nbsp;the proximal humerus:</p>\n<ul>\n<li>Humeral head</li>\n<li>Lesser tuberosity</li>\n<li>Greater tuberosity</li>\n<li>Proximal humeral shaft</li>\n</ul>\n<p>Displacement is defined as the separation of any part by more than 1 cm or angulation&nbsp;of more than 45 degrees.&nbsp;</p>\n<p>Based on the number of parts displaced, these fractures are <strong>classified</strong> into <strong>4 major groups</strong>. It is divided into one-part fracture, two-part&nbsp;fractures, three-part&nbsp;fractures, and four-part fractures.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A construction worker presented with pain and swelling of his left arm after falling on his side from a height. An upper arm X-ray was done which is given below. Which nerve is most likely to be injured in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Axillary nerve"
      },
      {
        "id": 2,
        "text": "Ulnar nerve"
      },
      {
        "id": 3,
        "text": "Radial nerve"
      },
      {
        "id": 4,
        "text": "Median nerve"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p class=\"p1\">In the above clinical scenario, the history and radiograph suggest a\u00a0closed <strong>fracture</strong> of the <strong>shaft </strong>of the<strong> humerus.\u00a0</strong>The <strong>radial nerve</strong> is <strong>commonly damaged</strong> in this condition.</p>\n<p class=\"p1\">It manifests as an inability to dorsiflex the wrist and digits (<strong>wrist drop</strong> and<strong> finger drop</strong>). <strong>Numbness</strong> occurs on the <strong>dorsoradial</strong> <strong>aspect</strong> of the hand and the dorsal aspect of the radial 3 1/2 digits.\u00a0</p>\n<p class=\"p1\"><strong>Management of humerus shaft fractures</strong>:\u00a0</p>\n<ul>\n<li class=\"p1\">Conservative management using a <strong>hanging cast</strong> or <strong>U-slab</strong> for <strong>2-3 weeks</strong> followed by functional bracing</li>\n<li class=\"p1\"><strong>Surgical fixation</strong> by compression plating, interlocking intramedullary nail, semi-flexible pins, or an external fixator is indicated in:\n<ul>\n<li>Open fractures</li>\n<li>Pathological fractures</li>\n<li>Unstable humeral and forearm fractures (floating elbow)</li>\n<li>Radial nerve palsy</li>\n</ul>\n</li>\n</ul>\n<p>The below X-ray shows shaft of humerus fracture.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/da24499d856a4e0dbec56e6a94be0bba.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/fbfae747209d4cea9974c1694abf7783x366x600.PNG"
    ]
  },
  {
    "text": "A baseball player presented with right upper arm pain. He started experiencing pain after he threw a ball and felt a pop. An upper arm X-ray was done and is given below. What is this fracture known as?",
    "choices": [
      {
        "id": 1,
        "text": "Holdsworth fracture"
      },
      {
        "id": 2,
        "text": "Clay shoveller's fracture"
      },
      {
        "id": 3,
        "text": "Lisfranc fracture"
      },
      {
        "id": 4,
        "text": "Holstein-Lewis fracture"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The radiograph shows a<strong> displaced spiral fracture </strong>of the<strong> humerus&nbsp;</strong>at the junction of the middle-third and distal-third<strong>. </strong>This is known as<strong> Holstein-Lewis</strong> fracture.</p>\n<p>There is a high risk of entrapment of the radial nerve in the bone fragments of this fracture. Hence this fracture is associated with&nbsp;<strong>radial nerve injury </strong>(<strong>wrist drop</strong>).</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/0c6e4f21c90044db99694d60fd5e7a7a.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/36fd75bb8a7f4189b0a7b22f2bada2b3x1280x1961.JPEG"
    ]
  }
];
        let quizName = '04 Injuries Of  Clavicle, Shoulder And Arm';
        let hierarchy = ["Marrow", "qBank", "Orthopedics"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>