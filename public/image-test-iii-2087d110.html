<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Test Iii - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2018-19
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">25</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "The Image shown below is seen in deficiency of ______",
    "choices": [
      {
        "id": 1,
        "text": "Vitamin B2"
      },
      {
        "id": 2,
        "text": "Vitamin B3"
      },
      {
        "id": 3,
        "text": "Vitamin B5"
      },
      {
        "id": 4,
        "text": "Vitamin B12"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The above image shows characteristic <strong>Casal's necklace</strong> pattern, seen in <strong>Pellagra</strong>, which occur due to deficiency of&nbsp; <strong>Vitamin B3 (niacin).</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/eefb2aa34c36439c9fb2a68221fc18ba.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Identify the virus given in the image below.",
    "choices": [
      {
        "id": 1,
        "text": "Rota virus"
      },
      {
        "id": 2,
        "text": "Astro virus"
      },
      {
        "id": 3,
        "text": "Adeno virus"
      },
      {
        "id": 4,
        "text": "Tobacco mosaic virus"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given image shows <strong>rotavirus</strong> which is <strong>wheel shaped</strong>.</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/7289f31bdba04b6a9d9f420a5450f021.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/bd0cd93a4c90439486c0afda4a059a8dx1280x1461.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/265fabeb19b04cc781c561a645af87fcx1280x1032.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ccfd6fc036054c9da91d11da69da98b3x675x675.JPEG"
    ]
  },
  {
    "text": "The following patch on the cornea is associated with infection by ______:",
    "choices": [
      {
        "id": 1,
        "text": "TB"
      },
      {
        "id": 2,
        "text": "HIV"
      },
      {
        "id": 3,
        "text": "Syphilis"
      },
      {
        "id": 4,
        "text": "HSV"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The above image depicts <strong>Salmon patch appearance</strong> of cornea.</p>\n<p>Salmon patch appearance of cornea is classically associated with <strong>syphilitic</strong> infection. </p>\n<p>It is due to <strong>deep vascularization</strong> of cornea consisting of <strong>radial bundle of brush-like vessels </strong><br /> <br /><strong>Stages of interstital keratitis</strong> in Congenital syphilis :</p>\n<ul>\n<li>Initial <strong>progressive &ndash; Ground glass</strong> appearance </li>\n<li><strong>Florid</strong> stage &ndash; Salmon patch appearance </li>\n<li>Stage of <strong>Regression &ndash; Ghost vessels</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b5da543ed60e478a8ae63c9a97db114e.PNG"
    ],
    "explanation_images": [
      "https://cdn1.dailyrounds.org/uploads/288793cac71d43d5baa41855b6b4cbb5x572x390.PNG"
    ]
  },
  {
    "text": "The following sign in USG is depictive of",
    "choices": [
      {
        "id": 1,
        "text": "Intrauterine 2 gestation sacs"
      },
      {
        "id": 2,
        "text": "Decidua parietalis and decidua capsularis"
      },
      {
        "id": 3,
        "text": "Ectopic pregnancy"
      },
      {
        "id": 4,
        "text": "Heterotopic pregnancy"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<ul>\n<li>The given USG shows the double decidual sign surrounding the gestational sac and is defined by the decidua parietalis and the decidua capsularis.</li>\n<li>The double decidual sac sign differentiates normal pregnancy from pseudogestational sac of an ectopic pregnancy.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/021e01eee2bf423ea1a71bd500e8d5ab.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9fd982c6a2214ead8a649975438eab7bx1280x1903.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/de4a60a422264978b61059f813825d39x320x260.JPEG"
    ]
  },
  {
    "text": "The marked area given in the sleep polysomnography is of ______",
    "choices": [
      {
        "id": 1,
        "text": "REM sleep"
      },
      {
        "id": 2,
        "text": "NREM stage 1"
      },
      {
        "id": 3,
        "text": "NREM stage 2"
      },
      {
        "id": 4,
        "text": "NREM stage 3"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The marked area in the given polysomnography represents <strong>REM sleep</strong>.</p>\n<p>The three zones in the given image represent <strong>EOG</strong>,<strong> EEG</strong>&nbsp;and<strong>&nbsp;EMG</strong>, respectively.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a6b6553bc57e436b99c8bc5dfd328a30.PNG"
    ],
    "explanation_images": [
      "https://cdn1.dailyrounds.org/uploads/d0f0e7a59a714a3f98cb061ff4ce285cx324x232.PNG",
      "https://cdn1.dailyrounds.org/uploads/8d4dfe5fa3fe4c7c884944743a8feb2ex407x293.PNG"
    ]
  },
  {
    "text": "The given image is of a patient in whom mastoidectomy is done. Identify the lateral semi-circular canal:",
    "choices": [
      {
        "id": 1,
        "text": "A"
      },
      {
        "id": 2,
        "text": "B"
      },
      {
        "id": 3,
        "text": "C"
      },
      {
        "id": 4,
        "text": "D"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The structure marked as &lsquo;B&rsquo; in the given image represents the <strong>l</strong><strong>ateral (horizontal) semi-circular canal</strong>. The <strong>tympanic (horizontal)</strong> segment of the <strong>facial nerve</strong> lies <strong>below</strong> the <strong>lateral horizontal semicircular canal</strong>.&nbsp;</p>\n<p>Other markings represent:</p>\n<p>A: Superior semicircular canal (SSC)</p>\n<p>C: Posterior semicircular canal (PSC)</p>\n<p>D: Incus</p>\n<p>The semicircular canals are positioned in the superior part of the mastoid region. These canals are situated adjacent to the middle ear, with the <strong>lateral semicircular canal being the nearest to the middle ear</strong>. The superior and posterior canals share a common crescent-shaped space in between. The one that lies in close proximity to the lateral semicircular canal is the posterior semicircular canal.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e3129b4b34174de08d60a90e71b93687.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ba40f9752f904b768ef9c052e5684223x1279x1023.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/644137c4bfa64cab9c0a0c38bbf188edx800x800.PNG"
    ]
  },
  {
    "text": "Identify the artery marked in the image _________",
    "choices": [
      {
        "id": 1,
        "text": "Superior cerebellar artery"
      },
      {
        "id": 2,
        "text": "Posterior cerebral artery"
      },
      {
        "id": 3,
        "text": "Posterior communicating artery"
      },
      {
        "id": 4,
        "text": "Anterior choroidal artery"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The artery marked in the image is<strong> superior cerebellar artery.</strong></p>\n<p>The superior cerebellar artery arises near the distal portion of the basilar artery, immediately before the formation of the posterior cerebral arteries. The superior cerebellar artery supplies the pons, pineal body, superior medullary velum and tela choroidea of the third ventricle.</p>\n<p><strong>Circle of Willis or circulus arteriosus:</strong> Large arterial anastomosis that unites the internal carotid and vertebrobasilar systems. It lies in the subarachnoid space within the basal cisterns that surround the optic chiasma and infundibulum.</p>\n<p>The anterior cerebral arteries are derived from the internal carotid arteries and are linked by a small anterior communicating artery.</p>\n<p>Posteriorly, the two posterior cerebral arteries are formed by the division of the basilar artery. They are joined to the ipsilateral internal carotid artery by a posterior communicating artery.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3a9c79285e044ffea5a7f4bbeb29a5e8.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0e4d36656a67440c9a32a48e2eb46d7ex376x599.PNG"
    ]
  },
  {
    "text": "Which of the following drug is the cause for the effect shown in the image given below?",
    "choices": [
      {
        "id": 1,
        "text": "Zoledronate"
      },
      {
        "id": 2,
        "text": "Teriparatide"
      },
      {
        "id": 3,
        "text": "Examestane"
      },
      {
        "id": 4,
        "text": "Nintedanib"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The image depicts <strong>Osteonecrosis of jaw</strong>, which is a side effect of the Bisphosphonates like <strong>Zoledronate.</strong></p>\n<p><strong>Side effects of Zoledronate:</strong></p>\n<ul>\n<li>Nausea, vomiting, bodyache</li>\n<li>Renal toxicity</li>\n<li>Osteonecrosis of jaw</li>\n<li>Hypocalcaemia and seizures</li>\n<li>Increased risk of bone fractures</li>\n<li>Bone pain</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/0b8f3a62302549f68b0ecca81eca4e4f.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Calculate the ejection fraction from the given left ventricular pressure-volume curve:",
    "choices": [
      {
        "id": 1,
        "text": "40%"
      },
      {
        "id": 2,
        "text": "50%"
      },
      {
        "id": 3,
        "text": "60%"
      },
      {
        "id": 4,
        "text": "70%"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The ejection fraction as calculated from the above volume pressure curve is <strong>60%.</strong></p>\n<p><strong>The ejection fraction</strong>\u00a0is defined as the percentage of the end-diastolic ventricular volume that is ejected with each stroke.</p>\n<p>Thus, EF = Volume ejected / End diastolic volume\u00a0\u00d7 100</p>\n<p>The volume ejected can be obtained, by subtracting the end systolic volume from end diastolic volume. Thus,</p>\n<p>EF = End diastolic volume (EDV)\u00a0\u2212 End systolic volume (ESV) / End diastolic volume (EDV)\u00a0\u00d7 100</p>\n<p>In the above volume pressure curve of left ventricle,</p>\n<p>EDV = 130 ml</p>\n<p>ESV = 52 ml</p>\n<p>Substituting these values in the above equation we get,</p>\n<p><strong>EF\u00a0</strong>= (130\u00a0\u2212 52 / 130) \u00d7 100</p>\n<p>\u00a0= (3 / 5) \u00d7 100</p>\n<p>\u00a0= 0.6\u00a0\u00d7 100</p>\n<p><strong>\u00a0= 60%</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/df8e64014ec846e99726e32ee4bdfb21.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 67-year-old diabetic comes to you with a rash over the intertriginous areas, which is more pronounced over his groin.  Wood's lamp examination shows coral pink fluorescence. What is the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Pityriasis versicolor"
      },
      {
        "id": 2,
        "text": "Erythrasma"
      },
      {
        "id": 3,
        "text": "Tinea cruris"
      },
      {
        "id": 4,
        "text": "Candidal intertrigo"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Coral pink fluorescence</strong>&nbsp;on Wood's lamp examination is&nbsp;characteristic of&nbsp;<strong>erythrasma.</strong></p>\n<p>Erythrasma is a skin infection caused by <strong><em>Corynebacterium minutissimum</em></strong>. It is common in <strong>diabetics</strong> and <strong>immunodeficient</strong> patients and is associated with <strong>obesity</strong>, <strong>sweating</strong> and <strong>poor hygiene</strong>.</p>\n<p>Coral pink fluorescence&nbsp;is due to the production of <strong>coproporphyrin III</strong> by the bacterium.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient underwent inguinal hernia repair surgery, during which the nerve marked in the image below was injured.  Which of the following structures does this nerve supply?",
    "choices": [
      {
        "id": 1,
        "text": "Transversus abdominis"
      },
      {
        "id": 2,
        "text": "Cremaster muscle"
      },
      {
        "id": 3,
        "text": "Internal oblique"
      },
      {
        "id": 4,
        "text": "Skin on lateral aspect of thigh"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The nerve marked in the image is<strong>&nbsp;</strong>the<strong> genitofemoral nerve (L1, L2)</strong>, which can be injured during inguinal hernia repair. Among the given structures, it supplies the&nbsp;<strong>cremaster muscle</strong>.</p>\n<p>Branches of genitofemoral nerve:</p>\n<ul>\n<li>Genital branch: Innervates cremaster</li>\n<li>Femoral branch:\n<ul>\n<li>Skin of the scrotum in males</li>\n<li>Skin of mons pubis and labium majus in females</li>\n<li>Anteromedial skin of the thigh</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/665947aafb6e4725b3a4cde8ea511d06.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "True about the circuit given below is _________",
    "choices": [
      {
        "id": 1,
        "text": "Low fresh gas flow rate"
      },
      {
        "id": 2,
        "text": "Best in controlled ventilation"
      },
      {
        "id": 3,
        "text": "Also called Jackson Rees modification circuit"
      },
      {
        "id": 4,
        "text": "None of the above"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The circuit given in the image is <strong>Mapleson A or Magill circuit</strong>. It has a <strong>low fresh gas flow rate</strong>&nbsp;requirement of 1 x minute ventilation to prevent rebreathing of carbon dioxide. Hence, it is considered the best for <strong>spontaneous ventilation.</strong></p>\n<p>In Mapleson circuits D, E, and F, the amount of fresh gas flow required is 2.5 times a minute ventilation and in mapleson circuits B and C, it is much higher.</p>\n<p>Mapleson circuit&nbsp;A is not very useful in controlled ventilation because minute ventilation as high as 20 L/minute (fresh gas flow rate should be greater than 3 times minute ventilation) is needed to prevent rebreathing. <strong>Mapleson circuit D is used for controlled ventilation.</strong></p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/66dd3f17a85440a693d782edd562ce93.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "The fracture seen in the X-ray given below is?",
    "choices": [
      {
        "id": 1,
        "text": "Galeazzi's fracture"
      },
      {
        "id": 2,
        "text": "Monteggia fracture"
      },
      {
        "id": 3,
        "text": "Smith's fracture"
      },
      {
        "id": 4,
        "text": "Colles' fracture"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The image shows an <strong>oblique fracture</strong> in the <strong>lower third</strong> of the<strong> radius</strong> with <strong>dislocation</strong> of <strong>distal radio-ulnar joint</strong>. So the fracture seen in the X-ray is&nbsp;<strong>Galeazzi's fracture.</strong></p>\n<p><strong>Galeazzi's</strong> fracture is the fracture of the <strong>lower third</strong> of the <strong>radius</strong> and the <strong>subluxation</strong> or <strong>dislocation</strong> of the <strong>distal&nbsp;radioulnar joint</strong>. This injury usually happens when one <strong>falls</strong> on an <strong>outstretched hand</strong>. The most common clinical feature is <strong>tenderness</strong> over the <strong>distal end</strong> of the <strong>forearm</strong>.&nbsp;</p>\n<p>The aim of treatment for this fracture is to preserve supination and pronation of the forearm. In <strong>children</strong>, <strong>closed reduction</strong> is usually enough to achieve perfect reduction. However, in <strong>adults</strong>, <strong>open reduction</strong> using a k-wire fixation or compression plating is usually required. It is also important to look for ulnar nerve damage.</p>\n<p>Galeazzi's fracture can cause complications such as <strong>malunion</strong> due to displacement of the fragment. This often results in <strong>deformity</strong> and <strong>limitation</strong> in <strong>supination</strong> and <strong>pronation</strong>.</p>\n<p>Other options:&nbsp;</p>\n<p>Option B:<strong> Monteggia fracture </strong>is the fracture of the <strong>shaft</strong> of the <strong>ulna</strong> with <strong>dislocation</strong> of the <strong>proximal radio-ulnar joint</strong> and the subluxation of the radiocapitellar joint.</p>\n<p>Option C:<strong> Smith's fracture</strong> is the fracture of the <strong>distal radius</strong> with <strong>palmar angulation</strong> of the distal bone fragment. It&nbsp;also known as <strong>reverse Colle's</strong> <strong>fracture</strong>.</p>\n<p>Option D: <strong>Colle's fracture </strong>is the fracture of the <strong>distal radius</strong> with <strong>dorsal angulation</strong> of the distal bone fragment.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/8c9cd95365f241e092c625ddb2f21373.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "The bodies shown in this image (highlighted) are seen in which of the following tumors?",
    "choices": [
      {
        "id": 1,
        "text": "Granulosa cell tumour"
      },
      {
        "id": 2,
        "text": "Dysgerminoma"
      },
      {
        "id": 3,
        "text": "Krukenberg tumor"
      },
      {
        "id": 4,
        "text": "Yolk sac tumour"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The image shows <strong>Call exner bodies</strong> which are seen in <strong>Granulosa cell tumour</strong>.</p>\n<p><strong>Granulosa cell tumours&nbsp;</strong>arise from granulosa cells which form part of the developing ovarian follicle. They are unilateral in nature and the mass is cystic and encapsulated.&nbsp;<strong>Call-Exner bodies&nbsp;</strong>are seen in&nbsp;granulosa cell tumours<strong>.&nbsp;</strong>These are gland like small structures with&nbsp;<strong>acidophilic material</strong>&nbsp;and&nbsp;<strong>immature follicles</strong>.</p>\n<p>Mutations of the <strong>FOXL2 </strong>gene&nbsp;is seen in 97% of adult granulosa cell tumors.</p>\n<p>Elevated tissue and serum levels of <strong>inhibin</strong>, a product of granulosa cells, are associated with granulosa cell tumors. It is used in monitoring patients being treated.</p>\n<p>Other options -</p>\n<p>Option B:&nbsp;<strong>Dysgerminoma&nbsp;</strong>is the ovarian counterpart of&nbsp;<strong>seminoma</strong>. They are unilateral tumors composed of vesicular cells and clear cytoplasm. The tumor cells grow in cords or sheets that are separated by scanty fibrous stroma. They are usually infiltrated by lymphocytes. The image below shows the histopathology of a dysgerminoma</p>\n<p><img src=\"https://dhmbxeygs57ff.cloudfront.net/uploads/2d6cc0c1c2564531945ff59d27a24c9dx1280x853.JPEG\" width=\"345\" height=\"230\" /></p>\n<p>Option C:&nbsp;<strong>Krukenberg tumor</strong>&nbsp;is the carcinoma of the stomach that metastasize to the ovary. It is characterized by&nbsp;mucin-producing&nbsp;<strong>signet ring cells</strong>. The appearance of a signet ring often originates from the gastric mucosa.&nbsp;</p>\n<div class=\"ng-star-inserted\">\n<div class=\"table-responsive font-weight-light answer-scroll ng-star-inserted\">\n<p>The image below shows signet-ring cells in the Krukenberg tumor.</p>\n</div>\n</div>\n<div class=\"ng-star-inserted\">\n<div class=\"ng-star-inserted\">\n<div class=\"h-400-scroll mb-2 ng-star-inserted\"><img class=\"img-fluid hover-max\" src=\"https://dhmbxeygs57ff.cloudfront.net/uploads/e216464caea84e0fbc258433c5eaaa76x800x600.JPEG\" width=\"323\" height=\"242\" /></div>\n</div>\n</div>\n<p>Option D :&nbsp;A<strong>&nbsp;yolk sac tumor/endodermal sinus tumor</strong>&nbsp;is an aggressive&nbsp;<strong>malignant germ cell tumor</strong>&nbsp;of the ovaries. It<strong>&nbsp;</strong>originates from embryonal structures of the yolk sac by selective differentiation.&nbsp;</p>\n<div class=\"ng-star-inserted\">\n<div class=\"table-responsive font-weight-light answer-scroll ng-star-inserted\">\n<p>Most of the yolk sac tumors have&nbsp;<strong>Schiller-Duval bodies</strong>&nbsp;and they are&nbsp;<strong>pathognomonic</strong>. These are glomerulus-like structures consisting of a central vessel surrounded by tumor cells within a space that is also lined by tumor cells.</p>\n<p>The image given below shows&nbsp;Schiller-Duval bodies seen in&nbsp;yolk sac tumors<strong>.</strong></p>\n</div>\n</div>\n<div class=\"ng-star-inserted\">\n<div class=\"ng-star-inserted\">\n<div class=\"h-400-scroll mb-2 ng-star-inserted\"><img class=\"img-fluid hover-max\" src=\"https://dhmbxeygs57ff.cloudfront.net/uploads/b3cd520f5bac400d84fd70001db66503x969x994.JPEG\" width=\"320\" height=\"328\" /></div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a89d8a189ecd4e65adc10c25906b8dee.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Accidental ingestion of the insect shown below is associated with which of the following complications?",
    "choices": [
      {
        "id": 1,
        "text": "Acrodynia"
      },
      {
        "id": 2,
        "text": "Priapism"
      },
      {
        "id": 3,
        "text": "Rain drop pigmentation"
      },
      {
        "id": 4,
        "text": "Magnan\u2019s sign"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The insect is identified as the\u00a0<strong>Spanish fly</strong>.<strong>\u00a0</strong>Accidental consumption is associated with\u00a0<strong>priapism</strong>.</p>\n<p>Spanish fly is a winged insect with a length of 2 cm and a breadth of 0.6 cm with greenish-black color and shiny wings. It contains the toxic active principle\u00a0<strong>cantharidin</strong>.</p>\n<p>The active principle can be <strong>absorbed</strong> through the <strong>skin</strong> and all mucosa. On local application to the skin or mucosa, it is associated with redness of skin, and burning pain followed by vesication of the skin. The sequela of cantharides ingestion involves <strong>priapism</strong>.<strong>\u00a0</strong>Features of this poisoning are severe thirst, dysphagia, priapism, genital pain, tenesmus, and convulsions resulting in coma and death. Abortion can occur if the woman is pregnant.</p>\n<p>Treatment is symptomatic and if ingested, stomach wash needs to be done along with the administration of demulcents.</p>\n<p>Other Options:<strong>\u00a0</strong></p>\n<p>Option A: <strong>Acrodynia </strong>is seen in <strong>chronic mercury poisoning</strong>, in which there is pain and pink discoloration of the hands and feet.</p>\n<p>Option C: <strong>Raindrop pigmentation\u00a0</strong>is a finely mottled brown change on skin flexures, temples, eyelids, and necks seen in <strong>arsenic poisoning</strong>.</p>\n<p>Option D: <strong>Magnan\u2019s sign </strong>is seen in <strong>cocaine addicts</strong> where they experience and interpret paraesthesia as the constant movement of a foreign body or bugs under their skin.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/4c14c0f840464b2c8f6b97487dc2c82b.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "The following appearance on ERCP is characteristic of:",
    "choices": [
      {
        "id": 1,
        "text": "Mucinous cystic neoplasm"
      },
      {
        "id": 2,
        "text": "Serous cystic neoplasm"
      },
      {
        "id": 3,
        "text": "Intraductal papillary mucinous neoplasm"
      },
      {
        "id": 4,
        "text": "Pancreatic pseudocyst"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given appearance of the <strong>fish-eye lesion of the ampulla of Vater</strong> on ERCP is characteristic of<strong> intraductal papillary mucinous neoplasm (IPMN).</strong>\u00a0</p>\n<p>Mucin can be seen extruding from the ampulla of Vater, a so-called <strong>fish-eye lesion</strong> that is virtually diagnostic of IPMN.</p>\n<p>Cyst fluid analysis of various pancreatic cystic neoplasms:</p>\n<table style=\"border-collapse: collapse; width: 58.167%;\" border=\"1\">\n<tbody>\n<tr>\n<td style=\"width: 12.5331%;\">Characteristics</td>\n<td style=\"width: 22.7957%; text-align: left; line-height: 1;\"><strong>Serous cystic neoplasm (SCN)</strong></td>\n<td style=\"width: 31.696%; text-align: left; line-height: 1;\"><strong>Mucinous cystic neoplasm (MCN)</strong></td>\n<td style=\"width: 32.9675%; text-align: left; line-height: 1;\">\n<p><strong>Intraductal papillary mucinous neoplasm (IPMN)</strong></p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 12.5331%;\">Cytology<br /><br /><br /></td>\n<td style=\"width: 22.7957%;\">Scant glycogen-rich cells, with positive periodic acid-Schiff stain</td>\n<td style=\"width: 31.696%;\">Sheets and clusters of columnar, mucin-containing cells</td>\n<td style=\"width: 32.9675%;\">Tall, columnar, mucin-containing cells</td>\n</tr>\n<tr>\n<td style=\"width: 12.5331%;\">\n<p>Mucin stain</p>\n</td>\n<td style=\"width: 22.7957%;\">Negative</td>\n<td style=\"width: 31.696%;\">Positive</td>\n<td style=\"width: 32.9675%;\">Positive</td>\n</tr>\n<tr>\n<td style=\"width: 12.5331%;\">Amylase</td>\n<td style=\"width: 22.7957%;\">Low</td>\n<td style=\"width: 31.696%;\">Low</td>\n<td style=\"width: 32.9675%;\">High</td>\n</tr>\n<tr>\n<td style=\"width: 12.5331%;\">CEA</td>\n<td style=\"width: 22.7957%;\">Low</td>\n<td style=\"width: 31.696%;\">High</td>\n<td style=\"width: 32.9675%;\">High</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/084476ad004c49a09ff507a03e6e068c.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 60-year-old diabetic male presents with a history of decreased vision. Fluorescein angiography showed the following image. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Mild non-proliferative diabetic retinopathy"
      },
      {
        "id": 2,
        "text": "Severe non-proliferative diabetic retinopathy"
      },
      {
        "id": 3,
        "text": "Bird shot choroidopathy"
      },
      {
        "id": 4,
        "text": "Proliferative diabetic retinopathy"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical vignette and <strong>Fluorescein angiography</strong> findings of <strong>neovascularization</strong> are suggestive of <strong>proliferative diabetic retinopathy </strong>(PDR)<strong>.</strong></p>\n<p><strong>Neovascularization</strong> is a <strong>hallmark</strong> of <strong>PDR</strong>. So this rules out Non-proliferative diabetic retinopathy-NPDR (Option A,B).</p>\n<p>Option C: <strong>Birdshot retinochoroidopathy</strong> is an idiopathic bilateral <strong>chorioretinitis</strong> characterized by <strong>creamy yellow spots</strong> of chorioretinal hypopigmentation resembling a birdshot scatter. It most commonly affects <strong>middle aged females</strong> who are <strong>HLA-A29 positive.</strong></p>\n<p>PDR is most common in patients with <strong>Type \u2160 diabetes</strong> after a period of <strong>15-20 years</strong> and is characterized by proliferation of new vessels at the <strong>optic disc (NVD)</strong> or <strong>elsewhere</strong> in the fundus <strong>(NVE)</strong>.</p>\n<p>( NVD- neovascularization at the optic disc ; NVE-neovascularization elsewhere in the fundus )</p>\n<p>Complications of PDR include <strong>recurrent vitreous </strong>hemorrhage, <strong>tractional</strong> retinal detachment and <strong>pre retinal</strong> hemorrhages.</p>\n<p>It is treated by administration of <strong>Anti-VEGF drugs</strong> followed by <strong>pan retinal photocoagulation</strong> which destroys the hypoxic retina that has been producing the vasoformative factors responsible for neovascularization.</p>\n<p><strong>Duration</strong> of diabetes mellitus is the <strong>most important</strong> factor for the development of <strong>diabetic retinopathy</strong>.</p>\n<p>Ophthalmoscopic features of <strong>NPDR</strong> include:</p>\n<ul>\n<li><strong>Microaneurysms</strong>: due to <strong>loss</strong> of <strong>pericytes</strong> around the capillaries</li>\n<li><strong>Retinal hemorrhages</strong>: both superficial (<strong>flame shaped</strong>) and deep (<strong>dot &amp; blot</strong>) hemorrhages.</li>\n<li><strong>Hard exudates</strong>: composed of <strong>lipoproteins</strong> and <strong>lipid</strong> <strong>laden</strong> <strong>macrophages</strong>. They are <strong>yellow waxy</strong> looking and arranged in clumps or circinate patterns.</li>\n<li><strong>Cotton wool spots</strong>: which are small <strong>whitish fluffy</strong> lesions which represent areas of <strong>nerve infarct</strong>.</li>\n<li>Intra retinal microvascular abnormalities(<strong>IRMA</strong>): are <strong>arteriovenous</strong> <strong>shunts</strong> in retina</li>\n<li><strong>Venous abnormalities</strong> such as beading,looping and dilatation.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/78faeba114ea4a1f96c49ea5a8908323.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/74d78b1fe5d640c8a55006f3758cb375x512x384.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/fcf0d92458794acdbb5c1276f34ede81x359x220.PNG"
    ]
  },
  {
    "text": "Garland Sign is seen in?",
    "choices": [
      {
        "id": 1,
        "text": "Amyotrophic lateral sclerosis"
      },
      {
        "id": 2,
        "text": "Huntington\u2019s disease"
      },
      {
        "id": 3,
        "text": "Progressive supranuclear palsy"
      },
      {
        "id": 4,
        "text": "Multisystem atrophy"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>MRI coronal T2 sequence showing hyperintensity along corticospinal tract and corpus callosum forming a &lsquo;<strong>Garland pattern</strong>'- Seen in ALS</p>\n<p><strong>Other options:</strong></p>\n<ul>\n<li><strong>Huntington&rsquo;s disease &ndash; Box car</strong> ventricles</li>\n<li>Progressive supranuclear palsy &ndash; <strong>Humming bird sign</strong></li>\n<li>Multisystem atrophy &ndash; <strong>Hot cross bun sign</strong></li>\n</ul>\n<p><strong>Note :&nbsp;</strong><strong>Garland triad</strong>, also known as the&nbsp;<strong>1-2-3 sign&nbsp;</strong>or<strong>&nbsp;Pawnbrokers sign</strong>, is a lymph node enlargement pattern which has been described in<strong>&nbsp;</strong><strong>sarcoidosis.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/236b8b21a3cb481ba0c757adda37be6bx616x562.PNG"
    ]
  },
  {
    "text": "The X-ray below is of a patient who recently underwent a bronchoscopy and has complaints of chest pain. Which of the following would you expect in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Hoover\u2019s sign"
      },
      {
        "id": 2,
        "text": "Westermark sign"
      },
      {
        "id": 3,
        "text": "Golden S sign"
      },
      {
        "id": 4,
        "text": "Hamman\u2019s sign"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The X-ray shows air in the mediastinum, adjacent to the descending aorta and left common carotid artery. Along with the history of the patient, we can arrive at the diagnosis of <strong>pneumomediastinum</strong>.</p>\n<p><strong>Pneumomediastinum</strong>:</p>\n<p>The main causes of gas/air in the interstices of the mediastinum are</p>\n<ol>\n<li>Alveolar rupture, perforation or</li>\n<li>Rupture of esophagus/trachea/bronchi,</li>\n<li>Dissection of air from the neck or abdomen into the mediastinum.</li>\n</ol>\n<p>Clinical Features include severe substernal chest pain(may or may not radiate to neck and arms) &amp; subcutaneous Emphysema over the suprasternal notch.</p>\n<p>The examination may reveal <strong>subcutaneous emphysema</strong> in the suprasternal notch with <strong>Hamman&rsquo;s sign</strong>. Chest X-ray confirms the diagnosis. No treatment is usually required but inhaling high concentrations of oxygen will help absorb the mediastinal air. Needle aspiration can be performed if mediastinal structures are compressed.&nbsp;&nbsp;</p>\n<p><strong>Hamman&rsquo;s sign:</strong></p>\n<p>It can be elicited in <strong>pneumomediastinum </strong>and <strong>pneumopericardium</strong>. It is a crunching or clicking sound which is synchronous with the heartbeat, best heard in the left lateral decubitus position.</p>\n<p><strong>Hoover&rsquo;s sign</strong> is the paradoxical inward movement of the rib cage with inspiration in <strong>chronic obstructive pulmonary disease.</strong></p>\n<p><strong>Westermark sign</strong> is seen in chest radiographs of patients with <strong>pulmonary embolism</strong>, indicating <strong>focal oligemia.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/952706e2a81240baa1e8d608e944603e.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/23d362f17ece455c919f0c1c1d82c6dfx442x509.JPEG"
    ]
  },
  {
    "text": "A 30-year-old female came to OPD with complaints of backache. On examination, Schober test was positive and her eyes and nose were hyperpigmented. Probable diagnosis is",
    "choices": [
      {
        "id": 1,
        "text": "Hypoparathyroidism"
      },
      {
        "id": 2,
        "text": "Fluorosis"
      },
      {
        "id": 3,
        "text": "Ochronosis"
      },
      {
        "id": 4,
        "text": "Ankylosing spondylitis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Given X-ray shows intervertebral disc calcification and hyperpigmentation of nose and eyes are present. Both features are indicative of ochronosis as diagnosis.</p>\n<ul>\n<li>Ochronosis also known as <strong>alkaptonuria</strong> is an <strong>autosomal recessive disorder</strong>.</li>\n<li>It is due to <strong>deficiency of homogentisic acid oxidase</strong> leading to accumulation of <strong>homogentisic acid.</strong></li>\n</ul>\n<ul>\n<li>Clinical features: Triad of\n<ul>\n<li>Homogentisic aciduria (urine turns dark color on standing due to oxidation or alkalinisation)</li>\n<li>Eumelanin like pigmentation of skin, sclera, cartilages etc.</li>\n<li>Degenerative chronic arthropathies especially of spine, hip, knees.</li>\n</ul>\n</li>\n</ul>\n<p><strong>Option a:</strong> Hypoparathyroidism doesn't explain hyperpigmentation and other clinical features of hypoparathyroidism aren't mentioned.</p>\n<p><strong>Option b: </strong>Fluorosis - dental symptoms are not mentioned and osteoporosis will be marked in case of fluorosis. Also, hyperpigmentation is not a typical feature of fluorosis.</p>\n<p><strong>Option d: </strong>Ankylosing spondylitis &ndash; females are unlikely to be affected and it doesn&rsquo;t explain hyperpigmentation.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/df31f1cd0d16469abadf81affc2e464d.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 14-year-old patient presents with bilateral proptosis. The biopsy from the region shows this pattern. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Leiomyoma"
      },
      {
        "id": 2,
        "text": "Schwannoma"
      },
      {
        "id": 3,
        "text": "Rhabdomyosarcoma"
      },
      {
        "id": 4,
        "text": "Fibromatosis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical history and biopsy picture is characteristic of <strong>schwannoma</strong>.</p>\n<p>The biopsy specimen in schwannoma shows <strong>hypocellular (Antoni B)</strong> and <strong>hypercellular areas (Antoni A).\u00a0</strong><strong>Antoni A area</strong>\u00a0has the<strong>\u00a0nuclei</strong> of <strong>tumor cells</strong> aligned in <strong>palisading rows. </strong>The<strong> nuclear-free zones</strong>\u00a0that lie between nuclear palisading<strong>\u00a0</strong>are known as<strong>\u00a0Verocay bodies.</strong></p>\n<p>The histological section of a schwannoma showing Antoni A, Antoni B and Verocay bodies is given below:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/89c128c9d636422f886f58ebb4b58332.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/571f13ffb01c465aaf47e7426edc3498x1279x662.JPEG"
    ]
  },
  {
    "text": "A 30-year-old male patient presents with severe dyspnoea. Mitral stenosis with left atrial hypertrophy is seen. Vegetations present on the mitral valve were excised. What is the most likely diagnosis based on the given HPE image?",
    "choices": [
      {
        "id": 1,
        "text": "Rheumatic valvular disease"
      },
      {
        "id": 2,
        "text": "Infective endocarditis"
      },
      {
        "id": 3,
        "text": "Myxoma"
      },
      {
        "id": 4,
        "text": "Sarcoidosis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given image depicts <strong>Aschoff's body</strong>, which is<strong>&nbsp;</strong>suggestive of <strong>rheumatic valvular disease</strong>.</p>\n<p>Aschoff's bodies have the following components:</p>\n<ul>\n<li><strong>Anitschkow cells&nbsp;</strong>or plump macrophages&nbsp;\n<ul>\n<li>Abundant cytoplasm</li>\n<li><strong>Caterpillar cells</strong> - refer to centrally condensed chromatin&nbsp;into slender, wavy ribbons</li>\n</ul>\n</li>\n<li>Foci of fibrinoid necrosis&nbsp;</li>\n<li><strong>Aschoff's giant cells</strong> - multinucleated larger macrophages&nbsp;</li>\n<li>T-cells</li>\n<li>Plasma cells</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/097708998fa24d3b887a849e5238ed8d.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0d4707ed42c54592a733cd019c6a7a88x1280x1111.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/87d6262ce84d41789a0ab1a04c427dd6x1280x1111.JPEG"
    ]
  },
  {
    "text": "A patient presents with fever, headache, and cough with scanty sputum. His chest radiograph shows patchy consolidation of the left lower lobe. The culture of the sputum specimen shows fried egg colonies. Which of the following statements are true regarding the causative organism?",
    "choices": [
      {
        "id": 1,
        "text": "1,2,3,4"
      },
      {
        "id": 2,
        "text": "1,3,4,5"
      },
      {
        "id": 3,
        "text": "1,4,5"
      },
      {
        "id": 4,
        "text": "3,4,5"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The causative organism based on the given clinical scenario showing <strong>fried egg colonies</strong> on culture points to&nbsp;<strong><em>Mycoplasma pneumoniae.&nbsp;</em></strong>It is&nbsp;<strong>devoid</strong> of <strong>cell walls</strong>.</p>\n<p><strong>Mycoplasmas</strong>&nbsp;are the smallest microorganisms that are pleomorphic and <strong>lack cell walls</strong>. There are 4 species that are of importance to humans.</p>\n<ul>\n<li><em>Ureaplasma urealyticum</em></li>\n<li><em>Mycoplasma pneumoniae</em></li>\n<li><em>Mycoplasma hominis</em></li>\n<li><em>Mycoplasma genitalium</em></li>\n</ul>\n<p>Mycoplasmas, which belong to the <strong>class Mollicutes</strong>, derive their <strong>primary</strong> source of energy from <strong>glucose or arginine</strong>. <strong>Ureaplasmas</strong> are an exception as they have the capability to <strong>hydrolyze urea</strong>. To cultivate these bacteria, complex media like <strong>PPLO broth</strong> are employed, consisting of agar, broth, and biphasic media with enriching substances such as <strong>yeast dialysate</strong> and <strong>horse serum</strong>. Penicillin and thallium are added to prevent the growth of other bacteria.</p>\n<p>Mycoplasma colonies exhibit a characteristic <strong>fried egg appearance</strong>, with a central opaque granular region that extends into the depth of the medium, surrounded by a flat, translucent outer zone. For a detailed examination, the <strong>Dienes method</strong> involves cutting a block of agar containing the colony and placing it on a slide. A cover slip is then applied, onto which an <strong>alcoholic solution</strong> of <strong>methylene blue</strong> and azure has been dried.</p>\n<p>These bacteria primarily cause <strong>pneumonia</strong> and <strong>genital</strong> infections. <em>Ureaplasma urealyticum</em> possesses a unique ability to hydrolyze urea and is responsible for <strong>non-gonococcal urethritis</strong>. It can exhibit resistance to commonly used antibiotics such as tetracycline and doxycycline.</p>\n<p>The image given below shows fried-egg colonies of mycoplasma.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/54f6cccbd1914fdda332991805eeaa26x720x475.JPEG"
    ]
  },
  {
    "text": "Consider the following images (A and B) and pick the correct statement.",
    "choices": [
      {
        "id": 1,
        "text": "In B, the earliest microscopic features would be aphthoid ulcerations and focal crypt abscesses"
      },
      {
        "id": 2,
        "text": "In A, rectal involvement is always seen"
      },
      {
        "id": 3,
        "text": "In B, changes due to backwash ileitis are usually mild and superficial"
      },
      {
        "id": 4,
        "text": "In A, granulomas are rarely seen and are of little significance"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In the given images:</p>\n<p>A -<strong> Crohn&rsquo;s Disease (CD)</strong></p>\n<p>B &ndash; <strong>Ulcerative Colitis (UC)</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/028e412993b14fd2a18b2341dd9063af.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "The following two diagnostic techniques (A) and (B) were performed in a medical camp conducted for diagnosing malaria. Which is a true statement regarding these techniques?",
    "choices": [
      {
        "id": 1,
        "text": "Image (A) - It is used for identifying the species of the malarial parasite"
      },
      {
        "id": 2,
        "text": "Image (A) - It is not the established method of choice for diagnosing malaria in urban areas"
      },
      {
        "id": 3,
        "text": "Image (B) - Antibody detection by this test is the method of choice for diagnosing malaria in inaccessible and tribal areas"
      },
      {
        "id": 4,
        "text": "Image (B) - Bivalent type of this test was used for detecting Plasmodium falciparum and Plasmodium vivax"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Image (<strong>A</strong>) is a <strong>thick</strong> <strong>blood</strong> <strong>smear</strong> and Image (<strong>B</strong>) is the Rapid Diagnostic Test (<strong>RDT</strong>). Bivalent RDTs detect <em>P. falciparum </em>and<em> P. vivax</em>.</p>\n<p><strong>Thin</strong> blood smear is used to identify the particular infecting <strong>species</strong>. <strong>Thick</strong> blood smear is used to <strong>detect</strong>\u00a0<strong>infection</strong> and estimate <strong>parasite</strong> <strong>concentration</strong>.</p>\n<p><strong>Antibody detecting </strong>Rapid Diagnostic Tests<strong>\u00a0</strong>(<strong>RDTs</strong>)\u00a0are <strong>not </strong>the method of choice anymore in diagnosing malaria in inaccessible and tribal areas.\u00a0The<strong> Antigen detecting RDTs </strong>and<strong> blood smear </strong>examination are the\u00a0<strong>recommended\u00a0</strong>methods<strong>\u00a0</strong>for diagnosis of malaria.</p>\n<p><strong>Note</strong>: According to the announcement by Union Health Ministry in April 2018, <strong>antibody</strong> <strong>detecting</strong> Rapid Diagnostic Tests (<strong>RDTs</strong>) for malaria is banned due\u00a0to the<strong> high false-positive rates</strong>\u00a0in endemic areas.</p>\n<p>Malaria Antigen detecting Rapid Diagnostic Test kit:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3e6b81a89dff48599955f9fcc8915db5.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c66b1ac9f4984d14974e769ef7234840x500x500.JPEG"
    ]
  }
];
        let quizName = 'Image Test Iii';
        const quizFilename = 'image-test-iii-2087d110.html';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2018-19"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>