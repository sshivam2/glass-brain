<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>14 Bacterial Infections - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Dermatology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following skin infections is caused by the organism shown below?",
    "choices": [
      {
        "id": 1,
        "text": "Pyoderma gangrenosum"
      },
      {
        "id": 2,
        "text": "Pemphigus neonatarum"
      },
      {
        "id": 3,
        "text": "Impetigo herpetiformis"
      },
      {
        "id": 4,
        "text": "Ecthyma contagiosum"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The above image shows Gram-positive cocci in clusters, suggestive of&nbsp;<strong>staphylococcus.&nbsp;</strong>It causes <strong>pemphigus neonatorum</strong> or bullous impetigo of the newborn.</p>\n<p>Option A: <strong>Pyoderma gangrenosum</strong> is a <strong>neutrophilic dermatosis</strong> characterized by chronic, recurrent, very painful ulcers with undermined borders usually found on the lower limbs. It is usually associated with inflammatory bowel disease.</p>\n<p>Option C: <strong>Impetigo herpetiformis</strong> is severe <strong>pustular psoriasis</strong> in pregnancy.</p>\n<p>Option D: <strong>Ecthyma contagiosum</strong> is a contagious pustular dermatitis and a viral zoonotic disease caused by the <strong>parapox virus</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/120797ef77ff42f0a4636d891154180b.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A sample taken from a cutaneous lesion showed growth of the following colonies on blood agar after 24 hours. Catalase test showed no bubble formation. Which of the following diseases is not likely to be associated with this organism?",
    "choices": [
      {
        "id": 1,
        "text": "Carbuncle"
      },
      {
        "id": 2,
        "text": "Scarlet fever"
      },
      {
        "id": 3,
        "text": "Erythema nodosum"
      },
      {
        "id": 4,
        "text": "Kawasaki disease"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Beta-hemolysis</strong>&nbsp;on <strong>blood agar</strong>&nbsp;and the&nbsp;<strong>catalase-negative</strong> test is suggestive of <strong><em>Streptococcus pyogenes</em></strong>. It causes scarlet fever, erythema nodosum and can be a provocative factor for Kawasaki disease.</p>\n<p><strong>Carbuncle</strong> is caused by <strong><em>Staphylococcus aureus</em></strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e10439c9b1b04ff9a4e42466c8b91c08.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A child is brought to the pediatrician's office with the findings shown below. The mother reports that they were initially blisters that started 4 days ago and burst the previous night. What is the most likely causative organism for this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Staphylococcus aureus"
      },
      {
        "id": 2,
        "text": "Streptococcus pyogenes"
      },
      {
        "id": 3,
        "text": "Staphylococcus epidermidis"
      },
      {
        "id": 4,
        "text": "Streptococcus agalactiae"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The above image showing a&nbsp;<strong>bullous</strong> lesion which has ruptured is suggestive of <strong>bullous</strong> <strong>impetigo</strong>. It is caused by <strong><em>S</em></strong><em><strong>taphylococcus</strong> <strong>aureus</strong>.</em></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/5a5fe57d290a482f8063d98e4ab5c4d6.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "An 11-year-old boy is brought with complaints of itchy lesions on his face for 5 days. On examination, multiple ruptured blisters with honey-colored crusting are seen. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Bullous Impetigo"
      },
      {
        "id": 2,
        "text": "Ecthyma"
      },
      {
        "id": 3,
        "text": "Non-bullous Impetigo"
      },
      {
        "id": 4,
        "text": "Erysipelas"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The above scenario is suggestive of <strong>non-bullous impetigo.&nbsp;</strong></p>\n<p>It<strong>&nbsp;</strong>starts as very <strong>flaccid blisters</strong>, which soon <strong>rupture</strong>, creating <strong>erosions</strong> that are covered by characteristic golden yellow or<strong> honey-colored crusts.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6fbd61251237419799b3e6b5eb4158d6x1280x1456.0225669957688.JPEG"
    ]
  },
  {
    "text": "A patient presented with a pruritic lesion on his face. Microbiological examination of swabs taken from the lesion showed Gram-positive cocci arranged in pairs and chains. Which of the following is not a possible complication of his condition?",
    "choices": [
      {
        "id": 1,
        "text": "Scarlet fever"
      },
      {
        "id": 2,
        "text": "Post-streptococcal glomerulonephritis"
      },
      {
        "id": 3,
        "text": "Rheumatic fever"
      },
      {
        "id": 4,
        "text": "Erythema multiforme"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The above scenario is suggestive of <strong>streptococcal</strong> <strong>impetigo</strong>. <strong>Rheumatic</strong> <strong>fever</strong> is a complication of&nbsp;streptococcal <strong>pharyngitis,&nbsp;</strong><strong>not</strong>&nbsp;impetigo.</p>\n<p>The <strong>complications</strong> of streptococcal impetigo include:&nbsp;</p>\n<ul>\n<li>Scarlet fever</li>\n<li>Erythema multiforme</li>\n<li>Post-streptococcal glomerulonephritis.</li>\n<li>Cellulitis&nbsp;</li>\n</ul>\n<p>Infective complications are uncommon in the absence of systemic disease or malnutrition.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/421467efef4f44649bd8ebb935cfd3e7.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "In the condition shown below, which toxin is implicated, and what is its target protein?",
    "choices": [
      {
        "id": 1,
        "text": "Exfoliative toxin, Desmoglein 1"
      },
      {
        "id": 2,
        "text": "TSST-1, Desmoglein 3"
      },
      {
        "id": 3,
        "text": "Exfoliative toxin, Desmoglein 3"
      },
      {
        "id": 4,
        "text": "TSST-1, Desmoglein 1"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The above image is suggestive of <strong>staphylococcal</strong> <strong>scalded</strong> <strong>skin</strong> syndrome or SSSS. <strong>Exfoliative toxin</strong> (ETA and ETB) is produced by the cocci which targets the cell adhesion protein <strong>desmoglein</strong> <strong>1</strong> (DG1) resulting in the separation of intraepidermal keratinocytes.</p>\n<p>A <strong>widespread erythematous eruption</strong> is seen more in flexures leading to blister formation&nbsp; (<strong>Nikolsky</strong> <strong>positive</strong>) and ultimately <strong>painful</strong> <strong>raw</strong> areas. Dislodgement of the intact superficial epidermis by a shearing force, indicating a plane of cleavage is called the Nikolsky sign.</p>\n<p>Children (&lt;6 years) and neonates are most commonly affected by the generalized form of SSSS, rarely adults may be affected. In children, SSSS is known as <strong>Ritter</strong> <strong>disease</strong>. Staphylococcal scalded skin syndrome usually settles within a few weeks when treated with appropriate systemic <strong>antibiotics</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ebed9461e0804535b599b9fa77b14e45.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements regarding the condition shown below is false?",
    "choices": [
      {
        "id": 1,
        "text": "Intraepidermal bullae are formed"
      },
      {
        "id": 2,
        "text": "Regional lymphadenitis is common"
      },
      {
        "id": 3,
        "text": "Varnish crusts are seen"
      },
      {
        "id": 4,
        "text": "Exclusively produced by S. aureus"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The image shows several <strong>bullae</strong> filled with <strong>turbid pus-like fluid</strong> indicating a diagnosis of <strong>b</strong><strong>ullous impetigo</strong>. <strong>Regional lymphadenitis</strong> is <strong>rare</strong> in bullous impetigo.&nbsp;</p>\n<p>Impetigo is a contagious, superficial pyogenic infection of the skin.&nbsp;The<strong> face,</strong> especially around the nose, mouth, and limbs, is most commonly affected, but lesions may occur anywhere.</p>\n<p>Superficial intraepidermal bullae are formed as <strong>d</strong><strong>esmoglein-1</strong> is targetted by the exfoliative toxins produced by <em><strong>S. aureus</strong>.<strong>&nbsp;</strong></em>After the bullae rupture, they leave behind <strong>varnish crust</strong>.&nbsp;<strong>Central healing </strong>and<strong> peripheral extension</strong> may give rise to <strong>circinate lesions</strong> which are eroded.</p>\n<p>Treatment involves topical <strong>fucidin</strong> or mupirocin, <strong>retapamulin</strong> in resistant cases. Systemically therapy with&nbsp;<strong>flucloxacillin</strong> and <strong>erythromycin</strong> may be given.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/fb4733de77a34c4ca5277676e4e8ebe6.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following organisms causes erythrasma?",
    "choices": [
      {
        "id": 1,
        "text": "Corynebacterium diphtheria"
      },
      {
        "id": 2,
        "text": "Corynebacterium minutissimum"
      },
      {
        "id": 3,
        "text": "Corynebacterium tenuis"
      },
      {
        "id": 4,
        "text": "Diphtheriods"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Erythrasma</strong> is an infection of the skin caused by <em><strong>Corynebacterium minutissimum</strong></em>.</p>\n<p>Lesions are sharp <strong>hyperpigmented patches</strong> that may be symptomless or show mild discomfort and itching. It usually affects the&nbsp;<strong>axilla</strong>, groin, inter-gluteal, and submammary regions.&nbsp;</p>\n<p><strong>Coral</strong> <strong>pink</strong>/<strong>red</strong> <strong>fluorescence</strong> due to <strong>coproporphyrin</strong> <strong>III</strong>&nbsp;under Wood's lamp indicates erythrasma.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a303185d59e74aa19452c39155d19d32x1280x1267.3624823695345.JPEG"
    ]
  },
  {
    "text": "A 51-year-old woman complains of yellowish discoloration of her axillary sweat and staining of the clothing for 15 days. She has no other complaints. On examination, yellowish concretions are noted on the hair shafts of the left axilla which have formed hard nodular masses. Underlying skin is normal. What is the most likely causative organism for this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Mycobacterium canis"
      },
      {
        "id": 2,
        "text": "Trichophyton  rubrum"
      },
      {
        "id": 3,
        "text": "Corynebacterium tenuis"
      },
      {
        "id": 4,
        "text": "Trichophyton tonsurans"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The above scenario is suggestive of <strong>trichomycosis</strong> <strong>axillaris</strong> which is caused by <strong><em>Corynebacterium tenuis</em></strong>.</p>\n<p>It is a <strong>superficial infection</strong> of <strong>axillary</strong> and pubic hairs with the formation of <strong>yellow</strong>, black, or red nodular <strong>concretions</strong> on the hair shaft. The axillary sweat may be yellow, black, or red according to the color of the concretions, and the clothing may be stained.</p>\n<p>The condition is usually&nbsp;<strong>asymptomatic</strong> and the patient is often unaware of its presence. The use of an effective <strong>antiperspirant</strong> such as aluminum chloride is a rapid means of therapy.&nbsp;</p>\n<p>The image below shows trichomycosis axillaris in the axilla with a close-up view of nodules on the hair shaft.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9de5cb90350c481fb07c1df5d8a2e074x1280x1479.4922425952045.JPEG"
    ]
  },
  {
    "text": "A 21-year-old fisherman presents with multiple pustular lesions mounted with thick adherent crusts on his left leg for 7 days. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Botryomycosis"
      },
      {
        "id": 2,
        "text": "Erysipelas"
      },
      {
        "id": 3,
        "text": "Carbuncle"
      },
      {
        "id": 4,
        "text": "Ecthyma"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Option C: Carbuncle is a&nbsp;deep-seated cutaneous infection around a group of hair follicles with sieve-like multiple openings discharging pus.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9be4cea5b1204bbd9b7941ef4c643a52x1280x1609.478138222849.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b33a864e93da4f90b834a24398d85aa6x1280x1459.6332863187588.JPEG"
    ]
  },
  {
    "text": "A 46-year-old woman presents with painless lesions on her back as shown below which started 2 months ago. She is a known case of CKD receiving dialysis. Blood counts revealed neutropenia. Which organism is most likely to be seen in the culture of the biopsy from this lesion?",
    "choices": [
      {
        "id": 1,
        "text": "Staphylococcus"
      },
      {
        "id": 2,
        "text": "Streptococcus"
      },
      {
        "id": 3,
        "text": "Pseudomonas"
      },
      {
        "id": 4,
        "text": "Clostridium"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The above image showing <strong>necrotic ulcers</strong> in an <strong>immunocompromised</strong> patient is suggestive of <strong>ecthyma gangrenosum.</strong> It is caused by <em><strong>Pseudomonas aeruginosa</strong></em>.</p>\n<p>The characteristic lesions of ecthyma gangrenosum are hemorrhagic pustules that evolve into a necrotic (black) ulcer. It commonly occurs in the axillae, perineum, buttocks.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/f544c0937da545398b2313362898c0ad.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7e762864afae402f8c437406088fc679x1280x1196.953455571227.JPEG"
    ]
  },
  {
    "text": "A 31-year-old male patient presents with fever and painful lesions with mucopurulent discharge for 10 days. Histochemical examination of the discharge with Gomori methenamine silver (GMS) stain was negative. Which is the most likely organism to be seen in the culture performed from the lesions?",
    "choices": [
      {
        "id": 1,
        "text": "Mycobacteria"
      },
      {
        "id": 2,
        "text": "Dermatophyte"
      },
      {
        "id": 3,
        "text": "Actinomycetes"
      },
      {
        "id": 4,
        "text": "Staphylococcus"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The above image showing multiple <strong>skin</strong> <strong>abscesses</strong> with <strong>mucopurulent\u00a0</strong><strong>discharge</strong> through multiple <strong>sinuses</strong> which does not show filamentous organisms on staining with Gomori methenamine silver (GMS negative) is suggestive of <strong>botryomycosis</strong>. It is caused by <strong>staphylococci</strong>.</p>\n<p>Botryomycosis is a misnomer. It is a bacterial infection caused usually by staphylococcus. It is a <strong>chronic</strong> <strong>granulomatous</strong> reaction to bacterial infection, containing <strong>granules</strong> resembling the sulfur granules of actinomycosis.</p>\n<p><strong>Etiological agents</strong> include:</p>\n<ul>\n<li><em>Staphylococcus aureus\u00a0</em>(most common)</li>\n<li><em>Pseudomonas</em></li>\n<li><em> Escherichia coli</em></li>\n<li><em> Proteus</em></li>\n<li><em> Streptococcus</em>.</li>\n</ul>\n<p>Most lesions are on the <strong>limbs</strong>, but other sites including the perianal region and the face are affected.</p>\n<p>Treatment is with <strong>antibiotics</strong> against <em>S.aureus</em> - flucloxacillin or erythromycin.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/55f0e18b8c5140fabfcaa8197a939154.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 34-year-old carpenter presents with painful swelling in his left index finger for 1 day. Which organism is commonly responsible for his condition?",
    "choices": [
      {
        "id": 1,
        "text": "Candida albicans"
      },
      {
        "id": 2,
        "text": "Pseudomonas aeruginosa"
      },
      {
        "id": 3,
        "text": "Streptococcus pyogenes"
      },
      {
        "id": 4,
        "text": "Staphylococcus aureus"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The above scenario depicts <strong>acute</strong> <strong>suppurative</strong> <strong>infection</strong> of the nail <strong>beds</strong> and <strong>folds</strong> which is called <strong>acute</strong> <strong>paronychia</strong>. It is most commonly caused by <em><strong>Staphylococcus aureus</strong></em>.&nbsp;</p>\n<div class=\"page\" title=\"Page 2506\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Acute paronychia is infection of the nail fold are represented by inflammation, swelling and abscess formation.</p>\n</div>\n</div>\n</div>\n</div>\n<p>It presents as <strong>tender</strong>, <strong>purulent</strong> swellings around the nail.</p>\n<p>Diagnosis is clinical and a cover of systemic antibiotics may be needed for deep infections.</p>\n<p>Treatment of pyogenic paronychia:&nbsp;</p>\n<ul>\n<li>Protection against trauma</li>\n<li>Keep affected fingernails dry.</li>\n<li>Abscesses -&nbsp;<strong>incised</strong> and <strong>drained</strong>. (abscess is often opened by pushing the nail fold away from the nail plate)</li>\n<li>Antibiotics- Semisynthetic <strong>penicillin</strong>/ <strong>cephalosporin</strong> with excellent anti-staphylococcal orally.</li>\n</ul>\n<p>Complications of acute paronychia may include osteitis and amputation.</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/9af6d7cc97b346679fa0a228215ebf82.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 4-month-old male infant developed otitis media for which he was given a course of cotrimoxazole. A few days later, he developed fever, irritability, and skin tenderness followed by extensive peeling of the skin. There were no mucosal lesions. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Infantile pemphigus"
      },
      {
        "id": 2,
        "text": "Stevens-Johnson syndrome"
      },
      {
        "id": 3,
        "text": "Toxic epidermal necrolysis"
      },
      {
        "id": 4,
        "text": "Staphylococcal scalded skin syndrome"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The infant presents with an <strong>infection</strong>&nbsp;<strong>focus </strong>(otitis media) that is followed by <strong>generalized peeling of the skin</strong> and toxic state of the baby <strong>without any mucosal involvement&nbsp;</strong>which is suggestive of&nbsp;<strong>s</strong><strong>taphylococcal scalded skin syndrome</strong>.</p>\n<table style=\"height: 263px;\" width=\"574\">\n<tbody>\n<tr>\n<td style=\"width: 122.297px;\">&nbsp;</td>\n<td style=\"width: 215.203px;\"><strong>Staphylococcal scalded skin syndrome</strong></td>\n<td style=\"width: 214.5px;\"><strong>Stevens-Johnson syndrome/ Toxic epidermal necrolysis</strong></td>\n</tr>\n<tr>\n<td style=\"width: 122.297px;\"><strong>Age</strong></td>\n<td style=\"width: 215.203px;\">Infants and children under age of 6</td>\n<td style=\"width: 214.5px;\">Adults</td>\n</tr>\n<tr>\n<td style=\"width: 122.297px;\"><strong>Mucosal involvement</strong></td>\n<td style=\"width: 215.203px;\">No</td>\n<td style=\"width: 214.5px;\">Yes</td>\n</tr>\n<tr>\n<td style=\"width: 122.297px;\"><strong>Nikolsky sign</strong></td>\n<td style=\"width: 215.203px;\">Positive</td>\n<td style=\"width: 214.5px;\">Pseudo-Nikolsky sign Positive</td>\n</tr>\n<tr>\n<td style=\"width: 122.297px;\"><strong>Targetoid lesions</strong></td>\n<td style=\"width: 215.203px;\">Absent</td>\n<td style=\"width: 214.5px;\">Present</td>\n</tr>\n<tr>\n<td style=\"width: 122.297px;\"><strong>Histopathology</strong></td>\n<td style=\"width: 215.203px;\">Acantholytic cells with subcorneal or subgranular blister</td>\n<td style=\"width: 214.5px;\">\n<p>Necrotic keratinocytes</p>\n<p>Dermo-epidermal separation</p>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 25-year-old man presents with multiple pustular lesions on the face. On examination, slight crusting and scaling are present but the hairs are retained with no underlying scarring. Which is the most likely causative organism in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Staphylococcus aureus"
      },
      {
        "id": 2,
        "text": "Pseudomonas aeruginosa"
      },
      {
        "id": 3,
        "text": "Varicella-zoster virus"
      },
      {
        "id": 4,
        "text": "Trichophyton tonsurans"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The above clinical scenario is suggestive of <strong>sycosis</strong> <strong>barbae</strong> which is caused by <em><strong>Staphylococcus aureus</strong></em>.</p>\n<p>Sycosis is a subacute or chronic infection involving the whole depth of the <strong>follicle. </strong>It is&nbsp;a disease of the <strong>beard</strong> <strong>area</strong>.&nbsp;The essential lesion is an oedematous erythematous <strong>follicular </strong>papule or <strong>pustule</strong> centered on a hair. The individual papules may coalesce to produce the appearance of a <strong>ripe fig.&nbsp;</strong>It is a <strong>non-scarring</strong> pyogenic infection.</p>\n<p>If the follicles are destroyed with evident <strong>scarring</strong>, the term <strong>lupoid</strong> <strong>sycosis&nbsp;</strong>is used.</p>\n<p>Tinea barbae/<strong>tinea</strong> <strong>sycosis</strong> is a <strong>dermatophyte</strong> infection caused by<em> Trichophyton tonsurans</em>, the upper lip is spared.</p>\n<p><strong>Herpetic</strong> <strong>sycosis</strong> is caused by the herpes simplex virus.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3d056ba90df249fcb700d3030174ebc5.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following is responsible for the transmission of erysepeloid infection in humans?",
    "choices": [
      {
        "id": 1,
        "text": "Droplet"
      },
      {
        "id": 2,
        "text": "Parasite"
      },
      {
        "id": 3,
        "text": "Mosquito bite"
      },
      {
        "id": 4,
        "text": "Contact with animal"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>In<strong> erysepeloid,</strong>&nbsp; human infection is contracted by <strong>direct contact</strong> with<strong> animals</strong>.</p>\n<p>Erysipeloid is an acute infection with <em><strong>Erysipelothrix rusiopathiae</strong></em>, a Gram\u2010positive bacillus living mainly on dead animal matter. It causes diseases in many animals, especially in pigs. It usually affects&nbsp;<strong>butchers,</strong> <strong>cooks</strong>, <strong>fishermen, farmers,</strong> and <strong>veterinary</strong> surgeons.</p>\n<p>About 3 days after inoculation, hot violaceous and <strong>tender erythema</strong> develops around the inoculation site and spreads centrifugally.</p>\n<p>Without treatment, <strong>healing</strong> normally occurs <strong>spontaneously</strong> in 2 weeks without desquamation or suppuration.</p>\n<p>Antibiotic therapy: <strong>Penicillin</strong>, <strong>erythromycin,</strong> and <strong>ciprofloxacin</strong>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/96a986f1bc484197aa4225403aea92f4x469x740.PNG"
    ]
  },
  {
    "text": "Choose the incorrect statement regarding the condition shown in the image below.",
    "choices": [
      {
        "id": 1,
        "text": "Serine proteases degrade keratin in the horny layer"
      },
      {
        "id": 2,
        "text": "Often associated with malodour and maceration"
      },
      {
        "id": 3,
        "text": "Mainly caused by corynebacterial infection"
      },
      {
        "id": 4,
        "text": "Usually associated with anhidrosis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The above image shows numerous small, shallow, <strong>circular</strong> <strong>erosions</strong> with<strong> punched-out</strong> appearance over <strong>pressure bearing area</strong> of soles, characteristic of <strong>pitted keratolysis</strong>.</p>\n<p>It is usually associated with<strong> hyperhidrosis</strong> (not anhidrosis). Pitted keratolysis is caused most commonly due to infection by <strong>Corynebacterium</strong> and also by <em><strong>Kytococcus sedentarius</strong></em>. The pits are produced by <strong>serine proteases</strong> that can degrade keratin in the horny layer.</p>\n<p>Most patients are unaware of the condition due to <strong>minimal irritation</strong>. This condition is diagnosed by its clinical appearance. Cultures are not useful due to <strong>mixed infections</strong>.</p>\n<p>Treatment of hyperhidrosis slowly brings the condition under control including <strong>potassium permanganate soaks</strong>, aluminum chloride, and iontophoresis. Topical <strong>fucidin</strong> ointment may be used.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/089ae868ae1d4b2f974fae426f97cf9a.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "The image shows a bacterial skin infection. Identify the correct statement regarding the diagnosis.",
    "choices": [
      {
        "id": 1,
        "text": "Also known as St. Anthony's fire"
      },
      {
        "id": 2,
        "text": "Infection of the superficial dermal lymphatics"
      },
      {
        "id": 3,
        "text": "Does not extend into the pinna in facial infection"
      },
      {
        "id": 4,
        "text": "Presents as erythematous tender lesion with well defined margins"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>This image shows a large erythematous lesion with <strong>diffuse and ill-defined borders</strong> suggestive of <strong>c</strong><strong>elullitis</strong> of the foot. The pinna is <strong>not involved</strong> in cellulitis of face.&nbsp;All the other features mentioned are that of <strong>erysipelas</strong>.</p>\n<p><strong> Milians's ear sign</strong> is used to distinguish between erysipelas and cellulitis of the facial region, where there is<strong> involvement of ear in erysipelas</strong> and <strong>sparing in cellulitis</strong>, as there is no deeper dermal tissue and subcutaneous fat in the pinna.&nbsp;</p>\n<p>Current usage tends to regard <strong>erysipelas as a form of cellulitis</strong> rather than a distinct entity, so that the definition of cellulitis would include inflammation of dermal as well as subcutaneous tissue.&nbsp;</p>\n<p>Similarities include the presence of&nbsp;group A beta-hemolytic streptococci &gt; <em>Staphylococcus aureus, Hemophilus influenza </em>and often a region of<strong> portal of entry</strong> for infection like tinea or trauma.</p>\n<p>Usually the disease settles over 1&ndash;2 weeks with appropriate systemic antibiotics like Flucloxacillin</p>\n<table style=\"height: 223px;\" width=\"502\">\n<tbody>\n<tr>\n<td style=\"width: 251.062px;\">\n<p style=\"text-align: center;\"><strong>Erysipelas&nbsp;</strong>(St.Anthony's fire)</p>\n</td>\n<td style=\"width: 234.938px;\">\n<p style=\"text-align: center;\"><strong>Cellulitis</strong></p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 251.062px;\">Infection of superficial dermal lymphatics</td>\n<td style=\"width: 234.938px;\">Suppurative inflammation involving the subcutaneous tissue</td>\n</tr>\n<tr>\n<td style=\"width: 251.062px;\">Raised and sharply demarcated edge that spreads by peripheral extension</td>\n<td style=\"width: 234.938px;\">Diffuse, ill-defined margins</td>\n</tr>\n<tr>\n<td style=\"width: 251.062px;\">Blistering is common with superficial hemorrhage</td>\n<td style=\"width: 234.938px;\">Severe cellulitis may show bullae and progress to dermal necrosis</td>\n</tr>\n<tr>\n<td style=\"width: 251.062px;\">Extends over the ear</td>\n<td style=\"width: 234.938px;\">Does not extend over the ear</td>\n</tr>\n</tbody>\n</table>\n<p><strong>Note</strong>:&nbsp;<strong>St. Anthony's Fire</strong>&nbsp;is also used for ergotism caused by the fungus <em>Claviceps purpura</em> as it causes&nbsp;burning sensations resulting in gangrene of limbs.</p>\n<p>The image below shows erysipelas, with well demarcated raised margins.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ad63264bfbc54475a313477e6c6050a0.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/bd9b49db5eff45ad800fe06dfe9ac2acx1280x1516.5021156558532.JPEG"
    ]
  },
  {
    "text": "Given below is a Gram-stain appearance of an organism. Which of the following cutaneous infections are not caused by this organism?",
    "choices": [
      {
        "id": 1,
        "text": "Sycosis"
      },
      {
        "id": 2,
        "text": "Folliculitis"
      },
      {
        "id": 3,
        "text": "Furunculosis"
      },
      {
        "id": 4,
        "text": "Scarlet fever"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The above image is suggestive of <strong>staphylococcus</strong>&nbsp;which causes <strong>sycosis</strong>, <strong>folliculitis,</strong> and <strong>furunculosis</strong>.</p>\n<p><strong>Scarlet fever</strong> is caused by <em>Streptococcus pyogenes.</em></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/63fe82cab33b42a0a1248bc371599248.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "In which of the following conditions would you see coral pink fluorescence in the groin region on Wood's lamp examination?",
    "choices": [
      {
        "id": 1,
        "text": "Erysipeloid"
      },
      {
        "id": 2,
        "text": "Erythrasma"
      },
      {
        "id": 3,
        "text": "Erysipelas"
      },
      {
        "id": 4,
        "text": "Ecthyma"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The&nbsp;<strong>coral</strong> <strong>pink</strong> <strong>fluorescence</strong> in the groin region on Wood's Lamp examination is characteristically seen in <strong>erythrasma</strong>. Coral pink fluorescence is due to the presence of <strong>porphyrins</strong>. <em><strong>Corynebacterium minutissimum</strong></em> is the bacterium responsible for erythrasma and the conversion of&nbsp;<strong>aminolaevulinic</strong> acid to <strong>protoporphyrin</strong>.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '14 Bacterial Infections';
        const quizFilename = '14-bacterial-infections-8308576a.html';
        let hierarchy = ["Marrow", "qBank", "Dermatology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>