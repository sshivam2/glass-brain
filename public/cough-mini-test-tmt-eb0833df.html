<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cough Mini Test - -Tmt - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2023-24
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A friend of yours has been complaining of a dry cough and asks you to recommend a cough syrup that will not make him drowsy or constipated. Which of the following would be the best option?",
    "choices": [
      {
        "id": 1,
        "text": "Morphine"
      },
      {
        "id": 2,
        "text": "Hydroxycodone"
      },
      {
        "id": 3,
        "text": "Codeine"
      },
      {
        "id": 4,
        "text": "Dextromethorphan"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Dextromethorphan</strong> would be the best option as it is a <strong>synthetic central NMDA </strong>(N-methyl D-aspartate)<strong> receptor antagonist </strong>and would be less likely to cause effects like<strong> sedation</strong> and <strong>constipation </strong>as seen with <strong>opioid antitussives </strong>like <strong>morphine, hydrocodone</strong>, and<strong> codeine.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the duration of cough beyond which a patient is labelled to have 'chronic cough'?",
    "choices": [
      {
        "id": 1,
        "text": "2 weeks"
      },
      {
        "id": 2,
        "text": "4 weeks"
      },
      {
        "id": 3,
        "text": "6 weeks"
      },
      {
        "id": 4,
        "text": "8 weeks"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>A cough lasting <strong>more than 8 weeks</strong> in adults is generally considered <strong>chronic</strong> cough.</p>\n<p>Based on the duration of symptoms, cough is classified as follows:</p>\n<table style=\"border-collapse: collapse; width: 35.6685%;\" border=\"1\">\n<tbody>\n<tr>\n<td style=\"width: 49.9064%; text-align: center;\"><strong>Description</strong></td>\n<td style=\"width: 49.9064%; text-align: center;\"><strong>Duration</strong></td>\n</tr>\n<tr>\n<td style=\"width: 49.9064%; text-align: center;\">Acute</td>\n<td style=\"width: 49.9064%; text-align: center;\">&lt;3 weeks</td>\n</tr>\n<tr>\n<td style=\"width: 49.9064%; text-align: center;\">Sub-acute</td>\n<td style=\"width: 49.9064%; text-align: center;\">3-8 weeks</td>\n</tr>\n<tr>\n<td style=\"width: 49.9064%; text-align: center;\"><strong>Chronic</strong></td>\n<td style=\"width: 49.9064%; text-align: center;\"><strong>&gt;8 weeks</strong></td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 60-year-old male patient presents with complaints of chronic cough and weight loss. He gives a history of smoking half a pack of cigarettes daily since he was 20 years old. How many pack years has he smoked?",
    "choices": [
      {
        "id": 1,
        "text": "10 pack years"
      },
      {
        "id": 2,
        "text": "20 pack years"
      },
      {
        "id": 3,
        "text": "30 pack years"
      },
      {
        "id": 4,
        "text": "40 pack years"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>A <strong>standard pack</strong> of cigarettes contains <strong>20 cigarettes</strong>. The <strong>number of pack years</strong> smoked is calculated by the formula:</p>\n<p><strong>(No. cigarettes smoked per day x No. of years smoked) / 20</strong></p>\n<p>This 60-year-old patient has smoked <strong>half a pack</strong> of cigarettes, ie, <strong>10 cigarettes per day</strong>, since the age of 20, ie, for the last<strong> 40 years</strong>. Therefore, the number of pack years he has smoked would be (10x40) / 20 = <strong>20 pack years</strong></p>\n<p>It has been documented that cigarette smoking increases the risk of developing lung cancer 10-fold and cigarette smoking is responsible for as much as 90% of all lung cancers. An accurate history of smoking is essential and should be quantified in a sensitive manner as patients may conceal details. Assessment of smoking history in pack years aids in risk assessment. Current guidelines recommend <strong>annual screening</strong> for lung cancer\u00a0with <strong>low-dose helical CT</strong> in patients <strong>aged between 50-80</strong> with a <strong>20-pack-year</strong> smoking history who are either <strong>current smokers</strong> or <strong>former smokers</strong> having <strong>quit within the past 15 years.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following would be noted in the history of a patient with upper airway cough syndrome?",
    "choices": [
      {
        "id": 1,
        "text": "1, 2, 3"
      },
      {
        "id": 2,
        "text": "2, 3, 4"
      },
      {
        "id": 3,
        "text": "3, 4, 5"
      },
      {
        "id": 4,
        "text": "1, 3, 5"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Post-nasal drip, sneezing and rhinorrhea </strong>are all features of<strong> upper airway cough syndrome</strong> whereas expectoration and chest pain are unlikely to be associated with the syndrome.</p>\n<p>Inflammation or irritation of the nose and paranasal sinuses usually lead to post-nasal drainage that stimulate the sensory receptors in the pharynx and result in cough. However, it is been observed that patients with c<strong>hronic inflammation of the nose and paranasal sinuses</strong> may have a <strong>cough</strong> even in the <strong>absence of physical drainage into the pharynx</strong> and hence the term upper airway cough syndrome is used to describe this spectrum.</p>\n<p>Patients may present with cough associated with <strong>post-nasal drip, rhinorrhea, sneezing </strong>and <strong>frequent throat clearing.</strong> Examination may reveal inflamed nasal mucosa or polyps, with associated posterior pharyngeal wall congestion.</p>\n<p>A history of <strong>expectoration</strong> and <strong>chest pain</strong> in association with cough would indicate pathology that is more likely to be <strong>distal to the pharynx</strong>, ie, affecting the tracheo-bronchial tree or the parenchyma.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following underlying lung pathologies may be indicated by a 'bovine' cough?",
    "choices": [
      {
        "id": 1,
        "text": "Left hilar malignancy"
      },
      {
        "id": 2,
        "text": "Pleural effusion"
      },
      {
        "id": 3,
        "text": "Lobar pneumonia"
      },
      {
        "id": 4,
        "text": "Chronic bronchitis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Bovine cough</strong> may be indicative of an underlying <strong>left hilar malignancy.</strong></p>\n<p>A <strong>normal cough</strong> occurs when the patient expels air against a <strong>closed glottis</strong>. The term <strong>bovine cough</strong> refers to a <strong>hoarse weak cough</strong> that is classically described in patients with a <strong>left recurrent laryngeal nerve palsy </strong>occurring due to a <strong>left hilar malignancy</strong> affecting the nerve. This causes <strong>vocal cord palsy</strong> leading to <strong>incomplete closure of the glottis.\u00a0</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Match the following descriptions of sputum characteristics to the most likely diagnosis in a patient presenting with cough with expectoration.",
    "choices": [
      {
        "id": 1,
        "text": "1-B, 2-A, 3-D, 4-C"
      },
      {
        "id": 2,
        "text": "1-A, 2-B, 3-C, 4-D"
      },
      {
        "id": 3,
        "text": "1-D, 2-C, 3-B, 4-A"
      },
      {
        "id": 4,
        "text": "1-A, 2-D, 3-C, 4-B"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The correct pairs are as follows:</p>\n<table style=\"border-collapse: collapse; width: 31.8512%; height: 111.979px;\" border=\"1\">\n<tbody>\n<tr style=\"height: 22.3958px;\">\n<td style=\"width: 49.9979%; height: 22.3958px;\"><strong>Sputum Characteristic</strong></td>\n<td style=\"width: 49.9979%; height: 22.3958px;\"><strong>Associated condition</strong></td>\n</tr>\n<tr style=\"height: 22.3958px;\">\n<td style=\"width: 49.9979%; height: 22.3958px;\"><strong>1.</strong> Clear, mucoid</td>\n<td style=\"width: 49.9979%; height: 22.3958px;\"><strong>B.</strong> COPD</td>\n</tr>\n<tr style=\"height: 22.3958px;\">\n<td style=\"width: 49.9979%; height: 22.3958px;\"><strong>2.</strong> Green, purulent</td>\n<td style=\"width: 49.9979%; height: 22.3958px;\"><strong>A.</strong> Bronchiectasis</td>\n</tr>\n<tr style=\"height: 22.3958px;\">\n<td style=\"width: 49.9979%; height: 22.3958px;\"><strong>3. </strong>Rusty, red</td>\n<td style=\"width: 49.9979%; height: 22.3958px;\"><strong>D.</strong> Pneumonia</td>\n</tr>\n<tr style=\"height: 22.3958px;\">\n<td style=\"width: 49.9979%; height: 22.3958px;\"><strong>4. </strong>Pink, frothy</td>\n<td style=\"width: 49.9979%; height: 22.3958px;\"><strong>C. </strong>Pulmonary edema</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following would be the most relevant in a hypertensive patient presenting with new onset dry cough?",
    "choices": [
      {
        "id": 1,
        "text": "Smoking history"
      },
      {
        "id": 2,
        "text": "Occupational history"
      },
      {
        "id": 3,
        "text": "Medication history"
      },
      {
        "id": 4,
        "text": "Immunisation history"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In a <strong>hypertensive patient</strong> with a <strong>new onset cough,</strong>\u00a0as the use of an <strong>angiotensin-converting enzyme (ACE) inhibitor</strong> should be ruled out as a cause for the cough, and hence\u00a0<strong>medication history</strong> would be the most relevant.</p>\n<p><strong>Dry cough</strong> is a known side effect of <strong>ACE inhibitors</strong> and occurs due to the accumulation of <strong>bradykinins</strong> that are normally metabolized by ACE. The incidence of patients on ACE inhibitors developing cough is reported to be as high as 30% and <strong>chest x-rays</strong> in such patients are likely to have <strong>no abnormalities. </strong></p>\n<p><strong>Changing the patient's medications</strong> from ACE inhibitor to another class of antihypertensives such as angiotensin receptor blocker (<strong>ARB</strong>) would be the best approach to take to treat the patient's cough while still managing the underlying hypertension. In case the patient still has a cough after one month of being put off ACE inhibitors, further workup would be indicated to diagnose the cause of cough.</p>\n<p>Other adverse effects of ACE inhibitors include<strong> hypotension, angioedema, hyperkalemia</strong>, and <strong>skin rashes</strong>. In patients with <strong>bilateral renal artery stenosis</strong>, it can precipitate <strong>acute renal failure.</strong> \u00a0A rarer complication is <strong>visceral angioedema</strong> marked by vomiting, diarrhea, and abdominal pain. They are also known to be <strong>teratogenic</strong>\u00a0and need to be replaced with other drugs during pregnancy.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In a patient who presents with a cough, which of the following additional points in history would be most suggestive of lower airway narrowing?",
    "choices": [
      {
        "id": 1,
        "text": "Snoring"
      },
      {
        "id": 2,
        "text": "Expectoration"
      },
      {
        "id": 3,
        "text": "Wheezing"
      },
      {
        "id": 4,
        "text": "Exercise intolerance"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<div class=\"page\" title=\"Page 378\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Wheezing </strong>is most likely to be suggestive of<strong> lower airway narrowing.</strong></p>\n<p><strong>Wheeze</strong> is a <strong>continuous high-pitched expiratory musical sound </strong>produced due to the conduction of sound through a narrow lumen, clinically indicative of<strong> lower airway narrowing </strong>due to <strong>obstruction </strong>or <strong>inflammation</strong>. A patient may <strong>complain</strong> of a wheeze which is commonly perceived as a <strong>whistling note </strong>on expiration. However, wheeze is also descriptive of an <strong>auscultatory finding</strong> of a similar sound. Multiple wheezing sounds heard together are called <strong>polyphonic</strong> wheeze and are commonly heard in conditions like <strong>bronchial asthma, bronchiolitis</strong>, and viral <strong>infection</strong> of the lower respiratory tract. A <strong>solitary wheeze</strong> or wheeze localized to a single area may indicate a fixed bronchial obstruction.</p>\n<p>Other options</p>\n<p>Option A:<strong> Snoring </strong>is caused by oropharyngeal obstruction and is a low-pitched irregular inspiratory sound which points more towards <strong>upper airway obstructive pathology</strong>.</p>\n<p>Option B: <strong>Expectoration</strong> is more specifically indicative of a <strong>collection of secretions</strong> within the <strong>airways or alveoli</strong>, which may lead to airway obstruction, but is not suggestive of luminal narrowing.</p>\n<p>Option D: A history of <strong>exercise intolerance</strong> could indicate underlying <strong>pulmonary</strong> as well as <strong>cardiac pathology</strong>, but indicates <strong>hypoxia</strong> and <strong>inadequate gaseous exchange</strong> rather than airway obstruction.</p>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 30-year-old patient presents to you with fever and cough with expectoration. On examination, his vitals were as follows: PR- 110/min, RR- 24/min, SpO2- 91%, T- 104 F. His radiograph is as shown below. Which of the following findings would be seen on clinical examination of his respiratory system?",
    "choices": [
      {
        "id": 1,
        "text": "Vesicular breath sounds, increased vocal resonance and tactile fremitus"
      },
      {
        "id": 2,
        "text": "Bronchial breath sounds, increased vocal resonance and tactile fremitus"
      },
      {
        "id": 3,
        "text": "Vesicular breath sounds, decreased vocal resonance and tactile fremitus"
      },
      {
        "id": 4,
        "text": "Bronchial breath sounds, decreased vocal resonance and tactile fremitus"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario and chest x-ray showing a <strong>consolidation</strong> in the <strong>right lower lobe</strong> is suggestive of a likely diagnosis of <strong>pneumonia</strong>. The patient is likely to have <strong>bronchial breath sounds with increased vocal resonance</strong> <strong>and tactile fremitus</strong>.</p>\n<p>In a<strong> healthy lung</strong>, the <strong>sound of air</strong> passing through the airways gets <strong>muffled </strong>as it goes from the upper airways with a wide luminal cross-section to the lower-airways with a narrower luminal cross-section. This produces the <strong>'normal vesicular' breath sounds</strong> heard on auscultation. In a <strong>consolidated or fibrosed lung</strong>, which becomes <strong>more dense</strong> than air-filled, the sound of air in the distal airways getting <strong>better conducted</strong> through the diseased lung parenchyma. As a result, on auscultation, a<strong> louder sound </strong>is heard, similar to what would be heard in the bronchi or proximal airways, hence the term '<strong>bronchial' breath sounds</strong>\u00a0is used.</p>\n<p>The same principle applies to the conduction of <strong>vocally produced sound</strong>, ie, normally it is muffled in a healthy lung but it is better conducted in a <strong>consolidated lung </strong>and hence the patient also has an <strong>increased vocal resonance</strong> and <strong>increased tactile vocal fremitus.</strong></p>\n<p>Breath sounds and vocal resonance would both be decreased in conditions where the conduction of air through the chest wall is impaired, such as due to the presence of air or fluid as in pneumothorax and pleural effusion respectively, or in the case of a collapsed lung.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a94d6058801a467bbfe174703ad486d2.jpg"
    ],
    "explanation_images": []
  },
  {
    "text": "While crossing the road, a truck with dense exhaust fumes pass you by and you immediately cough. Which of the following receives sensory stimuli for the generation of the reflex involved?",
    "choices": [
      {
        "id": 1,
        "text": "Nucleus tractus solitarius"
      },
      {
        "id": 2,
        "text": "Nucleus ambiguus"
      },
      {
        "id": 3,
        "text": "Inferior salivatory nucleus"
      },
      {
        "id": 4,
        "text": "Rostral ventrolateral medulla"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p class=\"p1\">The\u00a0<strong>nucleus tractus solitarius </strong>received the sensory afferents in the <strong>cough reflex.</strong></p>\n<p class=\"p1\">The cough reflex is a protective mechanism of the larynx to expel irritants and keep the airway clear. Chemical or mechanical irritation of the respiratory mucosa stimulates the <strong>afferent </strong>internal laryngeal nerve, which is the branch of the superior laryngeal nerve of the <strong>vagus nerve.\u00a0</strong>These sensory fibres <strong>synapse</strong> in the nucleus tractus solitarius in the medulla oblongata. Complex neural networks here generate the conscious 'urge to cough' while also sending efferent signals to the various muscles involved in generating an effective cough which include the adductors of the <strong>vocal cord</strong>, the <strong>diaphragm</strong>, the <strong>external intercostals </strong>and the muscles of the <strong>anterior abdominal wall</strong>.</p>\n<p class=\"p1\"><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">Alcohol can cause chemical irritation of the internal laryngeal nerve while also acting as a potent inhibitor of the central nervous system, which may cause inhibition of the cough and gag reflexes that increase the risk of aspiration.</span></p>\n<p class=\"p1\">Other options:</p>\n<p class=\"p1\">Option B: The<strong> nucleus ambiguus</strong> sends <strong>motor efferent fibres</strong> to the pharyngeal constrictors, intrinsic laryngeal muscles, and striated muscles of the palate and upper esophagus through the <strong>CN IX and CN X.</strong></p>\n<p class=\"p1\">Option C: The<strong> inferior salivatory nucleus</strong> give rise to the <strong>preganglionic parasympathetic</strong> fibres that enter that relay in the <strong>otic ganglion</strong>, as part of the secretomotor pathway of the <strong>parotid gland.</strong></p>\n<p class=\"p1\"><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">Option D: The <strong>rostral ventrolateral medulla</strong> (RVLM) is the major <strong>excitatory</strong> source of the <strong>sympathetic nervous system\u00a0</strong>that forms part of the <strong>baroreceptor reflex</strong>, responsible for causing a rise in BP.</span></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following are unlikely to be seen in cough-variant asthma?",
    "choices": [
      {
        "id": 1,
        "text": "1, 2, 3"
      },
      {
        "id": 2,
        "text": "2, 3, 4"
      },
      {
        "id": 3,
        "text": "3, 4, 5"
      },
      {
        "id": 4,
        "text": "1, 3, 5"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Cough-variant asthma </strong>refers to the <strong>atypical presentation of asthma</strong> where a patient presents with<strong> cough</strong> in the <strong>absence of typical features</strong> like<strong> wheeze, shortness of breath, </strong>and<strong> chest tightness. </strong></p>\n<p>The cough develops in the presence of environmental triggers such as allergens, cold weather, exercise etc. Such patients are diagnosed by objective tests for asthma such as the methacholine challenge test, and their symptoms improve with the use of bronchodilators. This kind of presentation is more common among children.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An 8-year-old boy with incomplete vaccination history comes with vomiting after bouts of severe, violent cough. What is the most likely causative organism?",
    "choices": [
      {
        "id": 1,
        "text": "Haemophilus influenzae"
      },
      {
        "id": 2,
        "text": "Bordetella pertussis"
      },
      {
        "id": 3,
        "text": "Streptococcus pneumoniae"
      },
      {
        "id": 4,
        "text": "Streptococcus pyogenes"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario of an <strong>unimmunized child</strong> with a <strong>violent cough</strong> and <strong>post-tussive vomiting</strong> is suggestive of <strong>pertussis (whooping cough)</strong> which is caused by <strong>Bordetella pertussis.</strong></p>\n<p>The organism Bordetella pertussis is a <strong>gram-negative coccobacillus</strong>. The major virulence factor is the <strong>Pertussis toxin</strong> which acts by ADP ribosylation of the inhibitory G-protein (Gi) and the <strong>Filamentous haemagglutinin (FHA)</strong> is responsible for facilitating the adhesion of Bordetella pertussis to the respiratory epithelium.\u00a0 Following an incubation period of about 2 weeks, the disease clinically presents over<strong> 3 phases</strong> :</p>\n<p><strong>Catarrhal</strong> - lasts for 1-2 weeks and consists of cough, coryza, and nasopharyngeal secretions.<br /><strong>Paroxysmal</strong> - lasts for 2-6 weeks and consists of worsening paroxysms of productive whooping cough. It becomes more frequent and is commonly associated with vomiting at the end of the bout. Whooping cough derives its name from the inspiratory whoop at the end of a coughing bout.\u00a0<br /><strong>Convalescent</strong> - Intensity and frequency of cough decrease over 4 weeks.</p>\n<p>The diagnosis is made on clinical grounds. A specific diagnosis can be made by isolation of the organism from a <strong>nasopharyngeal swab</strong> taken in the first two phases. Bordetella pertussis shows colonies resembling <strong>'bisected pearls'</strong> or<strong> 'mercury drops'</strong> on <strong>Bordet-Gengou medium. \u00a0</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/85a58bccfc0a494f87e891b1e643065fx1279x1680.JPEG"
    ]
  },
  {
    "text": "A 2-year-old boy presented with low-grade fever, biphasic stridor, and a barking cough. The following was noted on X-ray. Which of the following is the most likely causative organism?",
    "choices": [
      {
        "id": 1,
        "text": "Moraxella"
      },
      {
        "id": 2,
        "text": "Parainfluenza"
      },
      {
        "id": 3,
        "text": "Haemophilus influenzae"
      },
      {
        "id": 4,
        "text": "Staphylococcus aureus"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The above clinical scenario is suggestive of <strong>laryngotracheobronchitis </strong>which is caused by <strong>P</strong><strong>arainfluenza</strong>.</p>\n<p>Laryngotracheobronchitis, also known as <strong>croup,</strong>\u00a0is usually seen in children aged <strong>6 months</strong> to<strong> 3 years</strong>. Children with croup present with <strong>a barking cough, biphasic stridor</strong>, and<strong> low-grade fever.\u00a0 </strong>Chest x-ray shows <strong>a steeple sign</strong> due to subglottic narrowing.</p>\n<p>Management:</p>\n<ul>\n<li><strong>Racemic epinephrine</strong> nebulization leads to the improvement of upper airway obstruction.\u00a0</li>\n<li><strong>Dexamethasone</strong>, by the least invasive route (Oral&gt;IV&gt;IM ), is indicated in all the grades of croup.</li>\n<li><strong>Oxygen</strong> should be administered to children who are hypoxemic (SpO2 &lt;92 %)</li>\n</ul>\n<p><strong>Antibiotics </strong>are usually <strong>not indicated</strong> in laryngotracheobronchitis.</p>\n<p>Other options:</p>\n<p>Option A:\u00a0<em><strong>Moraxella\u00a0</strong></em>causes <strong>acute</strong> <strong>otitis media.</strong> Children present with otalgia, fever, crying, and irritability.</p>\n<p>Option B:\u00a0<em><strong>Haemophilus influenza\u00a0</strong></em>causes acute <strong>epiglottitis.</strong> Children present with an acute sore throat, high fever, muffled voice, <strong>inspiratory stridor,</strong> marked dysphagia, and drooling.</p>\n<p>Option D:\u00a0<em><strong>Staphylococcus aureus\u00a0</strong></em>causes <strong>tracheitis.</strong> Children present with a history of croup, brassy cough, and expiratory or biphasic stridor. X-ray neck shows an irregular tracheal wall.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/63f114d0f902427084deeec3746f8c81.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 6-year-old child is brought with a history of cough for two months that has not responded to any kind of treatment and relevant investigations have all returned normal. The mother says that the child coughs loudly and abruptly but with no change in facial appearance or any other associated symptoms, and he does not cough when he is watching TV or sleeping. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Common cold"
      },
      {
        "id": 2,
        "text": "Retained foreign body"
      },
      {
        "id": 3,
        "text": "Tic cough"
      },
      {
        "id": 4,
        "text": "Adenoid hypertrophy"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The clinical scenario of <strong>chronic cough</strong> in a child, which is <strong>refractory to treatment</strong>, with <strong>no associated symptoms </strong>and <strong>not occurring when the child is asleep or distracted</strong> is suggestive of<strong> tic cough.</strong></p>\n<p><strong>Tic cough</strong>, also known as <strong>somatic cough disorder, habit cough</strong> or <strong>psychogenic cough</strong>, is a <strong>behavioural</strong> abnormality in the paediatric population that is not associated with any pathology of the respiratory system. The child may begin coughing due to a URTI but continues to do so as a habit even after the infection has subsided. It is characterised by <strong>intense loud, abrupt coughing</strong> that<strong> does not match the child's affect</strong>. The cough is generally <strong>absent during sleep </strong>or<strong> periods of distraction</strong>. The frequency of the cough may cause the child to miss school and may lead to several medical investigations.</p>\n<p><strong>Behavioural and speech therapy</strong> are indicated for the management and the parents are to be reassured that there is no underlying pathology of concern and that the child may resume all normal activities.</p>\n<p>Other options:</p>\n<p>Option A:<strong> Common cold</strong> due to a viral infection is likely to be associated with symptoms such as <strong>sneezing, rhinorrhea</strong> and possibly systemic signs like <strong>fever </strong>and <strong>malaise</strong>.</p>\n<p>Option B: Cough due to a <strong>foreign body</strong> is likely to be <strong>acute </strong>rather than chronic, and the presence of a foreign body is likely to be ruled out with preliminary investigations in a child. In this case, all investigations returned normal.</p>\n<p>Option D: Cough due to <strong>adenoid hypertrophy</strong> is likely to be associated with <strong>grunting</strong> and <strong>exacerbation during sleep</strong>, along with other typical symptoms like <strong>adenoid facies</strong> and <strong>voice change</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 60 year old male patient presents with complaints of cough and breathlessness since 2 weeks. History of which of the following would be most helpful in considering a cardiac pathology?",
    "choices": [
      {
        "id": 1,
        "text": "Wheezing"
      },
      {
        "id": 2,
        "text": "Paroxysmal Nocturnal Dyspnea"
      },
      {
        "id": 3,
        "text": "Expectoration"
      },
      {
        "id": 4,
        "text": "Cyanosis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Paroxysmal Nocturnal Dyspnea (PND)</strong> in a patient with complaints of cough and breathlessness is highly suggestive of underlying cardiac pathology, specifically<strong> congestive cardiac failure.</strong></p>\n<p>In a patient with congestive cardiac failure,<strong> left ventricular dysfunction</strong> causes a build-up of back pressures in the pulmonary vasculature leading to <strong>pulmonary congestion</strong>. When a <strong>patient lies down</strong>, the <strong>venous</strong> <strong>return increases</strong> which worsens the pulmonary congestion. This leads to <strong>orthopnea</strong>, ie, <strong>exacerbation of dyspnea on lying down</strong>, and PND, where a<strong> patient becomes breathlessness a few hours after going to sleep</strong> and wakes up and hangs their legs down by the side of the bed or stands up and walks to the window for relief of symptoms. PND is unlikely to be associated with a pulmonary pathology alone in the absence of a cardiac pathology.</p>\n<p>Patients with congestive cardiac failure with pulmonary edema may also have <strong>wheezing </strong>and <strong>expectoration</strong> (options A and C) but these symptoms in the absence of PND may point towards several <strong>respiratory</strong> causes such as asthma, COPD, interstitial lung disease etc and is <strong>not specific to cardiac disease</strong>. <strong>Cyanosis </strong>(option D) refers to the <strong>bluish discolouration </strong>of the <strong>skin or mucous membranes</strong> which occurs in<strong> hypoxic</strong> conditions when the <strong>deoxyhaemoglobin concentration exceeds 5g/dL</strong>. It may also been seen in either <strong>pulmonary or cardiac</strong> disease.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In which of the following conditions would a patient be least likely to complain of a cough?",
    "choices": [
      {
        "id": 1,
        "text": "GERD"
      },
      {
        "id": 2,
        "text": "Cardiac failure"
      },
      {
        "id": 3,
        "text": "Vocal nodules"
      },
      {
        "id": 4,
        "text": "Sinusitis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Patients with <strong>vocal nodules</strong> are unlikely to present with a cough. Patients complain of complain of<strong> hoarseness, vocal fatigue, </strong>and<strong> neck pain</strong> during prolonged talking.</p>\n<p>Vocal nodules (Singer's or Screamer's nodes) are benign nodules arising from the free edge of the vocal cord at the junction between anterior one-third and posterior two-third of the vocal cord which are mostly symmetrical (bilateral). It most commonly affects teachers, actors, singers, vendors, and talkative school children.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3581adddfd984e86b17bc92a97d0b573x512x380.PNG"
    ]
  },
  {
    "text": "A 14-day-old neonate with bilateral conjunctivitis is found to have pulmonary infiltrates on chest X-ray. Which of the following is likely to be observed in the patient?",
    "choices": [
      {
        "id": 1,
        "text": "Staccato cough"
      },
      {
        "id": 2,
        "text": "Whooping cough"
      },
      {
        "id": 3,
        "text": "Bovine cough"
      },
      {
        "id": 4,
        "text": "Barking cough"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Bilateral conjunctivitis</strong> followed by<strong> pneumonia </strong>in a<strong> neonate</strong> is suggestive of infection with<strong> </strong><strong>Chlamydia</strong><strong> trachomatis.\u00a0</strong>Infantile pneumonia due to C. trachomatis is typically associated with a\u00a0<strong>staccato cough, </strong>which<strong>\u00a0</strong>refers to<strong> paroxysmal cough </strong>associated with an <strong>inspiratory breath between each cough.</strong></p>\n<p><em>Chlamydia trachomatis</em> inclusion conjunctivitis usually manifests\u00a0<strong>1 week</strong> after birth. It is usually a venereal infection derived from the cervix or urethra of the mother during delivery. If left untreated, associated systemic diseases such as chlamydial otitis and pneumonia may develop later.</p>\n<p><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">Other options:</span></p>\n<p>Option B: <strong>Whooping cough\u00a0</strong>is seen in pertussis, caused by Bordetella pertussis. It is characterized by a <strong>continuous bout of coughing at the end of which the child takes a deep breath</strong> which makes a 'whooping' sound.</p>\n<p>Option C: <strong>Bovine cough</strong>\u00a0refers to a hoarse weak cough that is classically described in patients with a <strong>left recurrent laryngeal nerve palsy, </strong>causing vocal cord palsy resulting in an<strong> incomplete closure of the glottis.\u00a0</strong></p>\n<p>Option D:\u00a0<strong>Barking cough,\u00a0</strong>likened to the sound of a <strong>seal's bark</strong> is typically associated with<strong> croup (laryngotracheobronchitis</strong>) and <strong>epiglotittis.\u00a0</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is unlikely to be associated with an impaired cough response?",
    "choices": [
      {
        "id": 1,
        "text": "Chronic bronchitis"
      },
      {
        "id": 2,
        "text": "Tracheostomy"
      },
      {
        "id": 3,
        "text": "Kyphoscoliosis"
      },
      {
        "id": 4,
        "text": "Abdominal pain"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Chronic bronchitis </strong>is characterized by <strong>chronic cough with expectoration</strong> and is unlikely to be associated with an impaired cough.</p>\n<p>Chronic bronchitis is a form of COPD, characterized by hyperplasia and hypersecretion of the mucous glands, due to insult by tobacco smoke or air pollutants, mostly in the bronchus and presents with <strong>persistent cough and sputum production</strong> for <strong>3 months</strong>, in <strong>at least 2 consecutive years</strong>, without any other identifiable cause.</p>\n<p><strong>Cough </strong>is not always pathological and performs an important <strong>protective function</strong> in <strong>preventing the entry of irritants</strong> and <strong>clearing the airways of collections</strong>.<strong> Impaired cough</strong> may be a <strong>predisposing factor</strong> for the development of respiratory diseases such as <strong>infections </strong>and <strong>collapse</strong> due to the<strong> retention </strong>of airway secretions or aspirated material. Impaired cough is most commonly associated with <strong>weakness of the respiratory or abdominal muscles</strong>, which leads to the inability to generate adequate velocity to clear airway collections. Other causes of impaired cough include:</p>\n<ul>\n<li>Chest or abdominal pain (eg. post-operative)</li>\n<li>Chest wall deformities (eg. kyphoscoliosis)</li>\n<li>Respiratory depression (eg. due to anesthesia/drugs/neurological disease)</li>\n<li>Abnormal airway secretions (eg. cystic fibrosis)</li>\n<li>Structural airway disease (eg. tracheomalacia, tracheal stenosis)</li>\n<li>Ciliary dysfunction (eg. ciliary dysfunction)</li>\n<li>Bronchiectasis</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following conditions is not associated with a cough impulse?",
    "choices": [
      {
        "id": 1,
        "text": "Saphena varix"
      },
      {
        "id": 2,
        "text": "Empyema necessitans"
      },
      {
        "id": 3,
        "text": "Primary hydrocele"
      },
      {
        "id": 4,
        "text": "Meningocoele"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Cough impulse is not seen in <strong>primary hydrocele.</strong></p>\n<p>Cough impulse refers to the impulse felt on palpation of a swelling, either as a<strong> thrill</strong>, as seen in (varicocele, lymph varix) or an <strong>expansile impulse</strong> where the swelling increases in size when a patient is asked to cough, which is otherwise not normally felt. Cough impulse is a positive clinical finding in <strong>swellings</strong> that are<strong> in continuity with the abdominal (eg - inguinal hernia), pleural (eg - empyema necessitans), or cranial cavities</strong> and <strong>spinal canal (eg - meningocele)</strong> as coughing increases the pressure in that compartment which is represented by the impulse.\u00a0</p>\n<p><strong>Hydrocoele</strong> is an <strong>accumulation of fluid</strong> within the<strong> tunica vaginalis</strong>. In the case of a <strong>primary hydrocoele</strong>, as the fluid is collected within a <strong>closed sac</strong>, a <strong>cough impulse is unlikely</strong> to be seen. However, in the case of a <strong>congenital hydrocoele </strong>due to the presence of a <strong>patent processus vaginalis, </strong>a<strong> cough impulse may be positive </strong>as a thrill. Important positive clinical findings in a hydrocoele are that they are<strong> irreducible,\u00a0</strong> the<strong> testes cannot be palpated separately, </strong>ability to<strong> get above the swelling,</strong>\u00a0and <strong>transillumination </strong>of the swelling.</p>\n<p>Other options:</p>\n<p>Option A:<strong> Saphena varix </strong>refers to the saccular enlargement of the termination of the long saphenous vein at the <strong>saphenous opening</strong>. A <strong>cough impulse </strong>is felt in a saphena varix is called a <strong>positive Morrissey's test</strong> and indicates <strong>sapheno-femoral incompetence.</strong></p>\n<p>Option B: <strong>Empyema necessitans</strong> is a known complication of empyema wherein undrained pus in the pleural cavity incites an inflammatory response that leads to <strong>sinus formation</strong> causing the pus to track from the <strong>pleural cavity to the chest wall</strong>, leading to findings of boggy chest wall that may have a swelling with cough impulse, and intercostal tenderness.</p>\n<p>Option D:<strong> Meningocele</strong> is a <strong>neural tube defect</strong> presenting as a <strong>sacral swelling</strong> that may be associated with a tuft of hair. Increased intra-abdominal pressure from coughing is transmitted to the CSF leading to a <strong>cough impulse</strong> as the swelling is in <strong>communication</strong>\u00a0with the<strong> sub-arachnoid space.</strong>\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Cough on scratching the external acoustic canal is due to?",
    "choices": [
      {
        "id": 1,
        "text": "Auriculotemporal nerve"
      },
      {
        "id": 2,
        "text": "Auricular branch of vagus"
      },
      {
        "id": 3,
        "text": "Great auricular nerve"
      },
      {
        "id": 4,
        "text": "Facial nerve"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Cough</strong> on scratching the <strong>external acoustic canal</strong> is due to the\u00a0<strong>auricular branch of the vagus </strong>nerve (<strong>Arnold's</strong>\u00a0nerve).</p>\n<p><strong>Arnold's nerve</strong> supplies the<strong> concha</strong> and corresponding <strong>eminence on the medial surface</strong>. It also supplies the<strong> posterior wall</strong> and <strong>floor of the external auditory canal</strong>. Scratching or mechanical stimulation of the ear leads to activation of Arnold's nerve, which evokes <strong>reflex cough\u00a0</strong>(ear-cough reflex/otorespiratory reflex).\u00a0\u00a0</p>\n<table style=\"height: 472px; width: 477px;\" width=\"703\">\n<tbody>\n<tr style=\"height: 24px;\">\n<td style=\"width: 149.409px; height: 24px;\"><strong>Causes</strong> <strong>of</strong> <strong>referred otalgia</strong></td>\n<td style=\"width: 151.526px; height: 24px;\"><strong>Nerve</strong> <strong>responsible</strong></td>\n<td style=\"width: 133.675px; height: 24px;\"><strong>Site</strong></td>\n</tr>\n<tr style=\"height: 95px;\">\n<td style=\"width: 149.409px; height: 95px;\">Temporomandibular joint and dental conditions, parotid infections/tumor, and anterior 2/3rd of tongue</td>\n<td style=\"width: 151.526px; height: 95px;\">Auriculotemporal nerve</td>\n<td style=\"width: 133.675px; height: 95px;\">Tragal area, crus of the helix, and\u00a0anterior wall and roof of the external auditory canal.\u00a0</td>\n</tr>\n<tr style=\"height: 95px;\">\n<td style=\"width: 149.409px; height: 95px;\">Acute tonsillitis, peritonsillar abscess, carcinoma base of the tongue or tonsils (oropharynx)</td>\n<td style=\"width: 151.526px; height: 95px;\">The glossopharyngeal nerve (Jacobson's)</td>\n<td style=\"width: 133.675px; height: 95px;\">Medial surface of the tympanic membrane, and middle ear</td>\n</tr>\n<tr style=\"height: 71px;\">\n<td style=\"width: 149.409px; height: 71px;\">Carcinoma of the larynx (cough), hypopharynx, epiglottis, vallecula, esophagus, and thyroid</td>\n<td style=\"width: 151.526px; height: 71px;\">Auricular branch of the vagus nerve (Arnold's/Alderman's nerve)</td>\n<td style=\"width: 133.675px; height: 71px;\">Concha,\u00a0posterior wall, and floor of the external auditory canal</td>\n</tr>\n<tr style=\"height: 48px;\">\n<td style=\"width: 149.409px; height: 48px;\">Cervical spondylitis</td>\n<td style=\"width: 151.526px; height: 48px;\">Great auricular nerve (C2,3)</td>\n<td style=\"width: 133.675px; height: 48px;\">Lateral and medial surfaces of the pinna</td>\n</tr>\n<tr style=\"height: 71px;\">\n<td style=\"width: 149.409px; height: 71px;\">Acoustic neuroma</td>\n<td style=\"width: 151.526px; height: 71px;\">Facial nerve (nervus intermedius/nerve of Wrisberg)</td>\n<td style=\"width: 133.675px; height: 71px;\">\n<p>Concha, retro auricular groove, and posterosuperior part of the external auditory meatus.\u00a0Numbness in the posterosuperior meatal wall known as\u00a0Hitzelberger's sign, is seen in acoustic neuroma.</p>\n</td>\n</tr>\n</tbody>\n</table>\n<p>The image below shows the nerve supply of the pinna:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/cdc3ef9edea04e24a9778eb42ae26388x1279x1392.JPEG"
    ]
  }
];
        let quizName = 'Cough Mini Test - -Tmt';
        const quizFilename = 'cough-mini-test-tmt-eb0833df.html';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2023-24"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>