<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>06 Analytical Epidemiology - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Community Medicine
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">33</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "You are conducting a cohort study in a group of headload workers to identify the risk factors for developing low back pain in future. This type of study falls under which of the following?",
    "choices": [
      {
        "id": 1,
        "text": "Experimental analytical studies"
      },
      {
        "id": 2,
        "text": "Quasi-experimental analytical studies"
      },
      {
        "id": 3,
        "text": "Non-experimental analytical studies"
      },
      {
        "id": 4,
        "text": "Interventional analytical studies"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Cohort studies fall under <strong>non-experimental</strong> (<strong>observational</strong>) <strong>analytical</strong> studies.</p>\n<p><strong>Classification</strong> of epidemiological studies:</p>\n<ol>\n<li><strong>Observational </strong>studies: allow nature to take its own course, the investigator measures but does not intervene. It is further classified into:\n<ul>\n<li><strong>Descriptive</strong> studies: limited to describing the occurrence of a disease in a population.</li>\n<li><strong>Analytical</strong> studies: go further by analyzing the relationship between health status and other variables. It includes:\n<ul>\n<li>Ecological studies</li>\n<li>Cross-sectional studies</li>\n<li>Case-control studies</li>\n<li><strong>Cohort</strong> studies</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><strong>Experimental </strong>studies or <strong>interventional</strong> studies: it involves an active attempt to change a disease determinant or the progress of a disease, and is similar in design to experiments in other sciences.\n<ul>\n<li>Randomized controlled trials</li>\n<li>Field trials</li>\n<li>Community trials</li>\n</ul>\n</li>\n</ol>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the unit of observation in ecological studies?",
    "choices": [
      {
        "id": 1,
        "text": "Population"
      },
      {
        "id": 2,
        "text": "Patient"
      },
      {
        "id": 3,
        "text": "Healthy inividuals"
      },
      {
        "id": 4,
        "text": "Case"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>In ecological studies, the unit of observation is the <strong>population</strong> or community.</p>\n<table style=\"height: 144px;\" width=\"459\">\n<tbody>\n<tr>\n<td style=\"width: 223.516px;\">Type of study</td>\n<td style=\"width: 223.516px;\">Unit</td>\n</tr>\n<tr>\n<td style=\"width: 223.516px;\">Ecological/ Correlational</td>\n<td style=\"width: 223.516px;\">Population</td>\n</tr>\n<tr>\n<td style=\"width: 223.516px;\">Cross-sectional/ Prevalence</td>\n<td style=\"width: 223.516px;\">Individual</td>\n</tr>\n<tr>\n<td style=\"width: 223.516px;\">Case-control/ Case reference</td>\n<td style=\"width: 223.516px;\">Individual</td>\n</tr>\n<tr>\n<td style=\"width: 223.516px;\">Cohort/ Follow up</td>\n<td style=\"width: 223.516px;\">Individual</td>\n</tr>\n<tr>\n<td style=\"width: 223.516px;\">Randomised Controlled Trials</td>\n<td style=\"width: 223.516px;\">Patients</td>\n</tr>\n<tr>\n<td style=\"width: 223.516px;\">Field Trial</td>\n<td style=\"width: 223.516px;\">Healthy people</td>\n</tr>\n<tr>\n<td style=\"width: 223.516px;\">Community trial</td>\n<td style=\"width: 223.516px;\">Community</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Identify the type of study from the following design:",
    "choices": [
      {
        "id": 1,
        "text": "Prospective cohort study"
      },
      {
        "id": 2,
        "text": "Retrospective cohort study"
      },
      {
        "id": 3,
        "text": "Case\u2013control study"
      },
      {
        "id": 4,
        "text": "Follow-up study"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The design given is of a <strong>case-control study</strong>.&nbsp;It proceeds from <strong>effect to cause</strong> and is done after the exposure and outcome have occurred.</p>\n<p>It tries to<strong> determine </strong>the possible<strong> exposure </strong>factors after a <strong>known disease</strong> incidence. This is the first approach to test <strong>causal hypotheses</strong> and uses controls to support or refute an inference.</p>\n<div class=\"page\" title=\"Page 92\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Retrospective </strong>or&nbsp;<strong>historical</strong>&nbsp;<strong>cohort</strong> study, on the other hand, tries to compare the risk of developing a disease to some already <strong>known exposure</strong> factors. Ex: risk of lung cancer in uranium miners, risk of angiosarcoma in persons exposed to polyvinyl chloride etc.</p>\n<p>Retrospective cohort studies are&nbsp;<strong>more economical</strong> and <strong>quicker</strong> than prospective cohort studies.</p>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ee817b9e79fc41a5be92abbc04d5bbc8.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A study was conducted among a group of 500 patients with lung cancer and another group of 300 people chosen from the general population. Both the groups were questioned about their exposure to smoking. What kind of study is this?",
    "choices": [
      {
        "id": 1,
        "text": "Cohort study"
      },
      {
        "id": 2,
        "text": "Cross-sectional study"
      },
      {
        "id": 3,
        "text": "Correlational study"
      },
      {
        "id": 4,
        "text": "Case-control study"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>This is a <strong>case-control</strong> study. In this scenario, <strong>500 patients</strong>&nbsp;constitute the <strong>cases</strong> and <strong>300 people</strong>&nbsp;from the general population constitute the <strong>controls</strong>.&nbsp;The study is done from <strong>effect </strong>(lung cancer) <strong>to cause </strong>(smoking).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A case-control study was conducted to evaluate the association between lifestyle risk factors and the prevalence of dyslipidemia. Which of the following is not an advantage of this type of study?",
    "choices": [
      {
        "id": 1,
        "text": "Incidence can be calculated"
      },
      {
        "id": 2,
        "text": "No risk to subjects"
      },
      {
        "id": 3,
        "text": "Easy to carry out"
      },
      {
        "id": 4,
        "text": "Suitable for rare diseases"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Incidence cannot be calculated from case-control studies. <strong>Incidence</strong> can be calculated from<strong>&nbsp;cohort </strong>studies, also known as <strong>longitudinal</strong> studies.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A case-control study was conducted to see if symptoms of upper gastrointestinal dysfunction occurred more frequently in patients with Duchenne muscular dystrophy. Which of the following cannot be used as controls in this study?",
    "choices": [
      {
        "id": 1,
        "text": "Hospital patients"
      },
      {
        "id": 2,
        "text": "Siblings"
      },
      {
        "id": 3,
        "text": "General public"
      },
      {
        "id": 4,
        "text": "Healthcare workers"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Siblings</strong> cannot be used as controls while studying&nbsp;<strong>genetic conditions</strong>&nbsp;because the outcome would be&nbsp;<strong>distorted&nbsp;due to</strong> their <strong>similarities</strong>.</p>\n<p><strong>Controls</strong> in a case-control study:</p>\n<ul>\n<li>Usually disease-free</li>\n<li>Can be up to <strong>4 times&nbsp;</strong>the number <strong>of cases</strong> in <strong>small</strong> studies</li>\n<li>In <strong>large</strong> studies, a <strong>1:1</strong> ratio of cases and controls can be sought</li>\n<li>Sources: general population, hospitals, relatives (spouses and siblings), neighbors, or colleagues</li>\n<li>Although, siblings cannot be used as controls for studies on genetic conditions</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not a cause of bias in a case-control study?",
    "choices": [
      {
        "id": 1,
        "text": "Recall bias"
      },
      {
        "id": 2,
        "text": "Confounding bias"
      },
      {
        "id": 3,
        "text": "Hawthorne bias"
      },
      {
        "id": 4,
        "text": "Selection bias"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Hawthorne bias</strong> is not seen in case-control studies. This bias occurs when the subjects change their attitude/ actions while under observation. This distorts the results of the&nbsp;<strong>cohort</strong> or <strong>experimental studies.</strong></p>\n<p>The <strong>bias</strong> that are seen in the <strong>case-control study</strong> are:</p>\n<ol>\n<li>Confounding</li>\n<li>Recall bias</li>\n<li>Selection bias</li>\n<li>Berkesonian bias</li>\n<li>Interviewer's bias</li>\n</ol>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not true about random errors?",
    "choices": [
      {
        "id": 1,
        "text": "Sampling errors are random errors"
      },
      {
        "id": 2,
        "text": "It cannot be completely eliminated"
      },
      {
        "id": 3,
        "text": "It can cause bias"
      },
      {
        "id": 4,
        "text": "Systematic errors are different from random errors"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Random errors are not causes of bias.&nbsp;</p>\n<p><strong>Random error</strong> arises when a value of the sample measurement diverges, due to <strong>chance</strong> alone, from that of the true population value. They can never be completely eliminated.&nbsp;</p>\n<p>Sources of random errors are individual biological variations, sampling errors, and measurement errors.</p>\n<p><strong>Systematic errors</strong> are also called <strong>biases.&nbsp;</strong>They are different from random errors.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following factors in a study will cause Berkesonian bias?",
    "choices": [
      {
        "id": 1,
        "text": "Interviewer asking leading questions to the subjects"
      },
      {
        "id": 2,
        "text": "Different rates of hospital admission of different diseases"
      },
      {
        "id": 3,
        "text": "Researcher's belief in the treatment changing the outcome of the study"
      },
      {
        "id": 4,
        "text": "Cases that are lost to follow-up"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Berkesonian</strong> bias occurs due to the different rates of <strong>hospital</strong> admission of people with different diseases. It is a type of <strong>selection bias&nbsp;</strong>termed after <strong> Joseph Berkeson</strong> who described it.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An epidemiologist plans to conduct a prospective study instead of a retrospective study. Which of the following disadvantages does he aim to eliminate by conducting this study?",
    "choices": [
      {
        "id": 1,
        "text": "Recall bias"
      },
      {
        "id": 2,
        "text": "Selection bias"
      },
      {
        "id": 3,
        "text": "Confounding bias"
      },
      {
        "id": 4,
        "text": "Berksonian bias"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Recall bias</strong>&nbsp;can be eliminated in a prospective study.</p>\n<p>Recall bias is also called <strong>memory bias.</strong>&nbsp;It is widely seen in <strong>retrospective&nbsp;</strong>(case-control)<strong>&nbsp;</strong>studies as extensive history is taken from the participants.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A study conducted in a group revealed that consumption of alcohol increases the risk of esophageal cancer, but it may be actually due to cigarette smoking. This happens due to:",
    "choices": [
      {
        "id": 1,
        "text": "Confounding factor"
      },
      {
        "id": 2,
        "text": "Misclassification bias"
      },
      {
        "id": 3,
        "text": "Ecological fallacy"
      },
      {
        "id": 4,
        "text": "Effect modifier"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>In this scenario, cigarette smoking is related to both the outcome of esophageal cancer and consumption of alcohol. Thus, this is an example of a&nbsp;<strong>confounding factor</strong>.</p>\n<p>A confounding factor is defined as one which is <strong>associated</strong> with <strong>both exposure and outcome</strong> and is <strong>distributed unequally</strong> in study and control groups.&nbsp;In this study to determine the role of alcohol in the etiology of esophageal cancer, <strong>smoking</strong> is considered as a <strong>confounding</strong> <strong>factor</strong> because:</p>\n<ul>\n<li>It is associated with the consumption of alcohol (<strong>exposure</strong>).</li>\n<li>It is an independent risk factor for oesophageal cancer (<strong>outcome</strong>).</li>\n</ul>\n<p>In these conditions, the effects of alcohol consumption can be determined only if the influence of smoking is neutralized by <strong>matching</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is false regarding confounding factor?",
    "choices": [
      {
        "id": 1,
        "text": "It can be reduced by matching"
      },
      {
        "id": 2,
        "text": "It is associated individually with both cause and effect"
      },
      {
        "id": 3,
        "text": "It is distributed equally in both study and control groups"
      },
      {
        "id": 4,
        "text": "It is associated with the exposure of the study"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>A<strong> confounding factor</strong> is a factor that is <strong>associated </strong>with both<strong> exposure and diseases</strong> and is distributed <strong>unequally</strong> in study and control groups.&nbsp;It can be reduced by <strong>matching</strong>.</p>\n<p>For example, if the study is that a sedentary lifestyle can lead to coronary artery diseases, then <strong>age</strong> can act as a <strong>confounding</strong> <strong>factor</strong> as it is individually linked to both sedentary lifestyle and coronary artery diseases.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A researcher is planning to conduct a study to investigate the relationship between oral contraceptives and breast cancer. He wants to remove age as a confounding factor. Which of the following methods will not help him reduce this bias?",
    "choices": [
      {
        "id": 1,
        "text": "Stratification"
      },
      {
        "id": 2,
        "text": "Randomization"
      },
      {
        "id": 3,
        "text": "Deletion"
      },
      {
        "id": 4,
        "text": "Regression analysis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Deletion is not a method to reduce confounding.</p>\n<p><strong>Methods</strong> to <strong>reduce confounding</strong> are:</p>\n<ul>\n<li>At the time of <strong>designing</strong> the study:\n<ul>\n<li>Randomization</li>\n<li>Matching</li>\n<li>Restriction</li>\n</ul>\n</li>\n<li>At the time of <strong>analysis:</strong>\n<ul>\n<li>Stratification</li>\n<li>Statistical modelings like <strong>regression </strong>analysis,<strong> multivariate </strong>analysis, and the<strong> Cochran-Mantel-Haenszel </strong>method.</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Matching is done for which of the following?",
    "choices": [
      {
        "id": 1,
        "text": "Known confounding"
      },
      {
        "id": 2,
        "text": "Unknown confounding"
      },
      {
        "id": 3,
        "text": "Known and unknown confounding"
      },
      {
        "id": 4,
        "text": "Sampling errors"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Matching</strong> helps <strong>only</strong> in removing the <strong>known</strong> confounding factors.</p>\n<p>Matching is the process by which <strong>controls are selected</strong> in a way that they are <strong>similar to cases</strong> in certain <strong>pertinent variables</strong> (e.g., age) that are known to influence the outcome of the disease. If not adequately matched for comparability, these variables could confound the results.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which among the following is not a type of matching?",
    "choices": [
      {
        "id": 1,
        "text": "Frequency matching"
      },
      {
        "id": 2,
        "text": "Collective matching"
      },
      {
        "id": 3,
        "text": "Group matching"
      },
      {
        "id": 4,
        "text": "Matching by pairs"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>There is no type of matching called collective matching.&nbsp;</p>\n<p><strong>Types </strong>of matching:</p>\n<ul>\n<li><strong>Group</strong> matching: It is also called <strong>frequency </strong>matching. It is done when a <strong>large</strong> stratum is used for study and a 1:1 ratio of cases and controls can be achieved.</li>\n<li><strong>Individual </strong>matching:&nbsp;It is&nbsp;also called&nbsp;<strong>matching by pairs.</strong>&nbsp;It can be done when the study is <strong>small</strong> and more controls can be selected for one case.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An epidemiologist determines to evaluate the strength of association between asbestos exposure and mesothelioma in a case-control study. Which of the following variables would he use for it?",
    "choices": [
      {
        "id": 1,
        "text": "Absolute risk ratio"
      },
      {
        "id": 2,
        "text": "Relative risk"
      },
      {
        "id": 3,
        "text": "Attributable risk"
      },
      {
        "id": 4,
        "text": "Odds ratio"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Odds ratio&nbsp;</strong>(OR), also known as <strong>cross-product ratio</strong>, is used to measure the <strong>strength of association</strong> between <strong>risk factor</strong> (asbestos exposure) and <strong>outcome</strong> (mesothelioma) in <strong>case-control </strong>studies.</p>\n<p>A case-control study yields only odds ratio and not incidence or relative risk.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is false about the odds ratio?",
    "choices": [
      {
        "id": 1,
        "text": "OR = 1 indicates positive association"
      },
      {
        "id": 2,
        "text": "It is obtained from case-control studies"
      },
      {
        "id": 3,
        "text": "OR < 1 indicates posible protection"
      },
      {
        "id": 4,
        "text": "It is a measure of strength of association"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>An odds ratio (<strong>OR</strong>) of <strong>1</strong> indicates that there is <strong>no association</strong> or that the event is likely in both the groups.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A case-control study was done among 500 lung cancer patients and 400 controls. The study groups had 400 and 50 smokers respectively. Calculate the odds ratio.",
    "choices": [
      {
        "id": 1,
        "text": "2.8"
      },
      {
        "id": 2,
        "text": "0.28"
      },
      {
        "id": 3,
        "text": "0.20"
      },
      {
        "id": 4,
        "text": "28"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>In the given scenario, the odds ratio (<strong>OR</strong>) is <strong>28</strong>.</p>\n<p>The given data is represented as:&nbsp;</p>\n<table>\n<tbody>\n<tr>\n<td width=\"94\">&nbsp;</td>\n<td width=\"92\">\n<p><strong>Disease +</strong></p>\n</td>\n<td width=\"78\">\n<p><strong>Disease&nbsp; -</strong></p>\n</td>\n</tr>\n<tr>\n<td width=\"94\">\n<p><strong>Exposure +</strong></p>\n</td>\n<td width=\"92\">\n<p>400 (a)</p>\n</td>\n<td width=\"78\">\n<p>50 (b)</p>\n</td>\n</tr>\n<tr>\n<td width=\"94\">\n<p><strong>Exposure - </strong></p>\n</td>\n<td width=\"92\">\n<p>100 (c)</p>\n</td>\n<td width=\"78\">\n<p>350 (d)</p>\n</td>\n</tr>\n</tbody>\n</table>\n<p><strong>Odds Ratio</strong> = ad/bc</p>\n<p>= (400 x 350) / (50 x 100)</p>\n<p>= (4 x 35)/5</p>\n<p>= 4 x 7</p>\n<p>= <strong>28</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A research scholar is preparing to do a prospective cohort study in a hospital to evaluate the association of H. pylori with inflammatory bowel disease. Which of the following measures must she take, before starting the study?",
    "choices": [
      {
        "id": 1,
        "text": "Enrol all patients taking proton pump inhibitors"
      },
      {
        "id": 2,
        "text": "Enrol all patients on whom endoscopy was done"
      },
      {
        "id": 3,
        "text": "Exclude all patients diagnosed with inflammatory bowel disease"
      },
      {
        "id": 4,
        "text": "Exclude all patients with positive urea breath test for H. pylori"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>All patients</strong> diagnosed with inflammatory bowel disease (<strong>IBD</strong>) must be<strong> excluded</strong> from a prospective cohort study, as the study progresses from <strong>cause to effect</strong>.&nbsp;The study begins before the disease under study has occurred.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not true about cohort study?",
    "choices": [
      {
        "id": 1,
        "text": "Incidence can be calculated"
      },
      {
        "id": 2,
        "text": "It is always a prospective study design"
      },
      {
        "id": 3,
        "text": "Attrition is very common"
      },
      {
        "id": 4,
        "text": "Outcome is not present at the start of study"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Although cohort studies are called prospective studies, there are subtypes of cohort studies that do not follow the prospective study design like <strong>historical (retrospective) cohort</strong> studies.</p>\n<p><strong>Framingham Heart Study </strong>is one of the most famous long-term cardiovascular prospective cohort studies.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Hawthorne effect is seen in which of the following studies?",
    "choices": [
      {
        "id": 1,
        "text": "Case-control studies"
      },
      {
        "id": 2,
        "text": "Retrospective studies"
      },
      {
        "id": 3,
        "text": "Cohort studies"
      },
      {
        "id": 4,
        "text": "Cross-sectional studies"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Hawthorne effect</strong> is seen in <strong>cohort</strong> studies. It refers to the phenomenon when study subjects <strong>change or alter </strong>their<strong> behaviour</strong> during the course of the study, which results in different outcomes and <strong>underestimation of risks</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the ratio of the incidence of the disease in the exposed to that of the non-exposed?",
    "choices": [
      {
        "id": 1,
        "text": "Attributable risk"
      },
      {
        "id": 2,
        "text": "Odds ratio"
      },
      {
        "id": 3,
        "text": "Relative risk"
      },
      {
        "id": 4,
        "text": "Population attributable risk"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The ratio of incidence of disease or death among exposed to that among the non-exposed is called\u00a0<strong>relative risk </strong>(<strong>RR</strong>).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Calculate the risk ratio when the incidence of the disease in exposed is 30 and that in non-exposed is 5.",
    "choices": [
      {
        "id": 1,
        "text": "6"
      },
      {
        "id": 2,
        "text": "5"
      },
      {
        "id": 3,
        "text": "0.6"
      },
      {
        "id": 4,
        "text": "0.5"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>In the given scenario,&nbsp;<strong>risk ratio</strong> or <strong>relative risk</strong>&nbsp;(RR) is <strong>6</strong>.</p>\n<p>Here, the incidence of disease in the exposed is 30 and that in the non-exposed is 5.<br />Thus, <strong>RR</strong> = 30/5 = <strong>6</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A cohort study was conducted among 10,000 smokers and 10,000 non-smokers. They were followed up over a period of 20 years. It was found that 100 of the smokers and 10 of the non-smokers developed oral squamous cell carcinoma. Calculate the relative risk.",
    "choices": [
      {
        "id": 1,
        "text": "0.1"
      },
      {
        "id": 2,
        "text": "0.001"
      },
      {
        "id": 3,
        "text": "1"
      },
      {
        "id": 4,
        "text": "10"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The relative risk in the given scenario is <strong>10</strong>.</p>\n<p>Here, the incidence in <strong>exposed </strong>is<strong> 0.01 </strong>(100/10000). Incidence in <strong>non-exposed </strong>is<strong> 0.001 </strong>(10/10000).</p>\n<p><strong>Relative Risk</strong> = Incidence in exposed/ Incidence in non-exposed = 0.01/0.001 =<strong> 10.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "While testing the deleterious health hazards on a group of people after giving a new drug and a placebo, the following results were obtained as tabulated. Based on these results, which of the following is true?",
    "choices": [
      {
        "id": 1,
        "text": "Absolute risk reduction (ARR) is 1% and relative risk reduction (RRR) is 0.1"
      },
      {
        "id": 2,
        "text": "Absolute risk reduction (ARR) is 10% and relative risk reduction (RRR) is 0.9"
      },
      {
        "id": 3,
        "text": "Absolute risk reduction (ARR) is 1% and relative risk reduction (RRR) is 10"
      },
      {
        "id": 4,
        "text": "Absolute risk reduction (ARR) is 10% and relative risk reduction (RRR) is 9"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>In the given scenario, absolute risk reduction (<strong>ARR</strong>) is <strong>1%</strong> and relative risk reduction (<strong>RRR</strong>) is <strong>0.1</strong>.</p>\n<p>Let us reconstruct the design table in the following way:</p>\n<table>\n<tbody>\n<tr>\n<td>&nbsp;</td>\n<td>Health hazard (+)</td>\n<td>Health hazard (-)</td>\n<td>Total</td>\n</tr>\n<tr>\n<td>New drug</td>\n<td>1603 (a)</td>\n<td>13622 (b)</td>\n<td>15225 (a+b)</td>\n</tr>\n<tr>\n<td>Placebo</td>\n<td>1804 (c)</td>\n<td>13421 (d)</td>\n<td>15225 (c+d)</td>\n</tr>\n</tbody>\n</table>\n<p><strong>Relative risk (RR)</strong> is given as <strong>a/(a+b) &divide; c/(c+d)</strong>.</p>\n<p>RR = 1603/15225 &divide; 1804/15225 = 0.106/0.118 = 0.89&nbsp;<strong>&asymp;</strong><strong>&nbsp;0.90</strong>.&nbsp;</p>\n<p><strong>Relative risk reduction (RRR) = 1 &ndash; Relative risk</strong>. In this scenario, RRR = 1 &ndash; 0.9 = <strong>0.1 or 10%.</strong></p>\n<p><strong>Incidence</strong> of a disease is the <strong>absolute risk</strong> of contracting it.</p>\n<p>Absolute risk rate of the group using new drug = a/(a+b) = 1603/15225 = 0.106 or 10.6%&nbsp;&asymp; 11%.</p>\n<p>Absolute risk rate of the group using placebo = c/(c+d) = 1804/15225 = 0.118 or 11.8%&nbsp;&asymp; 12%.</p>\n<p><strong>Absolute risk reduction</strong> (ARR) is the difference in the absolute risk rates between the placebo and the drug. In this scenario, <strong>ARR</strong> = 12% - 11% = <strong>1%</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The difference between the incidence of disease among exposed and incidence among non exposed is given by which of the following variables?",
    "choices": [
      {
        "id": 1,
        "text": "Relative risk"
      },
      {
        "id": 2,
        "text": "Attributable risk"
      },
      {
        "id": 3,
        "text": "Population  Attributable risk"
      },
      {
        "id": 4,
        "text": "Odds Ratio"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>difference</strong> between the incidence of disease among <strong>exposed</strong> and incidence among <strong>non-exposed</strong> is given by <strong>attributable risk.</strong></p>\n<p>Attributable risk is often expressed as a&nbsp;<strong>percentage</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/06baf08128544a79a355dc63df25f195x902x260.JPEG"
    ]
  },
  {
    "text": "A study conducted among smokers shows that 80% of the cases of lung cancer are due to cigarette smoking. Which of the following variables indicates this?",
    "choices": [
      {
        "id": 1,
        "text": "Risk ratio"
      },
      {
        "id": 2,
        "text": "Relative risk"
      },
      {
        "id": 3,
        "text": "Attributable risk"
      },
      {
        "id": 4,
        "text": "Population attributable risk"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Attributable risk</strong> indicates to what extent the disease under study can be attributed to the exposure.&nbsp;Here, cigarette smoking is attributed to be the cause of 80% of lung cancers in smokers.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A study found that the incidence of bladder carcinoma is 5 times higher in smokers than in non smokers. Calculate the attributable risk.",
    "choices": [
      {
        "id": 1,
        "text": "20%"
      },
      {
        "id": 2,
        "text": "40%"
      },
      {
        "id": 3,
        "text": "60%"
      },
      {
        "id": 4,
        "text": "80%"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Taking the incidence of disease in <strong>non-exposed</strong> as <strong>x</strong>, the incidence of disease in <strong>exposed</strong> would be <strong>5x.</strong>&nbsp;</p>\n<p>Attributable risk (<strong>AR</strong>) would be given as&nbsp;[(5x - x)/5x] x 100 =<strong>&nbsp;80%</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/fba85ace985742a98a0f971856cf91ebx902x260.JPEG"
    ]
  },
  {
    "text": "In a population of 9000 people, 2100 are alcoholics. 70 alcoholics and 23 non-alcoholics developed cirrhosis. What is the attributable risk?",
    "choices": [
      {
        "id": 1,
        "text": "40%"
      },
      {
        "id": 2,
        "text": "60%"
      },
      {
        "id": 3,
        "text": "70%"
      },
      {
        "id": 4,
        "text": "90%"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>In the given scenario, the attributable risk (<strong>AR</strong>) is <strong>90%</strong>.</p>\n<p>Number of people exposed (to alcohol) = 2100\u00a0<br />Number of people not exposed (to alcohol) = 6900\u00a0</p>\n<p>Incidence of cirrhosis among exposed = 70/2100 (I<strong><sub>Exposed</sub></strong>)<br />Incidence of cirrhosis among non-exposed = 23/6900\u00a0(I<strong><sub>Non-exposed</sub></strong>)</p>\n<p>Attributable risk (AR)\u00a0= <strong>[</strong> ( I<strong><sub>Exposed</sub></strong> - I<sub>Non-exposed)</sub>\u00a0<strong>/</strong>\u00a0I<strong><sub>Exposed\u00a0</sub>]</strong>*100<br />= <strong>[</strong> (70/2100 - 23/6900) <strong>/</strong> (70/2100)<strong>]</strong> *100<br />=\u00a0<strong>[\u00a0</strong>9 / 10\u00a0<strong>]\u00a0</strong>*100<br />= <strong>90</strong></p>\n<p>Thus, the attributable risk (AR) is <strong>90%</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is the numerator in the formula for population-attributable risk?",
    "choices": [
      {
        "id": 1,
        "text": "Incidence among exposed minus incidence among non-exposed"
      },
      {
        "id": 2,
        "text": "Incidence among non-exposed minus incidence among exposed"
      },
      {
        "id": 3,
        "text": "Incidence in the total population minus incidence among non-exposed"
      },
      {
        "id": 4,
        "text": "Incidence in the total population minus incidence among exposed"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Population attributable risk is obtained from <strong>cohort studies.</strong> It provides an estimate of the amount by which the disease could be reduced in that population if the suspected factor was eliminated or modified.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c762319a5ac9496db4f4b27febcc7255x1280x904.JPEG"
    ]
  },
  {
    "text": "A study was done in the Indian population to correlate the deaths due to myocardial infarction and dietary practices. What is this type of study known as?",
    "choices": [
      {
        "id": 1,
        "text": "Cohort study"
      },
      {
        "id": 2,
        "text": "Case reference study"
      },
      {
        "id": 3,
        "text": "Ecological study"
      },
      {
        "id": 4,
        "text": "Experimental study"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>This is an example of an <strong>ecological study.</strong>&nbsp;As the study was done in the Indian population, it can be inferred that&nbsp;<strong>population</strong> was taken as the <strong>unit</strong> of the study.</p>\n<p>The study was done to <strong>correlate</strong> the deaths and dietary practices, and hence&nbsp;<strong>ecological </strong>studies are also called<strong>&nbsp;correlational </strong>studies.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which among the following is the weakest study design to prove causation?",
    "choices": [
      {
        "id": 1,
        "text": "Cohort study"
      },
      {
        "id": 2,
        "text": "Case control study"
      },
      {
        "id": 3,
        "text": "Randomized control trials"
      },
      {
        "id": 4,
        "text": "Ecological study"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Ecological</strong> studies take a <strong>population</strong> as a unit. They&nbsp;provide the <strong>weakest </strong>evidence for<strong> causality</strong> because of extrapolation to individuals from regional data.</p>\n<p>Randomized control trials (<strong>RCTs</strong>) provide the <strong>strongest</strong> design amongst the options given. Case-control and cohort studies have <strong>moderate</strong> ability to provide evidence for causality.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/94f6f88e8eb740cf884aade87de2dc20x1280x1603.JPEG"
    ]
  },
  {
    "text": "What kind of bias is implied by assigning group characteristics to people which they may not possess as individuals?",
    "choices": [
      {
        "id": 1,
        "text": "Ecological fallacy"
      },
      {
        "id": 2,
        "text": "Hawthorne effect"
      },
      {
        "id": 3,
        "text": "Berkesonian bias"
      },
      {
        "id": 4,
        "text": "Attrition"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>An <strong>ecological fallacy</strong> results when characteristics of the group are assigned inappropriately to individuals.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '06 Analytical Epidemiology';
        let hierarchy = ["Marrow", "qBank", "Community Medicine"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>