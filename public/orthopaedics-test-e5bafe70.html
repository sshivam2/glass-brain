<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orthopaedics Test - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / FMGE Test Series Subject / 2023
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">19</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A patient presents to the emergency department after he fell on his outstretched hand. An X-ray was performed and is given below. What is the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Colle's fracture"
      },
      {
        "id": 2,
        "text": "Rolando's fracture"
      },
      {
        "id": 3,
        "text": "Galeazzi fracture"
      },
      {
        "id": 4,
        "text": "Montegia fracture"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The&nbsp; X-ray reveals&nbsp;an oblique <strong>fracture in the lower third of the radius</strong> and there is <strong>dislocation of the distal radio-ulnar joint</strong>, which is diagnostic of&nbsp;<strong>Galeazzi fracture-dislocation</strong>.</p>\n<p>The patient with Galeazzi fracture-dislocation presents with pain, swelling and deformity at the lower end of the radius.&nbsp;On clinical examination, the disruption of the radio-ulnar joint can be elicited by pressing the lower end of the ulna. The ulna moves down and comes back like the key of a piano (<strong>piano-key sign</strong>).&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/1b9bd183081b48e4ac4feb8ab4c69f75.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 6-year-old boy presented with the following findings. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Milwaukee shoulder"
      },
      {
        "id": 2,
        "text": "Sprengel deformity"
      },
      {
        "id": 3,
        "text": "Long thoracic nerve injury"
      },
      {
        "id": 4,
        "text": "Klippel-Feil syndrome"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The image shows an&nbsp;<strong>upward elevation of the scapula relative&nbsp;to the thoracic cage</strong> characteristically seen in <strong>Sprengel deformity</strong>.</p>\n<p><strong>Sprengel deformity</strong> is a <strong>congenital&nbsp;upward elevation </strong>of the<strong> scapula</strong>. It is&nbsp;due to the failure of the scapula to descend completely in embryonic life.</p>\n<p>The affected scapula is smaller, shaped differently, abnormally high, and somewhat prominent. Shoulder movements are usually painless. Abduction and elevation of shoulders may be limited due to fixation of the scapula.</p>\n<p>The&nbsp;<strong>Cavendish classification</strong> is used to grade the severity of Sprengel deformity.&nbsp;</p>\n<p>If the deformity is mild, no treatment is required. In severe deformity, surgery may be indicated. These procedures include:</p>\n<ul>\n<li>Green procedure</li>\n<li>Woodward procedure</li>\n<li>Mears procedure</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/4c031edc0772462badbaa3df9e653ce5.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 40-year-old patient presented to the emergency department following a road traffic accident. The radiograph of his pelvis is shown below. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Central dislocation of the hip"
      },
      {
        "id": 2,
        "text": "Fracture shaft of femur"
      },
      {
        "id": 3,
        "text": "Posterior dislocation of the hip"
      },
      {
        "id": 4,
        "text": "Anterior dislocation of the hip"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The likely diagnosis of the condition given in the picture is <strong>posterior dislocation </strong>of left hip joint.</p>\n<p>The radiograph shows the following findings:</p>\n<ul>\n<li>The femoral head is displaced <strong>superiorly</strong> and <strong>laterally</strong></li>\n<li>The left femoral head appears slightly smaller than the right femoral head</li>\n<li>The limb is <strong>adducted</strong> and <strong>internally rotated</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/1c36d82fb0d74935aea1963242f5e8b8.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 30-year-old male patient presents with progressive swelling of his right wrist associated with a dull aching pain. The orthopedician elicits tenderness on firm palpation of the swelling. The following findings are seen on X-ray. What is the likely diagnosis in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Chondrosarcoma"
      },
      {
        "id": 2,
        "text": "Osteosarcoma"
      },
      {
        "id": 3,
        "text": "Osteoclastoma"
      },
      {
        "id": 4,
        "text": "Osteochondroma"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The likely diagnosis in this patient is <strong>osteoclastoma/giant cell tumor.</strong></p>\n<p>Osteoclastoma is a bone tumour with varying growth potential. It can be either benign/malignant, though it is more commonly <strong>benign</strong>. It is seen in patients who are <strong>20-40</strong> years of age. The commonly affected sites are the lower end of the femur, the upper end of the tibia, and the distal end of the radius.</p>\n<p>Patients present with<strong> swelling</strong> and <strong>vague pain</strong>. Pathological fractures may also be seen. On examination, firm palpation can elicit tenderness.\u00a0</p>\n<p>Radiologically, <strong>soap bubble</strong> appearance is seen due to interspersed lytic lesions and bone remnants.\u00a0<strong>Intralesional curettage</strong> of the tumour is the common approach to management.</p>\n<p>Other options</p>\n<p>Option A: <strong>Chondrosarcoma\u00a0</strong>is a malignant bone tumour arising from the cartilage cells. It may arise in any bone but is common in flat bones such as the scapula, pelvis, and ribs.</p>\n<p>Option B: <strong>Osteosarcoma\u00a0</strong>is a highly malignant primary bone tumor. Common sites are the lower end of the femur, the upper end of the tibia, and the upper end of the humerus. Patients present with a history of pain followed by swelling. Radiologically, <strong>periosteal reaction</strong>, <strong>sunburst appearance</strong>, and <strong>Codman's triangle</strong> can be seen. The characteristic sunburst appearance can be seen below.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b891a0f81ab74dc4b05e572027d91aa4.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/23dd2f519c3b42b7abbb83559941adb6x446x1024.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a3e268dc68eb491db1c3d0003f3e7deex720x1299.JPEG"
    ]
  },
  {
    "text": "Which of the following tendons is most commonly affected in the shoulder impingement syndrome?",
    "choices": [
      {
        "id": 1,
        "text": "Teres minor"
      },
      {
        "id": 2,
        "text": "Teres major"
      },
      {
        "id": 3,
        "text": "Infraspinatus"
      },
      {
        "id": 4,
        "text": "Supraspinatus"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Supraspinatus</strong>&nbsp;is the most commonly affected tendon in&nbsp;<strong>shoulder impingement syndrome.</strong>&nbsp;</p>\n<p>It is also called&nbsp;<strong>supraspinatus syndrome</strong>,&nbsp;<strong>painful arc syndrome</strong>, and&nbsp;<strong>swimmer's shoulder</strong>&nbsp;and occurs when the tendons of the rotator cuff muscles become irritated and inflamed as they pass through the subacromial space. This can result in pain, weakness, and loss of movement at the shoulder.</p>\n<p><strong>Causes of impingement syndrome:</strong></p>\n<ul>\n<li>Supraspinatus tendinitis (Common)</li>\n<li>Complete or partial rupture of the rotator cuff</li>\n<li>Osteoarthritis of the acromioclavicular joint</li>\n</ul>\n<p><strong>Clinical features:</strong></p>\n<ul>\n<li><strong>Subacute tendinitis or painful arc syndrome:</strong> Anterior shoulder pain after vigorous activity. Treatment is with avoidance of initiating activity, NSAIDs and physiotherapy.</li>\n<li><strong>Chronic tendinitis:&nbsp;</strong>Recurrent attacks of subacute tendinitis and pain is worse at night.&nbsp;</li>\n<li><strong>Cuff disruption:&nbsp;</strong>There is progressive fibrosis and disruption of the cuff leading to a partial or full-thickness tear. Treatment includes acromioplasty and repair of rotator cuff.</li>\n</ul>\n<p>The following video shows the action of the subscapularis through the subacrominal space:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d68f71cb78b6475e8b6eea135460bbb2x320x240.GIF"
    ]
  },
  {
    "text": "Identify the given condition:",
    "choices": [
      {
        "id": 1,
        "text": "Chondroblastoma"
      },
      {
        "id": 2,
        "text": "Osteosarcoma"
      },
      {
        "id": 3,
        "text": "Ewings sarcoma"
      },
      {
        "id": 4,
        "text": "Adamantinoma"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given X-ray image showing the&nbsp;<strong>sunburst appearance</strong>&nbsp;is suggestive of&nbsp;<strong>osteosarcoma.&nbsp;</strong></p>\n<p><strong>Osteosarcoma</strong>&nbsp;is the&nbsp;<strong>most common primary malignant tumour</strong>&nbsp;of the&nbsp;<strong>bone</strong>, with&nbsp;bimodal age&nbsp;of distribution peaking in adolescence&nbsp;<strong>and during the 7th decade.</strong></p>\n<p>The most common site involved is the&nbsp;<strong>distal femoral metaphysis</strong>, which&nbsp;mainly presents with pain and swelling. Other sites commonly involved are the&nbsp;<strong>proximal tibia</strong>, proximal femur, and humerus.</p>\n<p><strong>X-rays features include:</strong></p>\n<ul>\n<li><strong>Codman&rsquo;s triangle &rarr;&nbsp;</strong>due to new bone formation in response to periosteal elevation</li>\n<li><strong>Sunburst appearance &rarr; </strong>due to&nbsp;new bone formation along the blood vessels within the tumor</li>\n<li><strong>Periosteal reaction</strong> <strong>&rarr;</strong> due to the lifting of the periosteum of the bone. Periosteal reaction in osteosarcoma is irregular, unlike in osteomyelitis where it is smooth.&nbsp;</li>\n</ul>\n<p><strong>Wide excision</strong>&nbsp;and reconstruction are preferred&nbsp;if&nbsp;the tumour is&nbsp;<strong>resectable</strong>&nbsp;and there are no skip lesions. It is done after starting&nbsp;<strong>neoadjuvant chemotherapy</strong>&nbsp;for 8-12 weeks.&nbsp;Chemotherapeutic agents used are doxorubicin, cisplatin, ifosfamide, and methotrexate.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/9995259a038747e6bef4889fc1dce532.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d044c62b7d2e4c44b5386632bd8e10f2x720x1363.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/50515b1c35884329bd5c9cf42ab50502x621x747.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/fc3916480c09483cb80314942794aae9x800x421.JPEG"
    ]
  },
  {
    "text": "A 67-year-old patient with a history of diabetes presented with swelling around the knee, restriction of movement, and minimal or no pain. The x-ray of the knee is given below. The diagnosis is _________.",
    "choices": [
      {
        "id": 1,
        "text": "Rheumatoid arthropathy"
      },
      {
        "id": 2,
        "text": "Osteoarthritis"
      },
      {
        "id": 3,
        "text": "Charcot arthropathy"
      },
      {
        "id": 4,
        "text": "Psoriatic arthropathy"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The x-ray depicts <strong>severe joint destruction and instability</strong>, seen on (a) varus stress (b) neutral (c) valgus stress on the patient's knee joint. There is <strong>minimal pain </strong>and this&nbsp;<strong>indicates a neuropathic cause</strong> like <strong>Charcot arthropathy.</strong></p>\n<p>Charcot arthropathy is a neuroarthropathy commonly associated with diabetes.</p>\n<p><strong>Diabetes</strong> is the most common cause of Charcot arthropathy, while tertiary syphilis was one of the common causes previously.</p>\n<p>Though the exact pathogenesis of this disease is unclear, it is speculated that&nbsp;<strong>vascular</strong>,&nbsp;<strong>neurological</strong>, and&nbsp;<strong>metabolic changes</strong>&nbsp;associated with diabetes lead to this condition.</p>\n<p>Rheumatoid arthritis, osteoarthritis, and psoriatic arthropathy present with pain.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/5b4241d307194526afc022819894cb91.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A patient has a history of a road traffic accident 2 years back, and has developed pain and swelling now at the same site. His X-ray image is shown in the image given below. What is the probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Osteogenic sarcoma"
      },
      {
        "id": 2,
        "text": "Ewing's sarcoma"
      },
      {
        "id": 3,
        "text": "Chronic osteomyelitis"
      },
      {
        "id": 4,
        "text": "Multiple myeloma"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario and the X-ray image are suggestive of&nbsp;<strong>chronic osteomyelitis</strong> of the tibia.</p>\n<p>Chronic osteomyelitis may occur by direct inoculation of the infective organism during trauma (like road traffic accident). The infection continues to thrive within the bone leading to alternating quiescent and flare up stages of chronic osteomyelitis.</p>\n<p>The radiographic image shows <strong>oval-shaped sequestrum </strong>and periosteal new bone formation surrounding the sequestrum known as&nbsp;<strong>involucrum</strong>.&nbsp;</p>\n<p>The characteristic radiographic features of other conditions given are:</p>\n<p>Osteogenic sarcoma - Sun-burst appearance, Codman's triangle</p>\n<p>Ewing's sarcoma - Onion skin appearance</p>\n<p>Multiple myeloma - Punched out lesions</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/17f2365f6f9f47d08f5f12ff82794118.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/11dc8cc0b6dc4f6c92b1a9112e2df478x724x401.JPEG"
    ]
  },
  {
    "text": "Which of the following statements is false about the condition shown in the image below?",
    "choices": [
      {
        "id": 1,
        "text": "Less chances of recurrence"
      },
      {
        "id": 2,
        "text": "Transillumination positive"
      },
      {
        "id": 3,
        "text": "It can be surgically excised"
      },
      {
        "id": 4,
        "text": "It can be seen on the dorsal and volar aspect of wrist"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Image A shows a ganglion cyst of the wrist and image B shows the surgical excision of the cyst. Image B shows a swelling that is cystic, translucent, and filled with a fluid which is suggestive of a ganglion cyst. It has high rates of recurrence and thus , option A is false.&nbsp;</p>\n<p>Ganglion cyst:</p>\n<ul>\n<li>It arises from the<strong> leakage of synovial fluid from a joint or tendon sheath</strong> and thus contains a glary, <strong>viscous fluid</strong>.</li>\n<li>It can appear anywhere in the wrist but the most common area is the dorsal surface of the scapholunate ligament.</li>\n<li>Usually appears as a <strong>painless</strong>, <strong>well-defined</strong>, <strong>cystic</strong>, <strong>transillumination positive,</strong> and <strong>non-tender swelling</strong>. If there is an impingement on a nearby nerve or structure it can cause pain.</li>\n<li>It <strong>disappears spontaneously</strong>, but the <strong>aspiration</strong> of the swelling or <strong>operative removal</strong> can be done for reassurance or when there is pressure on the nerve.</li>\n<li>If the swelling is near the radial artery or nerves then removal is done under ultrasound guidance.</li>\n<li>Even if treatment is done, the <strong>rates of recurrence are high</strong>.&nbsp;&nbsp;</li>\n</ul>\n<p>Note:</p>\n<p>A lipoma can be a differential here but it is not a transilluminant swelling and has a positive slip sign, i.e when palpated, the edge of the swelling slips under the finger.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ddf6dd2d19624a6cb809585b5c5b02c2.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "An elderly male has pain and swelling in the knee joint.  Synovial fluid on polarized light microscopy demonstrated",
    "choices": [
      {
        "id": 1,
        "text": "Negatively birefringent rhomboid shaped crystals"
      },
      {
        "id": 2,
        "text": "Positively birefringent rhomboid shaped crystals"
      },
      {
        "id": 3,
        "text": "Negatively birefringent needle shaped crystals"
      },
      {
        "id": 4,
        "text": "Positively birefringent needle shaped crystals"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given case is highly suggestive of <strong>pseudogout</strong> and in the study of synovial aspirate on polarized light, the crystals appear as<strong> Positively birefringent rhomboid shaped crystals<br /></strong></p>\n<table style=\"height: 260px;\" width=\"321\">\n<tbody>\n<tr>\n<td style=\"text-align: center; width: 311px;\" colspan=\"2\"><strong>Crystals on Polarised Microscopy</strong></td>\n</tr>\n<tr>\n<td style=\"text-align: center; width: 145.117px;\"><strong>Gout</strong></td>\n<td style=\"text-align: center; width: 159.883px;\"><strong>Pseudogout</strong></td>\n</tr>\n<tr>\n<td style=\"width: 145.117px; text-align: left;\"><strong>N</strong>egatively Birefringent</td>\n<td style=\"width: 159.883px; text-align: right;\">Positviely birefringent</td>\n</tr>\n<tr>\n<td style=\"width: 145.117px; text-align: left;\"><strong>N</strong>eedle Shaped</td>\n<td style=\"width: 159.883px; text-align: right;\">Rhomboid crystals</td>\n</tr>\n<tr>\n<td style=\"width: 145.117px; text-align: left;\"><strong>N</strong>a Urate(Sodium Urate)</td>\n<td style=\"width: 159.883px; text-align: right;\">Ca pyrophosphate</td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 55 year old female complains of lower backache. The radiographic image of her lumbosacral spine is given below. What is the probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Osteoporosis"
      },
      {
        "id": 2,
        "text": "Ankylosing spondylitis"
      },
      {
        "id": 3,
        "text": "Osteomalacia"
      },
      {
        "id": 4,
        "text": "Renal osteodystrophy"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The above image depicts&nbsp;<strong>ballooning of disc spaces&nbsp;</strong>leading to&nbsp;<strong>biconcave shape of vertebral body&nbsp;</strong>known as&nbsp;<strong>&lsquo;Cod&nbsp;</strong><strong>fish appearance&rsquo;,&nbsp;</strong>classically seen in&nbsp;<strong>osteoporosis.</strong>&nbsp;</p>\n<p>It is caused due to the reduction in the strength of the bone that leads to an increased risk of fractures. WHO defines osteoporosis as a T score&nbsp;<strong>less than -2.5</strong>. It is the&nbsp;<strong>gold standard to assess bone mineral density</strong>.</p>\n<p><strong>Other radiological features of osteoporosis:</strong></p>\n<ul>\n<li><strong>Loss of vertical height&nbsp;</strong>of vertebra due to collapse</li>\n<li><strong>Ground glass appearance of bones&nbsp;</strong>especially in the bones like pelvis</li>\n<li>Loss of cortical bone (<strong>picture frame vertebrae</strong>) and trabecular bone (<strong>ghost vertebrae</strong>)</li>\n<li>Loss of trabeculae in proximal femur area.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/2f2a1d0501014043a35b81e8bca026d5.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "The knee deformity shown below is called as _____",
    "choices": [
      {
        "id": 1,
        "text": "Genu recurvatum"
      },
      {
        "id": 2,
        "text": "Genu varus"
      },
      {
        "id": 3,
        "text": "Genu valgum"
      },
      {
        "id": 4,
        "text": "Windswept deformity"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The deformity shown is <strong>genu valgum</strong>.</p>\n<p>A normal knee has 5-7 degrees physiological outward deviation. Any increase or decrease in angle can result in knee deformities.&nbsp;</p>\n<p>Knee deformities are:</p>\n<ul>\n<li><strong>Genu valgus (valgum)</strong>&nbsp;or <strong>knock knee</strong> - Knees are abnormally approximated and the ankles are divergent.</li>\n<li><strong>Genu varus (varum)</strong>&nbsp;or <strong>bow knee</strong> -&nbsp;Knees are abnormally divergent &nbsp;and the ankles are approximated.</li>\n<li><strong>Windswept deformity</strong> - Abnormal valgus deformity of one knee with varus of the other.</li>\n<li><strong>Genu recurvatum</strong> - Hyperextension at knee joint, knee bends backwards.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/80dd2709b89145b6befd99162f8c64de.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/cf09b0be7dd94b558cde45468ebf3944x1280x2560.JPEG"
    ]
  },
  {
    "text": "A 45-year-old patient presents to your clinic with complaints of stiffness of the joints in their fingers for the past 6 years that has progressively worsened over time. On examination, the following deformity is noted. What is the diagnosis in this case?",
    "choices": [
      {
        "id": 1,
        "text": "Osteoarthritis"
      },
      {
        "id": 2,
        "text": "Gout"
      },
      {
        "id": 3,
        "text": "Rheumatoid arthritis"
      },
      {
        "id": 4,
        "text": "Psoriatic arthritis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given image shows a <strong>swan-neck deformity</strong> seen in a patient with established <strong>rheumatoid arthritis </strong>(RA). Swan neck deformity is hyperextension at the proximal interphalangeal (PIP) joint and flexion at the distal interphalangeal (DIP) joint.</p>\n<div class=\"page\" title=\"Page 2792\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Rheumatoid arthritis (RA) is a chronic inflammatory disease of unknown etiology characterized by a symmetric polyarthritis and is the most common form of chronic inflammatory arthritis.&nbsp;A variation in the the HLA-DRB1 gene is known to cause RA. Cigarette smoking is known to increase the risk five to six fold.</p>\n<div class=\"page\" title=\"Page 2792\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<div class=\"page\" title=\"Page 2792\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Histopathological features include&nbsp;synovial cell hyperplasia and proliferation&nbsp;with&nbsp;inflammatory infiltrates<strong>&nbsp;</strong>and<strong>&nbsp;rheumatoid nodules.&nbsp;</strong>These are<strong>&nbsp;necrotizing granulomas</strong>&nbsp;surrounded by&nbsp;<strong>fibrinoid necrosis.&nbsp;</strong></p>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n<div class=\"page\" title=\"Page 2792\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>RA is a systemic disease, which potentially leads to a variety of extraarticular manifestations, including fatigue, subcutaneous nodules, interstitial lung disease and pulmonary nodules, pericarditis, peripheral neuropathy, vasculitis, and hematologic abnormalities, which must be managed accordingly.<strong>&nbsp;</strong></p>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n<p><strong>Clinically</strong>, patients present with early morning joint pain and stiffness that relieves with activity. It mainly involves the metacarpophalangeal (MCP) and proximal interphalangeal (PIP) joints. Other hallmark features include flexor tendon tenosynovitis, <strong>swan</strong> <strong>neck deformity, boutonniere</strong> deformity,&nbsp;<strong>Z-line</strong> deformity, and trigger finger.</p>\n<p>Patients may have&nbsp;<strong>elevated ESR&nbsp;</strong>(erythrocyte sedimentation rate)&nbsp;and&nbsp;<strong>C reactive protein&nbsp;</strong>(CRP)<strong>.</strong>&nbsp;<strong>Rheumatoid factor&nbsp;</strong>and&nbsp;<strong>anti-CCP&nbsp;</strong>(cyclic citrullinated peptide) antibodies are helpful in prognosis. Progression of joint damage is assessed by plain X-ray.</p>\n<p>Management comprises of&nbsp;<strong>n</strong><strong>on-steroidal anti-inflammatory drugs</strong>&nbsp;for pain relief, along with disease modifying anti-rheumatoid drugs (DMARD).&nbsp;<strong>Methotrexate</strong>&nbsp;is the DMARD of choice.&nbsp;<strong>Hydroxychloroquine</strong>&nbsp;(HCQ) is given as an adjuvant in combination with other DMARDs.&nbsp;<strong>Biological agents</strong>&nbsp;such as TNF-&alpha; inhibitors, anakinra and rituximab are known to reduce the signs and symptoms of RA, slow radiographic progression of joint damage, and improve physical function and quality of life.</p>\n<p>Other options:</p>\n<p>Option A-&nbsp;<strong>Osteoarthritis(OA)</strong>&nbsp;typically affects the weight-bearing joints like the <strong>knee</strong>, hip, and spine. It presents <strong>bilaterally</strong> with&nbsp;<strong>pain</strong>&nbsp;being the predominant symptom. The pain worsens with use. Other symptoms such as <strong>joint</strong> <strong>stiffness</strong>, <strong>swelling</strong>, giving away or locking can be present.</p>\n<p>Option&nbsp;B-&nbsp;<strong>Gout</strong> has typical features of pain, swelling, and warmth of the <strong>first metatarsophalangeal</strong> joint. The radiograph is normal in the initial stages while it shows&nbsp;erosions<strong>, punched-out lesions,</strong>&nbsp;and<strong>&nbsp;</strong>sclerosis&nbsp;with preservation of joint space in the late stages.</p>\n<p><span class=\"s1\">Option C-&nbsp;</span><strong><span class=\"s1\">Psoriatic arthritis</span></strong>&nbsp;is an&nbsp;<strong>inflammatory musculoskeletal disease&nbsp;</strong>characteristically occurring in&nbsp;individuals<strong>&nbsp;</strong>with<strong>&nbsp;psoriasis.&nbsp;</strong>&nbsp;Psoriatic arthritis&nbsp;of the hands commonly involves proximal and distal interphalangeal joints (PIP,&nbsp;DIP) and metacarpophalangeal joints (MCP).&nbsp;The <strong>distal</strong> <strong>interphalangeal</strong> <strong>joint</strong> (DIP) is the most common joint involved in psoriatic arthritis. X-ray shows a characteristic <strong>pencil-in-cup</strong> appearance.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b1f0480fddc242b78ff24e83eb3858a1.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A throw ball player presents to the emergency room with pain over the shoulder, arm abducted and externally rotated and loss of sensation over the proximal lateral aspect of the arm. Which of the following nerve injuries is likely associated with this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Lateral cutaneous nerve of arm"
      },
      {
        "id": 2,
        "text": "Radial nerve"
      },
      {
        "id": 3,
        "text": "Axillary nerve"
      },
      {
        "id": 4,
        "text": "Musculocutaneous nerve"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The clinical presentation is suggestive of anterior dislocation of shoulder. The most common nerve injured in these cases is the <strong>axillary nerve </strong>as it winds around the humerus.<strong><br /></strong></p>\n<p>In axillary nerve injury, there is loss of sensation over a small part of the deltoid region in upper arm (<strong>regimental badge area</strong>) and weakness in abduction (15-90 degress) due to denervation of deltoid. Overhead abduction is unaffected as it is the function of serratus anterior and trapezius muscles.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient who had applied plaster to his right leg for a tibial shaft fracture ,now presents with severe pain in the leg. On examination, the distal pulses are absent, on passive stretching the pain increases, and on opening the plaster, the leg appears edematous and numerous blisters are seen. Considering the suspected diagnosis, what would be the most appropriate management in this case?",
    "choices": [
      {
        "id": 1,
        "text": "Fasciotomy"
      },
      {
        "id": 2,
        "text": "Elevation of limb"
      },
      {
        "id": 3,
        "text": "Opening of the plaster is sufficient"
      },
      {
        "id": 4,
        "text": "Closed reduction"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario suggests acute compartment syndrome, and it is treated immediately with fasciotomy.</p>\n<p class=\"p1\">The classic features of ischemia in acute compartment syndrome include the <strong>5 Ps</strong>:</p>\n<ul>\n<li class=\"p1\"><strong>Pain:</strong>&nbsp;Pain is the <strong>first symptom</strong> of acute compartment syndrome. Ischemic muscle is highly sensitive to touch. On the passive stretching of the muscles, severe pain can be elicited.&nbsp;</li>\n<li class=\"p1\"><strong>Paresthesia:&nbsp;</strong>Paresthesia and hypoesthesia may be noted due to compression of nerves traversing the affected compartment. They are the first signs of nerve ischemia.</li>\n<li class=\"p1\"><strong>Pallor: </strong>Pallor of the skin may not always be seen. The skin outside the compartment may be normally perfused, as only the intra-compartmental perfusion may be affected.</li>\n<li class=\"p1\"><strong>Paralysis:</strong>&nbsp;Paralysis of muscle groups affected in that compartment is a <strong>late sign</strong>.</li>\n<li class=\"p1\"><strong>Pulselessness:&nbsp;</strong>Usually, the peripheral pulses and&nbsp;capillary return are intact in the early stages, unless there is a major arterial injury. If pulses are absent, arteriography is indicated.&nbsp;</li>\n</ul>\n<p>The diagnosis can be confirmed by measuring the <strong>intra-compartmental pressure</strong>&nbsp;using a split catheter introduced into the compartment. The difference between diastolic pressure and compartment pressure is known as the&nbsp;differential pressure (&Delta;P). A&nbsp;<strong>differential pressure (&Delta;P)</strong> of <strong>less than&nbsp;30 mm Hg</strong> (4.00 kilopascals) is an <strong>indication</strong> for <strong>immediate compartment decompression</strong>.</p>\n<p><strong>Treatment</strong>: The threatened compartment must be promptly decompressed, merely splitting the plaster is utterly useless and the limb must be <strong>nursed flat</strong>, elevating the limb causes further decrease in end capillary pressure and aggravates the muscle ischemia. In the case of compartment syndrome in the leg, <strong>Fasciotomy</strong> means opening all four compartments. Wounds to be left open and<strong> inspected 2 days</strong> later, if tissues are healthy, the wounds can be sutured. If there is muscle necrosis, debridement to be carried out.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Shepherd's crook deformity is seen in ______",
    "choices": [
      {
        "id": 1,
        "text": "Non-ossifying fibroma"
      },
      {
        "id": 2,
        "text": "Fibrous dysplasia"
      },
      {
        "id": 3,
        "text": "Osteoid osteoma"
      },
      {
        "id": 4,
        "text": "Osteoblastoma"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Shepherd's crook deformity</strong> is seen in&nbsp;<strong>fibrous dysplasia of proximal femur.</strong></p>\n<p><strong>Fibrous dysplasia</strong> is a developmental disorder in which area of<strong> trabecular bone is replaced by cellular fibrous tissue.&nbsp;</strong>If this occurs in the weight-bearing bones like the femur, it will lead to the bending of bones called as &lsquo;Shepherd&rsquo;s crook' deformity.</p>\n<p>Image: Bending of upper femur in fibrous dysplasia known as <strong>Shepherd&rsquo;s crook deformity</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/28e2718714834a9cab91f341cb7123ccx512x771.PNG"
    ]
  },
  {
    "text": "A patient was admitted to ICU 48 hours after the fracture of the femur. The saturation of oxygen in the rebreathing unit was 100% but his Spo2 remained 60%. The patient is in a state of confusion. Chest radiograph showed lung fields to be clear. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Pulmonary embolism"
      },
      {
        "id": 2,
        "text": "Fat embolism"
      },
      {
        "id": 3,
        "text": "ARDS"
      },
      {
        "id": 4,
        "text": "Occult pneumothorax"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The most likely diagnosis of the above clinical scenario is a fat embolism. Presence of <strong>respiratory insufficiency</strong> and <strong>altered mental status</strong> following a <strong>long bone fracture (fracture of the femur)</strong> favours the diagnosis.</p>\n<p>Fat embolism syndrome results from the presence of numerous fat emboli within the microcirculation. It most commonly occurs after the fracture of the long bone or pelvis. They&nbsp;present with non-specific symptoms like <strong>tachypnea, tachycardia </strong>and <strong>fever </strong>that&nbsp;manifest within <strong>24- 48 hours</strong> after the injury. Damage to the microvasculature of various organs leads to :</p>\n<ul>\n<li>Mild hypoxia to rapidly progressing respiratory failure.</li>\n<li>Depression of the central nervous system.</li>\n<li>Petechial rashes</li>\n<li>Hemorrhagic lesions of the retina.</li>\n</ul>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "While examining a patient with a right forearm fracture, you ask him to make a fist. The following finding is noted during this procedure. What is the sign called as ?",
    "choices": [
      {
        "id": 1,
        "text": "Froment's sign"
      },
      {
        "id": 2,
        "text": "Pointing index sign"
      },
      {
        "id": 3,
        "text": "Benediction sign"
      },
      {
        "id": 4,
        "text": "Policeman tip deformity"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given image shows the&nbsp;<strong>pointing index </strong>sign and is associated with&nbsp;<strong>median nerve injury</strong>&nbsp;at the forearm or elbow.</p>\n<p>The<strong>&nbsp;pointing</strong>&nbsp;<strong>index&nbsp;</strong>sign is seen&nbsp;in&nbsp;<strong>supracondylar fractures&nbsp;</strong>of the humerus.</p>\n<p>This finding occurs as a result of&nbsp;<strong>injury</strong>&nbsp;to the&nbsp;<strong>anterior interosseous nerve</strong>,&nbsp;a branch of the median nerve. It results in the loss of function of both flexor digitorum profundus (<strong>FDP</strong>) and flexor digitorum superficialis (<strong>FDS</strong>). Hence, the index finger sticks out when the patient is asked to clasp their hand.&nbsp;</p>\n<p>Other options:</p>\n<p>Option A:&nbsp; In&nbsp;<strong>Froment's sign, </strong>due to the&nbsp;<strong>weakness of the adductor pollicis muscle,</strong>&nbsp;the adduction of the thumb is lost. When asked to hold an object, the patient tries to hold the object by using the&nbsp;<strong>flexor pollicis longus</strong>&nbsp;muscle. This produces flexion at the interphalangeal joint while holding the book.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a95f3e9f13b84b328753a0c664cabd71.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3a59954647884d5688af50715b20af77x1279x395.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/995496acbf634e9a865bbce0883219f2x1279x1442.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f113d7e45f6541dc939cb366e9cd3897x1279x1223.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/fbed1ba655264856a719ac59605c9173x1280x1622.JPEG"
    ]
  },
  {
    "text": "A 12-year-old boy presents with a gradually progressing swelling and pain for 6 months over the upper tibia. His radiographic image is shown below. The most likely diagnosis is:",
    "choices": [
      {
        "id": 1,
        "text": "Osteosarcoma"
      },
      {
        "id": 2,
        "text": "Osteoclastoma"
      },
      {
        "id": 3,
        "text": "Brodie's abscess"
      },
      {
        "id": 4,
        "text": "Ewing's sarcoma"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario of a <strong>young boy </strong>having <strong>gradually progressive pain</strong> and <strong>swelling</strong> and the radiographic image showing a well-defined<strong> lytic</strong> <strong>lesion</strong> with a <strong>dense</strong> <strong>sclerotic</strong> rim are most suggestive of<strong> Brodie's abscess.</strong></p>\n<p><strong>Brodie's abscess</strong> is a localized form of<strong> subacute osteomyelitis</strong> that occurs most often in the <strong>long bones </strong>of the <strong>lower extremities </strong>of <strong>young adults</strong>. The organism most involved would be <strong><em>Staphylococcus aureus</em></strong>. It usually presents with <strong>intermittent pain</strong>\u00a0that lasts long and <strong>local tenderness</strong> over the affected area.</p>\n<p><strong>Treatment:</strong></p>\n<ul>\n<li><strong>Immobilization</strong> and <strong>antibiotics</strong> (flucloxacillin and fusidic acid) intravenous for 4-5\u00a0days, followed by oral administration for another 6\u00a0weeks; healing may take up to 12\u00a0months</li>\n<li><strong>Curettage</strong> is needed if the X-rays show no healing after conservative management.</li>\n<li>Curettage is also done along with open biopsy in doubtful cases.</li>\n</ul>\n<p>All of the given conditions may present with a history of swelling and pain. However, the differentiating features of each of the given conditions are as follows:</p>\n<table style=\"height: 89px; width: 590px;\">\n<tbody>\n<tr>\n<td style=\"width: 96px;\"><strong>Condition</strong></td>\n<td style=\"width: 127px;\"><strong>Age group</strong></td>\n<td style=\"width: 234px;\"><strong>Radiographic findings</strong></td>\n</tr>\n<tr>\n<td style=\"width: 96px;\"><strong>Brodie's abscess</strong></td>\n<td style=\"width: 127px;\">\n<p>Children, adolescents</p>\n</td>\n<td style=\"width: 234px;\">A lytic lesion with a dense sclerotic rim, minimal periosteal reaction</td>\n</tr>\n<tr>\n<td style=\"width: 96px;\"><strong>Osteosarcoma</strong></td>\n<td style=\"width: 127px;\">Children, adolescents, and seventh decade</td>\n<td style=\"width: 234px;\">Periosteal reaction leading to sunray appearance and Codman triangle</td>\n</tr>\n<tr>\n<td style=\"width: 96px;\"><strong>Osteoclastoma</strong></td>\n<td style=\"width: 127px;\">20-40 years</td>\n<td style=\"width: 234px;\">A lytic lesion with a thin sclerotic rim, minimal periosteal reaction</td>\n</tr>\n<tr>\n<td style=\"width: 96px;\"><strong>Ewing's sarcoma</strong></td>\n<td style=\"width: 127px;\">10-20 years</td>\n<td style=\"width: 234px;\">Periosteal reaction leading to onion peel appearance</td>\n</tr>\n</tbody>\n</table>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/53208f1a262949e4b3f9dfdfb3707508.JPEG"
    ],
    "explanation_images": []
  }
];
        let quizName = 'Orthopaedics Test';
        let hierarchy = ["Marrow", "FMGE Test Series Subject", "2023"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>