<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>04  Instrument - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        DAMS / DQB / Anesthesia
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">32</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "id": 50000,
    "choices": [
      {
        "id": 200000,
        "text": "Left-sided double-lumen endotracheal tube"
      },
      {
        "id": 200001,
        "text": "Regular endotracheal tube and a bronchial blocker"
      },
      {
        "id": 200002,
        "text": "Regular endotracheal tube only"
      },
      {
        "id": 200003,
        "text": "Right-sided double-lumen endotracheal tube"
      }
    ],
    "text": "A 45-year old woman is admitted for elective left-sided lobectomy of upper lobe for lung nodule with suspicion of malignancy. She was diagnosed with a 1.2 cm pulmonary nodule 3 months ago. On repeat CT chest, the size of the nodule increased to 3 cm. During anesthesia, what is the best device for intraoperative ventilation of this patient?",
    "unique_key": "Q9715543",
    "question_audio": null,
    "question_video": null,
    "map_id": 34189871,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (A) Left-sided double-lumen endotracheal tube. A left-sided double-lumen endotracheal tube (DLT) is the best device for intraoperative ventilation in a patient undergoing a left-sided lobectomy. The DLT allows for lung isolation, which is critical during thoracic surgery to provide optimal surgical exposure and reduce the risk of contamination or spillage of secretions between the lungs. With a left-sided DLT, the right lung can be selectively ventilated while the left lung (the operative lung) is deflated to facilitate surgical access. Left-sided DLTs are preferred over right-sided DLTs for most procedures, including left-sided surgeries, because their design avoids the need to perfectly align the tube with the right upper lobe bronchus, which could be more challenging and prone to malposition. Additionally, DLTs allow for easier and more reliable lung isolation compared to bronchial blockers. Explanation for Incorrect Responses: B. Regular endotracheal tube and a bronchial blocker: Although a bronchial blocker with a regular endotracheal tube can achieve lung isolation, it is more technically challenging to place and adjust than a double-lumen tube. Bronchial blockers are often used when DLT placement is contraindicated (e.g., in small pediatric patients or patients with difficult airways), but they are less reliable for consistent lung isolation. Additionally, they do not allow for independent ventilation of the lungs as effectively as a DLT, making them suboptimal for this case. C. Regular endotracheal tube only: A regular endotracheal tube without additional equipment cannot achieve lung isolation. In this case, it would result in both lungs being ventilated during the procedure, which would impede the surgeon's ability to access and operate on the left lung. Additionally, it increases the risk of contamination or damage to the healthy lung, making it unsuitable for lobectomy procedures. D. Right-sided double-lumen endotracheal tube: A right-sided DLT could theoretically be used to isolate the left lung, but it is not ideal for left-sided surgeries. The design of a right-sided DLT includes a smaller lumen for ventilation of the right upper lobe bronchus, which can be difficult to position accurately and is prone to malposition during surgery. This makes a left-sided DLT the preferred choice for left-sided thoracic procedures, as it simplifies placement and minimizes the risk of complications. In conclusion, the left-sided double-lumen endotracheal tube is the most effective and reliable option for intraoperative ventilation in a left-sided lobectomy, ensuring proper lung isolation and optimal surgical conditions.",
    "correct_choice_id": 200000,
    "solution_audio": null,
    "solution_video": "",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50001,
    "choices": [
      {
        "id": 200004,
        "text": "Ask for a large plastic adhesive, cut a hole into it and place over the patient's mouth to make a seal"
      },
      {
        "id": 200005,
        "text": "Rush to tracheostomy as mask ventilation is failing"
      },
      {
        "id": 200006,
        "text": "Attempt to find a larger mask to make a better seal"
      },
      {
        "id": 200007,
        "text": "Place a second-generation laryngeal mask airway (LMA)"
      }
    ],
    "text": "A 35-year-old man with a history of obesity is undergoing an elective herniorrhaphy. Anesthesia is successfully induced. Right after giving a muscle relaxant, positive pressure ventilation by face mask fails to provide an adequate seal. His oxygen saturation of the patient begins to fall. What is the next best step in the management of this patient?",
    "unique_key": "Q7139472",
    "question_audio": null,
    "question_video": null,
    "map_id": 34400658,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (D) Place a second-generation laryngeal mask airway (LMA) \u2022 After induction of anesthesia, including a muscle relaxant, maintaining pre-oxygenation and some ventilation is of paramount importance to avoid hypoxia. \u2022 Especially in larger individuals, redundant tissue may make positive pressure ventilation difficult. \u2022 Once the face mask fails to provide an adequate seal, an LMA is a good choice to provide a seal further down the airway. \u2022 The LMA is designed to create a seal around the larynx to allow positive pressure ventilation up to a certain pressure, which can vary between patients and the design of the LMA. \u2022 Once the patient's saturation begins to fall, swift and decisive action such as inserting an LMA will help to prevent further hypoxia. \u2022 In addition to bypassing facial features, missing teeth, and full beards, LMAs can also be useful to slide past redundant pharyngeal tissues which might obstruct the upper airway. \u2022 LMA's have different designs and features, such as silicone cuffs, gastric access ports, non-inflatable gel cuffs. \u2022 2nd generation LMAs often provide higher seal pressure to allow for higher positive pressure ventilation pressures and are preferred in a rescue situation. \u2022 LMA's, preferably 2nd generation, should be immediately available during induction of anesthesia if airway rescue becomes necessary.",
    "correct_choice_id": 200007,
    "solution_audio": null,
    "solution_video": "",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50002,
    "choices": [
      {
        "id": 200008,
        "text": "1st generation LMA"
      },
      {
        "id": 200009,
        "text": "2nd generation LMA"
      },
      {
        "id": 200010,
        "text": "Endotracheal tube"
      },
      {
        "id": 200011,
        "text": "A larger sized LMA than usual"
      }
    ],
    "text": "A 54-year-old professional singer presents to the hospital with a ruptured appendix. He is scheduled for an emergency laparoscopic appendectomy. He is very worried about endotracheal intubation because of his profession. He requests the use of a laryngeal mask airway (LMA) and does not want to be intubated. What is the most appropriate recommendation for this patient?",
    "unique_key": "Q4984026",
    "question_audio": null,
    "question_video": null,
    "map_id": 34165959,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (C) Endotracheal tube \u2022 LMAs are frequently used to provide a patent airway during general anesthesia. While most providers prefer to use them for patients who are breathing spontaneously, positive pressure ventilation can be provided with a well seated LMA. \u2022 LMA's do not protect against gastric content aspiration. Aspiration of gastric contents can be fatal. \u2022 The difference between a 1st and 2nd generation LMA is in the cuff material and a separate access hole to the esophagus. They are designed to provide a higher seal pressure allowing for higher positive pressure ventilation. \u2022 In an emergency procedure, an LMA is not a good choice for primary airway management as LMAs do not protect against gastric content aspiration. \u2022 Endotracheal intubation is a gold standard method of airway access when there is increased risk of aspiration.",
    "correct_choice_id": 200010,
    "solution_audio": null,
    "solution_video": "",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50003,
    "choices": [
      {
        "id": 200012,
        "text": "It's the end of the case and even if one lung isn\u2019t ventilated it won\u2019t have any clinical significance."
      },
      {
        "id": 200013,
        "text": "Placement of the endotracheal tube at the level of the carina is optimal"
      },
      {
        "id": 200014,
        "text": "Both lungs appear to be inflated on the chest x-ray; this is likely because the lungs are being ventilated via the Murphy eye of the endotracheal tube"
      },
      {
        "id": 200015,
        "text": "Both lungs appear to be inflated on the chest x-ray; this is likely because the positive pressure ventilation is blowing the carina away from the endotracheal tube and allowing both lungs to be ventilated"
      }
    ],
    "text": "A 46-year-old female undergoes an uneventful exploratory laparotomy. Chest and abdominal x-rays are performed to evaluate for a lost sponge in the counts at the end of the case. The chest x-ray incidentally reveals that the endotracheal tube is sitting just at the carina. One of the trainee surgeons becomes worried and asks for the tube to be adjusted. However, the anesthetist does not show concern. Which of the following best explains why the anesthetist is unconcerned?",
    "unique_key": "Q6775890",
    "question_audio": null,
    "question_video": null,
    "map_id": 34749036,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (C) \u2022 The Murphy eye is a safety mechanism to allow for ventilation to continue even if the tip of the endotracheal tube is hubbed against the wall of the endobronchial tree. \u2022 Nearly all endotracheal tubes have a Murphy eye for this purpose. \u2022 The Murphy eye is a second smaller hole off the side of the distal end of the endotracheal tube (positioned 90 degrees from the tip). \u2022 Optimal placement of the tip of the endotracheal tube is at the level of the T2-T4 vertebrae in the middle third of the trachea, not at the carina. \u2022 It is nice that both lungs appear to be inflated on the chest x-ray, but this is not because the positive pressure ventilation is blowing the carina away from the endotracheal tube. \u2022 Answer 1 is also incorrect, the endotracheal tube will come out shortly as the case is over, but it is not a good explanation of why the anesthesiologist is unconcerned. \u2022 It is necessary to ventilate both lungs throughout the entire case properly.",
    "correct_choice_id": 200014,
    "solution_audio": null,
    "solution_video": "",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50004,
    "choices": [
      {
        "id": 200016,
        "text": "Non-Rebreathing Mask"
      },
      {
        "id": 200017,
        "text": "Venturi mask"
      },
      {
        "id": 200018,
        "text": "Nebulizer mask"
      },
      {
        "id": 200019,
        "text": "Bag and mask"
      }
    ],
    "text": "The mask shown below was used in Covid 19 patients. Identify:<p><img src=\"https://d2enu63wt1sf3u.cloudfront.net/ckfinder/files/2(798).jpg\" alt=\"Question Image\"></p>",
    "unique_key": "Q7676189",
    "question_audio": null,
    "question_video": null,
    "map_id": 34961782,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (A) Option A-A non-rebreather mask (NRM) is a non-invasive oxygen supplementation device that is used to provide continuous oxygen flow, typically in a hospital setting.It has a reservoir bag connected to it. Option B-Venturi mask has a valve to control flow of gases. Option C-Nebulizer mask is also known as hudson's face mask. Option D-Bag and mask will have a AMBU bag connected to mask.",
    "correct_choice_id": 200016,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/63313021698572315/63313021698572315.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/63313021698572315/63313021698572315.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50005,
    "choices": [
      {
        "id": 200020,
        "text": "Heat and humidification"
      },
      {
        "id": 200021,
        "text": "By passing nasopharyngeal dead space"
      },
      {
        "id": 200022,
        "text": "Decreases need of intubation"
      },
      {
        "id": 200023,
        "text": "PEEP"
      }
    ],
    "text": "Which is not an obvious advantage of high pressure oxygen through nasal cannula:",
    "unique_key": "Q1101121",
    "question_audio": null,
    "question_video": null,
    "map_id": 34686800,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (C) Option A,B,D-High-Flow Nasal Cannula (HFNC) delivers very high flows of O2 [2 to 40 L/min]This is the newest technique of O2 delivery (in adults) using heated [37\u00b0C] and humidified gas. Using oxygen that is heated to body temperature and supersaturated with water (to a relative humidity of 99%), O2 flow rates up to 40\u201360 L/min can be delivered through wide nasal prongs without discomfort and mucosal injury. Physiological dead space washout of waste gases including carbon dioxide (CO2) i.e,It causes displacement of excess CO2 with excess O2.It Decrease work of breathing by decreasing airway resistance through the application of a positive pressure.It provides a Positive end-expiratory pressure(PEEP). Option C-It can decrease the need of intubation,which is a disadvantage,as we'll end up intubating the patient in a very late stage resulting in significant morbidity and mortality.<p><img src=\"https://d2enu63wt1sf3u.cloudfront.net/ckfinder/files/2_1(157).jpg\" alt=\"Solution Image\"></p>",
    "correct_choice_id": 200022,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/24450051704706973/24450051704706973.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/24450051704706973/24450051704706973.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50006,
    "choices": [
      {
        "id": 200024,
        "text": "Airway cart"
      },
      {
        "id": 200025,
        "text": "Central venous catheter cart"
      },
      {
        "id": 200026,
        "text": "Arterial line cart"
      },
      {
        "id": 200027,
        "text": "Urinary catheter cart"
      }
    ],
    "text": "What is shown in the following image?<p><img src=\"https://d2enu63wt1sf3u.cloudfront.net/ckfinder/files/11(398).jpg\" alt=\"Question Image\"></p>",
    "unique_key": "Q2623443",
    "question_audio": null,
    "question_video": null,
    "map_id": 34116419,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (A) The given image shows multiple handles of laryngoscope,hence it is related to airway.Therefore, It is a difficult airway cart.",
    "correct_choice_id": 200024,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/66104521704707128/66104521704707128.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/66104521704707128/66104521704707128.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50007,
    "choices": [
      {
        "id": 200028,
        "text": "Oxygen"
      },
      {
        "id": 200029,
        "text": "Nitrous oxide"
      },
      {
        "id": 200030,
        "text": "Air"
      },
      {
        "id": 200031,
        "text": "Vacuum"
      }
    ],
    "text": "Identify the gas (arrow) in the image shown?<p><img src=\"https://d2enu63wt1sf3u.cloudfront.net/ckfinder/files/1(850).png\" alt=\"Question Image\"></p>",
    "unique_key": "Q9151465",
    "question_audio": null,
    "question_video": null,
    "map_id": 34326472,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (B) Pipeline colour coding system is:- Option A-Oxygen -blue/white Option B-Nitrous oxide -blue Option C-Air -grey/white. Option D-Suction- yellow<p><img src=\"https://d2enu63wt1sf3u.cloudfront.net/ckfinder/files/12(406).jpg\" alt=\"Solution Image\"></p>",
    "correct_choice_id": 200029,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/64682601704707143/64682601704707143.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/64682601704707143/64682601704707143.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50008,
    "choices": [
      {
        "id": 200032,
        "text": "High flow nasal cannula"
      },
      {
        "id": 200033,
        "text": "Fibroscan"
      },
      {
        "id": 200034,
        "text": "CPAP machine"
      },
      {
        "id": 200035,
        "text": "Ventilator"
      }
    ],
    "text": "Identify the device?<p><img src=\"https://d2enu63wt1sf3u.cloudfront.net/ckfinder/files/14(352).jpg\" alt=\"Question Image\"></p>",
    "unique_key": "Q4376070",
    "question_audio": null,
    "question_video": null,
    "map_id": 34163549,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (A) High-Flow Nasal Cannula (HFNC) The newest technique of O2 delivery (in adults) is high-flow nasal O2 using heated and humidified gas. Using oxygen that is heated to body temperature and supersaturated with water (to a relative humidity of 99%),FIO2 (21\u2013100%), O2 flow rates up to 40\u201360 L/min can be delivered through wide nasal prongs without discomfort and mucosal injury. Decrease work of breathing by decreasing airway resistance through the application of a positive pressure Provides Positive end-expiratory pressure",
    "correct_choice_id": 200032,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/48929891704707159/48929891704707159.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/48929891704707159/48929891704707159.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50009,
    "choices": [
      {
        "id": 200036,
        "text": "Venturi mask"
      },
      {
        "id": 200037,
        "text": "Hudson mask"
      },
      {
        "id": 200038,
        "text": "Nasal cannula"
      },
      {
        "id": 200039,
        "text": "Non rebreathing mask"
      }
    ],
    "text": "Maximum FiO2 is delivered by which device?",
    "unique_key": "Q2856827",
    "question_audio": null,
    "question_video": null,
    "map_id": 34684401,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (D) Option A-Venturi mask-24-50% Option B-Hudson mask-35-50% Option C-Nasal cannula-24-40% Option D-Non rebreathing mask-60-80%",
    "correct_choice_id": 200039,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/52046341704707228/52046341704707228.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/52046341704707228/52046341704707228.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50010,
    "choices": [
      {
        "id": 200040,
        "text": "5 L per min"
      },
      {
        "id": 200041,
        "text": "10 L per min"
      },
      {
        "id": 200042,
        "text": "15 L per min"
      },
      {
        "id": 200043,
        "text": "20 L per min"
      }
    ],
    "text": "Maximum flow rate of oxygen that can be used by conventional oxygen therapy?",
    "unique_key": "Q3288602",
    "question_audio": null,
    "question_video": null,
    "map_id": 34160479,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (C) Conventional oxygen therapy (COT) is the main supportive treatment administered to patients after planned extubation and has conventionally been delivered using nasal prongs, cannula or masks. However, the maximal oxygen flow rates that these devices can deliver are limited. The maximal oxygen flow rate delivered by COT is only 15 L/min, which is far lower than the demands of post extubation patients with acute respiratory failure. Furthermore, with oxygen delivered by COT, it is difficult to meet the requirements of heating and humidification in these patients. High-flow nasal cannula (HFNC) can supply a mixture of air and oxygen via a heated and humidified circuit at a very high flow. It can provide almost pure oxygen with a FiO2 of approximately 100% and a maximal flow rate up to 60 L/min. The use of a HFNC may generate a positive airway pressure, ameliorate oxygenation and dyspnoea, reduce the respiratory rate and work of breathing, and improve comfort.<p><img src=\"https://d2enu63wt1sf3u.cloudfront.net/ckfinder/files/23_1(58).jpg\" alt=\"Solution Image\"></p>",
    "correct_choice_id": 200042,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/41527641704707296/41527641704707296.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/41527641704707296/41527641704707296.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50011,
    "choices": [
      {
        "id": 200044,
        "text": "PEDITARIC ANESTHESIA"
      },
      {
        "id": 200045,
        "text": "NEURO ANESTHESIA"
      },
      {
        "id": 200046,
        "text": "CARDIAC ANESTHESIA"
      },
      {
        "id": 200047,
        "text": "OBSTETRIC ANESTHESIA"
      }
    ],
    "text": "JR CIRCUIT IS USED FOR?",
    "unique_key": "Q7792522",
    "question_audio": null,
    "question_video": null,
    "map_id": 34135093,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (A) JR CIRCUIT (Jackson and reese modification of Ayre's T-piece) is used for pediatric patients.",
    "correct_choice_id": 200044,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/58920321731673474/58920321731673474.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/58920321731673474/58920321731673474.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50012,
    "choices": [
      {
        "id": 200048,
        "text": "Oxygen saturation"
      },
      {
        "id": 200049,
        "text": "Oxygen content of the blood"
      },
      {
        "id": 200050,
        "text": "Partial pressure of oxygen"
      },
      {
        "id": 200051,
        "text": "Amount of inspired oxygen"
      }
    ],
    "text": "Which of the following is measured by the device shown in the given image?<p><img src=\"https://d2enu63wt1sf3u.cloudfront.net/ckfinder/files/Picture15(5).jpg\" alt=\"Question Image\"></p>",
    "unique_key": "Q8217870",
    "question_audio": null,
    "question_video": null,
    "map_id": 34655134,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (A) Oxygen Saturation A pulse oximeter measures the percentage of oxygen-saturated hemoglobin in arterial blood. It uses light-emitting diodes (LEDs) that emit red and infrared light, and a photodetector that analyzes the absorption of these lights by oxygenated and deoxygenated hemoglobin. The device then calculates SpO2, which represents the proportion of oxygen-carrying hemoglobin relative to the total hemoglobin in the blood. SpO2 levels are critical for monitoring respiratory and cardiovascular health and typically range between 95-100% in healthy individuals. This non-invasive and quick measurement makes the pulse oximeter widely used in clinical and home healthcare settings. Incorrect Options: (B) Oxygen content of the blood: Oxygen content refers to the total amount of oxygen in the blood, including oxygen bound to hemoglobin and dissolved in plasma. While SpO2 contributes to oxygen content, the pulse oximeter does not measure this directly. Calculating oxygen content requires additional parameters like hemoglobin concentration and arterial blood gas analysis. (C) Partial pressure of oxygen: The partial pressure of oxygen (PaO2) is the measure of oxygen dissolved in the blood, typically obtained through arterial blood gas analysis. Pulse oximeters do not measure PaO2, as it requires blood samples and laboratory equipment. (D) Amount of inspired oxygen: The amount of inspired oxygen, or FiO2, is the concentration of oxygen in the air that a person breathes. This parameter is controlled by oxygen-delivery systems like ventilators or masks but is not measured by a pulse oximeter.",
    "correct_choice_id": 200048,
    "solution_audio": null,
    "solution_video": "",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50013,
    "choices": [
      {
        "id": 200052,
        "text": "30-40 cm H20"
      },
      {
        "id": 200053,
        "text": "30-40 mm Hg"
      },
      {
        "id": 200054,
        "text": "10-20 cm H20"
      },
      {
        "id": 200055,
        "text": "10-20 mm Hg"
      }
    ],
    "text": "At what pressure does the marked structure open?<p><img src=\"https://d2enu63wt1sf3u.cloudfront.net/ckfinder/files/Picture16(6).jpg\" alt=\"Question Image\"></p>",
    "unique_key": "Q1563898",
    "question_audio": null,
    "question_video": null,
    "map_id": 34461648,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (A) 30-40 cm H?O): The marked structure opens at a pressure of 30-40 cm H?O. This is a commonly observed range for certain physiological valves, such as the lower esophageal sphincter or structures in the respiratory system like alveolar collapse pressures. The unit cm H?O is often used in clinical and physiological measurements because it relates directly to pressures exerted by fluids or gases in the body. The value 30-40 cm H?O is consistent with the threshold pressure needed to open structures under specific physiological conditions, ensuring they can function properly without damage or inefficiency. Incorrect Answer Explanations: B: 30-40 mm Hg: This pressure is significantly higher than 30-40 cm H?O because 1 mm Hg equals approximately 1.36 cm H?O. Converting 30-40 mm Hg to cm H?O gives a range of 40.8-54.4 cm H?O, which is much higher than the actual opening pressure of the marked structure. Thus, this option is incorrect as it represents a physiologically inappropriate range for the described structure. C: 10-20 cm H?O: While this range is expressed in the correct units, the values are too low for the marked structure to open. This pressure range might apply to other physiological events, such as the pressure required to maintain open airways during mechanical ventilation or CPAP therapy, but it is insufficient for the structure described in the question. D: 10-20 mm Hg: This range is both too low and expressed in the wrong unit. When converted to cm H?O, 10-20 mm Hg equals 13.6-27.2 cm H?O, which is still below the necessary pressure of 30-40 cm H?O. This makes the option doubly incorrect due to the inappropriate range and unit mismatch.",
    "correct_choice_id": 200052,
    "solution_audio": null,
    "solution_video": "",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50014,
    "choices": [
      {
        "id": 200056,
        "text": "Miller"
      },
      {
        "id": 200057,
        "text": "Macintosh"
      },
      {
        "id": 200058,
        "text": "Wisconsin"
      },
      {
        "id": 200059,
        "text": "Magill"
      }
    ],
    "text": "You are the 2nd year Anaesthesia PG on call. You are paged to the COVID ICU. A 50 year old patient who was on non-invasive ventilation is desaturating rapidly. The anaesthetist instructs you to intubate the patient with an endotracheal tube. What is the most commonly used laryngoscopic blade for this procedure?",
    "unique_key": "Q7905486",
    "question_audio": null,
    "question_video": null,
    "map_id": 34109284,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (B) Macintosh The Macintosh blade is the most commonly used laryngoscopic blade for intubation in adults, including critically ill patients in the ICU. It is a curved blade that provides an indirect view of the vocal cords by lifting the epiglottis with the blade's tip placed in the vallecula. This design allows better visualization of the glottis, especially in challenging situations like rapid desaturation. The curved blade is particularly useful in patients with normal or moderately difficult airways, as it minimizes soft tissue trauma and improves intubation success rates. Its widespread availability and familiarity among anesthetists further make it the preferred choice in emergency intubations, including in a COVID ICU. Incorrect Answer Explanations: A: Miller: The Miller blade is a straight laryngoscopic blade designed to directly lift the epiglottis. While it is commonly used for pediatric patients, where the epiglottis is relatively larger and more floppy, it is less frequently used in adults. In emergencies or when rapid intubation is required, such as in the COVID ICU, the Macintosh blade's curved design often provides better visualization of the vocal cords compared to the Miller blade in adult patients. C: Wisconsin: The Wisconsin blade is a straight blade similar to the Miller but with a broader flange. It is not as commonly used as the Macintosh blade for adult intubations, particularly in emergency or ICU settings. Its primary use has historically been in pediatric anesthesia, but even there, it has been largely replaced by the Miller blade. D: Magill: The Magill blade is an older design and is rarely used in modern practice. It lacks the specific advantages provided by the Macintosh blade, such as the indirect lifting of the epiglottis or ease of use in emergency intubations. Its limited utility and obsolescence make it an incorrect choice for this scenario.",
    "correct_choice_id": 200057,
    "solution_audio": null,
    "solution_video": "",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50015,
    "choices": [
      {
        "id": 200060,
        "text": "20%"
      },
      {
        "id": 200061,
        "text": "40\u2105"
      },
      {
        "id": 200062,
        "text": "60%"
      },
      {
        "id": 200063,
        "text": "100\u2105"
      }
    ],
    "text": "What is the maximum oxygen concentration delivered by a venturi mask?",
    "unique_key": "Q5710841",
    "question_audio": null,
    "question_video": null,
    "map_id": 34205402,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (C) 60% The maximum oxygen concentration delivered by a Venturi mask is 60%. A Venturi mask is a high-flow oxygen delivery device that delivers a precise and fixed concentration of oxygen regardless of the patient\u2019s respiratory rate or tidal volume. It achieves this by utilizing the Venturi effect, where a specific-sized jet orifice creates a mixture of oxygen and entrained room air. This device is commonly used in patients with chronic obstructive pulmonary disease (COPD) or other conditions requiring accurate oxygen delivery. The 60% oxygen concentration is the upper limit achievable with a Venturi mask, and it provides reliable oxygenation without the risk of CO? retention associated with higher concentrations in patients prone to hypercapnia. Incorrect Answer Explanations: A: 20%: This concentration is incorrect as 20% is close to the ambient air oxygen concentration (21%) and not a therapeutic oxygen concentration delivered by a Venturi mask. Venturi masks are designed to deliver oxygen concentrations ranging from 24% to 60%, with 20% falling below this range. B: 40%: While 40% is a possible oxygen concentration delivered by a Venturi mask, it is not the maximum. Venturi masks can deliver oxygen concentrations of 24%, 28%, 31%, 35%, 40%, 50%, and up to 60%. Therefore, this option does not reflect the maximum limit. D: 100%: A Venturi mask cannot deliver 100% oxygen because it mixes oxygen with room air. To achieve 100% oxygen, devices like a non-rebreather mask or high-flow nasal cannula are used. The Venturi mask\u2019s design limits its maximum oxygen delivery to 60%, making this option incorrect.",
    "correct_choice_id": 200062,
    "solution_audio": null,
    "solution_video": "",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50016,
    "choices": [
      {
        "id": 200064,
        "text": "Intubation using Miller\u2019s blade"
      },
      {
        "id": 200065,
        "text": "Needle cricothyrotomy"
      },
      {
        "id": 200066,
        "text": "Intubation using Macintosh blade"
      },
      {
        "id": 200067,
        "text": "Percutaneous transtracheal jet ventilation"
      }
    ],
    "text": "A 6 year old child, was brought to the ER by her parents with a history of fever, cough, and body pain for the past 3 days. On examination, she was lethargic and had difficulty in breathing. She was desaturating despite trying non-invasive positive pressure ventilation. What is the most appropriate next step of management in this scenario?",
    "unique_key": "Q3629267",
    "question_audio": null,
    "question_video": null,
    "map_id": 34907434,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (A) Intubation using Miller\u2019s blade The most appropriate next step in managing a 6-year-old child with respiratory distress, lethargy, and desaturation is intubation using a Miller blade. The Miller blade is a straight laryngoscopic blade that is particularly well-suited for pediatric patients. Unlike adults, children have a larger and more floppy epiglottis, which can obstruct the view of the vocal cords. The straight Miller blade is designed to directly lift the epiglottis, providing a clear view of the glottic opening, which is critical during pediatric intubation. In emergency situations where non-invasive ventilation is insufficient, securing the airway with endotracheal intubation ensures adequate oxygenation and ventilation, making this the most appropriate intervention. Incorrect Answer Explanations: B: Needle cricothyrotomy: Needle cricothyrotomy is an emergency procedure used when intubation and ventilation are not possible, typically in \"cannot intubate, cannot ventilate\" scenarios. In this case, intubation is still feasible, and the child\u2019s anatomy is more favorable for intubation than for cricothyrotomy. Additionally, cricothyrotomy in children can be challenging due to their small anatomy and the higher position of the cricoid cartilage. This makes this option incorrect for the given scenario. C: Intubation using Macintosh blade: The Macintosh blade, a curved laryngoscopic blade, is commonly used for intubation in adults. However, it is less effective in pediatric patients due to their unique airway anatomy, particularly the larger and more anteriorly positioned epiglottis. While the Macintosh blade can sometimes be used in older children, the Miller blade is generally preferred in young children because it directly lifts the epiglottis, making intubation easier and safer. D: Percutaneous transtracheal jet ventilation: Percutaneous transtracheal jet ventilation is an advanced airway technique used as a temporary measure in emergency situations where neither intubation nor cricothyrotomy is possible. It is not a first-line intervention for this patient, as intubation is still possible and is the safer, more effective option to secure the airway and provide adequate oxygenation and ventilation. This makes it inappropriate in this context.",
    "correct_choice_id": 200064,
    "solution_audio": null,
    "solution_video": "",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50017,
    "choices": [
      {
        "id": 200068,
        "text": "Requiring inspiratory oxygen flow rate of 45 L/min"
      },
      {
        "id": 200069,
        "text": "Minute ventilation of 8 L/min"
      },
      {
        "id": 200070,
        "text": "Respiratory rate at 15 breaths/min"
      },
      {
        "id": 200071,
        "text": "Tidal volume less than 0.8 L"
      }
    ],
    "text": "In which of the following situations should nasal cannula be avoided?",
    "unique_key": "Q8172952",
    "question_audio": null,
    "question_video": null,
    "map_id": 34461097,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (A) Requiring inspiratory oxygen flow rate of 45 L/min): Nasal cannula should be avoided when a patient requires an inspiratory oxygen flow rate of 45 L/min. The nasal cannula delivers low-flow oxygen at rates typically between 1-6 L/min, providing a FiO? (fraction of inspired oxygen) of approximately 24-40%. It cannot meet the high inspiratory flow demands of 45 L/min, which far exceed its delivery capacity. In such cases, a high-flow oxygen device like a high-flow nasal cannula (HFNC), Venturi mask, or non-rebreather mask is more appropriate to ensure adequate oxygenation and prevent hypoxia. Incorrect Answer Explanations: B: Minute ventilation of 8 L/min: A nasal cannula can adequately support patients with a minute ventilation of 8 L/min, as this value falls within the typical range for an adult at rest (approximately 6-8 L/min). The nasal cannula can provide sufficient supplemental oxygen for this level of ventilation, making it a suitable option. Therefore, this is not a contraindication for its use. C: Respiratory rate at 15 breaths/min: A respiratory rate of 15 breaths/min is within the normal range for adults (12-20 breaths/min). The nasal cannula can effectively deliver oxygen to patients with this respiratory rate, provided their overall oxygen needs remain within the device\u2019s capability. This option does not indicate a situation where a nasal cannula should be avoided. D: Tidal volume less than 0.8 L: A tidal volume of less than 0.8 L (800 mL) is within the normal range for adults, where the average tidal volume is approximately 0.5-0.8 L. The nasal cannula can support oxygen delivery at this tidal volume without issues, as long as the patient\u2019s oxygen demand is not excessively high. Thus, this does not represent a limitation of the nasal cannula.",
    "correct_choice_id": 200068,
    "solution_audio": null,
    "solution_video": "",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50018,
    "choices": [
      {
        "id": 200072,
        "text": "Has a port for orogastric tube"
      },
      {
        "id": 200073,
        "text": "Can facilitate endotracheal intubation"
      },
      {
        "id": 200074,
        "text": "Ideal for infants alone"
      },
      {
        "id": 200075,
        "text": "Suction tube to remove secretions"
      }
    ],
    "text": "What is the advantage of the following device?<p><img src=\"https://d2enu63wt1sf3u.cloudfront.net/ckfinder/files/Picture17(4).jpg\" alt=\"Question Image\"></p>",
    "unique_key": "Q7653900",
    "question_audio": null,
    "question_video": null,
    "map_id": 34622063,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (B) Can facilitate endotracheal intubation): The device in question likely refers to a laryngeal mask airway (LMA) or a similar airway management tool, which is commonly used in anesthesia and emergency medicine. One of the key advantages of the LMA or similar devices is that they can facilitate endotracheal intubation. The device itself may not be used for intubation directly but can create a secure airway to improve visualization or provide a pathway for endotracheal tubes to be passed more easily, especially in cases where direct laryngoscopy might be difficult. This advantage makes the device particularly useful in emergency situations or when intubation is challenging. Incorrect Answer Explanations: A: Has a port for orogastric tube: While some airway devices, like certain types of endotracheal tubes or LMAs, might have ports to allow for the placement of an orogastric tube, this is not typically the primary advantage of the device in question. The inclusion of such a port is a secondary feature rather than the main benefit. The device\u2019s main function is to secure the airway, not to facilitate the insertion of an orogastric tube. C: Ideal for infants alone: This option is incorrect because the device is not necessarily ideal only for infants. Many airway devices, including LMAs, are designed for both pediatric and adult patients, with size variations to accommodate different age groups. While there are specific devices for neonates and infants, the device in question likely has broader applications. D: Suction tube to remove secretions: Although suctioning secretions is an important aspect of airway management, the primary function of the device in this context is to secure the airway rather than to perform suctioning. The suction tube would be a secondary accessory used in conjunction with the device for maintaining the airway, but it is not the key advantage of the device itself. The ability to facilitate intubation remains the more significant feature.",
    "correct_choice_id": 200073,
    "solution_audio": null,
    "solution_video": "",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50019,
    "choices": [
      {
        "id": 200076,
        "text": "Nasopharyngeal airway"
      },
      {
        "id": 200077,
        "text": "Laryngoscope"
      },
      {
        "id": 200078,
        "text": "Bronchoscope"
      },
      {
        "id": 200079,
        "text": "Endotracheal tube"
      }
    ],
    "text": "In which of the following devices is Murphy\u2019s eye seen?",
    "unique_key": "Q6470431",
    "question_audio": null,
    "question_video": null,
    "map_id": 34931986,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (D) Endotracheal tube): Murphy\u2019s eye is a small opening found on the side of an endotracheal tube near the distal tip, opposite to the main lumen. The purpose of Murphy\u2019s eye is to serve as a safety feature in case the primary lumen becomes occluded or blocked. It allows air to bypass the obstruction, ensuring continued airflow into the patient's airway. This feature is commonly found on cuffed endotracheal tubes, making it an essential part of airway management in various clinical settings. Incorrect Answer Explanations: A: Nasopharyngeal airway: A nasopharyngeal airway is a device used to maintain an open airway in patients, typically by inserting it through the nostrils into the pharynx. It does not have a Murphy\u2019s eye. The device is a simple tube and does not include the specialized design features seen in endotracheal tubes, such as the Murphy\u2019s eye for bypassing obstructions. B: Laryngoscope: A laryngoscope is used for visualizing the vocal cords and facilitating intubation. It does not contain any openings similar to the Murphy\u2019s eye. The laryngoscope is a blade or handle used during airway management, but it is not a tube that would have a secondary opening like the Murphy's eye. C: Bronchoscope: A bronchoscope is a medical instrument used to view the airways and lungs. It typically has a camera or light source for visualization, but it does not have a Murphy\u2019s eye. The bronchoscope is a diagnostic tool rather than a device for securing an airway, so it does not need a safety feature like the Murphy\u2019s eye found in endotracheal tubes.",
    "correct_choice_id": 200079,
    "solution_audio": null,
    "solution_video": "",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50020,
    "choices": [
      {
        "id": 200080,
        "text": "LMA ProSeal"
      },
      {
        "id": 200081,
        "text": "LMA Supreme"
      },
      {
        "id": 200082,
        "text": "Classic LMA"
      },
      {
        "id": 200083,
        "text": "Fastrach LMA"
      }
    ],
    "text": "A 36-year-old female patient is posted for laparoscopic cholecystectomy. She forgot the instruction of being nil per oral and had breakfast a few hours back. The anesthetist decides to use the device shown below to reduce the risk of gastric aspiration. Identify the device used.<p><img src=\"https://d2enu63wt1sf3u.cloudfront.net/ckfinder/files/Picture18(3).jpg\" alt=\"Question Image\"></p>",
    "unique_key": "Q2424427",
    "question_audio": null,
    "question_video": null,
    "map_id": 34879158,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (B) LMA Supreme The LMA Supreme is a supraglottic airway device specifically designed to reduce the risk of gastric aspiration, especially in patients who are at risk of regurgitation, such as those who have had recent oral intake. It features an integrated gastric access port, allowing for gastric decompression (suctioning of gastric contents), and is a more secure option compared to other basic LMAs. This additional feature of providing a pathway for stomach contents to be aspirated safely helps minimize the risk of aspiration during general anesthesia. The LMA Supreme is particularly useful in laparoscopic procedures like cholecystectomy, where insufflation of the abdomen can increase the risk of aspiration. Incorrect Answer Explanations: A: LMA ProSeal: The LMA ProSeal is a supraglottic airway device that also provides a better seal than the Classic LMA, but it does not have an integrated gastric access port like the LMA Supreme. While the ProSeal LMA can help with airway management and reduce the risk of aspiration, it does not offer the same level of gastric decompression, making it slightly less optimal for patients who are at high risk of aspiration due to recent oral intake. C: Classic LMA: The Classic LMA is one of the oldest supraglottic airway devices, but it does not provide any features for gastric decompression or protection against aspiration. It has a basic cuff design for sealing the airway but is not designed to actively protect against gastric aspiration in high-risk situations, such as in patients who have eaten recently before surgery. D: Fastrach LMA: The Fastrach LMA is primarily used for facilitating intubation rather than for preventing gastric aspiration. It is a device designed to enable the easy passage of an endotracheal tube in difficult airway situations, but it does not have the specific features for gastric drainage or aspiration protection found in the LMA Supreme, making it less appropriate in this scenario.",
    "correct_choice_id": 200081,
    "solution_audio": null,
    "solution_video": "",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50021,
    "choices": [
      {
        "id": 200084,
        "text": "Magill\u2019s circuit"
      },
      {
        "id": 200085,
        "text": "Ayre\u2019s T piece"
      },
      {
        "id": 200086,
        "text": "Water\u2019s to and fro circuit"
      },
      {
        "id": 200087,
        "text": "Jackson Rees circuit"
      }
    ],
    "text": "You are an anaesthesia resident posted in the pediatrics OT. A spontaneously breathing 6 year old child is set to undergo a minor elective procedure. Which of the following circuits would be the best choice for ventilating this patient?",
    "unique_key": "Q2542269",
    "question_audio": null,
    "question_video": null,
    "map_id": 34719189,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (D) Jackson Rees circuit The Jackson Rees circuit is the best choice for ventilating a spontaneously breathing 6-year-old child undergoing a minor elective procedure. It is a popular pediatric circuit used in anesthesia for spontaneous ventilation, especially in children. The Jackson Rees circuit is simple, effective, and allows the child to breathe spontaneously while still providing a safe and controlled airway. The circuit consists of a flexible, non-rebreathing system with a reservoir bag and an adjustable pressure relief valve, making it well-suited for pediatric patients. It also allows easy adjustment of oxygen delivery and is widely used in pediatric anesthesia for minor procedures, as it is efficient and safe for children. Incorrect Answer Explanations: A: Magill\u2019s circuit: The Magill\u2019s circuit is typically used for controlled ventilation in patients requiring general anesthesia, especially when mechanical ventilation is necessary. It is not typically used for spontaneously breathing patients, as it is designed for patients who are either intubated or require more intensive ventilation support. In this case, since the child is spontaneously breathing, a circuit like the Jackson Rees is more appropriate. B: Ayre\u2019s T piece: The Ayre\u2019s T piece is a simple circuit used for spontaneous ventilation, but it is generally better suited for neonates and very young children. While it could be used for a 6-year-old child, it is less versatile and comfortable than the Jackson Rees circuit, which offers more control over oxygen delivery and pressure relief, making the Jackson Rees the more appropriate choice for a 6-year-old. C: Water\u2019s to and fro circuit: The Water\u2019s to and fro circuit is a type of rebreathing circuit that is rarely used in modern pediatric anesthesia. It is typically reserved for specific situations requiring rebreathing, but it does not offer the same ease of use and safety features for spontaneously breathing children as the Jackson Rees circuit. The system is more complex and less efficient for minor procedures, which makes it less ideal in this context.",
    "correct_choice_id": 200087,
    "solution_audio": null,
    "solution_video": "",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50022,
    "choices": [
      {
        "id": 200088,
        "text": "22G Quincke"
      },
      {
        "id": 200089,
        "text": "22G Whitacre"
      },
      {
        "id": 200090,
        "text": "25G Quincke"
      },
      {
        "id": 200091,
        "text": "25G Whitacre"
      }
    ],
    "text": "You are planning to administer spinal anesthesia to a young female. Which of the following needles would be the least suitable for reducing the risk of a post-dural puncture headache?",
    "unique_key": "Q4999025",
    "question_audio": null,
    "question_video": null,
    "map_id": 34391065,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (A) 22G Quincke The 22G Quincke needle is the least suitable for reducing the risk of a post-dural puncture headache (PDPH). The Quincke needle is a cutting needle, and it has a bevel that can create a larger hole in the dura, which increases the likelihood of cerebrospinal fluid (CSF) leakage. The larger the hole, the higher the risk of developing a post-dural puncture headache. Larger needles, such as the 22G Quincke, are more likely to cause a significant disruption to the dura, leading to greater CSF loss and increased risk of PDPH. Therefore, this needle is considered less suitable for minimizing this risk. Incorrect Answer Explanations: B: 22G Whitacre: The 22G Whitacre needle is a non-cutting (pencil-point) needle, which causes less damage to the dura compared to cutting needles like the Quincke. The pencil-point design allows for a smaller hole and is less likely to lead to CSF leakage, significantly reducing the risk of post-dural puncture headache. While the 22G size is still relatively large, it is a safer option compared to cutting needles. C: 25G Quincke: The 25G Quincke needle is a smaller cutting needle than the 22G Quincke, but it is still a cutting needle, meaning it carries a higher risk of creating a larger hole in the dura compared to non-cutting needles. While the smaller gauge reduces the risk compared to a 22G Quincke, it still presents a higher risk for PDPH than non-cutting needles like the Whitacre. D: 25G Whitacre: The 25G Whitacre needle is the best option for reducing the risk of a post-dural puncture headache. It is a small, non-cutting (pencil-point) needle, which causes minimal trauma to the dura and results in a smaller puncture site. This significantly reduces the risk of CSF leakage and the subsequent development of PDPH. The 25G Whitacre needle is considered the gold standard for spinal anesthesia in terms of minimizing this complication.",
    "correct_choice_id": 200088,
    "solution_audio": null,
    "solution_video": "",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50023,
    "choices": [
      {
        "id": 200092,
        "text": "Intubating LMA"
      },
      {
        "id": 200093,
        "text": "Proseal LMA"
      },
      {
        "id": 200094,
        "text": "Flexible LMA"
      },
      {
        "id": 200095,
        "text": "Ambu LMA"
      }
    ],
    "text": "Which of the following is a 2nd generation LMA device? LMA-Laryngeal mask airway",
    "unique_key": "Q6944726",
    "question_audio": null,
    "question_video": null,
    "map_id": 34567596,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (B) Proseal LMA The Proseal LMA is a second-generation laryngeal mask airway device. It was developed to improve upon the basic design of the first-generation LMA by providing a better seal, allowing for a higher ventilation pressure and more effective protection against gastric aspiration. The Proseal LMA features an integrated gastric access port for suctioning, further enhancing its safety profile by reducing the risk of aspiration during anesthesia. It also has a more secure fit and a better seal around the glottic opening, making it a popular choice in clinical practice for providing positive pressure ventilation. Incorrect Answer Explanations: A: Intubating LMA: The Intubating LMA is not considered a second-generation device. It is designed for facilitating endotracheal intubation, and while it is an advanced version of the LMA, it is primarily used as an airway device to help pass an endotracheal tube, rather than offering the same features for airway protection and sealing as the Proseal LMA. The Intubating LMA falls under a different category, focusing on enabling intubation rather than improving airway sealing or reducing aspiration risk. C: Flexible LMA: The Flexible LMA is a specialized device designed to provide a more flexible and adaptable airway option, but it is still a first-generation LMA. It is used primarily in patients with difficult airways or where a conventional LMA cannot be easily inserted. While it is a helpful device, it does not offer the additional features, like a gastric access port or improved sealing, that are characteristic of second-generation devices like the Proseal LMA. D: Ambu LMA: The Ambu LMA is a commercially available LMA that can be used in a variety of settings, but it is also a first-generation device. It does not have the advanced features of second-generation LMAs, such as a gastric drainage port or superior sealing properties. It is a basic airway management device and does not provide the enhanced safety features of a second-generation LMA like the Proseal.",
    "correct_choice_id": 200093,
    "solution_audio": null,
    "solution_video": "",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50024,
    "choices": [
      {
        "id": 200096,
        "text": "Mapleson A"
      },
      {
        "id": 200097,
        "text": "Mapleson B"
      },
      {
        "id": 200098,
        "text": "Mapleson C"
      },
      {
        "id": 200099,
        "text": "Mapleson D"
      }
    ],
    "text": "A 25-year-old athlete with left apical primary spontaneous pneumothorax was posted for thoracoscopic bullectomy under anesthesia with spontaneous ventilation. Which of the following breathing circuits would be the most effective for this purpose?",
    "unique_key": "Q2158666",
    "question_audio": null,
    "question_video": null,
    "map_id": 34234326,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (A) Mapleson A The Mapleson A circuit is the most effective breathing circuit for spontaneous ventilation in a patient undergoing thoracoscopic bullectomy. This circuit allows for adequate support of spontaneous breathing while minimizing the risk of carbon dioxide retention, which is important in a patient with a pneumothorax. The Mapleson A circuit, also known as the \"Magill\" circuit, has an efficient design for spontaneous ventilation and is particularly useful in patients where precise control of the airway and ventilation is needed. It provides a good balance between delivering oxygen and expelling exhaled gases, reducing the risk of CO? buildup, which is critical during thoracoscopic surgery. Incorrect Answer Explanations: B: Mapleson B: The Mapleson B circuit is not as effective for spontaneous ventilation as the Mapleson A. While it still allows for spontaneous breathing, the design of Mapleson B is less efficient in eliminating exhaled CO? compared to the Mapleson A. This can result in higher CO? retention, which is undesirable, especially in patients with a pneumothorax. It is better suited for controlled ventilation rather than spontaneous ventilation during thoracoscopic surgery. C: Mapleson C: The Mapleson C circuit is less commonly used and not ideal for spontaneous ventilation in a patient with a pneumothorax. It is designed for controlled ventilation, not for spontaneous breathing. In a spontaneous ventilation setup, the lack of an efficient expiratory valve in the Mapleson C circuit may lead to inadequate removal of exhaled CO?, contributing to CO? retention, which is not optimal during a thoracoscopic procedure. D: Mapleson D: The Mapleson D circuit is primarily used for controlled ventilation and is not suitable for spontaneous ventilation. The circuit does not provide optimal support for a patient who is breathing spontaneously, as it lacks the features necessary to efficiently manage the inhalation and exhalation of gases for a spontaneously breathing patient. It is generally used in controlled ventilation settings or when intubation is required, making it less effective for spontaneous ventilation during thoracoscopic surgery.",
    "correct_choice_id": 200096,
    "solution_audio": null,
    "solution_video": "",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50025,
    "choices": [
      {
        "id": 200100,
        "text": "5 L/min"
      },
      {
        "id": 200101,
        "text": "15 L/min"
      },
      {
        "id": 200102,
        "text": "10 L/min"
      },
      {
        "id": 200103,
        "text": "20 L/min"
      }
    ],
    "text": "The maximum oxygen flow rate which can be kept with a conventional oxygen mask is",
    "unique_key": "Q8024110",
    "question_audio": null,
    "question_video": null,
    "map_id": 34585882,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (C) 10 L/min The maximum oxygen flow rate that can be kept with a conventional oxygen mask is 10 L/min. At flow rates higher than this, the mask may not effectively provide an adequate seal around the face, leading to increased risk of oxygen loss and inadequate oxygen delivery. Conventional oxygen masks are designed to deliver a steady flow of oxygen at rates generally between 5 to 10 L/min. At this level, the mask can effectively provide high levels of oxygen while maintaining proper ventilation. Incorrect Answer Explanations: A: 5 L/min: While 5 L/min is a common and safe oxygen flow rate for conventional oxygen masks, it is lower than the maximum possible flow rate. At this flow rate, the mask can still provide oxygen effectively, but it is not the highest possible setting. The maximum rate is typically around 10 L/min for conventional masks. B: 15 L/min: A flow rate of 15 L/min is too high for a conventional oxygen mask. At this rate, the mask will struggle to maintain an effective seal, and oxygen may leak around the edges. This leads to ineffective oxygen delivery, and it may not achieve the intended therapeutic effect, especially in patients requiring higher concentrations of oxygen. D: 20 L/min: 20 L/min is even higher than 15 L/min and is not suitable for use with a conventional oxygen mask. At this flow rate, it becomes difficult for the mask to provide a proper seal around the patient\u2019s face, causing excessive oxygen loss and reducing the efficiency of oxygen delivery. This flow rate is typically used with more specialized equipment, such as non-rebreather masks or high-flow nasal cannula systems.",
    "correct_choice_id": 200102,
    "solution_audio": null,
    "solution_video": "",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50026,
    "choices": [
      {
        "id": 200104,
        "text": "Retrobulbar block"
      },
      {
        "id": 200105,
        "text": "Epidural anesthesia"
      },
      {
        "id": 200106,
        "text": "Spinal anesthesia"
      },
      {
        "id": 200107,
        "text": "Combined spinal epidural anesthesia"
      }
    ],
    "text": "In which procedure is the instrument shown in the image most commonly used?<p><img src=\"https://d2enu63wt1sf3u.cloudfront.net/ckfinder/files/Picture19(2).jpg\" alt=\"Question Image\"></p>",
    "unique_key": "Q5571369",
    "question_audio": null,
    "question_video": null,
    "map_id": 34357566,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (C) Spinal anesthesia The instrument most commonly associated with spinal anesthesia is a spinal needle, which is used to inject anesthetic agents into the subarachnoid space, typically at the L3-L4 or L4-L5 intervertebral space. Spinal anesthesia involves placing a needle through the dura mater to deliver the anesthetic directly to the cerebrospinal fluid, which provides rapid and effective regional anesthesia. This type of needle is typically thin, long, and specialized for precise placement to avoid damage to the surrounding tissues. Incorrect Answer Explanations: A: Retrobulbar block: A retrobulbar block is an eye block used for cataract or other ocular surgeries, typically involving a retrobulbar needle. This needle is used to inject local anesthetic behind the eye, near the optic nerve. It differs from the spinal needle in both design and function, as it is intended for the ocular region rather than the spinal column. B: Epidural anesthesia: Epidural anesthesia also uses a needle, but it is specifically designed for access to the epidural space, which is outside the dura mater. Epidural needles are typically longer and have a more curved design compared to spinal needles. Epidural anesthesia provides regional anesthesia by delivering the anesthetic into the epidural space, not directly into the cerebrospinal fluid. D: Combined spinal epidural anesthesia: In combined spinal epidural anesthesia (CSEA), both a spinal needle and an epidural needle are used. The spinal needle is used to inject the anesthetic into the subarachnoid space, and the epidural needle is placed in the epidural space for the continuous delivery of anesthetic. While this procedure does involve both needles, the spinal needle is the one directly responsible for the anesthesia in the subarachnoid space.",
    "correct_choice_id": 200106,
    "solution_audio": null,
    "solution_video": "",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50027,
    "choices": [
      {
        "id": 200108,
        "text": "20 cm H20"
      },
      {
        "id": 200109,
        "text": "40 cm H20"
      },
      {
        "id": 200110,
        "text": "60 cm H20"
      },
      {
        "id": 200111,
        "text": "100 cm H2O"
      }
    ],
    "text": "What is the maximum pressure allowed in an anesthesia reservoir bag?",
    "unique_key": "Q8854621",
    "question_audio": null,
    "question_video": null,
    "map_id": 34507757,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (C) 60 cm H20 The maximum pressure allowed in an anesthesia reservoir bag is 60 cm H20. This pressure is considered safe for most anesthesia machines and allows for appropriate ventilation without the risk of causing damage to the patient's lungs. It ensures that sufficient pressure is applied to deliver an adequate tidal volume while avoiding excessive pressure that could lead to barotrauma or other complications. The 60 cm H2O pressure limit is generally recognized as the upper threshold for safe operation in most anesthesia systems. Incorrect Answer Explanations: A: 20 cm H20: A pressure of 20 cm H2O is too low for effective ventilation with an anesthesia reservoir bag. While low pressures are safer in preventing barotrauma, this level is insufficient to provide adequate ventilation or lung expansion in most cases. In general, a higher pressure (such as 60 cm H2O) is required to deliver the necessary tidal volume for adequate gas exchange during anesthesia. B: 40 cm H20: A pressure of 40 cm H2O is more than enough to ensure adequate ventilation in most patients, but it is still below the maximum safe limit of 60 cm H2O. While 40 cm H2O might be acceptable for certain situations, this is still lower than the maximum safe pressure allowed in the system, which is 60 cm H2O. D: 100 cm H2O: A pressure of 100 cm H2O is excessively high and is well above the safe maximum pressure for an anesthesia reservoir bag. Exceeding 60 cm H2O can result in barotrauma, which may cause damage to the patient\u2019s lungs, particularly when under anesthesia. This level of pressure should be avoided to prevent potential harm to the respiratory system.",
    "correct_choice_id": 200110,
    "solution_audio": null,
    "solution_video": "",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50028,
    "choices": [
      {
        "id": 200112,
        "text": "Bornholm tubes"
      },
      {
        "id": 200113,
        "text": "Pascal tubes"
      },
      {
        "id": 200114,
        "text": "Thorpe tubes"
      },
      {
        "id": 200115,
        "text": "Morton tubes"
      }
    ],
    "text": "What is another name for the flow tubes used in rotameters?",
    "unique_key": "Q9090921",
    "question_audio": null,
    "question_video": null,
    "map_id": 34994904,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (C) Thorpe tubes The flow tubes used in rotameters are commonly known as Thorpe tubes. Thorpe tubes are calibrated glass tubes used in flow meters to measure the flow rate of gases. The principle behind the rotameter is that the gas flow moves a float (or bob) inside the tube. The position of the float corresponds to the flow rate, and these tubes are used in many medical devices, such as anesthesia machines, to regulate and monitor gas flow. The term \"Thorpe tube\" is often used interchangeably with \"rotameter,\" referring specifically to the flow tube component. Incorrect Answer Explanations: A: Bornholm tubes: Bornholm tubes are not associated with flow meters or rotameters. This term is not widely recognized in the context of gas flow measurement and has no relevance to the function of rotameters. Bornholm is a location in Denmark, and the term is not used in this particular context. B: Pascal tubes: Pascal tubes do not refer to any type of flow measurement tube used in medical or gas flow contexts. The term \"Pascal\" is associated with a unit of pressure (Pascal's law) rather than a specific type of flow tube. Thus, it is not relevant to rotameters or gas flow measurement. D: Morton tubes: Morton tubes are also not recognized in the context of flow measurement in rotameters. This term does not have any established connection to the design or function of flow tubes in rotameters. The correct term remains Thorpe tube for these types of flow measurement devices.",
    "correct_choice_id": 200114,
    "solution_audio": null,
    "solution_video": "",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50029,
    "choices": [
      {
        "id": 200116,
        "text": "Spinal anesthesia"
      },
      {
        "id": 200117,
        "text": "Epidural anesthesia"
      },
      {
        "id": 200118,
        "text": "Combined spinal epidural anesthesia"
      },
      {
        "id": 200119,
        "text": "IV cannulation"
      }
    ],
    "text": "As an intern posted in the OT, you see the Anesthesia Senior Resident holding the needle shown in the image. What is the likely procedure that he is about to perform?<p><img src=\"https://d2enu63wt1sf3u.cloudfront.net/ckfinder/files/Picture20(2).jpg\" alt=\"Question Image\"></p>",
    "unique_key": "Q8522826",
    "question_audio": null,
    "question_video": null,
    "map_id": 34341590,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (B) Epidural anesthesia): The needle most likely associated with epidural anesthesia is a larger, curved, and blunt-tipped needle specifically designed to access the epidural space. This needle typically has a depth marker to guide its placement and a larger diameter compared to spinal needles. Epidural anesthesia involves injecting local anesthetic into the epidural space outside the dura mater, and the needle is typically inserted between the lumbar vertebrae. This needle design is essential for ensuring correct placement without puncturing the dura or causing damage to surrounding structures. Incorrect Answer Explanations: A: Spinal anesthesia: The needle used for spinal anesthesia is typically finer and has a pencil-point tip, which is designed to minimize tissue damage when accessing the subarachnoid space. Spinal anesthesia involves placing the needle into the subarachnoid space to inject local anesthetic directly into the cerebrospinal fluid. The needle for spinal anesthesia is often smaller in diameter and has a different shape compared to the one used for epidural anesthesia. C: Combined spinal epidural anesthesia: For combined spinal epidural anesthesia (CSEA), both a spinal and an epidural needle are used. The spinal needle is smaller and finer for the subarachnoid injection, while the epidural needle is larger for the epidural space. If the needle being used is larger and more curved, as described in the scenario, it is more likely that the procedure being performed is epidural anesthesia rather than CSEA. D: IV cannulation: IV cannulation involves a small, short needle or cannula, typically with a beveled tip, used for inserting into a vein for intravenous access. These needles are much shorter and finer than those used for epidural or spinal anesthesia. An IV cannula is unlikely to be confused with the longer, more specialized needles used for epidural or spinal procedures.",
    "correct_choice_id": 200117,
    "solution_audio": null,
    "solution_video": "",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50030,
    "choices": [
      {
        "id": 200120,
        "text": "Mapleson A"
      },
      {
        "id": 200121,
        "text": "Mapleson B"
      },
      {
        "id": 200122,
        "text": "Mapleson C"
      },
      {
        "id": 200123,
        "text": "Mapleson D"
      }
    ],
    "text": "What is the most effective circuit for anaesthesia under spontaneous breathing?",
    "unique_key": "Q6126454",
    "question_audio": null,
    "question_video": null,
    "map_id": 34753420,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (A) Mapleson A The Mapleson A circuit is the most effective circuit for anesthesia under spontaneous breathing. It is designed to provide efficient ventilation while allowing for minimal resistance during spontaneous breathing. The Mapleson A system is highly effective in ensuring that exhaled gases are adequately removed and fresh gas is delivered to the patient. This circuit is known for having a low resistance to airflow, making it optimal for patients who are breathing on their own. The fresh gas flow is directed into the system to mix with the patient\u2019s inspired air, while expired gases are vented out, promoting effective gas exchange and oxygenation. Incorrect Answer Explanations: B: Mapleson B: The Mapleson B circuit is less effective for spontaneous breathing than the Mapleson A. This circuit is similar to Mapleson A but has a higher resistance to airflow, which makes it less ideal for spontaneous ventilation. It is more suited for controlled ventilation, where the ventilator assists with breathing. C: Mapleson C: The Mapleson C circuit is designed for controlled ventilation and is not ideal for spontaneous breathing. In this circuit, the fresh gas flow is directed through the breathing bag, and expired gases exit through a separate valve. This setup makes it less efficient for spontaneous breathing, as it does not allow for optimal removal of exhaled gases without external ventilation support. D: Mapleson D: The Mapleson D circuit is another circuit that is generally better suited for controlled ventilation rather than spontaneous ventilation. This circuit has a higher resistance to airflow and is less efficient in providing the necessary support for spontaneous breathing. The Mapleson D system is more commonly used in situations where controlled ventilation is required, such as in intubated patients.",
    "correct_choice_id": 200120,
    "solution_audio": null,
    "solution_video": "",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50031,
    "choices": [
      {
        "id": 200124,
        "text": "Longer length"
      },
      {
        "id": 200125,
        "text": "LASER resistance"
      },
      {
        "id": 200126,
        "text": "Less kinking"
      },
      {
        "id": 200127,
        "text": "Double lumen"
      }
    ],
    "text": "A 60-year-old patient is being taken up for a cervical discectomy. The surgeon had planned a posterior approach that required the patient to lie in a prone position under anesthesia. What is the advantage of the armored endotracheal tube required for this procedure?",
    "unique_key": "Q3551637",
    "question_audio": null,
    "question_video": null,
    "map_id": 34282330,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (C) Less kinking The primary advantage of the armored endotracheal tube is its resistance to kinking. When a patient is positioned in the prone position, particularly during procedures like cervical discectomy, the airway is at risk of being compressed or distorted due to the positioning of the head and neck. Armored endotracheal tubes are designed with a flexible, reinforced material (typically metal) that prevents the tube from collapsing or kinking, ensuring an open airway throughout the procedure. This is crucial in maintaining proper ventilation and oxygenation while the patient is in the prone position. Incorrect Answer Explanations: A: Longer length: While armored endotracheal tubes may come in various lengths to suit different patient anatomies, longer length is not a distinguishing feature of these tubes. The primary purpose of an armored tube is to prevent kinking, not to provide additional length. The tube length is generally selected based on the patient's size and the specific surgical requirements. B: LASER resistance: LASER resistance is a feature typically associated with laser-safe endotracheal tubes, which are designed to resist damage from laser energy used during certain surgical procedures, such as those involving the respiratory tract. Armored tubes, while reinforced to prevent kinking, are not designed specifically for LASER protection. LASER-safe tubes are generally made from materials that are non-combustible or have coatings to protect them from heat damage. D: Double lumen: A double lumen endotracheal tube is designed for procedures requiring independent ventilation of each lung, such as thoracic surgeries. It is not typically used in cervical discectomy procedures. The armored endotracheal tube, in contrast, is single-lumen and is used for ensuring the airway remains patent without kinking, not for providing dual ventilation.",
    "correct_choice_id": 200126,
    "solution_audio": null,
    "solution_video": "",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '04  Instrument';
        const quizFilename = '04-instrument-932ffa2d.html';
        let hierarchy = ["DAMS", "DQB", "Anesthesia"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on navigation
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>