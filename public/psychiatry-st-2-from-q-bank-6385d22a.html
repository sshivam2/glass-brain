<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Psychiatry St 2 (From Q-Bank) - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Test Series Subject Wise / Year 2017 - 18
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">50</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "The term \u2018dementia precox\u2019 was given by",
    "choices": [
      {
        "id": 1,
        "text": "Eugen Bleuler"
      },
      {
        "id": 2,
        "text": "Kurt Schneider"
      },
      {
        "id": 3,
        "text": "Emil Kraepelin"
      },
      {
        "id": 4,
        "text": "Sigmund Freud"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Emil Kraepelin gave the <strong>term \u2018Dementia precox</strong>\u2019 while <strong>Eugen Bleuler Coined the term \u2018Schizophrenia\u2019</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Among the following all are the good prognostic factors for Schizophrenia except",
    "choices": [
      {
        "id": 1,
        "text": "Male"
      },
      {
        "id": 2,
        "text": "Age > 35yrs"
      },
      {
        "id": 3,
        "text": "Family history of mood disorders"
      },
      {
        "id": 4,
        "text": "Presence of depression, confusion"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Good prognostic factors for Schizophrenia are:</strong></p>\n<ul>\n<li>Acute or abrupt onset</li>\n<li>Onset after 35 yrs of age</li>\n<li>Presence of precipitating stressor</li>\n<li>Short duration (&lt;6 months)</li>\n<li>Presence of depression</li>\n<li>Predominance of positive symptoms</li>\n<li>Family history of mood disorders</li>\n<li>Female sex</li>\n<li>Good social support</li>\n<li>Presence of confusion, perplexity or disorientation</li>\n<li>Proper treatment</li>\n<li>Normal cranial CT</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 14 year old student was diagnosed with schizophrenia. He was started on risperidone. The patient is responding well. The duration of treatment will be",
    "choices": [
      {
        "id": 1,
        "text": "5 years"
      },
      {
        "id": 2,
        "text": "2 years"
      },
      {
        "id": 3,
        "text": "3 months"
      },
      {
        "id": 4,
        "text": "6 months"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The treatment of schizophrenia is generally continued for 2 years after the first episode.</p>\n<p><strong>Duration of treatment:</strong>\u00a0Duration of treatment depends on a number of factors and will need to be individualized. The suggested guidelines are as follows:<br /><br /></p>\n<ul>\n<li>First-episode patients ought to receive 1-2 years of maintenance treatment</li>\n<li>Patients with several episodes or exacerbations are to receive maintenance treatment for 5 years or longer after the last episode</li>\n<li>Patients with history of aggression or suicide attempts should receive treatment for longer period or lifelong.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 21 year old male who is been treated for schizophrenia is put on haloperidol. A week after the initiation of medication the patient shows restlessness, irritability and cannot sit at one place. The most appropriate treatment strategy is",
    "choices": [
      {
        "id": 1,
        "text": "Increase the dose of haloperidol"
      },
      {
        "id": 2,
        "text": "Addition of anticholinergic drug"
      },
      {
        "id": 3,
        "text": "Addition of beta blocker"
      },
      {
        "id": 4,
        "text": "Adding another antipsychotic drug"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<ul>\n<li>The symptoms of restlessness, irritability and inability to sit at one place a week after initiation of antipsychotic is <strong>\u2018Akathisia\u2019</strong> which is the extrapyramidal side effect of the antipsychotics.</li>\n<li>The most appropriate treatment of this condition is <strong>addition of beta blocker (Propranolol)</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The toxic level of lithium in plasma is",
    "choices": [
      {
        "id": 1,
        "text": "> 1 mEq/L"
      },
      {
        "id": 2,
        "text": ">2 mEq/ L"
      },
      {
        "id": 3,
        "text": ">3 mEq/L"
      },
      {
        "id": 4,
        "text": ">4mEq/L"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Levels of lithium in the body</p>\n<ul>\n<li>Thrapeutic levels: <strong>0.6-1.2mEq/L</strong></li>\n<li>Prophylactic levels: for the prevention of relapse <strong>0.6-1 mEq/L</strong></li>\n<li>Toxic lithium levels: <strong>&gt; 2.0 mEq/L</strong></li>\n</ul>\n<p>Note: While haemodialysis is considered when serum lithium level is 4.0mEq/L and above, signs of lithium toxicity usually start showing when the serum level is &gt; 2.0mEq/L. One should not get confused between the two.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Short lived emotion is known as",
    "choices": [
      {
        "id": 1,
        "text": "Impulse"
      },
      {
        "id": 2,
        "text": "Mood"
      },
      {
        "id": 3,
        "text": "Affect"
      },
      {
        "id": 4,
        "text": "Volition"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>The short-lived emotional respons</strong>e to an idea or event is known as <strong>affect</strong></p>\n<p><strong>Mood is a sustained</strong> and pervasive emotional response which colors the <strong>whole psychic life</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not a risk factor for rapid cycling in bipolar disorder?",
    "choices": [
      {
        "id": 1,
        "text": "Female sex"
      },
      {
        "id": 2,
        "text": "Hypothyroidism"
      },
      {
        "id": 3,
        "text": "Use of antidepressants"
      },
      {
        "id": 4,
        "text": "BPAD 1"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Bipolar affective disorder II</strong> (BPAD II) is a risk factor of <strong>rapid cycling</strong> (not BPAD I).&nbsp;</p>\n<p>Risk factors for developing rapid cycling include:</p>\n<ul>\n<li>Female patients</li>\n<li>Hypothyroidism</li>\n<li>Alcoholism or substance abuse</li>\n<li>Antidepressants (if used without mood stabilizers)</li>\n<li>Cyclothymia</li>\n<li>Bipolar II disorder</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is a mood incongruent delusion seen in depression",
    "choices": [
      {
        "id": 1,
        "text": "Delusion of guilt"
      },
      {
        "id": 2,
        "text": "Delusion of control"
      },
      {
        "id": 3,
        "text": "Delusion of poverty"
      },
      {
        "id": 4,
        "text": "Nilhistic delusion"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Mood congruent delusions</strong>\u00a0are those which correlate with the depressive mood.</p>\n<ul>\n<li>Delusion of poverty</li>\n<li>Nilhistic delusions</li>\n<li>Delusion of guilt</li>\n</ul>\n<p><strong>Mood incongruent delusion</strong>\u00a0are those which cannot be explained with the symptoms of depression. Eg :\u00a0Delusion of control</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Among the following identify the Selective serotonin-norepinephrine reuptake inhibitors",
    "choices": [
      {
        "id": 1,
        "text": "Duloxetine"
      },
      {
        "id": 2,
        "text": "Imipramin"
      },
      {
        "id": 3,
        "text": "Fluoxetine"
      },
      {
        "id": 4,
        "text": "Amitriptyline"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Duloxetine is a selective serotonin-norepinephrine reuptake inhibitor.\u00a0</p>\n<p>Some important Drugs used in depression.</p>\n<p>Selective serotonin reuptake inhibitors (SSRI)</p>\n<ul>\n<li>Fluoxetine</li>\n<li>Fluoxamine</li>\n<li>Paroxetine</li>\n<li>Sertraline</li>\n<li>Escitalopram</li>\n</ul>\n<p>Selective Serotonin Nor epinephrine reuptake inhibitors (SNRI)</p>\n<ul>\n<li>Venlafaxine desvenlafaxine</li>\n<li>Duloxetine</li>\n<li>Milnacipran</li>\n</ul>\n<p>Tricyclic antidepressants</p>\n<ul>\n<li>Imipramine</li>\n<li>Amitriptyline</li>\n<li>Clomipramine</li>\n</ul>\n<p>Unicyclic antidepressants</p>\n<ul>\n<li>Bupropion</li>\n<li>Mirtazapine</li>\n<li>Amoxapine</li>\n<li>Vilazodone</li>\n<li>Maprotiline</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "All of the following are mood stabilizers except",
    "choices": [
      {
        "id": 1,
        "text": "Imipramine"
      },
      {
        "id": 2,
        "text": "Lithium"
      },
      {
        "id": 3,
        "text": "Valproate"
      },
      {
        "id": 4,
        "text": "Carbamazepine"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>These drugs are <strong>effective in preventing the mood swings</strong> in patients with bipolar disorder and hence are known as <strong>mood stabilisers</strong>. They are</p>\n<ul>\n<li>Lithium</li>\n<li>Valproate</li>\n<li>Carbamazepine</li>\n<li>Lamotrigine</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Fear of heights is known as",
    "choices": [
      {
        "id": 1,
        "text": "Claustrophobia"
      },
      {
        "id": 2,
        "text": "Algophobia"
      },
      {
        "id": 3,
        "text": "Acrophobia"
      },
      {
        "id": 4,
        "text": "Xenophobia"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Phobia is defined as <strong>irrational fear of a specific object,</strong> situation or activity often leading to the persistence avoidance of the feared object or situation</p>\n<p>Some special terms</p>\n<ul>\n<li><strong>Acrophobia:</strong> Fear of heights</li>\n<li><strong>Agoraphobia</strong>: Fear of the places from where easy escape is not possible</li>\n<li><strong>Xenophobia</strong>: fear of strangers</li>\n<li><strong>Zoophobia</strong>: fear of animals</li>\n<li><strong>Claustrophobia</strong>: fear of closed spaces</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 25 yr old girl comes to the emergency department with severe anxiety, tremors and feeling of impending doom. Which of the following investigations would be least likely useful?",
    "choices": [
      {
        "id": 1,
        "text": "Thyroid profile"
      },
      {
        "id": 2,
        "text": "Blood sugars"
      },
      {
        "id": 3,
        "text": "Cardiac imaging"
      },
      {
        "id": 4,
        "text": "Serum urea and creatinine"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Differential diagnosis for organic anxiety disorders are</p>\n<ul>\n<li>Hypoglycemia</li>\n<li>Hyperthyroidism</li>\n<li>Pheochromocytoma</li>\n<li>Mitral valve prolapse syndrome</li>\n<li>MI</li>\n</ul>\n<p>Since the above investigations are useful in identifying the above conditions except serum urea and creatinine and hence that becomes the answer.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Y-BOCS scale is used in measuring the severity of",
    "choices": [
      {
        "id": 1,
        "text": "Anxiety"
      },
      {
        "id": 2,
        "text": "Obsessive compulsive disorder"
      },
      {
        "id": 3,
        "text": "Mania"
      },
      {
        "id": 4,
        "text": "Schizophrenia"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Y-BOCS stands for Yale Brown Obsessive compulsive scale.</strong> This is used to elicit the symptomatology and rate the severity of Obsessive compulsive disorder.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A teenage girl was repeatedly sexually abused by her alcoholic family friend. He threatened her of sexual abuse on her sibling if she told anyone about the abuse. The girl became suicidal but felt that she had to stay alive to protect her siblings. So she ran away from home and got into the bus. After 6 hours of journey when the police stopped her and asked her whereabouts she did not remember where she had come from or she could not recall the events. What would be your diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Dissociative amnesia"
      },
      {
        "id": 2,
        "text": "Malingering"
      },
      {
        "id": 3,
        "text": "Dissociative amnesia, with dissociative fugue"
      },
      {
        "id": 4,
        "text": "None of the above"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The above situation describes the <strong>presence of traumatic event following</strong> which <strong>she travels to a new place</strong> and <strong>forgets her initial identity</strong> which is known as <strong>dissociative fugue</strong>.</p>\n<ul>\n<li>According to DSM-5, dissociative fugue is now a specifier of<strong> dissociative amnesia</strong> rather than a separate diagnosis.</li>\n<li>Dissociative fugue is characterized <strong>by episodes of wandering away</strong>. During the episode, the person usually<strong> adopts a new identity </strong>with<strong> complete amnesia of earlier life</strong></li>\n<li>The onset is usually sudden<strong>,</strong> often in the presence of severe stress</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 27 year old woman has nightmare from which she suddenly wakes up. She has frequent flashbacks about the accident where she lost her husband 4 months back and avoids recollecting it. This is",
    "choices": [
      {
        "id": 1,
        "text": "Acute stress reaction"
      },
      {
        "id": 2,
        "text": "Post traumatic stress disorder"
      },
      {
        "id": 3,
        "text": "Hypertrophic grief"
      },
      {
        "id": 4,
        "text": "Delayed grief"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The above scenario depicted is <strong>Post traumatic stress disorder</strong></p>\n<p>This disorder arises as a delayed reaction to a catastrophic life event which is likely to cause pervasive distress in almost any person</p>\n<p>It develops after a period of latency and usually <strong>within 6 months of the event</strong></p>\n<p>It is characterized by <strong>flashback or nightmares of the event with hyper arousal and avoidance of recalling the events</strong></p>\n<p><strong>Acute stress reaction</strong> is the reaction that develops on <strong>2<sup>nd</sup> or 3<sup>rd</sup> </strong>day of stressful event</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 30-year-old male comes to a doctor and complains that his intestines have completely rotten away. Clinical examination reveals normal findings and imaging was also found to be normal. Despite the doctor convinced with the evidence that the patient was normal, he doesn\u2019t believe and consults another doctor for the same problem. This disorder is known as :",
    "choices": [
      {
        "id": 1,
        "text": "Somatisation disorder"
      },
      {
        "id": 2,
        "text": "Conversion disorder"
      },
      {
        "id": 3,
        "text": "Schizophrenia"
      },
      {
        "id": 4,
        "text": "Hypochondriasis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The above condition is <strong>hypochondriasis.</strong></p>\n<ul>\n<li>Hypochondriasis is defined as <strong>persistent preoccupation with a fear or belief of having a serious disease</strong>, based on person\u2019s own interpretation about the body function.</li>\n<li>They are <strong>reluctant to believe that their body is normal even after investigations show normal report.</strong></li>\n</ul>\n<p>Note: Patients with <strong>somatisation disorder</strong>, come to the doctor with <strong>multiple symptoms</strong> where as in hypochondriasis they come with the <strong>diagnosis </strong>i.e disease.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Identify the incorrect statement about autism",
    "choices": [
      {
        "id": 1,
        "text": "Repetitive movements"
      },
      {
        "id": 2,
        "text": "Absent reciprocal interaction"
      },
      {
        "id": 3,
        "text": "Enjoy music"
      },
      {
        "id": 4,
        "text": "Presence of eye to eye contact"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Autism is also called as <strong>autistic disorder, pervasive development disorder, childhood autism</strong>.</p>\n<p>It is commonly in males and <strong>typically appears before the age of 2 1/2 years</strong></p>\n<p>The characteristic clinical features are</p>\n<ul>\n<li>Impairment in the reciprocal social and interpersonal interaction\n<ul>\n<li><strong>Absent social smile</strong></li>\n<li><strong>Lack of eye to eye contact</strong></li>\n<li>Lack of awareness to others and lack of attachment to parents</li>\n<li>No or abnormal social play</li>\n<li>Marked impairment in making friends</li>\n</ul>\n</li>\n<li><strong>Impairment in language and non verbal communication</strong>\n<ul>\n<li>Lack of verbal or facial response to sounds or voices</li>\n<li>Absence of communicative sounds like babbling in infancy</li>\n<li><strong>Absent or delayed speech</strong></li>\n<li>Presence <strong>of echolalia, perseveration</strong></li>\n</ul>\n</li>\n<li>Abnormal behavior characteristics\n<ul>\n<li>Mannerisms</li>\n<li>Stereotyped behaviours such as <strong>head banging, body spinning</strong>, <strong>hand flicking, lining up objects</strong></li>\n<li>Ritualistic and compulsive behavior</li>\n</ul>\n</li>\n<li>A large majority of these children have <strong>moderate to profound mental retardation</strong></li>\n<li>Majority of these children <strong>enjoy music</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A school teacher finds a 7 yr old child to be extremely naughty, unable to sit in a place for a long time, excessively talking, and unable to concentrate on a thing for a long time. Which of the following drug is used in the management of this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Atenolol"
      },
      {
        "id": 2,
        "text": "Modafinil"
      },
      {
        "id": 3,
        "text": "Methylphenidate"
      },
      {
        "id": 4,
        "text": "Amitriptyline"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The above clinical scenario is suggestive of <strong>Attention deficit hyperactivity disorder</strong>(ADHD). The drug of choice for ADHD is<strong> Methylphenidate.</strong></p>\n<div class=\"ng-star-inserted\">\n<div class=\"table-responsive font-weight-light answer-scroll answer-html ng-star-inserted\">\n<p>Attention-deficit/hyperactivity disorder (ADHD) is a\u00a0<strong>neuro\u00ad psychiatric condition</strong>\u00a0characterized by a pattern of\u00a0<strong>diminished attention span and increased impulsivity or hyperactivity.\u00a0</strong>The\u00a0<strong>prefrontal cortex</strong>\u00a0of the brain has been implicated in its etiology and\u00a0<strong>dopamine</strong>\u00a0is the main neurotransmitter.\u00a0</p>\n<p>ADHD can begin during infancy but is usually rec\u00adognized between 1-3 years of age.\u00a0ADHD was known as minimal brain dysfunction earlier. The characteristics of children with ADHD, in order of frequency, are</p>\n<ul>\n<li>Hyperactivity</li>\n<li>Attention deficit (short attention span, distractibility)</li>\n<li>Impulsivity (action before thought, abrupt shifts in activity, lack of organization)</li>\n<li>Memory and thinking deficits</li>\n<li>Specific learning disabilities</li>\n<li>Speech and hearing deficits.</li>\n</ul>\n<p>Under\u00a0<strong>DSM-5</strong>\u00a0criteria, for diagnosis of ADHD, it is necessary for symptoms to be present<strong>\u00a0prior to age 12</strong>, persist for at least 6 months, have a negative impact on social, academic, or occupational activities, and be present in two or more settings.</p>\n<p>The course of ADHD is variable. The majority of the cases persist into adult life. The hyperactivity may sometimes disappear, but the decreased attention span and impulse-control problems usually persist. Patients with ADHD are vulnerable to antisocial behavior, conduct disorder, substance use disorders, and mood disorders.</p>\n<p><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">Pharmacotherapy</strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">\u00a0is the first line of treatment for ADHD.\u00a0</span><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">CNS stimulants</strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">\u00a0are the first-choice agents as they have shown the\u00a0</span><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">greatest efficacy</strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">\u00a0with mild tolerable side effects. The CNS stimulants used are dopamine agonists like\u00a0</span><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">methylphenidate</strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">,\u00a0</span><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">amphetamine</strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">\u00a0salts, and dextroamphetamine.\u00a0</span><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">Non-stimulant</strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">\u00a0medications used in the treatment of ADHD include\u00a0</span><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">atomoxetine</strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> (norepinephrine reuptake inhibitor), clonidine, and guanfacine (Alpha agonists).</span></p>\n<p><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">Psychosocial interventions</strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">\u00a0such as academic organization skills remediation, parent training, behavior modification in the classroom and at home, cognitive-behavioral therapy (CBT), and social skills training are also used as an adjunct to pharmacotherapy.</span></p>\n<p><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">Note: Modafinil is used in the management of narcolepsy.</span></p>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Condition where there is autism but with normal intelligence and normal language development is",
    "choices": [
      {
        "id": 1,
        "text": "Asperger\u2019s syndrome"
      },
      {
        "id": 2,
        "text": "Rett\u2019s syndrome"
      },
      {
        "id": 3,
        "text": "Heller\u2019s syndrome"
      },
      {
        "id": 4,
        "text": "Tic disorder"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<ul>\n<li>Asperger\u2019s syndrome is characterized by autism <strong>without any delay in language</strong> or <strong>cognitive development</strong></li>\n<li>It predominantly occurs in <strong>boys</strong></li>\n<li>It is the <strong>milder form of autism</strong> and hence it is also called as \u2018<strong>high functioning autism\u2019</strong></li>\n<li><strong>Heller\u2019s syndrome</strong> is a type of childhood psychosis occurring In the age between <strong>3-5yrs </strong>with rapid <strong>downhill course leading to deterioration and development of neurological deficits</strong></li>\n<li>Rett\u2019s syndrome is seen in <strong>girls</strong> , where after an apparently <strong>normal head circumference at birth</strong>, there is deceleration of head growth between <strong>5months and 30 months</strong> of age with <strong>loss of purposive hand movements and acquired fine motor skills</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not true about Rett\u2019s syndrome",
    "choices": [
      {
        "id": 1,
        "text": "Seen in females"
      },
      {
        "id": 2,
        "text": "Normal head circumference after 6 months of age"
      },
      {
        "id": 3,
        "text": "Normal head circumference at birth"
      },
      {
        "id": 4,
        "text": "Poor prognosis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Normal head circumference at birth and deceleration of head growth between 5months and 30 months of age is characteristic feature of rett's syndrome.</p>\n<ul>\n<li>Rett\u2019s syndrome is seen in <strong>girls</strong> , where after an apparently <strong>normal head circumference at birth</strong>, there is deceleration of head growth between <strong>5months and 30 months</strong> of age with <strong>loss of purposive hand movements and acquired fine motor skills</strong></li>\n<li>It has <strong>poor prognosis</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Nocturnal enuresis is diagnosed in child after what age",
    "choices": [
      {
        "id": 1,
        "text": "2 yrs"
      },
      {
        "id": 2,
        "text": "3 yrs"
      },
      {
        "id": 3,
        "text": "4 yrs"
      },
      {
        "id": 4,
        "text": "5 yrs"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<ul>\n<li><strong>Nocturnal enuresis</strong>\u00a0is involuntary urination that <strong>happens at night while sleeping</strong></li>\n<li>More than 85% of children attain both <strong>diurnal and nocturnal control of bladder by 5 yrs of age</strong></li>\n<li>If the nocturnal control of bladder doesn\u2019t appear <strong>even after 5yrs of age</strong> this is known as <strong>nocturnal enuresis</strong></li>\n<li>Most important <strong>etiolog</strong>y of nocturnal enuresis is <strong>developmental delay</strong></li>\n<li>Treatment involves behavioral modification like <strong>encouraging voluntary voiding of urine before sleeping</strong></li>\n<li><strong>Restricting intake of fluids after 8 pm</strong></li>\n<li>Alarm therapy:\n<ul>\n<li>Alarm consists of <strong>small sensor</strong> attached to the child\u2019s underwear or mat under the bedsheet When the child starts wetting the bed the <strong>sensors are activated causing the alarm to ring</strong></li>\n</ul>\n</li>\n<li>If the enuresis persists despite the above interventions <strong>then imipramine , oxybutynin, desmopressin or tolterodine </strong>can be used</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 30 year old man has ideas of grandiosity. He thinks himself to be very successful and correct all the time and cannot tolerate if someone criticizes him. What is the type of personality disorder",
    "choices": [
      {
        "id": 1,
        "text": "Histrionic"
      },
      {
        "id": 2,
        "text": "Paranoid"
      },
      {
        "id": 3,
        "text": "Narcissist"
      },
      {
        "id": 4,
        "text": "Schizotypal"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The above condition is <strong>Narcissistic personality disorder</strong></p>\n<p>The disorder is characterized by</p>\n<ul>\n<li>Ideas <strong>of grandiosity</strong> and <strong>inflated sense of self esteem</strong></li>\n<li>Pre occupation of <strong>fantasies of unlimited success</strong></li>\n<li>Attention seeking <strong>dramatic behavior and unable to face criticism</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Pathological stealing is known as",
    "choices": [
      {
        "id": 1,
        "text": "Pyromania"
      },
      {
        "id": 2,
        "text": "Kleptomania"
      },
      {
        "id": 3,
        "text": "Trichotillomania"
      },
      {
        "id": 4,
        "text": "Gambling"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Kleptomania</strong> is characterized by <strong>two or more thefts</strong>, in which there is <strong>stealing without apparent motive of personal gain or gain for another person</strong></p>\n<p><strong>Pyromania</strong> is two or more acts of <strong>fire setting without any apparent gain</strong></p>\n<p><strong>Trichotillomania</strong> is <strong>compulsive hair pulling</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Buspirone is",
    "choices": [
      {
        "id": 1,
        "text": "Benzodiazepine"
      },
      {
        "id": 2,
        "text": "D2 agonist"
      },
      {
        "id": 3,
        "text": "5HT1A partial agonist"
      },
      {
        "id": 4,
        "text": "D4 agonist"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<ul>\n<li>Buspirone is a <strong>non benzodiazepine, anti anxiety drug.</strong></li>\n<li>It is a <strong>5HT<sub>1A </sub>partial agonist</strong></li>\n<li>It is <strong>anxioselective</strong> and hence <strong>no risk of dependance</strong> with <strong>no sedative action, and no anticonvulsant or muscle relaxing properties</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Amphetamine overdose simulates",
    "choices": [
      {
        "id": 1,
        "text": "Depression"
      },
      {
        "id": 2,
        "text": "Mania"
      },
      {
        "id": 3,
        "text": "Schizophrenia"
      },
      {
        "id": 4,
        "text": "Autism"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Acute intoxication may present as paranoid hallucinatory syndrome which <strong>closely mimics paranoid schizophrenia</strong> but the <strong>distinguishing features</strong> include rapidity of onset presence of <strong>visual hallucinations</strong>, <strong>absence of thought disorder, appropriateness of affect, fearful emotional reaction and presence of confusion</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A chronic alcoholic who hadn\u2019t consumed alcohol for the past 3 days was brought to the emergency department. He had features of disorientation, poor attention span, and agitation. On examination, he had fever, tachycardia, and diaphoresis. Identify the condition.",
    "choices": [
      {
        "id": 1,
        "text": "Korsakoff psychosis"
      },
      {
        "id": 2,
        "text": "Wernicke\u2019s encephalopathy"
      },
      {
        "id": 3,
        "text": "Delirium tremens"
      },
      {
        "id": 4,
        "text": "Alcohol-induced dementia"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario of disorientation with features of autonomic hyperactivity (tachycardia, diaphoresis, fever) in a patient who stopped alcohol 3 days back is suggestive of <strong>delirium tremens.</strong></p>\n<p>Delirium tremens is the most severe alcohol withdrawal syndrome.\u00a0It occurs usually within <strong>3</strong><strong>-4 days</strong> of alcohol withdrawal.</p>\n<p>Characteristic features are:</p>\n<ul>\n<li>Clouding of consciousness with <strong>disorientation </strong>to time and place</li>\n<li>Poor attention and <strong>distractibility</strong></li>\n<li><strong>Visual hallucination</strong> and<strong> illusions</strong> which are often vivid and frightening</li>\n<li>Autonomic disturbances like<strong> tachycardia, fever, </strong>hypertension, sweating, and pupillary dilatation</li>\n<li>Psychomotor agitation and ataxia</li>\n</ul>\n<p><strong>Benzodiazepines\u00a0</strong>such as<strong>\u00a0chlordiazepoxide and lorazepam\u00a0</strong>are used in the treatment and prevention of delirium tremens.</p>\n<div class=\"page\" title=\"Page 650\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Option A: <strong>Korsakoffs</strong> psychosis is characterized by impaired mental abilities (especially recent memory) and <strong>anterograde amnesia</strong> in an alert and responsive patient. The patient may have symptoms of <strong>confabulation.</strong></p>\n<p>Option B: <strong>Wernicke's</strong> encephalopathy is characterized by <strong>ataxia</strong> (affecting primarily the gait), vestibular dysfunction, confusion, and <strong>ocular motility abnormalities.</strong></p>\n<p>Option D:<strong>\u00a0Alcohol-induced dementia</strong> is characterized by the development of <strong>multiple</strong>\u00a0<strong>cognitive deficits</strong>\u00a0(e.g., memory problems, language impairment, and an inability to perform complex motor tasks) that are judged to be a direct consequence of alcohol use. This\u00a0<strong>persists beyond</strong> the usual <strong>duration of</strong> alcohol intoxication or <strong>acute withdrawal</strong>.</p>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The patient with schizophrenia has marked thought disorder, emotional disturbance and loosening of association. What is the type of schizophrenia?",
    "choices": [
      {
        "id": 1,
        "text": "Catatonic"
      },
      {
        "id": 2,
        "text": "Disorganised"
      },
      {
        "id": 3,
        "text": "Paranoid"
      },
      {
        "id": 4,
        "text": "Simple"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Types of Schizophrenia</strong></p>\n<p><strong>Paranoid Schizophrenia</strong>: In addition to the general symptoms of schizophrenia they <strong>have delusions of persecution, reference, grandeur, control, or infidelity</strong></p>\n<ul>\n<li><strong>Disorganized schizophrenia</strong>: It is characterized by\n<ul>\n<li>Marked thought disorder, incoherence, and severe loosening of association</li>\n<li>Emotional disturbances like inappropriate affect, blunted affect or senseless giggling, mirror-gazing for long period, and markedly impaired social and occupational functioning.</li>\n</ul>\n</li>\n<li><strong>Catatonic Schizophrenia</strong>: it has two subtypes\n<ul>\n<li>Excited catatonia characterized by increase psychomotor activity and increased speech production</li>\n<li>Stuporous catatonia characterized by mutism with akinesis (stupor), echolalia, echopraxia, and waxy flexibility</li>\n</ul>\n</li>\n<li><strong>Simple schizophrenia</strong> with early-onset and <strong>characteristic presence of negative symptoms</strong></li>\n<li><strong>Latent Schizophrenia</strong>: This is diagnosed after an episode of schizophrenia has occurred. There is an absence of florid psychotic symptoms such as delusion and hallucinations.</li>\n<li><strong>Undifferentiated schizophrenia:</strong> symptoms which cannot be categorized into any of the types</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The most important psychoactive component present in Cannabis is",
    "choices": [
      {
        "id": 1,
        "text": "Tetrahydrocannabinol"
      },
      {
        "id": 2,
        "text": "Cannabidiol"
      },
      {
        "id": 3,
        "text": "Cannabinol"
      },
      {
        "id": 4,
        "text": "Flavonoids"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Cannabis is derived from the plant <strong>Cannabis sativa also known as Sativa indica</strong></p>\n<p>It contains many psychoactive ingredients of which <strong>tetrahydrocannabinol is the main ingredient</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which among the following is not an indication for the use of electroconvulsive therapy (ECT)?",
    "choices": [
      {
        "id": 1,
        "text": "Psychotic depression"
      },
      {
        "id": 2,
        "text": "Panic disorder"
      },
      {
        "id": 3,
        "text": "Parkinson's disease"
      },
      {
        "id": 4,
        "text": "Schizoaffective disorder"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Indications of ECT:</p>\n<p><strong>Diagnostic</strong> indications -\u00a0</p>\n<ul>\n<li>Major depression (Bipolar and unipolar)</li>\n<li><strong>Psychotic depression (Option A)</strong></li>\n<li>Mania</li>\n<li>Acute exacerbation of schizophrenia</li>\n<li>Catatonic schizophrenia</li>\n<li><strong>Schizoaffective disorder (Option D)</strong></li>\n<li><strong>Parkinson's disease (Option C)</strong></li>\n<li>Neuroleptic malignant disorder</li>\n</ul>\n<p><strong>Panic disorder is not an indication</strong> of the use of electroconvulsive therapy.\u00a0</p>\n<p><strong>Clinical</strong> indications -\u00a0</p>\n<ul>\n<li>Primary -\u00a0\n<ul>\n<li>When rapid response is required</li>\n<li>When the risk of other treatment modalities outweighs the benefits</li>\n<li>Poor response to previous antipsychotic therapy</li>\n<li>Good response to previous ECT therapy</li>\n<li>Preference of patient</li>\n</ul>\n</li>\n<li>Secondary -\u00a0\n<ul>\n<li>Poor response or failure to respond to pharmacotherapy in the current episode</li>\n<li>Rapid definitive response necessitated by the deterioration of the patient's condition</li>\n</ul>\n</li>\n</ul>\n<p>Electroconvulsive therapy (ECT) is <strong>not effective in\u00a0somatization disorder</strong> (unless accompanied by depression), <strong>personality disorders</strong>, and <strong>anxiety</strong> <strong>disorders</strong> such as panic disorder.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is responsible for the setting of the personal goals and aspiration in human beings",
    "choices": [
      {
        "id": 1,
        "text": "Id"
      },
      {
        "id": 2,
        "text": "Ego ideal"
      },
      {
        "id": 3,
        "text": "Ego"
      },
      {
        "id": 4,
        "text": "Conscience"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Structural theory of mind was given by <strong>Sigmund Freud.</strong> He divided the mental apparatus into three distinct structures</p>\n<ul>\n<li><strong>Id</strong> : it contains basic drives and instincts and <strong>works on the basis of pleasure principle</strong></li>\n<li><strong>Ego</strong>: it is determined by the experience of reality and hence <strong>works on the basis of reality principle</strong></li>\n<li><strong>Super ego</strong>: it is influenced by the family members, religion and important people n the surrounding environment\n<ul>\n<li>It has a component known as <strong>ego ideal</strong> which is responsible <strong>for setting the personal goal and ambitions</strong></li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An IT employee, who is frustrated by his boss, shows anger on his wife even for the small things. This defense mechanism is known as",
    "choices": [
      {
        "id": 1,
        "text": "Projection"
      },
      {
        "id": 2,
        "text": "Reaction formation"
      },
      {
        "id": 3,
        "text": "Splitting"
      },
      {
        "id": 4,
        "text": "Displacement"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The term <strong>ego defense mechanism refers to the automatic</strong>, involuntary and unconsciously instituted psychological activity by which the <strong>unacceptable urges or impulses are excluded from the conscious awareness. </strong></p>\n<p>Some of the defense mechanisms</p>\n<ul>\n<li><strong>Displacement:</strong> <strong>Unconscious shifting of emotions</strong>, usually aroused by perceived threat, from an unconscious impulse to less threatening external object which is then thought to be a source of threat</li>\n<li><strong>Projection:</strong> Unconscious attribution of ones own attitude and urges to other person</li>\n<li>Eg: Blaming others for the mistake done by self</li>\n<li><strong>Reaction formation</strong>: Unconscious transformation of unacceptable impulses into exactly opposite attitudes, impulses, feelings or behaviors.</li>\n<li>Eg: Lustful man to hide his feelings shows disgust on seeing woman</li>\n<li><strong>Splitting:</strong> Unconscious viewing of self or others as good or bad without considering whole range of qualities</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not included in the 4A\u2019s of Blueler",
    "choices": [
      {
        "id": 1,
        "text": "Ambivalence"
      },
      {
        "id": 2,
        "text": "Apathy"
      },
      {
        "id": 3,
        "text": "Autism"
      },
      {
        "id": 4,
        "text": "Association disturbances"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>4a\u2019s of Bleuler include</strong></p>\n<ul>\n<li>Ambivalence: Marked inability to decide for or against</li>\n<li>Autism: Withdrawal into self</li>\n<li>Affect disturbances: Disturbances of affect such as inappropriate affect</li>\n<li>Association disturbances: Loosening of association; thought disorders</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The age of development of Oedipus complex i",
    "choices": [
      {
        "id": 1,
        "text": "5-10yrs"
      },
      {
        "id": 2,
        "text": "3-5yrs"
      },
      {
        "id": 3,
        "text": "1-1.5 yrs"
      },
      {
        "id": 4,
        "text": "1.5- 3yrs"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<ul>\n<li>At the age of <strong>3- 5 yrs</strong> male child develops <strong>Castration anxiety</strong> (fear of castration at the hand of his father for the boy\u2019s desire to replace his father in his mother\u2019s affection).</li>\n<li>This leads to the formation of <strong>Oedipus complex</strong> where there are <strong>aggressive impulses are directed towards father</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Delusion of infidelity is seen in",
    "choices": [
      {
        "id": 1,
        "text": "Othello syndrome"
      },
      {
        "id": 2,
        "text": "Clerambault syndrome"
      },
      {
        "id": 3,
        "text": "Capgras syndrome"
      },
      {
        "id": 4,
        "text": "Grandiose delusion"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<ul>\n<li>When the content of <strong>delusion is predominantly jealousy</strong> involving the spouse, then it is called as <strong>Othello syndrome</strong> or <strong>conjugal paranoia</strong></li>\n<li>In <strong>Clerambault\u2019s syndrome</strong> : the patient (usually woman) thinks that <strong>a person with a higher status is in love with the patient</strong></li>\n<li><strong>Capgras syndrome</strong>: here the patient feels a <strong>familiar person as a complete stranger</strong> who is imposing on him as a familiar person</li>\n<li><strong>Grandiose delusion</strong>: The patient may believe <strong>self to be a leader</strong> with higher aims of spreading peace, making war or spreading a message in the world</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 24 year old male was diagnosed to have schizophrenia. He was started on risperidone. There was no response to the treatment and the clinical symptoms of the patient did not improve. Despite this the patient also tried to end his life. What will be the next appropriate step",
    "choices": [
      {
        "id": 1,
        "text": "Increase the dose"
      },
      {
        "id": 2,
        "text": "Add another antipsychotic along with risperidone"
      },
      {
        "id": 3,
        "text": "Stop risperidone and start Haloperidol"
      },
      {
        "id": 4,
        "text": "Start clozapine"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<ul>\n<li><strong>Clozapine</strong> is an effective drug for the <strong>patients who poorly respond to the initial treatment</strong> with other antipsychotics and the drug indicated to <strong>reduce the risk of suicide</strong></li>\n<li>Since the important side effect of clozapine is <strong>agranulocytosis,</strong> it should be used with caution with <strong>regular monitoring of WBC count</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Narcolepsy is characterized by all except",
    "choices": [
      {
        "id": 1,
        "text": "Hypnogogic hallucinations"
      },
      {
        "id": 2,
        "text": "Cataplexy"
      },
      {
        "id": 3,
        "text": "Sleep paralysis"
      },
      {
        "id": 4,
        "text": "Decreased sleep"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Narcolepsy is characterized by <strong>excessive daytime sleepiness, often disturbed night sleep and disturbances in REM sleep</strong></p>\n<p>Age of onset is <strong>15-25 yrs</strong></p>\n<p>It consists of classical tetrad</p>\n<ul>\n<li><strong>Sleep attacks</strong>: person is unable to resist sleep from which he awakens refreshed</li>\n<li><strong>Cataplexy</strong>: <strong>Loss of muscle tone</strong> in various parts of body <strong>without loss of consciousness</strong></li>\n<li><strong>Hypnogogic hallucinations</strong>: dream like perception which occur at onset of sleep and are <strong>associated with fearfulness</strong></li>\n<li><strong>Sleep paralysis</strong>: It occurs during awakening or onset of sleep. Here the <strong>person is awake but unable to move his body</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not present in Kleine- Levin syndrome",
    "choices": [
      {
        "id": 1,
        "text": "Hypersomnia"
      },
      {
        "id": 2,
        "text": "Hyperphagia"
      },
      {
        "id": 3,
        "text": "Hyperpathia"
      },
      {
        "id": 4,
        "text": "Hypersexuality"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Kleine- Levin syndrome is characterized by</p>\n<ul>\n<li>Hypersomnia</li>\n<li>Hyperphagia</li>\n<li>Hypersexuality</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 19 year old girl is extremely conscious about her weight. But she cannot resist food and therefore she eats large amount of food at a time followed by a self induced vomiting",
    "choices": [
      {
        "id": 1,
        "text": "Binge eating syndrome"
      },
      {
        "id": 2,
        "text": "Bulimia nervosa"
      },
      {
        "id": 3,
        "text": "Anorexia nervosa"
      },
      {
        "id": 4,
        "text": "Psychogenic vomiting"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Bulimia nervosa is an eating disorder characterized by</p>\n<ul>\n<li><strong>Intense fear of becoming obese</strong></li>\n<li>There are episodes of <strong>over eating in which large amounts of food</strong> are consumed within short periods of time</li>\n<li>To counteract the effects of over eating, the attempts of <strong>self induced vomiting, purgative abuse, periods of starvation or appetite suppressants are used</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient is scared of heights, first the doctor asks him to imagine that he is on terrace. When the patient starts feeling anxious then doctor asks him to relax. The next session is followed by imagining that he is standing on a 12 storey building followed by relaxation and then at the top of the hill. This technique is called as",
    "choices": [
      {
        "id": 1,
        "text": "Relaxation"
      },
      {
        "id": 2,
        "text": "Systematic desensitization"
      },
      {
        "id": 3,
        "text": "Cognitive behavioral therapy"
      },
      {
        "id": 4,
        "text": "Flooding"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Systematic desensitization technique is based on the <strong>principle of reciprocal inhibition</strong> which states that if a response incompatible with anxiety is made to occur at the same time as an anxiety provoking stimulus, anxiety is reduced by reciprocal inhibition</p>\n<p>Steps:</p>\n<ul>\n<li><strong>Relaxation training</strong></li>\n<li><strong>Hierarchy construction</strong>: the patient is asked to list all the conditions provoking anxiety and then rearrange in descending order of anxiety provocation.</li>\n<li><strong>Relaxation proper</strong>: This can be done either in imagery or in reality. At first <strong>the lowest item in hierarchy is confronted.</strong> When the patient becomes anxious doctor asks him to relax. Then the next item in hierarchy is confronted followed by relaxation technique. After few sessions patient is able to control his anxiety.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Yoga and pranayama is a type of",
    "choices": [
      {
        "id": 1,
        "text": "Cognitive behavioral therapy"
      },
      {
        "id": 2,
        "text": "Systematic desensitization"
      },
      {
        "id": 3,
        "text": "Relaxation"
      },
      {
        "id": 4,
        "text": "Flooding"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The aim of relaxation therapy is to <strong>induce muscle relaxation</strong>. Since anxiety produces muscular tension, which in turn reinforces anxiety, relaxation technique would <strong>decrease both anxiety and muscular tension</strong></p>\n<p>Methods of Relaxation techniques</p>\n<ul>\n<li><strong>Jacobson\u2019s progressive muscular relaxation</strong>: it involves contraction and relaxation of major muscles of the body in a systematic order usually from top of the body progressing downwards</li>\n<li>Hypnosis</li>\n<li>Transcendental meditation</li>\n<li><strong>Yoga</strong></li>\n<li><strong>Shavasana</strong></li>\n<li><strong>Pranayama</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "All of the following are disorders of perception except",
    "choices": [
      {
        "id": 1,
        "text": "Dysmegalopsia"
      },
      {
        "id": 2,
        "text": "Hallucination"
      },
      {
        "id": 3,
        "text": "Illusion"
      },
      {
        "id": 4,
        "text": "Delusion"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<ul>\n<li>Disorders of perception can be divided into sensory distortions and sensory deceptions</li>\n<li>Eg of sensory distortions are <strong>hypoaesthesia, hyperesthesia, dysmegalopsia etc</strong></li>\n<li>Eg of sensory deceptions are <strong>illusion and hallucination</strong></li>\n<li><strong>Delusion </strong>\u00a0is \u00a0a <strong>false, unshakeable belief</strong> that is out of keeping with the patient\u2019s social and cultural background. It is <strong>disorder of content of thought</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Nobel prize for contribution to psychosurgery was given to",
    "choices": [
      {
        "id": 1,
        "text": "Egas Moniz"
      },
      {
        "id": 2,
        "text": "Konrad Lorenz"
      },
      {
        "id": 3,
        "text": "Stanley B. Prusiner"
      },
      {
        "id": 4,
        "text": "Eric R. Kandel"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Egas Moniz</strong> was awarded Nobel prize in the year 1949 for the contribution in Psychosurgery <strong>(Prefrontal leucotomy, also known as prefrontal lobotomy)</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Sense of unfamiliarity with familiar situation is known as",
    "choices": [
      {
        "id": 1,
        "text": "D\u00e9j\u00e0 vu"
      },
      {
        "id": 2,
        "text": "Jamais  Vu"
      },
      {
        "id": 3,
        "text": "Jamais entendu"
      },
      {
        "id": 4,
        "text": "Formication"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<ul>\n<li>Sense of <strong>unfamiliarity with familiar situation</strong> is known as <strong>Jamais Vu</strong> where as the <strong>sense of familiarity with unfamiliar situation is known as D\u00e9j\u00e0 vu</strong></li>\n<li><strong>Jamais entendu</strong> is a sense of unfamiliarity when <strong>hearing something familiar</strong></li>\n<li><strong>Formication is a false sense of insects crawling on ones skin</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Person maintains the body posture for a long time into which it is placed. This is known as",
    "choices": [
      {
        "id": 1,
        "text": "Akinesia"
      },
      {
        "id": 2,
        "text": "Cataplexy"
      },
      {
        "id": 3,
        "text": "Coprolalia"
      },
      {
        "id": 4,
        "text": "Catalepsy"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The person <strong>maintains a body posture into which it is placed</strong> for long duration even if it is very uncomfortable. This is known as <strong>Catalepsy</strong></p>\n<p><strong>Cataplexy is loss of muscle tone without loss of consciousness</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The term coprolalia refers to",
    "choices": [
      {
        "id": 1,
        "text": "Use of obscene words"
      },
      {
        "id": 2,
        "text": "Repetition of heard phrases"
      },
      {
        "id": 3,
        "text": "Repetition of heard words"
      },
      {
        "id": 4,
        "text": "Thinking of obscene words"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<ul>\n<li>The term <strong>coprolalia</strong> refers <strong>to the use of obscene words.</strong></li>\n<li>Repetition of heard phrases is <strong>echolalia.</strong></li>\n<li>Repetition of heard words is<strong> palilalia.</strong></li>\n<li>Thinking of obscene words is <strong>mental coprolalia.</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which among the following is the test of intelligence",
    "choices": [
      {
        "id": 1,
        "text": "Vineland social maturity scale"
      },
      {
        "id": 2,
        "text": "Stanford-Binet test"
      },
      {
        "id": 3,
        "text": "Denver Development Screening test"
      },
      {
        "id": 4,
        "text": "Gessell\u2019s Development Scale"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Stanford Binet test is the test used to measure intelligence</p>\n<p>Other tests used to measure intelligence</p>\n<ul>\n<li>Seguin form board test</li>\n<li>Stanford Binet, Binet Simon or Binet Kamath tests</li>\n<li>Weschsler intelligence scale for children</li>\n<li>Wechsler preschool and primary scale of intelligence</li>\n<li>Bhatia\u2019s battery of performance tests</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Mutism with akinesis is a feature of",
    "choices": [
      {
        "id": 1,
        "text": "Oneroid state"
      },
      {
        "id": 2,
        "text": "Stupor"
      },
      {
        "id": 3,
        "text": "Twilight state"
      },
      {
        "id": 4,
        "text": "Delerium"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Stupor is a state of <strong>akinesis (no movement) with mutism </strong>but with evidence of relative <strong>preservation of conscious awareness</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The defense mechanisms involved in Obsessive compulsive disorder are all except",
    "choices": [
      {
        "id": 1,
        "text": "Isolation of affect"
      },
      {
        "id": 2,
        "text": "Repression"
      },
      {
        "id": 3,
        "text": "Undoing"
      },
      {
        "id": 4,
        "text": "Reaction formation"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<ul>\n<li>The defense mechanisms involved in the <strong>Obsessive compulsive disorder are Isolation of affect, Undoing and reaction formation</strong></li>\n<li><strong>Repression</strong> is unconsciously excluding anxiety provoking ideas from conscious awareness as seen in psychogenic amnesia. This is not involved in <strong>Obsessive compulsive disorder</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not a part of cognitive triad of Beck?",
    "choices": [
      {
        "id": 1,
        "text": "Hopelessness"
      },
      {
        "id": 2,
        "text": "Worthlessness"
      },
      {
        "id": 3,
        "text": "Helplessness"
      },
      {
        "id": 4,
        "text": "Guilt"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Beck\u2019s triad of depression consists of</p>\n<ul>\n<li><strong>Hopelessness</strong>: there is no hope in the future</li>\n<li><strong>Helplessness</strong>: no help is possible now</li>\n<li><strong>Worthlessness</strong>: feeling of inadequacy or inferiority</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The term Pfropf schizophrenia refers to",
    "choices": [
      {
        "id": 1,
        "text": "Schizophrenia associated with self mutilation"
      },
      {
        "id": 2,
        "text": "Schizophrenia associated with dream like states"
      },
      {
        "id": 3,
        "text": "Schizophrenia occuring in 7th decade"
      },
      {
        "id": 4,
        "text": "Schizophrenia occurring in the presence of mental retardation"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<ul>\n<li><strong>Pfropf schizophrenia</strong> is a syndrome of <strong>schizophrenia occurring in the presence of mental retardation</strong></li>\n<li><strong>Van Gogh syndrome</strong>: It is the dramatic <strong>self mutilation occurring in schizophrenia</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = 'Psychiatry St 2 (From Q-Bank)';
        const quizFilename = 'psychiatry-st-2-from-q-bank-6385d22a.html';
        let hierarchy = ["Marrow", "NEET PG Test Series Subject Wise", "Year 2017 - 18"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>