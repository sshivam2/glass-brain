<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>244 Orthopedics Aiims 2020 (May And Nov Ini-Cet) - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / PYQs / Orthopedics
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">15</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "All of the following are indications of surgery in a patient of Potts' spine except?",
    "choices": [
      {
        "id": 1,
        "text": "Cold abscess without neurological complication"
      },
      {
        "id": 2,
        "text": "Doubtful diagnosis"
      },
      {
        "id": 3,
        "text": "Drug resistant TB"
      },
      {
        "id": 4,
        "text": "Progressive cauda equina syndrome/conus medullaris syndrome"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>A <strong>cold abscess without neurological complications</strong> is <strong>not an indication for surgery</strong> in Pott&rsquo;s spine/TB spine.</p>\n<p>Indications of surgery in TB spine are:</p>\n<ul>\n<li aria-level=\"1\"><strong>Progressive neurologic deficit</strong> such as <strong>progressive cauda equina syndrome/conus medullaris syndrome&nbsp;</strong>(Option D)</li>\n<li aria-level=\"1\">Progressive increase in spinal deformity</li>\n<li aria-level=\"1\"><strong>Resistance </strong>to<strong> anti-tubercular therapy&nbsp;</strong>(Option C)</li>\n<li aria-level=\"1\">Recurrence of disease</li>\n<li aria-level=\"1\">Cord compression</li>\n<li aria-level=\"1\">Severe pain due to abscess or spinal instability</li>\n<li aria-level=\"1\">Progressive impairment of pulmonary function</li>\n<li aria-level=\"1\"><strong>Uncertain diagnosis </strong>(Option B): Inability to obtain a microbiological diagnosis through microscopy, culture, or PCR techniques may occur. In cases where there is no accessible source for sampling (such as discharging sinus or superficial abscess) or insufficient specimen obtained from image-guided percutaneous biopsy, an <strong>open surgical biopsy</strong> is the only option to obtain a specific culture and sensitivity report.</li>\n</ul>\n<p><strong>Antero-lateral decompression</strong> is the <strong>surgery of choice</strong> for <strong>Pott&rsquo;s paraplegia</strong> as it helps in the removal of both solid and liquid debris.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In case of a meniscal tear repair, which of the following zones heals best?",
    "choices": [
      {
        "id": 1,
        "text": "Red zone"
      },
      {
        "id": 2,
        "text": "White zone"
      },
      {
        "id": 3,
        "text": "Gray zone"
      },
      {
        "id": 4,
        "text": "Red+White zone"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The <strong>red zone</strong> <strong>heals best</strong> in case of a meniscal tear&nbsp;due to its <strong>rich blood supply.</strong></p>\n<p>The menisci are divided into three zones depending on the perfusion of blood. The menisci are supplied by perimeniscal blood vessels from superior and inferior branches of medial and lateral genicular vessels.</p>\n<p>Following birth, the menisci become <strong>increasingly avascular. </strong>By adulthood,&nbsp;only the peripheral 10% to 25% of the tissue is perfused. This gives rise to 3 distinct regions of the menisci:</p>\n<ul>\n<li>The peripheral relatively <strong>vascularised</strong> region called the <strong>red-red zone </strong>(Zone 1)</li>\n<li>A&nbsp;<strong>zone of transition</strong> between the 2 zones, which is called the<strong> red-white zone </strong>(Zone 2)</li>\n<li>The <strong>completely avascular inner</strong> zone known as the <strong>white-white zone </strong>(Zone 3)</li>\n</ul>\n<p>There is a direct relationship between the vascularization and capacity of the tissue to heal, predisposing the white-white zone to permanent post-traumatic and degenerative lesions.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/bc22fc2a4cae4ed38415688ec639da2fx1279x1559.JPEG"
    ]
  },
  {
    "text": "A 22-year-old male patient presents with a history of RTA. His leg is in abduction and external rotation. What could be the cause?",
    "choices": [
      {
        "id": 1,
        "text": "Anterior dislocation of the hip"
      },
      {
        "id": 2,
        "text": "Posterior dislocation of the hip"
      },
      {
        "id": 3,
        "text": "Intertrochanteric fracture"
      },
      {
        "id": 4,
        "text": "Fracture neck of femur"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>&nbsp;</p>\n<p>Treatment of anterior dislocation includes a <strong>closed reduction </strong>under sedation or general anesthesia. If closed reduction fails, an open procedure may be planned.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3d1f4c191fb54635be785c801c5e55dex289x174.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9293923f932f4a0598380393f313a51ax1279x1048.JPEG"
    ]
  },
  {
    "text": "The most specific test for carpal tunnel syndrome is?",
    "choices": [
      {
        "id": 1,
        "text": "Durkan's test"
      },
      {
        "id": 2,
        "text": "Phalen test"
      },
      {
        "id": 3,
        "text": "Tinel test"
      },
      {
        "id": 4,
        "text": "Two point discrimination"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Tinel's test</strong> - Sensory symptoms reproduced by percussing over the median nerve imply a positive test.</li>\n</ul>\n<p><br /><strong>Two-point discrimination</strong> is done to assess <strong>sensory loss</strong> and is not specific to carpal tunnel syndrome.<br style=\"font-weight: 400;\" /><br style=\"font-weight: 400;\" /></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9666dca33b444286a2a9154ab1e0fb78x1280x1308.JPEG"
    ]
  },
  {
    "text": "A female patient with a history of fall few months back presents with the deformity shown in the image. Probing into history reveals it was managed with traditional treatment. This deformity is likely to be due to ____________",
    "choices": [
      {
        "id": 1,
        "text": "Intra-articular fracture of wrist"
      },
      {
        "id": 2,
        "text": "Extra-articular fracture of wrist"
      },
      {
        "id": 3,
        "text": "Boxer's fracture"
      },
      {
        "id": 4,
        "text": "Barton's fracture"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given image shows the <strong>dinner-fork deformity</strong>&nbsp;seen in <strong>Colle's fracture</strong>&nbsp;which is an <strong>extra-articular fracture of the wrist</strong>.</p>\n<p>Colle's fracture is a fracture of <strong>corticocancellous junction</strong> of the <strong>distal end</strong> of the <strong>radius</strong>.&nbsp;The dinner fork deformity is the prominence on the back of the wrist and depression in the front. It is due to the dorsal angulation of the distal fracture fragment. It&nbsp;is treated by a&nbsp;<strong>Colles&rsquo; cast</strong>,&nbsp;which immobilizes the wrist in palmar flexion, pronation, and ulnar deviation.</p>\n<p><strong>Displacements that may be seen in Colles' fracture:</strong></p>\n<ul>\n<li>Dorsal tilt</li>\n<li>Dorsal shift</li>\n<li>Lateral tilt (Radial tilt)</li>\n<li>Lateral shift (Radial shift)</li>\n<li>Supination</li>\n<li>Impaction of fragments</li>\n</ul>\n<p>The given radiograph shows the <strong>dorsal tilt of the distal fragment leading to dinner fork deformity.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/9ca7abed17d242e5bed2a71d458b6edf.jpg"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c854a2f64ed1455488fe4b2d123ac69ax720x855.JPEG"
    ]
  },
  {
    "text": "Scoliosis screening in school children is done by?",
    "choices": [
      {
        "id": 1,
        "text": "Straight leg raising test"
      },
      {
        "id": 2,
        "text": "Forward bending test"
      },
      {
        "id": 3,
        "text": "Backward bending test"
      },
      {
        "id": 4,
        "text": "Single leg standing test"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>A <strong>straight leg raising test</strong> is used to find <strong>nerve compression</strong> in the lumbosacral area.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/954d2ada9bea47b1aa1c8083826d4a7ex1200x1956.JPEG"
    ]
  },
  {
    "text": "Fishtail deformity is seen in the fracture of _____________",
    "choices": [
      {
        "id": 1,
        "text": "Distal end of radius"
      },
      {
        "id": 2,
        "text": "Distal end of humerus"
      },
      {
        "id": 3,
        "text": "Distal end of tibia"
      },
      {
        "id": 4,
        "text": "Distal end of femur"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Fishtail deformity</strong> is seen following a <strong>fracture</strong> of the <strong>distal end </strong>of the<strong> humerus</strong>.</p>\n<p>Fishtail deformity of the <strong>elbow</strong> is a rare complication that can occur in <strong>childhood</strong> after a <strong>distal humeral fracture</strong>. It is characterized by a contour abnormality of the distal humerus due to the <strong>absence or resorption </strong>of the<strong> lateral trochlear ossification centers</strong>.</p>\n<p>Fishtail deformity of the distal humerus can be of 2 types:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">The first type is a <strong>sharp-angled wedge</strong>, which commonly occurs after <strong>fractures of the lateral condyle</strong>. It is caused by the persistence of a gap between the lateral condylar physis ossification center and the medial ossification of the trochlea. Because of this gap, the <strong>lateral crista</strong> of the trochlea may be <strong>underdeveloped</strong>, which may represent a small &ldquo;<strong>bony bar</strong>&rdquo; in the distal humeral physis</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">The second type is believed to be associated with <strong>osteonecrosis </strong>of the<strong> lateral part </strong>of the <strong>medial crista </strong>of the<strong> trochlea</strong>.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Ring sequestrum is seen in?",
    "choices": [
      {
        "id": 1,
        "text": "Salmonella infection"
      },
      {
        "id": 2,
        "text": "TB osteomyelitis"
      },
      {
        "id": 3,
        "text": "Pin tract infection"
      },
      {
        "id": 4,
        "text": "Chronic osteomyelitis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Ring sequestrum</strong> is seen in a <strong>p</strong><strong>in tract infection.</strong></p>\n<p>Sequestrum is a <strong>fragment of dead\u00a0bone</strong> lying within a cavity formed by necrosis. Infection at a pin site in an external fixation construct leads to a ring sequestrum.</p>\n<p>Types of sequestra:</p>\n<table style=\"width: 22.4611%; height: 201.605px;\">\n<tbody>\n<tr style=\"height: 22.4006px;\">\n<td style=\"width: 35.6515%; height: 22.4006px;\"><strong>Type</strong>\u00a0</td>\n<td style=\"width: 51.8018%; height: 22.4006px;\"><strong>Seen in</strong></td>\n</tr>\n<tr style=\"height: 22.4006px;\">\n<td style=\"width: 35.6515%; height: 22.4006px;\">Tubular\u00a0</td>\n<td style=\"width: 51.8018%; height: 22.4006px;\">Pyogenic infections like osteomyelitis\u00a0</td>\n</tr>\n<tr style=\"height: 22.4006px;\">\n<td style=\"width: 35.6515%; height: 22.4006px;\">Ring</td>\n<td style=\"width: 51.8018%; height: 22.4006px;\">Around pin tracts in external fixators</td>\n</tr>\n<tr style=\"height: 22.4006px;\">\n<td style=\"width: 35.6515%; height: 22.4006px;\">Black</td>\n<td style=\"width: 51.8018%; height: 22.4006px;\">Actinomycosis</td>\n</tr>\n<tr style=\"height: 44.8011px;\">\n<td style=\"width: 35.6515%; height: 44.8011px;\">Coralliform</td>\n<td style=\"width: 51.8018%; height: 44.8011px;\">Perthes disease</td>\n</tr>\n<tr style=\"height: 22.4006px;\">\n<td style=\"width: 35.6515%; height: 22.4006px;\">Coke</td>\n<td style=\"width: 51.8018%; height: 22.4006px;\">Tuberculosis (cancellous bone)</td>\n</tr>\n<tr style=\"height: 22.4006px;\">\n<td style=\"width: 35.6515%; height: 22.4006px;\">Feathery</td>\n<td style=\"width: 51.8018%; height: 22.4006px;\">Syphilis, Tuberculosis</td>\n</tr>\n<tr style=\"height: 22.4006px;\">\n<td style=\"width: 35.6515%; height: 22.4006px;\">Sandy</td>\n<td style=\"width: 51.8018%; height: 22.4006px;\">Tuberculosis</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A counterforce brace is used in?",
    "choices": [
      {
        "id": 1,
        "text": "Tennis elbow"
      },
      {
        "id": 2,
        "text": "Ankle sprain"
      },
      {
        "id": 3,
        "text": "Ulnar claw hand"
      },
      {
        "id": 4,
        "text": "Foot drop"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>A <strong>counterforce brace</strong> is used in <strong>tennis elbow</strong>.</p>\n<p><strong>Tennis elbow</strong>, also known as <strong>lateral epicondylitis</strong>, is a condition involving the lateral epicondyle caused by <strong>repetitive contraction of the extensor muscles </strong>during activities that require <strong>forceful wrist extension and supination</strong>, such as playing tennis or using a screwdriver.</p>\n<p>A <strong>counterforce brace</strong> is a treatment option for tennis elbow (shown in the image below). It works by applying <strong>compression</strong> to the <strong>extensor muscles</strong>, specifically the extensor carpi radialis brevis (ECRB) region, which helps <strong>release </strong>the <strong>forces</strong> exerted <strong>on the lateral epicondyle</strong>. This compression prevents the transmission of tension up to the lateral epicondyle, providing relief and promoting healing in the affected area.</p>\n<p>Management options in tennis elbow:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Conservative management: Rest and physiotherapy</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Medical intervention: Injection of local anesthetic and steroids</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Surgical methods: Percutaneous release of epicondylar muscles</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Other management methods: Extracorporeal shock wave therapy, arthroscopic release, autologous blood injections, <strong>counterforce bracing</strong>, rehabilitative exercises, and ultrasound-guided percutaneous needle therapy.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a109bd0fa18646a49aae68a96bda3831x1024x768.JPEG"
    ]
  },
  {
    "text": "A 10-year-old boy presents with pain around the left knee joint. On X-ray, there is a lesion at the distal femur extending up to the terminal end. The gross image of the condition is given below. What can be the most probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Giant cell tumour"
      },
      {
        "id": 2,
        "text": "Chondroblastoma"
      },
      {
        "id": 3,
        "text": "Osteoid osteoma"
      },
      {
        "id": 4,
        "text": "Osteosarcoma"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical scenario, involving a <strong>child</strong>&nbsp;and a gross specimen revealing a <strong>metaphyseal </strong>tumor in the <strong>distal femur</strong> that has <strong>infiltrated </strong>through the <strong>cortex</strong>, <strong>lifted </strong>the<strong> periosteum</strong>,&nbsp;and <strong>extended through</strong> the <strong>epiphyseal plate</strong>, supports the diagnosis of <strong>osteosarcoma</strong>.</p>\n<p>A <strong>giant cell tumor </strong>(option A) is primarily an <strong>epiphyseal tumor</strong> that usually affects <strong>adults</strong> between ages<strong> 20 and 40 years</strong> when<strong> skeletal maturity</strong> is complete. <strong>Chondroblastoma</strong> (option B) is a benign tumor of childhood most commonly seen in the <strong>epiphysis</strong>. <strong>Osteoid osteoma</strong> (option C) is a benign tumor most commonly seen in the <strong>diaphysis</strong> of the <strong>proximal femur</strong>.</p>\n<p><strong>Osteosarcoma</strong> is the most common non-hematologic <strong>primary malignancy</strong> of bone. It occurs most commonly in the <strong>second decade </strong>of life. It is typically <strong>metaphyseal</strong>. The <strong>distal femur</strong>, proximal tibia, and proximal humerus are common sites.</p>\n<p><strong>Morphologically,</strong> osteosarcomas are<strong> bulky, gritty, gray-white tumors</strong>, often with <strong>hemorrhage</strong> and cystic degeneration. They<strong> destroy cortices</strong>, form soft tissue masses, and spread extensively in the medullary canal, replacing hematopoietic marrow. Although infrequent, they <strong>may also penetrate the epiphyseal plate</strong> or enter the joint.</p>\n<p>Radiological features:</p>\n<ul>\n<li><strong>Irregular destruction</strong> in the metaphysis overshadowed by the <strong>formation of new bone</strong></li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Lifting of the periosteum (Codman triangle)</strong> due to the formation of new bone inciting a <strong>periosteal reaction</strong></li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Bone formation along the blood vessels within the tumor centrifugally, giving rise to a <strong>sunburst (sunray) appearance</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/9afbe143844a44b0ba19e5aa598a4a8b.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/af7ddbd4af79443aa75742c7eee61230x1280x2155.JPEG"
    ]
  },
  {
    "text": "Which of the following substances is used for bone formation in a patient with non-union?",
    "choices": [
      {
        "id": 1,
        "text": "PMMA"
      },
      {
        "id": 2,
        "text": "BMP"
      },
      {
        "id": 3,
        "text": "Ca PO4"
      },
      {
        "id": 4,
        "text": "CaSO4"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Among the given options,<strong> bone morphogenic protein</strong> (BMP) is the substance used for <strong>bone formation </strong>in a patient with <strong>non-union</strong>.</p>\n<p>BMP is a <strong>bone-stimulating protein</strong> used as a bone graft in the treatment of <strong>non-union </strong>and <strong>open tibial fractures</strong>.</p>\n<p><strong>Bone grafts</strong> can be:&nbsp;</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Osteoinductive</strong>: They <strong>stimulate osteogenesis </strong>through the differentiation of mesenchymal cells into osteoprogenitor cells. <strong>BMPs </strong>are osteoinductive.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Osteoconductive</strong>: They <strong>provide linkage across defects</strong> and a scaffold upon which new bone can form. <strong>Calcium phosphate</strong> (Option C), <strong>calcium</strong> <strong>hydroxyapatite</strong>, and <strong>calcium sulfate </strong>(Option D) are osteoconductive.</li>\n</ul>\n<p><strong>Polymethylmethacrylate</strong> (PMMA), also known as <strong>bone cement</strong>, holds bone and metal implants together by forming an interlocking network between the irregularities.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The brace shown in the given image is _____.",
    "choices": [
      {
        "id": 1,
        "text": "Boston brace"
      },
      {
        "id": 2,
        "text": "Milwaukee brace"
      },
      {
        "id": 3,
        "text": "Taylor brace"
      },
      {
        "id": 4,
        "text": "ASHE brace"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Option D: <strong>ASHE brace </strong>(<strong>A</strong>nterior <strong>s</strong>pinal <strong>h</strong>yper<strong>e</strong>xtension brace) is used in <strong>dorso lumbar spinal injury</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e62bedff691049c5814fa3feab9ce2fa.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e9afc0c4ad2e4b06a44729dee539c316x1280x1280.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2b3438081dbe418fb173399e274c123bx720x720.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7997bc8460f245c79ee6571e4bc9643bx1280x1262.JPEG"
    ]
  },
  {
    "text": "A 40-year-old man is suffering from increasing difficulty in bending forward with increasing stiffness of the spine and reduced chest movements. A CT was performed and shown below, the likely diagnosis is?",
    "choices": [
      {
        "id": 1,
        "text": "Ankylosing spondylitis"
      },
      {
        "id": 2,
        "text": "Rheumatoid arthritis"
      },
      {
        "id": 3,
        "text": "Reiter's syndrome"
      },
      {
        "id": 4,
        "text": "Fluorosis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario of a <strong>40-year-old man</strong> with increasing <strong>stiffness in the spine</strong>, along with CT spine showing <strong>ossification </strong>of the<strong> anterior longitudinal ligament </strong>and<strong> ankylosis</strong>&nbsp;involving the<strong> thoracolumbar vertebral bodies</strong>&nbsp;points to a diagnosis of <strong>ankylosing spondylitis</strong> (AS).</p>\n<p>AS is a chronic inflammatory disease affecting the <strong>spine </strong>and <strong>sacroiliac joint</strong>. It is more common in <strong>young males</strong> and has a strong association with <strong>HLA-B27</strong>.</p>\n<p>Features of <strong>lower back pain</strong> in AS:</p>\n<ul>\n<li aria-level=\"1\"><strong>Age at onset &lt; 40 years</strong></li>\n<li aria-level=\"1\">Insidious onset</li>\n<li aria-level=\"1\"><strong>Morning stiffness &gt; 30 minutes</strong></li>\n<li aria-level=\"1\">Improvement with exercise</li>\n<li aria-level=\"1\">Pain persists with rest and is also present at night.</li>\n<li aria-level=\"1\">Alternating gluteal pain</li>\n<li aria-level=\"1\">Persistence for more than 3 months&nbsp;</li>\n</ul>\n<p>Examination findings in AS:</p>\n<ul>\n<li>Loss of lumbar lordosis</li>\n<li>Increased thoracic kyphosis</li>\n<li aria-level=\"1\"><strong>Diminished spinal movements</strong></li>\n<li aria-level=\"1\"><strong>Decreased chest expansion ( &lt;7 cm)</strong></li>\n<li aria-level=\"1\">Tenderness over sacroiliac joints</li>\n</ul>\n<p>Important X-ray features of ankylosing spondylitis:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Sacro-iliac joints:\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"2\"><strong>Cardinal sign/earliest sign </strong>is the <strong>erosion and fuzziness of the sacroiliac joints</strong></li>\n<li style=\"font-weight: 400;\" aria-level=\"2\">Later- periarticular sclerosis and <strong>bony ankylosis</strong> of the joint.</li>\n</ul>\n</li>\n<li>Vertebral changes:&nbsp;<br />\n<ul>\n<li>Early spondylitis is characterized by <strong>small erosions</strong> at the <strong>corners </strong>of<strong> vertebral bodies</strong> with <strong>reactive sclerosis</strong>: <strong>Romanus lesions </strong>of the spine<strong> (Shiny corner sign)</strong></li>\n<li><strong>Squaring </strong>of <strong>vertebral bodies</strong> or flattening of the normal anterior concavity of the spine due to inflammatory resorption of the bone.</li>\n<li class=\"p1\">Later signs are ossification of the ligaments around the intervertebral discs producing <strong>syndesmophytes (bridges)</strong> between adjacent vertebrae</li>\n<li class=\"p1\"><strong>Bamboo spine appearance</strong>&nbsp;is due to bridging at several vertebral levels</li>\n<li><strong>Linear ossification</strong> along the <strong>central spine, </strong>representing <strong>interspinous ligament</strong> ossification can give a <strong>Dagger sign</strong> appearance on frontal radiographs.</li>\n</ul>\n</li>\n</ul>\n<p>CT imaging in AS helps to visualize <strong>bone erosions, osteoporosis/osteosclerosis</strong>, and new bone formation in the form of <strong>syndesmophytes, ligamentous ossification, and ankylosis.</strong></p>\n<p>The X-ray below shows the bamboo spine appearance in AS:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/95e81f73114d485face95a145b6710b5.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e9c104bf06d1448194b3a509b22a565fx419x659.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ad0994b9667f4f399ff080de0f6d7a2fx600x2086.JPEG"
    ]
  },
  {
    "text": "In spine fusion surgery, the screws are fixed to which part of the vertebra?",
    "choices": [
      {
        "id": 1,
        "text": "Spinous process"
      },
      {
        "id": 2,
        "text": "Lamina"
      },
      {
        "id": 3,
        "text": "Pedicle"
      },
      {
        "id": 4,
        "text": "Facet joint"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The post-operative X-ray given below shows fusion of L5 and S1 vertebrae.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6beaf39ca3284402b00aa1e508d361cfx450x600.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4843ecbbe85a410b923f1a4d11119963x726x600.JPEG"
    ]
  },
  {
    "text": "Which of the following tests are not commonly used in osteoporosis:",
    "choices": [
      {
        "id": 1,
        "text": "1, 2 & 3"
      },
      {
        "id": 2,
        "text": "2 & 4"
      },
      {
        "id": 3,
        "text": "2 & 3"
      },
      {
        "id": 4,
        "text": "1, 3, 4 & 5"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Among the given options, bone scan and quantitative CT are <strong>not commonly used</strong> in the diagnosis of osteoporosis.&nbsp;</p>\n<p>Osteoporosis is a common metabolic bone disease characterised by a <strong>diffuse reduction in bone density</strong> due to a <strong>decrease in bone mass</strong>.</p>\n<p><strong>DEXA, chemical tests and X-ray </strong>are<strong> commonly used </strong>in the<strong> diagnosis of osteoporosis.</strong>&nbsp;While quantitative CT also helps to measure bone mass density at the spine and hip, it is rarely used clinically because the radiation exposure and cost are both much higher than with DXA.&nbsp;A bone scan uses a radioactive tracer injected into the bloodstream to detect altered metabolic activity in the bone with the aid of a gamma camera. It is not used in the diagnosis of osteoporosis.&nbsp;</p>\n<p><strong>DEXA</strong> - dual-energy X-ray absorptiometry, is the <strong>investigation of choice </strong>for the diagnosis of osteoporosis. <strong>T-score less than or equal to 2.5</strong> in the lumbar spine, femoral neck, or total hip indicates osteoporosis.</p>\n<p><strong>Chemical tests</strong> like <strong>serum calcium, phosphorus and alkaline phosphatase</strong> levels are usually<strong> normal in primary osteoporosis </strong>and help to <strong>rule out other conditions</strong> before establishing a diagnosis of osteoporosis.&nbsp;</p>\n<p><strong>X-ray</strong>&nbsp;features of osteoporosis:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Loss of vertical height of a vertebra </strong>occurs due to collapse</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Cod fish appearance</strong> characterized by the disc bulging into the adjacent vertebral bodies, resulting in a biconvex shape</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Ground glass appearance</strong> of the bones&nbsp;</li>\n</ul>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '244 Orthopedics Aiims 2020 (May And Nov Ini-Cet)';
        let hierarchy = ["Marrow", "PYQs", "Orthopedics"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>