<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Abdominal Mass Mini Test - -Tmt - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2024-25
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A 65-year-old male patient presents with complaints of a mass near his groin. Examination reveals a 4 cm-sized oval swelling above the right inguinal ligament, medial to the inferior epigastric vessels. Which of the following is the most likely underlying cause for this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Persistence of a patent processus vaginalis"
      },
      {
        "id": 2,
        "text": "Protrusion of viscus through the femoral ring"
      },
      {
        "id": 3,
        "text": "Acquired weakness of the abdominal wall"
      },
      {
        "id": 4,
        "text": "Protrusion of viscus through the linea alba"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical vignette of a 65-year-old man presenting with a 4-cm oval swelling <strong>above the right inguinal ligament</strong> is suggestive of an inguinal hernia. The swelling is <strong>medial</strong> to the <strong>inferior epigastric vessels</strong> which is suggestive of a\u00a0<strong>direct inguinal hernia</strong>.\u00a0The most probable underlying cause of a direct inguinal hernia is an <strong>acquired weakness of the abdominal wall</strong>.\u00a0</p>\n<p>Direct inguinal hernia is common in <strong>elderly</strong> patients through the area of the <strong>Hesselbach\u2019s triangle</strong>. It occurs as a result of acquired weakening and stretching of the abdominal wall. This area of the wall is weak as it consists of only the <strong>transversalis fascia</strong> covered by the <strong>external oblique aponeurosis</strong>.\u00a0</p>\n<p>The contents of a <strong>direct hernia</strong> protrude <strong>outward, forward</strong>, and <strong>medial</strong> to the <strong>inferior epigastric artery</strong> and the deep inguinal ring (in comparison to the contents of an indirect hernia which protrudes lateral to the inferior epigastric artery). A <strong>Lichtenstein mesh repair</strong> is currently one of the most frequently used methods for <strong>treating an inguinal hernia</strong>. It is an <strong>elective</strong> reconstruction of the inguinal floor in adults which consists of an anterior <strong>tension-free mesh repair</strong> that reduces the chances of recurrence of a hernia. A piece of prosthetic nonabsorbable mesh is used to bridge the defect in this repair.</p>\n<p>Other options:<strong><br /></strong>Option A: <strong>Persistence of a patent processus vaginalis</strong> is the underlying cause of an <strong>indirect</strong> inguinal hernia. The sac of an indirect inguinal hernia passes from the internal inguinal ring obliquely towards the external inguinal ring and then reaches the scrotum.</p>\n<p>Option B: <strong>Protrusion of the viscus through the femoral ring</strong>\u00a0is the underlying cause of a <strong>femoral</strong> hernia that is more commonly seen in elderly females. It presents as a swelling <strong>below the inguinal ligament</strong>, and\u00a0<strong>lateral to the pubic tubercle</strong>.</p>\n<p>Option D: <strong>Protrusion of viscus through the linea alba </strong>is the underlying cause of a <strong>paraumbilical</strong> hernia, located slightly around the umbilicus.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 68-year-old male patient presents with complaints of lower back pain and abdominal fullness. Examination reveals a palpable, expansile, and non-tender midline abdominal mass at the level of the umbilicus. Which of the following is an important risk factor for the development of this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Connective tissue disorder"
      },
      {
        "id": 2,
        "text": "History of untreated syphilis"
      },
      {
        "id": 3,
        "text": "Previous abdominal surgery"
      },
      {
        "id": 4,
        "text": "Cigarette smoking"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical vignette of an elderly\u00a068-year-old male patient presenting with complaints of\u00a0<strong>lower back pain</strong>, and examination findings of an<strong>\u00a0expansile,</strong>\u00a0and <strong>non-tender</strong> <strong>midline abdominal mass</strong> at the level of the umbilicus is suggestive of an\u00a0<strong>abdominal aortic aneurysm</strong>.\u00a0<strong>Cigarette smoking</strong> is one of the most important modifiable risk factors for the development of this condition.</p>\n<p><strong>Abdominal aortic aneurysms</strong>\u00a0are mostly asymptomatic and are detected as incidental findings on investigations for other complaints. However, as the aneurysm expands,\u00a0patients may present with <strong>lower back or abdominal pain</strong> and an associated <strong>pulsatile abdominal mass</strong> (like seen in this patient).\u00a0</p>\n<p>These aneurysms present more frequently in\u00a0<strong>males</strong> than females and their incidence increases with age. An important underlying cause for the development of this condition is <strong>atherosclerosis</strong>. <strong>Smoking</strong> is considered one of the strongest risk factors for the development of this condition.\u00a0</p>\n<p><strong>Abdominal ultrasound</strong> is a useful initial test for screening. <strong>CT abdomen with contrast</strong> is the preferred investigation of choice to determine the location and size of the aneurysm, which helps guide further management.\u00a0</p>\n<p><strong>Rupture</strong> of the aneurysm is a dreaded complication and usually presents with shock and hypotension. It usually occurs when the size of the aneurysm is <strong>more than 5.5 cm</strong>.\u00a0</p>\n<p>Other options:<br />Options A and B: <strong>Connective tissue disorders</strong> such as Marfan syndrome and a <strong>history of</strong> <strong>untreated syphilis</strong>\u00a0causing tertiary syphilis are important risk factors for <strong>thoracic aortic aneurysms</strong>.</p>\n<p>Option C:<strong> Previous abdominal surgery </strong>does not increase the risk of aortic aneurysm.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 4-year-old child presents with complaints of fever, hematuria, and an abdominal mass. Examination reveals a right-sided, ballotable flank mass, which is smooth, firm, and non-tender on palpation and does not cross the midline. Which of the following is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Nephroblastoma"
      },
      {
        "id": 2,
        "text": "Neuroblastoma"
      },
      {
        "id": 3,
        "text": "Renal cell carcinoma"
      },
      {
        "id": 4,
        "text": "Hepatoblastoma"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical vignette of a\u00a0<strong>4-year-old</strong>\u00a0child presenting with <strong>fever</strong>, <strong>hematuria</strong>, and a <strong>ballotable</strong>,\u00a0<strong>unilateral</strong>\u00a0flank mass, which is <strong>smooth</strong>, and <strong>non-tender</strong> is suggestive of a <strong>nephroblastoma</strong> (<strong>Wilms tumor</strong>).</p>\n<p><strong>Wilms tumor</strong>\u00a0is the\u00a0<strong>most common </strong>primary <strong>malignant\u00a0renal</strong> tumor in children and is the\u00a0<strong>second most common</strong>\u00a0<strong>malignant abdominal tumor</strong>\u00a0in\u00a0<strong>children</strong>. The clinical presentation usually involves an asymptomatic\u00a0<strong>abdominal mass</strong>,<strong>\u00a0</strong>hypertension, abdominal pain, and gross<strong>\u00a0painless hematuria</strong>. Constitutional symptoms of fever, anorexia, and weight loss can also be present at the time of diagnosis. <strong>Thrombus</strong> from the tumor extends into the <strong>inferior vena cava (IVC)</strong> in 4\u201310% of patients and may produce a fatal pulmonary embolism.</p>\n<p>The tumor arises due to loss of function mutation of the<strong>\u00a0WT1</strong>\u00a0(Wilm's tumor 1)<strong>\u00a0gene</strong>.\u00a0Noteworthy associated syndromes and their features include:</p>\n<ul>\n<li><strong>WAGR syndrome</strong>:\u00a0<strong>W</strong>ilms tumor,\u00a0<strong>a</strong>niridia,\u00a0<strong>g</strong>enitourinary abnormalities, mental\u00a0<strong>r</strong>etardation</li>\n<li><strong>Denys-Drash syndrome</strong>: Early-onset\u00a0renal failure, gonadal dysgenesis /\u00a0male pseudohermaphroditism</li>\n<li><strong>Beckwith-Weidemann syndrome</strong>:\u00a0Hemihypertrophy<strong>, </strong>organomegaly, macroglossia</li>\n</ul>\n<p>Diagnosis involves imaging studies such as\u00a0<strong>USG Abdomen\u00a0</strong>with <strong>Doppler</strong>\u00a0for evaluation of the collecting system and to look for <strong>tumor thrombi</strong> in renal veins and inferior vena cava.\u00a0<strong>CECT abdomen </strong>is used\u00a0to identify the extent of the disease, to access the contralateral kidney, and for metastasis. Management is surgical and involves a radical or partial <strong>nephrectomy,</strong> according to patient presentation.</p>\n<p>Other options:<br />Option B:<strong> Neuroblastoma</strong>\u00a0is also commonly seen in children of <strong>preschool age.</strong>\u00a0Affected children commonly present with a\u00a0<strong>palpable, irregular abdominal mass\u00a0</strong>that is large and <strong>may cross the midline</strong>. It presents with associated clinical features of gastrointestinal/genitourinary obstruction,\u00a0diarrhea, skin nodules, and characteristic\u00a0<strong>paraneoplastic symptoms</strong> (\"raccoon eyes,\" myoclonus-opsoclonus).</p>\n<p>Option C:<strong> Renal cell carcinoma</strong>\u00a0is the most common malignant tumor of the kidney in <strong>adults</strong>. It usually occurs in the age group\u00a0<strong>50-70 years.\u00a0</strong>It is unlikely to be the cause of this child's renal mass and symptoms.</p>\n<p>Option D: <strong>Hepatoblastoma</strong>\u00a0would present as a right upper quadrant mass and jaundice in children below 3 years of age. It is unlikely to present as a ballotable flank mass, as seen in this case.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 25-year-old patient presents with complaints of fever, intermittent periumbilical pain, and nausea for the past 2 days. Abdominal examination reveals an ill-defined mass in the right iliac fossa which is very tender to palpation. What is the next best step in the management of this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Emergency appendectomy"
      },
      {
        "id": 2,
        "text": "Surgical drainage of the abscess"
      },
      {
        "id": 3,
        "text": "Intravenous antibiotics and analgesics"
      },
      {
        "id": 4,
        "text": "Oral antibiotics and outpatient follow-up"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario of a 25-year-old patient presenting with <strong>fever</strong>, intermittent <strong>periumbilical pain</strong>,\u00a0<strong>nausea</strong>, and a <strong>tender</strong> and <strong>ill-defined mass</strong> in the <strong>right iliac fossa</strong>\u00a0is suggestive of an\u00a0<strong>appendicular mass</strong>. The best next step in the management of this patient is conservative management with the\u00a0<strong>Ochsner\u2013Sherren regimen\u00a0</strong>which includes <strong>intravenous antibiotics and analgesics</strong>.</p>\n<p>An <strong>appendicular mass\u00a0</strong>may develop following acute appendicitis when the greater omentum and loops of the small bowel become adherent to the inflamed appendix to wall off the spread of peritoneal contamination, resulting in a phlegmonous mass or paracaecal abscess.\u00a0</p>\n<p><strong>CT scan</strong> of the abdomen is necessary for diagnosis and to know about the initial size of the appendicular mass. The management for an appendicular mass is conservative with the <strong>Ochsner\u2013Sherren regimen.\u00a0</strong>This is based on the fact\u00a0that the inflammatory process is already localized and surgery may be dangerous. It may be very difficult to locate the appendix and surgical complications like fecal fistula are a concern.\u00a0For these reasons, the immediate management is non-operative. Surgical intervention is reserved for clinical deterioration.</p>\n<p>The Ochsner\u2013Sherren regimen comprises\u00a0<strong>hospitalization, intravenous fluids, antibiotics, analgesics, </strong>and a strict watch on the<strong> vitals and general state of the patient</strong>. In 90% of the patients, the mass resolves without complications.</p>\n<p>After conservative management, a <strong>CT scan follow-up</strong> should be done to check for complete resolution of the mass. Following successful management of appendicular mass, removal of the appendix is advised by\u00a0<strong>interval appendectomy</strong>\u00a0in\u00a0<strong>6-8 weeks.</strong></p>\n<p>Other options:<br />Option A: <strong>Emergency appendectomy</strong>\u00a0is the treatment of choice for acute appendicitis without an appendicular mass. However, due to the reasons discussed above (localized inflammation and difficult surgery), surgical intervention for an appendicular mass is reserved for <strong>worsening patient vitals</strong>,\u00a0increasing or spreading <strong>abdominal pain,\u00a0</strong>or\u00a0<strong>increasing size of the mass</strong>.</p>\n<p>Drainage of an abscess may be required. However, open <strong>surgical drainage</strong> (Option B) is not preferred, and radiologically guided drainage is the preferred method.\u00a0</p>\n<p>Option D:<strong> Oral antibiotics and outpatient follow-up</strong>\u00a0are not recommended due to the chances of the patient worsening, and the continued need for monitoring patient vitals and the size of the appendicular mass.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 4-week-old male infant presents with complaints of non-bilious vomiting for the past 2 days. Examination reveals a lethargic infant with signs of dehydration, and an associated firm and mobile mass in the right upper quadrant of the abdomen just beneath the liver edge. Which of the following is the definitive management for this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Swenson procedure"
      },
      {
        "id": 2,
        "text": "Ramstedt procedure"
      },
      {
        "id": 3,
        "text": "Kasai procedure"
      },
      {
        "id": 4,
        "text": "Bishop-Koop procedure"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical vignette of a <strong>4-week-old</strong> male infant\u00a0presenting with non-bilious\u00a0<strong>vomiting</strong>,\u00a0<strong>lethargy,</strong> and <strong>signs of dehydration</strong>, with an associated <strong>firm and mobile mass</strong> in the <strong>right upper quadrant</strong> of the <strong>abdomen</strong> just <strong>beneath the liver edge</strong> is suggestive of\u00a0<strong>infantile hypertrophic pyloric stenosis</strong>. The definitive management for this condition is the\u00a0<strong>Ramstedt</strong> procedure involving a <strong>pyloromyotomy</strong>.</p>\n<p><strong>Pyloric stenosis</strong> presents with <strong>non-bilious,</strong> <strong>projectile</strong>\u00a0<strong>vomiting</strong> starting between 2 and 6 weeks of age.\u00a0As vomiting continues, it worsens in frequency and forcefulness, resulting in a progressive loss\u00a0of fluid, hydrogen ions, and chloride, leading to <strong>dehydration</strong> and <strong>hypochloremic metabolic alkalosis</strong>.</p>\n<p>A characteristic feature aiding diagnosis is the presence of an <strong>abdominal mass</strong>, usually just <strong>below the liver edge</strong>. The mass is <strong>firm</strong>, <strong>movable</strong>, approximately 2 cm in length, and described as '<strong>olive-shaped</strong>.'\u00a0The mass is best palpated after an episode of vomiting. After feeding, there may be a <strong>visible gastric peristaltic wave</strong> that progresses across the abdomen.\u00a0</p>\n<p><strong>Ultrasound examination</strong> confirms the <strong>diagnosis</strong> in the majority of cases. Criteria for diagnosis include a <strong>pyloric thickness </strong>of<strong> 3-4 mm</strong>, an overall <strong>pyloric length</strong> of <strong>15-19 mm</strong>, and a <strong>pyloric diameter</strong> of <strong>10-14 mm</strong>. USG may show the characteristic\u00a0<strong>cervix sign</strong>\u00a0and\u00a0<strong>nipple sign.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/379a8eced9fc4f509811fbf150d6745fx601x312.PNG"
    ]
  },
  {
    "text": "A 2-year-old male child presents with complaints of intermittent abdominal pain and vomiting for the past 1 day. Examination reveals a firm, tender, and slightly curved longitudinal mass in the right upper abdomen, which increases in size during the episodes of abdominal pain. Radiological imaging on a contrast enema is given below. What is the most probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Acute gastroenteritis"
      },
      {
        "id": 2,
        "text": "Hypertrophic pyloric stenosis"
      },
      {
        "id": 3,
        "text": "Necrotizing enterocolitis"
      },
      {
        "id": 4,
        "text": "Intussusception"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical vignette of a\u00a0<strong>2-year-old</strong> male child with complaints of <strong>intermittent abdominal pain,</strong>\u00a0<strong>vomiting,</strong> and a <strong>firm, tender</strong>, and slightly <strong>curved</strong> <strong>longitudinal mass</strong>\u00a0(\"<strong>sausage-shaped</strong>\") in the <strong>right upper abdomen</strong> is suggestive of <strong>intussusception</strong>. The radiological image\u00a0showing the characteristic\u00a0<strong>coiled spring appearance</strong>\u00a0(barium in the lumen of the intussusceptum and in the intraluminal space) is also suggestive of the same.</p>\n<p>Intussusception occurs when a portion of the alimentary tract is <strong>telescoped</strong> into an adjacent segment. It is the <strong>most common cause of intestinal obstruction</strong> between <strong>5 months and 3 years of age</strong>.\u00a0The most common location of intussusception is\u00a0<strong>ileocolic</strong>.\u00a0</p>\n<p>The combination of <strong>paroxysmal abdominal pain</strong>, <strong>vomiting</strong>, and a <strong>palpable abdominal\u00a0mass</strong> is a highly characteristic clinical presentation; the presence<br />of associated rectal bleeding invariably confirms the diagnosis.\u00a0Palpation of the abdomen usually reveals a slightly <strong>tender</strong>,\u00a0\"<strong>sausage-shaped</strong>\" mass, sometimes ill-defined, which might <strong>increase in size during an episode of pain</strong>\u00a0and is most often in the <strong>right upper abdomen</strong>, with its longitudinal axis cephalocaudal. However, approximately 30% of patients do not have a palpable mass.<br /><br /><strong>USG abdomen</strong> is useful to confirm the diagnosis. The findings include:</p>\n<ul>\n<li>Target sign/<strong>\u00a0</strong>doughnut sign/ bull's eye sign</li>\n<li>Pseudo kidney sign</li>\n<li>Crescent in a doughnut sign.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/1f2107ef1a30480f8d28e84e0e50378f.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d81d8af7dc2c42c1847e0212ef827ddfx720x598.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/322a6381b6a84dfd93a2fda7c2454257x1144x1136.PNG"
    ]
  },
  {
    "text": "A 60-year-old male patient presents with chief complaints of abdominal pain with an associated abdominal mass after a severe bout of coughing. He has a history of chronic bronchitis and atrial fibrillation and is on oral anticoagulants. Abdominal examination reveals an ill-defined mass in the right lower quadrant with increasing pain on tensing the abdominal muscles. Which of the following clinical signs do you expect to find in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Ransohoff's sign"
      },
      {
        "id": 2,
        "text": "Fothergill\u2019s sign"
      },
      {
        "id": 3,
        "text": "Blumberg's sign"
      },
      {
        "id": 4,
        "text": "Aaron\u2019s sign"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical vignette of a <strong>60-year-old male</strong> who presents with <strong>abdominal pain</strong> and a <strong>right lower quadrant mass</strong> with <strong>increasing pain</strong> on <strong>tensing the abdominal muscles</strong> is suggestive of a <strong>rectus sheath hematoma</strong>. Chronic pulmonary disease (eg, chronic bronchitis) resulting in <strong>coughing fits</strong> and a history of <strong>anticoagulant use</strong> are important risk factors for the development of this condition. A characteristic <strong>clinical sign</strong> is the palpation findings <strong>do not change during contraction of the rectus muscle</strong> and the mass becomes fixed, known as <strong>Fothergill\u2019s sign</strong>.</p>\n<p>A <strong>rectus sheath hematoma</strong> arises from a disruption of one of the branches of the <strong>inferior epigastric artery</strong>. This is more common in older patients with a history of anticoagulant use due to <strong>weakness of the rectus sheath</strong> to tamponade the hemorrhage.\u00a0<strong>Trauma</strong> to the abdominal wall, including iatrogenic trauma can also lead to the disruption of the vessel and a hematoma formation.\u00a0</p>\n<p>It usually presents with <strong>abdominal pain</strong> and a <strong>tender lower abdominal mass</strong>. The pain increases on tensing the abdominal muscles. The <strong>Fothergill\u2019s sign</strong> is said to be present if a mass remains palpable and becomes fixed when the rectus muscles are contracted.</p>\n<p><strong>Ultrasound</strong> or <strong>CT scan</strong> with intravenous contrast are useful in diagnosis. The <strong>management</strong> depends on the <strong>hemodynamic stability</strong> of the patient and ranges from conservative management and observation for stable patients to angiographic embolization or surgical intervention for those presenting with hemodynamic instability.</p>\n<p>Other options<br />Option A: <strong>Ransohoff's sign</strong> is the yellow discoloration of the umbilical region\u00a0seen in a\u00a0<strong>ruptured common bile duct.</strong></p>\n<p>Option C: <strong>Blumberg's sign</strong> is the transient abdominal wall rebound tenderness associated with\u00a0<strong>peritoneal inflammation.</strong></p>\n<p>Option D: <strong>Aaron\u2019s sign\u00a0</strong>is pain or pressure in the epigastrium or anterior chest with persistent firm pressure applied to the Mcburney point seen in <strong>acute appendicitis.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 65-year-old male patient who has recently been diagnosed with diabetes presents with complaints of upper abdominal discomfort, anorexia, and jaundice for the past 1 month. Abdominal examination reveals a soft, globular mass in the right upper quadrant, just below the liver edge. Which of the following is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Cholelithiasis"
      },
      {
        "id": 2,
        "text": "Chronic cholecystitis"
      },
      {
        "id": 3,
        "text": "Pancreatic adenocarcinoma"
      },
      {
        "id": 4,
        "text": "Hepatocellular carcinoma"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario of a <strong>65-year-old male</strong> presenting with <strong>upper abdominal discomfort</strong>, <strong>anorexia</strong>, <strong>jaundice</strong>, and a <strong>palpable gallbladder\u00a0</strong>known as the Courvoisier's sign\u00a0(soft, globular mass in the right upper quadrant that moves with respiration) is highly suggestive of <strong>pancreatic adenocarcinoma</strong>. An <strong>elderly</strong> patient with <strong>recently diagnosed diabetes</strong> presenting with the above symptoms should raise suspicion for the same.</p>\n<p><strong>Pancreatic ductal adenocarcinomas</strong> arise most commonly in the <strong>head</strong> of the gland. This usually presents with jaundice.\u00a0<strong>Courvoisier's law</strong>\u00a0states that in the presence of a <strong>painless, palpable, enlarged gallbladder</strong> and mild jaundice,\u00a0the cause is <strong>unlikely to be gallstones</strong>\u00a0because the common bile duct obstruction by gallstones would lead to a\u00a0<strong>shrunken</strong>\u00a0<strong>fibrotic</strong>\u00a0<strong>gallbladder</strong>. The gallbladder is enlarged in conditions causing a slow occlusion, as in\u00a0<strong>tumors</strong>\u00a0surrounding the distal common bile duct, which implicates possible cancer of the head of the pancreas.</p>\n<p>The <strong>exceptions</strong> to the Courvoisier's<strong>\u00a0</strong>law include:</p>\n<ul>\n<li>Double impacted stones (stones in both the cystic duct and the distal common bile duct)</li>\n<li>Primary CBD stone</li>\n<li>Oriental cholangiohepatitis\u00a0</li>\n<li>Mirizzi's syndrome</li>\n</ul>\n<p>Other options<br />Option A: <strong>Cholelithiasis</strong> or gallstones are unlikely to be associated with a palpable gallbladder, as stated above, due to an associated shrunken and fibrotic gallbladder.</p>\n<p>Option B: <strong>Chronic cholecystitis</strong> would be associated with chronic irritation and inflammation of the gallbladder wall and would also result in a shrunken gallbladder.</p>\n<p>Option D: <strong>Hepatocellular carcinoma</strong> can also present with upper abdominal discomfort, anorexia, and jaundice. However, it will not be associated with a palpable gallbladder. Rather, it causes tender hepatomegaly.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 35-year-old female patient presents with complaints of chronic cough, weight loss, and evening rise of temperature. On examination, there is a palpable, ill-defined mass in the right iliac fossa and a doughy consistency of the abdomen prompting a suspicion of intestinal tuberculosis. Which of the following is the most likely site involved in this presentation?",
    "choices": [
      {
        "id": 1,
        "text": "Sigmoid colon"
      },
      {
        "id": 2,
        "text": "Ascending colon"
      },
      {
        "id": 3,
        "text": "Distal ileum and caecum"
      },
      {
        "id": 4,
        "text": "Jejunum"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario of a 35-year-old female patient\u00a0presenting with <strong>chronic cough</strong>, <strong>weight loss</strong>, <strong>evening rise of temperature</strong>, and examination revealing an\u00a0ill-defined <strong>mass in the right iliac fossa</strong> with a '<strong>doughy</strong>' consistency of the abdomen is highly suggestive of\u00a0<strong>intestinal tuberculosis.\u00a0</strong>The most common sites of involvement in this condition are the <strong>distal ileum and caecum.</strong></p>\n<p>Intestinal tuberculosis can be caused by the <strong>swallowing of infected sputum</strong> in a patient with pulmonary tuberculosis, drinking infected unpasteurized milk, or by a hematogenous spread from the primary site.\u00a0There are two types: <strong>ulcerative</strong> and <strong>hyperplastic</strong>. Both types\u00a0may be associated with marked <strong>mesenteric lymphadenopathy</strong>.</p>\n<p>The <strong>hyperplastic type\u00a0</strong>is characterized by a\u00a0marked inflammatory reaction causing <strong>hyperplasia and thickening of the terminal ileum</strong> because of its abundance of lymphoid follicles. Patients usually present with <strong>weight loss</strong>, <strong>chronic cough</strong>, <strong>malaise</strong>, <strong>evening rise in temperature</strong>, alternating constipation and diarrhea, and <strong>intermittent abdominal pain</strong> with <strong>distension</strong>. Ileocaecal tuberculosis may present with a <strong>right iliac fossa mass</strong> and features of <strong>intestinal obstruction</strong>. The patient looks chronically ill, and the abdomen may have a <strong>'doughy' feel</strong> due to\u00a0areas of localized ascites.</p>\n<p>Important differentials for a right iliac fossa mass include an appendicular mass, lymphoma, carcinoma of the caecum, Crohn's disease, tuberculosis, or actinomycosis. A <strong>barium follow-through</strong> or <strong>small bowel enema</strong> in intestinal tuberculosis will show a long, narrow filling defect in the terminal ileum (<strong>string sign</strong>) with a shrunken and <strong>pulled-up cecum</strong>. <strong>CT</strong> will also demonstrate the narrowed segment with proximal distension and the associated lymphadenopathy. When a patient presents without features of obstruction,\u00a0antituberculous medication is advised and may be curative. When signs of <strong>obstruction</strong> are present, surgical intervention in the form of\u00a0<strong>ileocaecal resection</strong> is often required.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An elderly male patient presents with complaints of painless hematuria for the past 1 month. Examination reveals a right flank mass, that is firm, non-tender, and moves with respiration. There is an associated non-reducing, right-sided varicocele. Which of the following is the investigation of choice for the diagnosis of this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Abdominal ultrasound with doppler"
      },
      {
        "id": 2,
        "text": "Triphasic CECT abdomen"
      },
      {
        "id": 3,
        "text": "Laparoscopic exploration"
      },
      {
        "id": 4,
        "text": "Erect abdominal X-ray"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical presentation of an elderly male presenting with <strong>painless hematuria</strong>, <strong>right renal mass</strong> (firm, non-tender, right flank mass that moves with respiration), and\u00a0an associated <strong>non-reducing, right-sided varicocele</strong>\u00a0is suggestive of\u00a0<strong>renal cell carcinoma (RCC)</strong><strong>.</strong>\u00a0The <strong>investigation of choice</strong> for <strong>diagnosis</strong> and staging of RCC is a <strong>triphasic CECT</strong>\u00a0<strong>abdomen</strong>.</p>\n<p><strong>RCC</strong>\u00a0is the <strong>most common</strong> <strong>malignant</strong> tumor of the kidney that usually presents in the elderly. <strong>Cigarette smoking</strong> and<strong> hypertension</strong> are major associated risk factors. The classic triad of presentation is with<strong>\u00a0</strong><strong>flank pain</strong>, <strong>macroscopic\u00a0</strong><strong>haematuria,</strong> and a <strong>palpable flank mass</strong>.\u00a0Advanced cases can also present with bilateral <strong>lower limb edema</strong> or a <strong>non-reducing, right-sided varicocele</strong> owing to a <strong>thrombus</strong> in the <strong>IVC</strong>.</p>\n<p><strong>Triphasic contrast-enhanced CT</strong>\u00a0is the investigation of choice for RCC (image given below). On CT, small lesions\u00a0<strong>enhance</strong>\u00a0homogeneously, whereas\u00a0<strong>larger</strong>\u00a0lesions have\u00a0<strong>irregular enhancement</strong>\u00a0due to areas of necrosis.\u00a0The CT also provides additional information on the function of the opposite kidney, primary <strong>tumor extension</strong>, <strong>venous involvement</strong>, enlargement\u00a0of regional <strong>lymph nodes</strong>, the status of the adrenal glands, and intra-abdominal <strong>metastatic disease</strong>.\u00a0Contrast-enhanced MRI is the investigation of choice for detecting vascular invasion of RCC.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0ccdf626947a4e7aae1b2e6f438b866fx607x630.JPEG"
    ]
  },
  {
    "text": "A 35-year-old female patient presents with an enlarging abdominal mass at the site of previous trauma for the past 1 month. The mass is firm and non-tender. After initial imaging, a core needle biopsy reveals the following histological findings. Which of the following conditions is associated with this presentation?",
    "choices": [
      {
        "id": 1,
        "text": "von Hippel\u2013Lindau syndrome"
      },
      {
        "id": 2,
        "text": "Familial adenomatous polyposis"
      },
      {
        "id": 3,
        "text": "Peutz-Jeghers syndrome"
      },
      {
        "id": 4,
        "text": "Cowden syndrome"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario of a\u00a035-year-old <strong>female</strong> patient presenting with\u00a0an enlarging, firm, and non-tender <strong>abdominal mass\u00a0</strong>and histological findings of\u00a0long <strong>spindle cells in a</strong>\u00a0<strong>collagenous stroma</strong>\u00a0are suggestive of\u00a0<strong>desmoid tumor.\u00a0</strong>These tumors are associated with <strong>familial adenomatous polyposis (FAP)</strong>.</p>\n<p>Desmoid tumors (also known as aggressive fibromatosis) are <strong>fibroblastic neoplasms</strong> with <strong>aggressive infiltrative behavior</strong> but <strong>no metastatic potential</strong>. 10% to 15% of patients with FAP develop desmoid tumors. The risk is even greater for patients with <strong>Gardner's syndrome</strong>. Risk factors for sporadic disease include <strong>previous surgical incision</strong>, <strong>pregnancy</strong>, <strong>hormonal exposure</strong>, and <strong>trauma</strong>. They occur more commonly in <strong>females</strong>.\u00a0</p>\n<p>These tumors can occur anywhere in the body but are<strong> most common </strong>in the<strong> abdomen</strong> and <strong>abdominal wall</strong>.\u00a0They present as <strong>firm</strong>, <strong>painful,</strong> or <strong>non-painful masses</strong>, which may be either <strong>slow</strong> or <strong>rapidly growing</strong>.\u00a0</p>\n<p>The investigation of choice is\u00a0<strong>MRI</strong>. Histopathological diagnosis is done by a core-needle or incisional biopsy. Management involves <strong>observation</strong>\u00a0for stable, asymptomatic, or recurrent desmoids.\u00a0<strong>Surgery</strong> is indicated for patients with symptomatic disease, risk of invasion, or enlarging tumors.</p>\n<p>Other options:</p>\n<p>Option A: <strong>von Hippel\u2013Lindau syndrome</strong>\u00a0is associated with renal cell carcinoma, hemangioblastomas of the retina and central nervous system, and pheochromocytoma.</p>\n<p>Option C: <strong>Peutz-Jeghers syndrome</strong> is associated with\u00a0gastrointestinal carcinomas, breast cancer, testicular cancer, pancreatic cancer, and benign pigmentation of the skin and mucosa.</p>\n<p>Option D: <strong>Cowden syndrome</strong> is associated with cancer of the breast, endometrium, and thyroid.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/f9719b9beaff4d849441c20b44cb2123.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 14-year-old patient presents with complaints of fever, myalgias, and a sore throat for the past 1 week. Examination reveals a palpable left upper quadrant abdominal mass, which is smooth, firm, and with a notch on the medial surface. Which of the following is the most likely causative agent?",
    "choices": [
      {
        "id": 1,
        "text": "HHV - 1"
      },
      {
        "id": 2,
        "text": "HHV - 3"
      },
      {
        "id": 3,
        "text": "HHV - 4"
      },
      {
        "id": 4,
        "text": "HHV - 6"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario of an <strong>adolescent</strong> presenting with <strong>fever</strong>, <strong>myalgias</strong>, <strong>sore throat,</strong> and\u00a0<strong>splenomegaly</strong> (a\u00a0palpable <strong>left upper quadrant</strong> abdominal mass, which is <strong>smooth</strong>, <strong>firm</strong>, and with a <strong>characteristic notch</strong> on the <strong>medial surface</strong>)<strong>\u00a0</strong>is suggestive of <strong>infectious mononucleosis (IM).</strong> The causative agent behind the condition is\u00a0<strong>HHV-4\u00a0</strong>(<strong>Epstein-Barr virus</strong>).</p>\n<p>IM most commonly presents in adolescents with initial symptoms of\u00a0<strong>fever</strong>, <strong>sore throat</strong>,\u00a0<strong>fatigue</strong>, <strong>myalgia</strong>, and <strong>malaise</strong>.\u00a0<strong>Pharyngitis</strong> is often the most prominent sign, with the <strong>enlargement of the tonsils</strong>\u00a0and an <strong>exudate</strong> resembling that of streptococcal pharyngitis. It can be associated with tender, <strong>posterior cervical\u00a0lymphadenopathy</strong>.\u00a0</p>\n<p><strong>Splenomegaly</strong> most commonly occurs during the second and third week after initial symptoms. The spleen\u00a0enlarges from under the left costal margin <strong>down and medially</strong> toward the umbilicus.\u00a0A <strong>characteristic notch</strong>\u00a0on the medial surface\u00a0helps differentiate it from an enlarged left kidney. The mass is firm, smooth, regular in shape, and moves with respiration.</p>\n<p>Laboratory investigations in IM demonstrate an <strong>elevated white blood cell count</strong> with <strong>lymphocytosis</strong> and <strong>&gt;10% atypical lymphocytes</strong>.<strong>\u00a0</strong>The <strong>diagnostic test</strong> for this condition is the\u00a0<strong>Paul Bunnell test</strong>,\u00a0a\u00a0<strong>heterophile antibody reaction test</strong>. In IM,\u00a0heterophile antibodies\u00a0can usually be demonstrated by the end of the first week of illness.</p>\n<p>Most cases are <strong>self-limiting</strong>. However, <strong>splenic rupture</strong> is a rare but possible complication due to the associated splenomegaly. It is a potentially fatal condition, and patients are thus advised to avoid contact sports for at least 4 weeks from diagnosis.</p>\n<p>Other options:<br />Option A: <strong>HHV-1 </strong>or the <strong>herpes simplex virus type 1</strong> causes oral and/ or genital herpes (mainly orofacial).</p>\n<p>Option B:<strong> HHV-3 </strong>or the <strong>varicella-zoster virus</strong> causes chickenpox\u00a0and\u00a0shingles.</p>\n<p>Option C:<strong> HHV-6 </strong>or the <strong>human B-cell lymphotropic virus</strong> causes roseola infantum\u00a0or exanthema subitum.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 2-year-old child presents with abdominal distension, pain, and periorbital ecchymoses. On examination, a large, non-tender, firm, and irregular mass is palpated crossing the midline. The amplification of which of the following oncogenes is associated with a poor prognosis in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Bcl-2"
      },
      {
        "id": 2,
        "text": "MYCN"
      },
      {
        "id": 3,
        "text": "c-KIT"
      },
      {
        "id": 4,
        "text": "KRAS"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario of a\u00a02-year-old child with <strong>abdominal distension</strong>, <strong>pain</strong>,\u00a0<strong>periorbital ecchymoses</strong>, and a\u00a0<strong>large</strong>, <strong>non-tender</strong>, <strong>firm</strong>, and <strong>irregular</strong>\u00a0<strong>abdominal mass</strong> crossing the midline is suggestive of\u00a0<strong>neuroblastoma.\u00a0</strong>Amplification of <strong>MYCN (N-myc) proto-oncogene</strong> is associated with a <strong>poor prognosis</strong> in this condition.</p>\n<p>Neuroblastoma is the <strong>most common</strong> <strong>extracranial solid tumor</strong> in children.\u00a0It is derived from\u00a0<strong>primordial neural crest cells</strong>.\u00a0It most commonly arises from the\u00a0<strong>adrenal glands</strong>, followed by sites along the sympathetic chain, such as the paravertebral region of the abdomen and posterior mediastinum.</p>\n<p>When they originate from the adrenals, these tumors present with <strong>abdominal distension</strong> and <strong>pain</strong>. The associated <strong>abdominal mass</strong> is large, irregular, and crosses the midline in the majority of cases.\u00a0<strong>Metastatic disease</strong> can cause\u00a0fever, irritability, failure to thrive, bone pain, cytopenias, bluish subcutaneous nodules, orbital proptosis, and <strong>periorbital ecchymoses</strong>.</p>\n<p><strong>CT</strong> or <strong>MRI</strong> are useful in evaluating the mass, which often shows areas of <strong>calcification</strong> and <strong>hemorrhage</strong>.\u00a0Tumor markers such as <strong>homovanillic acid (HVA)</strong> and <strong>vanillylmandelic acid (VMA)</strong>\u00a0are elevated in the urine of the majority\u00a0of patients and help to confirm the diagnosis. A biopsy of the tumor reveals the presence of\u00a0<strong>small round blue cells\u00a0</strong>with\u00a0<strong>Homer-Wright pseudorosettes</strong>\u00a0(shown below).<strong>\u00a0</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/99a682da4da84e2ab0dccb49de98e2e0x800x570.JPEG"
    ]
  },
  {
    "text": "A newborn male is found to have a left-sided flank mass. Ultrasound abdomen reveals left grade 4 hydronephrosis. The right kidney appears normal. What is the likely underlying cause of this presentation?",
    "choices": [
      {
        "id": 1,
        "text": "Retrocaval ureter"
      },
      {
        "id": 2,
        "text": "Midureteral valve"
      },
      {
        "id": 3,
        "text": "Ureteropelvic junction obstruction"
      },
      {
        "id": 4,
        "text": "Posterior urethral valves"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical vignette of a newborn <strong>male</strong>\u00a0presenting with a <strong>left renal mass</strong> with associated <strong>grade 4 hydronephrosis</strong> on ultrasound likely has <strong>ureteropelvic junction obstruction</strong>.</p>\n<p>The <strong>most common cause</strong> of an <strong>abdominal mass</strong> in <strong>newborns</strong> is <strong>hydronephrosis</strong> due to\u00a0<strong>congenital pelviureteric junction obstruction (PUJO)</strong>. PUJO is more common in <strong>males</strong> and occurs more frequently on the <strong>left</strong> side.\u00a0</p>\n<p>Most cases of PUJO\u00a0with associated hydronephrosis are now <strong>detected before birth</strong> with antenatal ultrasound. If undetected, it <strong>presents in infancy</strong> as a <strong>palpable\u00a0</strong><strong>renal mass</strong>. Associated presentations include abdominal or flank pain, febrile UTI, or hematuria after minimal trauma.</p>\n<p><strong>Ultrasound abdomen</strong> is useful to grade the severity and persistence of hydronephrosis which in turn guides management.\u00a0<strong>Mild cases</strong> with <strong>grade 1 or 2 hydronephrosis\u00a0</strong>and normal renal parenchyma are managed with observation and subsequent renal ultrasound studies to monitor the severity.</p>\n<p>However, most cases present with <strong>grade 3 or 4 hydronephrosis</strong> in which <strong>spontaneous resolution is less likely</strong>. These cases require a surgical correction\u00a0in which the stenotic segment is excised, and the normal ureter and renal pelvis are reattached. This procedure is known as a <strong>pyeloplasty</strong>.\u00a0</p>\n<p>Other options:<br />Option A: <strong>Retrocaval ureter </strong>is an anomaly in which the upper right ureter travels posterior to the inferior vena cava. This may also cause unilateral hydronephrosis, although this is much more frequent on the\u00a0<strong>right</strong> side.\u00a0Ultrasound reveals the classic sign of a <strong>dilated upper ureter</strong> associated with hydronephrosis.\u00a0</p>\n<p>Option B:<strong> Midureteral valve</strong>\u00a0can also be associated with unilateral hydronephrosis. However, this condition is <strong>very rare</strong>.</p>\n<p>Option D: <strong>Posterior urethral valves</strong><strong>\u00a0</strong>are the most common cause of severe obstructive uropathy in children. However, they would be associated with <strong>bilateral hydronephrosis</strong> and a <strong>distended bladder</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An elderly male patient presents to the emergency with lower abdominal pain, inability to pass urine, and a palpable and tender suprapubic mass. He has a history of benign prostatic hyperplasia. Initial catheterization attempts have failed. What is the next best step in management?",
    "choices": [
      {
        "id": 1,
        "text": "Placement of a coude catheter"
      },
      {
        "id": 2,
        "text": "Placement of a small (12F to 14F) Foley catheter"
      },
      {
        "id": 3,
        "text": "Suprapubic catheterization"
      },
      {
        "id": 4,
        "text": "CT scan of the abdomen and pelvis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario of an elderly male presenting with\u00a0<strong>lower abdominal pain</strong>,<strong> inability to pass urine</strong>, and a <strong>palpable</strong> and <strong>tender suprapubic mass</strong>\u00a0(palpable bladder) is suggestive of\u00a0<strong>acute urinary retention</strong>. Given the history of\u00a0<strong>benign prostatic hyperplasia (BPH)</strong>, and a failed initial catheterization, the best next step in the management of this patient is the <strong>placement</strong> of a <strong>coude catheter</strong>.</p>\n<p><strong>Acute urinary retention</strong> most commonly occurs in <strong>men</strong> with <strong>BPH</strong>.\u00a0Other causes include <strong>diabetic neuropathy</strong>, <strong>urethral stricture</strong>,<strong> multiple sclerosis</strong>, <strong>Parkinson\u2019s disease</strong>, or the use of <strong>opiates or anticholinergics</strong>. It is the most commonly encountered <strong>urologic emergency. </strong>Patients usually present with an <strong>inability to pass urine</strong>, severe <strong>suprapubic pain</strong>, and a\u00a0<strong>distended</strong>, <strong>palpable</strong>, and <strong>tender bladder </strong>(as shown below).\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d900711eb82b49efb825de29f8b18625x1280x960.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9ec1bb8579c14edea4e06df258d65509x1280x1464.JPEG"
    ]
  },
  {
    "text": "A 4-year-old female child presents with episodic abdominal pain, jaundice, and a palpable mass in the right hypochondrium. Abdominal ultrasound reveals a cystic structure arising from the biliary tree. Which of the following is unlikely to be a complication of this presentation?",
    "choices": [
      {
        "id": 1,
        "text": "Malignant transformation"
      },
      {
        "id": 2,
        "text": "Ascending cholangitis"
      },
      {
        "id": 3,
        "text": "Acute pancreatitis"
      },
      {
        "id": 4,
        "text": "Intestinal obstruction"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical presentation of a\u00a04-year-old <strong>female</strong> child presenting with\u00a0<strong>episodic abdominal pain</strong>, <strong>jaundice</strong>, a <strong>palpable mass in the right hypochondrium</strong>, and ultrasound findings of a\u00a0<strong>cystic structure arising from the biliary tree</strong> is characteristic of a\u00a0<strong>choledochal cyst</strong>. Of the listed options, <strong>intestinal obstruction</strong>\u00a0is an <strong>unlikely</strong> complication of choledochal cysts.</p>\n<p>Choledochal cysts are <strong>congenital cystic dilations</strong> of the <strong>intrahepatic</strong> and/or <strong>extrahepatic biliary tree</strong>. They are 4 times more common in <strong>females</strong>. They present with a triad of\u00a0<strong>jaundice, </strong>a palpable <strong>right upper quadrant mass,\u00a0</strong>and<strong>\u00a0abdominal pain.\u00a0</strong>However, they may remain minimally symptomatic and\u00a0may escape detection.</p>\n<p>If left undiagnosed, choledochal cysts can present with the following complications:</p>\n<ul>\n<li aria-level=\"1\"><strong>Ascending cholangitis</strong> (recurrent attacks may lead to cirrhosis and portal hypertension)\u00a0</li>\n<li aria-level=\"1\"><strong>Acute pancreatitis</strong></li>\n<li aria-level=\"1\">Bile peritonitis (due to cyst rupture)\u00a0</li>\n<li aria-level=\"1\"><strong>Malignant transformation</strong> into a cholangiocarcinoma</li>\n</ul>\n<p>Diagnostic investigations include an <strong>ultrasound</strong> abdomen, which may reveal\u00a0a <strong>cystic structure arising from the biliary tree</strong><strong>.\u00a0</strong>Along with a <strong>CT</strong>, it helps demonstrate the <strong>dimensions</strong> of the cyst, its relationship to the <strong>vascular structures</strong>, and\u00a0the <strong>intrahepatic ductal configuration</strong>.\u00a0<strong>Magnetic resonance cholangiopancreatography (MRCP)\u00a0</strong>is the investigation of choice and may provide a more detailed depiction of the anatomy of the cyst. Management depends on the type of cyst according to the <strong>Todani</strong> classification.\u00a0</p>\n<p><strong>Todani classification</strong> of the choledochal cysts along with their management is as shown below~</p>\n<table style=\"width: 638.85px;\">\n<tbody>\n<tr>\n<td style=\"width: 310px; text-align: center;\" colspan=\"2\"><strong>Type of choledochal cyst</strong></td>\n<td style=\"width: 307.85px; text-align: center;\"><strong>Surgical management</strong></td>\n</tr>\n<tr>\n<td style=\"width: 310px;\" colspan=\"2\">Type I -\u00a0 fusiform dilatation of the bile duct (most common - seen in 75% of patients)</td>\n<td style=\"width: 307.85px;\">Complete surgical excision, cholecystectomy, and <strong>Roux-en-Y hepaticojejunostomy</strong></td>\n</tr>\n<tr>\n<td style=\"width: 310px;\" colspan=\"2\">Type II - saccular diverticulum from the common bile duct</td>\n<td style=\"width: 307.85px;\">Diverticulectomy, cholecystectomy, and common bile duct repair</td>\n</tr>\n<tr>\n<td style=\"width: 310px;\" colspan=\"2\">Type III- diverticulum within the pancreas, also known as\u00a0choledochoceles</td>\n<td style=\"width: 307.85px;\">ERCP + sphincterotomy (<strong>Only cyst in which reconstruction is not required</strong>)</td>\n</tr>\n<tr>\n<td style=\"width: 42px;\" rowspan=\"2\">Type IV</td>\n<td style=\"width: 268px;\">a - multiple cysts (both intrahepatic and extrahepatic)</td>\n<td style=\"width: 307.85px;\">Liver transplant</td>\n</tr>\n<tr>\n<td style=\"width: 268px;\">b - multiple cysts limited to the extrahepatic biliary tree</td>\n<td style=\"width: 307.85px;\"><strong>Kasai procedure</strong> (portoenterostomy)</td>\n</tr>\n<tr>\n<td style=\"width: 310px;\" colspan=\"2\">Type V - multiple cysts involving only intrahepatic ducts (<strong>Caroli's disease</strong>)</td>\n<td style=\"width: 307.85px;\">Liver transplant</td>\n</tr>\n</tbody>\n</table>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A middle-aged female patient with an abdominal mass was diagnosed with gestational trophoblastic neoplasia. On further evaluation, it is found that neoplasia has metastasized to the liver and lungs. What would be the clinical staging according to FIGO classification?",
    "choices": [
      {
        "id": 1,
        "text": "Stage I"
      },
      {
        "id": 2,
        "text": "Stage II"
      },
      {
        "id": 3,
        "text": "Stage III"
      },
      {
        "id": 4,
        "text": "Stage IV"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The patient would be classified to have&nbsp;<strong>stage-IV</strong>&nbsp;<strong>gestational trophoblastic neoplasia</strong> (GTN).</p>\n<p>International Federation of Gynecology and Obstetrics (<strong>FIGO</strong>) Staging for GTN is as follows:</p>\n<ul>\n<li><strong>Stage I</strong>&nbsp;-&nbsp;<strong>Confined</strong>&nbsp;to the&nbsp;<strong>uterus</strong></li>\n<li><strong>Stage II</strong>&nbsp;- GTN extends&nbsp;<strong>outside</strong>&nbsp;of the&nbsp;<strong>uterus</strong>&nbsp;but is limited to the genital structures</li>\n<li><strong>Stage III</strong>&nbsp;- GTN extends to the&nbsp;<strong>lungs</strong>, with or without known genital tract involvement</li>\n<li><strong>Stage IV</strong>&nbsp;- All&nbsp;<strong>other metastatic</strong>&nbsp;sites.</li>\n</ul>\n<p>This patient with metastasis to <strong>the liver</strong> and lungs has <strong>Stage IV</strong> disease.</p>\n<p><strong>GTN</strong> includes tumors that cause <strong>aggressive</strong> invasion of the endometrium and myometrium by <strong>trophoblastic cells</strong>. This includes invasive mole, choriocarcinoma, placental site trophoblastic tumor, and epithelioid trophoblastic tumor.&nbsp;GTN is diagnosed based on elevated &beta;-hCG levels. Criteria for diagnosis of GTN:</p>\n<ul>\n<li>Persistence of&nbsp;&beta;-hCG level&nbsp;plateau&nbsp;in&nbsp;4 measurements&nbsp;for 3 weeks or longer</li>\n<li>Rise&nbsp;in&nbsp;&beta;-hCG&nbsp;levels in&nbsp;3 or more consecutive&nbsp;measurements done&nbsp;weekly, over a period of 2 weeks or longer</li>\n<li>Elevated&nbsp;&beta;-hCG level&nbsp;for&nbsp;6 months&nbsp;or more</li>\n<li>Histologic diagnosis of&nbsp;choriocarcinoma.</li>\n</ul>\n<p>A modified prognostic scoring system by the WHO distinguishes patients at low risk for therapeutic failure from those at high risk. Treatment for the&nbsp;<strong>low-risk disease</strong>&nbsp;is&nbsp;<strong>chemotherapy</strong>&nbsp;with&nbsp;<strong>methotrexate</strong>, while those with&nbsp;<strong>high-risk disease</strong>&nbsp;are treated with&nbsp;<strong>etoposide, methotrexate,&nbsp;</strong>and<strong>&nbsp;dactinomycin</strong>&nbsp;alternating with&nbsp;<strong>cyclophosphamide</strong>&nbsp;and&nbsp;<strong>vincristine</strong>&nbsp;(EMA/CO) chemotherapy.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A middle-aged man who presented with an abdominal mass has the following subcutaneous venous circulation with the direction of the flow as depicted by the arrows in the image. This can be seen in:",
    "choices": [
      {
        "id": 1,
        "text": "Superior vena caval obstruction"
      },
      {
        "id": 2,
        "text": "Inferior vena caval obstruction"
      },
      {
        "id": 3,
        "text": "Portal hypertension"
      },
      {
        "id": 4,
        "text": "Splenic vein thrombosis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario with the <strong>upward</strong> flow of subcutaneous venous circulation can be seen in <strong>inferior vena cava obstruction</strong>.</p>\n<p>The level of the umbilicus is a watershed area for venous and lymphatic circulation. The systemic veins anastomose with tributaries of portal veins at the umbilicus.\u00a0Normally, venous blood and lymphatics flow upwards above the plane of the umbilicus\u00a0and downwards below this plane.\u00a0</p>\n<ul>\n<li>In <strong>inferior vena cava obstruction</strong>, the blood flow in the veins of the anterior abdominal wall is completely <strong>upward</strong>.</li>\n<li>In <strong>superior vena cava obstruction</strong>, the blood flow in the veins of the anterior abdominal veins is completely <strong>downward</strong>.</li>\n<li>In <strong>portal hypertension</strong> with dilated abdominal veins, the blood flow is away from the umbilicus, <strong>radiating</strong> like a star from the umbilicus (<strong>caput-medusae</strong>).</li>\n</ul>\n<p>Causes of superior and inferior vena caval obstruction:</p>\n<table style=\"height: 365px; width: 299px;\">\n<tbody>\n<tr style=\"height: 36px;\">\n<td style=\"width: 126.195px; height: 36px;\"><strong>Causes of SVC obstruction</strong></td>\n<td style=\"width: 156.805px; height: 36px;\"><strong>Causes of IVC obstruction\u00a0</strong></td>\n</tr>\n<tr style=\"height: 286.125px;\">\n<td style=\"width: 126.195px; height: 286.125px;\">\n<p>\u00a0</p>\n<p>1. Mediastinal malignancy</p>\n<p>2. Mediastinal fibrosis</p>\n<p>3. Retrosternal thyroid</p>\n<p>4. Aortic aneurysm</p>\n<p>5. Radiation fibrosis</p>\n<p>6. Iatrogenic</p>\n</td>\n<td style=\"width: 156.805px; height: 286.125px;\">\n<ol>\n<li>\u00a0Thrombosis extension</li>\n<li>\u00a0Tumor invasion</li>\n<li>\u00a0Extrinsic compression (Eg: Pregnancy, abdominal mass)</li>\n<li>Coagulopathy</li>\n<li>Sepsis, dehydration, immobility</li>\n<li>Iatrogenic</li>\n</ol>\n</td>\n</tr>\n</tbody>\n</table>\n<div class=\"page\" title=\"Page 2670\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Splenic vein thrombosis</strong>\u00a0is one of the prehepatic causes of <strong>portal hypertension</strong>, in which the portal venous system is affected before it enters the liver.</p>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c28bf3982d9340898637d8df5e73599e.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e461e30ebc8942458847f1e52080ee30x1280x4833.JPEG"
    ]
  },
  {
    "text": "A young nulliparous female who desires pregnancy comes to you with complaints of heavy menstrual bleeding. On palpation, an abdominal mass corresponding to 14 weeks of gestation is felt. The mass is found to be a subserosal pedunculated fibroid on imaging. What is the treatment of choice?",
    "choices": [
      {
        "id": 1,
        "text": "Hysterectomy"
      },
      {
        "id": 2,
        "text": "Myomectomy"
      },
      {
        "id": 3,
        "text": "Medical therapy"
      },
      {
        "id": 4,
        "text": "Observation"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The treatment of choice in this nulliparous female with\u00a0subserosal pedunculated fibroid is <strong>myomectomy</strong>. Myomectomy is indicated if the uterus size corresponds to <strong>more than 12 weeks</strong> of gestation and the<strong> patient desires pregnancy</strong>.</p>\n<p>Myomectomy\u00a0refers to the <strong>removal of fibroids</strong> and <strong>preserving</strong> the uterus. It is indicated in fibroids which present with the following\u00a0</p>\n<ul>\n<li><strong>Persistent uterine bleeding</strong> despite medical therapy</li>\n<li>Excessive pain or pressure symptoms</li>\n<li><strong>Size &gt; 12 weeks</strong>, patient desirous to have a baby</li>\n<li><strong>Unexplained infertility</strong> with distortion of the uterine cavity due to fibroid</li>\n<li>Recurrent pregnancy wastage due to fibroid</li>\n<li>Rapid growth during follow up</li>\n<li><strong>Subserous pedunculated fibroid</strong></li>\n</ul>\n<p>Myomectomy can be performed by laparoscopy, hysteroscopy, or laparotomy. It is contraindicated in patients with an <strong>infected</strong> fibroid, pelvic or endometrial <strong>tuberculosis</strong>, suspected <strong>malignancy,</strong>\u00a0and growth in <strong>post-menopausal</strong> and <strong>multiparous women</strong> where<strong> hysterectomy</strong> can be the safe definitive management.</p>\n<p>Fibroids are benign estrogen dependant tumors of the uterine smooth muscles and connective tissue.\u00a0</p>\n<p>Management of uterine fibroids in\u00a0<strong>asymptomatic patients</strong> includes <strong>observation</strong> with regular follow-up<strong>\u00a0</strong>regardless of the size of the fibroid. Surgery is indicated in\u00a0cornual fibroids if it causes infertility or pedunculated fibroids (due to the risk of torsion).\u00a0</p>\n<p>In<strong> symptomatic patients,</strong>\u00a0<strong>medical therapy</strong> is done to shrink the fibroid. It acts as a <strong>preoperative adjunct.</strong>\u00a0Surgical methods such as myomectomy, laparoscopic myolysis, hysterectomy, and endometrial ablation are tried for patients with persistent symptoms despite conservative management. <strong>Hysterectomy</strong> is done in <strong>postmenopausal</strong> women and in multiparous women who have completed their families or are <strong>not desirous</strong> of <strong>childbirth.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 3-year-old child is brought to the emergency with petechiae, bruising, and abdominal distension. Examination revealed an abdominal mass.  Investigations revealed schistocytes and thrombocytopenia. What is the most probable cause of the mass?",
    "choices": [
      {
        "id": 1,
        "text": "Neuroblastoma"
      },
      {
        "id": 2,
        "text": "Hepatoblastoma"
      },
      {
        "id": 3,
        "text": "Wilm's tumor"
      },
      {
        "id": 4,
        "text": "Hepatic hemangioma"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>This patient presents with <strong>petechiae,</strong> and abdominal distension with schistocytes and thrombocytopenia. This in child most likely has <strong>Kasabach-Merritt syndrome</strong> (secondary DIC). His abdominal mass is likely to be a <strong>hepatic hemangioma.</strong>\u00a0</p>\n<p><strong>Kasabach-Merritt syndrome</strong> is a life-threatening complication that occurs in patients with <strong>giant hemangiomas</strong>. It is most commonly seen in<strong> infants</strong>.\u00a0</p>\n<p>Clinical features:\u00a0</p>\n<ul class=\"i8Z77e\">\n<li class=\"TrT0Xe\">Enlarged abdomen</li>\n<li class=\"TrT0Xe\">Hepatomegaly or jaundice</li>\n<li class=\"TrT0Xe\">Petechiae, bruising, and frank bleeding</li>\n<li class=\"TrT0Xe\">Painful lesions</li>\n<li class=\"TrT0Xe\">Anemia</li>\n</ul>\n<p>It is characterized by profound <strong>thrombocytopenia and consumptive coagulopathy</strong> leading to a DIC-like picture.</p>\n<p>Other options:\u00a0</p>\n<p>Option A: <strong>Neuroblastomas</strong> are tumors of the sympathetic ganglia and adrenal medulla that are derived from primordial neural crest cells. It is the most common extracranial solid tumor of childhood and the most frequently diagnosed tumor in infancy. Brain tumors are the most common solid tumors in childhood. They present as a <strong>flank mass</strong> that crosses the <strong>midline.</strong></p>\n<p>Option B: <strong>Hepatoblastoma</strong> is the most common childhood liver tumor. Histologically it is composed of small polygonal embryonal cells forming trabeculae, acini, or papillary structures in the developing liver.</p>\n<p>Option C: <strong>Wilms</strong> tumor is the most common primary malignant renal tumor in children and is the second most common malignant abdominal tumor in children. The clinical presentation usually involves an asymptomatic <strong>unilateral abdominal mass,</strong> hypertension, abdominal pain, and gross painless hematuria. Constitutional symptoms of fever, anorexia, and weight loss can also be present at the time of diagnosis.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = 'Abdominal Mass Mini Test - -Tmt';
        const quizFilename = 'abdominal-mass-mini-test-tmt-29140587.html';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2024-25"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>