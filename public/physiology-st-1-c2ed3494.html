<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Physiology St 1 - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Test Series Subject Wise / Year 2017 - 18
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">50</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Sodium channels are particularly blocked by",
    "choices": [
      {
        "id": 1,
        "text": "Nifedipine"
      },
      {
        "id": 2,
        "text": "Tetrodotoxin"
      },
      {
        "id": 3,
        "text": "Tetra ethyl lead"
      },
      {
        "id": 4,
        "text": "Choline"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<ul>\n<li><strong>Tetrodotoxin (TTX),</strong> one of the most potent poisons known, specifically blocks the <strong>Na<sup>+</sup> channel</strong>. The ovaries of certain species of puffer fish (a highly priced delicacy in Japan !!!) contain TTX</li>\n<li><strong>Saxitoxin</strong> is another blocker of <strong>Na<sup>+</sup> channels</strong> that is produced by reddish dinoflagellates. Shellfish eat the dinoflagellates and concentrate saxitoxin in their tissues. A person who eats these shellfish may experience life-threatening paralysis within 30 minutes after the meal.</li>\n<li><strong>Tetraethylammonium (TEA<sup>+</sup>),</strong> another poison <strong>blocks K<sup>+ </sup>channels</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "If plasma volume  is  4L and haematocrit is 60% the blood volume would be:",
    "choices": [
      {
        "id": 1,
        "text": "10 L"
      },
      {
        "id": 2,
        "text": "6.6 L"
      },
      {
        "id": 3,
        "text": "6 L"
      },
      {
        "id": 4,
        "text": "8 L"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Calculation:</strong></p>\n<p><strong>Total blood volume = Plasma volume / 1 - Hematocrit</strong></p>\n<p><strong>Total blood volume = 4L / 1-0.6 = 10L</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Gap junctions are seen in all except",
    "choices": [
      {
        "id": 1,
        "text": "Cardiac muscle"
      },
      {
        "id": 2,
        "text": "Single unit smooth muscle"
      },
      {
        "id": 3,
        "text": "Retina"
      },
      {
        "id": 4,
        "text": "Multiunit smooth muscle"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Multiunit smooth muscle</strong> is made up of individual units of muscle cells with no (or few) gap junctions. Multiunit smooth muscles are found in structures such as iris of the eye, in which fine, graded contractions occur.</p>\n<p><strong>Cardiac muscle and single unit smooth muscle </strong>have gap junctions that provide low-resistance bridges for the spread of excitation from one fibre to another permitting them to function as a syncytium.</p>\n<p><strong>Retina</strong> also has gap junctions that permit rapid propagation of electrical activity and exchange of chemical messengers between the retinal neurons.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "True about nerve fibre \u2018C\u2019 is",
    "choices": [
      {
        "id": 1,
        "text": "Most susceptible to hypoxia"
      },
      {
        "id": 2,
        "text": "Unmyelinated"
      },
      {
        "id": 3,
        "text": "Preganglionic autonomic"
      },
      {
        "id": 4,
        "text": "They carry touch sensation"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Type C fibers are the small <strong>unmyelinated</strong> nerve fibers.</p>\n<p><strong>Other options :</strong></p>\n<ul>\n<li>C fibres are <strong>least susceptible</strong> to hypoxia</li>\n<li>C fibres are<strong> post ganglionic</strong> sympathetic fibres</li>\n<li>C fibres\u00a0 carry pain and temperature sensations.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "True about type II B muscle fibre",
    "choices": [
      {
        "id": 1,
        "text": "They are white muscle"
      },
      {
        "id": 2,
        "text": "Slow twitch muscle"
      },
      {
        "id": 3,
        "text": "Important for maintaining posture"
      },
      {
        "id": 4,
        "text": "Not useful for intense movements of short duration"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<ul>\n<li><strong>The type IIB muscle</strong> fibres contain little myoglobin and therefore are pale in colour, so they are sometimes called <strong>white fibres.</strong></li>\n<li>Type IIB fibres have higher myosin ATPase activity&rarr; fast twitches.</li>\n<li>They are adapted to perform rapid, forceful movements.</li>\n<li><strong>Slow oxidative fibres (type I fibres)</strong> are important for maintaining posture.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "During skeletal muscle contraction",
    "choices": [
      {
        "id": 1,
        "text": "A band shorten"
      },
      {
        "id": 2,
        "text": "Both H and I band shorten"
      },
      {
        "id": 3,
        "text": "Both A and I band shorten"
      },
      {
        "id": 4,
        "text": "Both A and H band shorten"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>During muscle contraction the two Z lines come closer; length of A band remains constant while the length of H and I band decreases; M line becomes more prominent.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5082a7c8e97546b792a176e1e77a6720x800x356.PNG"
    ]
  },
  {
    "text": "In the clinical ward rounds, the professor tests the vibratory sensations of a patient by placing a 128Hz tuning fork on his great toe. He explains the receptors involved rapidly adapt to ongoing stimuli. Which receptor is he referring to?",
    "choices": [
      {
        "id": 1,
        "text": "Merkel\u2019s discs"
      },
      {
        "id": 2,
        "text": "Ruffini\u2019s end organs"
      },
      {
        "id": 3,
        "text": "Pacinian corpuscles"
      },
      {
        "id": 4,
        "text": "Meissner\u2019s corpuscles"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Rapidly</strong> adapting receptors that sense 128 Hz (<strong>fast vibration</strong>)\u00a0are <strong>Pacinian corpuscles.</strong></p>\n<p>Pacinian corpuscles are cutaneous mechanoreceptors, which consist of unmyelinated dendritic endings of a sensory nerve fiber, encapsulated by <strong>concentric lamellae </strong>of connective tissue. It gives them an <strong>onion peel</strong>-like appearance. They respond to <strong>deep pressure</strong> and <strong>fast vibration</strong> of frequencies ranging between <strong>60 - 300 Hz</strong>. Pacinian corpuscles are <strong>rapidly adapting</strong> receptors, adapting in a few hundredths of a second.</p>\n<p>The below image shows the histology of the Pacinian corpuscle.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/bf37a2b85db640bc9fa30429918aa2cax1280x957.JPEG"
    ]
  },
  {
    "text": "First physiological response to high environmental temperature is:",
    "choices": [
      {
        "id": 1,
        "text": "Sweating"
      },
      {
        "id": 2,
        "text": "Vasodilation"
      },
      {
        "id": 3,
        "text": "Decreased heat production"
      },
      {
        "id": 4,
        "text": "Non-shivering thermogenesis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The temperature control system uses three important mechanisms to reduce body heat when the body temperature becomes too great:</p>\n<ul>\n<li><strong>Vasodilation of skin blood vessels.</strong> In almost all areas of the body, the skin blood vessels become intensely dilated. This is caused by inhibition of the sympathetic centers in the posterior hypothalamus that cause vasoconstriction. Full vasodilation can increase the rate of heat transfer to the skin as much as eightfold.</li>\n<li>Sweating</li>\n<li><strong>Decrease in heat production.</strong> The mechanisms that cause excess heat production, such as shivering and chemical thermogenesis, are strongly inhibited.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Bruxism occurs in which phase of sleep",
    "choices": [
      {
        "id": 1,
        "text": "NREM 2"
      },
      {
        "id": 2,
        "text": "NREM 3"
      },
      {
        "id": 3,
        "text": "REM Sleep"
      },
      {
        "id": 4,
        "text": "NREM 4"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<ul>\n<li>Bruxism can occur in all stages of sleep but it is more common in NREM2.</li>\n<li>Sleep bruxism is characterised by tooth grinding and jaw clenching occurs during NREM sleep and less frequently in REM.</li>\n<li>Abnormal sensorimotor processing within CNS level underlies the genesis of sleep bruxism.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Daily rhythm regulation is by:",
    "choices": [
      {
        "id": 1,
        "text": "Dorsomedial nucleus"
      },
      {
        "id": 2,
        "text": "Ventromedial nucleus"
      },
      {
        "id": 3,
        "text": "Supraoptic nucleus"
      },
      {
        "id": 4,
        "text": "Suprachiasmatic nucleus"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The rhythmic fluctuations in the functioning of living beings follows a circadian rhythm that is synchronized to the day-night cycle in the environment. This synchronisation depends on the <strong>suprachiasmatic nucleus (SCN)</strong>.</p>\n<p>SCN receive information about the light&ndash;dark cycle via a special neural pathway, the <strong>retinohypothalamic</strong> <strong>fibers. </strong></p>\n<p>Efferents from the SCN initiate neural and humoral signals that entrain a wide variety of well-known circadian rhythms including the sleep&ndash;wake cycle and the secretion of the pineal hormone melatonin.&nbsp;</p>\n<p>In the absence of such synchronization, the circadian rhythm becomes progressively more out of phase with light-dark cycle because they are longer or shorter than 24 hours.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Initiation of visual impulse is associated with",
    "choices": [
      {
        "id": 1,
        "text": "Condensation of opsin with Vitamin A"
      },
      {
        "id": 2,
        "text": "Photoisomerisation and hydrolysis of visual purple"
      },
      {
        "id": 3,
        "text": "NADP"
      },
      {
        "id": 4,
        "text": "NAD"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Rhodopsin or visual purple, </strong>the photosensitive pigment, is composed of opsin (a protein belonging to the superfamily of G protein&ndash;coupled receptors) and retinal (an aldehyde of vitamin A). When light strikes the photoreceptors, retinal is chemically transformed in a process called photoisomerization, which begins the transduction process.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/db2b5c2407d14899bc478ac5f73c4e53x357x490.PNG"
    ]
  },
  {
    "text": "Repolarization of the entire myocardium proceeds from",
    "choices": [
      {
        "id": 1,
        "text": "Epicardium to endocardium"
      },
      {
        "id": 2,
        "text": "Left to right"
      },
      {
        "id": 3,
        "text": "Endocardium to epicardium"
      },
      {
        "id": 4,
        "text": "Right to left"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>In <strong>isolated cardiac muscle</strong> the direction of depolarization and repolarization are in the same direction from endocardium to epicardium.</p>\n<p>However <strong>for entire myocardium</strong>, depolarization proceeds from endocardium to epicardium whereas repolarisation proceeds in opposite direction.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "HV interval on ECG is for conduction",
    "choices": [
      {
        "id": 1,
        "text": "Through His \u2013Purkinje system"
      },
      {
        "id": 2,
        "text": "From AV node to bundle of His"
      },
      {
        "id": 3,
        "text": "Purkinje to ventricular fibers"
      },
      {
        "id": 4,
        "text": "From  bundle of His and bundle branches to ventricles"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The HV interval displays the conduction time from the His bundle which is located just below the AV node, to the first identifiable onset of ventricular activation.</p>\n<p><strong>His bundle electrogram (HBE):</strong></p>\n<ul>\n<li>The HBE shows 3 deflections as shown in the figure:</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://cdn1.dailyrounds.org/uploads/883a6364cb2b44c7b35c601f9e7daa9ex268x154.PNG"
    ]
  },
  {
    "text": "The threshold of carotid sinus baroreceptor is:",
    "choices": [
      {
        "id": 1,
        "text": "40 mm Hg"
      },
      {
        "id": 2,
        "text": "50 mm Hg"
      },
      {
        "id": 3,
        "text": "70 mm Hg"
      },
      {
        "id": 4,
        "text": "150 mm Hg"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Carotid sinus baroreceptors have a threshold for excitation of <strong>50 mm Hg.</strong></p>\n<p><strong>Baroreceptors:</strong></p>\n<ul>\n<li>Are <strong>stretch receptors</strong> located in the heart and <strong>adventitia </strong>of the blood vessels</li>\n<li><strong>Types based on location</strong>\n<ul>\n<li>Carotid sinus and aortic arch receptors (<strong>high-pressure regions</strong>)</li>\n<li>Cardiopulmonary receptors (<strong>low-pressure regions)</strong></li>\n</ul>\n</li>\n<li><strong>Afferents</strong>\n<ul>\n<li>Carotid sinus &ndash; branch of Glossopharyngeal nerve <strong>(IX CN)</strong> &ndash; the <strong>carotid sinus nerve (sinus nerve of Hering)</strong></li>\n<li>Aortic arch receptor- branch of Vagus nerve <strong>(X CN) </strong>- <strong>aortic depressor nerve</strong></li>\n</ul>\n</li>\n<li><strong>Center for Reflex</strong>\n<ul>\n<li>Medulla&nbsp; (<strong>Nucleus Tractus Solitarius)</strong></li>\n</ul>\n</li>\n<li><strong>Efferents</strong>\n<ul>\n<li>Sympathetic and parasympathetic neurons to heart and vasculature</li>\n</ul>\n</li>\n<li><strong>Most sensitive to pulse pressure&gt;&gt; MAP</strong></li>\n<li><strong>Threshold</strong> for excitation-<strong> 50mm Hg</strong></li>\n<li>Responses when one Carotid sinus nerve is isolated and perfused with other baroreceptors denervated\n<ul>\n<li>Perfusion pressure <strong>&lt;30mm Hg</strong>- <strong>no response</strong></li>\n<li><strong>70-110mm Hg</strong>- <strong>linear relationship</strong> between perfusion pressure and the fall in systemic BP and HR</li>\n<li><strong>&gt;150mm Hg</strong>- <strong>no further increase in response</strong> as the degree of inhibition of sympathetic nerve is <strong>maximal </strong></li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Discharge from the baroreceptors cause inhibition of:",
    "choices": [
      {
        "id": 1,
        "text": "Caudal Ventro Lateral Medulla (CVLM)"
      },
      {
        "id": 2,
        "text": "Rostral Ventro Lateral Medulla (RVLM)"
      },
      {
        "id": 3,
        "text": "Nucleus ambiguus"
      },
      {
        "id": 4,
        "text": "Nucleus Tractus Solitarius (NTS)"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Baroreceptor Reflex</strong></p>\n<ul>\n<li>Increased BP&rarr; stimulation of baroreceptors &rarr; stimulation of NTS &rarr; inhibition of RVLM &rarr; inhibition of sympathetic system</li>\n<li>Stimulation of NTS also stimulates CVC &rarr; parasymapathetic stimulation</li>\n<li>Net effect = sympathetic inhibition and parasympathetic stimulation &rarr; decreased HR and BP</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/bf7935731bd74682bf17b7d232a117ffx908x535.PNG"
    ]
  },
  {
    "text": "16.\tA 30-year old man has an end diastolic volume of 200ml and end systolic volume of 150 mL. What is his ejection fraction(%)?",
    "choices": [
      {
        "id": 1,
        "text": "25"
      },
      {
        "id": 2,
        "text": "30"
      },
      {
        "id": 3,
        "text": "40"
      },
      {
        "id": 4,
        "text": "60"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<ul>\n<li><strong>Ejection fraction= stroke volume/EDV</strong></li>\n<li><strong>EF = EDV - ESV / EDV</strong></li>\n<li><strong>EF = 200 - 150 / 200 = 0.25 or 25%</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following vessels have least velocity of blood flow in the circulatory system",
    "choices": [
      {
        "id": 1,
        "text": "Aorta"
      },
      {
        "id": 2,
        "text": "Capillaries"
      },
      {
        "id": 3,
        "text": "Venules"
      },
      {
        "id": 4,
        "text": "Vene cavea"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The velocity of blood flow is inversely proportional to vascular cross-sectional area.</p>\n<p><strong>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; v = F/A</strong></p>\n<ul>\n<li>v= velocity</li>\n<li>F= blood flow through the vessel</li>\n<li>A=vascular cross sectional area</li>\n<li>Capillaries have the maximum cross sectional area (4500 cm<sup>2</sup>) and aorta has the least cross sectional area (4.5 cm<sup>2</sup>). Thus, under resting conditions, the velocity is least in capillaries and highest in aorta.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "For cerebral blood flow to be doubled Pco2  should be:",
    "choices": [
      {
        "id": 1,
        "text": "40 mm Hg"
      },
      {
        "id": 2,
        "text": "80 mm Hg"
      },
      {
        "id": 3,
        "text": "100 mm Hg"
      },
      {
        "id": 4,
        "text": "200 mm Hg"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>A 70% increase&nbsp; in P<sub>a</sub>co<sub>2 </sub>(80mmHg)&nbsp; approximately doubles the&nbsp;cerebral blood flow.</p>\n<p><strong>Cerebral Blood Flow</strong></p>\n<ul>\n<li>Normal cerebral blood flow&rarr; 50-65mL/100g of brain tissue/min</li>\n<li>For entire brain CBF&rarr;750-900mL/min (15% of the resting cardiac output)</li>\n<li><strong>Factors that increase CBF</strong>\n<ul>\n<li>Cerebral metabolic rate</li>\n<li>&uarr;Arterial Pco<sub>2</sub><br />\n<ul>\n<li>70% increase&nbsp; in P<sub>a</sub>co<sub>2 </sub>(80mmHg)&nbsp; approximately doubles the CBF</li>\n</ul>\n</li>\n<li>&uarr;H<sup>+</sup> ion concentration</li>\n<li>Hypoxia</li>\n<li>Substances released from astrocytes- NO, K<sup>+</sup>, adenosine etc</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Skin edema(Wheal) is due to",
    "choices": [
      {
        "id": 1,
        "text": "Histamine"
      },
      {
        "id": 2,
        "text": "Substance P"
      },
      {
        "id": 3,
        "text": "Serotonin"
      },
      {
        "id": 4,
        "text": "None"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Triple Response of Lewis</strong></p>\n<ul>\n<li>If the skin is stroked firmly by a blunt object triple response develops</li>\n<li>The sequence <strong>: Red reaction&rarr; flare &rarr; wheal</strong></li>\n<li><strong>Red reaction</strong> is independent of innervation , and is due to <strong>histamine mediated relaxation of the precapillary sphincters</strong></li>\n<li><strong>Flare reaction</strong> (Flush, <strong>Axon reflex</strong>) is due to <strong>Substance P</strong> <strong>mediated arteriolar dilatation</strong> (<strong>antidromic conduction</strong> of afferent impulses via collaterals of the sensory nerve fibre that lead to release of vasoactive mediators)</li>\n<li><strong>Wheal (skin edema)</strong> is due to <strong>histamine mediated increased capillary permeability</strong></li>\n<li>Triple response is present after total sympathectomy</li>\n<li>Flare is absent in locally anesthetized skin</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In which type of shock does cardiac output increase?",
    "choices": [
      {
        "id": 1,
        "text": "Hemorrhagic"
      },
      {
        "id": 2,
        "text": "Anaphylactic"
      },
      {
        "id": 3,
        "text": "Septic shock"
      },
      {
        "id": 4,
        "text": "Neurogenic"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>High cardiac output in <strong>septic shock</strong> is caused by arteriolar dilation in the infected tissues and by high metabolic rate and vasodilation elsewhere in the body, resulting from bacterial toxin stimulation of cellular metabolism and from high body temperature.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Physiologic dead space is that due to:",
    "choices": [
      {
        "id": 1,
        "text": "Wasted ventilation due to Va/Q imbalance"
      },
      {
        "id": 2,
        "text": "Wasted ventilation due to Va/Q imbalance plus anatomical dead space"
      },
      {
        "id": 3,
        "text": "Total dead space minus anatomical dead space"
      },
      {
        "id": 4,
        "text": "Anatomical dead space minus wasted ventilation due to Va/Q imbalance"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Physiologic dead space is the total volume of the lungs that does not participate in gas exchange. Physiologic dead space includes the <strong>anatomic dead space</strong> of the <strong>conducting airways </strong>plus a <strong>functional dead space</strong> in the <strong>alveoli</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "All are the features of exercise except :",
    "choices": [
      {
        "id": 1,
        "text": "Left shift of OHDC"
      },
      {
        "id": 2,
        "text": "\u2191blood supply to muscle"
      },
      {
        "id": 3,
        "text": "\u2191 stroke volume"
      },
      {
        "id": 4,
        "text": "\u2191 O2 consumption"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Exercise causes the OHDC o shift to the right and not left.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The transpulmonary pressure is the pressure difference between",
    "choices": [
      {
        "id": 1,
        "text": "Intrapleural and atmospheric pressure"
      },
      {
        "id": 2,
        "text": "Intrapulmonary atmospheric pressure"
      },
      {
        "id": 3,
        "text": "Intrapleural and intrapulmonary pressure"
      },
      {
        "id": 4,
        "text": "None of the above"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Trans-pulmonary pressure</strong> is intra-alveolar pressure&nbsp; minus intrapleural pressure, and it is a measure of the elastic forces in the lungs that tend to collapse the lungs at each instant of respiration <strong>(the recoil pressure)</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Largest fraction of CO2 is present in the blood as:",
    "choices": [
      {
        "id": 1,
        "text": "Attached with RBC"
      },
      {
        "id": 2,
        "text": "Dissolved in blood"
      },
      {
        "id": 3,
        "text": "With Hb as caraminohemoglobin"
      },
      {
        "id": 4,
        "text": "Bicarbonate"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Almost all of the CO<sub>2</sub> carried in blood is in a chemically modified form, HCO<sup>3&minus;,</sup> which accounts for more than <strong>70% of the total CO<sub>2</sub>.</strong></p>\n<p><strong>CO<sub>2 </sub>transport in blood</strong></p>\n<ul>\n<li>Dissolved form - 7%</li>\n<li>Carbamino compounds - 23%\n<ul>\n<li>CO<sub>2 </sub>reacts directly with amine radicals of the hemoglobin molecule to form the compound carbaminohemoglobin</li>\n<li>CO<sub>2</sub> also reacts with the plasma proteins in the tissue capillaries</li>\n</ul>\n</li>\n<li>Bicarbonates - 70%</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/62c9e63009a545b6bc67166e2fd28a78x350x147.PNG"
    ]
  },
  {
    "text": "The sigmoid nature of OHDC is because of",
    "choices": [
      {
        "id": 1,
        "text": "Binding of one molecule of O2 increases the affinity for next molecule of O2"
      },
      {
        "id": 2,
        "text": "Alpha chain has more affinity for O2 than beta chain"
      },
      {
        "id": 3,
        "text": "Beta chain has more affinity for O2 than alpha chain"
      },
      {
        "id": 4,
        "text": "Hb is acidic in nature"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<ul>\n<li>O<sub>2</sub>-hemoglobin dissociation curve is sigmoid due to <strong>change in affinity </strong>of the heme groups for O<sub>2</sub> as each successive O<sub>2</sub> molecule binds.</li>\n<li>Binding of the first molecule of O<sub>2</sub> to a heme group increases the affinity for the second O<sub>2 </sub>molecule, binding of the second O<sub>2 </sub>molecule increases the affinity for the third O<sub>2 </sub>molecule, and so forth.</li>\n<li>Affinity for the fourth, and last, molecule of O<sub>2</sub> is highest and occurs where saturation is nearly 100%. This phenomenon is described as <strong>positive cooperativity.</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Routine spirometry cannot estimate",
    "choices": [
      {
        "id": 1,
        "text": "TV"
      },
      {
        "id": 2,
        "text": "VC"
      },
      {
        "id": 3,
        "text": "RV"
      },
      {
        "id": 4,
        "text": "ERV"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Residual volume cannot be measured by spirometry, lung capacities that include the residual volume also cannot be measured by spirometry (i.e.,FRC and TLC).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following variants of hypoxia does not stimulate peripheral chemoreceptors",
    "choices": [
      {
        "id": 1,
        "text": "Hypoxic"
      },
      {
        "id": 2,
        "text": "Anaemic"
      },
      {
        "id": 3,
        "text": "Stagnant"
      },
      {
        "id": 4,
        "text": "Histotoxic"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<ul>\n<li>Peripheral chemoreceptors located in the carotid and aortic arteries sense changes in the Po<sub>2</sub>, pH, and Pco<sub>2 </sub>of the plasma.</li>\n<li>The blood flow in each 2-mg carotid body is enormous about 2000 mL/100 g of tissue/min, and the O<sub>2</sub> needs of the cells can be met largely by <strong>dissolved O<sub>2</sub> alone</strong>.</li>\n<li><strong>In anemia</strong> the amount of dissolved O<sub>2</sub> in the blood reaching the receptors is generally normal, even though the combined O<sub>2</sub> in the blood is markedly decreased hence they do not stimulate peripheral chemoreceptors.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not seen in mountain climbers",
    "choices": [
      {
        "id": 1,
        "text": "Hyperventilation"
      },
      {
        "id": 2,
        "text": "Decreased PaO2"
      },
      {
        "id": 3,
        "text": "Pulmonary edema"
      },
      {
        "id": 4,
        "text": "Bradycardia"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Bradycardia is not among the changes seen in mountain climbers.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/766d673bede34aeca26dc88c8aa09a1bx446x476.PNG"
    ]
  },
  {
    "text": "Which of the following action on Calcium and Phosphorus is true",
    "choices": [
      {
        "id": 1,
        "text": "1,25 DHCC  : \u2191Ca,\u2193P"
      },
      {
        "id": 2,
        "text": "PTH  : \u2191Ca,\u2191P"
      },
      {
        "id": 3,
        "text": "Calcitonin : \u2193Ca,\u2191P"
      },
      {
        "id": 4,
        "text": "None"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<ul>\n<li>1,25 DHCC : &uarr;Ca, &uarr;P</li>\n<li>PTH : &uarr;Ca, &darr;P</li>\n<li>Calcitonin : &darr;Ca, &darr;P</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In stress which hormone is increased",
    "choices": [
      {
        "id": 1,
        "text": "Insulin"
      },
      {
        "id": 2,
        "text": "Thyroxin"
      },
      {
        "id": 3,
        "text": "Vasopressin"
      },
      {
        "id": 4,
        "text": "Estrogen"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Vasopressin</strong> is the hormone on the above options which will be increased in stress.</p>\n<p>&nbsp;</p>\n<p>&nbsp;</p>\n<table>\n<tbody>\n<tr>\n<td>Hormones increased in stress&nbsp;</td>\n<td>Hormones decreased in stress&nbsp;&nbsp;</td>\n</tr>\n<tr>\n<td>CRF, ACTH and cortisol&nbsp;</td>\n<td>GnRh, Gonadotropins&nbsp;</td>\n</tr>\n<tr>\n<td>Catecholamine&nbsp;</td>\n<td>TSH and &nbsp;T3,T4&nbsp;</td>\n</tr>\n<tr>\n<td>Prolactin(it may decrease) , Growth hormone&nbsp;</td>\n<td>Insulin&nbsp;</td>\n</tr>\n<tr>\n<td>Vasopressin&nbsp;</td>\n<td>&nbsp;</td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Secretion of all the hormones are decreased in section of pituitary stalk except",
    "choices": [
      {
        "id": 1,
        "text": "Prolactin"
      },
      {
        "id": 2,
        "text": "Growth hormone"
      },
      {
        "id": 3,
        "text": "Vasopressin"
      },
      {
        "id": 4,
        "text": "FSH"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The normal prolactin secretion is tonically inhibited by the hypothalamus, and the section of pituitary stalk leads to an increase in circulating prolactin.</p>\n<p><strong>NOTE-</strong> The effect of hypothalamic prolactin inhibiting hormone, <strong>dopamine</strong>, is normally greater than the effects of various hypothalamic peptides with prolactin-releasing activity.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not an effect of T3 hormone:",
    "choices": [
      {
        "id": 1,
        "text": "Increases the heart rate"
      },
      {
        "id": 2,
        "text": "Increases the stroke volume"
      },
      {
        "id": 3,
        "text": "Decreases the peripheral vascular resistance"
      },
      {
        "id": 4,
        "text": "Decreased protein breakdown"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>T<sub>3</sub> causes increased protein breakdown</strong> and not decreased protein breakdown.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Insulin is essential for glucose entry in:",
    "choices": [
      {
        "id": 1,
        "text": "Adipose tissue"
      },
      {
        "id": 2,
        "text": "Cortical neurons"
      },
      {
        "id": 3,
        "text": "Renal tubular cells"
      },
      {
        "id": 4,
        "text": "\u03b2 cells of pancreas"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Insulin&nbsp;</strong>is essential for glucose entry in <strong>adipose tissue.</strong></p>\n<p><strong>Adipose tissue, skeletal muscle, </strong>and <strong>cardiac</strong> muscle have <strong>GLUT-4 transporters</strong> that are insulin-dependent.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Site of RBC formation in a 25 yrs old healthy male is ______.",
    "choices": [
      {
        "id": 1,
        "text": "Flat bones"
      },
      {
        "id": 2,
        "text": "Long bones"
      },
      {
        "id": 3,
        "text": "Liver"
      },
      {
        "id": 4,
        "text": "Yolk sac"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Hematopoiesis beyond 20 years of age occurs mainly in <strong>flat bones.</strong></p>\n<p>The marrow of the long bones, except for the proximal portions of the humeri and tibiae, becomes quite fatty and produces no more red blood cells after about age <strong>20 years.</strong></p>\n<p>Beyond this age, most red cells continue to be produced in the marrow of the membranous bones, such as the<strong> vertebrae, sternum, ribs, </strong>and<strong> ilia</strong>. Even in these bones, the marrow becomes less productive as age increases.</p>\n<p><strong>Site of hematopoiesis:</strong></p>\n<ul>\n<li>Early embryonic life - Yolk sac</li>\n<li>Middle trimester of gestation (&gt;3 months of Intrauterine life) - Liver (main), spleen, lymph nodes</li>\n<li>Last month of gestation/at birth - Bone marrow</li>\n<li>Till 20 years of age - Axial skeleton and long bones</li>\n<li>&gt;20years - Flat bones</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The filtration of proteins by kidneys is restricted by",
    "choices": [
      {
        "id": 1,
        "text": "Foot process"
      },
      {
        "id": 2,
        "text": "Negatively charged anions"
      },
      {
        "id": 3,
        "text": "Plasma oncotic pressure"
      },
      {
        "id": 4,
        "text": "Micropores"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Proteins like albumin are restricted from filtration because of its negative charge and the electrostatic repulsion exerted by negative charges of the glomerular capillary wall sialoproteins (proteoglycans)</p>\n<p><strong>Factors Affecting Renal Permeability (Filterability)</strong></p>\n<p>Two important factors that affect the permeability are molecular size and the charge of the substance</p>\n<ul>\n<li><strong>Molecular size</strong>\n<ul>\n<li>For neutral substances with a molecular diameter 4 to 8 nm filtration is inversely proportional to molecular diameter</li>\n</ul>\n</li>\n<li><strong>Charge of the substance</strong>\n<ul>\n<li>The renal filtration membrane is composed of negatively charged sialoproteins (proteoglycans). As a result the negatively charged (anionic) proteins are less filtered and cationic substances are more readily filtered than neutral substances.</li>\n<li>In <strong>glomerular disease, </strong>the anionic charges on the barrier may be removed, resulting in proteinuria.</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Effect of efferent arteriole constriction on GFR is:",
    "choices": [
      {
        "id": 1,
        "text": "Increases"
      },
      {
        "id": 2,
        "text": "Decreases"
      },
      {
        "id": 3,
        "text": "Increases and then decreases"
      },
      {
        "id": 4,
        "text": "Decreases and then increases"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<ul>\n<li>At moderate levels of constriction, there is a slight increase in GFR, but with severe constriction, there is a decrease in GFR.</li>\n<li>Constriction of the efferent arterioles increases the resistance to outflow from the glomerular capillaries. This mechanism <strong>raises glomerular hydrostatic pressure</strong>, and as long as the increase in efferent resistance does not reduce renal blood flow too much, <strong>GFR increases slightly.</strong></li>\n<li>However, because efferent arteriolar constriction also reduces renal blood flow, the plasma protein concentration increases and hence glomerular colloid osmotic pressure increases (<strong>Donnan effect</strong>). Therefore, <strong>if constriction of efferent arterioles is severe</strong> (more than about <strong>a threefold increase</strong> in efferent arteriolar resistance), the <strong>rise in colloid osmotic pressure exceeds the increase in glomerular capillary hydrostatic pressure</strong> caused by efferent arteriolar constriction. When this situation occurs, <strong>the net force for filtration actually decreases, causing a reduction in GFR.</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Hyperosmolarity of the renal medulla is due to increased",
    "choices": [
      {
        "id": 1,
        "text": "Potassium"
      },
      {
        "id": 2,
        "text": "Sodium"
      },
      {
        "id": 3,
        "text": "Glucose"
      },
      {
        "id": 4,
        "text": "Calcium"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<ul>\n<li>Corticomedullary osmotic gradient is primarily due to&nbsp; NaCl and urea.\n<ul>\n<li>It is established by countercurrent multiplication and urea recycling.</li>\n<li>It is maintained by countercurrent exchange in the vasa recta.</li>\n</ul>\n</li>\n<li><strong>Countercurrent multiplication in the loop of Henle</strong>\n<ul>\n<li>It depends on <strong>NaCl reabsorption in the thick ascending limb </strong>and <strong>countercurrent flow </strong>in the descending and ascending limbs of the loop of Henle</li>\n</ul>\n</li>\n<li><strong>Urea recycling </strong>from the inner medullary collecting ducts into the medullary interstitial fluid</li>\n<li><strong>Vasa recta </strong>are the capillaries that supply the loop of Henle. They maintain the corticomedullary gradient by serving as <strong>osmotic exchangers. </strong>Vasa recta blood equilibrates osmotically with the interstitial fluid of the medulla and papilla.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Angiotensin II causes all of the following except",
    "choices": [
      {
        "id": 1,
        "text": "Stimulation of thirst"
      },
      {
        "id": 2,
        "text": "Increased ADH secretion"
      },
      {
        "id": 3,
        "text": "Vasodilation"
      },
      {
        "id": 4,
        "text": "Aldosterone secretion"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Actions of Angiotensin II</strong></p>\n<p></p>\n<table>\n<tbody>\n<tr>\n<td><strong>Actions of Angiotensin II</strong></td>\n</tr>\n<tr>\n<td>\n<ul>\n<li>Produces powerful arteriolar constriction and a rise in SBP and DBP</li>\n<li>Acts directly on the adrenal cortex to increase aldosterone secretion</li>\n<li>Facilitates the release of Norepinephrine by a direct action on postganglionic sympathetic neurons</li>\n<li>Contraction of mesangial cells with a resultant decrease in GFR</li>\n<li>Direct effect on renal tubules to increase Na<sup>+ </sup>reabsorption</li>\n<li>Acts on brain to decrease sensitivity of baroreceptor reflex, potentiating the pressor effect of AT II</li>\n<li>Acts on brain to increase water intake and increase secretion of ADH and ACTH</li>\n</ul>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Most potent stimulus for secretin is",
    "choices": [
      {
        "id": 1,
        "text": "Dilatation of intestine"
      },
      {
        "id": 2,
        "text": "Acid chime"
      },
      {
        "id": 3,
        "text": "Protein"
      },
      {
        "id": 4,
        "text": "Fat"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Most potent stimulus for secretin is acid. Fats are of secondary importance.</p>\n<p><strong>Releasers of gastrointestinal hormones</strong></p>\n<ul>\n<li><strong>S</strong> &rarr; Primary physiologic stimulus for release</li>\n<li><strong>S-</strong> &rarr; Stimulus of secondary importance</li>\n<li><strong>I</strong> &rarr; Inhibits release physiologically</li>\n</ul>\n<table style=\"width: 331px;\">\n<tbody>\n<tr style=\"height: 13.8px;\">\n<td style=\"width: 75px; height: 13.8px;\"><strong>Releaser</strong></td>\n<td style=\"width: 55px; height: 13.8px;\"><strong>Gastrin</strong></td>\n<td style=\"width: 24.6px; height: 13.8px;\"><strong>CCK</strong></td>\n<td style=\"width: 61.4px; height: 13.8px;\"><strong>Secretin</strong></td>\n<td style=\"width: 23px; height: 13.8px;\"><strong>GIP</strong></td>\n<td style=\"width: 56px; height: 13.8px;\"><strong>Motilin</strong></td>\n</tr>\n<tr style=\"height: 13px;\">\n<td style=\"width: 75px; height: 13px;\">Protein</td>\n<td style=\"width: 55px; height: 13px;\">S</td>\n<td style=\"width: 24.6px; height: 13px;\">S</td>\n<td style=\"width: 61.4px; height: 13px;\">0</td>\n<td style=\"width: 23px; height: 13px;\">S</td>\n<td style=\"width: 56px; height: 13px;\">0</td>\n</tr>\n<tr style=\"height: 13px;\">\n<td style=\"width: 75px; height: 13px;\">Fat</td>\n<td style=\"width: 55px; height: 13px;\">0</td>\n<td style=\"width: 24.6px; height: 13px;\">S</td>\n<td style=\"width: 61.4px; height: 13px;\">S-</td>\n<td style=\"width: 23px; height: 13px;\">S</td>\n<td style=\"width: 56px; height: 13px;\">S-</td>\n</tr>\n<tr style=\"height: 13px;\">\n<td style=\"width: 75px; height: 13px;\">Carbohydrate</td>\n<td style=\"width: 55px; height: 13px;\">0</td>\n<td style=\"width: 24.6px; height: 13px;\">0</td>\n<td style=\"width: 61.4px; height: 13px;\">0</td>\n<td style=\"width: 23px; height: 13px;\">S</td>\n<td style=\"width: 56px; height: 13px;\">0</td>\n</tr>\n<tr style=\"height: 13px;\">\n<td style=\"width: 75px; height: 13px;\">Acid</td>\n<td style=\"width: 55px; height: 13px;\">I</td>\n<td style=\"width: 24.6px; height: 13px;\">S-</td>\n<td style=\"width: 61.4px; height: 13px;\">S</td>\n<td style=\"width: 23px; height: 13px;\">0</td>\n<td style=\"width: 56px; height: 13px;\">S-</td>\n</tr>\n<tr style=\"height: 13px;\">\n<td style=\"width: 75px; height: 13px;\">Distension</td>\n<td style=\"width: 55px; height: 13px;\">S</td>\n<td style=\"width: 24.6px; height: 13px;\">0</td>\n<td style=\"width: 61.4px; height: 13px;\">0</td>\n<td style=\"width: 23px; height: 13px;\">0</td>\n<td style=\"width: 56px; height: 13px;\">0</td>\n</tr>\n<tr style=\"height: 13px;\">\n<td style=\"width: 75px; height: 13px;\">Nerve</td>\n<td style=\"width: 55px; height: 13px;\">S</td>\n<td style=\"width: 24.6px; height: 13px;\">0</td>\n<td style=\"width: 61.4px; height: 13px;\">0</td>\n<td style=\"width: 23px; height: 13px;\">0</td>\n<td style=\"width: 56px; height: 13px;\">S</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Migrating motor complex",
    "choices": [
      {
        "id": 1,
        "text": "Occurs upon arrival of food"
      },
      {
        "id": 2,
        "text": "Begins in lower part of intestine"
      },
      {
        "id": 3,
        "text": "Occurs at a rate of 5cm/min in stomach"
      },
      {
        "id": 4,
        "text": "Are initiated by kajal cells"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Migrating motor complex </strong>are the modified pattern of electrical and motor activity in gastrointestinal smooth muscle that occur during fasting between periods of digestion.</p>\n<ul>\n<li>These cycles (MMC) migrate from stomach to the distal ileum.</li>\n<li>They are initiated by motilin.</li>\n<li>The contractions migrate aborally at a rate of about 5cm/min, and also occur at intervals of approximately 100 minutes.</li>\n<li>Gastric secretion, bile flow, and pancreatic secretion increase during each MMC. They likely serve to clear the stomach and small intestine of luminal contents in preparation for the next meal.</li>\n<li>Upon ingestion of a meal secretion of motilin is suppressed and the MMC is abolished.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Leptin level in obesity are:",
    "choices": [
      {
        "id": 1,
        "text": "Low"
      },
      {
        "id": 2,
        "text": "Normal"
      },
      {
        "id": 3,
        "text": "High"
      },
      {
        "id": 4,
        "text": "Fluctuating"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<ul>\n<li>Leptin is an appetite supressing hormone secreted by fat cells. Thus, as fat stores increase and more leptin is released, food intake is inhibited and energy expenditure is increased.</li>\n<li>Most obese people have high circulating level of leptin but the paradox is that the appetite suppressing effect is not seen in them.\n<ul>\n<li>Leptin resistance in obese persons may be due to its failure to cross the blood-brain barrier and reach the hypothalamus.</li>\n<li>A recent study has indicated that triglycerides, which are elevated in obesity, inhibit the transport of leptin across the blood-brain barrier.</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "EDRF Induced vasodilatation is mediated by",
    "choices": [
      {
        "id": 1,
        "text": "Decreased intracellular cGMP"
      },
      {
        "id": 2,
        "text": "Increased intracellular cGMP"
      },
      {
        "id": 3,
        "text": "Increased extracellular cAMP"
      },
      {
        "id": 4,
        "text": "Decreased intracellular cAMP"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<ul>\n<li>EDRF Induced vasodilatation is mediated by Increased intracellular cGMP.</li>\n<li>Endothelial cells produce endothelial derived relaxing factor (EDRF) , a substance that is now known to be Nitric oxide (NO).</li>\n<li>NO and ANP hormone act via increasing intracellular cGMP.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Acidophils secrete",
    "choices": [
      {
        "id": 1,
        "text": "GH"
      },
      {
        "id": 2,
        "text": "TSH"
      },
      {
        "id": 3,
        "text": "ACTH"
      },
      {
        "id": 4,
        "text": "FSH"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Acidophils secrete:</p>\n<ul>\n<li>Lactotroph (10 &ndash; 30 %)</li>\n<li>Somatotroph (50%)</li>\n</ul>\n<p>Basophils secrete:</p>\n<ul>\n<li>Gonadotroph (20%)</li>\n<li>Corticotroph (10%)</li>\n<li>Thyrotrope (5%)</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Mineralocorticoid receptors are present in all of the following marked sites except",
    "choices": [
      {
        "id": 1,
        "text": "A"
      },
      {
        "id": 2,
        "text": "B"
      },
      {
        "id": 3,
        "text": "C"
      },
      {
        "id": 4,
        "text": "D"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The marked site B indicates<strong> Liver </strong>in which mineralocorticoid receptors are <strong>absent.</strong></p>\n<p>Mineralocorticoid receptors are present in:</p>\n<ul>\n<li>Kidney</li>\n<li>Colon</li>\n<li>Salivary gland</li>\n<li>Sweat gland</li>\n<li>Hippocampus of brain</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://daily-rounds-staging.s3.amazonaws.com/uploads/15c2e62e91f448bc990088bf8be49034.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Blood testis barrier is formed by",
    "choices": [
      {
        "id": 1,
        "text": "Leydig cells"
      },
      {
        "id": 2,
        "text": "Vas deferens"
      },
      {
        "id": 3,
        "text": "Sertoli cells"
      },
      {
        "id": 4,
        "text": "Epididymis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Cytoplasmic processes from <strong>Sertoli cells</strong> along with tight junctions forms <strong>blood testis barrier</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c37796170d9e4af3beedb825b8c2d3d7x850x978.PNG"
    ]
  },
  {
    "text": "A gastric muscle was taken and electrical and mechanical recording was done. All of the following statements are true about the recording except?",
    "choices": [
      {
        "id": 1,
        "text": "Tension developed proportionally to the frequency of spike potential"
      },
      {
        "id": 2,
        "text": "Tension developed directly proportionally to the amplitude of spike potentials"
      },
      {
        "id": 3,
        "text": "Threshold voltage is \u2013 50 mv"
      },
      {
        "id": 4,
        "text": "Frequency is around 6 / min"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Tension depends on the <strong>frequency </strong>of spike potentials.</p>\n<p>From the x axis , the frequency is <strong>1 per 10 sec</strong> or <strong>6 per min.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://daily-rounds-staging.s3.amazonaws.com/uploads/fb881a917d7c41629a58aeb118effd4b.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not a function of gut flora",
    "choices": [
      {
        "id": 1,
        "text": "Production of Vit K"
      },
      {
        "id": 2,
        "text": "Fermentation of mucin"
      },
      {
        "id": 3,
        "text": "Decreased proliferation of epithelial cells"
      },
      {
        "id": 4,
        "text": "Synthesis of short chain fatty acids"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Colonic bacteria cause <strong>increased proliferation and differentiation </strong>of epithelial cells.</p>\n<p>Other functions are:</p>\n<ul>\n<li style=\"text-align: justify;\"><strong>Fermentation</strong> of non-digestible dietary residue and endogenous mucus.</li>\n<li style=\"text-align: justify;\">Production of <strong>Short chain fatty acids</strong> and <strong>Vitamin K.</strong></li>\n<li style=\"text-align: justify;\">Absorption of <strong>ions.</strong></li>\n<li style=\"text-align: justify;\">Development and homeostasis of immune system.</li>\n<li style=\"text-align: justify;\">Protection against pathogens</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Pseudounipolar cells are",
    "choices": [
      {
        "id": 1,
        "text": "Dorsal root ganglion"
      },
      {
        "id": 2,
        "text": "Cerebellar purkinje cells"
      },
      {
        "id": 3,
        "text": "Motor neuron"
      },
      {
        "id": 4,
        "text": "Pyramidal cells of hippocampus"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<ul>\n<li><strong>Pseudounipolar cells</strong> are present in <strong>dorsal root ganglion</strong>.</li>\n<li><strong>Motor neuron, cerebellar purkinje cells and pyramidal cells of hippocampus</strong> are examples of <strong>multipolar neurons.</strong></li>\n</ul>\n<p><strong>Types of neurons:</strong></p>\n<ul>\n<li><strong>Unipolar neuron:</strong>\n<ul>\n<li>Single process with different segments serving as receptive and releasing terminals.</li>\n<li>Present only in <strong>invertebrates</strong></li>\n</ul>\n</li>\n<li><strong>Bipolar neuron:</strong>\n<ul>\n<li>Has one axon (releasing terminal) and one dendrite (receptive terminal)</li>\n<li>Example &ndash; <strong>Bipolar cells of retina</strong></li>\n</ul>\n</li>\n<li><strong>Pseudounipolar neuron:</strong>\n<ul>\n<li><strong>Subtype of bipolar neuron</strong></li>\n<li>Single process divides into 2 axons &ndash; one supplying skin or muscle and another goes to spinal cord.</li>\n</ul>\n</li>\n<li><strong>Multipolar neuron:</strong>\n<ul>\n<li>Has one axon and several dendrites.</li>\n<li>Examples - motor neurons, hippocampal pyramidal cells with dendrites in the apex and base, and cerebellar Purkinje cells.</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d5fadbd04521476b98d620998e51af21x720x540.JPEG"
    ]
  },
  {
    "text": "Which of the following statements is true",
    "choices": [
      {
        "id": 1,
        "text": "K+ is the main determinant of RMP"
      },
      {
        "id": 2,
        "text": "RMP of neuron is close to Isoelectric potential of K+"
      },
      {
        "id": 3,
        "text": "RMP of neuron is equal to Isoelectric potential of Cl-"
      },
      {
        "id": 4,
        "text": "All of the above"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The intracellular and extracellular <strong>K+ concentrations</strong> are the prime determinants of the resting membrane potential.</p>\n<p><strong>RMP of neuron</strong> is <strong>-70 mV</strong>.</p>\n<p>It is <strong>close to isoelectric potential of K+</strong> and <strong>equal to isoelectric potential of Cl-.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Decrease in extracellular calcium concentration",
    "choices": [
      {
        "id": 1,
        "text": "Decreases excitability of the nerve"
      },
      {
        "id": 2,
        "text": "Increases excitability of nerve"
      },
      {
        "id": 3,
        "text": "Has no effect on excitability"
      },
      {
        "id": 4,
        "text": "None of the above"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>A <strong>decrease in extracellular Ca2+ concentration</strong> <strong>increases the excitability of nerve and muscle</strong> cells by decreasing the amount of depolarization necessary to initiate the changes in the Na+ and K+ conductance that produce the action potential.</p>\n<p>Conversely, an <strong>increase in extracellular Ca2+ concentration</strong> can <strong>stabilize the membrane</strong> by decreasing excitability.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = 'Physiology St 1';
        const quizFilename = 'physiology-st-1-c2ed3494.html';
        let hierarchy = ["Marrow", "NEET PG Test Series Subject Wise", "Year 2017 - 18"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>