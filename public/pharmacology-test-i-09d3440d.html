<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pharmacology Test I - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Test Series Subject Wise / Year 2018 - 19
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">50</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "An elderly patient with renal impairment has overactive bladder. Which of the following drug needs dose adjustment in order to be used in the above patient?",
    "choices": [
      {
        "id": 1,
        "text": "Solifenacin"
      },
      {
        "id": 2,
        "text": "Oxybutynin"
      },
      {
        "id": 3,
        "text": "Trospium"
      },
      {
        "id": 4,
        "text": "Tolterodine"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Trospium is the only antimuscarininc agent used in overactive bladder that is eliminated primarily by kidneys</p>\n<p>Over 60% of absorbed drug is eliminated unchanged by kidneys</p>\n<p>Dose adjustments are essential in patients with impaired renal function</p>\n<p>Solifenacin and oxybutynin are primarily metabolized by CYP3A4 whereas tolterodine is metabolized by both CYP2D6 and CYP3A4 (options a, b and d)</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Cholinergic synapses occur at",
    "choices": [
      {
        "id": 1,
        "text": "Sympathetic ganglia"
      },
      {
        "id": 2,
        "text": "Parasympathetic ganglia"
      },
      {
        "id": 3,
        "text": "Sweat glands"
      },
      {
        "id": 4,
        "text": "All of the above"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Cholinergic synapses location</p>\n<ul>\n<li><strong>Autonomic effector sites</strong> innervated by postganglionic parasympathetic nerves</li>\n<li><strong>Sweat glands</strong> innervated by postganglionic sympathetic nerves</li>\n<li>Sympathetic and parasympathetic <strong>ganglia</strong> and the adrenal medulla, innervated by preganglionic autonomic nerves</li>\n<li><strong>Motor end plates</strong> on skeletal muscle, innervated by somatic motor nerves</li>\n<li>Certain <strong>synapses in the CNS</strong> where acetylcholine can have either pre- or postsynaptic action</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Malathion is indicated clinically for topical treatment of",
    "choices": [
      {
        "id": 1,
        "text": "Norwegian scabies"
      },
      {
        "id": 2,
        "text": "Pediculosis capitis"
      },
      {
        "id": 3,
        "text": "Tinea capitis"
      },
      {
        "id": 4,
        "text": "None of the above"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Malathion is used for pediculosis capitis in cases of permethrin resistance</p>\n<p>Malathion has low toxicity in mammalian species. It can be detoxified by plasma carboxylesterase.</p>\n<p>The detoxification reaction is more rapid in mammals and birds than insects.</p>\n<p>\u00a0</p>\n<p><strong>Note:\u00a0</strong>Malathion 0.5% topical solution is used as a treatment of <strong>classic scabies</strong> when permethrin is ineffective.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Mivacurium has a short duration of action due to its rapid metabolism by",
    "choices": [
      {
        "id": 1,
        "text": "Hofmann elimination"
      },
      {
        "id": 2,
        "text": "Plasma cholinesterase"
      },
      {
        "id": 3,
        "text": "Both a and b"
      },
      {
        "id": 4,
        "text": "None of the above"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Mivacurium is extremely sensitive to catalysis by plasma cholinesterase and other hydrolases that accounts for its short duration of action.</p>\n<p>Atracurium and cistracurium undergoes Hofmann elimination along with plasma hydrolysis (option a).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Alpha 1A selective receptor antagonist among the following is?",
    "choices": [
      {
        "id": 1,
        "text": "Prazosin"
      },
      {
        "id": 2,
        "text": "Silodosin"
      },
      {
        "id": 3,
        "text": "Terazosin"
      },
      {
        "id": 4,
        "text": "Alfluzosin"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Silodosin exhibits selectivity over alpha 1A (\u03b1<sub>1A</sub>) receptors than alpha 1B (\u03b1<sub>1B</sub>) receptors.</p>\n<p>Tamsulosin is the other alpha 1A selective blocker.</p>\n<p>Alpha 1A selective blockers</p>\n<ul>\n<li>Lesser incidence of dizziness and changes in blood pressure</li>\n<li>Higher incidence of abnormal ejaculation (retrograde ejaculation)</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Beta-blocker having potassium channel opening action",
    "choices": [
      {
        "id": 1,
        "text": "Carvedilol"
      },
      {
        "id": 2,
        "text": "Carteolol"
      },
      {
        "id": 3,
        "text": "Nebivolol"
      },
      {
        "id": 4,
        "text": "Tilisolol"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Tilisolol</strong> is a third-generation non-selective beta-blocker having an additional action of opening the potassium channels.</p>\n<p>Additional activities of 3<sup>rd</sup> generation beta-blockers:</p>\n<ul>\n<li>\u03b11 adrenergic receptor blockade: labetalol, carvedilol, bucindolol, bevantolol, nipradilol</li>\n<li>Increased production of NO: celiprolol, nebivolol, carteolol, bopindolol, nipradolol</li>\n<li>\u03b22 agonist properties: celiprolol, carteolol, bopindolol</li>\n<li>Ca2+ entry blockade: carvedilol, betaxolol, bevantolol</li>\n<li><strong>Opening of K+ channels: tilisolol</strong></li>\n<li><strong>Antioxidant action: carvedilol</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Highly sedative antihistamine among the following is",
    "choices": [
      {
        "id": 1,
        "text": "Chlorpheniramine maleate"
      },
      {
        "id": 2,
        "text": "Promethazine"
      },
      {
        "id": 3,
        "text": "Cetirizine"
      },
      {
        "id": 4,
        "text": "Levocetirizine"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Promethazine</strong> is a highly sedative first generation antihistamine.</p>\n<p>Chlorpheniramine maleate is also a first generation antihistamine but it has mild sedative action (option a).</p>\n<p>Cetirizine and levocetirizine are second generation antihistamine with very minimal/no sedative action (options c and d).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is true about acetyl salicylic acid?",
    "choices": [
      {
        "id": 1,
        "text": "Reversible inhibitor of cyclooxygenase"
      },
      {
        "id": 2,
        "text": "Clearance is independent of plasma concentration"
      },
      {
        "id": 3,
        "text": "Antiplatelet action is related to pre-systemic COX inhibition"
      },
      {
        "id": 4,
        "text": "Irreversible inhibitor of lipoxygenase"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Acetyl salicylic acid is the chemical name of aspirin.</p>\n<ul>\n<li><strong>Low dose aspirin acetylates the COX enzyme</strong> in the portal circulation(pre systemic) and deactivates it before aspirin is deacetylated in the liver</li>\n<li>Aspirin is an<strong> irreversible</strong> inhibitor of the COX (cyclooxygenase enzyme) (option a)</li>\n<li>Aspirin has no inhibitory effects on lipoxygenase (option d)</li>\n<li>Aspirin shows saturation kinetics; at lower plasma concentration aspirin shows first order kinetics and the rate of elimination is proportional to the plasma concentration, whereas at higher plasma concentration zero order kinetics can be seen (option b)</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Mechanism of action of nicorandil in angina is/are",
    "choices": [
      {
        "id": 1,
        "text": "Has a nitrate-like action"
      },
      {
        "id": 2,
        "text": "Agonist at ATP-sensitive potassium channels"
      },
      {
        "id": 3,
        "text": "Both A and B"
      },
      {
        "id": 4,
        "text": "pFOX inhibition"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Nicorandil has both <strong>nitrate-like</strong> <strong>(c-GMP dependent) properties</strong> and acts as an <strong>agonist of ATP-sensitive potassium channels</strong>.</p>\n<p>Vasodilating action of nicorandil is potentiated by PDE5 inhibitors and only partially blocked by inhibitors of potassium sensitive ATP channels suggesting that both mechanisms is relevant for its action.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Metolazone belongs to the following class of diuretics",
    "choices": [
      {
        "id": 1,
        "text": "Loop diuretics"
      },
      {
        "id": 2,
        "text": "Potassium sparing diuretics"
      },
      {
        "id": 3,
        "text": "Thiazide like diuretics"
      },
      {
        "id": 4,
        "text": "Carbonic anhydrase inhibitors"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Metolazone</strong> is a thiazide-like diuretic.</p>\n<p>Points to note about metolazone:</p>\n<ul>\n<li>Unlike other diuretics, the <strong>antihypertensive and diuretic action</strong> of metolazone is <strong>retained even in severe renal failure (GFR &lt;15 ml/min).</strong></li>\n<li><strong>Additional proximal tubular action</strong> has been observed.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The following beta blocker used in arrhythmias has additional class I action",
    "choices": [
      {
        "id": 1,
        "text": "Sotalol"
      },
      {
        "id": 2,
        "text": "Esmolol"
      },
      {
        "id": 3,
        "text": "Propranolol"
      },
      {
        "id": 4,
        "text": "None of the above"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Propranolo</strong>l is a non-selective beta blocker with additional membrane stabilising action especially at higher doses: <strong>Na+ channel blockade/ class I action.\u00a0</strong></p>\n<p>Sotalol is a non-selective beta blocker with prominent class III action: K+ channel blockade (option a).</p>\n<p>Esmolol is a beta 1 selective blocker that does not have any additional class effect (option b).</p>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following ACE inhibitor is a prodrug ?",
    "choices": [
      {
        "id": 1,
        "text": "Fosinopril"
      },
      {
        "id": 2,
        "text": "Enalaprilat"
      },
      {
        "id": 3,
        "text": "Lisinopril"
      },
      {
        "id": 4,
        "text": "Captopril"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Fosinopri</strong>l is a prodrug that is converted to its <strong>active form fosinoprilat</strong>.</p>\n<p>Enalaprilat is the active form of enalapril (option b).</p>\n<p>Lisinopril is the active lysine derivative of enalapril (option c). Captopril is also an active drug (option d).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is microsomal triglyceride transfer inhibitor?",
    "choices": [
      {
        "id": 1,
        "text": "Alirocumab"
      },
      {
        "id": 2,
        "text": "Lomitapide"
      },
      {
        "id": 3,
        "text": "Saroglitazar"
      },
      {
        "id": 4,
        "text": "Acipimox"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Lomitapid</strong>e belongs to a new class of <strong>microsomal triglyceride transfer inhibitor</strong>.</p>\n<p>Microsomal triglyceride transferm protein (MTP) is essential for the synthesis of VLDL.</p>\n<p>Lomitapide is approved for use in <strong>homozygous familial hypercholesterolemia</strong>.</p>\n<p>Alirocumab is a PCSK9 inhibitor (option a).</p>\n<p>Saroglitazar is a dual PPAR inhibitor (option c).</p>\n<p>Acipimox is a nicotinic acid derivative (option d).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "During your ward rounds, you were asked to name a calcium sensitizer used in the management of a patient with acute decompensated heart failure. Which of the following drugs would you mention?",
    "choices": [
      {
        "id": 1,
        "text": "Levosimendan"
      },
      {
        "id": 2,
        "text": "Milrinone"
      },
      {
        "id": 3,
        "text": "Enoximone"
      },
      {
        "id": 4,
        "text": "Cinacalcet"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Levosimendan</strong> is a <strong>myofilament calcium sensitizer</strong> used in the short-term management of <strong>acute decompensated heart failure.</strong></p>\n<p>It<strong> increases the sensitivity of contractile myofilaments</strong> to Calcium by binding and inducing a conformational change in thin-filament regulatory protein troponin-C.</p>\n<p>It <strong>increases</strong> cardiac output and <strong>decreases vascular resistance</strong> (ionodilator). Other actions like inhibition of phosphodiesterases, opening of potassium channels, and inhibition of pro-inflammatory cytokines are observed.</p>\n<p>Other options :</p>\n<p>Option B and C: <strong>Milrinone</strong> and<strong> enoximone </strong>are <strong>PDE-3 inhibitors</strong> indicated in acute decompensated heart failure</p>\n<p>Option D: <strong>Cinacalcet</strong> is a calcium sensitizer that <strong>increases the </strong>sensitivity of calcium sensing receptor to extracellular calcium in parathyroid glands. It is used to reduce serum calcium levels <strong>primary </strong>and <strong>secondary hyperparathyroidism.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "All of the following are short acting insulin analogs except",
    "choices": [
      {
        "id": 1,
        "text": "Lispro"
      },
      {
        "id": 2,
        "text": "Aspart"
      },
      {
        "id": 3,
        "text": "Glargine"
      },
      {
        "id": 4,
        "text": "Glulisine"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Glargine is a long acting peakless insulin.</strong></p>\n<p>Short acting insulin analogs</p>\n<ul>\n<li>Lispro</li>\n<li>Aspart</li>\n<li>Glulisine</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Half life of liothyronine (T3) is",
    "choices": [
      {
        "id": 1,
        "text": "1 day"
      },
      {
        "id": 2,
        "text": "0.75 day"
      },
      {
        "id": 3,
        "text": "7 days"
      },
      {
        "id": 4,
        "text": "7 weeks"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Liothyronine is short acting (t1/2~1 day)</strong> when compared to levothyroxine (t1/2 ~ 7 days).</p>\n<p>Liothyronine has to be administered three times per day whereas levothyroxine can be administered once daily.</p>\n<p>Liothyronine (T3) is the more active form of thyroid hormone and has a rapid onset of action. It is indicated in conditions where rapid action is preferred like rare cases of <strong>myxedema coma</strong>.</p>\n<p>Note: The earlier version of Goodman and Gillman (12th edition: 1143) mentioned the plasma half life to be around 0.75 days. Some of the journals do reflect the same.\u00a0</p>\n<p>But the recent version of both Goodman and Gillman and Katzung mentions the half life to be around 1 day. The journal mentioned in the reference also mentions that the half life is around 1 day for euthyroid patients and we think the most appropriate answer is 1 day.\u00a0</p>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is incorrect regarding plasma calcium ?",
    "choices": [
      {
        "id": 1,
        "text": "Normal calcium level is 9-11 mg/dl"
      },
      {
        "id": 2,
        "text": "Acidosis favours ionization of calcium"
      },
      {
        "id": 3,
        "text": "Most of the unionized calcium is bound to albumin"
      },
      {
        "id": 4,
        "text": "Unionized calcium is physiologically important"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Ionized form of calcium is physiologically important.</strong></p>\n<p>Normal calcium level in plasma is<strong> 9-11 mg/dl</strong> (option a).</p>\n<p>40% of calcium is bound to plasma albumin (option c). 10 % is bound to citrate, phosphate and carbonate.</p>\n<p>Remaining 50% is in ionized form and is physiologically important.\u00a0<strong>Acidosis favours ionization of calcium</strong> whereas alkalosis favours deionization of calcium (option d).</p>\n<p>Clinical correlate:</p>\n<ul>\n<li>Hyperventilation by causing alkalosis favours deionization of calcium.</li>\n<li>Can result in precipitation of tetany and laryngospasm in calcium deficient pateints</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is a 5-alpha reductase inhibitor ?",
    "choices": [
      {
        "id": 1,
        "text": "Flutamide"
      },
      {
        "id": 2,
        "text": "Finasteride"
      },
      {
        "id": 3,
        "text": "Methyltestosterone"
      },
      {
        "id": 4,
        "text": "Both a and b"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Finasterid</strong>e is a 5-alpha reductase inhibitor indicated in <strong>Benign prostatic hypertrophy and female hirsutism.</strong></p>\n<p>Flutamide is an antiandrogen (option a).</p>\n<p>Methyltestosterone is 17 alpha methylated derivative of testosterone (option c).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following accurately represents the action of glucocorticoids on the function of osteoblasts and osteoclasts?",
    "choices": [
      {
        "id": 1,
        "text": "Suppresses both osteoclasts and osteoblasts"
      },
      {
        "id": 2,
        "text": "Stimulates both osteoclasts and osteoblasts"
      },
      {
        "id": 3,
        "text": "Suppresses osteoclasts and stimulates osteoblasts"
      },
      {
        "id": 4,
        "text": "Suppresses osteoblasts and stimulates osteoclasts"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Glucocorticoids\u00a0<strong>inhibit\u00a0osteoblasts and stimulate osteoclasts\u00a0</strong>resulting\u00a0in the\u00a0development of <strong>osteoporosis.</strong></p>\n<p>Other causes of osteoporosis by corticosteroids:</p>\n<ul>\n<li>Inhibition of gonadal steroidal hormones</li>\n<li>Reduced gastrointestinal absorption of calcium</li>\n<li>The secondary effect of decreased calcium absorption: increased parathyroid hormone leading to further resorption</li>\n</ul>\n<p>The <strong>ribs and the vertebrae</strong> are the <strong>most frequent</strong> sites of fracture</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The primary mechanism of action of the emergency contraceptive ulipristal is",
    "choices": [
      {
        "id": 1,
        "text": "Spermicidal activity"
      },
      {
        "id": 2,
        "text": "Alteration of tubal motility"
      },
      {
        "id": 3,
        "text": "Inhibition of ovulation"
      },
      {
        "id": 4,
        "text": "Antiproliferative effects on uterus"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Ulipristal is a<strong> selective progesterone receptor modulator</strong>. The most relevant action is <strong>inhibition of ovulation</strong> due to its progesterone regulation action at many levels including inhibition of LH release from hypothalamus.</p>\n<p>Antiproliferative effects on uterus are seen only at higher doses (option d).</p>\n<p>It has no/minimal activity on tubal motility and no spermicidal activity (option a and b).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is an intravenous induction anesthetic agent?",
    "choices": [
      {
        "id": 1,
        "text": "Enflurane"
      },
      {
        "id": 2,
        "text": "Etomidate"
      },
      {
        "id": 3,
        "text": "Xenon"
      },
      {
        "id": 4,
        "text": "Nitrous oxide"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Etomidate </strong>is an intravenous induction anesthetic agent.</p>\n<p>Enflurane, nitrous oxide and xenon are inhalational induction anesthetic agents.</p>\n<p>Intravenous induction agents</p>\n<ul>\n<li>Thiopental</li>\n<li>Methohexital</li>\n<li>Ketamine</li>\n<li>Propofol</li>\n<li>Etomidate</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Hyponatremia risk is highest with the following antiepileptic drug",
    "choices": [
      {
        "id": 1,
        "text": "Carbamazepine"
      },
      {
        "id": 2,
        "text": "Phenytoin"
      },
      {
        "id": 3,
        "text": "Phenobarbital"
      },
      {
        "id": 4,
        "text": "Oxcarbazepine"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Oxcarbazepine is a keto analog of carbamazepine and has a higher risk of hyponatremia than carbamazepine.</strong></p>\n<p>Carbamazepine <strong>potentiates ADH action</strong> and can cause hyponatremia and water retention especially in elderly people.</p>\n<p>Unlike carbamazepine, oxcarbazepine does not cause autoinduction of hepatic CYP enzymes and is also a less potent inducer of hepatic metabolizing enzymes.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Atypical antipsychotic with least risk of galactorrhoea is",
    "choices": [
      {
        "id": 1,
        "text": "Iloperidone"
      },
      {
        "id": 2,
        "text": "Respiridone"
      },
      {
        "id": 3,
        "text": "Quetiapine"
      },
      {
        "id": 4,
        "text": "Aripiprazole"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Aripiprazole has almost no risk of galactorrhoea.</strong> The adverse effect corresponds to their higher D2 blocking potency.</p>\n<p>Galactorrhoea risk stratification for atypical antipsychotics</p>\n<p>High risk:</p>\n<ul>\n<li>Respiridone (option b)</li>\n<li>Paliperidone</li>\n</ul>\n<p>Limited risk:</p>\n<ul>\n<li>Asenapine</li>\n<li>Ilaperidone (option a)</li>\n<li>Olanzapine</li>\n<li>Quetiapine (option c)</li>\n<li>Ziprasidone</li>\n</ul>\n<p>Almost no risk:</p>\n<ul>\n<li>Clozapine</li>\n<li>Aripiprazole</li>\n<li>Brexpiprazole</li>\n<li>Cariprazine</li>\n</ul>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Transdermal preparation of the following agent is available for use in Parkinson\u2019s disease",
    "choices": [
      {
        "id": 1,
        "text": "Ropinirole"
      },
      {
        "id": 2,
        "text": "Rotigotine"
      },
      {
        "id": 3,
        "text": "Pramipexole"
      },
      {
        "id": 4,
        "text": "Selegiline"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Rotigotine</strong> is a <strong>dopamine receptor agonist</strong> that is available as transdermal preparation for use in Parkinson\u2019s disease.</p>\n<p>Ropinirole and pramipexole are dopamine receptor agonists but are not available as transdermal preparation (options a and c).</p>\n<p>Selegiline is a MAO-B inhibitor that is available as a transdermal patch but the transdermal preparation is indicated only in major depression (option d).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Orexin receptor antagonist indicated for insomnia is",
    "choices": [
      {
        "id": 1,
        "text": "Aprepitant"
      },
      {
        "id": 2,
        "text": "Rolaprepitant"
      },
      {
        "id": 3,
        "text": "Suvorexant"
      },
      {
        "id": 4,
        "text": "Netupitant"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Suvorexant</strong> is the <strong>orexin receptor antagonist</strong> that is approved for <strong>use in insomnia</strong>. <strong>Orexins promote wakefulness</strong> and antagonists of orexin receptor induces sleep.</p>\n<p>Aprepitant, rolaprepitant and netupitant are NK1 receptor antagonist used as antiemetics (options a, b and d).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Megaloblastic anemia is caused by deficiency of",
    "choices": [
      {
        "id": 1,
        "text": "Vitamin B9"
      },
      {
        "id": 2,
        "text": "Vitamin B12"
      },
      {
        "id": 3,
        "text": "Either B9 and/or B12"
      },
      {
        "id": 4,
        "text": "Vitamin C"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Megaloblastic anemia can occur in the deficiency of either Vitamin B9 (folic acid) and/or vitamin B12 (cobalamin).</strong></p>\n<p>Vitamin C deficiency is associated with scurvy.</p>\n<p>Clinical correlate: In undiagnosed megaloblastic anemia, folic acid should not be prescribed alone without vitamin B12 supplementation.</p>\n<p>Folic acid alone causes improvement of anemic symptoms as higher doses of folic acid will circumvent the methylfolate trap (option c).</p>\n<p>But neurological dysfunction may occur or progress if already present due to vitamin B12 deficiency.</p>\n<p>The meagre amount of vitamin B12 present is also diverted to hematopoesis if only folic acid is administered.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Protamine sulfate is an antidote for",
    "choices": [
      {
        "id": 1,
        "text": "Warfarin"
      },
      {
        "id": 2,
        "text": "Heparin"
      },
      {
        "id": 3,
        "text": "Vitamin K"
      },
      {
        "id": 4,
        "text": "Dabigatran"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Protamine sulfate is a mixture of basic polypeptides isolated from salmon sperm. It is indicated for reversal of heparin overdose.</p>\n<p>It binds acidic heparin with high affinity and neutralises the anticoagulant activity. The resultant protamine-heparin complexes are cleared.</p>\n<p>Vitamin K is used in warfarin overdose (options a and c).</p>\n<p>Idarucizumab is an antidote for dabigatran (option d).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Vorapaxar is a newer antiplatelet agent that has the following mechanism of action",
    "choices": [
      {
        "id": 1,
        "text": "ADP receptor antagonism"
      },
      {
        "id": 2,
        "text": "COX inhibition"
      },
      {
        "id": 3,
        "text": "GPIIb/IIa receptor antagonism"
      },
      {
        "id": 4,
        "text": "Protease activated receptor-1 antagonism"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Vorapaxar is a competitive antagonist of protease activated receptor-1 (PAR-1).</p>\n<p>It inhibits thrombin platelet aggregation.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following does not activate plasminogen bound to fibrin preferentially?",
    "choices": [
      {
        "id": 1,
        "text": "Alteplase"
      },
      {
        "id": 2,
        "text": "Anistreplase"
      },
      {
        "id": 3,
        "text": "Tenecteplase"
      },
      {
        "id": 4,
        "text": "Reteplase"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Anistreplase is a preformed complex of plasminogen and streptokinase that is acylated to protect the active sites. It does not activate plasminogen bound to fibrin preferentially.</p>\n<p>Plasminogen activators (fibrinolytics classification)</p>\n<p>Fibrin non-specific plasminogen activators</p>\n<ul>\n<li>Streptokinase</li>\n<li>Anistreplase</li>\n<li>Urokinase</li>\n</ul>\n<p>Fibrin specific plasminogen activators</p>\n<ul>\n<li>Alteplase</li>\n<li>Tenecteplase</li>\n<li>Reteplase</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "GLP-2 receptor agonist among the following is",
    "choices": [
      {
        "id": 1,
        "text": "Liraglutide"
      },
      {
        "id": 2,
        "text": "Albiglutide"
      },
      {
        "id": 3,
        "text": "Tedulglutide"
      },
      {
        "id": 4,
        "text": "All of the above"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Teduglutide is a GLP-2 receptor agonist indicated for use in short bowel syndrome. It is an intestinotrophic gut peptide that enhances the growth of intestinal mucosa through release of mediators.</p>\n<p>Liraglutide and albiglutide are GLP-1 receptor agonist indicated in the management of diabetes mellitus (options a and b).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Monoclonal antibody against IL 5 indicated for the treatment in severe asthma is",
    "choices": [
      {
        "id": 1,
        "text": "Omalizumab"
      },
      {
        "id": 2,
        "text": "Mepolizumab"
      },
      {
        "id": 3,
        "text": "Lebrikizumab"
      },
      {
        "id": 4,
        "text": "None of the above"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Mepolizumab is a monoclonal antibody against IL-5 that is indicated as an add-on to maintenance therapy in severe asthma with eosinophilic phenotype.</p>\n<p>Omalizumab is a monoclonal antibody against IgE (option a).</p>\n<p>Lebrikizumab is a monoclonal antibody against IL-13 (option c).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Ipratropium bromide belongs to the following class",
    "choices": [
      {
        "id": 1,
        "text": "Short acting beta 2 agonist"
      },
      {
        "id": 2,
        "text": "Long acting beta 2 agonist"
      },
      {
        "id": 3,
        "text": "Muscarinic agonist"
      },
      {
        "id": 4,
        "text": "Muscarinic antagonist"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Ipratropium bromide is a muscarinic antagonist that is indicated as an inhalational agent in COPD and asthma.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A pregnant woman who was in preterm labor was infused with an oxytocin receptor antagonist. Which of the following drugs was she likely administered?",
    "choices": [
      {
        "id": 1,
        "text": "Ritodrine"
      },
      {
        "id": 2,
        "text": "Magnesium sulfate"
      },
      {
        "id": 3,
        "text": "Atosiban"
      },
      {
        "id": 4,
        "text": "Terbutaline"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The <strong>oxytocin receptor antagonist</strong> that would have likely been administered to her is the tocolytic<strong>\u00a0atosiban</strong>.</p>\n<p><strong>Tocolytics</strong> are drugs that <strong>suppress uterine contractions</strong> of preterm labor. Atosiban acts as an <strong>oxytocin receptor antagonist</strong> and inhibits preterm labor at 24-33 weeks of gestation.</p>\n<p>Tocolytics can be effective only if administered before cervical dilatation reaches<strong> 4 cm</strong> and\u00a0the lower uterine segment is taken up minimally. Other tocolytics that are used to delay premature labor:</p>\n<ul>\n<li><strong>Beta-2 agonists</strong> - <strong>ritodrine</strong>,\u00a0<strong>terbutaline</strong>, isoxsuprine</li>\n<li><strong>Calcium channel blockers</strong> - nifedipine</li>\n<li><strong>Magnesium sulfate</strong> - It is a tocolytic as well as a first-line drug that is used in pre-eclampsia and eclampsia.\u00a0</li>\n<li>Indomethacin</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is a H2 receptor blocker?",
    "choices": [
      {
        "id": 1,
        "text": "Omeprazole"
      },
      {
        "id": 2,
        "text": "Cetirizine"
      },
      {
        "id": 3,
        "text": "Levocetirzine"
      },
      {
        "id": 4,
        "text": "Cimetidine"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Cimetidine is a H2 receptor blocker indicated in acid peptic disorders.</p>\n<p>Omeprazole is a proton pump inhibitor (option a).</p>\n<p>Cetirizine and levocetirizine are second generation H1 receptor blockers (options b and c).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Mechanism of action of the antidiarrheal agent racecadotril is",
    "choices": [
      {
        "id": 1,
        "text": "5HT4 receptor agonism"
      },
      {
        "id": 2,
        "text": "5HT3 receptor antagonism"
      },
      {
        "id": 3,
        "text": "Inhibition of peripheral enkephalinase"
      },
      {
        "id": 4,
        "text": "Opioid delta receptor antagonism"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Racecadotril is a <strong>peripheral enkephalinase inhibitor.</strong></p>\n<p>Enkephalins are delta-opioid receptor agonists that decrease secretions. Racecadotril acts as an antisecretory agent by <strong>increasing enkephalin levels.</strong> It has minimal/no effect on motility.</p>\n<p>Racecadotril is indicated for <strong>symptomatic treatment of diarrhea in infants and children</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Tenofovir belongs to the following class",
    "choices": [
      {
        "id": 1,
        "text": "Nucleoside reverse transcriptase inhibitor"
      },
      {
        "id": 2,
        "text": "Nucleotide reverse transcriptase inhibitor"
      },
      {
        "id": 3,
        "text": "Protease inhibitor"
      },
      {
        "id": 4,
        "text": "Integrase inhibitor"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Tenofovir is a derivative of adenosine monophosphate and is considered as a nucleotide analog.</p>\n<p><strong>Therefore, tenofovir is a nucleotide reverse transcriptase inhibitor.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following antimalarial agent is a fast acting schizonticide ?",
    "choices": [
      {
        "id": 1,
        "text": "Mefloquine"
      },
      {
        "id": 2,
        "text": "Pyrimethamine"
      },
      {
        "id": 3,
        "text": "Quinine"
      },
      {
        "id": 4,
        "text": "Artemether"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Pyrimethamine is a slow acting schizonticide (option b).</p>\n<p>Mefloquine and quinine are intermediate acting schizonticide (options a and c).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is NOT a bactericidal agent ?",
    "choices": [
      {
        "id": 1,
        "text": "Cotrimoxazole"
      },
      {
        "id": 2,
        "text": "Chloramphenicol"
      },
      {
        "id": 3,
        "text": "Ciprofloxacin"
      },
      {
        "id": 4,
        "text": "Cefotetan"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Chloramphenicol acts by inhibiting bacterial protein synthesis and is generally considered as a bacteriostatic agent.</p>\n<p>Cotrimoxazole is bactericidal due to the sequential blockade on bacterial folate synthesis (option a).</p>\n<p>Fluoroquinolones (ciprofloxacin) are bactericidal agents (option c).</p>\n<p>Cefotetan is a cephalosporin that inhibits bacterial cell wall synthesis resulting in bactericidal action (option d).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Alkalinisation of urine for overdose of acidic drugs is usually done by the following agent",
    "choices": [
      {
        "id": 1,
        "text": "Acetazolamide"
      },
      {
        "id": 2,
        "text": "Ascorbic acid"
      },
      {
        "id": 3,
        "text": "Sodium bicarbonate"
      },
      {
        "id": 4,
        "text": "All of the above"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Alkalinisation of urine is done by infusing sodium bicarbonate in 5% dextrose in water.</p>\n<p>Acetazolamide is not used for alkalinisation of urine as it can promote acidemia (option a).</p>\n<p>Ascorbic acid causes acidification of urine (option b).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following vitamin deficiency results form isoniazid use ?",
    "choices": [
      {
        "id": 1,
        "text": "Vitamin B6"
      },
      {
        "id": 2,
        "text": "Vitamin B9"
      },
      {
        "id": 3,
        "text": "Vitamin B12"
      },
      {
        "id": 4,
        "text": "Vitamin C"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Isoniazid interferes with the production of active co-enzyme pyridoxal phosphate from pyridoxine and increases the renal excretion of pyridoxine (vitamin B6).</p>\n<p>Pyridoxine deficiency leads to peripheral neuritis and other neurological manifestations like paresthesias, numbness and CNS effects.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Beta-lactamase inhibitor that does not cause suicidal inhibition of beta-lactamase is",
    "choices": [
      {
        "id": 1,
        "text": "Clavulanic acid"
      },
      {
        "id": 2,
        "text": "Avibactam"
      },
      {
        "id": 3,
        "text": "Tazobactam"
      },
      {
        "id": 4,
        "text": "Sulbactam"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Avibactam</strong> is a <strong>newer non-beta lactam beta-lactamase inhibitor</strong>. It is a non-suicidal inhibitor. Causes <strong>reversible acylation of beta-lactamase targets</strong>. Has a <strong>broader spectrum</strong> of action than suicidal inhibitors. <strong>Vaborbactam</strong> is another non-suicidal inhibitor.</p>\n<p>Suicidal inhibitors</p>\n<ul>\n<li>Clavulanic acid</li>\n<li>Tazobactam</li>\n<li>Sulbactam</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The following topical antifungal agent acts by chelating trivalent metal cations in fungal cell",
    "choices": [
      {
        "id": 1,
        "text": "Clotrimazole"
      },
      {
        "id": 2,
        "text": "Ciclopirox"
      },
      {
        "id": 3,
        "text": "Terbinafine"
      },
      {
        "id": 4,
        "text": "Butenafine"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Ciclopirox chelates trivalent metal cations and thereby inhibits metal dependent enzymes required for degradation of peroxides within fungal cell.</p>\n<p>Clotrimazole is a topical imidazole that interferes in ergosterol synthesis (option a).</p>\n<p>Terbinafine and butenafine are allylamines that interferes in ergosterol synthesis (options c and d).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not a BCR-ABL tyrosine kinase inhibitor ?",
    "choices": [
      {
        "id": 1,
        "text": "Ponatinib"
      },
      {
        "id": 2,
        "text": "Imatinib"
      },
      {
        "id": 3,
        "text": "Crizotinib"
      },
      {
        "id": 4,
        "text": "Dasatinib"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Crizotinib is a ALK (Anaplastic Lymphoma Kinase) tyrosine kinase inhibitor. It is indicated in ALK positive non-small cell lung cancer. BCR-ABL tyrosine kinase inhibitors</p>\n<ul>\n<li>Imatinib</li>\n<li>Nilotinib</li>\n<li>Dasatinib</li>\n<li>Ponatinib</li>\n<li>Bosutinib</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "All are adverse effects of thalidomide except",
    "choices": [
      {
        "id": 1,
        "text": "Hypothyroidism"
      },
      {
        "id": 2,
        "text": "Insomnia"
      },
      {
        "id": 3,
        "text": "Teratogenecity"
      },
      {
        "id": 4,
        "text": "Deep vein thrombosis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Constipation and sedation are common adverse effects of thalidomide. Teratogenicity like phocomelia is seen with thalidomide use in pregnancy that had lead to its withdrawal from market (option c).</p>\n<p>Thromboembolic events and hypothyroidism is associated with thalidomide use (options a and d).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "All are alkylating antineoplastic agents except:",
    "choices": [
      {
        "id": 1,
        "text": "Mechlorethamine"
      },
      {
        "id": 2,
        "text": "Capecitabine"
      },
      {
        "id": 3,
        "text": "Carmustine"
      },
      {
        "id": 4,
        "text": "Dacarbazine"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Capecitabine, </strong>the prodrug of 5-FU, is a <strong>pyrimidine antagonist</strong> and is an <strong>antimetabolite</strong>.</p>\n<p>\u00a0Alkylating agents are:</p>\n<p>1) Nitrogen mustards</p>\n<ul>\n<li>Cyclophosphamide</li>\n<li>Ifosfamide</li>\n<li>Mechlorethamine</li>\n<li>Melphalan</li>\n<li>Chlorambucil</li>\n</ul>\n<p>2) Nitrosoureas</p>\n<ul>\n<li>Carmustine</li>\n<li>Lomustine</li>\n<li>Semustine</li>\n<li>Streptozocin</li>\n</ul>\n<p>3) Triazines</p>\n<ul>\n<li>Dacarbazine</li>\n<li>Temozolomide</li>\n</ul>\n<p>4) Methylhydrazine</p>\n<ul>\n<li>Procarbazine</li>\n</ul>\n<p>5) Alkyl sulfonates</p>\n<ul>\n<li>Busulfan</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is false regarding vinblastine ?",
    "choices": [
      {
        "id": 1,
        "text": "It is an alkaloid"
      },
      {
        "id": 2,
        "text": "Severe neurotoxicity is commonly encountered"
      },
      {
        "id": 3,
        "text": "Component of standard regimen for Hodgkin lymphoma"
      },
      {
        "id": 4,
        "text": "It is a cell cycle specific agent"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Vinblastine is associated with mild neurotoxicity. Severe myelosuppression is a common issue with vinblastine. Vincristine is commonly associated with severe neurotoxicity.</p>\n<p>Vinblastine is the component of standard ABVD regimen in Hodgkin lymphoma (option b).</p>\n<p>Vinblastine belongs to vinca alkaloids class that is cell cycle specific agents (options a and d).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is contraindicated in amitriptyline overdose ?",
    "choices": [
      {
        "id": 1,
        "text": "Gastric lavage"
      },
      {
        "id": 2,
        "text": "Diazepam"
      },
      {
        "id": 3,
        "text": "Atropine"
      },
      {
        "id": 4,
        "text": "Sodium bicarbonate"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Tricyclic antidepressants like amitriptyline are competitive antagonists of muscarinic receptors. Atropine being an antimuscarinic drug should not be administered.</p>\n<p>Tricyclic antidepressants overdose:</p>\n<p>Presentation</p>\n<ul>\n<li>Anticholinergic effects</li>\n<li>Hypotension (alpha 1 receptor blockade)</li>\n<li>Cardiac depressant effects: quinidine like effects on Na+ channel resulting in slowed conduction and depressed cardiac contractility and result in serious arrhythmias</li>\n<li>Seizures and agitation followed by depression Management</li>\n<li>General supportive care that includes gastric lavage (option a)</li>\n<li>Hypotension is managed by IV fluids and norepinephrine infusion</li>\n<li>Cardiac depressant effects: bolus dose of sodium bicarbonate helps overcome Na+ blockade by increasing extracellular Na+. Sodium bicarbonate also addresses the metabolic acidosis which is commonly present (option b)</li>\n<li>Arrhythmias: lignocaine for ventricular dysrhythmias</li>\n<li>Seizures: benzodiazpeines like diazepam/lorazepam (option d)</li>\n</ul>\n<p>Clinical contraindication: Physostigmine can reverse anticholinergic effects but can aggravate cardiac depression and cause seizures. Therefore physostigmine is not indicated.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The dose-response curve is plotted for drug A both in the presence and absence of drug B.  What type of effect does drug B have on drug A?",
    "choices": [
      {
        "id": 1,
        "text": "Competitive antagonism"
      },
      {
        "id": 2,
        "text": "Noncompetitive antagonism"
      },
      {
        "id": 3,
        "text": "Agonism"
      },
      {
        "id": 4,
        "text": "Partial agonism"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Drug B has a <strong>competitive antagonistic</strong> effect on drug A.</p>\n<p>In <strong>competitive antagonism</strong>, DRC shows a <strong>parallel rightward shift</strong>. Competitive\u00a0antagonism occurs when the agonist and antagonist compete for the same binding site on the receptor. The response curve for the agonist shifts to the right in a concentration-related manner by the antagonist.</p>\n<p>In\u00a0<strong>non-competitive antagonism</strong>, there is<strong> flattening </strong>of the agonist DRC.<strong>\u00a0</strong>Non-competitive antagonism\u00a0effects occur when the agonist and antagonist bind to different sites on the receptor. ( allosteric site) and inhibits the response. The response curve\u00a0progressively shifts in a\u00a0<strong>right and downward direction </strong>until it reaches a limiting value when the allosteric site is fully occupied.</p>\n<p>In <strong>competitive agonism</strong>, the curve shifts to the <strong>left</strong>.</p>\n<p>In <strong>partial agonism</strong>, the\u00a0partial agonist which has an affinity for the same receptor, also competes with and\u00a0antagonizes a full agonist, while producing a submaximal response.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/0fbf15ad7b5548069875658a7e2cb57c.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Adenosine (P1) receptors on the cell surface are of the following type",
    "choices": [
      {
        "id": 1,
        "text": "Ligand-gated ion channels"
      },
      {
        "id": 2,
        "text": "G-protein coupled receptors"
      },
      {
        "id": 3,
        "text": "JAK-STAT binding receptors"
      },
      {
        "id": 4,
        "text": "Transmembrane enzyme linked receptors"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Purinergic receptors on cell surface</p>\n<p>Adenosine receptors</p>\n<ul>\n<li>P1: G-protein coupled receptors</li>\n</ul>\n<p>ATP receptors</p>\n<ul>\n<li>P2X: Ligand-gated ion channels</li>\n<li>P2Y: G-protein coupled receptors</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Apparent volume of distribution of a drug is very high (6L/kg). Which of the following is true regarding the distribution of that drug?",
    "choices": [
      {
        "id": 1,
        "text": "Highly bound to plasma proteins"
      },
      {
        "id": 2,
        "text": "Confined to vascular compartment"
      },
      {
        "id": 3,
        "text": "Sequestered in body tissues"
      },
      {
        "id": 4,
        "text": "Both A and B"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In the present case, the volume of distribution of the drug is 6L/kg (420 L in a normal adult with reference weight 70kg) which is very high when compared to the total body water of 42L. Therefore, it can be implied that the <strong>drug</strong> is having <strong>high sequestration in tissues</strong>.</p>\n<p>The apparent volume of distribution (<strong>V<sub>d</sub></strong>) is an <strong>imaginary volume</strong> throughout which the <strong>drug</strong> is <strong>distributed</strong> if the <strong>plasma concentration</strong> remains <strong>constant</strong>&nbsp;throughout.&nbsp;</p>\n<p><strong>V<sub>d</sub>&nbsp;= Dose administered IV/ plasma concentration</strong></p>\n<p>The difference in the volume of distribution based on drug type:</p>\n<ul>\n<li><strong>Low</strong>&nbsp;<strong>V<sub>d&nbsp;</sub></strong>\n<ul>\n<li>Restricted to the <strong>intravascular</strong> compartment&nbsp;</li>\n<li>Seen in drugs with high molecular weight (e.g., heparin) or <strong>high protein binding</strong> (e.g., warfarin - 9.8L)</li>\n</ul>\n</li>\n<li><strong>Medium</strong>&nbsp;<strong>V<sub>d&nbsp;</sub></strong>\n<ul>\n<li>Lipid insoluble drugs (e.g., gentamicin - 20L) do not enter the cells and are distributed in the extracellular fluid volume</li>\n<li>Small water-soluble molecules (e.g., ethanol - 42L) are distributed in the total body water</li>\n</ul>\n</li>\n<li><strong>High Vd</strong>\n<ul>\n<li>Sequestered and accumulated in the tissues</li>\n<li>Small lipophilic molecules (e.g., chloroquine - 13000L)&nbsp;&nbsp;</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = 'Pharmacology Test I';
        const quizFilename = 'pharmacology-test-i-09d3440d.html';
        let hierarchy = ["Marrow", "NEET PG Test Series Subject Wise", "Year 2018 - 19"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>