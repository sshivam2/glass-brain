<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>17 Cranial Nerves - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Anatomy
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">21</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following cranial nerves is a pure sensory nerve?",
    "choices": [
      {
        "id": 1,
        "text": "Olfactory"
      },
      {
        "id": 2,
        "text": "Trochlear"
      },
      {
        "id": 3,
        "text": "Trigeminal"
      },
      {
        "id": 4,
        "text": "Glossopharyngeal"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The <strong>olfactory</strong> nerve is a <strong>pure sensory nerve</strong>. It carries no motor fibers.</p>\n<table style=\"height: 219px;\" width=\"562\">\n<tbody>\n<tr>\n<td style=\"width: 180px; text-align: center;\"><strong>Pure sensory</strong></td>\n<td style=\"width: 180px; text-align: center;\"><strong>Pure motor</strong></td>\n<td style=\"width: 180px; text-align: center;\"><strong>Mixed-sensory and motor&nbsp;</strong></td>\n</tr>\n<tr>\n<td style=\"width: 180px; text-align: center;\">Olfactory (1)</td>\n<td style=\"width: 180px; text-align: center;\">Oculomotor (3)</td>\n<td style=\"width: 180px; text-align: center;\">Trigeminal (5)</td>\n</tr>\n<tr>\n<td style=\"width: 180px; text-align: center;\">Optic (2)</td>\n<td style=\"width: 180px; text-align: center;\">Trochlear&nbsp;(4)</td>\n<td style=\"width: 180px; text-align: center;\">Facial (7)</td>\n</tr>\n<tr>\n<td style=\"width: 180px; text-align: center;\">Vestibulocochlear (8)</td>\n<td style=\"width: 180px; text-align: center;\">Abducent (6)</td>\n<td style=\"width: 180px; text-align: center;\">Glossopharyngeal (9)</td>\n</tr>\n<tr>\n<td style=\"width: 180px; text-align: center;\">&nbsp;</td>\n<td style=\"width: 180px; text-align: center;\">Spinal Accessory (11)</td>\n<td style=\"width: 180px; text-align: center;\">Vagus (10)</td>\n</tr>\n<tr>\n<td style=\"width: 180px; text-align: center;\">&nbsp;</td>\n<td style=\"width: 180px; text-align: center;\">Hypoglossal (12)</td>\n<td style=\"width: 180px; text-align: center;\">&nbsp;</td>\n</tr>\n</tbody>\n</table>\n<p>Mnemonic: <strong>S</strong>ome <strong>S</strong>ay <strong>M</strong>oney&nbsp;<strong>M</strong>atters&nbsp;<strong>B</strong>ut <strong>M</strong>y <strong>B</strong>rother <strong>S</strong>ays <strong>B</strong>ig <strong>B</strong>rains&nbsp;<strong>M</strong>atter&nbsp;<strong>M</strong>ore.</p>\n<p><strong>S -&nbsp;</strong>Purely&nbsp;<strong>sensory&nbsp;</strong></p>\n<p><strong>M -&nbsp;</strong>Purely&nbsp;<strong>motor&nbsp;</strong></p>\n<p><strong>B -&nbsp;</strong><strong>Both&nbsp;</strong>sensory and motor</p>\n<p>The placement of the words in the mnemonic corresponds to the cranial nerve number i.e; \"<strong>S</strong>ome\" corresponds to the 1st cranial nerve (olfactory), \"<strong>S</strong>ay\" corresponds to the 2nd cranial nerve (optic), and so on.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following brainstem nuclei is not derived from the alar plate?",
    "choices": [
      {
        "id": 1,
        "text": "Inferior olivary nucleus"
      },
      {
        "id": 2,
        "text": "Hypoglossal nucleus"
      },
      {
        "id": 3,
        "text": "Dentate nucleus"
      },
      {
        "id": 4,
        "text": "Mesencephalic nucleus"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>hypoglossal nucleus</strong> is <strong>not derived</strong> from the <strong>alar plate.&nbsp;</strong><span class=\"TextRun SCX32195820\" lang=\"EN-IN\" xml:lang=\"EN-IN\"><span class=\"NormalTextRun SCX32195820\">The <strong>hypoglossal nucleus</strong>&nbsp;</span></span>is a <strong>motor nucleus</strong> derived from the <strong>basal plate.</strong></p>\n<p><span class=\"TextRun SCX32195820\" lang=\"EN-IN\" xml:lang=\"EN-IN\"><span class=\"NormalTextRun SCX32195820\">Embryologically, the continuous addition of neuroblasts to the mantle layer of the neural tube produces thickenings ventrally and dorsally - producing the basal and alar plates respectively.&nbsp;A longitudinal groove, called <strong>sulcus limitans</strong>, marks the boundary between the two.</span></span></p>\n<table style=\"height: 182px;\" width=\"584\">\n<tbody>\n<tr>\n<td style=\"width: 284px; text-align: center;\"><strong>Basal Plate&nbsp;</strong></td>\n<td style=\"width: 284px; text-align: center;\"><strong>Alar plate&nbsp;</strong></td>\n</tr>\n<tr>\n<td style=\"width: 284px;\"><span class=\"TextRun SCX32195820\" lang=\"EN-IN\" xml:lang=\"EN-IN\"><span class=\"NormalTextRun SCX32195820\"><strong>Ventral</strong>&nbsp;thickening</span></span></td>\n<td style=\"width: 284px;\"><span class=\"TextRun SCX32195820\" lang=\"EN-IN\" xml:lang=\"EN-IN\"><span class=\"NormalTextRun SCX32195820\"><strong>Dorsal</strong> thickenings</span></span></td>\n</tr>\n<tr>\n<td style=\"width: 284px;\"><span class=\"TextRun SCX32195820\" lang=\"EN-IN\" xml:lang=\"EN-IN\"><span class=\"NormalTextRun SCX32195820\">Give rise to <strong>motor nuclei- </strong>general visceral efferent nuclei, special visceral efferent of CN IX, X, and XII; and somatic efferent of XII</span></span></td>\n<td style=\"width: 284px;\"><span class=\"TextRun SCX32195820\" lang=\"EN-IN\" xml:lang=\"EN-IN\"><span class=\"NormalTextRun SCX32195820\">Give rise to <strong>sensory nuclei&nbsp;</strong>CN V, VII, VIII, IX, X, inferior olivary nucleus, and mesencephalic nucleus of CN V</span></span></td>\n</tr>\n<tr>\n<td style=\"width: 284px;\">Forms the motor part of the spinal cord (ventral horns)</td>\n<td style=\"width: 284px;\">\n<p>Forms the sensory part of the spinal cord (dorsal horns).&nbsp;</p>\n<p>The rhombic lip develops into the cerebellum and its nuclei.&nbsp;</p>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a84fa3444ff6486d94342b2eb51cb886x1280x2893.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/772fc086a48a4d04860a5901181b474ex1280x1158.JPEG"
    ]
  },
  {
    "text": "The arrangement of the functional columns of cranial nerve nuclei from ventral to dorsal aspect in the brainstem is as follows:",
    "choices": [
      {
        "id": 1,
        "text": "Visceral Efferent > Somatic Efferent >  Visceral Afferent  > Somatic Afferent"
      },
      {
        "id": 2,
        "text": "Somatic Efferent > Visceral Efferent > Visceral Afferent > Somatic Afferent"
      },
      {
        "id": 3,
        "text": "Somatic Afferent > Visceral Afferent > Visceral Efferent >\u00a0 Somatic Efferent"
      },
      {
        "id": 4,
        "text": "Visceral Efferent > Visceral Afferent > Somatic Afferent > Somatic Efferent"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p style=\"text-align: justify;\"><span class=\"TextRun SCX32195820\" lang=\"EN-IN\" xml:lang=\"EN-IN\"><span class=\"NormalTextRun SCX32195820\">The pattern of the arrangement of </span></span><span class=\"TextRun SCX32195820\" lang=\"EN-IN\" xml:lang=\"EN-IN\"><span class=\"NormalTextRun SCX32195820\">cranial nerve nuclei from the ventral to dorsal aspect is:</span></span></p>\n<p style=\"text-align: justify;\"><strong><span class=\"TextRun SCX32195820\" lang=\"EN-IN\" xml:lang=\"EN-IN\"><span class=\"NormalTextRun SCX32195820\">Somatic Efferent &gt; Visceral E</span></span><span class=\"TextRun SCX32195820\" lang=\"EN-IN\" xml:lang=\"EN-IN\"><span class=\"NormalTextRun SCX32195820\">fferent &gt; Visceral</span></span><span class=\"TextRun SCX32195820\" lang=\"EN-IN\" xml:lang=\"EN-IN\"><span class=\"NormalTextRun SCX32195820\"> A</span></span><span class=\"TextRun SCX32195820\" lang=\"EN-IN\" xml:lang=\"EN-IN\"><span class=\"NormalTextRun SCX32195820\">fferent &gt; Somatic Afferent</span></span></strong></p>\n<p><span class=\"TextRun SCX32195820\" lang=\"EN-IN\" xml:lang=\"EN-IN\"><span class=\"NormalTextRun SCX32195820\">The basal and alar cranial nerve nuclei of the brainstem are organized into <strong>7 columns</strong>.&nbsp;The sequence of the columns from <strong>ventral to dorsal</strong> is shown in the image below - <strong>3 motor columns</strong> in the ventral basal plate (green) and <strong>4 sensory columns</strong> in the dorsal alar plate (blue). The v</span></span>isceral nuclei are closer to the sulcus limitans than the somatic nuclei.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9526c8b326054ce28a1f27d83f1c8186x1280x2893.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/87e33528b0a546aeb36566ab6b6a7a2ex1280x1158.JPEG"
    ]
  },
  {
    "text": "Which of the following cranial nerves does not contain neurons from the general somatic efferent column?",
    "choices": [
      {
        "id": 1,
        "text": "III nerve"
      },
      {
        "id": 2,
        "text": "IV nerve"
      },
      {
        "id": 3,
        "text": "VI nerve"
      },
      {
        "id": 4,
        "text": "VII nerve"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The<strong> facial (VII) nerve</strong> contains neurons from:\u00a0</p>\n<ul>\n<li><strong>Special visceral efferent</strong>\u00a0(SVE) column - supplies\u00a0<strong>facial muscles</strong>\u00a0derived from the second pharyngeal arch.</li>\n<li><strong>General visceral efferent</strong>\u00a0(GVE) column - from the <strong>superior salivatory nucleus</strong>, is parasympathetic to the <strong>lacrimal</strong> gland,<strong> s</strong><strong>ubmandibular</strong> and<strong> sublingual</strong> salivary glands.\u00a0</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b38d0221314e44b6b51cb284ae9fdaf4x1280x1156.JPEG"
    ]
  },
  {
    "text": "Which of the following is not included in the special visceral efferent?",
    "choices": [
      {
        "id": 1,
        "text": "Motor nucleus of V nerve"
      },
      {
        "id": 2,
        "text": "Motor nucleus of VII nerve"
      },
      {
        "id": 3,
        "text": "Dorsal nucleus of X nerve"
      },
      {
        "id": 4,
        "text": "Nucleus ambiguus"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The <strong>dorsal nucleus of vagus</strong> contains neurons from the <strong>general visceral efferent column</strong> and it sends <strong>parasympathetic fibers</strong> to the glands and smooth muscles in the pharynx, larynx, thoracic and abdominal viscera.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/45dcb4faa0f64c1f939a12ae08c2ebe6x1280x1159.JPEG"
    ]
  },
  {
    "text": "Which of the following nuclei do not belong to the general visceral efferent column?",
    "choices": [
      {
        "id": 1,
        "text": "Dorsal nucleus of vagus"
      },
      {
        "id": 2,
        "text": "Edinger-Westphal nucleus"
      },
      {
        "id": 3,
        "text": "Nucleus ambiguus"
      },
      {
        "id": 4,
        "text": "Inferior salivatory nucleus"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Nucleus ambiguus</strong> belongs to the <strong>special visceral efferent</strong> (SVE)<strong> column</strong>.</p>\n<p>The special visceral efferent column contains neurons innervating <strong>muscles developed from the pharyngeal arches</strong>:</p>\n<ul>\n<li><strong>Motor nucleus of V nerve-&nbsp;</strong>muscles of mastication</li>\n<li><strong>Motor nucleus of VII nerve-&nbsp;</strong>muscles of facial expression</li>\n<li><strong>Nucleus ambiguus</strong>&nbsp;(<strong>IX, X, XI</strong>)- stylopharyngeus, pharyngeal, external laryngeal, oesophageal striated muscles,&nbsp;muscles of the soft palate, sternocleidomastoid, and trapezius.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/254534ef9e834e29b59c4a0cb343147ex1280x1158.JPEG"
    ]
  },
  {
    "text": "Which cranial nerve nuclei are present in both the general somatic efferent and general visceral efferent column?",
    "choices": [
      {
        "id": 1,
        "text": "Oculomotor nerve"
      },
      {
        "id": 2,
        "text": "Trochlear nerve"
      },
      {
        "id": 3,
        "text": "Facial nerve"
      },
      {
        "id": 4,
        "text": "Glossopharyngeal nerve"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Oculomotor nerve</strong> nuclei are present in both <strong>general somatic efferent</strong> (GSE) and <strong>general visceral efferent</strong> (GVE) columns in the brainstem.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following cranial nerve nuclei is not a part of the special visceral afferent (SVA) column?",
    "choices": [
      {
        "id": 1,
        "text": "Facial nerve"
      },
      {
        "id": 2,
        "text": "Trochlear nerve"
      },
      {
        "id": 3,
        "text": "Vagus nerve"
      },
      {
        "id": 4,
        "text": "Glossopharyngeal nerve"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>trochlear nerve nucleus</strong> is a part of the general somatic efferent<strong> (GSE)</strong> column, not the special visceral afferent column.</p>\n<p>The <strong>trochlear </strong>nerve is a<strong>&nbsp;motor nerve</strong> that innervates&nbsp;<strong>superior oblique</strong> muscle in the orbit.</p>\n<p>The neurons of the general somatic efferent<strong> (GSE)</strong> column innervate the extrinsic ocular muscles and muscles of the tongue<strong>&nbsp;</strong>(<strong>III, IV, VI, and XII</strong> cranial nerves).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3e4dcf4b9d124095be6b7ff1886acda8x1280x1232.JPEG"
    ]
  },
  {
    "text": "Which of the following nerves is not involved in olfaction?",
    "choices": [
      {
        "id": 1,
        "text": "Trigeminal nerve"
      },
      {
        "id": 2,
        "text": "Vagus nerve"
      },
      {
        "id": 3,
        "text": "Glossopharyngeal nerve"
      },
      {
        "id": 4,
        "text": "Hypoglossal nerve"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The <strong>hypoglossal</strong> nerve is <strong>purely motor</strong> cranial nerve and is not involved in olfaction.</p>\n<p>The other three cranial nerves&mdash;trigeminal, glossopharyngeal, and vagus nerves are mixed cranial nerves and contribute to olfaction.</p>\n<p>Vagal nerve stimulation modifies the electrical activity of the olfactory bulb.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 72-year-old patient who suffered a stroke is unable to swallow food.  On examination, the gag reflex is absent. The motor nucleus of the vagus nerve involved here emerges from _______ of the brainstem.",
    "choices": [
      {
        "id": 1,
        "text": "Postero-lateral sulcus"
      },
      {
        "id": 2,
        "text": "Anterolateral sulcus"
      },
      {
        "id": 3,
        "text": "Body of pons"
      },
      {
        "id": 4,
        "text": "At the ponto-medullary junction"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The fibers from the <strong>nucleus ambiguus</strong> emerge through the <strong>postero-lateral sulcus&nbsp;</strong>of the brainstem.&nbsp;&nbsp;</p>\n<p><strong>Nucleus ambiguus</strong>&nbsp;is made of cranial nerves<strong> IX, X, and XI</strong>.&nbsp;</p>\n<p>The following table describes the components of the vagal nerve and the associated nuclei.&nbsp;</p>\n<table style=\"height: 240px;\" width=\"511\">\n<tbody>\n<tr>\n<td style=\"width: 163px; text-align: center;\"><strong>Component&nbsp;</strong></td>\n<td style=\"width: 163px; text-align: center;\"><strong>Associated Nucleus</strong></td>\n<td style=\"width: 163px; text-align: center;\"><strong>Innervated Structures&nbsp;</strong></td>\n</tr>\n<tr>\n<td style=\"width: 163px; text-align: left;\">Parasympathetic&nbsp;</td>\n<td style=\"width: 163px; text-align: left;\">Dorsal vagal nucleus&nbsp;</td>\n<td style=\"width: 163px;\">Autonomic ganglia of thorax and abdomen&nbsp;</td>\n</tr>\n<tr>\n<td style=\"width: 163px; text-align: left;\">Motor</td>\n<td style=\"width: 163px; text-align: left;\">Nucleus ambiguus</td>\n<td style=\"width: 163px;\">Pharynx, larynx, palate</td>\n</tr>\n<tr>\n<td style=\"width: 163px; text-align: left;\">Viscero-sensory</td>\n<td style=\"width: 163px; text-align: left;\">Nucleus tractus solitarius&nbsp;</td>\n<td style=\"width: 163px;\">Pharynx, larynx, esophagus, thoracic and abdominal viscera&nbsp;</td>\n</tr>\n<tr>\n<td style=\"width: 163px; text-align: left;\">Chemosensory</td>\n<td style=\"width: 163px; text-align: left;\">Nucleus tractus solitarius&nbsp;</td>\n<td style=\"width: 163px;\">Taste buds on epiglottis&nbsp;</td>\n</tr>\n<tr>\n<td style=\"width: 163px; text-align: left;\">Somatosensory</td>\n<td style=\"width: 163px; text-align: left;\">Spinal nucleus of trigeminal</td>\n<td style=\"width: 163px;\">Outer ear canal, pinna, dura&nbsp;</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 69-year-old male presented with diplopia. Investigations revealed an aneurysm of the right anterior inferior cerebellar artery that is directly impinging on the nerve arising at the pontomedullary junction. Which of the following extraocular muscles is likely to be paralyzed?",
    "choices": [
      {
        "id": 1,
        "text": "Superior oblique"
      },
      {
        "id": 2,
        "text": "Inferior oblique"
      },
      {
        "id": 3,
        "text": "Medial rectus"
      },
      {
        "id": 4,
        "text": "Lateral rectus"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The <strong>lateral rectus</strong> muscle is likely to be paralyzed as it is innervated by the&nbsp;<strong>VI cranial nerve,</strong> which&nbsp;<strong>emerges</strong> from the <strong>pontomedullary junction</strong> (PMJ).<strong>&nbsp;</strong></p>\n<p>Cranial nerves VI, VII, and VIII arise at the PMJ.</p>\n<p>Extraocular muscles are innervated by the&nbsp;III, IV, and VI cranial nerves. The <strong>superior&nbsp;oblique</strong> is innervated by<strong>&nbsp;</strong>CN<strong> IV</strong>, the <strong>lateral rectus</strong> by CN&nbsp;<strong>VI</strong>,&nbsp;and all the <strong>other</strong> muscles by CN&nbsp;<strong>III</strong>.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 34-year-old presents to the casualty with a history of blunt force trauma to the head. A small lesion was found on the dorsal aspect of the brainstem on imaging. Which of the following nerves could be injured at the site?",
    "choices": [
      {
        "id": 1,
        "text": "Hypoglossal nerve"
      },
      {
        "id": 2,
        "text": "Trigeminal nerve"
      },
      {
        "id": 3,
        "text": "Trochlear nerve"
      },
      {
        "id": 4,
        "text": "Facial nerve"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The <strong>trochlear nerve</strong> is the only nerve that exits the<strong> brainstem</strong> on the<strong> dorsal</strong>&nbsp;surface<strong>&nbsp;</strong>and thus can be injured in this patient.&nbsp;</p>\n<p>All other cranial nerves exit the brainstem from the ventral surface.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following nerves exits anterior to the marked structure?",
    "choices": [
      {
        "id": 1,
        "text": "Glossopharyngeal"
      },
      {
        "id": 2,
        "text": "Vagus"
      },
      {
        "id": 3,
        "text": "Acessory nerve"
      },
      {
        "id": 4,
        "text": "Hypoglossal nerve"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The structure marked is the <strong>olive.</strong>&nbsp;The<strong> hypoglossal nerve </strong>emerges&nbsp;anterior to the olive, from the groove between the pyramid and the olive&mdash;<strong>anterolateral sulcus.</strong></p>\n<p>The olivary bodies are rounded, oval prominences on the <strong>surface</strong> of the <strong>medulla oblongata</strong> in the&nbsp;brain. Nerve fibers in the <strong>olivopontocerebellar</strong> pathway connect the&nbsp;<strong>olives</strong>&nbsp;to the <strong>pons</strong> and <strong>cerebellum.</strong>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a48240eda6724dbf838d00e3a7431578.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e53a8a4a094f49ed924f498f3ee9d12ex1280x1223.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4c08a37d18db48468e9156b0055696a6x250x250.GIF"
    ]
  },
  {
    "text": "Which is the thickest cranial nerve?",
    "choices": [
      {
        "id": 1,
        "text": "Trigeminal"
      },
      {
        "id": 2,
        "text": "Facial"
      },
      {
        "id": 3,
        "text": "Trochlear"
      },
      {
        "id": 4,
        "text": "Vagus"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The <strong>trigeminal </strong>nerve is the <strong>thickest cranial nerve.</strong></p>\n<p>The <strong>trochlear</strong> nerve is the <strong>most slender</strong>&nbsp;cranial nerve.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following cranial nerves does not carry parasympathetic fibers?",
    "choices": [
      {
        "id": 1,
        "text": "Trochlear"
      },
      {
        "id": 2,
        "text": "Facial"
      },
      {
        "id": 3,
        "text": "Oculomotor"
      },
      {
        "id": 4,
        "text": "Glossopharyngeal"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The <strong>trochlear</strong> nerve does <strong>not</strong> carry <strong>parasympathetic</strong> fibers.&nbsp;</p>\n<p>The cranial nerves carrying parasympathetic fibers are listed below:</p>\n<table style=\"height: 238px; width: 418px;\">\n<tbody>\n<tr>\n<td style=\"width: 145px; text-align: center;\"><strong>Cranial nerve</strong></td>\n<td style=\"width: 257px; text-align: center;\"><strong>Associated Ganglion</strong></td>\n</tr>\n<tr>\n<td style=\"width: 145px; text-align: left;\">Oculomotor <strong>(III)</strong></td>\n<td style=\"width: 257px; text-align: left;\">Ciliary ganglion</td>\n</tr>\n<tr>\n<td style=\"width: 145px; text-align: left;\">Facial <strong>(VII)</strong></td>\n<td style=\"width: 257px; text-align: left;\">Pterygopalatine and submandibular ganglion</td>\n</tr>\n<tr>\n<td style=\"width: 145px; text-align: left;\">Glossopharyngeal <strong>(IX)</strong></td>\n<td style=\"width: 257px; text-align: left;\">Otic ganglion</td>\n</tr>\n<tr>\n<td style=\"width: 145px; text-align: left;\">Vagus <strong>(X)</strong></td>\n<td style=\"width: 257px; text-align: left;\">Visceral ganglions</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following sensations is not perceived by the spinal nucleus of the trigeminal nerve?",
    "choices": [
      {
        "id": 1,
        "text": "Temperature"
      },
      {
        "id": 2,
        "text": "Pain"
      },
      {
        "id": 3,
        "text": "Touch"
      },
      {
        "id": 4,
        "text": "Proprioception"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Proprioception&nbsp;</strong>is perceived by the <strong>mesencephalic nucleus</strong> of the trigeminal nerve, not the spinal nucleus.</p>\n<p>The <strong>trigeminal nerve</strong> consists of <strong>4 nuclei</strong>: 3 sensory (Mesencephalic, spinal, and principal sensory nucleus) and 1 motor.&nbsp;</p>\n<table style=\"height: 113px;\" width=\"518\">\n<tbody>\n<tr>\n<td style=\"width: 165.333px; text-align: center;\"><strong>Nucleus</strong></td>\n<td style=\"width: 165.333px; text-align: center;\"><strong>Location</strong></td>\n<td style=\"width: 165.333px; text-align: center;\"><strong>Function</strong></td>\n</tr>\n<tr>\n<td style=\"width: 165.333px;\"><strong>Mesencephalic Nucleus</strong></td>\n<td style=\"width: 165.333px;\">Composed of a column of <strong>unipolar nerve</strong> cells situated in the midbrain and extends inferiorly into the pons as far as the main sensory nucleus</td>\n<td style=\"width: 165.333px;\">Receives the sensation of <strong>proprioception</strong> from the muscles of mastication and from the facial and extraocular muscles</td>\n</tr>\n<tr>\n<td style=\"width: 165.333px;\"><strong>Principal sensory nucleus</strong></td>\n<td style=\"width: 165.333px;\">Posterior part of the pons lateral to the motor nucleus</td>\n<td style=\"width: 165.333px;\">\n<p>Receives the sensations of <strong>touch and pressure</strong> from the face</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 165.333px;\"><strong>Spinal nucleus</strong></td>\n<td style=\"width: 165.333px;\">Continuous superiorly with the main sensory nucleus and extends inferiorly the whole of the medulla oblongata <strong>till the 2<sup>nd</sup> Cervical Segment</strong></td>\n<td style=\"width: 165.333px;\">Receives the sensation of <strong>pain and temperature</strong> from the face and some fibers of <strong>touch</strong></td>\n</tr>\n<tr>\n<td style=\"width: 165.333px;\"><strong>Motor nucleus</strong></td>\n<td style=\"width: 165.333px;\">The pons medial to the main sensory nucleus</td>\n<td style=\"width: 165.333px;\">Supplies the muscles of mastication, the tensor tympani, the tensor veli palitini and the mylohyoid and the anterior belly of digastric muscle</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5a100978d0bc48c5baab7edfc7cb67ebx600x797.JPEG"
    ]
  },
  {
    "text": "A patient with trigeminal neuralgia presents with a flare-up of the condition. The nucleus receiving the sensory afferent extends from the chief sensory nucleus in the pons up to the  _______.",
    "choices": [
      {
        "id": 1,
        "text": "Lower end of medulla"
      },
      {
        "id": 2,
        "text": "2nd cervical spinal segment"
      },
      {
        "id": 3,
        "text": "5th cervical spinal segment"
      },
      {
        "id": 4,
        "text": "Upper end of medulla"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Excruciating <strong>pain</strong> is the principal symptom of <strong>trigeminal neuralgia. </strong>The&nbsp;afferent fibers carrying pain and temperature from the face relay in the <strong>spinal nucleus</strong> of the trigeminal nerve.&nbsp;It extends from the <strong>chief sensory nucleus</strong> in the <strong>upper</strong> part of the<strong> pons</strong>&nbsp;through the&nbsp;<strong>medulla</strong> and into the<strong> upper 2 segments</strong> of the<strong> spinal cord.</strong></p>\n<p>The <strong>trigeminal nerve</strong> consists of <strong>4 nuclei</strong>: 3 sensory (mesencephalic, spinal, and principal sensory nucleus) and 1 motor.</p>\n<table style=\"height: 408px; width: 603px;\">\n<tbody>\n<tr>\n<td style=\"width: 124px; text-align: center;\"><strong>Nucleus</strong></td>\n<td style=\"width: 230px; text-align: center;\"><strong>Location</strong></td>\n<td style=\"width: 227px; text-align: center;\"><strong>Function</strong></td>\n</tr>\n<tr>\n<td style=\"width: 124px; text-align: center;\"><strong>Mesencephalic nucleus</strong></td>\n<td style=\"width: 230px;\">Composed of a column of <strong>unipolar nerve</strong> cells situated in the midbrain and extends inferiorly into the pons as far as the main sensory nucleus</td>\n<td style=\"width: 227px;\">Receives the sensation of <strong>proprioception</strong> from the muscles of mastication and from the facial and extraocular muscles</td>\n</tr>\n<tr>\n<td style=\"width: 124px; text-align: center;\"><strong>Principal sensory nucleus</strong></td>\n<td style=\"width: 230px;\">Posterior part of the pons lateral to the motor nucleus</td>\n<td style=\"width: 227px;\">\n<p>Receives the sensations of <strong>touch and pressure</strong> from the face</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 124px; text-align: center;\"><strong>Spinal nucleus</strong></td>\n<td style=\"width: 230px;\">Continuous superiorly with the main sensory nucleus and extends inferiorly the whole of the medulla oblongata <strong>till the 2<sup>nd</sup>&nbsp;cervical segment</strong></td>\n<td style=\"width: 227px;\">Receives the sensation of <strong>pain and temperature</strong> from the face and some fibers of <strong>touch</strong></td>\n</tr>\n<tr>\n<td style=\"width: 124px; text-align: center;\"><strong>Motor nucleus</strong></td>\n<td style=\"width: 230px;\">The pons medial to the main sensory nucleus</td>\n<td style=\"width: 227px;\">Supplies the muscles of mastication, tensor tympani, tensor veli palitini, mylohyoid, and anterior belly of digastric muscle</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/091deed963444a4bad48101422f201d2x600x797.JPEG"
    ]
  },
  {
    "text": "Which of the following statements regarding the nerve involved in the palsy shown below is false?",
    "choices": [
      {
        "id": 1,
        "text": "It divides into upper and lower divisions in the anterior part of the cavernous sinus."
      },
      {
        "id": 2,
        "text": "Its divisions enter the orbit through the middle part of the superior orbital fissure."
      },
      {
        "id": 3,
        "text": "It lies between the posterior cerebral and superior cerebellar arteries in the interpeduncular fossa."
      },
      {
        "id": 4,
        "text": "The nerve to inferior rectus carries parasympathetic fibers to the ciliary ganglion."
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Course of the oculomotor nerve:</p>\n<ul>\n<li>The nerve lies on the <strong>anterior</strong> surface of the <strong>midbrain</strong> in between the posterior cerebral artery and the superior cerebellar artery in the <strong>interpeduncular fossa. </strong></li>\n<li>It then passes to the middle cranial fossa along the <strong>lateral dural wall</strong> of the <strong>cavernous sinus</strong> and divides into superior and inferior in its anterior part.</li>\n<li>It enters the\u00a0<strong>superior orbital fissure</strong> through the <strong>common tendinous ring.</strong>\u00a0</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d20209313e294d3dbcd6dff594167e5e.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ebedf245e4bb4515b8044c6d445c2d4fx1280x1548.JPEG"
    ]
  },
  {
    "text": "A 36-year-old male was brought to the emergency department after suffering a head injury in a road traffic accident. CT revealed a skull base fracture. The fracture line extended along the apex of the petrous bone involving the Dorello's canal. Which of the following cranial nerves is susceptible to injury?",
    "choices": [
      {
        "id": 1,
        "text": "Vestibulocochlear nerve"
      },
      {
        "id": 2,
        "text": "Abducens nerve"
      },
      {
        "id": 3,
        "text": "Glossopharyngeal nerve"
      },
      {
        "id": 4,
        "text": "Trochlear nerve"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>abducens nerve</strong> forms the <strong>content</strong> of&nbsp;<strong>Dorello's canal&nbsp;</strong>and hence is susceptible to injury in this case.</p>\n<p>Dorello's canal is located<strong>&nbsp;</strong>at the <strong>petrous apex</strong> of the temporal bone and is formed by the petrosphenoidal/petroclinoid/<strong>Gruber's ligament.&nbsp;</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/538cabf3eff742f281778a094b319e9bx600x545.JPEG"
    ]
  },
  {
    "text": "Which of the following is not used for the identification of the facial nerve trunk?",
    "choices": [
      {
        "id": 1,
        "text": "Retrograde dissection from distal branch"
      },
      {
        "id": 2,
        "text": "Tragal pointer"
      },
      {
        "id": 3,
        "text": "Inferior belly of omohyoid muscle"
      },
      {
        "id": 4,
        "text": "Posterior belly of digastric"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The inferior belly of the omohyoid muscle is not used as an anatomical landmark for the identification of the facial nerve trunk.</p>\n<p>There are two methods for <strong>localization</strong> of the<strong> facial</strong> nerve<strong> trunk:&nbsp;</strong></p>\n<p><strong>1. Anterograde</strong> method:<strong>&nbsp;</strong>The facial nerve trunk is identified based on the anatomical landmarks after it exits from the stylomastoid foramen. This includes:</p>\n<ul>\n<li><strong>Tragal pointer/Conley's pointer -&nbsp;</strong>It is the inferior portion of the cartilaginous canal. The facial nerve trunk lies 1 cm deep and inferior to its tip.</li>\n<li><strong>Posterior belly of digastric -</strong>&nbsp;The facial nerve lies superior to the upper border of the muscle.</li>\n<li><strong>Squamotympanic fissure -&nbsp;</strong>It is a fissure in the temporal bone, which runs from TMJ to the tympanic cavity. The facial nerve runs through this fissure.</li>\n<li><strong>Styloid process -</strong>&nbsp;The facial nerve lies superficial to it.</li>\n<li><strong>Mastoid process -&nbsp;</strong>Upon drilling it, the nerve is identified proximally.</li>\n</ul>\n<p><strong>2. Retrograde</strong> method:<strong>&nbsp;</strong>The main branches of the facial nerve trunk are identified and are then traced proximally until the main tunk is identified. Some branches used for tracing the facial nerve trunk include:</p>\n<ul>\n<li><strong>Buccal branch -</strong>&nbsp;It lies in relation to the parotid gland.</li>\n<li><strong>Marginal mandibular branch -</strong>&nbsp;It lies in relation to the facial vessels.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/783b36b3a98e4dcbae0580e393789a1bx1280x4078.JPEG"
    ]
  },
  {
    "text": "All of the following nerves are involved in the movement of the eyeball except:",
    "choices": [
      {
        "id": 1,
        "text": "A"
      },
      {
        "id": 2,
        "text": "B"
      },
      {
        "id": 3,
        "text": "C"
      },
      {
        "id": 4,
        "text": "D"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Extraocular muscles involved in the movement of the eyeball:</p>\n<ul>\n<li>Superior rectus, inferior rectus, medial rectus, inferior oblique, and levator palpebrae superioris muscles - supplied by the&nbsp;<strong>oculomotor (III)</strong> nerve.</li>\n<li><strong>Lateral rectus</strong>&nbsp;- supplied by abducens<strong>&nbsp;(VI) nerve.&nbsp;</strong></li>\n<li><strong>Superior oblique</strong>&nbsp;- supplied by trochlear<strong>&nbsp;(IV) nerve.</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ea0200827e9c4e618a3ba5150e69237b.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4f088d168c784c968d1ca284bf6ccbf8x1280x1687.JPEG"
    ]
  }
];
        let quizName = '17 Cranial Nerves';
        let hierarchy = ["Marrow", "qBank", "Anatomy"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>