<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>227 Surgery Aiims 2018 - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / PYQs / Surgery
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "All are true about intestinal transplantation except ______.",
    "choices": [
      {
        "id": 1,
        "text": "Most of the grafts are multi-visceral grafts."
      },
      {
        "id": 2,
        "text": "It is not widely used due to vigorous rejection reactions."
      },
      {
        "id": 3,
        "text": "The most dangerous complication is sepsis."
      },
      {
        "id": 4,
        "text": "The most common indication is the ischemia"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Multivisceral grafts are rarely used </strong>in intestinal transplantation.<strong>&nbsp;</strong>The <strong>most common intestinal graft</strong> is <strong>small bowel graft,</strong>&nbsp;with or without the colon or a combined liver and small bowel graft. <strong><br /></strong></p>\n<p>All the other statements are correct.</p>\n<p>Small bowel transplantation is the final treatment option after the outcome of reconstruction and lengthening procedures are unsatisfactory.</p>\n<p>The small bowel transplant is <strong>highly immunogenic</strong>&nbsp;since it contains a large amount of gut-associated lymphoid tissue, donor dendritic cells, and macrophages.&nbsp;Acute rejection has been reported in 56&ndash;75% of patients, with small bowel transplant limiting the overall survival to only one-third of recipients.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "All of the following are boundaries of the triangle of doom except?",
    "choices": [
      {
        "id": 1,
        "text": "Vas deferens"
      },
      {
        "id": 2,
        "text": "Peritoneal Reflection"
      },
      {
        "id": 3,
        "text": "Iliopubic tract"
      },
      {
        "id": 4,
        "text": "Spermatic vessels"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Iliopubic tract</strong> does not form a boundary of the triangle of doom.</p>\n<p><strong>The triangle of doom</strong> is bounded</p>\n<ul>\n<li>Medially by the vas deferens</li>\n<li>Laterally by the vessels of the spermatic cord</li>\n<li>Inferiorly by peritoneal reflection</li>\n</ul>\n<p><strong>Apex </strong>oriented superiorly at <strong>the internal ring</strong></p>\n<p><strong>The contents</strong> of the space include</p>\n<ul>\n<li>External iliac vessels</li>\n<li>Deep circumflex iliac vein</li>\n<li>Femoral nerve</li>\n<li>Genital branch of the genitofemoral nerve</li>\n</ul>\n<p><strong>Note: </strong>Staples are avoided in this region during hernia repair due to the risk of injury to the vessels which might result in severe hemorrhage.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/134adada78714901afd87670df87671fx460x325.PNG"
    ]
  },
  {
    "text": "All of the following are true about superior mesenteric artery syndrome except?",
    "choices": [
      {
        "id": 1,
        "text": "Third part of duodenum is compressed"
      },
      {
        "id": 2,
        "text": "Angle between SMA and aorta is more than 70 degrees"
      },
      {
        "id": 3,
        "text": "Surgical management is by dudenojejunostomy"
      },
      {
        "id": 4,
        "text": "Also known as  Wilkie\u2019s Syndrome"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Lifestyle therapy includes frequent small feedings and patients may benefit from lying prone or on their left side postprandially.</p>\n<p>In some cases, weight gain or removal of a body cast improves symptoms. Laparoscopic lysis of the ligament of Treitz is beneficial in few cases. The preferred surgical treatment is <strong>Strong's procedure </strong>involving<strong> duodenojejunostomy </strong>(option C).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1e5d7c6334cc4f21a76a9ffccfa49d16x986x1032.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f004d43fcdd749e4828c0a83dadc5383x600x1200.PNG"
    ]
  },
  {
    "text": "Which of the following type of renal calculi is resistant to the extracorporeal shockwave lithotripsy?",
    "choices": [
      {
        "id": 1,
        "text": "Struvite"
      },
      {
        "id": 2,
        "text": "Cystine"
      },
      {
        "id": 3,
        "text": "Calcium oxalate"
      },
      {
        "id": 4,
        "text": "Uric acid"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Cystine stones</strong> are <strong>resistant to extracorporeal shockwave lithotripsy<em> (</em>ESWL)&nbsp;</strong>due to their hardness.&nbsp;<strong>Cystine</strong>, <strong>brushite</strong>,&nbsp;and <strong>calcium</strong> <strong>oxalate</strong> <strong>monohydrate</strong> stones are the most refractory to ESWL fragmentation, with cystine and brushite being the most resistant.</p>\n<p>ESWL is a non-invasive method that generates shockwaves outside the body that focus on the stones. It is the most common method of treating urinary tract stones nowadays. Stones <strong>up to</strong> approximately <strong>1.5 cm</strong> in size <strong>are suitable</strong> for this form of treatment.</p>\n<p><strong>Complications</strong>: Infection, haematuria, parenchymal hemorrhage, and perirenal hematoma.&nbsp;</p>\n<p><strong>Contraindications</strong>:&nbsp;Obese patients, pregnant patients, and patients taking oral anticoagulants.</p>\n<p>Note: Stone fragments collecting in the distal ureter following ESWL are known as <strong>steinstrasse.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An abdominal aortic aneurysm is operated when its size is greater than __________",
    "choices": [
      {
        "id": 1,
        "text": "5 cm"
      },
      {
        "id": 2,
        "text": "6 cm"
      },
      {
        "id": 3,
        "text": "5.5 cm"
      },
      {
        "id": 4,
        "text": "6.5 cm"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>An asymptomatic abdominal aortic aneurysm in an otherwise fit patient should be considered for repair if <strong>&gt;5.5 cm </strong>&nbsp;in diameter (measured by ultrasonography). The annual incidence of rupture rises from <strong>1%</strong> or less in aneurysms that are <strong>&lt;5.5 cm</strong> in diameter to a significant level of nearly <strong>25%</strong>, in those that are <strong>7 cm&nbsp; </strong>in diameter.</p>\n<p>As open elective surgery (transabdominal) carries a 5% mortality rate, the balance is in favor of elective operation once the maximum diameter is &gt;5.5 cm.</p>\n<p><strong>6 monthly follow-up ultrasonographic assessment</strong> is indicated for asymptomatic aneurysms &lt;5.5cm in diameter.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 3-day-old neonate presented with recurrent bilious vomiting. An X-ray erect abdomen is given below. What is the next best step in managing this condition?",
    "choices": [
      {
        "id": 1,
        "text": "CT abdomen"
      },
      {
        "id": 2,
        "text": "Gastrograffin follow-through"
      },
      {
        "id": 3,
        "text": "USG abdomen"
      },
      {
        "id": 4,
        "text": "Explorative laparotomy"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Explanation:&nbsp;</p>\n<p>The given clinical history with an x-ray showing a triple bubble sign is suggestive of jejunal atresia. The next best step is to perform a contrast study to localize the site of obstruction.</p>\n<p>Small bowel atresias present with intestinal obstruction soon after birth.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Bilious vomiting is the dominant feature in jejunal atresia&nbsp;</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Abdominal distension is more prominent in ileal atresia</li>\n</ul>\n<p>A small amount of pale meconium may be passed, despite the atresia.</p>\n<p>Plain abdomen radiographs in a jejunal/ileal atresia case will show <strong>multiple air-fluid levels</strong> and dilated loops. They <strong>don't reliably distinguish</strong> small and large bowels in neonates and hence contrast studies are often required to localize the obstruction.</p>\n<p>Water-soluble enemas (<strong>Gastrogaffin</strong>, <strong>Hypaque</strong>) are particularly useful in <strong>differentiating atresia from meconium ileus and Hirschsprung disease</strong>. Contrast studies also help to rule out distal intestinal obstruction and occasionally may act therapeutically to relieve obstructions.</p>\n<p>In most cases of jejunal/ileal atresia, the distal end of the <strong>dilated proximal small bowel</strong> is <strong>resected</strong> and a <strong>primary end-to-end anastomosis</strong> is done. If the proximal bowel is extremely dilated, it may need to be tapered to the distal bowel before anastomosis.</p>\n<p>Other options:&nbsp;</p>\n<p>Option A:&nbsp; CT is not recommended for neonates owing to the harmful effects of <strong>radiation</strong>.</p>\n<p>Option C: USG abdomen does not help to localize the site of obstruction and is more useful in the diagnosis of intussusception, where there is an abdominal mass.</p>\n<p>Option D: Explorative laparotomy is not done for diagnosing intestinal atresias.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/5810dfed2d4d456e80a34ce13f1ca2df.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "The image shows methylene blue dye being injected in the peritumoral region. What is this procedure useful for?",
    "choices": [
      {
        "id": 1,
        "text": "Localizing the tumor"
      },
      {
        "id": 2,
        "text": "Identifying the margins"
      },
      {
        "id": 3,
        "text": "Sentinel lymph node biopsy"
      },
      {
        "id": 4,
        "text": "Identifying metastasis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><span style=\"font-family: verdana, geneva, sans-serif; font-size: 10pt;\">The utility of injection of methylene blue in the region around the tumor is done for <strong>sentinel&nbsp;lymph node biopsy</strong> (SLN) in patients without clinically positive lymph nodes.</span></p>\n<p><span style=\"font-family: verdana, geneva, sans-serif; font-size: 10pt;\">SLN biopsy rationale:</span></p>\n<ul>\n<li><span style=\"font-family: verdana, geneva, sans-serif; font-size: 10pt;\"><strong>Afferent lymphatics</strong> from a primary tumor <strong>first drain into the sentinel node</strong> before draining into the other nodes. So, if a sentinel lymph node is positive for metastsis, it is possible that the other axillary nodes are also involved. Hence, axillary dissection would be necessary.</span></li>\n<li><span style=\"font-family: verdana, geneva, sans-serif; font-size: 10pt;\">If the sentinel node is tumor-free, then regional nodal metastasis is unlikely.</span></li>\n</ul>\n<p><span style=\"font-family: verdana, geneva, sans-serif; font-size: 10pt;\">The nodes can be identified using fluorescein dye, methylene blue, or radioactive sulfur colloid-labeled albumin. The dye can be injected into the peritumoral tissue, subareolar, periareolar, or intradermal plane.</span></p>\n<p><span style=\"font-family: verdana, geneva, sans-serif; font-size: 10pt;\">Contraindicated in patients with <strong>inflammatory</strong> <strong>breast</strong> <strong>cancer</strong>, stage <strong>T4</strong> disease, a history of <strong>previous</strong> <strong>breast</strong> <strong>cancer</strong> or <strong>chest wall surgery</strong>, <strong>breast scarring,</strong> and <strong>radiotherapy</strong>.</span></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d989f0a83e0c457093913b3580343c76.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 3-month-old child presented with umbilical discharge. Abdomen examination was normal except for the below finding. The next step of management is?",
    "choices": [
      {
        "id": 1,
        "text": "MRI Abdomen"
      },
      {
        "id": 2,
        "text": "USG Abdomen"
      },
      {
        "id": 3,
        "text": "CECT"
      },
      {
        "id": 4,
        "text": "Exploratory laparotomy"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Patent urachus occurs due to the failure of urachus to obliterate, resulting in a connection between the bladder and the umbilicus.</p>\n<p>Urachal cyst occurs when the urachus fails to obliterate but there is no connection between the bladder and the umbilicus.</p>\n<p>The given image below shows a&nbsp;urachal cyst (UC) attached to Meckel&rsquo;s diverticulum (MD) on one side and urinary bladder (UB) on the other side with a patent tract- urachus (U).</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c92c8383a16546ec8dfb533bd3ac105b.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e226746e0f384863bd935402f9bf32b4x1280x2786.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/36545182350748b3878f9d1aec2a5206x482x382.PNG"
    ]
  },
  {
    "text": "Which of the following cancers rarely metastasizes to the liver?",
    "choices": [
      {
        "id": 1,
        "text": "Colon"
      },
      {
        "id": 2,
        "text": "Breast"
      },
      {
        "id": 3,
        "text": "Prostate"
      },
      {
        "id": 4,
        "text": "Melanoma"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Prostate</strong> cancers <strong>rarely metastasize to the liver.</strong></p>\n<p>The most common malignant tumors of the liver are <strong>metastatic lesions</strong>.\u00a0 The liver is a common site of metastases from <strong>gastrointestinal tumors</strong> because of dissemination through the portal venous system.\u00a0 The most relevant metastatic tumor of the liver to the surgeon is colorectal cancer because of the well-documented potential for long-term survival after complete resection.</p>\n<p>The more frequent <strong>primary sites</strong> include carcinomas of the colon, pancreas, lung, and breast <strong>in adults</strong>, and neuroblastoma, Wilms tumor, and rhabdomyosarcoma <strong>in pediatric patients</strong>. Although the origin of the tumor is often known when metastases are biopsied, carcinomas of the pancreas, stomach, and lung are particularly notorious for being occult primary neoplasms.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 40-year-old female presents to the ER with a history of RTA. On examination, GCS is 15/15, heart rate = 110/min, BP = 90/60 mmHg, and there is elevated JVP. The right chest is hyperresonant on percussion with decreased breath sounds. The left chest appears normal. But the patient is dyspneic and ecchymosis is noted over the chest wall. The abdomen was soft. The probable diagnosis is:",
    "choices": [
      {
        "id": 1,
        "text": "Cardiac tamponade"
      },
      {
        "id": 2,
        "text": "Tension pneumothorax"
      },
      {
        "id": 3,
        "text": "Pericardial effusion"
      },
      {
        "id": 4,
        "text": "Massive hemothorax"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Other options:\u00a0</p>\n<p>Options A:\u00a0 <strong>Pericardial tamponade</strong> can mimic tension pneumothorax, but the absence of a tympanic note on percussion rules out its possibility. A patient with pericardial tamponade can present with hypotension, raised JVP, and muffled heart sounds (<strong>Beck\u2019s triad</strong>), with <strong>normal breath sounds</strong> and <strong>no tracheal shift</strong>.</p>\n<p>Option C: Dullness in percussion at the base of the left inferior angle of scapula in conjunction with tubular breath sounds (<strong>Ewart\u2019s sign</strong>), chest pain that improves while sitting upright and worsens when lying down and pulsus paradoxus are indicative of <strong>pericardial effusion</strong>. Pericardial effusion develops into tamponade when the effusion leads to increased pressure, impairing ventricular filling and reducing cardiac output.</p>\n<p>Option D: <strong>Massive hemothorax</strong> is the accumulation of &gt;1500 ml of blood or one-third or more of the patient\u2019s blood volume in the chest cavity. The patient will have collapsed neck veins, decreased breath sounds and a dull note on percussion.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/087c224886f64acca4b8a7eb85d4a22dx720x663.JPEG"
    ]
  },
  {
    "text": "A 50-year-old male presents to the emergency with a BP of 160/100 mmHg and a heart rate of 120. CECT done reveals a Stanford A aortic dissection. What is the initial management of this given condition?",
    "choices": [
      {
        "id": 1,
        "text": "Beta blocker medication"
      },
      {
        "id": 2,
        "text": "LMWH"
      },
      {
        "id": 3,
        "text": "Surgical repair"
      },
      {
        "id": 4,
        "text": "Vitamin K inhibitors"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Management of aortic dissection:</p>\n<p>The&nbsp;<strong>initial management</strong>&nbsp;of patients with all types of aortic dissection is&nbsp;<strong>b</strong><strong>eta-blocker&nbsp;</strong>medication&nbsp;to<strong> control hypertension</strong>&nbsp;along with <strong>pain management</strong>. The preferred beta-blocker drug is&nbsp;<strong>e</strong><strong>smolol</strong>. Hemodynamic stability is an important consideration.</p>\n<ul>\n<li>Stanford Type A (<strong>DeBakey Types I and II</strong>) requires&nbsp;<strong>surgical intervention</strong>&nbsp;once the patient's blood pressure is stabilized.</li>\n<li>Stanford Type B (<strong>DeBakey type III</strong>) is best managed by<strong>&nbsp;antihypertensive drugs</strong>.&nbsp;For patients with<strong>&nbsp;complicated type B dissection</strong>, percutaneously placed&nbsp;<strong>endovascular stents</strong> are currently preferred. Surgery is reserved for the rare patients not suitable for stenting.</li>\n</ul>\n<p>Other options:</p>\n<p>Options B and D: Low molecular weight heparin and vitamin K inhibitors are contraindicated in aortic dissection as they can worsen the risk of bleeding.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/867f02e1159040d9b1e0a8d4dfbaa4eax1280x1241.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/61be6c9452094c59ad9c26bd98cf9ed7x1280x3028.JPEG"
    ]
  },
  {
    "text": "A 22-year-old male presented with a hard painless testicular swelling. There were no inguinal, intra-abdominal or mediastinal lymph nodes on CT Scan.  The blood investigations showed AFP levels of > 3000. USG shows uniform echotexture and small areas of necrosis. The next line of management is _______.",
    "choices": [
      {
        "id": 1,
        "text": "High inguinal orchidectomy"
      },
      {
        "id": 2,
        "text": "Core needle trucut biopsy"
      },
      {
        "id": 3,
        "text": "FNAC"
      },
      {
        "id": 4,
        "text": "Whole body PET/CT"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical features of painless testicular swelling with raised AFP levels without distant metastasis point towards the likely diagnosis of<strong> stage 1 non-seminomatous germ cell tumour </strong>(NSGCT) of the testis. The next step in management is a <strong>high inguinal orchidectomy</strong>.</p>\n<p><strong>Core needle trucut biopsy</strong> and <strong>FNAC</strong> should be never done when there is a suspicion of testicular neoplasm as it will result in the <strong>seeding of tumor cells</strong> into the skin and lymphatics, leading to upstaging of the tumor (Options B and C). Currently, there is no role for <strong>PET-CT</strong> in the routine evaluation of non-seminomatous germ cell tumor and seminoma at the time of diagnosis (Option D).&nbsp;</p>\n<p>Testicular tumors&nbsp;are classified according to their predominant cell type:&nbsp;</p>\n<ul>\n<li>Germ cell tumors (90-95%): seminomatous (seminoma) or NSGCT (embryonal carcinoma, yolk sac tumor, teratoma and choriocarcinoma).</li>\n<li>Sex cord-stromal tumors (1-2%): Leydig cell tumors, Sertoli cell tumors</li>\n<li>Lymphoma (3-7%)</li>\n<li>Other tumors (1-2%)</li>\n</ul>\n<p>The most common presentation of testicular cancer is <strong>painless testicular mass</strong>. Pain is more commonly associated with NSGCT and two-thirds of patients present with metastatic disease at the time of diagnosis. The symptoms of metastatic disease include abdominal pain, dyspnea, chest pain, cough or hemoptysis.&nbsp;</p>\n<p>Management of testicular tumours:</p>\n<ol>\n<li><strong>Ultrasound&nbsp;</strong>of the testis should be done in all suspected cases of a testicular tumour to confirm the diagnosis.</li>\n<li><strong>Tumor markers</strong>&nbsp;(AFP, hCG, LDH) are measured for the staging of cancer.</li>\n<li><strong>CT- chest, abdomen,</strong>&nbsp;and<strong>&nbsp;pelvis</strong> are done to detect metastasis.</li>\n<li>Orchidectomy via an inguinal incision (<strong>high inguinal orchidectomy</strong>) is the&nbsp;<strong>best line of treatment</strong>&nbsp;in case of a suspected testicular tumour.</li>\n<li>Further management is based on staging.&nbsp;The older staging is preferred over the TNM staging for treatment and is given below:\n<ul>\n<li><strong>Stage I</strong>: Tumour is confined to testis and epididymis</li>\n<li><strong>Stage II</strong>: Nodal tissue is present but is confined to nodes below the diaphragm</li>\n<li><strong>Stage III</strong>: Nodal involvement above the diaphragm</li>\n<li><strong>Stage IV</strong>: Non-lymphatic metastatic spread (mostly in lungs)</li>\n</ul>\n</li>\n<li><strong>Stage I tumours:</strong><br />\n<ul>\n<li>Combination chemotherapy with bleomycin, etoposide, and cis-platinum (<strong>BEP chemotherapy</strong>) is given for&nbsp;NSGCTs, as they are&nbsp;<strong>radio-resistant.</strong></li>\n<li>Chemotherapy with cisplatinum and radiotherapy to para-aortic lymph nodes can be given in&nbsp;<strong>seminomas</strong>&nbsp;as they are&nbsp;<strong>radiosensitive.</strong></li>\n</ul>\n</li>\n<li><strong>Stage II-IV tumours</strong>&nbsp;(seminomas and NSGCTs) are treated with BEP chemotherapy and retroperitoneal lymph node dissection if needed.</li>\n</ol>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A condition requires the surgery depicted in the image shown below. All the following are usually seen associated with this condition except?",
    "choices": [
      {
        "id": 1,
        "text": "Absent kidney"
      },
      {
        "id": 2,
        "text": "Hepatic artery anomalies"
      },
      {
        "id": 3,
        "text": "Malrotation of gut"
      },
      {
        "id": 4,
        "text": "Polysplenia"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given image shows a Roux-en-Y loop of the small intestine (jejunum) attached to an area of the liver capsule (<strong>Roux-en-Y hepaticojejunostomy</strong>), which is suggestive of <strong>Kasai hepatoportoenterostomy</strong> procedure done <strong>for biliary atresia in infants</strong>. An absent kidney is not associated with this condition.</p>\n<p>Extrahepatic biliary atresia&nbsp;(EHBA) is defined as a partial or total&nbsp;<strong>absence&nbsp;</strong>of permeable<strong>&nbsp;bile duct&nbsp;</strong>between porta hepatis and the duodenum. It is due to&nbsp;<strong>inflammatory fibrosis</strong>&nbsp;of the biliary tree.&nbsp;It leads to obstruction to bile flow thereby causing leaking of&nbsp;<strong>conjugated bilirubin</strong>&nbsp;into the circulation.</p>\n<p><strong>Associated anomalies</strong> include cardiac lesions,&nbsp;<strong>polysplenia</strong>,&nbsp;<strong>situs inversus</strong>,&nbsp;<strong>absent vena cava</strong>, and a preduodenal portal vein.</p>\n<table style=\"height: 229px; width: 665px;\">\n<tbody>\n<tr style=\"height: 29.7656px;\">\n<td style=\"width: 655px; text-align: center; height: 29.7656px;\" colspan=\"3\"><strong>Management of extrahepatic biliary atresia</strong></td>\n</tr>\n<tr style=\"height: 54px;\">\n<td style=\"width: 87.2031px; height: 54px;\">Type I</td>\n<td style=\"width: 241.312px; height: 54px;\">\n<div class=\"page\" title=\"Page 1217\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Atresia restricted to the common bile duct</p>\n</div>\n</div>\n</div>\n</div>\n</td>\n<td style=\"width: 314.484px; height: 54px;\">\n<div class=\"page\" title=\"Page 1217\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Roux-en-Y hepaticojejunostomy</p>\n</div>\n</div>\n</div>\n</div>\n</td>\n</tr>\n<tr style=\"height: 54px;\">\n<td style=\"width: 87.2031px; height: 54px;\">Type II</td>\n<td style=\"width: 241.312px; height: 54px;\">\n<div class=\"page\" title=\"Page 1217\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Atresia of the common hepatic duct</p>\n</div>\n</div>\n</div>\n</div>\n</td>\n<td style=\"width: 314.484px; height: 54px;\" rowspan=\"2\"><strong>Kasai procedure</strong> (Roux-en-Y hepatoportoenterostomy)</td>\n</tr>\n<tr style=\"height: 54px;\">\n<td style=\"width: 87.2031px; height: 54px;\">Type III</td>\n<td style=\"width: 241.312px; height: 54px;\">\n<div class=\"page\" title=\"Page 1217\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Atresia of the right and left hepatic duct</p>\n</div>\n</div>\n</div>\n</div>\n</td>\n</tr>\n</tbody>\n</table>\n<p>In the Kasai procedure, the extrahepatic biliary tree is dissected proximally till the liver capsule, the porta hepatis is transected and a jejunal loop is anastomosed in order to provide a drainage pathway for bile.&nbsp;</p>\n<p><strong>Infants</strong>&nbsp;with biliary atresia, who do not achieve successful drainage after Kasai's procedure, require<strong>&nbsp;liver transplantation</strong> within the first year of life. This is the most common reason for liver transplantation in children.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a8031d2804a445b1bf12408bb593e860.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "You are doing an emergency laparotomy for a case of intestinal obstruction. Which organ will you first visualize to know if this is a case of small bowel or large bowel obstruction?",
    "choices": [
      {
        "id": 1,
        "text": "Ileum"
      },
      {
        "id": 2,
        "text": "Caecum"
      },
      {
        "id": 3,
        "text": "Jejunum"
      },
      {
        "id": 4,
        "text": "Sigmoid colon"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>The cecum</strong> is the <strong>first organ to be visualized to differentiate</strong> between the small and large bowel in cases of intestinal obstruction.</p>\n<p><strong>Distension of the cecum </strong>will confirm<strong> large bowel involvement. </strong>The identification&nbsp;of a collapsed distal segment of the large bowel and its sequential proximal assessment will lead to the identification of the cause.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the best position for a conscious patient to be in during the insertion of a Ryle's tube?",
    "choices": [
      {
        "id": 1,
        "text": "Supine with neck flexion"
      },
      {
        "id": 2,
        "text": "Supine with neck extension"
      },
      {
        "id": 3,
        "text": "Sitting with neck flexion"
      },
      {
        "id": 4,
        "text": "Sitting with neck extension"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The best position for a <strong>conscious patient</strong> to be in during the insertion of Ryle's tube<strong> (RT)</strong> is <strong>sitting with neck flexion</strong>. The described position helps in directing the RT towards the esophagus and also prevents it from coiling in the oropharynx or entering the trachea.</p>\n<p>RT, also known as nasogastric <strong>(NG) </strong>tube, measures <strong>120-125 cm</strong>. It has <strong>4 markings</strong> at 40cm (cardia), 50cm (body), 60cm (pylorus), and 70 cm (duodenum) to indicate the approximate position after the placement.</p>\n<p>Indications for NG tube:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Feeding in patients with dysphagia, decreased appetite, or those who are nil per os (NPO) for medical or surgical reasons.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Aspiration of gastric fluid</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Gastric decompression in cases of intestinal obstruction and paralytic ileus.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Zollinger-Ellison syndrome&nbsp;</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Bowel irrigation</li>\n</ul>\n<p>The <strong>absolute</strong> <strong>contraindications</strong> for an NG tube are <strong>severe midface trauma</strong>, recent nasal surgery, and <strong>basilar skull </strong>fractures</p>\n<p>Steps for the correct insertion of RT in an adult:</p>\n<ol>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Examination of the patient&rsquo;s nostril for any <strong>anatomical abnormalities</strong> and then instillation with 10 ml of 1% lignocaine&nbsp;</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>NEX method</strong> is used to <strong>measure the length of the RT</strong>: &nbsp;Place the exit port of the tube at the tip of the nose. Extend the tube to the earlobe, and then to the xiphisternum.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">The patient is asked to sit <strong>upright with partial neck flexion</strong>. The tip of the Ryle&rsquo;s tube is lubricated and passed along the floor of the nasal passage until a resistance is felt(corresponds to nasopharynx)</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">The patient is subsequently asked to swallow water to guide the tube through the esophagus into the stomach until the <strong>marked length</strong> (based on the NEX method).</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">NG tube is finally taped to secure it in place.</li>\n</ol>\n<p><br />Confirmation of the correct position is done by:</p>\n<ol>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Auscultation</strong> in the <strong>epigastric</strong> <strong>area</strong> while injecting a bolus of air</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">X-ray chest to locate the lead markers</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Aspiration of contents and subsequently confirming gastric origin (pH &lt;6 indicates gastric placement)</li>\n</ol>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2b29d419f2864e5ab70adf6c34335073x576x432.PNG"
    ]
  },
  {
    "text": "Pick from the following the usual cause of thyroid storm in thyroidectomy:",
    "choices": [
      {
        "id": 1,
        "text": "Rough handling of thyroid during surgery"
      },
      {
        "id": 2,
        "text": "Due to parathyroid gland"
      },
      {
        "id": 3,
        "text": "Inadequate patient preparation"
      },
      {
        "id": 4,
        "text": "Infections"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The usual cause of thyroid storm in thyroidectomy is<strong> inadequate patient preparation</strong> before surgery. Patient preparation <strong>pre-operatively</strong> involves ensuring a <strong>euthyroid</strong> <strong>state</strong>.</p>\n<p><strong>Rough handling</strong> of the thyroid in thyroidectomy does <strong>not</strong> cause a<strong> thyroid storm</strong>. Though a significant amount of thyroglobulin is stored in the acinar cells, they are inactive unless converted to thyroxine (T3 and T4).&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following colored cannula will you use to achieve maximum flow rate, in a patient who needs a large amount of fluids?",
    "choices": [
      {
        "id": 1,
        "text": "Grey"
      },
      {
        "id": 2,
        "text": "Green"
      },
      {
        "id": 3,
        "text": "Blue"
      },
      {
        "id": 4,
        "text": "Pink"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Grey</strong> colored cannula is used to achieve <strong>maximum flow rate</strong> in a patient who needs a large amount of fluids.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient who was admitted after a road traffic accident is put on mechanical ventilation. He opens his eyes on verbal command and moves all four limbs spontaneously. Calculate his GCS.",
    "choices": [
      {
        "id": 1,
        "text": "Eyes-2, Verbal-1, Motor-5"
      },
      {
        "id": 2,
        "text": "Eyes-2, Verbal-NT, Motor-5"
      },
      {
        "id": 3,
        "text": "Eyes-3, Verbal-1, Motor-6"
      },
      {
        "id": 4,
        "text": "Eyes-3, Verbal-NT, Motor-6"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The patients GCS is<strong> Eyes-3, Verbal-NT, Motor-6.</strong></p>\n<p>It is calculated as follows:</p>\n<ul>\n<li><strong>Eye opening</strong>: Opening to verbal command - 3&nbsp;</li>\n<li><strong>Verbal response</strong>: In the case of endotracheal intubation, the verbal response score is noted as NT (non-testable)</li>\n<li><strong>Motor respone</strong>: Movement of all 4 limbs spontaneously - 6</li>\n</ul>\n<p>Total GCS score is not recorded since one of the components is non-testable.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient was brought to the casualty after a road traffic accident (RTA) with chest trauma. He is conscious and speaks single words. He has a respiratory rate of 44 cycles per min and a BP of 90/40 mmHg. There is a hyper-resonance on percussing the right side of his chest. What will be your next, immediate step?",
    "choices": [
      {
        "id": 1,
        "text": "Intubate the patient"
      },
      {
        "id": 2,
        "text": "Insert needle in appropriate intercostal space"
      },
      {
        "id": 3,
        "text": "Start intravenous fluids urgently"
      },
      {
        "id": 4,
        "text": "Take a chest X-ray"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario of <strong>chest trauma</strong> with a <strong>hyper resonant</strong> note on the right side suggests <strong>pneumothorax</strong>. <strong>Hemodynamic</strong> <strong>instability</strong> in this patient suggests <strong>tension pneumothorax</strong> and this is managed by <strong>immediate decompression</strong> by <strong>insertion of a needle</strong> in the appropriate place.</p>\n<p><strong>Pneumothorax</strong> refers to the presence of excess air in the pleural space. Entrapment of air occurs by:</p>\n<ol>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Primary</strong> spontaneous pneumothorax - Due to the <strong>spontaneous</strong> <strong>rupture</strong> of apical pleural <strong>blebs</strong> or cystic spaces immediately below the visceral pleura.&nbsp;</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Secondary</strong> pneumothorax - Due to the rupture of dilated cystic spaces in lung <strong>diseases</strong> like chronic obstructive pulmonary disease <strong>(COPD)</strong>&nbsp;</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Tension</strong> pneumothorax - Due to <strong>a one-way valve </strong>mechanism that directs airflow into the pleural space leading to a higher than atmospheric pressure environment. This leads to the affected lung being <strong>unable to expand</strong> appropriately and leads to <strong>hemodynamic instability.</strong>&nbsp;</li>\n</ol>\n<p><br /><strong>Tension pneumothorax</strong> is a <strong>surgical emergency</strong> and the excessive pressure has to be <strong>immediately</strong> relieved. A chest<strong>&nbsp;X-ray</strong> is <strong>not</strong> required before emergency decompression as it is a <strong>clinical</strong> diagnosis, but an X-ray should be done following chest tube insertion<strong> (option D)</strong>. Tension pneumothorax is managed by immediate needle decompression in the 5th ICS (adults), followed by definitive management with a chest tube inserted in the same space.</p>\n<p>Other options:</p>\n<p>Option A: <strong>Intubation</strong> is performed when the patient is<strong> unresponsive</strong> post chest tube insertion.&nbsp;</p>\n<p>Option C: While <strong>IV fluids</strong> are a part of the resuscitation protocol, the management of <strong>tension pneumothorax </strong>takes <strong>higher</strong> <strong>precedence</strong> as the next immediate step.</p>\n<p>Note: According to ATLS 10th edition</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">In adults, needle thoracostomy or needle decompression location is changed to the 5th ICS anterior to the midaxillary line from the 2nd ICS midclavicular line.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">In the pediatric age group, the needle thoracostomy location remains at the 2nd ICS midclavicular line.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Heller\u2019s operation is done for _____.",
    "choices": [
      {
        "id": 1,
        "text": "Achalasia cardia"
      },
      {
        "id": 2,
        "text": "Carcinoma esophagus"
      },
      {
        "id": 3,
        "text": "Esophageal stricture"
      },
      {
        "id": 4,
        "text": "Hypertrophic pyloric stenosis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The most common surgical procedure for<strong> achalasia cardia</strong> is laproscopic <strong>Heller myotomy</strong> in conjugation with partial fundoplication.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '227 Surgery Aiims 2018';
        let hierarchy = ["Marrow", "PYQs", "Surgery"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>