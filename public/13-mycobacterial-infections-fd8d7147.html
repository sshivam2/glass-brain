<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>13 Mycobacterial Infections - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Dermatology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">31</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A patient presents to the OPD with skin lesions that are associated with loss of sensation. What is the most unstable form of this patient's disease?",
    "choices": [
      {
        "id": 1,
        "text": "Borderline tuberculoid"
      },
      {
        "id": 2,
        "text": "Lepromatous leprosy"
      },
      {
        "id": 3,
        "text": "Borderline borderline"
      },
      {
        "id": 4,
        "text": "Borderline lepromatous"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The image shows <strong>punched-out</strong>\u00a0<strong>anesthetic</strong> lesions characteristic of the <strong>borderline spectrum</strong> of leprosy. The <strong>most unstable</strong> form of leprosy is the<strong>\u00a0borderline-borderline</strong> type.</p>\n<p>This type is <strong>rare</strong>ly seen as it <strong>rapidly upgrades </strong>towards <strong>tuberculoid</strong> or <strong>downgrades </strong>towards <strong>lepromatous</strong>, based on the immune status of the individual. However, clinical features may lag behind the immunological and histological findings. This leads to numerous skin lesions and with features of both ends of the spectrum.\u00a0</p>\n<p>Lepromatous and tuberculoid\u00a0types are the most stable.</p>\n<p><strong>Classification</strong> systems of<strong> leprosy:</strong></p>\n<ul>\n<li><strong>Ridley Jopling</strong> classification:\n<ul>\n<li>Tuberculoid (TT)</li>\n<li>Borderline tubercular (BT)</li>\n<li>Borderline (BB)</li>\n<li>Borderline lepromatous (BL)</li>\n<li>Lepromatous (LL)</li>\n</ul>\n</li>\n<li><strong>Madrid</strong> classification:\n<ul>\n<li>Lepromatous (LL)</li>\n<li>Tuberculoid (TT)</li>\n<li>Borderline/dimorphous</li>\n<li>Indeterminate (early unstable type)</li>\n</ul>\n</li>\n<li><strong>Indian</strong> classification<strong> -</strong>\u00a0includes categories under Madrid classification +\u00a0<strong>pure neuritic type</strong></li>\n<li><strong>WHO</strong> classification:</li>\n</ul>\n<table style=\"width: 395px; height: 222px;\">\n<tbody>\n<tr style=\"height: 36px;\">\n<td style=\"width: 115.484px; text-align: center; height: 36px;\">\u00a0</td>\n<td style=\"width: 128.969px; text-align: center; height: 36px;\"><strong>Paucibacillary Leprosy</strong></td>\n<td style=\"width: 128.547px; text-align: center; height: 36px;\"><strong>Multibacillary Leprosy</strong></td>\n</tr>\n<tr style=\"height: 46px;\">\n<td style=\"width: 115.484px; height: 46px;\">\n<p><strong>Number of skin lesions\u00a0</strong></p>\n</td>\n<td style=\"width: 128.969px; height: 46px;\">\n<p>up to 5\u00a0</p>\n</td>\n<td style=\"width: 128.547px; height: 46px;\">\n<p>6 or more</p>\n</td>\n</tr>\n<tr style=\"height: 50px;\">\n<td style=\"width: 115.484px; height: 50px;\">\n<p><strong>Nerve involvement\u00a0</strong></p>\n</td>\n<td style=\"width: 128.969px; height: 50px;\">\n<p>0-1\u00a0</p>\n</td>\n<td style=\"width: 128.547px; height: 50px;\">\n<p>2 or more\u00a0</p>\n</td>\n</tr>\n<tr style=\"height: 64px;\">\n<td style=\"width: 115.484px; height: 64px;\"><strong>Slit skin smear\u00a0</strong></td>\n<td style=\"width: 128.969px; height: 64px;\">Negative on all sites</td>\n<td style=\"width: 128.547px; height: 64px;\">\n<p>Positive at any site</p>\n</td>\n</tr>\n<tr style=\"height: 64px;\">\n<td style=\"width: 115.484px; height: 64px;\"><strong>Ridley-Jopling\u00a0</strong></td>\n<td style=\"width: 128.969px; height: 64px;\">TT, BT</td>\n<td style=\"width: 128.547px; height: 64px;\">\n<p>BB, LL, BL\u00a0</p>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/70205059d4fa43f58100a19da83545a7.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following is the most common type of leprosy seen in India?",
    "choices": [
      {
        "id": 1,
        "text": "Tuberculoid leprosy"
      },
      {
        "id": 2,
        "text": "Borderline tuberculoid"
      },
      {
        "id": 3,
        "text": "Borderline lepromatous"
      },
      {
        "id": 4,
        "text": "Lepromatous leprosy"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>most common</strong> type of leprosy in India is <strong>borderline tuberculoid (BT)</strong>.</p>\n<p>The spectrum of leprosy in India in decreasing order of prevalence:&nbsp;</p>\n<ol>\n<li>Borderline tuberculoid&nbsp;</li>\n<li>Borderline lepromatous</li>\n<li>Lepromatous leprosy</li>\n<li>Pure neuritic type</li>\n<li>Borderline-borderline</li>\n<li>Indeterminate type</li>\n<li>Histoid type&nbsp;</li>\n</ol>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 40-year-old man presented with the following skin lesions that are associated with loss of sensation. What type of leprosy are these lesions suggestive of?",
    "choices": [
      {
        "id": 1,
        "text": "Lepromatous"
      },
      {
        "id": 2,
        "text": "Borderline lepromatous"
      },
      {
        "id": 3,
        "text": "Tuberculoid"
      },
      {
        "id": 4,
        "text": "Borderline tuberculoid"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The image shows a <strong>hypopigmented</strong> skin lesion with <strong>pseudopodia</strong> and&nbsp;<strong>satellite lesions</strong>, suggestive of&nbsp;<strong>borderline tuberculoid</strong> (BT)&nbsp;leprosy.</p>\n<p><strong>Features</strong> of the lesions of <strong>BT leprosy:</strong>&nbsp;</p>\n<ul>\n<li>Macules and plaques of various sizes&nbsp;</li>\n<li>Dry, scaly surface</li>\n<li>Pseudopodia or finger-like extensions</li>\n<li>Satellite lesions&nbsp;</li>\n<li>Anesthetic patches</li>\n<li>Anhidrosis over the lesion</li>\n<li>Hair loss&nbsp;</li>\n</ul>\n<p>There is <strong>asymmetric nerve involvement.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/dc89041e0d0b4153ad7fad291b6c6546.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "While examining a 7-year-old child, you note the given lesion. It is not associated with sensory loss or loss of sweating. Slit-skin smear is negative. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Borderline tuberculoid leprosy"
      },
      {
        "id": 2,
        "text": "Pityriasis alba"
      },
      {
        "id": 3,
        "text": "Indeterminate leprosy"
      },
      {
        "id": 4,
        "text": "Nevus depigmentosus"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Option A:<strong>&nbsp;Borderline tuberculoid</strong> type presents with 1-10 dry, scaly, hypopigmented lesions with or without satellite lesions with <strong>diminished sensations</strong> and slit skin smear showing <strong>scanty bacilli</strong>.</p>\n<p>Option B:&nbsp;<strong>Pityriasis alba </strong>presents with single or few hypopigmented macules on the face with normal sensation, normal sweating. There is a history of <strong>atopy</strong> and <strong>waxing and waning</strong> of lesions.</p>\n<p>Option D-<strong> Nevus depigmentosus</strong>&nbsp;is a <strong>congenital</strong> pigmentary disorder that presents with&nbsp;a non-progressive hypopigmented macule. It usually is present from birth or early childhood and remains stable throughout life.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/6696093a90a04be685fd4e706949e4a8.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/69cfa8112c9b490d8a95871adf1db8b5x259x384.PNG"
    ]
  },
  {
    "text": "While counseling the wife of a man diagnosed with leprosy, you give her a list of symptoms to watch for.  If she were to develop leprosy, which of the following sensations would be lost first?",
    "choices": [
      {
        "id": 1,
        "text": "Pain"
      },
      {
        "id": 2,
        "text": "Temperature"
      },
      {
        "id": 3,
        "text": "Fine touch"
      },
      {
        "id": 4,
        "text": "Vibration sense"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The earliest sign of <strong>leprosy</strong> is <strong>loss of temperature</strong>, usually over the <strong>hands</strong> and <strong>feet.</strong></p>\n<p>The onset of leprosy is <strong>insidious</strong>, with sensory changes often preceding skin lesions by several years. <strong>Dysesthesia</strong>\u00a0develops in a progressive manner. The ability to differentiate between hot and cold may be lost before the pinprick sensation. This type of <strong>dissociated sensory\u00a0loss</strong> is suspicious for leprosy. \u00a0</p>\n<p>The sensations are lost in the following order:</p>\n<p><strong>Temperature</strong> &gt; Fine Touch &gt; Pain &gt; Deep touch or pressure</p>\n<p>Vibration and proprioception are lost in the later stages.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Your dermatology consultant wishes to conduct a study on leprosy in your district. He has tasked you with collecting data on the patients and classifying them based on Ridley Jopling classification. Which of the following patients would not belong under any of the categories in this classification system?",
    "choices": [
      {
        "id": 1,
        "text": "55-year-old with lepromatous leprosy"
      },
      {
        "id": 2,
        "text": "30-year old with borderline leprosy"
      },
      {
        "id": 3,
        "text": "67-year-old with tuberculoid leprosy"
      },
      {
        "id": 4,
        "text": "42-year-old with pure neuritic type leprosy"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Pure neuritic type leprosy</strong>\u00a0is not included in the Ridley Jopling classification. It is present under the <strong>Indian classification.</strong>\u00a0</p>\n<p><strong>Classification systems of leprosy:</strong></p>\n<ul>\n<li><strong>Ridley Jopling classification:</strong>\n<ul>\n<li>Tuberculoid (TT)</li>\n<li>Borderline tubercular (BT)</li>\n<li>Borderline (BB),</li>\n<li>Borderline lepromatous (BL)</li>\n<li>Lepromatous (LL)</li>\n</ul>\n</li>\n<li><strong>Madrid classification:</strong>\n<ul>\n<li>Lepromatous (LL)</li>\n<li>Tuberculoid (TT)</li>\n<li>Borderline/dimorphous</li>\n<li>Indeterminate (early unstable type)</li>\n</ul>\n</li>\n<li><strong>Indian classification-</strong>\u00a0includes categories under Madrid classification + <strong>pure neuritic type</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which is the most common nerve involved in leprosy?",
    "choices": [
      {
        "id": 1,
        "text": "Posterior tibial nerve"
      },
      {
        "id": 2,
        "text": "Ulnar  nerve"
      },
      {
        "id": 3,
        "text": "Common peroneal nerve"
      },
      {
        "id": 4,
        "text": "Facial nerve"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The<strong> ulnar nerve&nbsp;</strong>is the <strong>most</strong> <strong>common</strong>ly affected nerve in <strong>leprosy.</strong></p>\n<p>A <strong>thickened</strong> ulnar <strong>nerve</strong> may be palpated at the elbow. There can be <strong>sensory</strong> loss over the <strong>palm</strong> (<strong>medial</strong>) and motor deficit causing a <strong>claw hand.</strong></p>\n<p>The commonly affected nerves in the order of <strong>frequency</strong> are:</p>\n<p>Ulnar &gt; Posterior tibial &gt; Median &gt; Lateral popliteal &gt; Facial</p>\n<p>Posterior tibial nerve: Paralysis and contracture of the small muscles of the foot and anesthesia of the sole.</p>\n<p>Common peroneal nerve: Difficulty in dorsiflexion and eversion of the foot and anesthesia of the outer border of the foot, causing trauma and plantar ulceration.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 32-year-old woman presents with the following hypoesthetic skin lesions. Which type of disease is this lesion characteristic of?",
    "choices": [
      {
        "id": 1,
        "text": "Indeterminate type"
      },
      {
        "id": 2,
        "text": "Pure neuritic type"
      },
      {
        "id": 3,
        "text": "Lepromatous type"
      },
      {
        "id": 4,
        "text": "Borderline type"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Inverted saucer</strong> lesions are raised lesions with ill-defined borders as shown below.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/908f5528ce3e414698bdd3f3da27569d.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/638da8e717a54a63b9f2f950ee10df66x1280x1314.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/edb8dc5a1b2f4bd394a2c96414b114ebx1280x1260.JPEG"
    ]
  },
  {
    "text": "A 50-year-old woman is being evaluated for a solitary skin lesion. Biopsy shows the following finding associated with nerve destruction. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Tuberculoid leprosy"
      },
      {
        "id": 2,
        "text": "Borderline tuberculoid leprosy"
      },
      {
        "id": 3,
        "text": "Borderline lepromatous leprosy"
      },
      {
        "id": 4,
        "text": "Lepromatous leprosy"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>A<strong> single</strong> skin<strong> lesion</strong> and histological finding of<strong>&nbsp;</strong>a <strong>granuloma</strong>&nbsp;with <strong>nerve destruction</strong> are suggestive of <strong>tuberculoid</strong> leprosy.&nbsp;</p>\n<p><strong>Borderline</strong> types: <strong>Granulomas</strong> are more <strong>prominent</strong> in <strong>BT</strong> than BL types. The nerves may be moderately swollen with infiltrates, but there is <strong>no nerve destruction</strong>.<strong>&nbsp;</strong>&nbsp;</p>\n<p><strong>Lepromatous</strong> leprosy: <strong>Granulomas</strong> are <strong>less</strong> and dense <strong>uniform macrophage infiltration</strong> may be seen. Large numbers of <strong>AFBs</strong> are also seen, forming <strong>clumps</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a9437734c5bf4da0bd7d02864e1de7e3.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Histopathology of a tissue sample from a patient with leprosy is shown below. Which form of the disease is this patient unlikely to have?",
    "choices": [
      {
        "id": 1,
        "text": "Tuberculoid leprosy"
      },
      {
        "id": 2,
        "text": "Lepromatous leprosy"
      },
      {
        "id": 3,
        "text": "Pure neuritic leprosy"
      },
      {
        "id": 4,
        "text": "Borderline leprosy"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The Grenz zone is most <strong>prominent</strong> in <strong>lepromatous</strong> leprosy, as there are scarce granulomas to fill up the space. It is also seen in the <strong>borderline&nbsp;</strong>spectrum.</p>\n<p>In <strong>tuberculoid</strong> leprosy, <strong>d</strong><strong>ermal granulomas</strong>, consisting of groups of epithelioid cells with giant cells, are seen. The granulomas are elongated and generally run parallel to the surface, following neurovascular bundles. The granulomas <strong>extend </strong>up to the <strong>epidermis</strong>, thereby <strong>obscuring</strong> the<strong>&nbsp;Grenz zone</strong>. &nbsp;</p>\n<p>The grenz zone is also seen in granuloma faciale and&nbsp;B-cell lymphoma.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a5bf991f301f47b69b5e01ddd50e4c88.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c804d280380847679e81d53da558702cx1280x1352.2143864598024.JPEG"
    ]
  },
  {
    "text": "Which of the following is not an early feature of the condition depicted below?",
    "choices": [
      {
        "id": 1,
        "text": "Indistinct shiny macules with normal sensation"
      },
      {
        "id": 2,
        "text": "Nasal stuffiness, crusting and epistaxis"
      },
      {
        "id": 3,
        "text": "Oedema of ankles and legs"
      },
      {
        "id": 4,
        "text": "Stocking and glove anaesthesia"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given image depicts <strong>lepromatous</strong> leprosy. Glove and stocking <strong>anesthesia</strong> is a <strong>late feature</strong>.&nbsp;</p>\n<p>In lepromatous leprosy, the <strong>earliest</strong> clinical manifestations are <strong>dermal.</strong>&nbsp;</p>\n<p>The <strong>early features</strong> include:&nbsp;</p>\n<ul>\n<li>Numerous, ill-defined, shiny macules</li>\n<li>Anhidrosis</li>\n<li>Normal sensation</li>\n<li>Nasal symptoms -&nbsp;stuffiness, discharge, epistaxis</li>\n<li>Peripheral oedema due to capillary stasis</li>\n</ul>\n<p>Early nerve involvement is asymptomatic. <strong>Peripheral</strong> nerves are affected <strong>first.</strong> In&nbsp;the<strong>&nbsp;</strong>late stages, even facial and corneal nerves can be involved. <strong>Loss</strong> of <strong>sensation</strong> begins as <strong>patchy</strong> and later becomes <strong>extensive</strong>. <strong>Stocking</strong> and <strong>glove</strong> anesthesia is a <strong>late</strong> manifestation. The affected skin can become dry and ichthyotic.</p>\n<p>The <strong>late stage</strong> of lepromatous leprosy gives rise to the following features:</p>\n<ul>\n<li>Leonine facies -&nbsp;infiltration of skin folds</li>\n<li>Madarosis - loss of&nbsp;eyelashes eyebrow hair</li>\n<li>Rat-bitten&nbsp;ear - repeated ulceration and healing</li>\n<li>Saddle nose deformity - breakdown of nasal cartilage</li>\n</ul>\n<p>Lepromatous leprosy develops in three stages:</p>\n<ol>\n<li>Early <strong>macular</strong> stage</li>\n<li><strong>Infiltrated</strong> stage - induration due to dermal infiltration, marked in face and ear lobe</li>\n<li>Late <strong>nodulo-plaque</strong> stage - progress to papules, nodules, and plaques, which ulcerate. &nbsp;</li>\n</ol>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/43193ba04c2f475da78cf8ce5017bfc4.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "You volunteer at a leprosy colony with 300 residents, where you encounter several patients with pure neuritic leprosy. Among them, which of the following presentations will you encounter most commonly?",
    "choices": [
      {
        "id": 1,
        "text": "Symmetric involvement of multiple nerves"
      },
      {
        "id": 2,
        "text": "Asymmetric involvement of multiple nerves"
      },
      {
        "id": 3,
        "text": "Nerve abscess"
      },
      {
        "id": 4,
        "text": "Mononeuritis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Mononeuritis&nbsp;</strong>is the <strong>most common</strong> form of presentation of <strong>pure neuritic</strong> form of leprosy.</p>\n<p>Pure neuritic form is a variant of leprosy characterized by the <strong>isolated </strong>involvement of<strong> peripheral nerve trunks</strong> with the absence of skin lesions. It is more common in India and Nepal.</p>\n<p>The <strong>clinical features</strong> of this variant of leprosy include:&nbsp;</p>\n<ul>\n<li>Nerve thickening</li>\n<li>Sensory neuropathy - pain, tenderness (predominant)</li>\n<li>Loss of function&nbsp;</li>\n</ul>\n<p>Nerve trunks of <strong>upper limb</strong> are more commonly involved. <strong>Asymmetric</strong> involvement of multiple nerve trunks is also seen. <strong>Symmetric</strong> polyneuritis is a <strong>rare</strong> feature.&nbsp;Occasionally, it may present as a&nbsp;<strong>nerve abscess</strong>.</p>\n<p><strong>Nerve biopsy</strong> is the <strong>gold standard</strong> method for diagnosis of pure neuritic leprosy.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 35-year-old man with a history of anesthetic skin lesions presents to you with difficulty in moving his foot. On inspection, the following finding is seen. Additionally, you note a high-stepping gait when he enters the clinic. Which of the following is not a feature of this disease?",
    "choices": [
      {
        "id": 1,
        "text": "Cranial nerve involvement"
      },
      {
        "id": 2,
        "text": "Affects superficial nerve trunks more commonly"
      },
      {
        "id": 3,
        "text": "Burning and shooting pain"
      },
      {
        "id": 4,
        "text": "Treatment stops the progression of neuropathy"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical scenario of a patient with <strong>foot drop</strong>, skin lesions, and nerve <strong>thickening, </strong>as shown in the image, is suggestive of <strong>leprosy</strong> or <strong>Hansen&rsquo;s</strong> disease. <strong>Neuropathy</strong> may continue to <strong>progress</strong> even after effective <strong>MDT.&nbsp;</strong>This can lead to secondary impairment for years after completion of therapy.&nbsp;</p>\n<p>The <strong>superficially located nerves</strong> are more commonly involved, especially ulnar, median, radial, peroneal, posterior tibial, greater auricular as well as 5th and 7th cranial nerves. &nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/9cdf1bfa4d59486b924fb56a5fa3dc19.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 40-year-old man, whose wife is a known case of leprosy, presents with the following skin lesions all over his body. Which of the following is incorrect about this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Low  bacillary load in lesions"
      },
      {
        "id": 2,
        "text": "Reactions are rarely seen"
      },
      {
        "id": 3,
        "text": "Associated with dapsone resistance"
      },
      {
        "id": 4,
        "text": "Biopsy shows interlacing histiocytes"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given image with <strong>shiny papules</strong> and <strong>nodules</strong> on normal skin is suggestive of <strong>histoid leprosy</strong>. It is characterized by a very <strong>high&nbsp;bacillary load.</strong></p>\n<p>Histoid leprosy is a <strong>rare</strong> type of <strong>multibacillary</strong> leprosy where the bacilli are <strong>confined</strong> to the <strong>lesions</strong> and hence, <strong>globi </strong>are relatively<strong> few</strong>. The name arises from the microscopic finding of&nbsp;<strong>spindle-shaped</strong>&nbsp;<strong>histiocytes</strong> forming <strong>interlacing</strong> bands and whorls.</p>\n<p>It was initially associated with&nbsp;dapsone monotherapy and irregular treatment, leading to the development of <strong>dapsone-resistant</strong> bacteria. It is now recognized to arise<strong> de novo also</strong>.</p>\n<p><strong>Lepra reactions</strong>&nbsp;are considered to be <strong>uncommon</strong> in histoid leprosy.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/77e1e90ed4404827a3d03fd07561fdf0.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not seen in lepra bonita?",
    "choices": [
      {
        "id": 1,
        "text": "Appearance of premature aging"
      },
      {
        "id": 2,
        "text": "Obliteration of wrinkles and healthy-looking face"
      },
      {
        "id": 3,
        "text": "Lucio phenomenon"
      },
      {
        "id": 4,
        "text": "Absent nerve involvement"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Lepra bonita</strong>&nbsp;usually presents with <strong>pan-neuritis</strong>.&nbsp;It is a <strong>diffuse</strong> form of <strong>lepromatous</strong> leprosy and is also called the leprosy of Lucio and Latapi. &nbsp;</p>\n<p>Diffuse infiltration of the skin of the face causes <strong>obliteration of wrinkles&nbsp;</strong>giving a&nbsp;<strong>myxedema-like</strong> appearance. It appears as a <strong>healthy</strong> look, leading to the name lepra bonita (beautiful leprosy).</p>\n<p>As the disease progresses, the <strong>infiltration</strong> persists but the skin becomes <strong>thinner</strong> and <strong>atrophic</strong> and, consequently, the patient appears to have <strong>prematurely aged</strong>. <strong>Generalized hair loss</strong> is also seen.&nbsp;</p>\n<p><strong>Lucio phenomenon</strong> is a type of <strong>lepra reaction </strong>seen in these patients and is characterized by well-defined, angular, jagged, <strong>purpuric</strong> lesions evolving into <strong>ulcerations</strong> and spreading in <strong>ascending</strong> fashion and healing with <strong>atrophic</strong> white <strong>scarring</strong>, as seen below.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/caaf752f64ec42c197676d97ed47af74x750x394.JPEG"
    ]
  },
  {
    "text": "A 50-year-old man was referred to you with the following lesions. Slit skin smear showed a bacillary index of 3+. What duration of treatment will you recommend for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "24 months"
      },
      {
        "id": 2,
        "text": "18 months"
      },
      {
        "id": 3,
        "text": "12 months"
      },
      {
        "id": 4,
        "text": "9 months"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>A patient presenting with <strong>multiple skin lesions </strong>and <strong>bacillary index &gt; 2+</strong> is classified as <strong>multibacillary</strong> according to WHO classification. The recommended duration of treatment is <strong>12 months</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/611a1a5bc44846bcbf6c6cb6806e1af7.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is not true regarding dapsone?",
    "choices": [
      {
        "id": 1,
        "text": "It acts by inhibiting folic acid synthesis"
      },
      {
        "id": 2,
        "text": "Poor oral absorption"
      },
      {
        "id": 3,
        "text": "It can cause DDS syndrome"
      },
      {
        "id": 4,
        "text": "Can cause hemolysis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Dapsone has<strong> good oral absorption</strong> and it has a<strong> long half\u2010life, </strong>averaging 28 hours.</p>\n<p>Dapsone or<strong> DDS </strong>(4,4\u2010diamino-diphenyl sulphone) is <strong>weakly bactericidal</strong> due to the inhibition of dihydropteroate synthase, which <strong>inhibits folate synthesis.</strong> It is a part of the multidrug therapy for leprosy.</p>\n<p>Adverse effects include:</p>\n<ul>\n<li>Mild hemolysis and<strong>&nbsp;</strong>anemia</li>\n<li>Psychosis.</li>\n<li><strong>DDS syndrome</strong> or<strong>&nbsp;</strong>five-week dermatitis - occurs <strong>5-6 weeks </strong>after starting dapsone. It may be fatal. It presents with:&nbsp;\n<ul>\n<li>Exfoliative dermatitis</li>\n<li>Hepatosplenomegaly</li>\n<li>Lymphadenopathy</li>\n<li>Fever</li>\n<li>Hepatitis.&nbsp;</li>\n</ul>\n</li>\n</ul>\n<p><strong>Uses of dapsone:</strong>&nbsp;</p>\n<ul>\n<li><strong>Steroid sparing</strong> drug - long-term therapy for&nbsp;autoimmune blistering diseases</li>\n<li>Adjuvant therapy -&nbsp;bronchial asthma</li>\n<li>CNS-protective -&nbsp;seizure disorders, strokes, glioblastoma</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A woman presents with painful lesions, during the course of her treatment for leprosy, that resolve with medications, as seen below. Which of the following statements is incorrect regarding this condition?",
    "choices": [
      {
        "id": 1,
        "text": "It is seen in the borderline spectrum of disease"
      },
      {
        "id": 2,
        "text": "Systemic symptoms are not a feature"
      },
      {
        "id": 3,
        "text": "It presents with new red, painful lesions"
      },
      {
        "id": 4,
        "text": "Neuritis and nerve abscesses may occur"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given scenario of <strong>painful lesions</strong> in the context of <strong>leprosy treatment</strong> is suggestive of <strong>type 1 lepra reaction</strong>, which presents with <strong>inflammation</strong> of <strong>existing skin lesions</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/25be6f7b3218410ba0b55d7989dbf5c7.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A woman presents to the dermatology OPD with the following painful lesions that developed rapidly over the course of 3 weeks. She says that she has been undergoing leprosy treatment at her local PHC for the past 8 months. What form of leprosy is her condition most commonly associated with?",
    "choices": [
      {
        "id": 1,
        "text": "Borderline borderline"
      },
      {
        "id": 2,
        "text": "Borderline tuberculoid"
      },
      {
        "id": 3,
        "text": "Borderline lepromatous"
      },
      {
        "id": 4,
        "text": "Lepromatous leprosy"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Development of&nbsp;<strong>ulcerating lesions</strong>&nbsp;following initiation of treatment for leprosy is suggestive of a<strong>&nbsp;severe type 1 lepra reaction.&nbsp;</strong>They are commonly seen in the&nbsp;<strong>borderline</strong>&nbsp;spectrum but are&nbsp;<strong>most severe</strong>&nbsp;in&nbsp;<strong>borderline lepromatous</strong>&nbsp;leprosy.</p>\n<p>Lepra 1 reactions are due to an <strong>enhanced</strong> cell-mediated <strong>immune response</strong> to <em>M.leprae. </em>They&nbsp;usually present <strong>abruptly</strong> with redness and <strong>inflammation</strong> of <strong>existing lesions</strong> but can cause ulceration in severe cases. It occurs due to a&nbsp;<strong>large amount</strong> of <em>M. leprae</em> <strong>antigens&nbsp;</strong>in these patients which results in&nbsp;prolonged and repeated reactions during treatment.&nbsp;</p>\n<p>Note: Another form of lepra reaction with ulcerating lesions is the&nbsp;<strong>Lucio reaction</strong>. It is a rare type of lepra reaction that is seen in patients with lepra bonita. It is often the initial presentation in untreated patients.&nbsp;It is common over extremities and spreads in an ascending fashion. It&nbsp;presents as tender nodules that form jagged ulcers. &nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d3df0aa43ad446e4949dfcd9a8cc24c9.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A known case of leprosy presents with the following new-onset painful lesions. Which of the statements is false about this condition?",
    "choices": [
      {
        "id": 1,
        "text": "It is more common in tuberculoid type of leprosy"
      },
      {
        "id": 2,
        "text": "It may occur after completion of treatment"
      },
      {
        "id": 3,
        "text": "Keratitis, uveitis, dactylitis and orchitis may occur"
      },
      {
        "id": 4,
        "text": "It occurs due to immune complex deposition"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given scenario of painful, erythematous nodules over the limbs in a patient with leprosy is suggestive of <strong>erythema nodosum leprosum</strong> or <strong>type 2 lepra </strong>reaction.</p>\n<p>It occurs in patients with <strong>multibacillary disease&nbsp;</strong>- lepromatous and borderline lepromatous leprosy.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/95cade4428954a9cb00e5de132a5ce4c.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A middle-aged man on treatment for lepromatous leprosy presents with the following painful lesions for one month. On examination, glove and stocking pattern of anesthesia is noted. What is the drug of choice for this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Steroids"
      },
      {
        "id": 2,
        "text": "Thalidomide"
      },
      {
        "id": 3,
        "text": "Clofazimine"
      },
      {
        "id": 4,
        "text": "Rifamipicin"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given scenario points to a diagnosis of <strong>erythema nodosum leprosum</strong> or <strong>type 2 lepra reaction</strong>. The drug of choice is<strong> oral corticosteroids.</strong></p>\n<p><strong>Clofazimine</strong> is indicated in <strong>chronic ENL,</strong>&nbsp;which is steroid-refractory or when steroids are contraindicated.</p>\n<p><strong>Thalidomide</strong> is <strong>superior</strong> to steroids in controlling ENL and can be used for severe ENL in young <strong>men.</strong> However, it is generally avoided in women due to its devastating <strong>teratogenic</strong> side effects. It may be considered in&nbsp;<strong>severe</strong> ENL but must be used cautiously, with <strong>double contraception</strong> measures. It also causes <strong>peripheral neuropathy</strong> and, hence, would be avoided in this patient with lepromatous neuropathy. The&nbsp;<strong>high cost</strong> and&nbsp;<strong>restricted availability </strong>also limit the use of this drug.&nbsp;</p>\n<p><strong>Rifampicin</strong> should be <strong>avoided</strong> as it is highly <strong>bactericidal</strong>. The massive release of bacterial antigens may <strong>aggravate</strong> the lepra reaction.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/965793aa1434467f815beda4f90e2839.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 24-year-old post-transplant patient on multidrug therapy for multibacillary leprosy now presents with painful nodules on her forearms. You start her on a single drug regimen. Which of the following is not an adverse effect of this drug?",
    "choices": [
      {
        "id": 1,
        "text": "Crystal deposits in small bowel"
      },
      {
        "id": 2,
        "text": "Ichthyosis on shins and forearms"
      },
      {
        "id": 3,
        "text": "Discolouration of skin"
      },
      {
        "id": 4,
        "text": "Crystal deposits in renal tubules"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given scenario of <strong>painful</strong> nodules in a woman with leprosy is suggestive of <strong>erythema nodosum leprosum </strong>(ENL)<strong>.</strong> The likely drug used in this <strong>immunosuppressed</strong> young woman is <strong>clofazimine</strong>, which causes deposition of <strong>crystals</strong> in the&nbsp;<strong>intestinal mucosa</strong>, liver, lymph nodes, and spleen, <strong>not renal tubules</strong>.&nbsp;</p>\n<p>Clofazimine is a brick red, fat\u2010soluble crystalline dye with a&nbsp;<strong>weak bactericidal </strong>action against <em>M. leprae</em> through an unknown mechanism. It also has an <strong>anti\u2010inflammatory effect</strong>, which is useful in the management of <strong>ENL</strong> reactions.</p>\n<p>The most noticeable side effect is <strong>skin discoloration</strong>, ranging from <strong>red to purple-black</strong>, the degree of discoloration depends on the dose and amount of leprous infiltration. It generally <strong>fades</strong> within <strong>6&ndash;12 months</strong> after stopping clofazimine, however, traces of discoloration may remain even for up to 4 years.&nbsp;Urine, sputum, and sweat may turn pink.</p>\n<p>It also produces scaling and <strong>ichthyosis</strong> of the shin and forearms.</p>\n<p><strong>Crystal</strong> <strong>deposition</strong> in the wall of the small bowel occurs as the drug is excreted into the bile. This causes GI side effects that<strong>&nbsp;</strong>range from mild cramps to <strong>diarrhea</strong> and weight loss.</p>\n<p>Note: Corticosteroids are the first-line drugs in the treatment of ENL but would be avoided in this immunosuppressed patient.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 48-year-old man is referred to the dermatology OPD with the following findings. Which of the following would not be useful in diagnosing this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Sensation testing"
      },
      {
        "id": 2,
        "text": "Skin smear"
      },
      {
        "id": 3,
        "text": "Lepromin test"
      },
      {
        "id": 4,
        "text": "Skin biopsy"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given images showing a hypopigmented lesion along with tibial nerve thickening are is suggestive of <strong>leprosy.&nbsp;</strong>Lepromin test is a&nbsp;<strong>prognostic test&nbsp;</strong>used in the classification of Leprosy. It has&nbsp;<strong>no diagnostic</strong>&nbsp;purpose.</p>\n<p>It involves performing an&nbsp;<strong>intradermal injection</strong>&nbsp;of the lepromin antigen (synthesized from&nbsp;M. leprae) on the&nbsp;<strong>flexor surface</strong>&nbsp;of the forearm. It is a skin test for&nbsp;<strong>delayed hypersensitivity,</strong>&nbsp;is the only method for studying immunity in leprosy.&nbsp;</p>\n<ul>\n<li><strong>Positive</strong> test<strong> -&nbsp;</strong><strong>good&nbsp;</strong>cell-mediated immunity and points towards the&nbsp;<strong>tuberculoid</strong>&nbsp;side of the spectrum</li>\n<li><strong>Negative</strong> test<strong> -</strong><strong>&nbsp;poor</strong>&nbsp;cell-mediated immunity and POINTS towards<strong>&nbsp;</strong>the<strong>&nbsp;lepromatous</strong>&nbsp;side of the spectrum.</li>\n</ul>\n<p>The antigens used in lepromin test are:&nbsp;</p>\n<ul>\n<li>Lepromin A (from armadillo-derived lepra bacilli)</li>\n<li>Dharmendra antigen</li>\n</ul>\n<p>First is the&nbsp;<strong>early reaction of Fernandez</strong>, which consists of&nbsp;<strong>erythema</strong>&nbsp;and&nbsp;<strong>induration</strong>&nbsp;developing in 24-48 hours and usually remaining for 3-5 days; it is usually poorly defined and carries less significance.</p>\n<p>The second and more meaningful result is the&nbsp;<strong>late reaction of Mitsuda</strong>, starting at 1-2 weeks (7-10 days), reaching a peak in three or four weeks, and gradually subsiding over the&nbsp;next few weeks. At end of 21 days, if there is a <strong>nodule&nbsp;&gt;5mm</strong> in diameter, the reaction is said to be&nbsp;<strong>positive.&nbsp;</strong></p>\n<p>The <strong>test</strong> is <strong>used</strong> for the following purposes:&nbsp;</p>\n<ul>\n<li>To&nbsp;<strong>classify</strong> the lesions of leprosy patients.&nbsp;</li>\n<li>To&nbsp;assess the <strong>prognosis</strong> and <strong>response</strong> to treatment.</li>\n<li>To&nbsp;assess the <strong>resistance</strong> of individuals to leprosy.&nbsp;</li>\n<li>To&nbsp;<strong>verify</strong> the identity of candidate lepra <strong>bacilli.</strong></li>\n</ul>\n<p>Option A: Sensory testing is useful to detect hypoesthesia and nerve involvement of leprosy.</p>\n<p>Option B: Slit skin smear shows the presence of acid-fast bacilli.&nbsp;</p>\n<p>Option D: Biopsy would reveal few tuberculoid granulomas and plenty of foam cells, which are diagnostic of leprosy.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/6082473511c8440aaf13f1eb9af7d9b4.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A man comes to the dermatology OPD with the following lesion. Further probing reveals a history of tuberculosis in his wife. Which of the following statements is false about this skin lesion?",
    "choices": [
      {
        "id": 1,
        "text": "It is a multibacillary lesion"
      },
      {
        "id": 2,
        "text": "It occurs in previously sensitised patients"
      },
      {
        "id": 3,
        "text": "Lesions heal with central scarring"
      },
      {
        "id": 4,
        "text": "It is the most common cutaneous manifestation of TB in India"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>This clinical scenario with a history of exposure to tuberculosis is suggestive of&nbsp;<strong>lupus vulgaris</strong>, which often presents as <strong>atrophic</strong> <strong>warty</strong> <strong>plaques</strong>. It is a <strong>paucibacillary&nbsp;</strong>lesion<strong>.</strong></p>\n<p>It occurs in<strong>&nbsp;previously sensitized</strong> hosts with <strong>good immunity</strong>. On histology, granulomas with scanty or absent caseation are seen.</p>\n<p>It is the<strong> most common cutaneous tuberculosis</strong> in<strong> India</strong>. In India, it commonly occurs over the&nbsp;buttocks or the&nbsp;trunk, whereas, in Europe,&nbsp;it is common over the head and neck.</p>\n<p>The lesions occur in the form of <strong>plaques</strong> with serpiginous edges or mutilating <strong>ulcers</strong>. They heal with <strong>central scarring</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/475f761133c84fea9e85c64817bb5379.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2993db4944804bbf9c9d81c5d68d0366x1280x1066.9675599435825.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0dda58a1715a4c32888431b13c4c18bcx720x1052.JPEG"
    ]
  },
  {
    "text": "Identify the drug used to treat the condition shown below:",
    "choices": [
      {
        "id": 1,
        "text": "Anti-fungal therapy"
      },
      {
        "id": 2,
        "text": "Anti-tubercular therapy"
      },
      {
        "id": 3,
        "text": "Topical steroids therapy"
      },
      {
        "id": 4,
        "text": "Anti-leprosy treatment"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>&nbsp;</p>\n<ul>\n<li><strong>Cutaneous leishmaniasis</strong> lesions have <strong>central crusting</strong> and are seen on the <strong>face</strong> in patients from areas of high leishmaniasis prevalence.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a2689f895add44b2a0db3c443ed1c72a.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d670754e1ff84670a560b4d6c01030acx1100x700.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f76e3f9a008b4177bca3fc93235f8bbex1280x1422.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7d520f373b5444a78ca3afcf1167cbd1x1280x900.JPEG"
    ]
  },
  {
    "text": "A 21-year-old man presents to the general surgery OPD with the following lesions. Which of the following statements about this condition is incorrect?",
    "choices": [
      {
        "id": 1,
        "text": "It is due to contiguous spread"
      },
      {
        "id": 2,
        "text": "Most common form of cutaneous tuberculosis in world"
      },
      {
        "id": 3,
        "text": "It can form a fungating mass"
      },
      {
        "id": 4,
        "text": "It is a paucibacillary lesion"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given image shows <strong>non-healing sinuses</strong> in the <strong>cervical</strong> region, which are a feature of <strong>scrofuloderma</strong>. It is a <strong>multibacillary </strong>manifestation of cutaneous tuberculosis.</p>\n<p>It is the <strong>most common</strong> form of cutaneous tuberculosis <strong>worldwide</strong>. However, in <strong>India</strong>, <strong>lupus vulgaris</strong> is the most common type in adults.</p>\n<p>It results from <strong>contiguous spread</strong> to the skin from an underlying tuberculous focus. The lesions evolve as follows:</p>\n<ul>\n<li>Begins as asymptomatic, <strong>bluish-red, subcutaneous swellings</strong>&nbsp;(persist for&nbsp;months)</li>\n<li>Break down to form <strong>undermined ulcers</strong></li>\n<li><strong>Proliferation</strong> of <strong>granulation tissue</strong> in ulcers forms <strong>fungating masses</strong>&nbsp;</li>\n<li>Numerous<strong> fistulae</strong> may occur, which can form <strong>draining sinuses</strong> onto the skin.</li>\n</ul>\n<p>Histology shows marked <strong>caseating necrosis</strong>, in which there are usually<strong> numerous bacteria</strong>.</p>\n<p>Spontaneous healing can occur, but the course is very <strong>protracted</strong> and leaves<strong> typical, cord\u2010like scars</strong>.</p>\n<p><strong>Antituberculous therapy</strong>&nbsp;should be commenced promptly.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/02e296db195f40c38ed56993c4a36961.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following best describes the pathogenesis of tuberculosis verrucosa cutis?",
    "choices": [
      {
        "id": 1,
        "text": "Hypersensitivity reaction to tuberculosis antigens"
      },
      {
        "id": 2,
        "text": "Hematogenous spread from primary focus"
      },
      {
        "id": 3,
        "text": "Post primary tuberculosis with poor immunity"
      },
      {
        "id": 4,
        "text": "Post primary tuberculosis with good immunity"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Tuberculosis verrucosa cutis</strong> is a form of<strong> post-primary tuberculosis </strong>that occurs in previously sensitized people with<strong> good immunity</strong>.</p>\n<p>It is also called:</p>\n<ul>\n<li>Warty tuberculosis</li>\n<li>Anatomist&rsquo;s warts</li>\n<li>Prosector&rsquo;s warts</li>\n<li>Verruca necrogenica</li>\n</ul>\n<p>It is caused by <strong>exogenous inoculation</strong> of <em>M. tuberculosis</em> into the skin through open wounds or abrasions. Due to the strong immune response, the lesion is <strong>paucibacillary. </strong>Histology shows <strong>hyperkeratosis </strong>with no granulomas.</p>\n<p>The lesions are typically asymptomatic and start as a small<strong>, indurated, warty papule </strong>which by gradual extension, form a <strong>verrucous </strong>plaque, as shown below<strong>. </strong>Irregular extension at the edges leads to a <strong>serpiginous outline </strong>with finger\u2010like projections.</p>\n<p>Management: <strong>Antitubercular</strong>&nbsp;therapy&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4ab870d30e9f4805bf3fa375aa2401f0x512x370.PNG"
    ]
  },
  {
    "text": "The skin biopsy of a 23-year-old tuberculosis patient with a long-standing skin rash showed non-caseating epithelioid granuloma around sweat glands and hair follicles. What is the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Lichen scrofulosorum"
      },
      {
        "id": 2,
        "text": "Miliary tuberculosis"
      },
      {
        "id": 3,
        "text": "Papulonecrotic tuberculid"
      },
      {
        "id": 4,
        "text": "Lupus vulgaris"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Option B: Miliary tuberculosis refers to disseminated internal tuberculosis. Histology shows caseating tuberculous granulomas with multiple acid\u2010fast bacilli.</p>\n<p>Option C: Papulonecrotic type of tuberculid occurs due to thrombosis and destruction of small dermal vessels as a result of vasculitis.</p>\n<p>Option D: Lupus vulgaris, on histology, shows tuberculous granulomas&nbsp;with&nbsp;scanty or absent caseation&nbsp;in the superficial dermis. There is no specific involvement around the hair follicles and sweat glands.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements describes the pathophysiology of erythema induratum of Bazin?",
    "choices": [
      {
        "id": 1,
        "text": "Inoculation of M. tuberculosis through trauma"
      },
      {
        "id": 2,
        "text": "Hypersensitivity reaction to M. tuberculosis"
      },
      {
        "id": 3,
        "text": "Direct contiguous spread of infection"
      },
      {
        "id": 4,
        "text": "Hematogenous spread of M. tuberculosis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Erythema induratum of Bazin</strong> is a <strong>hypersensitivity reaction</strong> due to tuberculosis.</p>\n<p>It is the <strong>most common</strong> form of <strong>tuberculid. </strong>It mostly affects middle-aged females.</p>\n<p>The pathology is granulomatous <strong>vasculitis</strong> and<strong>&nbsp;panniculitis</strong>.&nbsp;It classically presents as crops of small, tender, erythematous nodules or plaques on the calves, which may ulcerate.</p>\n<p>The following image shows plaques over the calf region:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e955cd3a816a4e649d99a944873da3c8x800x1136.JPEG"
    ]
  },
  {
    "text": "A 47-year-old woman, who cleans aquariums in a pet shop, presents with the following lesion. What is the likely causative organism?",
    "choices": [
      {
        "id": 1,
        "text": "M.avium-intercellulare"
      },
      {
        "id": 2,
        "text": "M. kansasi"
      },
      {
        "id": 3,
        "text": "M. ulcerans"
      },
      {
        "id": 4,
        "text": "M. marinum"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given image shows a <strong>fish tank granuloma</strong> or <strong>swimming pool granuloma, </strong>which is caused by <strong><em>Mycobacterium</em></strong><em> <strong>marinum</strong></em>.</p>\n<p><em>M. marinum</em> <strong>enters</strong> the body through <strong>abrasions</strong> or minor cuts on the skin, which come into contact with <strong>contaminated fresh</strong> or <strong>saltwater.</strong></p>\n<p>Skin lesions develop after an average incubation period of<strong> 2&ndash;3 weeks</strong>. The most common presentation is a <strong>nodule</strong> on the hand or arm that <strong>spreads</strong> in a <strong>sporotrichoid fashion, </strong>with a succession of nodules along the lymphatics, as shown below.<strong> Ulcers</strong> and <strong>abscesses</strong> may occur in immunocompromised patients.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/89b93b57aad44b2eaf93eb1e240710e5.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d8b93fbf78004358ac70abe607f56111x377x285.PNG"
    ]
  },
  {
    "text": "A 20-year-old Nigerian tourist presents with the following painless lesion. He had noticed a hard nodule over the same area two weeks ago in his home country, prior to coming to India. As he had no pain, he did not pay attention to the progression of the ulcer. What is the causative agent?",
    "choices": [
      {
        "id": 1,
        "text": "M. avium-intracellulare"
      },
      {
        "id": 2,
        "text": "M. ulcerans"
      },
      {
        "id": 3,
        "text": "M. kansasi"
      },
      {
        "id": 4,
        "text": "M. tuberculosis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario is that of a <strong>Buruli ulcer, </strong>which is caused by<strong> <em>Mycobacterium ulcerans</em></strong>.</p>\n<p>It is the<strong> third most common</strong> mycobacterial skin infection in immunocompetent people. It is endemic to <strong>Africa</strong> and <strong>Australia</strong>, where it affects children and elderly people. It starts as a <strong>nodule</strong> or <strong>papule</strong> which progresses further to form an extensive, <strong>necrotic ulcer</strong>, exposing muscle and tendon. Most lesions occur on the<strong> lower extremities</strong>. Healing is slow.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/bf88e25ca79b4b82a329b9c9d04597f4.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/935645a5d0794d08b75c9ca9bccafb28x1280x1103.9774330042312.JPEG"
    ]
  }
];
        let quizName = '13 Mycobacterial Infections';
        let hierarchy = ["Marrow", "qBank", "Dermatology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>