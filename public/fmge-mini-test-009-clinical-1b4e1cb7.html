<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fmge Mini Test - 009 (Clinical) - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / FMGE Mini Test Series / 2023
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">30</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A patient presents with fever and acute pain over thigh. There is  swelling in the mid thigh region. Lamellated appearance is seen on X-ray and immune-histochemical staining is positive for MIC-2. What is your diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Ewing's sarcoma"
      },
      {
        "id": 2,
        "text": "Osteosarcoma"
      },
      {
        "id": 3,
        "text": "Chondroblastoma"
      },
      {
        "id": 4,
        "text": "Multiple myeloma"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The diagnosis, in this case, is <strong>Ewing's sarcoma</strong>.</p>\n<p>A diaphyseal tumour presenting with&nbsp;fever, pain and swelling suggests Ewing's sarcoma. Classically, Ewing's sarcoma appears radiographically as a destructive lesion in the diaphysis with the lamellar <strong>\"onion skin\"</strong> periosteal reaction.&nbsp;Immunohistochemical staining for <strong>MIC-2</strong> is specific for Ewing&rsquo;s sarcoma. It has its highest incidence in <strong>second&nbsp;decade</strong> of life.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d103dbe9d2334fdc9a691ab969494831.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Blood pressure of a person on day 1 was 142/90 mm of Hg. After 2 days the blood pressure of the same person measured with the same apparatus under the same emotional and physical state of the person by different doctor reads 160/98. Which error is mainly responsible for this reading?",
    "choices": [
      {
        "id": 1,
        "text": "Subject error"
      },
      {
        "id": 2,
        "text": "Observer error"
      },
      {
        "id": 3,
        "text": "Instrument error"
      },
      {
        "id": 4,
        "text": "None of the above"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Observer errors</strong> arise due to difference in hearing acuity and interpretation of korotkoff sounds.</p>\n<p>The types of errors identified in the measurement of blood pressures:</p>\n<ul>\n<li><strong>Observer errors</strong>&nbsp;- due to difference in hearing acuity, interpretation of korotkoff sounds.</li>\n<li><strong>Instrumental errors -&nbsp;</strong>due to a leaking valve or cuffs that do not encircle the arm completely.</li>\n<li><strong>Subject errors</strong>&nbsp;- due to the anxiety, fear, etc.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 30 year old woman came to OPD with a twin pregnancy at 10 weeks of gestation. She has a 3 year old female child who was born at term and had 2 first trimester abortions previously. Which of the following is the correct representation of her obstetric score/formula. G=gravid, P= para:",
    "choices": [
      {
        "id": 1,
        "text": "G4P2L1A2"
      },
      {
        "id": 2,
        "text": "G4P1 A2 L1"
      },
      {
        "id": 3,
        "text": "G5P0 L1 A 2"
      },
      {
        "id": 4,
        "text": "G5P1 A2 L1"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The obstetric score is G4P1A2L1.</p>\n<p><strong>Gravida</strong>: Total number of pregnancies including the present one.<br /><strong>Para</strong>: Total number of pregnancies crossing the period of viability, which is 28 weeks in India.</p>\n<p>As such, a woman who delivers twins in the first pregnancy is still a gravida 1 and para 1. A pregnant woman with a previous history of 2 abortions and 1 term delivery can be expressed as 4th Gravida but primipara.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 48-year-old man working in the ship repair industry presents with a gradually progressive cough and difficulty breathing. The flow-volume curve after spirometry in the patient is given below. What is the most likely diagnosis for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Emphysema"
      },
      {
        "id": 2,
        "text": "Asthma"
      },
      {
        "id": 3,
        "text": "Asbestosis"
      },
      {
        "id": 4,
        "text": "Vocal cord paralysis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The most likely diagnosis in a 48-year-old patient working in a ship repair industry with a <strong>restrictive pattern on the flow-volume curve</strong> is <strong>asbestosis</strong>.&nbsp;Pulmonary function testing in asbestosis reveals a restrictive pattern with a decrease in both lung volumes and diffusing capacity.</p>\n<p>The flow-volume curve of the above (patient 1) shows <strong>decreased</strong>&nbsp;total lung capacity, vital capacity, and residual volume. Hence, the loop shrinks or narrows and shifts towards the right. This is seen in <strong>restrictive lung disease</strong>. Airflow is greater than normal at comparable lung volumes because the increased elastic recoil of the lungs holds the airways open.</p>\n<p>Asthma, COPD, emphysema, and endobronchial neoplasm present with&nbsp;<strong>obstructive flow patterns</strong>. Although all airflow is diminished, expiratory prolongation predominates, and mean expiratory flow&nbsp;<span class=\"symbol\">&lt;</span>&nbsp;mean inspiratory flow. The increased total lung capacity, vital capacity, and residual volume will shift the flow volume loop to left.</p>\n<p>Vocal cord paralysis&nbsp;causes a variable extrathoracic upper airway obstruction in which only the inspiratory curve would be flattened.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d49eeb4ec40f409bb628560e54ec3f18.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c428881f5716414c9319749f5d6f433cx1279x1999.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/69d8270e26fe4c25b63fd8e9f0dfd8b9x1080x925.JPEG"
    ]
  },
  {
    "text": "A 38-year-old man was brought to the emergency department after suffering a stab injury to the lower chest. On presentation, he had bradycardia and hypotension. The blood pressure has not improved despite the \u200badministration of  IV fluids. Chest radiography showed clear lung fields. What is the next step in management?",
    "choices": [
      {
        "id": 1,
        "text": "e FAST"
      },
      {
        "id": 2,
        "text": "Tube thoracostomy"
      },
      {
        "id": 3,
        "text": "CECT chest"
      },
      {
        "id": 4,
        "text": "CECT abdomen"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The next step in the management of this patient is to perform an <strong>eFast examination.</strong></p>\n<p><strong>Persistent hypotension</strong> despite initial fluid resuscitation indicates an ongoing haemorrhage. It is mostly fatal if not controlled, and the source of hemorrhage must be identified by <strong>eFast, chest</strong> and <strong>pelvic</strong>&nbsp;<strong>radiographs.&nbsp;</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient with ptosis presented with retraction of the ptotic eyelid on chewing.  What is the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Oculomotor palsy"
      },
      {
        "id": 2,
        "text": "Third nerve misdirection syndrome"
      },
      {
        "id": 3,
        "text": "Abducens palsy"
      },
      {
        "id": 4,
        "text": "Marcus Gunn jaw-winking syndrome"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>A patient with ptosis presented with retraction of the ptotic eyelid on chewing. The diagnosis is Marcus&ndash;Gunn jaw-winking phenomenon.</p>\n<ul>\n<li>About <strong>5%</strong> of all cases of <strong>congenital ptosis</strong> are associated with the Marcus&ndash;Gunn jaw-winking phenomenon.</li>\n<li>The vast majority are <strong>unilateral</strong>.</li>\n<li><strong>Etiology</strong>:<strong>&nbsp;</strong>a branch of the <strong>mandibular division</strong> of the <strong>fifth</strong> cranial nerve is <strong>misdirected</strong> to the levator muscle.</li>\n<li>Signs\n<ul>\n<li><strong>Retraction of the ptotic lid</strong> in conjunction with <strong>stimulation of the ipsilateral pterygoid muscles</strong> by <strong>chewing</strong>, <strong>sucking</strong>, opening the mouth, or contralateral jaw movement.</li>\n<li>Less common stimuli to winking include <strong>jaw protrusion</strong>, <strong>smiling</strong>, swallowing, and clenching of teeth.</li>\n<li><strong>Jaw-winking does not improve with age</strong> although patients may learn to mask it.</li>\n</ul>\n</li>\n</ul>\n<p><strong>Image</strong>:&nbsp;The woman cannot control her eyelids while drinking</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7dee4f8a38f34d9bae43f489f12a0038x466x313.PNG"
    ]
  },
  {
    "text": "An 11-year-old girl was brought by her parents with complaints of weight loss, increased appetite and a decline in scholastic performance. Following investigations, a diagnosis of Grave\u2019s disease is made. Which of the following is the drug of choice for initial therapy?",
    "choices": [
      {
        "id": 1,
        "text": "Propylthiouracil"
      },
      {
        "id": 2,
        "text": "Methimazole"
      },
      {
        "id": 3,
        "text": "Radioactive iodine"
      },
      {
        "id": 4,
        "text": "Levothyroxine"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Methimazole</strong> is the initial drug of choice for treating <strong>Grave's disease</strong> (hyperthyroidism) in children.</p>\n<p>Both methimazole and propylthiouracil are anti-thyroid drugs, but the use of <strong>propylthiouracil</strong> in children has been associated with <strong>fatal hepatotoxicity.</strong></p>\n<p>In Pregnancy,</p>\n<ul>\n<li><strong>Methimazole</strong> crosses the placenta to a greater degree than propylthiouracil and has been associated with<strong> fetal aplasia cutis</strong>.</li>\n<li><strong>Propylthiouracil </strong>should be used in the<strong> first trimester,</strong> and then, maternal therapy should be converted to methimazole (or carbimazole).</li>\n</ul>\n<p>&nbsp;Other options:</p>\n<ul>\n<li>Radioactive iodine is not preferred as the first-line treatment in hyperthyroidism for children.</li>\n<li>Levothyroxine is used to treat hypothyroidism.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 50-year-old male was diagnosed with a submandibular gland tumour and underwent  removal of the tumour following which lingual nerve was found to be damaged. Which of the following statements are not correct?",
    "choices": [
      {
        "id": 1,
        "text": "Sublingual glands secretion reduced"
      },
      {
        "id": 2,
        "text": "Sensation of floor of mouth lost"
      },
      {
        "id": 3,
        "text": "Sensation of anterior two-third of tongue lost"
      },
      {
        "id": 4,
        "text": "Sensation of posterior one-third of tongue lost"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Sensation of<strong> posterior 1/3rd of tongue</strong> is carried by the <strong>Glossopharngeal nerve</strong> and hence this statement is incorrect.</p>\n<p>In the<strong> anterior</strong> <strong>two-thirds</strong> of the tongue,</p>\n<ul>\n<li>General sensation is carried by the <strong>lingual nerve</strong>.</li>\n<li>Taste sensation is carried by <strong>chorda tympani</strong> branch of the facial nerve.</li>\n</ul>\n<p>In the <strong>posterior one-third</strong> of the tongue,</p>\n<ul>\n<li>Both general and taste sensations are carried by the <strong>glossopharyngeal&nbsp;nerve.</strong></li>\n</ul>\n<p>Valleculae (portion between anterior 2/3rd and posterior 1/3rd of the tongue) is supplied by the internal laryngeal branch of the <strong>vagus</strong> nerve.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/df01af91445a4c84a365d0c92b53e55cx461x419.PNG"
    ]
  },
  {
    "text": "A patient presents with pruritic hypopigmented macules and confluent patches over the chest as seen in the image. On KOH mount, spaghetti and meatballs appearance is noted. Identify the condition.",
    "choices": [
      {
        "id": 1,
        "text": "Tinea cruris"
      },
      {
        "id": 2,
        "text": "Tinea capitis"
      },
      {
        "id": 3,
        "text": "Tinea corporis"
      },
      {
        "id": 4,
        "text": "Tinea versicolor"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The characteristic appearance of<strong> &lsquo;spaghetti and meatballs&rsquo;</strong> or<strong> &lsquo;bananas and grapes' </strong>on<strong> KOH mount and microscopy </strong>(shown below)<strong>&nbsp;</strong>is suggestive of<strong>&nbsp;tinea versicolor or pityriasis versicolor.&nbsp;</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/0d3774c058a545b6985af41cdd579e46.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d6333eebee9f41bab0fb1e5814bf807ax720x484.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/150d22320a0d403ba4789449dcecfef1x1280x960.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/679fdc0e5eba4f3dbb927fa7804bd4b9x720x960.JPEG"
    ]
  },
  {
    "text": "A  pregnant woman in her 7th week comes to your clinic complaining of irritation and profuse greenish frothy discharge from her vagina. Which of the following can be used to treat her condition?",
    "choices": [
      {
        "id": 1,
        "text": "Topical Clotrimazole"
      },
      {
        "id": 2,
        "text": "Vinegar douche"
      },
      {
        "id": 3,
        "text": "Tab. Cotrimoxazole"
      },
      {
        "id": 4,
        "text": "I.V. Azithromycin"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Vinegar douching can be done safely in pregnancy, to treat Trichomoniasis</strong>.</p>\n<p><em>T. vaginalis</em>\u00a0infection in pregnant women is associated with adverse pregnancy outcomes like<strong> premature rupture of membranes</strong>, <strong>preterm delivery</strong>, and\u00a0<strong>low birthweight infant</strong>.</p>\n<p>\u00a0The treatment options include:</p>\n<ul>\n<li>An oral dose of metronidazole 500 mg twice daily for 7 days or single oral dose of metronidazole 2 g \u00a0</li>\n<li>Vinegar douche to lower the vaginal PH</li>\n<li>Trichofuran suppositories</li>\n<li>Betadine gel</li>\n</ul>\n<p>The <strong>male partner</strong> should be treated with a <strong>single dose of oral metronidazole </strong>in case of r<strong>ecurrent infection.</strong></p>\n<p>\u00a0</p>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A vibrating tuning fork is placed on the mastoid while the examiner alternately closes and opens the ear canal by pressing on the tragus inwards. A normal person or one with sensorineural hearing loss hears louder when ear canal is occluded and softer when the canal is open. This test is known as:",
    "choices": [
      {
        "id": 1,
        "text": "Absolute bone conduction test"
      },
      {
        "id": 2,
        "text": "Schwabach test"
      },
      {
        "id": 3,
        "text": "Bing test"
      },
      {
        "id": 4,
        "text": "Gille\u2019s test"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given test is <strong>Bing test.</strong></p>\n<p>It is a <strong>test of bone conduction</strong> and examines the <strong>effect of </strong><strong>occlusion of ear canal on the hearing.&nbsp;&nbsp;</strong>A vibrating tuning fork is placed on the mastoid while the examiner alternately closes and opens the ear canal by pressing on the tragus inwards. A normal person or one with sensorineural hearing loss hears louder when the ear canal is occluded and softer when the canal is open (Bing positive). A patient with conductive hearing loss will appreciate no change (Bing negative).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Post-coital test was performed in a couple who presented with inability to conceive in spite of staying together for 4 years and having unprotected intercourse. This test can detect all of the following, except?",
    "choices": [
      {
        "id": 1,
        "text": "Fallopian tube block"
      },
      {
        "id": 2,
        "text": "Cervical factor abnormality"
      },
      {
        "id": 3,
        "text": "Sperm count"
      },
      {
        "id": 4,
        "text": "Sperm abnormality"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The post-coital test is not useful to detect fallopian tube block.</p>\n<p><strong>Post-coital test (Sims&rsquo; or Huhner&rsquo;s test):</strong></p>\n<ul>\n<li>The couple is advised intercourse close to the ovulation time, preferably in the early hours of the morning. The woman presents herself at the clinic within 2 h after the intercourse. The mucus is aspirated from the cervical canal and spread over a glass slide.</li>\n<li>Another smear made from the posterior fornix serves as a control. Normally 10&ndash;50 motile sperms are seen per high-power field in cervical mucus.</li>\n<li>The cervical mucus is simultaneously examined for its quantity, viscosity, and fern test.</li>\n</ul>\n<p>The advantage of this test is that the cervical mucus can be simultaneously studied for <strong>oestrogenic effect and ovulation, its capability to allow sperm penetration, and presence of any anti-sperm antibodies</strong>. The test is useless in the presence of cervical infection, which should be treated before performing the post-coital test.</p>\n<p>Immunological factor is encountered in 5% cases.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 30-year-old woman who is in her 12th week of gestation was referred to you by an obstetrician for sonographic evaluation. You notice the following sign on USG. What is the sign and the significance of the sign that is demonstrated in this image?",
    "choices": [
      {
        "id": 1,
        "text": "T-sign, monochorionic diamniotic"
      },
      {
        "id": 2,
        "text": "T-sign, dichorionic diamniotic"
      },
      {
        "id": 3,
        "text": "Lambda sign, monochorionic diamniotic"
      },
      {
        "id": 4,
        "text": "Lambda sign, dichorionic diamniotic"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The image shows the<strong> lambda sign</strong> or <strong>twin peak sign</strong> seen in <strong>dichorionic diamniotic pregnancy</strong>.</p>\n<p>Chorionicity of the placenta is best diagnosed by ultrasound at 10&ndash;13 weeks of gestation. In dichorionic twins, there is a thick septum between the two gestational sacs.</p>\n<p>A triangular projection is seen at the base of the membrane. This is known as lambda or twin peak sign. The presence of <strong>lambda or twin peak sign indicates a dichorionic placenta</strong>.</p>\n<p>Note: <strong>\"T sign\"</strong> is the sonographic image seen in a <strong>monochorionic twin</strong> pregnancy. It refers to the lack of chorion extending between the layers of the intertwin membrane.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/7c32b70ff6424a8ea4ede79efb1b7771.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A patient operated for direct inguinal hernia developed sensory loss at the root of penis and adjacent part of scrotum. The nerve most likely to have been injured is ________.",
    "choices": [
      {
        "id": 1,
        "text": "Ilioinguinal nerve"
      },
      {
        "id": 2,
        "text": "Iliohypogastric nerve"
      },
      {
        "id": 3,
        "text": "Genital branch of genitofemoral nerve"
      },
      {
        "id": 4,
        "text": "Femoral branch of genitofemoral nerve"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p style=\"text-align: left;\"><strong>Loss of sensation</strong> in the <strong>root of the penis and adjacent part of the scrotum</strong> is suggestive of an injury to the <strong>ilioinguinal nerve.</strong> It is most commonly injured within the inguinal canal in open hernia repair due to traction or thermal injury.</p>\n<p style=\"text-align: left;\"><strong>Injury to genital branch of the genitofemoral nerve&nbsp;</strong>results in loss of sensation in the skin of <strong>scrotum</strong> of males, and loss of sensation of the <strong>mons pubis and labia majora</strong> in females.&nbsp;</p>\n<p style=\"text-align: left;\">The <strong>iliohypogastric nerve</strong> carries the sensory supply from the <strong>suprapubic area.</strong> Injury to this nerve within the inguinal canal rarely causes sensory disturbances, as the suprapubic area has a rich nerve supply from other sources too. If the <strong>nerve is severed</strong> above the <strong>anterior superior iliac spine,</strong> it can lead to the&nbsp;<strong>weakened posterior wall</strong> of the inguinal canal resulting in <strong>direct inguinal hernia</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The lung function of a patient is tested using a spirometer, and the following recording is noted. The technician looks at the graph and enters the following values in the report.",
    "choices": [
      {
        "id": 1,
        "text": "2, 4, and 6"
      },
      {
        "id": 2,
        "text": "1, 2, and 5"
      },
      {
        "id": 3,
        "text": "3, and 5"
      },
      {
        "id": 4,
        "text": "2, 3, 5, and 6"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The technician has recorded <strong>inspiratory reserve volume</strong>,<strong> inspiratory capacity,</strong> and <strong>vital capacity wrongly.</strong></p>\n<p>In the above graph,&nbsp;</p>\n<p><strong>Tidal volume</strong> (TV) is the amount of air that moves into the lungs with each inspiration or the amount of air that moves out with each expiration during <strong>quiet breathing</strong>. In this patient it is <strong>0.5L</strong>. The normal values are 500-750 mL.</p>\n<p><strong>Inspiratory reserve volume (IRV)</strong> is the air inspired with a maximal inspiratory effort in excess of the tidal volume. In this patient, it is 6-3L = <strong>3L.</strong> The normal values are around 2L.</p>\n<p><strong>Expiratory reserve volume</strong>&nbsp;(ERV) is the volume expelled by an active expiratory effort after passive expiration. In this patient it is 2.5-1.5 = <strong>1L.</strong> The normal value is around 1L.</p>\n<p><strong>Inspiratory capacity (IC)</strong> is the maximum amount of air inspired from the end-expiratory level. It can be calculated as TV+IRV which is 0.5L + 3L= <strong>3.5L.</strong> The normal value is around 2.5L.</p>\n<p><strong>Expiratory capacity (EC)</strong> is the maximum amount of air expired after a normal inspiration. It is calculated as TV+ERV, which is 0.5L + 1L = <strong>1.5 L.</strong> Normal value is around 1.5L</p>\n<p><strong>Vital capacity (VC</strong>) refers to the maximum amount of air expired after full inspiration. It is calculated as TV+IRV+ERV. In this patient it is 0.5+ 3+1 =<strong>4.5L.</strong> The normal value is around 3.5L.</p>\n<p>Other important lung values:</p>\n<div class=\"page\" title=\"Page 1431\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>The forced vital capacity (FVC)</strong>, is the largest amount of air that can be expired after a maximal inspiratory effort.</p>\n<div class=\"page\" title=\"Page 1431\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Forced expiratory volume in the first second, <strong>FEV1,</strong> is the fraction of the vital capacity expired during the first second.&nbsp;</p>\n<p><strong>Respiratory minute volume (RVV)</strong>&nbsp;is a measurement of the amount of air that enters the lungs per minute. It is calculated as respiratory rate X tidal volume.</p>\n<p><strong>Maximal voluntary respiration (MVV),</strong> is the largest volume of gas that can be moved into and out of the lungs in 1 min by voluntary effort.</p>\n<p><strong>Total lung capacity</strong> is the total volume of the lung. It can be calculated by adding tidal volume, inspiratory reserve volume, expiratory reserve volume, and residual volume. Normal total lung capacity is around 5L.</p>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/9597eeda2b1b4f05b652ce2b7dbd7fcf.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a648030646e348bfb9e250e86056a8c3x1280x1058.JPEG"
    ]
  },
  {
    "text": "A 35-year-old model with a history of binge eating followed by self-induced vomiting; BMI is 23. What is your diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Anorexia Nervosa"
      },
      {
        "id": 2,
        "text": "Bulimia Nervosa"
      },
      {
        "id": 3,
        "text": "Binge-eating disorder"
      },
      {
        "id": 4,
        "text": "Purging disorder"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical history of<strong> binge</strong> <strong>eating </strong>followed by <strong>self-induced vomiting&nbsp;</strong>with <strong>normal weight</strong> is suggestive of bulimia nervosa.</p>\n<p>Bulimia can be differentiated from anorexia nervosa by the below features:</p>\n<ul>\n<li>The <strong>body weight is within the normal</strong> range.</li>\n<li>Bulimia is seen in&nbsp;<strong>older age groups </strong>(late adolescents or adults).</li>\n<li>Any peculiar eating habit (like dividing food into small portions) is not seen.</li>\n<li>Amenorrhoea is not common.</li>\n<li>Psychiatric symptoms such as <strong>depression</strong> are <strong>more</strong>&nbsp;<strong>common</strong>.</li>\n</ul>\n<p>Treatment of bulimia nervosa:</p>\n<ul>\n<li>Without comorbid mood disorders: Fluoxetine, topiramate, CBT</li>\n<li>With comorbid mood disorders: Carbamazepine</li>\n</ul>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 6-month-old infant with abdominal distension, fever, and jaundice was brought to the pediatric outpatient department. Urine examination revealed a boiled cabbage odor. What is the likely disorder?",
    "choices": [
      {
        "id": 1,
        "text": "Hepatorenal tyrosinemia"
      },
      {
        "id": 2,
        "text": "Richner-Hanhart syndrome"
      },
      {
        "id": 3,
        "text": "Neonatal tyrosinemia"
      },
      {
        "id": 4,
        "text": "Hawkinsinuria"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The diagnosis based on the given clinical scenario and the boiled cabbage odor on urine examination is <strong>hepatorenal tyrosinemia</strong>.&nbsp;</p>\n<p>There are three types of <strong>tyrosinemias</strong>:</p>\n<ul>\n<li><strong>Type 1 tyrosinemia</strong> also known as hepatorenal tyrosinemia is an&nbsp;<strong>autosomal recessive</strong> condition. The defective enzyme is<strong>&nbsp;fumaryl acetoacetate hydrolase.&nbsp;</strong>Clinical features are liver failure, hypoglycemia, boiled cabbage odor in the urine, and mental retardation.&nbsp;</li>\n<li>Type 2 is known as <strong>oculocutaneous tyrosinemia</strong> or <strong>Richner-Hanhart syndrome. </strong>The defective enzyme is <strong>tyrosine transaminase.&nbsp;</strong>Clinical features are <strong>palmoplantar keratosis</strong>, painful corneal erosions, photophobia, and mental retardation.</li>\n<li>Type 3 is known as <strong>neonatal tyrosinemia. </strong>It is due to the deficiency of&nbsp;<strong>4-Hydroxyphenylpyruvate hydroxylase.&nbsp;</strong>Clinical features include normal liver function, developmental delay, seizures, and intermittent ataxia.</li>\n</ul>\n<p>Hawkinsinuria is an <strong>autosomal</strong> <strong>dominant</strong>&nbsp;condition. It is due to the dysfunction of&nbsp;<strong>4-Hydroxyphenylpyruvate oxidase.&nbsp;</strong>Clinical features are failure to thrive and metabolic acidosis in infancy.</p>\n<p>Note:&nbsp;Boiled cabbage odor can also be found in cases of&nbsp;<strong>hypermethioninemia.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 50-year-old smoker and hypertensive male, complaints of exertional angina. He says it occurs almost daily now, from a very long time. ECG shows ST depression. On cardiac evaluation, there is no increase in the levels of cardiac biomarkers. What could be the most probable diagnosis of the patient?",
    "choices": [
      {
        "id": 1,
        "text": "NSTEMI"
      },
      {
        "id": 2,
        "text": "STEMI"
      },
      {
        "id": 3,
        "text": "Left heart failure"
      },
      {
        "id": 4,
        "text": "Unstable angina"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The most probable diagnosis is <strong>unstable angina.</strong></p>\n<p><strong>Unstable angina</strong> is chest discomfort or pain due to <strong>insufficient blood flow</strong> and <strong>oxygen</strong> to the heart. It occurs due to the development of the <strong>thrombus</strong> on a pre-existing disrupted atherosclerotic plaque and is non-occlusive. The patients develop chest pain radiating to the jaws or arms and shortness of breath.\u00a0</p>\n<p>An electrocardiogram may show <strong>hyperacute T-wave</strong>, T-wave flattening, <strong>inverted T-waves,</strong> and <strong>ST depression</strong> in unstable angina. Unstable angina is diagnosed in patients with symptoms suggestive of <strong>acute coronary syndrome</strong> with <strong>no elevation</strong> of <strong>cardiac biomarkers</strong>.<strong>\u00a0</strong>If cardiac biomarkers are elevated in these patients, then the diagnosis of <strong>myocardial infarction</strong> is considered.</p>\n<p><strong>Acute coronary syndromes</strong> (ACS) include:</p>\n<ul>\n<li>Unstable angina(UA).</li>\n<li>Non-ST elevation myocardial infarction(NSTEMI).</li>\n<li>ST-elevation myocardial infarction (STEMI).</li>\n</ul>\n<p>Other options:</p>\n<p>Option A: <strong>NSTEMI</strong> is one of the components of ACS in which there are <strong>ST-segment depression</strong> and deep <strong>T-wave inversions.</strong> The cardiac biomarkers are<strong> elevated</strong> in NSTEMI unlike in unstable angina.</p>\n<p>Option B: <strong>STEMI</strong> is one of the components of ACS in which there is <strong>ST-segment elevation</strong> with T-wave changes. The cardiac biomarkers are <strong>elevated</strong> in STEMI.</p>\n<p>Option C: <strong>Left heart failure</strong> results due to dysfunction of the <strong>left ventricle</strong>, leading to insufficient delivery of blood to vital organs. The electrocardiogram shows non-specific ischemic changes,<strong> left ventricle hypertrophy</strong> or arrhythmias. The cardiac biomarker like<strong> brain natriuretic peptide</strong> may be<strong> elevated</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An elderly woman with hypothyroidism was found dead, and it appeared as if she had hid herself in her wardrobe. Which of the following most likely explains her scenario?",
    "choices": [
      {
        "id": 1,
        "text": "Homicidal death"
      },
      {
        "id": 2,
        "text": "Terminal burrowing behaviour"
      },
      {
        "id": 3,
        "text": "Paradoxical undressing"
      },
      {
        "id": 4,
        "text": "Sudden cardiac death"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Among the options, the most likely explanation is <strong>terminal burrowing behaviour</strong> or <strong>hide and die syndrome</strong>.&nbsp;</p>\n<p>An elderly lady with hypothyroidism is the ideal candidate to develop hypothermia. About 20% of hypothermia cases are associated with terminal burrowing behaviour. In some cases the bodies were found in strange situations, i.e. lying under a bed, behind a wardrobe, or in a shelf, etc. indicating that the final positions were a kind of self-protective burrowing-like behaviour.</p>\n<ul>\n<li>This terminal burrowing behaviour only occurs in 20% of cases of death due to hypothermia.</li>\n<li>The pathophysiology of this behaviour is not yet understood, but the current hypothesis is that it is a primitive response pattern of the brainstem.&nbsp;</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A three and a half year old child comes to the PHC completely unimmunised. Which of the following vaccines can be given to the child now?",
    "choices": [
      {
        "id": 1,
        "text": "DPT-1, OPV-1  and Vit A"
      },
      {
        "id": 2,
        "text": "DT-1, OPV-1, Measles, Vit A"
      },
      {
        "id": 3,
        "text": "DPT-1, OPV-1, Measles, Vit A"
      },
      {
        "id": 4,
        "text": "BCG, DPT-1, OPV-1, Measles, Vit A"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>DPT-1, OPV-1, Measles, Vit A</strong> will be given to this child of 3.5 years of age in his first immunisation visit.</p>\n<p>BCG can only be given up to 1 year of age, according to the National Immunisation Schedule.&nbsp;</p>\n<p>Please note that BCG can be given up to 5 years of age, as part of the catch up immunisation schedule which is by the Indian Academy of Paediatrics and that is not followed in government setups.</p>\n<p><strong>OPV</strong> can be given<strong> till 5 years</strong> of age.</p>\n<p><strong>Measles</strong> can be given <strong>till 5 years</strong> of age.</p>\n<p><strong>DPT</strong> can be given<strong> until 7 years</strong> of age (with booster doses).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A screening test was carried out among 114 people of which 15 had the disease. 22  people tested positive for the disease among which 14 had the disease. What is the sensitivity of the test?",
    "choices": [
      {
        "id": 1,
        "text": "37%"
      },
      {
        "id": 2,
        "text": "63%"
      },
      {
        "id": 3,
        "text": "93%"
      },
      {
        "id": 4,
        "text": "100%"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In this scenario:</p>\n<ul>\n<li>The total number of subjects is 114</li>\n<li>Of the 114 subjects, 15 had the disease( Total disease)\u00a0</li>\n<li>22 tested positive meaning total subjects with test positive</li>\n<li>Only <strong>14</strong> of the 22 had disease meaning <strong>true positives</strong>. This leaves 8 subjects as false positives.\u00a0</li>\n<li>Of the 15 who had disease, 14 tested positive implying only <strong>1 </strong>subject was <strong>false negative</strong>.\u00a0</li>\n</ul>\n<table>\n<tbody>\n<tr>\n<td width=\"127\">\n<p>\u00a0</p>\n</td>\n<td width=\"136\">\n<p><strong>Disease +</strong></p>\n</td>\n<td width=\"119\">\n<p><strong>Disease -</strong></p>\n</td>\n<td width=\"136\">\n<p><strong>Total</strong></p>\n</td>\n</tr>\n<tr>\n<td width=\"127\">\n<p><strong>Test +</strong></p>\n</td>\n<td width=\"136\">\n<p>14 (TP)</p>\n</td>\n<td width=\"119\">\n<p>8 (FP)</p>\n</td>\n<td width=\"136\">\n<p>22</p>\n</td>\n</tr>\n<tr>\n<td width=\"127\">\n<p><strong>Test -</strong></p>\n</td>\n<td width=\"136\">\n<p>1 (FN)</p>\n</td>\n<td width=\"119\">\n<p>91 (TN)</p>\n</td>\n<td width=\"136\">\n<p>92</p>\n</td>\n</tr>\n<tr>\n<td width=\"127\">\n<p><strong>Total</strong></p>\n</td>\n<td width=\"136\">\n<p>15</p>\n</td>\n<td width=\"119\">\n<p>99</p>\n</td>\n<td width=\"136\">\n<p>114</p>\n</td>\n</tr>\n</tbody>\n</table>\n<p>Sensitivity is given as <strong>TP/(TP + FN) x 100\u00a0</strong>= 14/(14+1)= 14/15</p>\n<p>Thus, sensitivity is 93.3%.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An 8-year-old boy with progressive muscle weakness and walking difficulties is presented with the following finding. Dystrophin gene mutation was found to be present. The given clinical condition is associated with what chromosome?",
    "choices": [
      {
        "id": 1,
        "text": "X"
      },
      {
        "id": 2,
        "text": "Y"
      },
      {
        "id": 3,
        "text": "21"
      },
      {
        "id": 4,
        "text": "22"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical picture and the image showing pseudohypertrophy of calf muscles is highly suggestive of<strong> Duchenne muscular dystrophy </strong>and it is associated with<strong> chromosome X.</strong></p>\n<p><strong>Muscle Dystrophy:</strong></p>\n<p>Duchenne and Becker muscular dystrophy are caused by loss-of-function mutations in the<strong> dystrophin gene on the X chromosome</strong>. Dystrophin is one of the <strong>largest human genes</strong>. Dystrophin is thought to provide mechanical stability to the myofiber and its cell membrane during muscle contraction. Defects in the complex may lead to small membrane tears that permit the influx of calcium, triggering events that result in myofiber degeneration.</p>\n<p>Duchenne muscular dystrophy is typically associated with <strong>deletions or frame-shift mutations</strong> that result in the <strong>total absence of dystrophin.&nbsp;</strong>In contrast, the mutations in Becker muscular dystrophy typically permit the synthesis of a <strong>truncated version of dystrophin, which presumably retains some function.&nbsp;</strong>Immunohistochemical studies for dystrophin show the absence of the normal sarcolemmal staining pattern in Duchenne muscular dystrophy and reduced staining in Becker muscular dystrophy.</p>\n<p><strong>Definitive therapy</strong> requires the restoration of dystrophin levels in skeletal and cardiac muscle fibers.</p>\n<ul>\n<li>One approach involves the expression of antisense RNAs that alter RNA splicing so as to cause the&nbsp;<strong>&ldquo;skipping&rdquo; of exons</strong> containing deleterious mutations, thus permitting the expression of a truncated, but partially functional, dystrophin protein.</li>\n<li>A second strategy is exploring the use of drugs that <strong>promote ribosomal &ldquo;read-through&rdquo; of stop codons</strong>, another ploy that may enable the expression of some dystrophin protein.</li>\n<li>Both of these approaches are mutation-specific and thus need to be tailored to individual patients.</li>\n<li><strong>Gene therapy</strong> (introduction of a normal dystrophin gene) is under investigation.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/6eac8e3387d842d581d944e55f328620.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "An elderly patient with ventricular tachycardia has been started on amiodarone. Which of the following is the most important adverse event associated with this drug's use?",
    "choices": [
      {
        "id": 1,
        "text": "Pulmonary fibrosis"
      },
      {
        "id": 2,
        "text": "Central nervous system toxicity"
      },
      {
        "id": 3,
        "text": "Renal dysfunction"
      },
      {
        "id": 4,
        "text": "Ototoxicity"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The most important adverse event associated with the use of amiodarone is <strong>pulmonary fibrosis.\u00a0</strong></p>\n<p>Amiodarone is a <strong>class three anti-arrhythmic</strong> that is primarily used in the treatment of <strong>supraventricular arrhythmias</strong>, <strong>ventricular tachycardia</strong> and <strong>ventricular fibrillation</strong>.</p>\n<p>Pulmonary fibrosis is usually seen in patients who take <strong>prolonged</strong> courses of amiodarone and in<strong> high doses.</strong></p>\n<p>Pulmonary fibrosis can be potentially <strong>life-threatening</strong> and requires immediate discontinuation of the amiodarone and initiation of <strong>high-dose corticosteroids.</strong></p>\n<p>Other adverse events associated with amiodarone use are nausea, photosensitivity, corneal microdeposits and thyroid dysfunction.</p>\n<p>Other options:</p>\n<p>Option B: <strong>Central nervous system toxicity.\u00a0</strong>There are no significant central nervous system-related adverse events. In a minority of patients, peripheral neuropathy presenting as shoulder and pelvic muscle weakness is seen.</p>\n<p>Option C: <strong>Renal dysfunction</strong>\u00a0is not seen with Amiodarone since it is hepatically cleared.</p>\n<p>Option D: <strong>Ototoxicity</strong> is associated with prolonged aminoglycoside use and is not a feature of amiodarone toxicity.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A woman diagnosed with DCIS underwent surgery and is now posted for adjuvant radiotherapy with external beam radiotherapy. Which of the following isotopes is commonly used for the same?",
    "choices": [
      {
        "id": 1,
        "text": "Cobalt-59"
      },
      {
        "id": 2,
        "text": "Cobalt -60"
      },
      {
        "id": 3,
        "text": "Radium-226"
      },
      {
        "id": 4,
        "text": "Strontium-89"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Cobalt-60</strong> isotope is used for <strong>external beam radiotherapy</strong> (EBRT).</p>\n<p>External beam radiotherapy is given as follows:</p>\n<ul>\n<li>Cobalt machine - Co-60 produces gamma rays. It emits radiation of energy 1.25 MeV.</li>\n<li>LINAC (linear accelator) - X-ray beams are generated to provide ionising radiation.</li>\n</ul>\n<p>The energy spectrum used in radiotehrapy is classified as follows:</p>\n<ul>\n<li>Orthovoltage - 200-500kV x-rays are produced. It is used to treat skin conditions.&nbsp;</li>\n<li>Megavoltage - 1-25 MV x-rays are produced. These are used in modern radiotherapy.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Examination of a young man reveals a firm enlargement of the epididymis with normal-feeling testes and beading of the vas deferens. What is the next best step in management?",
    "choices": [
      {
        "id": 1,
        "text": "Anti-tubercular chemotherapy if a primary focus is found, with epididymectomy"
      },
      {
        "id": 2,
        "text": "Confirmation of genital TB with PCR"
      },
      {
        "id": 3,
        "text": "Epididymectomy only"
      },
      {
        "id": 4,
        "text": "Antitubercular therapy with follow-up"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In the clinical scenario above, the presence of a <strong>firm enlargement of the epididymis with normal-feeling testes and beading of the vas deferens</strong> is specific to genital tuberculosis (TB). The next best step is confirmation with polymerase chain reaction (<strong>PCR</strong>).&nbsp;</p>\n<p class=\"p1\">Secondary tuberculous epididymitis may resolve when the primary focus is treated; hence, a course of <strong>anti-tubercular therapy must be completed&nbsp;</strong>even if there is no evidence of disease elsewhere.</p>\n<p class=\"p1\">&nbsp;</p>\n<p class=\"p1\">&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient with thyrotoxicosis is being prepared for surgery. Which of the following statements regarding the pre-operative preparation of this patient is wrong?",
    "choices": [
      {
        "id": 1,
        "text": "Iodine may be given pre-operatively with Carbimazole"
      },
      {
        "id": 2,
        "text": "Beta blockers administered pre-operatively must be continued post operatively"
      },
      {
        "id": 3,
        "text": "Nadolol is given in a once daily regimen pre-operatively"
      },
      {
        "id": 4,
        "text": "The last dose of Carbimazole must be given 24 hours before surgery"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The <strong>last dose</strong> of carbimazole may be given the <strong>evening before surgery</strong>. Beta-blockers, however, if used preoperatively must be given on the morning of surgery as well, and be continued for 1-week post-op.\u00a0</p>\n<p>Traditional preparation of a thyrotoxic patient aims to make the patient <strong>biochemically euthyroid</strong>. There are 2 methods of preparation that can be used.\u00a0</p>\n<ul>\n<li><strong>Carbimazole 30-40 mg</strong> per day is the drug of choice. When euthyroid (after 8-12 weeks), the dose may be reduced or a block and replace regimen may be used. In the latter case, the patient is supplemented with 0.1-0.15 mg of Thyroxine.\u00a0</li>\n<li>An alternative method is to abolish the clinical manifestations using beta-blockade, which acts on the target organs and not the gland itself. The appropriate doses are <strong>Propranolol 40 mg TDS</strong> or a longer-acting nadolol 160 mg once daily. It is important to continue treatment upto 7 days post-operatively as beta-blockers do not interfere with the synthesis of hormones and hormone levels may remain high for some days post Thyroidectomy.\u00a0</li>\n</ul>\n<p>Iodine may be given with Carbimazole or a beta-blocker 10 days before the operation. Iodine produces transient remission if given alone and reduces vascularity, increasing the margin of safety. However, its use is not universal as there are more effective regimens.\u00a0If Beta-blockers are mistakenly omitted on the morning of surgery, Iodides serve as an extra measure of safety.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 30-year-old female patient presents with episodic headaches, sweating, and palpitations. Her blood pressure was recorded as 167/110 mmHg and lab investigations revealed elevated plasma metanephrines. An adrenal mass was seen on an abdominal CT scan and a biopsy confirms the diagnosis. Which clinical feature would you not expect to see in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Weight loss"
      },
      {
        "id": 2,
        "text": "Pallor"
      },
      {
        "id": 3,
        "text": "Abdominal pain"
      },
      {
        "id": 4,
        "text": "Oliguria"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The clinical vignette with a patient having the given symptoms with elevated plasma metanephrines, and an adrenal mass is suggestive of a diagnosis of <strong>pheochromocytoma</strong>. <strong>Polyuria </strong>(not oliguria)&nbsp;is an expected clinical finding.</p>\n<p><strong>Pheochromocytoma</strong>&nbsp;is a catecholamine-secreting tumor derived from the chromaffin cells of the adrenal medulla.&nbsp;</p>\n<p>Clinical features of pheochromocytoma are due to the&nbsp;autonomic effects of excess epinephrine and norepinephrine.&nbsp;</p>\n<ul>\n<li><strong>Weight loss </strong>(option A) is due to<strong>&nbsp;</strong>the increase in catecholamines which increase basal metabolism.</li>\n<li><strong>Pallor</strong> (option B) is due to alpha 1-mediated vasoconstriction.&nbsp;</li>\n<li><strong>Abdominal pain</strong> (option C) with nausea and vomiting is commonly seen.</li>\n</ul>\n<p>Diagnosis of pheochromocytoma requires biochemical testing followed by imaging.</p>\n<ul>\n<li><strong>Urinary and plasma levels</strong>&nbsp;of&nbsp;<strong>catecholamines and metanephrines</strong>&nbsp;</li>\n<li><strong>MRI</strong>&nbsp;is the&nbsp;<strong>investigation of choice</strong>&nbsp;for localizing the tumor&nbsp;</li>\n<li><strong>MIBG Scintigraphy</strong>&nbsp;and&nbsp;<strong>PET</strong>&nbsp;Scans like&nbsp;<strong>Ga- DOTATE</strong>,&nbsp;<strong>DOPA-</strong>&nbsp;or&nbsp;<strong>FDG- PET</strong>&nbsp;can be used for extra-adrenal tumors and metastases</li>\n</ul>\n<p>Treatment of pheochromocytoma:</p>\n<p><strong>Surgical resection</strong>&nbsp;of the tumor is the definitive treatment. Preoperatively, an&nbsp;<strong>alpha-receptor blocker </strong>(phenoxybenzamine)<strong> is given to control the effects produced by excess catecholamines.&nbsp;</strong><strong>Beta-blockers</strong>&nbsp;are used&nbsp;<strong>to control tachycardia</strong>&nbsp;after adequate&nbsp;alpha blockade<strong>&nbsp;</strong>is achieved. This is to prevent&nbsp;<strong>unrestricted alpha-mediated vasoconstriction</strong>. Following surgery,&nbsp;<strong>lifelong yearly follow-ups</strong>&nbsp;should be done.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 28-year-old man with a history of recurrent headaches comes to the OPD with an acute episode of headache lasting for less than 30 minutes with redness and watering in one eye. Which of the following is not used in the treatment of an acute episode in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Verapamil"
      },
      {
        "id": 2,
        "text": "Nasal Sumatriptan"
      },
      {
        "id": 3,
        "text": "Sumatriptan subcutaneous"
      },
      {
        "id": 4,
        "text": "100% O2"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>In the given scenario, the patient is most likely suffering from <strong>cluster headaches</strong>.<strong> Verapamil</strong> is not used&nbsp;for the treatment of acute episodes, but as the first-line <strong>preventive treatment</strong> for cluster headaches.</p>\n<p><strong>Cluster headache</strong>&nbsp;is a&nbsp;<strong>periodic</strong>&nbsp;headache characterized by daily attacks of short-duration unilateral headache lasting 8-10 weeks a year. It presents as severe,&nbsp;<strong>unilateral retro-orbital pain</strong>&nbsp;with&nbsp;<strong>autonomic features</strong>, such as unilateral lacrimation, nasal congestion, and conjunctival injection. The pain, though severe, is characteristically brief (15-180 minutes).&nbsp;Patients are usually perfectly well in between episodes.</p>\n<p>The most suitable treatment is pharmacologic prevention of future bouts of headaches. An acute episode can be treated with<strong>&nbsp;</strong></p>\n<ul>\n<li><strong>Sumatriptan&nbsp;</strong>6 mg&nbsp;<strong>subcutaneous&nbsp;</strong>injection</li>\n<li><strong>100% O2&nbsp;</strong>at<strong>&nbsp;10 -12 L/min&nbsp;</strong>for 15 - 20 mins</li>\n<li>Sumatriptan (20 mg) and zolmitriptan (5 mg)<strong>&nbsp;nasal spray.</strong></li>\n<li>Noninvasive vagus nerve stimulation (nVNS) is also approved by the FDA for the treatment of acute episodes of cluster headaches.</li>\n</ul>\n<p>The drugs used in the&nbsp;<strong>prophylaxis</strong>&nbsp;of cluster headaches are:</p>\n<ul>\n<li><strong>Verapamil - drug of choice</strong></li>\n<li>Prednisone</li>\n<li>Lithium</li>\n<li>Topiramate</li>\n<li>Gabapentin</li>\n<li>Melatonin</li>\n<li>Greater occipital nerve injection with lidocaine and glucocorticoids</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An 18-year-old boy is rushed to the ER after having choked on a bone while eating. He is responsive but unable to speak. What is to be done next?",
    "choices": [
      {
        "id": 1,
        "text": "Bag and mask ventilation"
      },
      {
        "id": 2,
        "text": "Endoscopic removal"
      },
      {
        "id": 3,
        "text": "Deliver 5 backslaps and 5 chest compressions"
      },
      {
        "id": 4,
        "text": "Perform Heimlich maneuver"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>In a choking <strong>child</strong> (more than 1 year old) or an <strong>adult,</strong> the first step to be done is to perform <strong>Heimlich</strong> maneuver which involves delivering <strong>abdominal thrusts.</strong></p>\n<p>The rescuer should stand or kneel behind the patient and wrap his arms around the patient\u2019s waist. A fist is made with one hand and using the other hand, the fist is driven into the patient\u2019s abdomen with a rapid, forceful upward thrust so as to dislodge the foreign body. This is continued until the foreign body is expelled or if the patient becomes unresponsive.</p>\n<p>If the patient becomes <strong>unresponsive</strong>, immediately <strong>start</strong> <strong>CPR</strong>.</p>\n<p>The Heimlich maneuver is performed as follows:</p>\n<ol>\n<li>Stand behind the person and slightly to one side.</li>\n<li>Place your arms around the person's waist.</li>\n<li>Make a fist with one hand and place the thumb side against the person's upper abdomen, above the navel and below the ribcage.</li>\n<li>Grasp your fist with your other hand and give quick, inward and upward thrusts to the abdomen, using enough force to dislodge the object.</li>\n<li>Repeat thrusts until the object is expelled or the person becomes unconscious.</li>\n</ol>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7c96e24d3b1f4fafab682fe5a100eebex510x442.GIF",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/57c9eca4b253477f9ff24c5f75ec611cx510x441.GIF",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ca6f508c65294819b123227c5c04f7b2x510x437.GIF"
    ]
  },
  {
    "text": "A 20-year-old male patient presents to the OPD with complaints of fever, intermittent abdominal pain, and dysuria. He gives a history of swimming in the freshwater lake 10 days back. Urine microscopy shows the following. Which of the following is the causative agent?",
    "choices": [
      {
        "id": 1,
        "text": "Schistosoma hematobium"
      },
      {
        "id": 2,
        "text": "Schistosoma mansoni"
      },
      {
        "id": 3,
        "text": "Schistosoma japonicum"
      },
      {
        "id": 4,
        "text": "Schistosoma Mekongi"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical picture along with the history of swimming and the image showing ovoid egg, which is non-operculated, with a brownish yellow transparent shell, carrying a terminal spine at one pole are suggestive of infection with\u00a0<strong>Schistosoma hematobium.</strong></p>\n<p>Species differentiation of Schistosoma can be done based on the location of the spine as follows:</p>\n<ul>\n<li>Terminal spine: Schistosoma hematobium</li>\n<li>Lateral spine: Schistosoma mansoni</li>\n<li>Rudimentary lateral spine: Schistosoma japonicum</li>\n</ul>\n<p>\u00a0</p>\n<p><strong>Schistosoma mansoni (Option B):</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e37d3f280a854accaeb966737098055b.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d9e482352ca84931a53713d6f49968f1x958x622.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3ee84b0ab3854f10936c6f287cebb2a0x600x464.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/db6850bf3c464cb18c5a7d08eb91ddaex720x512.JPEG"
    ]
  }
];
        let quizName = 'Fmge Mini Test - 009 (Clinical)';
        let hierarchy = ["Marrow", "FMGE Mini Test Series", "2023"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>