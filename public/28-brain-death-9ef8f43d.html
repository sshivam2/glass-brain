<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>28 Brain Death - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        PrepLadder / qBank / Anesthesia
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">7</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "<p>Which of the following is\u00a0 true about brain death?</p>",
    "choices": [
      {
        "id": 1,
        "text": "Complete loss of cerebral cortical function but preservation of brainstem reflexes."
      },
      {
        "id": 2,
        "text": "Irreversible loss of all brain function, including the brainstem, with inability to breathe independently."
      },
      {
        "id": 3,
        "text": "Persistent vegetative state where higher brain functions are lost, but spontaneous respiratory effort is present."
      },
      {
        "id": 4,
        "text": "Reversible coma with absence of brainstem reflexes."
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Correct Answer: B) <span class=\"customMeta\" data-dictid=\"ee77d507701692777190bfcf47b497\">Irreversible</span> loss of all brain function, including the brainstem, with inability to breathe independently. </strong></p>\n\n<p><strong>Explanation:</strong></p>\n\n<p>Brain death is a permanent, irreversible, and complete loss of brain function (both cerebral and brain-stem functions).</p>\n\n<p>\u00a0</p>\n\n<p><strong>Definition of brain death</strong></p>\n\n<ul>\n\t<li>Brain death is a state of <span class=\"customMeta\" data-dictid=\"ee77d507701692777190bfcf47b497\">irreversible</span> cessation of all cerebral and brain-stem function with preservation of <span class=\"customMeta\" data-dictid=\"e1fb96fd2416927771830dfed40e14\">cardiac</span> activity and maintenance of <span class=\"customMeta\" data-dictid=\"cfad80a0f716927771979aae100f95\">respiratory</span> and <span class=\"customMeta\" data-dictid=\"3db910d8571692777198303e3bcb27\">somatic</span> function by artificial means.<strong> (Option D ruled out)</strong></li>\n\t<li>It is the only type of brain damage recognized as morally, ethically, and legally equivalent to death.</li>\n</ul>\n\n<p>\u00a0</p>\n\n<p><strong>Complete loss of cerebral <span class=\"customMeta\" data-dictid=\"721937292f1692777185048f04ce29\">cortical</span> function but preservation of <span class=\"customMeta\" data-dictid=\"4004f1f7241692777183d200f866da\">brainstem</span> reflexes (Option A):</strong> In brain death, there is a total and <span class=\"customMeta\" data-dictid=\"ee77d507701692777190bfcf47b497\">irreversible</span> loss of all brain functions, including both the <span class=\"customMeta\" data-dictid=\"ed2f4c790516927771840d0d99e9f4\">cerebral cortex</span> and the brainstem. Hence, this option is incorrect.</p>\n\n<p>\u00a0</p>\n\n<p><strong>Persistent <span class=\"customMeta\" data-dictid=\"5be6ed908e16927772017095bae56c\">vegetative</span> state where higher brain functions are lost, but <span class=\"customMeta\" data-dictid=\"f71e485d131692777199151d1076d2\">spontaneous</span> <span class=\"customMeta\" data-dictid=\"cfad80a0f716927771979aae100f95\">respiratory</span> effort is present (Option C): </strong>This statement refers to a <span class=\"customMeta\" data-dictid=\"b6b12ab46616927771950377e039ae\">persistent <span class=\"customMeta\" data-dictid=\"5be6ed908e16927772017095bae56c\">vegetative</span> state</span> which is not the same as brain death. Cerebral <span class=\"customMeta\" data-dictid=\"721937292f1692777185048f04ce29\">cortical</span> function is lost, but the <span class=\"customMeta\" data-dictid=\"4004f1f7241692777183d200f866da\">brainstem</span> remains functional, allowing for basic reflexes and the ability to breathe spontaneously. Thus, this is <strong>true</strong> but describes a different condition from brain death. Hence, this option is incorrect for this question.</p>",
    "question_images": [],
    "explanation_video": null,
    "explanation_images": [],
    "explanation_audio_eng": "https://image.prepladder.com/content/niuVhtS2fuS8Dh3pV9y31738237705.mp3",
    "explanation_audio_hin": "https://image.prepladder.com/content/5hlaauYU5ws5CmWma6hg1742557053.mp3"
  },
  {
    "text": "<p>A 58-year-old woman is admitted with a traumatic brain injury and is being evaluated for brain death. Her core body temperature is 36.5\u00b0C, and her systolic blood pressure is 95 mm Hg despite volume resuscitation. Neuromuscular blocking agents were recently administered. Which of the following should be done before proceeding with the brain death diagnosis?</p>",
    "choices": [
      {
        "id": 1,
        "text": "Administer vasopressors to increase systolic blood pressure above 100 mm Hg and wait for drug clearance before proceeding."
      },
      {
        "id": 2,
        "text": "Perform brainstem reflex testing immediately since her core temperature is adequate."
      },
      {
        "id": 3,
        "text": "Reduce the temperature to less than 36\u00b0C to continue with the exam."
      },
      {
        "id": 4,
        "text": "Start administering antidotes for neuromuscular blockade and proceed with the diagnosis."
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Correct Answer: A)\u00a0</strong>Administer vasopressors to increase <span class=\"customMeta\" data-dictid=\"cf69f5256416927771991c21f264ae\">systolic</span> <span class=\"customMeta\" data-dictid=\"263ee5444e1692777183a7e8e704da\">blood pressure</span> above 100 <span class=\"customMeta\" data-dictid=\"66ae2626ae169277719278edf9936d\">mm Hg</span> and wait for drug <span class=\"customMeta\" data-dictid=\"3a3fb1b8a816927771840e6a344cc0\">clearance</span> before proceeding.</p>\n\n<p>\u00a0</p>\n\n<p><strong>Explanation:</strong></p>\n\n<ul>\n\t<li>Before deciding to proceed with the diagnosis of brain death, several conditions must be evaluated and met.</li>\n\t<li>In this scenario, the patient\u2019s<strong> <span class=\"customMeta\" data-dictid=\"cf69f5256416927771991c21f264ae\">systolic</span> BP should be >100 mmHg</strong> to meet the criteria, and <strong>administering vasopressors would help stabilize the <span class=\"customMeta\" data-dictid=\"263ee5444e1692777183a7e8e704da\">blood pressure</span> t</strong>o meet the required threshold.</li>\n\t<li>The team must <strong>wait for five half-lives of drug clearance</strong> (adjusted for the patient's <span class=\"customMeta\" data-dictid=\"b9356afdba16927771979d068c6587\">renal</span> and <span class=\"customMeta\" data-dictid=\"3268e86ce01692777188f249c64d6e\">hepatic</span> function) <strong>to ensure the drugs</strong> (neuromuscular agent)<strong> have cleared, </strong>as they can interfere with the neurologic exam by paralyzing the patient, falsely mimicking brain death.</li>\n</ul>\n\n<p>\u00a0</p>\n\n<p><strong>Pre-evaluation for brain death:</strong></p>\n\n<p>Several conditions must be evaluated and <span class=\"customMeta\" data-dictid=\"fffe8d8cdd169277719212053c343d\">met</span> before deciding to proceed with the diagnosis of brain death.</p>\n\n<ul>\n\t<li>The <strong>cause of the coma</strong> must be identified.</li>\n\t<li>Any <strong>confounding factors</strong>, such as severe metabolic, endocrine, or acid-base abnormalities, should be ruled out and corrected.</li>\n\t<li>If <strong>drug</strong> <span class=\"customMeta\" data-dictid=\"fa5fbbb509169277719078b91cffd9\">intoxication</span> or recent use of <span class=\"customMeta\" data-dictid=\"8b19cd5e161692777193ad958e52e0\">neuromuscular</span> <span class=\"customMeta\" data-dictid=\"9dc12b322016927771830dff673eeb\">blocking</span> agents is suspected, it is necessary to wait for five half-lives of drug clearance, adjusted for the patient\u2019s <span class=\"customMeta\" data-dictid=\"4aa6035df41692777190b41d4a1583\">kidney</span> and liver function. <strong>(Option B & D ruled out)</strong></li>\n\t<li>The patient's core<strong> body temperature</strong> should be above 36\u00b0C. <strong>(Option C ruled out)</strong></li>\n\t<li>The <strong>systolic blood pressure</strong> must be higher than 100 mm Hg, with vasopressors administered if required.</li>\n\t<li>A <strong>neurologic examination </strong>suggests widespread <span class=\"customMeta\" data-dictid=\"721937292f1692777185048f04ce29\">cortical</span> destruction that is <span class=\"customMeta\" data-dictid=\"014b1a7b931692777197f57251720d\">reflected</span> by deep <span class=\"customMeta\" data-dictid=\"e39842f67b1692777184171cd1852a\">coma</span> and unresponsiveness to all forms of simulations and should include testing for <span class=\"customMeta\" data-dictid=\"4004f1f7241692777183d200f866da\">brainstem</span> reflexes.</li>\n</ul>",
    "question_images": [],
    "explanation_video": null,
    "explanation_images": [],
    "explanation_audio_eng": "https://image.prepladder.com/content/j4hI00aUgCzPZnI5jKtK1738237966.mp3",
    "explanation_audio_hin": "https://image.prepladder.com/content/7XVpv8l1aE9nOitdnpzn1738238112.mp3"
  },
  {
    "text": "<p>A 30-year-old patient is unconscious following a massive intracerebral hemorrhage. Upon neurological examination, the pupils are fixed and dilated at 5 mm, and there is no response to cold caloric testing or corneal stimulation. However, when tracheal suctioning is performed, the patient exhibits a slight cough. Which of the following conclusions is accurate?</p>\n\n<p>\u00a0</p>",
    "choices": [
      {
        "id": 1,
        "text": "Brain death cannot be confirmed due to the presence of the cough reflex."
      },
      {
        "id": 2,
        "text": "Brain death can be confirmed as the pupils are fixed and non-reactive."
      },
      {
        "id": 3,
        "text": "Brain death can be confirmed, and the cough reflex is a false-positive result."
      },
      {
        "id": 4,
        "text": "Cold caloric testing is unreliable in this setting."
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Brain death diagnosis requires the absence of all <span class=\"customMeta\" data-dictid=\"4004f1f7241692777183d200f866da\">brainstem</span> reflexes, including the <span class=\"customMeta\" data-dictid=\"8f02e74e821692777185a0c005c508\">cough</span> <span class=\"customMeta\" data-dictid=\"20f478f55f1692777197e351415f8f\">reflex</span> (mediated by the <span class=\"customMeta\" data-dictid=\"c8da04ed171692777201da65246acd\">vagus</span> nerve, CN X). Since the patient exhibits a <span class=\"customMeta\" data-dictid=\"8f02e74e821692777185a0c005c508\">cough</span> response, this suggests that some <span class=\"customMeta\" data-dictid=\"4004f1f7241692777183d200f866da\">brainstem</span> function is still intact. Therefore, <span class=\"customMeta\" data-dictid=\"f4360a0c6b16927771839d1262a586\">brain death</span> cannot be confirmed.</p>\n\n<p>\u00a0</p>\n\n<p><strong>Brainstem reflexes in a setting of brain death</strong></p>\n\n<p>In the clinical examination of a patient undergoing <span class=\"customMeta\" data-dictid=\"f4360a0c6b16927771839d1262a586\">brain death</span> evaluation, all <span class=\"customMeta\" data-dictid=\"4004f1f7241692777183d200f866da\">brainstem</span> reflexes must be tested and must be absent to confirm a diagnosis of brain death. <strong>(Option A)</strong></p>\n\n<table cellspacing=\"0\" style=\"border-collapse:collapse; width:590px\">\n\t<tbody>\n\t\t<tr>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p><strong>Brainstem reflex</strong></p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p><strong>Cranial nerves</strong></p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p><strong>Findings in <span class=\"customMeta\" data-dictid=\"f4360a0c6b16927771839d1262a586\">brain death</span> patient.</strong></p>\n\t\t\t</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p>Pupillary light reflex</p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p>II and III</p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<ul>\n\t\t\t\t<li>Pupils should be fixed, mid-size/dilated (4-9 mm), and not <span class=\"customMeta\" data-dictid=\"092583d1b41692777197a506409267\">reactive</span> to light.</li>\n\t\t\t</ul>\n\t\t\t</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p>Oculovestibular reflex</p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p>III, VI, VIII</p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p>The oculovestibular <span class=\"customMeta\" data-dictid=\"20f478f55f1692777197e351415f8f\">reflex</span> can be tested using the oculocephalic <span class=\"customMeta\" data-dictid=\"20f478f55f1692777197e351415f8f\">reflex</span> (Doll's eyes) or <span class=\"customMeta\" data-dictid=\"39156a37b21692777183372a301aa8\">caloric</span> testing.</p>\n\n\t\t\t<ul>\n\t\t\t\t<li>In the absent oculocephalic reflex, the eyes move with the head. This test should only be done if the <span class=\"customMeta\" data-dictid=\"25c6ce766c1692777184ab9a40305c\">cervical</span> spine is stable.</li>\n\t\t\t\t<li>Cold <span class=\"customMeta\" data-dictid=\"39156a37b21692777183372a301aa8\">caloric</span> testing involves irrigating one ear with ice water, and an absent <span class=\"customMeta\" data-dictid=\"20f478f55f1692777197e351415f8f\">reflex</span> is indicated by no eye movement toward the irrigated side within 1 minute. The other ear is tested after 5 minutes.</li>\n\t\t\t</ul>\n\t\t\t</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p>Corneal reflex</p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p>V and VII</p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<ul>\n\t\t\t\t<li>Loss of corneal reflex</li>\n\t\t\t\t<li>Performed using a cotton <span class=\"customMeta\" data-dictid=\"b76c34e672169277719964ab6c1b56\">swab</span> or drops of water/normal saline.</li>\n\t\t\t</ul>\n\t\t\t</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p>Gag reflex</p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p>IX</p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<ul>\n\t\t\t\t<li>Loss of <span class=\"customMeta\" data-dictid=\"9859613acd1692777187a2aaacae71\">gag</span> reflex</li>\n\t\t\t\t<li>Performed after <span class=\"customMeta\" data-dictid=\"7f3792072b1692777199fd8e2c4f59\">stimulation</span> of <span class=\"customMeta\" data-dictid=\"625feb7e3a1692777183aa9d923cfd\">bilateral</span> <span class=\"customMeta\" data-dictid=\"a5c6cb079d16927771967e62ffee72\">posterior</span> pharyngeal membranes without <span class=\"customMeta\" data-dictid=\"a1f256489a16927771870ddd296574\">elevation</span> of the palate.</li>\n\t\t\t</ul>\n\t\t\t</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p>Cough reflex</p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p>X</p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<ul>\n\t\t\t\t<li>Loss of <span class=\"customMeta\" data-dictid=\"8f02e74e821692777185a0c005c508\">cough</span> reflex</li>\n\t\t\t\t<li>Confirmed after <span class=\"customMeta\" data-dictid=\"c739a6fb2b1692777200e2ada8023c\">tracheal</span> suctioning without reaction.</li>\n\t\t\t</ul>\n\t\t\t</td>\n\t\t</tr>\n\t</tbody>\n</table>\n\n<p><strong>Brain death can be confirmed as the pupils are fixed and non-reactive (Option B): </strong>The diagnosis of <span class=\"customMeta\" data-dictid=\"f4360a0c6b16927771839d1262a586\">brain death</span> requires the absence of all <span class=\"customMeta\" data-dictid=\"4004f1f7241692777183d200f866da\">brainstem</span> reflexes, including the <span class=\"customMeta\" data-dictid=\"8f02e74e821692777185a0c005c508\">cough</span> reflex, which is still present in this case. Therefore, <span class=\"customMeta\" data-dictid=\"f4360a0c6b16927771839d1262a586\">brain death</span> cannot be confirmed solely based on fixed, non-reactive pupils.</p>\n\n<p>\u00a0</p>\n\n<p><strong>Brain death can be confirmed, and the <span class=\"customMeta\" data-dictid=\"8f02e74e821692777185a0c005c508\">cough</span> <span class=\"customMeta\" data-dictid=\"20f478f55f1692777197e351415f8f\">reflex</span> is a <span class=\"customMeta\" data-dictid=\"b0151941a0169277720265b58da84e\">false-positive</span> result:</strong></p>\n\n<p>This statement is <strong>false (Option C):</strong> The <span class=\"customMeta\" data-dictid=\"8f02e74e821692777185a0c005c508\">cough</span> <span class=\"customMeta\" data-dictid=\"20f478f55f1692777197e351415f8f\">reflex</span> is not a <span class=\"customMeta\" data-dictid=\"b0151941a0169277720265b58da84e\">false-positive</span> result but an actual <span class=\"customMeta\" data-dictid=\"4004f1f7241692777183d200f866da\">brainstem</span> <span class=\"customMeta\" data-dictid=\"20f478f55f1692777197e351415f8f\">reflex</span> that indicates some remaining <span class=\"customMeta\" data-dictid=\"4004f1f7241692777183d200f866da\">brainstem</span> activity. The presence of this <span class=\"customMeta\" data-dictid=\"20f478f55f1692777197e351415f8f\">reflex</span> means that <span class=\"customMeta\" data-dictid=\"f4360a0c6b16927771839d1262a586\">brain death</span> cannot be confirmed. This option is incorrect.</p>\n\n<p>\u00a0</p>\n\n<p><strong>Cold <span class=\"customMeta\" data-dictid=\"39156a37b21692777183372a301aa8\">caloric</span> testing is unreliable in this setting: </strong>Cold <span class=\"customMeta\" data-dictid=\"39156a37b21692777183372a301aa8\">caloric</span> testing is a reliable method for assessing <span class=\"customMeta\" data-dictid=\"4004f1f7241692777183d200f866da\">brainstem</span> function. In this case, the absence of response to cold <span class=\"customMeta\" data-dictid=\"39156a37b21692777183372a301aa8\">caloric</span> testing suggests <span class=\"customMeta\" data-dictid=\"4004f1f7241692777183d200f866da\">brainstem</span> dysfunction. However, since the <span class=\"customMeta\" data-dictid=\"8f02e74e821692777185a0c005c508\">cough</span> <span class=\"customMeta\" data-dictid=\"20f478f55f1692777197e351415f8f\">reflex</span> is present, <span class=\"customMeta\" data-dictid=\"f4360a0c6b16927771839d1262a586\">brain death</span> cannot be confirmed. Hence, this option is incorrect.</p>\n\n<p>\u00a0</p>\n\n<p>\u00a0</p>\n\n<p>\u00a0</p>",
    "question_images": [],
    "explanation_video": null,
    "explanation_images": [],
    "explanation_audio_eng": "https://image.prepladder.com/content/ocU3XOWofvBGHVkIO5Hr1738238320.mp3",
    "explanation_audio_hin": "https://image.prepladder.com/content/erWouIUkDZkm1237F8M51738238437.mp3"
  },
  {
    "text": "<p>A 40-year-old male is unconscious following a traumatic brain injury and is being evaluated for brain death. His blood pressure is stabilized with noradrenaline infusion to maintain a systolic BP of 110 mm Hg. The patient is preoxygenated for 10 minutes with 100% FiO2, achieving a PaO2 of 230 mm Hg. The ventilator is disconnected, and 100% FiO2 is administered via insufflation tubing at 6 L/min near the carina. After 10 minutes, no respiratory movements are observed. Arterial blood gas analysis reveals a PaCO2 of 65 mm Hg, and the SpO2 remains at 98% throughout the test. What is the most appropriate conclusion regarding this apnea test?</p>\n\n<p>\u00a0</p>",
    "choices": [
      {
        "id": 1,
        "text": "The apnea test is negative since the patient needs vasopressors."
      },
      {
        "id": 2,
        "text": "SpO2 should drop below 90% for a valid apnea test."
      },
      {
        "id": 3,
        "text": "The apnea test is positive, indicating brain death."
      },
      {
        "id": 4,
        "text": "The apnea test should be extended for another 5 minutes to confirm brain death."
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Correct Answer: C) The <span class=\"customMeta\" data-dictid=\"22b9ee5b2b16927771814b5d8d34ac\">apnea</span> test is positive, indicating brain death. </strong></p>\n\n<p><strong>Explanation:</strong></p>\n\n<p>In this case, all criteria for a positive <span class=\"customMeta\" data-dictid=\"22b9ee5b2b16927771814b5d8d34ac\">apnea</span> test are met, confirming brain death.</p>\n\n<p>\u00a0</p>\n\n<p><strong>Apnea test for brain death</strong></p>\n\n<ul>\n\t<li>If clinical evaluation and <span class=\"customMeta\" data-dictid=\"2fd6b3cdf516927771836603ca8c63\">brain stem</span> reflexes are inconclusive: Stimulate the <span class=\"customMeta\" data-dictid=\"2fd6b3cdf516927771836603ca8c63\">brain stem</span> with an <span class=\"customMeta\" data-dictid=\"22b9ee5b2b16927771814b5d8d34ac\">apnea</span> test.</li>\n\t<li>This test analyses whether the patient is brain dead or not by temporarily terminating the <span class=\"customMeta\" data-dictid=\"072a58ab7d169277720130e58f9614\">ventilator</span> support or breathing.</li>\n</ul>\n\n<p>\u00a0</p>\n\n<p><strong>Preparation of <span class=\"customMeta\" data-dictid=\"22b9ee5b2b16927771814b5d8d34ac\">Apnea</span> Test:</strong></p>\n\n<ul>\n\t<li>Pre-evaluation for <span class=\"customMeta\" data-dictid=\"f4360a0c6b16927771839d1262a586\">brain death</span> should be done and corrected if any abnormalities are detected.</li>\n\t<li>Vasopressors should be adjusted to maintain a SBP \u2265100 mmHg. <strong>(Option A ruled out)</strong></li>\n</ul>\n\n<p>\u00a0</p>\n\n<p><strong>Procedure of <span class=\"customMeta\" data-dictid=\"22b9ee5b2b16927771814b5d8d34ac\">Apnea</span> Test:</strong></p>\n\n<p><img alt=\"Procedure of Apnea Test\" data-author=\"\" data-hash=\"377\" data-license=\"\" data-source=\"\" data-tags=\"December2024\" src=\"https://image.prepladder.com/notes/2frq2lvZJUahHhIr034p1734922712.png\" /></p>\n\n<p>\u00a0</p>\n\n<p><strong>Note: If PaCO<sub>2</sub> rise is <20 mmHg after 10 mins of providing apnea: Redo the <span class=\"customMeta\" data-dictid=\"22b9ee5b2b16927771814b5d8d34ac\">apnea</span> test or do <span class=\"customMeta\" data-dictid=\"cd1d5b067516927771819619bf25cc\">ancillary</span> tests. (Option D ruled out)</strong></p>\n\n<p>\u00a0</p>\n\n<p>The <span class=\"customMeta\" data-dictid=\"22b9ee5b2b16927771814b5d8d34ac\">apnea</span> test has to be discontinued if:</p>\n\n<ul>\n\t<li>Presence of any <span class=\"customMeta\" data-dictid=\"cfad80a0f716927771979aae100f95\">respiratory</span> movement (abdominal or chest excursions or brief gasp).</li>\n\t<li>SBP decreases to <90 mm Hg.</li>\n\t<li>Oxygen <span class=\"customMeta\" data-dictid=\"e4696a0f8d169277719865588e55c7\">saturation</span> is less than 85% for more than 30 seconds.<strong> (Option B ruled out)</strong></li>\n</ul>",
    "question_images": [],
    "explanation_video": null,
    "explanation_images": [
      "https://image.prepladder.com/notes/2frq2lvZJUahHhIr034p1734922712.png"
    ],
    "explanation_audio_eng": "https://image.prepladder.com/content/HIuyQRdmespYs7IMtfKv1738239290.mp3",
    "explanation_audio_hin": "https://image.prepladder.com/content/nZwCaEALtPI4WZFtfTs61742557347.mp3"
  },
  {
    "text": "<p>A 45-year-old patient is suspected of having brain death after a severe head injury. The clinical evaluation is incomplete due to confounding factors. Which of the following ancillary tests is considered the gold standard for assessing cerebral blood flow in determining brain death?</p>\n\n<ol>\n</ol>",
    "choices": [
      {
        "id": 1,
        "text": "Computed Tomography (CT) Angiography"
      },
      {
        "id": 2,
        "text": "Four-vessel angiography"
      },
      {
        "id": 3,
        "text": "Magnetic Resonance Angiography (MRA)"
      },
      {
        "id": 4,
        "text": "Electroencephalogram (EEG)"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Four-vessel angiography</strong> is considered the gold standard for assessing brain <span class=\"customMeta\" data-dictid=\"82cc227a1c169277718387905b50c6\">blood flow</span> in the determination of brain death.</p>\n\n<p><strong>Types of <span class=\"customMeta\" data-dictid=\"cd1d5b067516927771819619bf25cc\">Ancillary</span> Tests</strong></p>\n\n<p>\u00a0</p>\n\n<table cellspacing=\"0\" style=\"border-collapse:collapse; width:623px\">\n\t<tbody>\n\t\t<tr>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p><strong>Category</strong></p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p><strong>Tests</strong></p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p><strong>Purpose</strong></p>\n\t\t\t</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p><strong>Traditional Tests</strong></p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p>Four-vessel angiography</p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p>Gold standard to assess brain blood flow</p>\n\t\t\t</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\u00a0</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p>Radionuclide imaging</p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p>Evaluates cerebral blood flow</p>\n\t\t\t</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p><strong>Emerging Tests</strong></p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p>CT Angiography</p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p>Visualizes brain blood vessels</p>\n\t\t\t</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\u00a0</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p>CT Perfusion</p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p>Measures dynamic <span class=\"customMeta\" data-dictid=\"82cc227a1c169277718387905b50c6\">blood flow</span> in the brain</p>\n\t\t\t</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\u00a0</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p>Magnetic <span class=\"customMeta\" data-dictid=\"37b9856df8169277719716b550a15f\">Resonance</span> <span class=\"customMeta\" data-dictid=\"c67cc1bcd3169277718150b3c9d6ab\">Angiography</span> (MRA)</p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p>Creates images of blood vessels using magnetic fields</p>\n\t\t\t</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\u00a0</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p>Xenon CT</p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p>Assesses cerebral <span class=\"customMeta\" data-dictid=\"82cc227a1c169277718387905b50c6\">blood flow</span> with <span class=\"customMeta\" data-dictid=\"e3827ede5c1692777202c45715fc8e\">xenon</span> gas</p>\n\t\t\t</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p><strong>Functional & Electrodiagnostic Tests</strong></p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p>Transcranial <span class=\"customMeta\" data-dictid=\"eb476e70a316927771861ad68beaae\">Doppler</span> Testing</p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p>Measures <span class=\"customMeta\" data-dictid=\"82cc227a1c169277718387905b50c6\">blood flow</span> <span class=\"customMeta\" data-dictid=\"12c4510e191692777201c23ec126a3\">velocity</span> in cerebral arteries</p>\n\t\t\t</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\u00a0</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p>Electroencephalogram (EEG)</p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p>Records brain's electrical activity</p>\n\t\t\t</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\u00a0</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p>Evoked Potentials</p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p>Measures brain's electrical response to stimuli</p>\n\t\t\t</td>\n\t\t</tr>\n\t</tbody>\n</table>\n\n<p><strong>Objectives of <span class=\"customMeta\" data-dictid=\"cd1d5b067516927771819619bf25cc\">Ancillary</span> Testing</strong></p>\n\n<ul>\n\t<li>Validate test accuracy compared to:\n\t<ul>\n\t\t<li>Clinical diagnosis</li>\n\t\t<li>Four-vessel angiography</li>\n\t\t<li>Radionuclide imaging</li>\n\t</ul>\n\t</li>\n\t<li>Assess <span class=\"customMeta\" data-dictid=\"f86aae0bd61692777196f91458c9dd\">prevalence</span> of:\n\t<ul>\n\t\t<li>False negatives: Incorrectly not declaring brain death</li>\n\t\t<li>False positives: Incorrectly declaring brain death</li>\n\t</ul>\n\t</li>\n\t<li>Evaluate the safety profiles of these tests.</li>\n</ul>\n\n<p><strong>CT <span class=\"customMeta\" data-dictid=\"c67cc1bcd3169277718150b3c9d6ab\">Angiography</span> </strong><strong>(Option A)</strong> is an emerging test used to <span class=\"customMeta\" data-dictid=\"67407c787d1692777202245c791c31\">visualize</span> brain blood vessels but is not the gold standard.</p>\n\n<p>\u00a0</p>\n\n<p><strong>MRA </strong><strong>(Option C)</strong> uses magnetic fields to image blood vessels but is not the gold standard.</p>\n\n<p>\u00a0</p>\n\n<p><strong>EEG </strong><strong>(Option D)</strong> measures brain <span class=\"customMeta\" data-dictid=\"c34137b40a1692777187edcef44647\">electrical activity</span> and is used to evaluate brain function, but it is not a test for <span class=\"customMeta\" data-dictid=\"82cc227a1c169277718387905b50c6\">blood flow</span> and not the gold standard for determining brain death.</p>\n\n<p>\u00a0</p>\n\n<p>\u00a0</p>",
    "question_images": [],
    "explanation_video": null,
    "explanation_images": [],
    "explanation_audio_eng": "https://image.prepladder.com/content/GYaRYVrXFPUMwMZKnXQG1738239658.mp3",
    "explanation_audio_hin": "https://image.prepladder.com/content/bNxYlm3YuTqbU1Kltm2s1738239786.mp3"
  },
  {
    "text": "<p>A 30-year-old patient requires conscious sedation for a dental procedure. The anesthesiologist considers various agents for this purpose. Which of the following drugs is commonly preferred for inducing moderate sedation due to its favorable safety profile and effectiveness in achieving anxiolysis without significant cardiopulmonary complications?</p>\n\n<p>\u00a0</p>\n\n<p>\u00a0</p>\n\n<p>\u00a0</p>",
    "choices": [
      {
        "id": 1,
        "text": "Propofol"
      },
      {
        "id": 2,
        "text": "Dexmedetomidine"
      },
      {
        "id": 3,
        "text": "Midazolam"
      },
      {
        "id": 4,
        "text": "Methohexital"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Midazolam</strong> is commonly used for moderate <span class=\"customMeta\" data-dictid=\"b81cee1b5f16927771987099f651a0\">sedation</span> in <span class=\"customMeta\" data-dictid=\"02cf7655661692777185e2bf5c3254\">dental</span> and <span class=\"customMeta\" data-dictid=\"4712037d54169277718165d90f2550\">ambulatory</span> procedures, with a favorable safety profile and minimal <span class=\"customMeta\" data-dictid=\"0f0e2f0fe91692777183bfa6c6a156\">cardiopulmonary</span> effects.</p>\n\n<p>\u00a0</p>\n\n<p><strong>Conscious sedation: </strong>known as procedural <span class=\"customMeta\" data-dictid=\"b81cee1b5f16927771987099f651a0\">sedation</span> and/or moderate sedation, is a procedure to relieve anxiety and depress the level of consciousness in patients, before minor procedures.</p>\n\n<p>\u00a0</p>\n\n<p><strong>Drug of Choice for Conscious Sedation:</strong></p>\n\n<p>\u00a0</p>\n\n<p><strong>Midazolam</strong>:</p>\n\n<ul>\n\t<li>Commonly used for moderate <span class=\"customMeta\" data-dictid=\"b81cee1b5f16927771987099f651a0\">sedation</span> in <span class=\"customMeta\" data-dictid=\"02cf7655661692777185e2bf5c3254\">dental</span> and <span class=\"customMeta\" data-dictid=\"4712037d54169277718165d90f2550\">ambulatory</span> procedures</li>\n\t<li>Provides anxiolysis and <span class=\"customMeta\" data-dictid=\"b81cee1b5f16927771987099f651a0\">sedation</span> with minimal <span class=\"customMeta\" data-dictid=\"0f0e2f0fe91692777183bfa6c6a156\">cardiopulmonary</span> complications</li>\n\t<li>Has a<strong> strong safety profile</strong></li>\n</ul>\n\n<p><strong>Other drugs:</strong></p>\n\n<table cellspacing=\"0\" style=\"border-collapse:collapse; width:387px\">\n\t<tbody>\n\t\t<tr>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p><strong>Drugs</strong></p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p><strong>Disadvantages</strong></p>\n\t\t\t</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p><strong>Propofol</strong></p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<ul>\n\t\t\t\t<li>May cause <span class=\"customMeta\" data-dictid=\"cfad80a0f716927771979aae100f95\">respiratory</span> depression</li>\n\t\t\t\t<li>Decreases BP/CVS depression <strong>(Option A ruled)</strong></li>\n\t\t\t</ul>\n\t\t\t</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p>Etomidate</p>\n\n\t\t\t<p>E\u2013Endocrine gland</p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<ul>\n\t\t\t\t<li>Suppression of the <span class=\"customMeta\" data-dictid=\"f955f012f716927771801d01e7d163\">adrenal</span> <span class=\"customMeta\" data-dictid=\"4744bb90c21692777188c8957f9faa\">gland</span> (Endocrine)</li>\n\t\t\t\t<li>Myoclonus</li>\n\t\t\t</ul>\n\t\t\t</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p><strong>Ketamine</strong></p>\n\t\t\t\u00a0\n\n\t\t\t<p>Kap on his Head</p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<ul>\n\t\t\t\t<li>Emergence <span class=\"customMeta\" data-dictid=\"74ef5626ab16927771855274381e00\">delirium</span> (because increases cerebral blood flow)</li>\n\t\t\t\t<li>Excessive bronchial secretions and salivation</li>\n\t\t\t\t<li>Hypertension</li>\n\t\t\t\t<li>Increase ICP</li>\n\t\t\t</ul>\n\t\t\t</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p><strong>Dexmedetomidine</strong></p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<ul>\n\t\t\t\t<li>Hypotension</li>\n\t\t\t\t<li>Bradycardia <strong>(Option C ruled out)</strong></li>\n\t\t\t</ul>\n\t\t\t</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p><strong>Methohexital </strong></p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<ul>\n\t\t\t\t<li>Suppression of <span class=\"customMeta\" data-dictid=\"aea081ceb416927771976e2c17be74\">respiration</span> <strong>(Option D ruled out)</strong></li>\n\t\t\t</ul>\n\t\t\t</td>\n\t\t</tr>\n\t</tbody>\n</table>\n\n<p>\u00a0</p>",
    "question_images": [],
    "explanation_video": null,
    "explanation_images": [],
    "explanation_audio_eng": "https://image.prepladder.com/content/O0QF0dSoiohTLc0eZZSX1738239971.mp3",
    "explanation_audio_hin": "https://image.prepladder.com/content/OCD4CwwBzE3kDgFeiZKh1738240084.mp3"
  },
  {
    "text": "<p>Which of the following statements about non-operating room anesthesia (NORA) is false?</p>",
    "choices": [
      {
        "id": 1,
        "text": "NORA can be safely performed in outpatient clinics with trained personnel."
      },
      {
        "id": 2,
        "text": "Airway management complications are less common in NORA than in operating rooms."
      },
      {
        "id": 3,
        "text": "NORA requires specific sedation techniques based on procedure complexity."
      },
      {
        "id": 4,
        "text": "Midazolam is the commonly used agent, owing to its safety profile."
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Airway management complications are more common in NORA than in operating rooms.</p>\n\n<p><strong>Non-Operating Room <span class=\"customMeta\" data-dictid=\"e24b7bd55d16927771818aaa6ad0ed\">Anesthesia</span> (NORA)</strong></p>\n\n<p>NORA involves <span class=\"customMeta\" data-dictid=\"b81cee1b5f16927771987099f651a0\">sedation</span> and <span class=\"customMeta\" data-dictid=\"e24b7bd55d16927771818aaa6ad0ed\">anesthesia</span> for procedures outside traditional operating rooms, increasingly utilized in settings like <span class=\"customMeta\" data-dictid=\"280d7c65d31692777197f6d3b48e8c\">radiology</span> suites and <span class=\"customMeta\" data-dictid=\"a9f32a257d1692777194caf3b4cf78\">outpatient</span> clinics. <strong>(Option A ruled out)</strong></p>\n\n<h4><strong>Key Aspects of NORA</strong></h4>\n\n<ul>\n\t<li><strong>Growing Demand</strong>\n\n\t<ul>\n\t\t<li>Increased patient visits</li>\n\t\t<li>Complex procedures</li>\n\t\t<li>Greater emphasis on pain management</li>\n\t\t<li>Anesthesia providers managing <span class=\"customMeta\" data-dictid=\"b81cee1b5f16927771987099f651a0\">sedation</span> in diverse environments</li>\n\t</ul>\n\t</li>\n\t<li><strong>Challenges</strong>\n\t<ul>\n\t\t<li><strong>Inadequate Support</strong>: Limited staff and resources compared to operating rooms</li>\n\t\t<li><strong>Airway Management Risks</strong>: Higher <span class=\"customMeta\" data-dictid=\"17cd3771bb1692777190950c142dbe\">incidence</span> of <span class=\"customMeta\" data-dictid=\"3b9dd3166f1692777180b697887ccb\">airway</span> complications requiring vigilant monitoring <strong>(Option B)</strong></li>\n\t</ul>\n\t</li>\n\t<li><strong>Sedation Techniques</strong>\n\t<ul>\n\t\t<li>Selection based on: <strong>(Option C ruled out)</strong>\n\t\t<ul>\n\t\t\t<li>Procedure type</li>\n\t\t\t<li>Expected pain levels</li>\n\t\t\t<li>Patient characteristics (age, comorbidities)</li>\n\t\t\t<li>Required <span class=\"customMeta\" data-dictid=\"b81cee1b5f16927771987099f651a0\">sedation</span> depth</li>\n\t\t</ul>\n\t\t</li>\n\t</ul>\n\t</li>\n\t<li><strong>Common Agents Used</strong>\n\t<ul>\n\t\t<li><strong>Midazolam</strong>: Rapid onset, safety profile <strong>(Option D ruled out)</strong></li>\n\t\t<li><strong>Propofol</strong>: Quick recovery, necessitates careful <span class=\"customMeta\" data-dictid=\"3b9dd3166f1692777180b697887ccb\">airway</span> monitoring</li>\n\t</ul>\n\t</li>\n\t<li><strong>Safety Considerations</strong>\n\t<ul>\n\t\t<li>Major complications are rare when managed by trained personnel</li>\n\t\t<li>Ongoing evaluation of <span class=\"customMeta\" data-dictid=\"8a6b09beac1692777184b08a2b5766\">complication</span> rates and mortality as procedures grow more complex</li>\n\t</ul>\n\t</li>\n\t<li><strong>Future Trends</strong>\n\t<ul>\n\t\t<li>Continued expansion of NORA practices</li>\n\t\t<li>Development of standards to improve safety and efficacy</li>\n\t</ul>\n\t</li>\n</ul>",
    "question_images": [],
    "explanation_video": null,
    "explanation_images": [],
    "explanation_audio_eng": "https://image.prepladder.com/content/vY0XfbvlTQ6i34qVJrMd1738240452.mp3",
    "explanation_audio_hin": "https://image.prepladder.com/content/oFL9eMkKp3PpT55GF18j1738240622.mp3"
  }
];
        let quizName = '28 Brain Death';
        const quizFilename = '28-brain-death-9ef8f43d.html';
        let hierarchy = ["PrepLadder", "qBank", "Anesthesia"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>