<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>09 Investigations In Breast Diseases - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Surgery
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">21</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "What is the recommended age for starting screening mammography?",
    "choices": [
      {
        "id": 1,
        "text": "40 years"
      },
      {
        "id": 2,
        "text": "45 years"
      },
      {
        "id": 3,
        "text": "50 years"
      },
      {
        "id": 4,
        "text": "55 years"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The <strong>recommended age</strong> for women to start annual screening mammography is <strong>40 years</strong> of age.</p>\n<ul>\n<li><span style=\"font-size: 10pt; font-family: verdana, geneva, sans-serif;\"><strong>Until 44 years of age</strong>, it is her<strong>&nbsp;individual choice</strong> to decide on whether she wants screening mammography or not. </span></li>\n<li><span style=\"font-size: 10pt; font-family: verdana, geneva, sans-serif;\">For ages<strong> between 45 and 49 years,</strong> it is <strong>mandatory</strong> to get&nbsp;<span style=\"letter-spacing: 0px;\"><strong>annua</strong><strong>l</strong></span><span style=\"letter-spacing: 0px;\"> breast</span> <span style=\"letter-spacing: 0px;\">screening done. </span></span></li>\n<li><span style=\"font-size: 10pt; font-family: verdana, geneva, sans-serif;\"><span style=\"letter-spacing: 0px;\">After the age of <strong>50 years, </strong>it is advised that women get a <strong>second yearly</strong> screening done.</span></span></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is false regarding screening mammography?",
    "choices": [
      {
        "id": 1,
        "text": "Sensitivity of the test will increase with her age."
      },
      {
        "id": 2,
        "text": "It is best performed in the 2nd half of her menstrual cycle."
      },
      {
        "id": 3,
        "text": "Mediolateral oblique view will show the greatest volume of her breast tissue."
      },
      {
        "id": 4,
        "text": "Craniocaudal view will provide better visualization of the medial aspect of her breast."
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Mammography is best performed in the <strong>1st half of the menstrual cycle</strong>, as breast tissue is<strong> less dense</strong> in the follicular phase. Also, in the <strong>2nd half of the menstrual cycle</strong>, since ovulation occurs and there is a chance for pregnancy, the <strong>radiation</strong> can potentially <strong>affect the embryo</strong>.&nbsp;</p>\n<p>The<strong> sensitivity</strong> of mammography&nbsp;<strong>increases with age</strong>, as the breast tissue becomes <strong>less dense</strong>.&nbsp;</p>\n<p>It involves 2 standard views:&nbsp;</p>\n<ol>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Mediolateral oblique (<strong>MLO) </strong>view- covers a <strong>greater volume</strong> of breast tissue, including the upper outer quadrant and the axillary tail of Spence.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Craniocaudal (<strong>CC</strong>)&nbsp;view- provides <strong>better</strong> <strong>visualization of the medial aspect</strong> of the breast.</li>\n</ol>\n<p>Mammography uses low-voltage, high-amperage X-rays. The radiation dose from mammography is around <strong>0.1 cGy</strong> per study.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 50-year-old woman underwent screening mammography. Which of the following findings in her mammogram is least suggestive of a malignancy?",
    "choices": [
      {
        "id": 1,
        "text": "Irregular mass"
      },
      {
        "id": 2,
        "text": "Wide halo"
      },
      {
        "id": 3,
        "text": "Macrocalcification"
      },
      {
        "id": 4,
        "text": "Spiculated margins"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Macrocalcification</strong> in a lesion is <strong>least</strong> suggestive of a <strong>malignancy.</strong> It is commonly seen in <strong>benign breast disorders</strong>. <strong>Microcalcification</strong> (&lt;0.5 mm in diameter) is suggestive of <strong>malignancy</strong>.</p>\n<p>Table: Mammographic appearance of benign and malignant masses&nbsp;&nbsp;</p>\n<table style=\"width: 440px;\">\n<tbody>\n<tr>\n<td style=\"width: 120.203125px;\">&nbsp;</td>\n<td style=\"width: 151.796875px;\"><strong>Benign</strong></td>\n<td style=\"width: 164px;\"><strong>Malignant</strong></td>\n</tr>\n<tr>\n<td style=\"width: 120.203125px;\"><strong>Opacity</strong></td>\n<td style=\"width: 151.796875px;\">\n<ul>\n<li>Low density</li>\n<li>Homogenous</li>\n<li>Smooth margin</li>\n<li>Thin halo</li>\n</ul>\n</td>\n<td style=\"width: 164px;\">\n<ul>\n<li>High density</li>\n<li>Not homogenous</li>\n<li>Ill-defined margin, irregular stellate spiculated margin, comet tail</li>\n<li>Wide halo</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td style=\"width: 120.203125px;\"><strong>Calcification</strong></td>\n<td style=\"width: 151.796875px;\">Macrocalcification (&gt;0.5 mm)</td>\n<td style=\"width: 164px;\">Microcalcification (&lt;0.5 mm)</td>\n</tr>\n<tr>\n<td style=\"width: 120.203125px;\"><strong>Breast parenchyma</strong></td>\n<td style=\"width: 151.796875px;\">Normal</td>\n<td style=\"width: 164px;\">Architectural distortion</td>\n</tr>\n<tr>\n<td style=\"width: 120.203125px;\"><strong>Nipple/areola</strong></td>\n<td style=\"width: 151.796875px;\">Normal</td>\n<td style=\"width: 164px;\">Retraction</td>\n</tr>\n<tr>\n<td style=\"width: 120.203125px;\"><strong>Skin</strong></td>\n<td style=\"width: 151.796875px;\">Normal</td>\n<td style=\"width: 164px;\">Thickening</td>\n</tr>\n<tr>\n<td style=\"width: 120.203125px;\"><strong>Cooper ligaments</strong></td>\n<td style=\"width: 151.796875px;\">Normal</td>\n<td style=\"width: 164px;\">\n<p>Thickening, increase in number</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 120.203125px;\"><strong>Ducts</strong></td>\n<td style=\"width: 151.796875px;\">Normal</td>\n<td style=\"width: 164px;\">Focal dilatation</td>\n</tr>\n<tr>\n<td style=\"width: 120.203125px;\"><strong>Subcutaneous and mammary space</strong></td>\n<td style=\"width: 151.796875px;\">Normal</td>\n<td style=\"width: 164px;\">Obliteration</td>\n</tr>\n</tbody>\n</table>\n<p>Below is an image showing a malignant breast mass with ill-defined, spiculated margins and&nbsp;microcalcifications.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/62a1c0029973463aaf883df317766d1fx1024x700.jpeg"
    ]
  },
  {
    "text": "Which pattern of microcalcification seen in a patient\u2019s mammography report would indicate the maximum risk of malignancy?",
    "choices": [
      {
        "id": 1,
        "text": "Cluster microcalcification"
      },
      {
        "id": 2,
        "text": "Diffuse microcalcification"
      },
      {
        "id": 3,
        "text": "Segmental microcalcification"
      },
      {
        "id": 4,
        "text": "Regional microcalcification"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Cluster microcalcification</strong> in mammography indicates the\u00a0<strong>maximum </strong>risk of malignancy.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2c7c56294ed74b5e90a261c87b177a99x440x252.JPEG"
    ]
  },
  {
    "text": "Match the following types of calcifications with the diseases they are associated with.",
    "choices": [
      {
        "id": 1,
        "text": "A-iii B-ii C-i D-iv"
      },
      {
        "id": 2,
        "text": "A-iv B-iii C-ii D-i"
      },
      {
        "id": 3,
        "text": "A-i B-iii C-ii D-iv"
      },
      {
        "id": 4,
        "text": "A-ii B-iv C-iii D-i"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Tea-cup calcification:</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/47a9fc6819e745b5bcebdb85e43f79fex630x520.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e6a5446052284594900f5e6b5d44e4fcx172x227.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b95f21ef2bb94751b0ebc6e6ae44f1bax841x1024.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7296ae6662c446cb8341bdf47f5057bbx512x559.PNG"
    ]
  },
  {
    "text": "A 58-year-old woman presents with complaints of a painless lump in her left breast which she noticed during a routine self-examination. On palpation, a hard lump with irregular margins and enlarged left axillary lymph nodes were found. Which among the following is the best modality to detect malignancy in her case?",
    "choices": [
      {
        "id": 1,
        "text": "2D mammography"
      },
      {
        "id": 2,
        "text": "Digital mammography"
      },
      {
        "id": 3,
        "text": "Tomosynthesis with conventional mammography"
      },
      {
        "id": 4,
        "text": "Full-field digital mammography"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Tomosynthesis (3D mammography) performed along with conventional 2D mammography</strong> is the best investigation among the given options to detect breast carcinoma.&nbsp;</p>\n<p><strong>Breast Tomosynthesis</strong> is typically performed in conjunction <strong>with conventional mammography</strong>. Hence, the radiation dose is doubled. However, the <strong>accuracy is improved</strong> and false positives are lesser. It can be used for <strong>dense breasts</strong> and those with <strong>high-risk factors</strong>.</p>\n<p><strong>Screen-film mammography</strong> is the conventional 2D mammography.</p>\n<p><strong>Digital mammography/full-field digital mammography</strong> uses digital technology instead of films. The diagnostic accuracy is similar to that of screen-film mammography. A minor advantage is the greater accuracy in predicting lesions in dense breasts.</p>\n<p>Note: Overall, the <strong>best modality</strong> for detecting breast carcinoma is <strong>MRI.</strong></p>\n<p>The below image shows a comparison of 2D mammogram vs. 3D mammogram:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://cdn1.dailyrounds.org/uploads/0c5f19f8e66e4745ba5b400e629645f9x843x817.PNG"
    ]
  },
  {
    "text": "A mammogram done for a 45-year-old female patient with a breast lump was reported as BIRADS category 0. What is it suggestive of?",
    "choices": [
      {
        "id": 1,
        "text": "Negative"
      },
      {
        "id": 2,
        "text": "Incomplete"
      },
      {
        "id": 3,
        "text": "Probably benign"
      },
      {
        "id": 4,
        "text": "Suspicious abnormality"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Category/score <strong>0</strong> in BIRADS suggests an&nbsp;<strong>incomplete assessment.</strong></p>\n<p>All&nbsp;breast&nbsp;imaging&nbsp;should be reported by&nbsp;BIRADS&nbsp;(breast imaging-reporting and data system).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 48-year-old woman with a lump in her right breast was advised to undergo mammography which was reported as BIRADS 3. What will be the appropriate next step of management in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Trucut biopsy"
      },
      {
        "id": 2,
        "text": "Routine annual screening"
      },
      {
        "id": 3,
        "text": "MRI breast"
      },
      {
        "id": 4,
        "text": "Follow-up every 6 months for 2 years"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>A <strong>BIRADS score of 3</strong> means that it is <strong>probably a benign lesion</strong>. The next appropriate step is to <strong>follow up</strong> with this patient <strong>every 6 months for the next 2 years</strong>.</p>\n<p>During this period, the score can either downgrade to BIRADS 2 or upgrade to BIRADS 4 or 5.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An anxious 45-year-old woman presented with complaints of a lump over her left breast for 2 months. The patient underwent mammography, and the lump was categorized as BIRADS 4a. What is the likelihood of her lesion being malignant?",
    "choices": [
      {
        "id": 1,
        "text": "80-95 %"
      },
      {
        "id": 2,
        "text": "60-80%"
      },
      {
        "id": 3,
        "text": "11- 50%"
      },
      {
        "id": 4,
        "text": "2-10%"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>There is a <strong>2-10%</strong> likelihood for a lesion with <strong>BIRADS 4a</strong> to be malignant.</p>\n<p><strong>BIRADS Categories/Grades</strong></p>\n<p>Grades 1 and 2: 0% chance of being malignant.</p>\n<p>Grade 3: &gt;0% but &le;2% chance of being malignant</p>\n<p>Grade 4:</p>\n<ul>\n<li>4a: &gt;2 to &le;10% chance of being malignant</li>\n<li>4b: &gt;10 to &le;50% chance of being malignant</li>\n<li>4c: &gt;50 to &lt;95% chance of being malignant</li>\n</ul>\n<p>Grade 5: <span class=\"_Tgc _s8w\">&ge;</span>95% chance of being malignant</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 36-year-old pregnant lady was referred to the surgery OPD at 12 weeks of gestation with a lump in her right breast for the past 1 month. On examination, a lump of 2 x 1 cm size was palpated in the upper outer quadrant of the breast. Which of the following investigations would you initially advise her for the assessment of the breast lump?",
    "choices": [
      {
        "id": 1,
        "text": "Conventional mammography"
      },
      {
        "id": 2,
        "text": "Ultrasonography"
      },
      {
        "id": 3,
        "text": "MRI"
      },
      {
        "id": 4,
        "text": "Tomosynthesis with 2D mammography"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Ultrasonography (USG</strong>) is the preferred <strong>initial</strong> investigation in <strong>pregnant women</strong> who present with a breast lump. It can differentiate between solid and cystic lesions of the breast and is able to detect abnormal axillary lymph nodes.&nbsp;USG is preferred in women with<strong> dense breast tissue</strong> such as:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Pregnant women</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Lactating women</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Young women (less than 40 years old)&nbsp;</li>\n</ul>\n<p><strong>Conventional Mammography/ Tomosynthesis with 2D mammography</strong> is <strong>less useful</strong> in pregnant women due to the <strong>increased density</strong> of breast tissue.</p>\n<p><strong>MRI</strong> is <strong>not the initial</strong> investigation used for the assessment of breast lumps. It can be used in cases where metastasis or spread to other breasts is suspected.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A USG can detect lymph node metastases in a patient with breast cancer and clinically negative lymph nodes by what percentage?",
    "choices": [
      {
        "id": 1,
        "text": "50 \u2013 60%"
      },
      {
        "id": 2,
        "text": "10 \u2013 20%"
      },
      {
        "id": 3,
        "text": "20 \u2013 30%"
      },
      {
        "id": 4,
        "text": "30 \u2013 50%"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>A <strong>USG</strong> can detect lymph node metastasis in a patient with clinically negative lymph nodes by <strong>50-60%</strong>.</p>\n<p>The <strong>clinical determination</strong> of axillary lymph node metastases has an accuracy of only<strong> 33%</strong>.</p>\n<p>Ultrasound (<strong>USG</strong>) is <strong>more sensitive</strong> than physical examination alone in determining axillary lymph node involvement during the preliminary staging of breast carcinoma.&nbsp;</p>\n<p><strong>Fine-needle aspiration cytology (FNAC) or core biopsy</strong> of sonographically indeterminate or suspicious lymph nodes can provide a more definitive diagnosis than USG alone.</p>\n<p>Ultrasonography can also be utilized to image the regional lymph nodes in patients with breast cancer. The <strong>sensitivity</strong> for the status of axillary nodes ranges from <strong>35% to 82%</strong> and <strong>specificity</strong> ranges from <strong>73% to 97%</strong>.</p>\n<p><strong>The features of a lymph node involved with cancer on USG include</strong>:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Cortical thickening</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Change in shape of the node to a more circular appearance</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Size larger than 10 mm&nbsp;</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Absence of a fatty hilum</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Hypoechoic internal echoes</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following features on USG will not be suggestive of breast malignancy?",
    "choices": [
      {
        "id": 1,
        "text": "Thin echogenic pseudo-capsule"
      },
      {
        "id": 2,
        "text": "Hypo-echoic lesion"
      },
      {
        "id": 3,
        "text": "Central vascularity"
      },
      {
        "id": 4,
        "text": "Lump will be taller than wider"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Malignant breast lump</strong> on USG, has an <strong>ill-defined echogenic halo</strong>, is hypoechoic, and the lump will be taller than wider. <strong>Benign breast lumps</strong> have a <strong>thin echogenic pseudo-capsule</strong> on USG.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A young female patient presents to the clinic with a painless lump in her right breast. She underwent breast augmentation surgery 3 years back. Which of the following will be the best investigation to assess the breast tissue in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Tomosynthesis"
      },
      {
        "id": 2,
        "text": "Ultrasonography"
      },
      {
        "id": 3,
        "text": "Magnetic resonance imaging"
      },
      {
        "id": 4,
        "text": "Computed tomography"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Magnetic resonance imaging (<strong>MRI</strong>) is the <strong>best investigation</strong> to assess <strong>breast tissue</strong> in a patient with a <strong>breast implant</strong>.</p>\n<p><strong>MRI of the breast is also used in</strong>:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Screening of high-risk individuals with a positive family history.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Assessing loco-regional spread (multifocality and multicentricity) of carcinoma.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">To differentiate scar from recurrence in women who have had breast conservation surgery for breast cancer.</li>\n</ul>\n<p>Option A: <strong>Tomosynthesis</strong> is not preferred, as radio-opaque implants are usually compressed together with the breast tissue, obscuring the visibility and thereby reducing its sensitivity.</p>\n<p>Option B: <strong>Ultrasonography</strong> is used as an initial investigation in the evaluation of breast abnormalities in patients with breast implants.</p>\n<p>Option D: <strong>Computed tomography</strong> is not routinely used in the evaluation of breast lumps.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 40-year-old woman with an elder sister with BRCA1 gene mutation presented to the OPD with a normal mammography report. Which of the following is the next preferred investigation to further evaluate this patient?",
    "choices": [
      {
        "id": 1,
        "text": "USG"
      },
      {
        "id": 2,
        "text": "MRI"
      },
      {
        "id": 3,
        "text": "Trucut biopsy"
      },
      {
        "id": 4,
        "text": "Repeat mammography after 6 months"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In the given scenario, since the patient is at <strong>high risk for breast malignancy</strong> (first degree relative with BRCA1 gene mutation), <strong>MRI followed by trucut biopsy</strong> will be the appropriate next step for further evaluation.</p>\n<p><strong>MRI</strong> is helpful in the screening of <strong>high-risk individuals</strong> and is the <strong>most sensitive</strong> imaging modality. However, it should be done after initial radiological evaluation, in case the results are inconclusive.</p>\n<p><strong>American Cancer Society Risk Criteria for Breast Magnetic Resonance Imaging Screening:</strong></p>\n<p><strong>Women at high lifetime risk</strong> (&asymp;20%-25% or greater) of breast cancer-</p>\n<ol>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Known BRCA1 or BRCA2 gene mutation</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">First-degree relatives with BRCA1 or BRCA2 gene mutation, but have not had genetic testing themselves.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Radiation therapy to the chest between the ages of 10 and 30 years</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Li-Fraumeni syndrome or Cowden syndrome or a first-degree relative with one of these syndromes.</li>\n</ol>\n<p>Women with a personal history of breast cancer, ductal carcinoma in situ, lobular carcinoma in situ, atypical ductal hyperplasia, or atypical lobular hyperplasia, are at a<strong> moderately increased lifetime risk</strong> for breast cancer.&nbsp;</p>\n<p>Options A &amp; D: <strong>Breast tomosynthesis or repeat mammography</strong> is not preferred as the next investigation in high-risk patients.&nbsp;</p>\n<p>Option C: <strong>Trucut biopsy</strong> will be done following MRI in high-risk patients.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A postmenopausal woman who was on HRT for the past 2 years, presented with a 4 x 3cm lump over the upper outer quadrant of the left breast. On examination, a peau d\u2019orange appearance was seen and a hard and fixed lump was palpated over the breast.  Which of the following is the investigation of choice to confirm the diagnosis in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Excisional biopsy"
      },
      {
        "id": 2,
        "text": "Trucut biopsy"
      },
      {
        "id": 3,
        "text": "Fine-needle aspiration cytology"
      },
      {
        "id": 4,
        "text": "Tomosynthesis with 2D mammography"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The history and physical examination point towards a diagnosis of <strong>breast malignancy</strong>. The <strong>investigation of choice</strong>\u00a0for <strong>confirmation</strong> of\u00a0breast carcinoma is <strong>trucut biopsy/core-needle biopsy</strong>. An excisional biopsy can be done, in case it is inconclusive.</p>\n<p><strong>Trucut needle biopsy</strong> permits the analysis of <strong>breast tissue architecture</strong>. A <strong>14 G- 16 G</strong> needle is used. The advantages include a low complication rate, minimal scarring, and a lower cost as compared to excisional breast biopsy.\u00a0</p>\n<p>Fine-needle aspiration cytology (<strong>FNAC</strong>) is a <strong>cytological</strong> investigation and, hence, not the investigation of choice. A <strong>22-30 G</strong> needle is used for FNAC.</p>\n<p><strong>Trucut biopsy is preferred over FNAC</strong> as it:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Allows a definitive preoperative diagnosis</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Differentiates between DCIS and invasive disease</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Allows the tumor to be stained for receptor status, which is important for starting neoadjuvant therapy.\u00a0</li>\n</ul>\n<p>Image-guided biopsy is used only in the case of non-palpable lesions.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "As a surgery resident, which of the following will you perform in a patient with suspected breast malignancy as part of the triple assessment?",
    "choices": [
      {
        "id": 1,
        "text": "1,2, 3 and 4"
      },
      {
        "id": 2,
        "text": "2, 3 and 4"
      },
      {
        "id": 3,
        "text": "1, 2 and 3"
      },
      {
        "id": 4,
        "text": "1, 3 and 4"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Triple assessment</strong> in relation to breast carcinoma includes the following:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Clinical assessment includes both <strong>history and clinical examination</strong></li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Radiological imaging, including ultrasonography (USG) and/or mammography</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Histopathological examination (HPE), including fine-needle aspiration cytology (FNAC) and/or Tru-Cut biopsy</li>\n</ul>\n<p>The positive predictive value of the triple assessment is 99.9%.</p>\n<p>Note:<strong>&nbsp;</strong>Bailey &amp; Love 27th Ed mentions that clinical assessment, radiological imaging, and HPE constitute triple assessment. However, <strong>clinical assessment includes both history and clinical examination. </strong>Hence, history is a part of the triple assessment.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An actress with bilateral silicone breast implants presents for regular follow-up. On radiological evaluation, she was found to have signs suggestive of intracapsular breast implant rupture. Which of the following named signs will you see on imaging?",
    "choices": [
      {
        "id": 1,
        "text": "1, 2, 3 & 4"
      },
      {
        "id": 2,
        "text": "2 & 5"
      },
      {
        "id": 3,
        "text": "1 & 4"
      },
      {
        "id": 4,
        "text": "1, 3 & 5"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Snowstorm sign (seen on USG</strong>) is seen in extracapsular rupture of breast implant.</p>\n<p><strong>Comet tail sign</strong> is a finding that can be seen on chest CT. The comet-tail sign is produced by the distortion of vessels and bronchi that lead to an adjacent area of round atelectasis, which is the mass. The bronchovascular bundles appear to be pulled into the mass and resemble a comet tail.</p>\n<p>Note: Detection of intracapsular silicone ruptures is almost impossible on mammography.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/efbfc0dc10ea4e4b9e81a33773c1f114x512x219.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/533e0a52aa664aa4981be238df9cc447x1024x683.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/077bdfdcb20e41998f4995ff58542e54x512x171.PNG"
    ]
  },
  {
    "text": "A woman came with complaints of breast pain following surgery. Her MRI is shown below. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Extra-capsular silicone rupture"
      },
      {
        "id": 2,
        "text": "Contracture and calcification"
      },
      {
        "id": 3,
        "text": "Intra-capsular silicone rupture"
      },
      {
        "id": 4,
        "text": "Breast abscess"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The above image shows curvilinear hypointense lines (arrows) in the left breast implant indicative of the collapsed shell floating in the silicone gel. This is called the<strong> linguine sign</strong>&nbsp;that is seen in&nbsp;<strong>intra-capsular rupture&nbsp;of a breast implant. </strong></p>\n<p>After implantation of a silicone or saline&nbsp;breast implant, a fibrous capsule (scar) forms around the implant shell. In an intracapsular rupture, the contents of the implant are contained by the fibrous scar, while the shell appears as a group of wavy lines.</p>\n<p>This has been termed the \"linguine sign\" and has been most commonly described with MR imaging.</p>\n<p>Multiple hyperintense foci on T2-weighted images are sometimes found within the implant lumen. These findings are referred to as the <strong>salad oil sign</strong>&nbsp;or <strong>droplet sign</strong>.</p>\n<p>Indications for <strong>breast MRI</strong>:</p>\n<ul>\n<li>Screening for DCIS in <strong>high-risk</strong> patients</li>\n<li>Evaluation of breast <strong>implants</strong></li>\n<li>Evaluation of breast scar tissue versus recurrent tumors.</li>\n</ul>\n<p>Ultrasound is the preferred modality of imaging in suspected cases of extracapsular rupture. The <strong>s</strong><strong>nowstorm sign </strong>on USG&nbsp;is seen in&nbsp;<strong>extracapsular</strong>&nbsp;rupture.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/705643f457fa4facb315426db0d36d99.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 50-year-old female patient presents with a 4*3cm irregular mass in the upper outer quadrant of the right breast, which is not fixed to the skin or the chest wall. A lymph node of 2cm is palpated in the right axilla. No mass is palpated in the opposite breast. Which of the following investigations would you perform on this patient?",
    "choices": [
      {
        "id": 1,
        "text": "1, 2, 3 & 4"
      },
      {
        "id": 2,
        "text": "1, 2 & 3"
      },
      {
        "id": 3,
        "text": "1, 3 & 4"
      },
      {
        "id": 4,
        "text": "1 & 3"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario is suggestive of <strong>breast malignancy </strong>with locoregional spread with unlikely distant metastasis. \u00a0For further evaluation of this lesion, <strong>bilateral mammography, a biopsy </strong>of the breast<strong> mass </strong>and a\u00a0<strong>USG-guided biopsy </strong>of the <strong>suspicious lymph node</strong> need to be performed in order to determine staging and decide on further management.\u00a0</p>\n<p>Statement 2:<strong> PET Scan</strong> is usually performed in advanced cases of breast cancer. It is not routinely used in the assessment of locoregional disease.</p>\n<p>Statement 1:<strong> Diagnostic mammography</strong> is used to evaluate women with abnormal findings such as a breast mass or nipple discharge. Mammography is more accurate than clinical examination for the detection of early breast cancers. <strong>Mammographic features suggestive of breast cancer</strong> include a\u00a0solid mass with or without stellate features, microcalcifications, irregular soft tissue shadow, spiculations and duct distortion.</p>\n<p>Statement 3:<strong> Pathological diagnosis</strong> of carcinoma is made by a core needle biopsy (<strong>tru-cut biopsy</strong>) or fine-needle aspiration before any type of treatment is started.\u00a0</p>\n<p>Statement 4: The presence or absence of axillary lymph node involvement in breast cancer is one of the most important prognostic factors for determining staging and treatment. <strong>Ultrasound-guided lymph node biopsy</strong> should be done in patients with suspicious or clinically palpable lymph nodes.\u00a0</p>\n<p><strong>Ultrasound features</strong>\u00a0suggestive of breast cancer include a hypoechoic, irregular mass with indistinct, angulated or spiculated margins, acoustic shadowing, ductal extension and a branched pattern of mass.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 22-year-old woman is found to have the BRCA1 mutation. She got herself tested after her mother\u2019s death due to breast cancer with a BRCA1 mutation. At what age and with which modality would you start breast cancer screening in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "40 years - Mammogram"
      },
      {
        "id": 2,
        "text": "40 years - MRI"
      },
      {
        "id": 3,
        "text": "25 years - USG"
      },
      {
        "id": 4,
        "text": "25 years - MRI + Mammogram"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Patients with <strong>BRCA mutations</strong> or <strong>positive</strong> known <strong>first-degree</strong> family history are considered <strong>high-risk patients</strong>. These patients need to undergo <strong>annual screening MRI + Mammogram</strong> from the age of <strong>25yrs.</strong></p>\n<p>Patients with a family history of breast cancer but no known gene mutation should also start screening before 40 years. Screening should begin <strong>10 years before</strong> the earliest age of diagnosis of breast cancer in the first-degree relative. E.g- If the mother was detected with breast cancer at 40 years of age, the daughter should start screening by the age of 30 years.</p>\n<p><strong>High-risk patients</strong> for breast cancer:</p>\n<ol>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Women with a known BRCA1 or BRCA2 mutation</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Two first-degree relatives with breast cancers with or without gene mutations</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Women with a history of chest irradiation between the ages of 10 and 30</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">2 or more cases of breast cancer &lt; 50 years old in the family</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Mutation (or a first-degree relative with a mutation) in the TP53 or PTEN genes</li>\n</ol>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A young woman with a distant breast cancer relative comes to you in the clinic. You are advising her to practice self-examination of her breasts. Which of the following statements is incorrect regarding this practice?",
    "choices": [
      {
        "id": 1,
        "text": "It should be done once a month, every month"
      },
      {
        "id": 2,
        "text": "Ideally, be done between the 3rd to 6th day of the menstrual cycle"
      },
      {
        "id": 3,
        "text": "It should only be done while standing"
      },
      {
        "id": 4,
        "text": "The examination should be done by using the middle three fingerpads"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Self-examination of breasts</strong> can be done while <strong>standing</strong> or <strong>lying down.</strong></p>\n<p>It should be ideally be done <strong>once</strong> <strong>a month, every month</strong> between the <strong>3rd to 6th day</strong> of the <strong>menstrual cycle.</strong> If the periods are irregular or the patient is post-menopausal, then the patient can pick any day of the month.\u00a0</p>\n<p>It can be done any time of the day while showering, dressing, standing, or lying down at night.</p>\n<p>Steps of the<strong> self-examination:</strong></p>\n<ol>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Visual inspection: See for any abnormalities, like shape, size, dimpling, puckering of the skin, nipple discharge, etc.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Manual inspection: It is done by using the middle three fingerpads. Feel for any lumps. Techniques used are (either one of them):\u00a0\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Horizontal stripes method</strong></li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Vertical stripes method</strong></li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Dial clock method</strong></li>\n</ul>\n</li>\n</ol>\n<p>Be sure to check under the areola and press the nipple gently to check for any <strong>discharge.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/504a22df2e1245329a35d71199e408c6x344x208.PNG"
    ]
  }
];
        let quizName = '09 Investigations In Breast Diseases';
        let hierarchy = ["Marrow", "qBank", "Surgery"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>