<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>084 Pathology Neet 2021 - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / PYQs / Pathology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">15</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A 70-year-old patient presented with cough, fatiguability, and weight loss. He was diagnosed with squamous cell carcinoma (SCC) on bronchoscopy. The resected specimen had a hilar lymph node that was 1cm in size and showed a black pigment. What is the black pigment likely to be?",
    "choices": [
      {
        "id": 1,
        "text": "Anthracotic pigment"
      },
      {
        "id": 2,
        "text": "Melanin"
      },
      {
        "id": 3,
        "text": "Lipochrome"
      },
      {
        "id": 4,
        "text": "Hemosiderin"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Option D:&nbsp;<strong>Hemosiderin</strong> is a hemoglobin-derived <strong>golden-yellow</strong> colored pigment seen in conditions associated with iron overload such as hemochromatosis. The following image shows extensive intra-alveolar hemosiderin deposition following pulmonary hemorrhage.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/43b083f8eb02496abf32e6cc1281f222x1279x1086.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2fe02d8ad362433a97f09f76c318f950x1279x1086.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/fe8c2568e4f44f42b4610ae6edc243dax1280x1156.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8e1b8dbc72654c858b2250b690f06d39x1280x1239.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/33261f7e87c945c4b60a4916ad1f5d20x1280x1239.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1554faf40d574d00b6e437f281b5f750x1280x1156.JPEG"
    ]
  },
  {
    "text": "A 34-year-old female patient presented to the outpatient department with migratory arthritis and examination revealed a pan-systolic murmur. An echocardiography was performed which was suggestive of mitral regurgitation. A biopsy specimen was obtained and the image is provided below. What is the most likely lesion shown in the histopathology slide?",
    "choices": [
      {
        "id": 1,
        "text": "Aschoff's bodies"
      },
      {
        "id": 2,
        "text": "Epithelioid granuloma"
      },
      {
        "id": 3,
        "text": "Granulomatous vasculitis"
      },
      {
        "id": 4,
        "text": "Granuloma inguinale"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical findings of <strong>migratory arthritis, pan-systolic murmur, and mitral regurgitation</strong> are suggestive of <strong>acute rheumatic fever</strong><strong>.</strong> The most likely lesion shown in the histopathological slide is <strong>Aschoff's bodies.</strong></p>\n<p><strong>Aschoff's bodies</strong> are the lesions found in the heart during acute rheumatic fever. They are composed of foci of T lymphocytes, occasional plasma cells, and plump-activated macrophages called <strong>Anitschkow cells.</strong> Anitschkow cells have abundant cytoplasm and central round-to-ovoid nuclei with chromatin that is centrally condensed into a slender, wavy ribbon. Hence they are also called caterpillar cells.</p>\n<p>During acute rheumatic fever, Aschoff bodies may be found in any of the three layers of the heart that results in pericarditis, myocarditis, or endocarditis.&nbsp;</p>\n<p>Fibrinoid necrosis can occur due to inflammation of the endocardium and the left-sided valves. Over these areas of necrosis, small vegetations can be seen along the lines of closure, called verrucae. Irregular thickenings called MacCallum plaques can be present In the subendocardium.</p>\n<p>In chronic RHD, the mitral valve shows leaflet thickening, commissural fusion and shortening, and thickening and fusion of the tendinous cords. Calcification and fibrous bridging of the valve can lead to narrowing the mitral orifice and giving it a fish mouth appearance.<br /><br /></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/8ec6e106fa3049378b3225c4e1b11c62.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6031e6ed44f24170b9cdea19937062dax1280x925.JPEG"
    ]
  },
  {
    "text": "A 30-year-old male complained of fatigue for the past 1 year. Examination revealed massive splenomegaly. His blood workup shows the following findings. Which of the following is the most sensitive investigation in this case?",
    "choices": [
      {
        "id": 1,
        "text": "Immunophenotyping"
      },
      {
        "id": 2,
        "text": "LAP score"
      },
      {
        "id": 3,
        "text": "FISH and PCR"
      },
      {
        "id": 4,
        "text": "Flow cytometry"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The clinical presentation with fatigue, splenomegaly, and the peripheral blood smear findings are suggestive of <strong>chronic myelogenous leukemia(CML)</strong>. The <strong>BCR-ABL gene</strong> which is specific for CML is detected by&nbsp;fluorescence in situ hybridization<strong>(FISH)</strong> or polymerase chain reaction(<strong>PCR</strong>) based tests.</p>\n<p>Chronic myelogenous leukemia (CML) is a myeloproliferative disorder with the peak incidence in the fifth to sixth decade of life. The chimeric BCR-ABL gene&nbsp;is created by a <strong>reciprocal (9;22)(q34;q11) translocation(</strong><strong>Philadelphia chromosome</strong>)<strong>.&nbsp;</strong>This BCR-ABL gene distinguishes CML from other myeloproliferative disorders and is detected by<strong>&nbsp;fluorescent in situ hybridization (FISH) or polymerase chain reaction (PCR).</strong></p>\n<p>Clinical features:</p>\n<p>Mild to moderate anemia and hypermetabolism, fatigability, weakness, weight loss, and anorexia. Dragging sensation in the abdomen caused by splenomegaly, or the acute onset of left upper quadrant pain due to splenic infarction. The<strong> spleen is often greatly enlarged</strong> as a result of extensive extramedullary hematopoiesis. Extramedullary hematopoiesis can also produce mild <strong>hepatomegaly and lymphadenopathy.</strong></p>\n<p>Peripheral blood:</p>\n<ul>\n<li><strong>Leukocytosis&nbsp;</strong>with leukocyte count,<strong>&nbsp;</strong>often exceeding<strong> 100,000 cells/mm<sup>3</sup>,&nbsp;</strong>which consists predominantly of neutrophils, band forms, metamyelocytes, myelocytes, eosinophils, and basophils.</li>\n<li><strong>Blasts </strong>are usually<strong> less than 10% </strong>of the circulating cells.</li>\n<li>Platelet count is usually increased</li>\n</ul>\n<p>Bone Marrow:</p>\n<ul>\n<li>Markedly <strong>hypercellular </strong>marrow because of massively increased numbers of <strong>maturing granulocytic precursors. </strong>There is<strong>&nbsp;</strong>usually<strong>&nbsp;</strong>an elevated proportion of eosinophils and basophils.</li>\n<li>There is also an increase in megakaryocytes&nbsp;and usually include small, dysplastic forms and erythroid progenitors are present in normal or mildly decreased numbers. Typically there is an increased reticulin deposition, but overt marrow fibrosis is rare early in the course.</li>\n<li><strong>Sea-blue histiocytes</strong> - These are scattered macrophages with abundant wrinkled,green-blue cytoplasm.</li>\n</ul>\n<p>Other options:</p>\n<p>Immunophenotyping and flow cytometry: Flow cytometry refers to the measurement of cellular antigens as they flow in a fluid stream. Immunophenotyping is employed using labeled antibodies against specific epitopes of cellular antigens. The technique that is usually used in immunophenotyping is flow cytometry. It has a limited role in the diagnosis of CML. It is mainly used in identifying CML blast transformation.</p>\n<p>LAP score: Leucocyte alkaline phosphatase(LAP) score is<strong> decreased</strong> in cases of CML. It is only a&nbsp;first-line test in the diagnosis of CML and the diagnosis needs to be confirmed by other tests including bone marrow biopsy, molecular diagnostics, and cytogenetic analysis.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A girl presents with short stature, webbed neck, thick calves, shield-shaped chest, swelling of the ankle, and increased carrying angle. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Turner syndrome"
      },
      {
        "id": 2,
        "text": "Down syndrome"
      },
      {
        "id": 3,
        "text": "Patau syndrome"
      },
      {
        "id": 4,
        "text": "Edward syndrome"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Other options:</p>\n<p>Option B: Important features associated with Down\u2019s syndrome (Trisomy 21) include\u00a0</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Intellectual disability</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Congenital heart defects</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Epicanthic folds and flat facial profile</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Simian crease</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Umbilical hernias</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Predisposition to leukemia</li>\n</ul>\n<p>Option C: Important features associated with Patau syndrome (Trisomy 13):</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Microphthalmia</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Microcephaly and intellectual disability</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Cleft lip and palate</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Rocker-bottom feet</li>\n<li>Cardiac and renal defects</li>\n</ul>\n<p>Option D: Important features associated with Edward syndrome (Trisomy 18):</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Prominent occiput, micrognathia, low set ears</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Intellectual disability</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Renal and cardiac malformations</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Limited hip abduction, rocker-bottom feet</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c4dfd4496adb40fa9da24e97f7f28d9bx1279x1467.JPEG"
    ]
  },
  {
    "text": "A patient with occupational exposure to benzene presents with repeated infections, easy fatigability, weight loss, and evening rise of temperature. This occupational exposure will predispose him to which of the following cancers?",
    "choices": [
      {
        "id": 1,
        "text": "Leukemia"
      },
      {
        "id": 2,
        "text": "Lung cancer"
      },
      {
        "id": 3,
        "text": "Bladder cancer"
      },
      {
        "id": 4,
        "text": "Skin cancer"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Occupational exposure to <strong>benzene</strong>&nbsp;predisposes to <strong>leukemia</strong>. The given clinical history of repeated infections, easy fatigability, weight loss, and evening rise of temperature with benzene exposure points towards a diagnosis of <strong>leukemia</strong>.</p>\n<p>Benzene is oxidized to an epoxide through hepatic CYP2E1. The epoxide and other metabolites disrupt progenitor cell differentiation in the bone marrow and lead to marrow aplasia and <strong>acute myeloid leukemia.</strong></p>\n<p>Acute myeloid leukemia is a tumor of hematopoietic&nbsp;progenitors caused by acquired oncogenic mutations that&nbsp;impede differentiation. This leads to the accumulation of&nbsp;immature myeloid blasts in the marrow. The replacement&nbsp;of the marrow with blasts produces marrow failure and&nbsp;complications related to anemia, thrombocytopenia, and&nbsp;neutropenia.</p>\n<p>Other options:&nbsp;</p>\n<p>Option B: Exposure to arsenic and its compounds, asbestos, beryllium and its compounds, chromium compounds, nickel compounds, radon, and its decay products can cause <strong>lung cancer.</strong></p>\n<p>Option C: Exposure to aryl amines, particularly&nbsp;2-naphthylamine and related compounds, cyclophosphamide, cigarette smoking, irradiation&nbsp;can cause <strong>bladder cancer.</strong></p>\n<p>Option D: Exposure to UV rays, arsenic, and its compounds can cause <strong>skin cancer.</strong></p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In iron deficiency anemia, all of the following is increased except",
    "choices": [
      {
        "id": 1,
        "text": "Transferrin saturation"
      },
      {
        "id": 2,
        "text": "RBC protoporphyrin"
      },
      {
        "id": 3,
        "text": "Total iron binding capacity"
      },
      {
        "id": 4,
        "text": "Ferritin soluble receptors"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Transferrin saturation</strong> is <strong>decreased&nbsp;</strong>in&nbsp;iron deficiency anemia.</p>\n<p>Clinical presentation may include&nbsp;fatigue, pallor, reduced&nbsp;exercise capacity.&nbsp;Cheilosis (fissures at the corners of the mouth) and&nbsp;koilonychia (spooning of the fingernails) are signs of advanced tissue&nbsp;iron deficiency.&nbsp;</p>\n<p>Laboratory findings are:</p>\n<ul>\n<li><strong>Reduced hemoglobin</strong> and <strong>hematocrit</strong> values.</li>\n<li><strong>hypochromia</strong>, <strong>microcytosis</strong>, and <strong>poikilocytosis</strong>.</li>\n<li><strong>serum iron</strong> and <strong>ferritin</strong> levels are <strong>low</strong>.</li>\n<li>The <strong>total plasma iron-binding capacity</strong> that reflects the elevated transferrin levels is <strong>high</strong>.</li>\n<li>Low serum iron with increased iron-binding capacity results in a reduction of <strong>transferrin saturation</strong> to below 15%.</li>\n<li><strong>RBC protoporphyrin</strong> levels are <strong>increased</strong>. Protoporphyrin is an intermediate&nbsp;in the heme synthesis pathway. Under conditions in which&nbsp;heme synthesis is impaired, protoporphyrin accumulates within the&nbsp;red cell.</li>\n<li>Bone marrow reveals a mild to moderate increase in erythroid progenitors. The absence of stainable iron in macrophages is a diagnostically significant finding.</li>\n</ul>\n<p>Peripheral smear of microcytic hypochromic anemia:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a400805edf5a4c34a0e6b334f4dfdf41x750x600.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6ccb468bdae74702bae861f29829571dx1279x1210.JPEG"
    ]
  },
  {
    "text": "Which of the following is a poor prognostic marker of multiple myeloma?",
    "choices": [
      {
        "id": 1,
        "text": "\u03b2-2 microglobulin"
      },
      {
        "id": 2,
        "text": "Calcium levels"
      },
      {
        "id": 3,
        "text": "Serum creatinine"
      },
      {
        "id": 4,
        "text": "Protein levels"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Bence Jones proteins are excreted in the kidney and causes myeloma kidney.&nbsp;Most myelomas are associated with&nbsp;more than 3 g/dL of serum Ig and/or more than 6 mg/dL&nbsp;of urine Bence Jones protein. The most common monoclonal&nbsp;Immunoglobulin (M protein) is IgG followed&nbsp;by IgA.</p>\n<p>The clinicopathologic diagnosis of multiple myeloma can be done based on the identification of clonal plasma cells in the marrow and the presence of CRAB criteria (hypercalcemia, renal&nbsp;dysfunction, anemia, and bone lesions).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9cd21b312a054378aad28e8c29aeb894x760x600.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6ff0a51f653049598c0d7d773bedb9a9x750x600.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4b386ed91acb491fa18efec3049db6d8x800x600.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/19d175f5586b4afa81a5a482350ac676x633x600.JPEG"
    ]
  },
  {
    "text": "A pap smear taken from a patient revealed hyperchromatic nuclei, irregular nuclear borders, and low maturation index involving the whole thickness but did not breach the basement membrane. What is the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Dysplasia"
      },
      {
        "id": 2,
        "text": "Carcinoma"
      },
      {
        "id": 3,
        "text": "Metaplasia"
      },
      {
        "id": 4,
        "text": "Hyperplasia"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The hyperchromatic nuclei, irregular nuclear borders, and intact basement membrane are all suggestive of <strong>dysplasia</strong>.</p>\n<p>Dysplasia is characterized by the loss in the uniformity of the individual cells and their architectural orientation. The features of dysplasia include:</p>\n<ul>\n<li><strong>Pleomorphism</strong></li>\n<li><strong>Hyperchromatic nuclei</strong></li>\n<li>High nuclear-to-cytoplasmic ratio</li>\n<li>Increased mitotic figures</li>\n</ul>\n<p>When the dysplastic changes involve the entire thickness of the epithelium without breaching the basement membrane it is considered preinvasive and is termed <strong>carcinoma-in-situ</strong>. If the tumor invades the basement membrane it is said to be invasive.&nbsp;</p>\n<p>Dysplasia can be considered as a precursor to malignant but it does not always progress to cancer. Dysplasia usually occurs in the metaplastic epithelium but all metaplastic epithelium is not dysplastic.</p>\n<p>Other options:</p>\n<p>Metaplasia: It refers to the replacement of one cell type with another type. It is almost always associated with tissue damage, repair, and regeneration. The most common epithelial metaplasia is columnar to squamous.&nbsp;</p>\n<p>Carcinoma: In carcinoma, there is the <strong>invasion of the basement membrane</strong>.</p>\n<p>Hyperplasia: It refers to the increase in the number of cells in a tissue or organ. It can be physiologic or pathological. Enlargement of the female breast during pregnancy is physiologic hyperplasia. Endometrial hyperplasia is an example of pathological hyperplasia.</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The mother of a 12-year-old girl was worried that her daughter is shorter when compared with her classmates. On examination, the child had a webbed neck, low hairline, and shield chest. A provisional diagnosis of Turner's syndrome was made. Which of the following is a likely finding to be seen in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Aortic dissection"
      },
      {
        "id": 2,
        "text": "Subluxation of lens"
      },
      {
        "id": 3,
        "text": "Mitral valve prolapse"
      },
      {
        "id": 4,
        "text": "Bilateral small streak ovaries"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The likely finding seen in a patient with Turner syndrome is <strong>bilateral small streak ovaries.</strong></p>\n<p>Turner syndrome results from complete or partial&nbsp;monosomy of the X chromosome. It is characterized&nbsp;by hypogonadism in phenotypic females.&nbsp;It is the most&nbsp;common sex chromosome abnormality in females. Three types of karyotypic&nbsp;abnormalities are seen</p>\n<ul>\n<li>Missing an entire X chromosome - this results in a 45X karyotype.</li>\n<li>Structural abnormalities&nbsp;of the X chromosomes - isochromosome of the long arm and&nbsp;loss of the short arm, 46X,i(X)(q10),&nbsp;deletion of&nbsp;portions of both long and short arms that lead to the&nbsp;formation of a ring chromosome, 46X,r(X),&nbsp;deletion&nbsp;of portions of the short or long arm, 46X,del(Xq) or&nbsp;46X,del(Xp).</li>\n<li>Mosaics - they will have 45X along with&nbsp;one or more karyotypically normal or abnormal cell types. Examples are 45X/46XX, 45X/46XY, 45X/47XXX, 45X/46X,i(X)(q10).</li>\n</ul>\n<p>Important features associated with Turner's syndrome:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Short stature</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Webbing of neck</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Broad chest and widely spaced nipples</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Cubitus valgus</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Streak ovaries</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Infertility, amenorrhea</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Peripheral lymphedema at birth</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Low posterior hairline</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Broad chest and widely spaced nipples</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Pigmented nevi</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Coarctation of aorta</li>\n</ul>\n<p>There is failure to develop&nbsp;normal secondary sex characteristics at&nbsp;puberty.&nbsp;The genitalia remain&nbsp;infantile, breast development is inadequate, and there is little&nbsp;pubic hair. Short stature and&nbsp;amenorrhea are of&nbsp;particular importance in&nbsp;establishing the diagnosis in an adult.</p>\n<p>Other options:</p>\n<p>Aortic dissection, subluxation of lens, and mitral valve prolapse are seen in Marfan syndrome.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9afb7cf863714eae8c3633cb5daa6595x1279x1467.JPEG"
    ]
  },
  {
    "text": "An 18-year-old male presented to the outpatient department with gum bleeding and fever for the past 2 months. General examination showed pallor and the systemic examination was unremarkable. Laboratory examination revealed Hb level- 3 gm/dl, TLC- 1500/microL, platelet count- 15000/microL. Peripheral smear shows macrocytes and the reticulocyte count is 0.5. Bone marrow examination revealed fatty streaks and absent megakaryocytes but no immature cells. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Idiopathic acquired aplastic anemia"
      },
      {
        "id": 2,
        "text": "Paroxysmal nocturnal hemoglobinuria"
      },
      {
        "id": 3,
        "text": "Myelodysplastic syndrome"
      },
      {
        "id": 4,
        "text": "Tuberculosis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Other options:&nbsp;</p>\n<p>Option B -&nbsp;<strong>Paroxysmal nocturnal hemoglobinuria</strong> (PNH) is an acquired disorder resulting from the mutation in the phosphatidylinositol glycan complementation group A gene (PIGA), an enzyme that is essential for the synthesis of membrane-associated complement regulatory proteins. Red cells deficient in these proteins are susceptible to intravascular hemolysis. Patients with PNH usually present with pancytopenia and <strong>reticulocytosis</strong> with bone marrow biopsy showing a&nbsp;<strong>cellular</strong> marrow with marked to massive erythroid hyperplasia.</p>\n<p>Option C - <strong>Myelodysplastic syndromes (MDS)</strong> are a group of clonal stem cell disorders. It is a consequence of maturation defects that result in ineffective hematopoiesis with a high predisposition to conversion to AML. They are characterized by a <strong>hypercellular marrow with dysplastic cells</strong> on bone marrow aspirate. Marrow changes seen in MDS are given in the pearl below.</p>\n<p>Option D -&nbsp;Pulmonary tuberculosis (TB) is caused by Mycobacterium tuberculosis and patients often present with fever, productive cough, blood-streaked sputum, night sweats, malaise, loss of appetite, and weight loss.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7be3793cd38f4d62bddf3f49ef173e59x600x450.JPEG"
    ]
  },
  {
    "text": "A child is presenting with palpable blanching purpura, abdominal pain, and pain in the knee joint resulting from arthritis. Urine examination showed hematuria and proteinuria. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Immune thrombocytopenic purpura"
      },
      {
        "id": 2,
        "text": "Dengue"
      },
      {
        "id": 3,
        "text": "Churg- Strauss syndrome"
      },
      {
        "id": 4,
        "text": "Henoch-Schonlein purpura"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The clinical presentation and the investigations are suggestive of&nbsp;<strong>Henoch-Schonlein purpura</strong>.</p>\n<p><strong>Henoch-Sch&ouml;nlein purpura</strong>&nbsp;is a systemic immune disorder characterized by a purpuric rash, abdominal pain, polyarthralgia, and renal abnormalities. It is most commonly seen in the age group of 3-8 years. The patient may present with the following clinical features:</p>\n<ul>\n<li class=\"p1\"><strong>Skin lesions</strong>- characteristically involve the&nbsp;<strong>extensor surfaces of arms and legs,</strong>&nbsp;and also the buttocks</li>\n<li class=\"p1\"><strong>Abdominal manifestations</strong>- include&nbsp;pain<strong>,</strong>&nbsp;vomiting, and intestinal bleeding.</li>\n<li class=\"p1\"><strong>Renal manifestations</strong>- include&nbsp;<strong>gross or microscopic hematuria</strong>, nephritic syndrome, or nephrotic syndrome. Renal manifestations are more severe in adults. A rapidly progressive form of glomerulonephritis is seen in some cases.</li>\n</ul>\n<p>This condition usually occurs following an upper respiratory tract infection and there is a history of atopy in one-third of the cases.&nbsp;IgA is deposited in the glomerular mesangium in a distribution similar to that of IgA nephropathy.</p>\n<p>Microscopic findings:</p>\n<ul>\n<li><strong>IgA deposition</strong> in the mesangial region. Sometimes there is the deposition of IgG and C3 along with IgA.</li>\n<li>Renal lesions show focal or diffuse mesangial proliferation, and/or endocapillary proliferation to crescentic glomerulonephritis.</li>\n<li>Skin lesions show subepidermal hemorrhages and necrotizing vasculitis of small vessels.</li>\n</ul>\n<p>Other options:</p>\n<p>Option A: Immune thrombocytopenic purpura(ITP): It occurs due to <strong>antibody-mediated destruction</strong> of <strong>platelets</strong>. It can be acute or chronic. Acute ITP is usually self-limiting in nature. Cutaneous bleeding can be in the form of petechiae and ecchymoses. The patient can also have hematuria, melena, or excessive menstrual flow.&nbsp;</p>\n<p>Option B: Dengue: It is a viral illness caused by the dengue virus. The clinical manifestations include fever, headache, musculoskeletal pain, and rash. The rash which is maculopapular in nature begins on the trunk and then spreads centrifugally to the face and extremities.</p>\n<p>Option C: Churg- Strauss syndrome (Eosinophilic granulomatosis with polyangiitis): It is characterized by <strong>eosinophilic vasculitis</strong> of multiple organs. The features of this condition include&nbsp;asthma, peripheral eosinophilia, pulmonary infiltrates, neuropathy, paranasal sinus abnormality, and the presence of eosinophilic vasculitis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 54-year-old patient presents to the outpatient department with fatigue, tiredness and cervical lymphadenopathy. The TLC and DLC were normal. No immature cells. A lymph node biopsy was performed which shows diffuse effacement of the lymph node architecture, cells with an indented nucleus, prominent nucleolus, and are atypical. CD10 and BCL2 are positive. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Follicular lymphoma"
      },
      {
        "id": 2,
        "text": "Burkitt lymphoma"
      },
      {
        "id": 3,
        "text": "Mycosis fungoides"
      },
      {
        "id": 4,
        "text": "Chronic myeloid leukemia"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Other options -&nbsp;</p>\n<p>Option B -&nbsp;Burkitt lymphoma is an aggressive type of non-Hodgkin lymphoma (NHL).&nbsp;It is also known as&nbsp;<strong>small non-cleaved-cell lymphoma&nbsp;</strong>and is&nbsp;characterized by the translocation and deregulation of the <strong>c</strong>-<strong>MYC gene</strong>&nbsp;on&nbsp;<strong>chromosome 8 to chromosome 14 or 22</strong><strong>&nbsp;- t(8:14) or t(8:22).</strong>&nbsp;Histopathology of the tumor reveals a <strong>starry sky appearance</strong> created by apoptotic cells and macrophages containing clear cytoplasm.</p>\n<p>Option C - Mycosis fungoides is the most common type of <strong>cutaneous</strong> <strong>T-cell lymphoma</strong>.&nbsp;The histological hallmark of cutaneous T-cell lymphoma (mycosis fungoides type) is the presence of&nbsp;<strong>Pautrier microabscess.</strong>&nbsp;The presence of B-cell markers in the question rules out the differential of mycosis fungoides.</p>\n<p>Option D - Chronic Myeloid Leukemia (CML) is a myeloproliferative neoplasm characterized by the presence of<strong>&nbsp;chimeric BCR-ABL gene&nbsp;</strong>which is a result of a r<strong>eciprocal (9;22)(q34;q11) translocation (Philadelphia chromosome).</strong>&nbsp;The presence of lymphadenopathy in the given scenario rules out the possibility of CML as it is a myeloid disorder.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4f0c61d211314abb8bbe583ca3bb311ex800x533.JPEG"
    ]
  },
  {
    "text": "A software engineer presents to the outpatient department with easy fatiguability. He gives a history of sitting in front of the computer for 12 - 14 hours. He consumes a lot of junk food with very less fruits and vegetables. Hb is 9gm/dl and MCV 120 fl. What is the most likely cause of this patient's anemia?",
    "choices": [
      {
        "id": 1,
        "text": "Cyanocobalamin deficiency"
      },
      {
        "id": 2,
        "text": "Folic acid deficiency"
      },
      {
        "id": 3,
        "text": "Iron deficiency"
      },
      {
        "id": 4,
        "text": "Hereditary spherocytosis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Other options:</p>\n<p>Option A - In <strong>cyanocobalamin deficiency, </strong>MCV will be increased.&nbsp;But the dietary sources of&nbsp;cyanocobalamin are mainly of&nbsp;animal products. In the given clinical scenario there is&nbsp;inadequate intake of<strong> fruits and vegetables. </strong>Hence, this is not the answer.</p>\n<p>Option C - In iron deficiency anemia, MCV will be decreased.</p>\n<p>Option D - In hereditary spherocytosis, MCV will be normal.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a0e0964f13334a39a5dabe9d7052d9f4x474x474.JPEG"
    ]
  },
  {
    "text": "A chronic alcoholic patient presented with increasing abdominal girth. On examination, shifting dullness was present and the liver span was less than 7cm. Histopathological examination revealed the presence of intracytoplasmic eosinophilic inclusions in hepatocytes. What is the content of these inclusions?",
    "choices": [
      {
        "id": 1,
        "text": "Intermediate filaments"
      },
      {
        "id": 2,
        "text": "Actin"
      },
      {
        "id": 3,
        "text": "Microtubules"
      },
      {
        "id": 4,
        "text": "Fibronectin"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The clinical scenario given here describes <strong>alcoholic hepatitis.</strong> In this condition, there are intracytoplasmic eosinophilic inclusions called <strong>Mallory Denk bodies</strong> and they contain <strong>intermediate filaments</strong>.&nbsp;</p>\n<p>The liver undergoes inflammation and fibrosis in <strong>alcoholic hepatitis</strong>. This leads to injured and swollen hepatocytes with cleared-out cytoplasm and cytoskeletal damage. These hepatocytes are called <strong>ballooned hepatocytes</strong>. When the cytoskeletal damage is extensive, there is the formation of<strong> Mallory Denk/ Mallory hyaline bodies</strong>. These are remnants of <strong>partially degraded intermediate filaments </strong>and are composed of keratin filaments.&nbsp;</p>\n<p>Cytoskeletal proteins include intermediate filaments, microfilaments (made up of <strong>actin - </strong>option B), and <strong>microtubules </strong>(option - C).</p>\n<p>Intermediate filaments provide a flexible scaffold to organize cytoplasm and prevent external forces from acting on the cell. They are of five types:</p>\n<ul>\n<li>Keratin filaments (epithelial cells)</li>\n<li>Neuro filaments (neurons)</li>\n<li>Desmin filaments (muscles)</li>\n<li>Vimentin filaments (connective tissues)</li>\n<li>Glial filaments (glial cells)</li>\n</ul>\n<p><strong>Fibronectin (option D)</strong> is an adhesive glycoprotein. Its presence in cervicovaginal secretions before rupture of membranes is a possible marker for impending preterm labor.</p>\n<p>The given image shows intracytoplasmic eosinophilic Mallory bodies.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/10d91fea144f4264a44653915f0f34a6x720x448.JPEG"
    ]
  },
  {
    "text": "A 65-year-old female patient is diagnosed with pure red cell aplasia and a mediastinal mass. Which of the following can be the likely cause?",
    "choices": [
      {
        "id": 1,
        "text": "Thymoma"
      },
      {
        "id": 2,
        "text": "Non Hodgkin lymphoma"
      },
      {
        "id": 3,
        "text": "Bronchogenic Carcinoma"
      },
      {
        "id": 4,
        "text": "Germ cell tumor"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The most probable diagnosis for the clinical presentation of mediastinal mass with pure red cell aplasia is <strong>thymoma</strong>.&nbsp;</p>\n<p>Thymoma refers to the tumors of the thymic epithelial cells. Most of the thymic tumors occur in the<strong> anterior mediastinum</strong>. Clinical features can be chest pain, dyspnea, cough, or superior vena cava syndrome.</p>\n<p>It is associated with paraneoplastic syndromes like myasthenia gravis, <strong>pure red cell aplasia</strong>, or hypogammaglobulinemia. It is rarely associated with limbic encephalitis, hemolytic anemia, aplastic anemia, and other autoimmune conditions like Sjogren's syndrome.</p>\n<p><strong>Pure red cell aplasia</strong>: It is a marrow disorder where the erythroid progenitors are only suppressed. The complete absence of red cell progenitors is seen in severe cases.</p>\n<p>Causes of pure red cell aplasia: It can be hereditary or acquired.&nbsp;<strong>Diamond-Blackfan anemia</strong> or congenital pure red cell aplasia is the hereditary cause. Causes of acquired pure red cell aplasia are given below:</p>\n<ul>\n<li>Cancer<br />\n<ul>\n<li><strong>Thymoma</strong></li>\n<li>Lymphoid malignancies (eg. Non-Hodgkin's lymphoma, large granular lymphocytosis)</li>\n<li>Paraneoplastic to solid tumors</li>\n</ul>\n</li>\n<li>Connective tissue disorders with immunologic abnormalities<br />\n<ul>\n<li>Systemic lupus erythematosus, rheumatoid arthritis</li>\n</ul>\n</li>\n<li>Viruses\n<ul>\n<li>Persistent B19 parvovirus, hepatitis, adult T cell leukemia virus, Epstein-Barr virus</li>\n</ul>\n</li>\n<li>Drugs\n<ul>\n<li>Phenytoin, azathioprine, chloramphenicol, procainamide, isoniazid</li>\n</ul>\n</li>\n<li>Multiple endocrine gland insufficiency</li>\n<li>Antibodies to erythropoietin</li>\n<li>Idiopathic</li>\n</ul>\n<p>Other options:</p>\n<p>Option B: Non-Hodgkin's lymphoma can cause pure red cell aplasia but it commonly presents as peripheral adenopathy rather than mediastinal mass.</p>\n<p>Options C and D: Germ cell tumors and bronchogenic carcinoma are not commonly known to be associated with red cell aplasia.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '084 Pathology Neet 2021';
        let hierarchy = ["Marrow", "PYQs", "Pathology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>