<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>12 Vesiculobullous Diseases - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Dermatology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">31</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following is a subepidermal disease?",
    "choices": [
      {
        "id": 1,
        "text": "Darier's Disease"
      },
      {
        "id": 2,
        "text": "Bullous impetigo"
      },
      {
        "id": 3,
        "text": "Pemphigus foliaceus"
      },
      {
        "id": 4,
        "text": "Bullous pemphigoid"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Bullous pemphigoid</strong> is a<strong> subepidermal vesiculobullous</strong> disorder.</p>\n<p>In bullous pemphigoid, there is subepidermal <strong>separation</strong>&nbsp;at the <strong>dermo-epidermal junction&nbsp;</strong>(DEJ). Eosinophilic and neutrophilic infiltration are noted. It is not associated with acantholysis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The skin biopsy from a patient with a vesiculobullous disease is shown below. What is the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Pemphigus vulgaris"
      },
      {
        "id": 2,
        "text": "Pemphigus foliaceus"
      },
      {
        "id": 3,
        "text": "Dermatitis herpetiformis"
      },
      {
        "id": 4,
        "text": "Bullous pemphigoid"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The image shows&nbsp;a<strong> sub-epidermal split </strong>that is suggestive of<strong> bullous pemphigoid</strong>.</p>\n<p>As the <strong>antibodies</strong> in bullous pemphigoid are directed against <strong>BPAg2</strong> and <strong>BPAg1</strong> present in the <strong>basement membrane</strong> zone, intercellular junctions are intact and <strong>acantholysis</strong> is<strong> not seen</strong>.</p>\n<p>Option A: Pemphigus vulgaris is characterized by intraepidermal (suprabasal) acantholytic blisters.</p>\n<p>Option B: Pemphigus foliaceus shows intraepidermal (subcorneal) acantholytic blisters.</p>\n<p>Option C: In dermatitis herpetiformis, there are papillary tip micro-abscesses.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/6c271a455acc448b82aa3b44929f3fcf.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A patient presented with pruritic blisters. Direct immunofluorescence microscopy for IgG was done. Which of the following statements is incorrect regarding this condition?",
    "choices": [
      {
        "id": 1,
        "text": "It is a disease of the elderly"
      },
      {
        "id": 2,
        "text": "Oral erosions are frequently seen"
      },
      {
        "id": 3,
        "text": "Tense bullae are seen"
      },
      {
        "id": 4,
        "text": "Nikolsky sign is negative"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Linear IgG deposits</strong>&nbsp;on direct immunofluorescence (DIF) microscopy are characteristic of <strong>bullous pemphigoid</strong>. <strong>Oral erosions</strong> are a&nbsp;<strong>rare</strong>&nbsp;feature.</p>\n<p>Bullous pemphigoid is an <strong>autoimmune</strong> disease of the <strong>elderly</strong>, between 70 to 80 years.&nbsp;<strong>Bullae</strong> are <strong>tense</strong> and very <strong>pruritic</strong>, mostly present on the <strong>flexural</strong> aspects of limbs and abdomen. They may reach several centimeters in size. The bullae are&nbsp;<strong>Nikolsky</strong>&nbsp;<strong>negative </strong>as acantholysis is absent.</p>\n<p>On DIF microscopy, an <strong>n-serrated</strong> pattern is seen on 600-fold magnification.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/90d8351fa8074fd28b0e4db3d185fc08.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/df75990f1b4a43deb37a8cfede1c3715x1280x1186.JPEG"
    ]
  },
  {
    "text": "A patient presents with the following itchy lesions. On examination, Nikolsky sign is negative.  Autoantibodies against which of the following antigens are most commonly seen in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "BP180"
      },
      {
        "id": 2,
        "text": "BP230"
      },
      {
        "id": 3,
        "text": "BP280"
      },
      {
        "id": 4,
        "text": "Desmoglein 1"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Tense bullae</strong>&nbsp;over the <strong>flexor</strong> aspect that are <strong>Nikolsky negative</strong> are suggestive of<strong>&nbsp;bullous pemphigoid.&nbsp;</strong>Autoantibodies against&nbsp;<strong>BP180&nbsp;</strong>are most commonly seen in this condition.</p>\n<p>BP180 is also known as <strong>BPAg2</strong> and it is seen in&nbsp;<strong>75&ndash;90%</strong> of bullous pemphigoid patients.&nbsp;Autoantibodies against <strong>BP230</strong> or <strong>BPAg1</strong> are recognized in <strong>50&ndash;70%</strong> of bullous pemphigoid patients.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/dfd2160b4ea74dd5bfc4bc4f70d2a5cc.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "While examining a patient with pemphigus vulgaris, you notice that applying pressure on top of the bulla causes it to extend to the adjacent unblistered skin. What is this sign known as?",
    "choices": [
      {
        "id": 1,
        "text": "Asboe-Hansen sign"
      },
      {
        "id": 2,
        "text": "Nikolsky sign"
      },
      {
        "id": 3,
        "text": "Dimple sign"
      },
      {
        "id": 4,
        "text": "Bulla spread sign"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The <strong>extension</strong> of a <strong>blister</strong> to adjacent unblistered skin when <strong>pressure </strong>is applied over the<strong> top</strong> of the bulla is known as<strong>\u00a0</strong>the<strong> Asboe-Hansen sign</strong>.\u00a0</p>\n<p>Option B: <strong>Nikolsky</strong> sign\u00a0refers to <strong>easy peeling</strong> of skin on applying <strong>tangential pressure</strong> over a bony prominence. It is classically seen in pemphigus vulgaris, pemphigus foliaceus, and staphylococcal scalded skin syndrome.</p>\n<p>Option C: <strong>Dimple sign</strong>\u00a0refers to the dimpled appearance of a <strong>dermatofibroma</strong> on squeezing the adjacent skin.</p>\n<p>Option D:\u00a0The traditional <strong>bulla spread </strong>or<strong> Lutz sign\u00a0</strong>involves applying <strong>lateral</strong><strong>\u00a0pressure</strong>\u00a0to the blister, which causes the spread of the bulla.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 4-year-old girl was brought by her parents with itchy blisters on her face and buttocks that developed quite suddenly. History revealed an episode of streptococcal pharyngitis 2 weeks ago that was treated with penicillin. Direct immunofluorescence microscopy revealed IgA deposition, as shown in the image below. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Hailey-Hailey disease"
      },
      {
        "id": 2,
        "text": "Chronic bullous disease of childhood"
      },
      {
        "id": 3,
        "text": "Epidermolysis bullosa dystrophicans"
      },
      {
        "id": 4,
        "text": "Epidermolysis bullosa simplex"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given image showing&nbsp;linear deposition of IgA at the dermo-epidermal junction is diagnostic for&nbsp;<strong>linear IgA disease</strong>&nbsp;or <strong>chronic bullous disorder of childhood</strong> or IgA pemphigoid.</p>\n<p>It&nbsp;is the <strong>most common&nbsp;immunobullous</strong> disease in <strong>infants</strong> and <strong>children.</strong> It may occur <strong>&lt;</strong><strong>5 years</strong> or at&nbsp;<strong>60-65 years</strong> of age.&nbsp;It occurs in <strong>genetic</strong>ally susceptible individuals and can be triggered by <strong>drugs</strong> like vancomycin, penicillin, and NSAIDs.&nbsp;The main target antigen is <strong>BP180</strong> or <strong>BPAg2</strong>.&nbsp;</p>\n<p>The classic <strong>triad</strong> of clinical features is:</p>\n<ol>\n<li>Tense blisters</li>\n<li>Vesicles</li>\n<li>Annular erythema</li>\n</ol>\n<p>Onset is abrupt in children with involvement of the perioral and perianal regions. In adults, the extensor areas and trunk are affected.&nbsp;The blisters are arranged in an&nbsp;<strong>annular </strong>pattern. This is called the <strong>crown of jewels</strong> or <strong>string of pearls</strong> appearance, as shown below.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/16faf56b9efd4d8395284d55556246f0.PNG"
    ],
    "explanation_images": [
      "https://cdn1.dailyrounds.org/uploads/0671f523c7034c6eab5e1ed19ed2e66ex800x501.JPEG"
    ]
  },
  {
    "text": "A child presents to OPD with tense bullae over the torso. Biopsy of the lesion showed a subepidermal level of blistering and neutrophil infiltration. What is the drug of choice?",
    "choices": [
      {
        "id": 1,
        "text": "Rituximab"
      },
      {
        "id": 2,
        "text": "Dapsone"
      },
      {
        "id": 3,
        "text": "Cyclosporine"
      },
      {
        "id": 4,
        "text": "Azathioprine"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>This clinical scenario with tense blisters showing\u00a0<strong>subepidermal separation</strong> and\u00a0<strong>neutrophilic infiltration</strong>\u00a0at the basement membrane points towards a diagnosis of <strong>IgA pemphigoid</strong> or linear IgA disease or\u00a0chronic bullous disease of childhood. The drug of choice is <strong>dapsone</strong>. It is bacteriostatic against M. leprae.</p>\n<p>It also has an anti-inflammatory action by decreasing the action of neutrophil enzymes. Hence, it is useful in the treatment of IgA pemphigoid, linear IgA disease and chronic bullous disease of childhood.</p>\n<p>\u00a0</p>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/83a18f915fda4852b1c15c6958e66ac2.png"
    ],
    "explanation_images": []
  },
  {
    "text": "In patients with which of the following conditions would you perform direct immunofluorescence microscopy for diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Epidermolysis bullosa simplex"
      },
      {
        "id": 2,
        "text": "Epidermolysis bullosa acquisita"
      },
      {
        "id": 3,
        "text": "Hailey-Hailey disease"
      },
      {
        "id": 4,
        "text": "Darier's disease"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Direct immunofluorescence</strong> microscopy is used in the diagnosis of&nbsp;<strong>epidermolysis bullosa acquisita. </strong>It is positive due to the presence of <strong>antibodies</strong> against <strong>type VII&nbsp;collagen.</strong></p>\n<p>Direct immunofluorescence microscopy&nbsp;is <strong>negative</strong> in blistering conditions with <strong>congenital protein defects</strong>:</p>\n<ul>\n<li>Epidermolysis bullosa simplex - K5/K14 defect</li>\n<li>Epidermolysis bullosa junctionale - Laminin defect</li>\n<li>Epidermolysis bullosa dystrophica - Collagen VII defect</li>\n<li>Hailey-Hailey disease - SERCA protein defect (ATP2C1 mutation)</li>\n<li>Darier's Disease- SERCA protein defect (ATP2A2 mutation)&nbsp;</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Direct immunofluorescence microscopy of a patient's skin biopsy reveals intraepidermal intercellular deposition of IgA. What is the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Linear IgA disease"
      },
      {
        "id": 2,
        "text": "Pemphigoid gestationis"
      },
      {
        "id": 3,
        "text": "Bullous pemphigoid"
      },
      {
        "id": 4,
        "text": "IgA pemphigus"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Intraepidermal</strong> <strong>intercellular</strong> deposition of IgA on immunofluorescence is seen in <strong>IgA</strong>&nbsp;<strong>pemphigus</strong>.</p>\n<p>It is characterized by <strong>IgA</strong> antibodies <strong>against desmosomal</strong> <strong>components</strong>.&nbsp;As in pemphigus vulgaris, the pattern of immunofluorescence is<strong>&nbsp;</strong>intraepidermal and intercellular.</p>\n<p>Direct immunofluorescence staining in various immunobullous conditions is shown in the following table.</p>\n<table style=\"height: 340px; width: 751px;\">\n<tbody>\n<tr style=\"height: 17px;\">\n<td style=\"width: 174.609px; text-align: center; height: 17px;\"><strong>Disease</strong></td>\n<td style=\"width: 129.391px; text-align: center; height: 17px;\"><strong>Deposits</strong></td>\n<td style=\"width: 200px; text-align: center; height: 17px;\"><strong>Location</strong></td>\n<td style=\"width: 215px; text-align: center; height: 17px;\"><strong>Pattern</strong></td>\n</tr>\n<tr style=\"height: 36px;\">\n<td style=\"width: 174.609px; height: 36px;\">Pemphigus vulgaris</td>\n<td style=\"width: 129.391px; height: 36px;\">IgG and C3</td>\n<td style=\"width: 200px; height: 36px;\">Intraepidermal intercellular &nbsp;</td>\n<td style=\"width: 215px; height: 36px;\">Fish-net/ Reticular</td>\n</tr>\n<tr style=\"height: 36px;\">\n<td style=\"width: 174.609px; height: 36px;\">Pemphigus foliaceus</td>\n<td style=\"width: 129.391px; height: 36px;\">IgG and C3</td>\n<td style=\"width: 200px; height: 36px;\">Intraepidermal intercellular&nbsp; &nbsp;</td>\n<td style=\"width: 215px; height: 36px;\">Fish-net/ Reticular</td>\n</tr>\n<tr style=\"height: 4px;\">\n<td style=\"width: 174.609px; height: 4px;\">Bullous pemphigoid</td>\n<td style=\"width: 129.391px; height: 4px;\">IgG and C3</td>\n<td style=\"width: 200px; height: 4px;\">Subepidermal (at DEJ)</td>\n<td style=\"width: 215px; height: 4px;\">\n<p>Linear, n-serrated</p>\n</td>\n</tr>\n<tr style=\"height: 36px;\">\n<td style=\"width: 174.609px; height: 36px;\">Pemphigoid gestationis</td>\n<td style=\"width: 129.391px; height: 36px;\">IgG and C3</td>\n<td style=\"width: 200px; height: 36px;\">Subepidermal (at DEJ)</td>\n<td style=\"width: 215px; height: 36px;\">Linear</td>\n</tr>\n<tr style=\"height: 54px;\">\n<td style=\"width: 174.609px; height: 54px;\">Epidermolysis bullosa acquisita</td>\n<td style=\"width: 129.391px; height: 54px;\">IgG</td>\n<td style=\"width: 200px; height: 54px;\">Subepidermal (at DEJ)</td>\n<td style=\"width: 215px; height: 54px;\">Linear, u-serrated</td>\n</tr>\n<tr style=\"height: 36px;\">\n<td style=\"width: 174.609px; height: 36px;\">Linear IgA disease</td>\n<td style=\"width: 129.391px; height: 36px;\">IgA</td>\n<td style=\"width: 200px; height: 36px;\">Subepidermal (at DEJ)</td>\n<td style=\"width: 215px; height: 36px;\">Linear</td>\n</tr>\n<tr style=\"height: 36px;\">\n<td style=\"width: 174.609px; height: 36px;\">IgA pemphigus</td>\n<td style=\"width: 129.391px; height: 36px;\">IgA</td>\n<td style=\"width: 200px; height: 36px;\">Intraepidermal intercellular &nbsp;</td>\n<td style=\"width: 215px; height: 36px;\">Fish-net/ Reticular &nbsp;</td>\n</tr>\n<tr style=\"height: 36px;\">\n<td style=\"width: 174.609px; height: 36px;\">Dermatitis herpetiformis</td>\n<td style=\"width: 129.391px; height: 36px;\">IgA</td>\n<td style=\"width: 200px; height: 36px;\">Papillary tips</td>\n<td style=\"width: 215px; height: 36px;\">Granular</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 40-year-old man presented with blisters on his upper chest and back and mucosal lesions as shown. On examination, the bullae were flaccid and filled with clear fluid. What is the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Pemphigus vulgaris"
      },
      {
        "id": 2,
        "text": "Bullous pemphigoid"
      },
      {
        "id": 3,
        "text": "Pemphigus foliaceus"
      },
      {
        "id": 4,
        "text": "Epidermolysis bullosa acquisita"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong><span data-preserver-spaces=\"true\">Flaccid bullae</span></strong><span data-preserver-spaces=\"true\">&nbsp;on the skin and&nbsp;</span><strong><span data-preserver-spaces=\"true\">oral erosions</span></strong><span data-preserver-spaces=\"true\">&nbsp;suggest a diagnosis of&nbsp;</span>mucocutaneous<strong><span data-preserver-spaces=\"true\"> pemphigus vulgaris</span></strong><span data-preserver-spaces=\"true\">.</span></p>\n<p><strong><span data-preserver-spaces=\"true\">Oral</span></strong><span data-preserver-spaces=\"true\">&nbsp;</span><strong><span data-preserver-spaces=\"true\">erosions</span></strong><span data-preserver-spaces=\"true\">&nbsp;usually&nbsp;</span><strong><span data-preserver-spaces=\"true\">precede</span></strong><span data-preserver-spaces=\"true\">&nbsp;</span><strong><span data-preserver-spaces=\"true\">skin</span></strong>&nbsp;manifestations<span data-preserver-spaces=\"true\">.&nbsp;</span><span data-preserver-spaces=\"true\">The skin lesions are&nbsp;</span><strong><span data-preserver-spaces=\"true\">flaccid blisters&nbsp;</span></strong><span data-preserver-spaces=\"true\">with&nbsp;</span><strong><span data-preserver-spaces=\"true\">clear fluid</span></strong> on&nbsp;an<strong><span data-preserver-spaces=\"true\">&nbsp;</span></strong><strong><span data-preserver-spaces=\"true\">erythematous base</span></strong>,<span data-preserver-spaces=\"true\">&nbsp;that rupture to produce painful erosions.&nbsp;</span><span data-preserver-spaces=\"true\">These are distributed over the face, scalp, upper chest, back, and neck.</span></p>\n<p>Options B and D:<strong><span data-preserver-spaces=\"true\">&nbsp;</span></strong>Bullous pemphigoid and epidermolysis bullosa acquisita show subepidermal involvement with tense blisters.</p>\n<p>Option C: Pemphigus foliaceus causes superficial blisters with no mucosal involvement.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/9bc1b925b0874acdba67a47a4e74734d.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Match the following:",
    "choices": [
      {
        "id": 1,
        "text": "1-b ; 2-a ; 3-c ; 4-d"
      },
      {
        "id": 2,
        "text": "1-d ; 2-c ; 3-b ; 4-a"
      },
      {
        "id": 3,
        "text": "1-d ; 2-b ; 3-a ; 4-c"
      },
      {
        "id": 4,
        "text": "1-b ; 2-d ; 3-c ; 4-a"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In <strong>pemphigus vulgaris</strong>, autoantibodies are directed towards&nbsp;<strong>desmoglein 3</strong>. Desmoglein 1 and desmocollins can also be involved.&nbsp;Desmoglein 3 is present predominantly in the mucosal epithelium. Thus, antibodies against it lead to severe mucosal blistering. Desmoglein 3 is also involved in pemphigus vegetans.</p>\n<p>Patients with <strong>pemphigus foliaceus</strong>, who have <strong>anti-desmoglein 1</strong> antibodies alone, exhibit skin blistering without mucosal involvement.</p>\n<p><strong>Epidermolysis bullosa simplex</strong> is associated with congenital defects in&nbsp;<strong>K5/K14</strong> antigens.</p>\n<p><strong>Junctional epidermolysis bullosa</strong> is associated with congenital defects in&nbsp;<strong>laminin</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 40-year-old man presents with recurrent episodes of oral ulcers, large areas of denuded skin, and flaccid blisters. What is the first-line investigation for this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Direct immunofluorescence microscopy"
      },
      {
        "id": 2,
        "text": "Indirect immunofluorescence microscopy"
      },
      {
        "id": 3,
        "text": "Enzyme linked immunosorbent assay"
      },
      {
        "id": 4,
        "text": "Tzanck smear from the floor of blister"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>This clinical picture is suggestive of <strong>pemphigus vulgaris</strong>. The first-line investigation is <strong>Tzanck smear</strong>.</p>\n<p>It allows us to visualize the histology by collecting material from the floor of a fresh blister that is&nbsp;stained with <strong>Giemsa</strong> or any Romanowsky stain. <strong>Tzanck cells</strong> are seen on microscopy.</p>\n<p>Direct&nbsp;immunofluorescence microscopy (<strong>DIF</strong>) is the <strong>most accurate</strong> test.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/089120462e6245ad9da3276c238998e9x510x481.GIF"
    ]
  },
  {
    "text": "A patient presents with flaccid bullous lesions involving the oral cavity and the skin. He has lesions as shown below. Acantholytic cells are seen on Tzanck smear. What is the most probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Pemphigus foliaceus"
      },
      {
        "id": 2,
        "text": "Pemphigus vulgaris"
      },
      {
        "id": 3,
        "text": "Dermatitis herpetiformis"
      },
      {
        "id": 4,
        "text": "Bullous pemphigoid"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Flaccid</strong> lesions, <strong>mucosal</strong> involvement, and the presence of <strong>acantholytic cells</strong> are suggestive of <strong>pemphigus vulgaris.</strong></p>\n<p>Option A: There is no&nbsp;mucosal involvement in pemphigus foliaceus.</p>\n<p>Option C: Dermatitis herpetiformis presents with multiple small vesicles and no acantholysis.</p>\n<p>Option D: Bullous pemphigoid&nbsp;presents with tense bullae and no&nbsp;acantholysis.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/5181d884268d431ea890df2056387988.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A patient with a bullous disorder is referred to the dermatology OPD for further investigations. Direct immunofluorescence microscopy is performed. What is the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Bullous pemphigoid"
      },
      {
        "id": 2,
        "text": "Pemphigus vulgaris"
      },
      {
        "id": 3,
        "text": "Epidermolysis bullosa aquisita"
      },
      {
        "id": 4,
        "text": "Dermatitis herpetiformis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Option D: Dermatitis herpetiformis presents with focal granular deposits of IgA at papillary tips, as seen below.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/54f316f899a14b8f835f408e7fa8ecab.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/156f2788f7c74184963cd732e44fb9dfx512x290.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/57c508942f094ac592fb7bc968ba2925x250x193.PNG"
    ]
  },
  {
    "text": "What is the most accurate diagnostic test for Pemphigus vulgaris?",
    "choices": [
      {
        "id": 1,
        "text": "Indirect immunofluorescence testing"
      },
      {
        "id": 2,
        "text": "Direct immunofluorescence testing"
      },
      {
        "id": 3,
        "text": "Histopathology"
      },
      {
        "id": 4,
        "text": "Enzyme Linked Immunosorbent Assay (ELISA)"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Direct immunofluorescence test</strong> is the most accurate test to diagnose <strong>Pemphigus Vulgaris.</strong></p>\n<p>Direct Immunofluorescence uses <strong>anti-IgG antibodies</strong> which detects the <strong>anti-desmoglein IgG antibodies</strong> deposited on the <strong>Desmosomes</strong>. These desmosomes are present at cell junctions; this leads to <strong>the fishnet pattern.</strong></p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2dea83b13d534a539f8fd2364f482fbax1280x1302.JPEG"
    ]
  },
  {
    "text": "A skin biopsy from a patient with an immunobullous condition is shown below. What is the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Pemphigus vulgaris"
      },
      {
        "id": 2,
        "text": "Pemphigus foliaceus"
      },
      {
        "id": 3,
        "text": "Bullous pemphigoid"
      },
      {
        "id": 4,
        "text": "Epidermolysis bullosa"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given image shows a<strong>&nbsp;row of tombstones</strong>&nbsp;appearance, which is classically seen in&nbsp;<strong>pemphigus</strong> <strong>vulgaris.</strong>&nbsp;</p>\n<p>In this condition, there is suprabasal splitting of the epidermis leading to blister formation. The <strong>basal layer</strong>&nbsp;remains&nbsp;adherent to the basement membrane, and gives the resemblance to the row of the tombstones.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/94453fa5d2b04da0abcc8df1d5fb369a.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/40a0432644204aad9124580e331bcfcax510x502.GIF"
    ]
  },
  {
    "text": "A 43-year-old man is referred to the dermatology OPD with the following skin lesions that have been present for 4 months. The lesions are extremely painful. On examination, there are flaccid blisters that rupture easily and mucosal surfaces are normal. Where does the bullous split occur in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Subcorneal layer"
      },
      {
        "id": 2,
        "text": "Spinous layer"
      },
      {
        "id": 3,
        "text": "Suprabasal layer"
      },
      {
        "id": 4,
        "text": "Dermo-epidermal junction"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario is suggestive of&nbsp;<strong>pemphigus</strong>&nbsp;<strong>foliaceus.&nbsp;</strong>The&nbsp;<strong>blisters</strong> are formed due to a <strong>split</strong> at the <strong>subcorneal layer.</strong></p>\n<p>Pemphigus foliaceus is a<strong> less severe</strong> variant of pemphigus vulgaris with antibodies against <strong>desmoglein-1</strong>. It presents with fewer&nbsp;<strong>flaccid bullae</strong> and <strong>mucosal sparing</strong>.<strong>&nbsp;</strong>It more commonly results in&nbsp;<strong>erosions</strong> with erythema, scales, and crust. <strong>Collarette</strong> scales may be present.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/356ee8125c4a411d9c06717eccc1556b.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following are causes of drug-induced pemphigus?",
    "choices": [
      {
        "id": 1,
        "text": "1, 3, 5"
      },
      {
        "id": 2,
        "text": "1, 2, 5"
      },
      {
        "id": 3,
        "text": "2, 3, 4"
      },
      {
        "id": 4,
        "text": "2, 3, 5"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Sodium valproate and isoniazid do not cause&nbsp;<strong>drug-induced pemphigus.</strong>&nbsp;The commonly implicated drugs include:</p>\n<ul>\n<li><strong>Penicillamine</strong> (most common)</li>\n<li><strong>ACE inhibitors&nbsp;</strong></li>\n<li>Antibiotics - <strong>penicillins</strong>, cephalosporins, rifampicin</li>\n<li>Piroxicam</li>\n<li>Glibenclamide</li>\n<li>Phenobarbital</li>\n<li>Aspirin</li>\n</ul>\n<p>Drug-induced pemphigus usually occurs after <strong>1 year</strong> of taking the drug. It is more common in individuals with other associated autoimmune conditions.</p>\n<p>Note: Common drugs (mnemonic - <strong>PCR</strong>) are&nbsp;<strong>p</strong>enicillamine, <strong>c</strong>aptopril, <strong>r</strong>ifampicin.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is the most common cause of paraneoplastic pemphigus?",
    "choices": [
      {
        "id": 1,
        "text": "Chronic lymphocytic leukemia"
      },
      {
        "id": 2,
        "text": "Castleman disease"
      },
      {
        "id": 3,
        "text": "Non-Hodgkin\u2019s lymphoma"
      },
      {
        "id": 4,
        "text": "Waldenstrom's disease"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Paraneoplastic pemphigus</strong> (PNP) is most commonly associated seen with <strong>non-Hodgkin's lymphoma.&nbsp;</strong></p>\n<p>PNP is a <strong>fatal </strong>autoimmune blistering disease associated with underlying <strong>benign</strong> or <strong>malignant</strong> neoplasms. It commonly presents <strong>2-3 years</strong> after the development of malignancy, but can sometimes precede it as well. It is associated with <strong>multiple antigens</strong> including desmoglein, desmoplakin, periplakin.</p>\n<p>Other associated diseases include:</p>\n<ul>\n<li>Chronic lymphocytic leukemia</li>\n<li>Waldenstrom's disease</li>\n<li>Castleman disease</li>\n<li>Spindle cell tumor</li>\n<li>Thymoma</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 28-year-old woman in her 37th week of gestation develops the following intensely pruritic skin lesions. On examination, a few tense bullae are noted and mucous membranes are spared. Which of the following statement is incorrect regarding this condition?",
    "choices": [
      {
        "id": 1,
        "text": "The initial site of involvement is the thigh"
      },
      {
        "id": 2,
        "text": "It resolves spontaneously in postpartum period"
      },
      {
        "id": 3,
        "text": "Associated with antibodies against BP180"
      },
      {
        "id": 4,
        "text": "Usually flares during delivery"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>This clinical scenario is suggestive of <strong>herpes gestationis </strong>or<strong> pemphigoid gestationis. </strong>The initial site of involvement is the <strong>periumbilical </strong>region.</p>\n<p>It is a variant of bullous pemphigoid in pregnancy and is associated with antibodies against <strong>BP180</strong>. It presents in the <strong>II&nbsp;</strong>or<strong> III trimesters</strong>&nbsp;with pruritic, grouped vesicles that later&nbsp;spread to the abdomen, trunk, thighs. It <strong>flares</strong> in the <strong>intrapartum</strong> period and tends to<strong>&nbsp;resolves spontaneously</strong> in the postpartum period. However, it can recur in subsequent pregnancies.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/4a5efef560534c42ae7c65a970f4346b.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 45-year-old man presents to the OPD with skin fragility. On examination, he is noted to have erosions, bullae, and scarring over the extensor aspects of his elbows, hands, and knees. Direct immunofluorescence microscopy is given below. Presence of antibodies against which of the following is diagnostic of this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Collagen V"
      },
      {
        "id": 2,
        "text": "Collagen VII"
      },
      {
        "id": 3,
        "text": "Collagen III"
      },
      {
        "id": 4,
        "text": "Collagen VIII"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>This clinical scenario and image showing <strong>linear IgG</strong> deposits in a <strong>u-serrated</strong> pattern on direct immunofluorescence microscopy are suggestive of&nbsp;<strong>epidermolysis bullosa acquisita&nbsp;</strong>(EBA),&nbsp;in which autoantibodies are formed against&nbsp;<strong>collagen VII</strong>.</p>\n<p>It is an <strong>acquired autoimmune</strong> disorder, presenting in adults between&nbsp;<strong>44-54 years</strong>. It has a chronic, <strong>relapsing</strong> course. Two main clinical forms can be differentiated:</p>\n<ul>\n<li>Classical <strong>mechanobullous</strong> - Skin fragility, erosions, blisters, crusts, and scars on trauma\u2010prone areas like hands, knuckles, elbows, knees, toes.</li>\n<li><strong>Inflammatory</strong> - Resembles other pemphigoid diseases such as bullous pemphigoid. Associated with inflammatory infiltrate in the dermis.</li>\n</ul>\n<p>The following image shows erosions and crusting in a patient with EBA.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/4b42779800d64b1682a1ab9b685a0a3e.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b4492ccca1414092a7de1e41099fddb0x720x501.PNG"
    ]
  },
  {
    "text": "A 24-year-old patient comes to you with the following lesions. He tells you that he used to develop similar lesions since childhood but they always heal without scarring. His father also suffers from a similar condition. Which protein is defective in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Collagen VII"
      },
      {
        "id": 2,
        "text": "K5/K14"
      },
      {
        "id": 3,
        "text": "Laminin"
      },
      {
        "id": 4,
        "text": "BP180"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>This clinical scenario and the image showing&nbsp;<strong>superficial blisters</strong>&nbsp;are suggestive of <strong>epidermolysis bullosa simplex</strong><strong>,</strong> which is an <strong>autosomal dominant</strong> condition associated with a defect in <strong>K5/K14</strong> proteins.&nbsp;</p>\n<p>Epidermolysis bullosa congenita is a group of congenital <strong>mechanobullous</strong> disorders that arise after trauma and are common over the hands, feet, elbows, and knees. There are three forms of this condition.</p>\n<table style=\"height: 302px; width: 560px;\">\n<tbody>\n<tr style=\"height: 45px;\">\n<td style=\"width: 183.922px; height: 45px;\"><strong>Type</strong></td>\n<td style=\"width: 105.828px; height: 45px;\"><strong>Defective protein</strong></td>\n<td style=\"width: 248.25px; height: 45px;\">\n<p><strong>Features</strong></p>\n</td>\n</tr>\n<tr style=\"height: 33px;\">\n<td style=\"width: 183.922px; height: 33px;\">Epidermolysis bullosa simplex</td>\n<td style=\"width: 105.828px; height: 33px;\">K5/K14</td>\n<td style=\"width: 248.25px; height: 33px;\">\n<p><strong>Intraepidermal</strong>&nbsp;blister with split in basal layer</p>\n<p>Heals without scarring</p>\n</td>\n</tr>\n<tr style=\"height: 100px;\">\n<td style=\"width: 183.922px; height: 100px;\">Junctional epidermolysis bullosa</td>\n<td style=\"width: 105.828px; height: 100px;\">Laminin</td>\n<td style=\"width: 248.25px; height: 100px;\">\n<p><strong>Dermoepidermal</strong> junction blister with split in lamina lucida layer</p>\n<p>Perioral involvement is&nbsp; frequent</p>\n<p>May heal with scarring</p>\n</td>\n</tr>\n<tr style=\"height: 126px;\">\n<td style=\"width: 183.922px; height: 126px;\">Epidermolysis bullosa dystrophica</td>\n<td style=\"width: 105.828px; height: 126px;\">Collagen VII&nbsp;in anchoring fibrils</td>\n<td style=\"width: 248.25px; height: 126px;\">\n<p><strong>Subepidermal</strong> tense blisters&nbsp;with defect in sublamina densa</p>\n<p>Frequent mucosal involvement</p>\n<p>Heal with scarring</p>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c43dabb810384095b34348a19dc80790.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 28-year-old patient complains of the following intensely itchy rash over his elbows, knees, buttocks, and upper back. He has been having persistent watery loose stools for the past 3 months and reports feeling more tired than usual. A complete blood count shows microcytic, hypochromic anemia. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Pemphigus vulgaris"
      },
      {
        "id": 2,
        "text": "Bullous pemphigoid"
      },
      {
        "id": 3,
        "text": "Linear IgA disease"
      },
      {
        "id": 4,
        "text": "Dermatitis herpetiformis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>This clinical scenario along with the given image showing pruritic, multiple,\u00a0<strong>grouped papules </strong>and<strong> vesicles</strong>\u00a0located on <strong>extensor </strong>aspects is suggestive\u00a0of <strong>dermatitis herpetiformis</strong>.\u00a0</p>\n<p>It is associated with gluten-sensitive enteropathy or <strong>celiac</strong> disease. It is also associated with <strong>HLA DQ2/DQ8/</strong><strong>B8</strong>. Deposition of <strong>IgA antitransglutaminase</strong> antibodies in the dermal papillae results in subepidermal blisters and vesicles.</p>\n<p>This condition is associated with a small increase in the <strong>risk</strong> of <strong>T-cell lymphoma</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ffaeb00411e0493f9f3683339474ea52.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A young woman with celiac disease comes to you for a follow-up. She strictly follows a gluten-free diet, which has resulted in improvement of her diarrhea. However, the following itchy skin lesions have persisted despite her altered diet. What drug will you prescribe?",
    "choices": [
      {
        "id": 1,
        "text": "Dapsone"
      },
      {
        "id": 2,
        "text": "Oral steroids"
      },
      {
        "id": 3,
        "text": "Mycophenolate mofetil"
      },
      {
        "id": 4,
        "text": "Topical steroids"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given image showing itchy, grouped vesicles in a patient with celiac disease is suggestive of <strong>dermatitis herpetiformis</strong>.&nbsp;The drug of choice is <strong>dapsone.</strong>&nbsp;</p>\n<p>The <strong>initial treatment</strong> of choice for dermatitis herpetiformis is a <strong>gluten-free diet</strong>.</p>\n<p>Dapsone is used when response to dietary modification is inadequate or slow. It is highly effective in such cases and improves symptoms within one week of starting the drug.</p>\n<p>Note: Gluten-containing grains such as<strong>&nbsp;b</strong>arley<strong>, r</strong>ye<strong>, o</strong>ats<strong>, w</strong>heat (<strong>BROW</strong>) should be avoided in the diet. Rice and maize are tolerated.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/6f4a6d195eb9404a92011656ccd4a9d4.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Immunofluorescence microscopy of a skin biopsy from a patient shows IgA deposits as shown. Which of the following is incorrect about this condition?",
    "choices": [
      {
        "id": 1,
        "text": "It is intensely pruritic"
      },
      {
        "id": 2,
        "text": "Patients present with papules and vesicles over extensor areas"
      },
      {
        "id": 3,
        "text": "Lymphocytic microabscesses are seen in dermis"
      },
      {
        "id": 4,
        "text": "Histopathology reveals subepidermal blisters"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Granular</strong> deposits of <strong>IgA</strong> on direct immunofluorescence are suggestive of<strong>&nbsp;</strong><strong>dermatitis herpetiformis </strong>or&nbsp;<strong>Duhring's</strong> <strong>disease</strong>.&nbsp;The characteristic microscopic feature is <strong>subepidermal</strong> blisters with&nbsp;<strong>papillary tip microabscesses&nbsp;</strong>containing neutrophils.</p>\n<p>It presents as <strong>grouped</strong> <strong>vesicles</strong> and <strong>papules.&nbsp;</strong>These lesions are commonly located over the <strong>extensor</strong> aspects of knees, elbows, buttocks, back, scalp which are associated with intense<strong> pruritus</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/09fa53a1a1904f02b20a6bdbda7fb974.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "In which of the following conditions is Nikolsky's sign seen?",
    "choices": [
      {
        "id": 1,
        "text": "1, 3, 4"
      },
      {
        "id": 2,
        "text": "1, 2, 3"
      },
      {
        "id": 3,
        "text": "2, 4, 5"
      },
      {
        "id": 4,
        "text": "1, 4, 5"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Nikolsky's </strong>sign is <strong>positive</strong> in the following conditions:</p>\n<ul>\n<li>Pemphigus vulgaris</li>\n<li>Pemphigus foliaceus</li>\n<li>Staphylococcal scalded skin syndrome</li>\n</ul>\n<p>Nikolsky's sign refers to&nbsp;the&nbsp;<strong>separation</strong> of&nbsp;the normal\u2010looking <strong>epidermis</strong> from the dermis by applying firm <strong>tangential</strong> sliding pressure, thereby&nbsp;producing an erosion. It is seen in conditions that produce <strong>intraepidermal</strong> blisters. Hence it is negative in subepidermal bullous conditions like bullous pemphigoid and epidermolysis bullosa acquisita.</p>\n<p><strong>Pseudo</strong>-<strong>Nikolsky's</strong> sign refers to <strong>epidermal separation</strong> as a result of epidermal<strong> necrosis</strong>, not acantholysis.</p>\n<p>It is seen in</p>\n<ul>\n<li>Toxic epidermal necrolysis</li>\n<li>Steven-Johnson syndrome&nbsp;</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/fab4cc3bf4a24a18b069f3817792b1f5x1279x1103.JPEG"
    ]
  },
  {
    "text": "A 50-year-old man is referred to the dermatology OPD with the following painful and malodorous skin lesions over his trunk, face, and scalp. He also has longitudinal erythronychia and distal v-shaped nicks on his nails. Which of the following genes is mutated in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "ATP 2C2"
      },
      {
        "id": 2,
        "text": "ATP 2A2"
      },
      {
        "id": 3,
        "text": "ATP 3A2"
      },
      {
        "id": 4,
        "text": "ATP 2C1"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Note:&nbsp;<strong>Hailey-Hailey disease</strong>&nbsp;is due to a mutation in&nbsp;<strong>ATP2C1</strong>&nbsp;gene, which also encodes the SERCA protein.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/37f8e734303f4fdeab007a89b61ff3fc.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/970e4aa636f041af8a20a4147f323071x510x552.GIF"
    ]
  },
  {
    "text": "Corps ronds are a feature of which of the following conditions?",
    "choices": [
      {
        "id": 1,
        "text": "Keratosis follicularis"
      },
      {
        "id": 2,
        "text": "Hailey-Hailey disease"
      },
      {
        "id": 3,
        "text": "Duhring's disease"
      },
      {
        "id": 4,
        "text": "Keratosis pilaris"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Corps ronds</strong>&nbsp;are seen in<strong>&nbsp;keratosis follicularis</strong> or<strong> Darier's disease.</strong></p>\n<p>It is an autosomal dominant condition that is characterized by&nbsp;keratotic papules over the seborrheic areas. The following histopathology findings are seen:</p>\n<ul>\n<li>Acantholysis - loss of cohesion between keratinocytes</li>\n<li>Dyskeratosis&nbsp;- abnormal premature keratinization in the epidermis</li>\n<li>Lacunae - in suprabasal area</li>\n<li><strong>Corps ronds</strong> - &nbsp;<strong>rounded</strong> <strong>dyskeratotic</strong> cells with <strong>eosinophilic</strong> <strong>cytoplasm</strong>&nbsp;in the epidermis &nbsp;</li>\n<li><strong>Corps grains</strong> - small cells with <strong>shrunken cytoplasm</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e4931aa008fd45d4a0cb0b110831c022x510x517.GIF",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6c5e047ca11f42269897934169aed4a5x510x517.GIF"
    ]
  },
  {
    "text": "In which of the following conditions does acantholysis lead to a dilapidated brick wall appearance?",
    "choices": [
      {
        "id": 1,
        "text": "Pemphigus vulgaris"
      },
      {
        "id": 2,
        "text": "Pemphigus foliaceus"
      },
      {
        "id": 3,
        "text": "Hailey-Hailey disease"
      },
      {
        "id": 4,
        "text": "Darier's disease"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Dilapidated </strong><strong>brick wall</strong> appearance is characteristically seen in <strong>Hailey-Hailey </strong>disease.</p>\n<p>It is an <strong>autosomal dominant</strong> disorder occurring due to a mutation in the&nbsp;<strong>ATP2C1 </strong>gene encoding the<strong> SERCA </strong>calcium&nbsp;channel ATPase.<strong>&nbsp;</strong>It causes <strong>blistering</strong>, particularly in the <strong>intertriginous</strong> areas.</p>\n<p>On histology, there is a widespread <strong>loss</strong> of <strong>cohesion</strong> between <strong>suprabasal</strong> <strong>keratinocytes</strong> leading to<strong>&nbsp;acantholysis</strong>,<strong>&nbsp;</strong>which<strong>&nbsp;</strong>is<strong> incomplete.</strong>&nbsp;Hence, separated keratinocytes are still partially connected to each other giving the appearance of a&nbsp;dilapidated or broken brick wall, as shown in the following image.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/dd8306e26df74112a8d7f9cf4f568594x815x271.PNG"
    ]
  },
  {
    "text": "What are Tzanck cells?",
    "choices": [
      {
        "id": 1,
        "text": "Langerhans cells"
      },
      {
        "id": 2,
        "text": "Keratinocytes"
      },
      {
        "id": 3,
        "text": "Multinucleated giant cells"
      },
      {
        "id": 4,
        "text": "Histiocytes"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Tzanck</strong> cells are <strong>keratinocytes</strong>.&nbsp;</p>\n<p>These cells are seen in vesiculobullous disorders, as a result of <strong>acantholysis</strong>. The&nbsp;<strong>keratinocytes</strong> lose their polyhedral shapes and characteristically become <strong>round</strong> with hyperchromatic nuclei and <strong>perinuclear halo</strong>,&nbsp;as seen in the following image.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/71b1b9dd8f51449b83420c091385edf0x510x481.GIF"
    ]
  },
  {
    "text": "Which of the following is diagnosed by the presence of multinucleated giant cells on a Tzanck smear?",
    "choices": [
      {
        "id": 1,
        "text": "Pemphigus vulgaris"
      },
      {
        "id": 2,
        "text": "Molluscum contagiosum"
      },
      {
        "id": 3,
        "text": "Varicella-zoster infection"
      },
      {
        "id": 4,
        "text": "Bullous pemphigoid"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Multinucleated giant cells</strong> on a Tzanck smear&nbsp;are seen in&nbsp;<strong>varicella-zoster </strong>and<strong> herpes simplex </strong>infections.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '12 Vesiculobullous Diseases';
        let hierarchy = ["Marrow", "qBank", "Dermatology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>