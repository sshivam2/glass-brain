<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>089 Hemolytic Anemia - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Medicine
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">23</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following will be seen in a patient with intravascular hemolytic anemia?",
    "choices": [
      {
        "id": 1,
        "text": "1"
      },
      {
        "id": 2,
        "text": "2"
      },
      {
        "id": 3,
        "text": "3"
      },
      {
        "id": 4,
        "text": "4"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In <strong>intravascular hemolysis</strong>, there is elevated MCV, LDH, and urinary urobilinogen, with low haptoglobin.</p>\n<p>Laboratory abnormalities seen in intravascular hemolysis:</p>\n<table style=\"height: 110px; width: 423.656px;\">\n<tbody>\n<tr>\n<td style=\"width: 118px; text-align: left;\"><strong>Lab parameters</strong></td>\n<td style=\"width: 116px; text-align: left;\"><strong>Derangement</strong></td>\n<td style=\"width: 168.656px; text-align: left;\"><strong>Mechanism</strong></td>\n</tr>\n<tr>\n<td style=\"width: 118px; text-align: left;\">MCV</td>\n<td style=\"width: 116px; text-align: left;\">High</td>\n<td style=\"width: 168.656px; text-align: left;\">Compensatory reticulocytosis</td>\n</tr>\n<tr>\n<td style=\"width: 118px; text-align: left;\">S. LDH</td>\n<td style=\"width: 116px; text-align: left;\">High</td>\n<td style=\"width: 168.656px; text-align: left;\">Released from RBCs</td>\n</tr>\n<tr>\n<td style=\"width: 118px; text-align: left;\">S. Unconjugated bilirubin</td>\n<td style=\"width: 116px; text-align: left;\">High</td>\n<td style=\"width: 168.656px; text-align: left;\">Hemoglobin from RBCs is converted to bilirubin</td>\n</tr>\n<tr>\n<td style=\"width: 118px; text-align: left;\">Urinary urobilinogen</td>\n<td style=\"width: 116px; text-align: left;\">High</td>\n<td style=\"width: 168.656px; text-align: left;\">Unconjugated bilirubin is excreted as urobilinogen in urine</td>\n</tr>\n<tr>\n<td style=\"width: 118px; text-align: left;\">S. Haptoglobin</td>\n<td style=\"width: 116px; text-align: left;\">Low</td>\n<td style=\"width: 168.656px; text-align: left;\">Free hemoglobin in circulation binds to haptoglobin causing reduced haptoglobin levels</td>\n</tr>\n</tbody>\n</table>\n<p>Additionally, hemoglobinuria and hemosiderinemia may be seen on urine examination.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not due to an extracorpuscular defect in RBCs?",
    "choices": [
      {
        "id": 1,
        "text": "Autoimmune hemolytic anemia"
      },
      {
        "id": 2,
        "text": "Paroxysmal nocturnal hemoglobinuria"
      },
      {
        "id": 3,
        "text": "Familial hemolytic uremic syndrome"
      },
      {
        "id": 4,
        "text": "Microangiopathic hemolytic anemia"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Paroxysmal nocturnal hemoglobinuria (<strong>PNH</strong>) is a hemolytic anemia due to an&nbsp;<strong>intracorpuscular</strong> defect.</p>\n<p>It is caused due to&nbsp;an acquired somatic mutation leading to <strong>deficiency</strong> of membrane protective factors <strong>CD59 </strong>and<strong> CD55</strong>. This makes the RBC extremely sensitive to complement activation and causes <strong>intravascular hemolysis</strong>.&nbsp;</p>\n<p>The other conditions occur due to extracorpuscular defects.</p>\n<p>Option A: In autoimmune hemolytic anemia, RBCs are coated with autoantibodies. This triggers&nbsp;phagocytosis in the reticuloendothelial system leading to extravascular hemolysis.&nbsp;&nbsp;</p>\n<p>Option C: Familial hemolytic uremic syndrome (atypical HUS) is an inherited abnormality with excessive complement activation leading to episodic and excessive production of membrane attack complex destroying normal RBCs.</p>\n<p>Option D: Microangiopathic hemolytic anemia is non-immune hemolysis&nbsp;resulting from intravascular red blood cell fragmentation due to abnormalities in the microvasculature.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is true about paroxysmal nocturnal hemoglobinuria?",
    "choices": [
      {
        "id": 1,
        "text": "Inherited defect in PIG \u2013A"
      },
      {
        "id": 2,
        "text": "Extravascular hemolysis"
      },
      {
        "id": 3,
        "text": "Deficiency of CD 55 and CD 59"
      },
      {
        "id": 4,
        "text": "Microcytic anaemia"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Deficiency of <strong>CD55</strong> and <strong>CD59</strong> is seen in <strong>paroxysmal nocturnal hemoglobinuria</strong> (PNH).</p>\n<p>It is due to an <strong>acquired mutation</strong> in the <strong>X-linked</strong> phosphatidylinositol class A <strong>PIG-A gene</strong> (Option A) causing a <strong>deficiency</strong> of <strong>GPI anchor proteins</strong>. GPI is a glycolipid that <strong>anchors membrane protective factors</strong> such as CD59 and CD55 to the membrane. The deficiency of CD55 and CD59 makes the <strong>RBC </strong>sensitive to <strong>complement-mediated intravascular hemolysis</strong>(Option B). The <strong>anemia</strong> is usually <strong>normo-macrocytic</strong> (Option D).</p>\n<p><strong>Hemolysis</strong> tends to occur at <strong>night</strong> due to a slight <strong>decrease in blood pH</strong> during sleep, which triggers complement activity (nocturnal hemoglobinuria). <strong>PNH</strong> is characterized by <strong>hemolytic anemia</strong>, <strong>pancytopenia</strong>, and <strong>venous thrombosis</strong>.</p>\n<p>PNH is diagnosed using <strong>flow cytometry</strong>. The drugs of choice for treatment are <strong>Eculizumab</strong> or <strong>Ravulizumab</strong> which work against <strong>complement C5</strong>. Supportive management of PNH includes <strong>folic acid</strong> and <strong>iron supplementation</strong>. Bone marrow transplantation is another option for the treatment of this condition. </p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient with hemolytic anemia develops features of pancytopenia and venous thrombosis. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Shwachman-Diamond syndrome"
      },
      {
        "id": 2,
        "text": "Pyruvate kinase deficiency"
      },
      {
        "id": 3,
        "text": "G6PD anemia"
      },
      {
        "id": 4,
        "text": "Paroxysmal nocturnal hemoglobinuria"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Paroxysmal nocturnal hemoglobinuria <strong>(PNH)\u00a0</strong>is a type of\u00a0<strong>hemolytic anemia</strong> associated with\u00a0<strong>pancytopenia </strong>and<strong> venous thrombosis</strong>.</p>\n<p>In PNH, there is complement-mediated intravascular hemolysis. Bone marrow dysfunction also occurs, resulting in pancytopenia. Transformation to\u00a0<strong>aplastic anemia</strong> or acute myeloid leukemia (<strong>AML</strong>) may rarely occur.\u00a0</p>\n<p>PNH is also associated with\u00a0venous thrombosis\u00a0(cerebral, renal, hepatic).<strong>\u00a0</strong>This is the most common cause of death in PNH.\u00a0</p>\n<p>Option A: Shwachman-Diamond syndrome is inherited aplastic anemia with neutropenia with pancreatic insufficiency and malabsorption.</p>\n<p>Options B and C: Pyruvate kinase and G6PD deficiency are inherited RBC enzyme disorders causing extravascular hemolytic anemias. They do not affect other cell\u00a0lines and are not associated with venous thrombosis.</p>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 31-year-old woman presents with a fever and cough. She also reports excessive tiredness and occasional dark-colored urine for the past 6 months. Chest X-ray reveals lower lobe pneumonia. Labs reveal the following. What is the investigation of choice for this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Acidified serum / HAM test"
      },
      {
        "id": 2,
        "text": "Eosin-5\u2032-maleimide-binding test"
      },
      {
        "id": 3,
        "text": "Flow cytometry"
      },
      {
        "id": 4,
        "text": "Acidified glycerol lysis test"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>This clinical scenario is suggestive of <strong>intravascular hemolysis</strong> due to paroxysmal nocturnal hemoglobinuria (<strong>PNH</strong>). The gold standard for diagnosis is&nbsp;<strong>flow cytometry</strong>.</p>\n<p>Flow cytometry is performed with fluorescently labeled monoclonal antibodies that bind to GPI-anchored proteins (CD59, CD55). Most tests also use&nbsp;<strong>FL</strong>uorescent <strong>AER</strong>olysin (<strong>FLAER</strong>), a reagent that directly binds the GPI anchor. <strong>Absence </strong>of&nbsp;<strong>CD59</strong> and <strong>CD55</strong>&nbsp;are diagnostic of PNH.&nbsp;</p>\n<p>Other investigations in PNH include:</p>\n<ul>\n<li><strong>Ham test</strong>&nbsp;(acidified serum lysis) - lysis of RBCs in a mildly acidic pH due to complement fixation.&nbsp;</li>\n<li><strong>Bone marrow biopsy</strong>:\n<ul>\n<li>Hypercellularity with erythroid hyperplasia is seen in classical presentations.</li>\n<li>Patients who develop pancytopenia will have hypocellular bone marrow. &nbsp;</li>\n</ul>\n</li>\n<li>Imaging - to evaluate venous thrombosis.</li>\n</ul>\n<p>Option B and D:&nbsp;Eosin-5&prime;-maleimide-binding and acidified glycerol lysis tests&nbsp;are done in hereditary spherocytosis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 46-year-old woman presents with abdominal pain and yellowish discoloration of her skin. She gives a history of dark-colored urine which is more pronounced in the early mornings. Imaging reveals hepatic venous thrombosis. Flow cytometry reveals the absence of GPI-anchored proteins. What is the drug of choice?",
    "choices": [
      {
        "id": 1,
        "text": "Rituximab"
      },
      {
        "id": 2,
        "text": "Certolizumab"
      },
      {
        "id": 3,
        "text": "Eculizumab"
      },
      {
        "id": 4,
        "text": "Alemtezumab"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>This clinical scenario is suggestive of paroxysmal nocturnal hemoglobinuria (<strong>PNH</strong>). C5 complement inhibitors like <strong>eculizumab</strong>&nbsp;and <strong>ravalizumab</strong> are the drugs of choice in PNH.&nbsp;</p>\n<p>Management of PNH involves the following:</p>\n<ul>\n<li><strong>C5 complement inhibitors&nbsp;</strong>prevent the formation of membrane attack complex and complement-mediated lysis.</li>\n<li><strong>Bone marrow transplant</strong>&nbsp;is useful for patients with severe pancytopenia</li>\n<li>Supportive measures:\n<ul>\n<li>Transfusion of filtered RBCs</li>\n<li>Folic acid, and iron supplementation</li>\n<li>Anticoagulants in case of venous thrombosis&nbsp;</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 10-year-old boy is brought for evaluation of fatigue. On examination, he is jaundiced and mild splenomegaly is noted. He was adopted and his family history is unknown. Peripheral smear findings are shown below. What is the most specific investigation for this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Eosin-5-maleimide test"
      },
      {
        "id": 2,
        "text": "Acidified glycerol lysis test"
      },
      {
        "id": 3,
        "text": "Osmotic fragility test"
      },
      {
        "id": 4,
        "text": "NESTROFT test"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The peripheral smear shows hyperchromic RBCs with loss of central pallor or spherocytes. These findings are suggestive of <strong>hereditary spherocytosis</strong>. The <strong>eosin-5-maleimide</strong> test is the <strong>most specific</strong> investigation for this condition.&nbsp;</p>\n<p>It is a <strong>flow cytometric test</strong> based on the interaction between the dye eosin-5-maleimide and band 3 protein.</p>\n<p>Other investigations that can be performed in this condition are:</p>\n<p><strong>Acidified glycerol lysis test:</strong> Spherocytes from patients with hereditary spherocytosis lyse more quickly than normal red blood cells when incubated in a phosphate buffered hypotonic solution with added glycerol. It has&nbsp;greater sensitivity and specificity than the osmotic fragility test.</p>\n<p><strong>Osmotic fragility test:</strong>&nbsp;Detects hemolysis by measuring the fraction of total hemoglobin released from red cells when suspended in progressively more dilute salt concentrations.</p>\n<p>Note: NESTROFT (Naked eye single tube red-cell osmotic fragility test) is a highly sensitive test used as a screening test for thalassemia.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/03fa09fb02f940b9aa4e42257af3ee04.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following is true regarding the treatment of hereditary spherocytosis?",
    "choices": [
      {
        "id": 1,
        "text": "Cholecystectomy is only indicated for patients with clinical cholelithiasis at the time of splenectomy"
      },
      {
        "id": 2,
        "text": "Cholecystectomy cannot be performed via laparoscopic route for patients with HS and pigment gall stones"
      },
      {
        "id": 3,
        "text": "Splenectomy is indicated in patients with mild and asymptomatic disease only after puberty"
      },
      {
        "id": 4,
        "text": "Lifelong penicillin prophylaxis after splenectomy is mandatory for all adult patients"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Cholecystectomy</strong> at the time of splenectomy is indicated in patients with hereditary spherocytosis (HS) only if they have<strong> symptomatic cholelithiasis</strong> at the time of surgery. It is usually carried out via a&nbsp;<strong>laparoscopic</strong>&nbsp;approach.</p>\n<p><strong>Penicillin prophylaxis</strong> after splenectomy is controversial. Routine penicillin prophylaxis is not mandatory for adults. It is recommended&nbsp;up to age of five and for at least one year following splenectomy.</p>\n<p>Guidelines for the timing of <strong>splenectomy</strong> in HS:</p>\n<ul>\n<li>Mild cases&nbsp;-&nbsp;avoid splenectomy.</li>\n<li>Moderate cases&nbsp;- delay until puberty</li>\n<li>Severe cases - at 4&ndash;6 years of age</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The peripheral smear of a patient is given below. What is the most common mutation associated with the hereditary form of this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Spectrin"
      },
      {
        "id": 2,
        "text": "Band 4.2"
      },
      {
        "id": 3,
        "text": "Band 4.1"
      },
      {
        "id": 4,
        "text": "Ankyrin"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given peripheral smear shows&nbsp;oval, elongated, rod, or cigar-shaped RBCs suggestive of <strong>elliptocytosis</strong>. The hereditary form is most commonly associated with the <strong>spectrin</strong> genes.</p>\n<p>The following proteins are implicated in <strong>hereditary elliptocytosis</strong> (HE):</p>\n<ul>\n<li>&alpha;-Spectrin (SPTA1 gene) - 65%</li>\n<li>&beta;-Spectrin (SPTB gene) - 30%</li>\n<li>Band 4.1&nbsp;</li>\n</ul>\n<p>The treatment of choice is splenectomy, preferably after 5 years of age.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/f5f168637ef3475cabdb47b10b90886b.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A young couple comes to you for genetic counseling. The husband is a known case of G6PD deficiency and is concerned about passing it on to his future children. What is the chance that his children will inherit the disease?",
    "choices": [
      {
        "id": 1,
        "text": "Only male children will be affected"
      },
      {
        "id": 2,
        "text": "1 in 2 chance"
      },
      {
        "id": 3,
        "text": "Females can inherit the mutation"
      },
      {
        "id": 4,
        "text": "1 in 4 chance"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>G6PD deficiency is an <strong>X-linked recessive</strong> disorder. <strong>Male children</strong> of an affected man are<strong> not affected</strong> as they receive only the paternal Y chromosome. However, the mutation can be passed on to <strong>female</strong> children, who are typically <strong>carriers</strong> of the disease.</p>\n<p>G6PD deficiency is the most common enzymatic disorder of RBCs.&nbsp;G6PD enzyme is involved in the generation of<strong> NADPH</strong> and protects RBCs from <strong>oxidative injury</strong>.<span class=\"headingEndMark\">&nbsp;Hence, patients with</span>&nbsp;G6PD deficiency have episodes of acute hemolysis in the setting of oxidant injury from medications, acute infections, and certain foods (fava beans/broad&nbsp;beans).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 35-year-old male with chronic bacterial prostatitis was treated with cotrimoxazole.  Within a few days, he developed malaise, jaundice, abdominal pain, and dark urine. The blood picture is given below. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Hemolytic uremic syndrome"
      },
      {
        "id": 2,
        "text": "Autoimmune hemolytic anemia"
      },
      {
        "id": 3,
        "text": "Paroxysmal nocturnal hemoglobinuria"
      },
      {
        "id": 4,
        "text": "Glucose 6 phosphate dehydrogenase deficiency"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical features are suggestive of an <strong>acute hemolytic </strong>reaction following the administration of cotrimoxazole. This is suggestive of glucose-6-phosphate dehydrogenase (<strong>G6PD</strong>) <strong>deficiency</strong>.</p>\n<p>In G6PD deficiency&nbsp;uncontrolled oxidative stress causes hemoglobin to denature and form Heinz bodies. Removal of Heinz bodies by macrophages in the spleen results in the formation of characteristic <strong>bite cells</strong>&nbsp;or degmacytes or blister cells (as shown in the image).</p>\n<p>A hemolytic attack starts with abrupt onset of malaise, weakness, and abdominal or lumbar pain. After an interval of several hours to 2&ndash;3 days, the patient develops jaundice and often dark urine, due to <strong>hemoglobinuria</strong>.&nbsp;</p>\n<p>Drugs that carry the risk of clinical hemolysis in persons with G6PD deficiency:</p>\n<table>\n<tbody>\n<tr>\n<td>\n<p>Drug groups</p>\n</td>\n<td>\n<p>Examples</p>\n</td>\n</tr>\n<tr>\n<td>\n<p>Antimalarials</p>\n</td>\n<td>\n<p>Primaquine</p>\n<p><strong>Chloroquine</strong></p>\n<p>Dapsone/chlorproguanil</p>\n</td>\n</tr>\n<tr>\n<td>\n<p>Sulphonamides/</p>\n<p>sulphones</p>\n</td>\n<td>\n<p><strong>Sulfamethoxazole</strong></p>\n<p>Sulfasalazine</p>\n<p>Sulfisoxazole</p>\n</td>\n</tr>\n<tr>\n<td>\n<p>Antibacterial/</p>\n<p>antibiotics</p>\n</td>\n<td>\n<p>Cotrimoxazole</p>\n<p>Ciprofloxacin</p>\n<p>Chloramphenicol</p>\n<p>Nalidixic acid</p>\n<p>Norfloxacin</p>\n<p><strong>Nitrofurantoin</strong></p>\n</td>\n</tr>\n<tr>\n<td>\n<p>Others</p>\n</td>\n<td>\n<p>Naphthalene</p>\n<p><strong>Methylene blue</strong></p>\n<p>Rasburicase</p>\n</td>\n</tr>\n</tbody>\n</table>\n<p>Note: Cotrimoxazole contains sulfamethoxazole.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3834becd3c32423ea85469a923ac8a91.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "The peripheral smear of a patient is given below. It is characteristic of which of the following conditions?",
    "choices": [
      {
        "id": 1,
        "text": "Glucose 6 Phosphate dehydrogenase deficiency"
      },
      {
        "id": 2,
        "text": "Pyruvate kinase deficiency"
      },
      {
        "id": 3,
        "text": "5' nucleotidase deficiency"
      },
      {
        "id": 4,
        "text": "Cytochrome b5 reductase deficiency"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The above peripheral smear shows&nbsp;<strong>basophilic stippling</strong>. It is characteristic of&nbsp;<strong>5' nucleotidase deficiency.</strong></p>\n<p>Pyrimidine 5'-nucleotidase (P5'N-1) deficiency is the third most common enzyme abnormality causing <strong>hereditary</strong> <strong>hemolytic anemia</strong>. It is an&nbsp;<strong>autosomal recessive</strong>&nbsp;trait. &nbsp;</p>\n<p>The hallmark of this enzyme deficiency is the presence of pronounced<strong> basophilic stippling </strong>and&nbsp;accumulation of pyrimidine nucleotides&nbsp;<strong>(RNA</strong> <strong>remnants</strong>) within erythrocytes.&nbsp;</p>\n<p><strong>Cabot rings&nbsp;</strong>may also be seen. They&nbsp;are thin, threadlike, red to violet rings or figure-of-8 shaped inclusions in red blood cells. They are remnants of the <strong>mitotic spindle</strong> and are seen in conditions causing dyserythropoiesis.</p>\n<p>Basophilic stippling is also seen in the following conditions:</p>\n<ul>\n<li>Lead toxicity</li>\n<li>Sideroblastic anemia</li>\n<li>Severe thalassemia</li>\n<li>Conditions with impaired cell division</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d03687414d4f4a9a9b77cff171f60c1f.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A patient with SLE is found to have warm autoimmune hemolytic anemia. Name the antibody and the site of hemolysis in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "IgM and Extavascular hemolysis"
      },
      {
        "id": 2,
        "text": "IgG and extravascular hemolysis"
      },
      {
        "id": 3,
        "text": "IgM and intravascular hemolysis"
      },
      {
        "id": 4,
        "text": "IgG and intravascular hemolysis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The antibody involved in <strong>warm</strong> autoimmune hemolytic anemia (<strong>AIHA</strong>) is <strong>IgG</strong>, which causes&nbsp;<strong>extravascular</strong> <strong>hemolysis</strong>.</p>\n<p>IgG is called a&nbsp;warm<strong>&nbsp;</strong>antibody, as it binds to target proteins&nbsp;at <strong>37&nbsp;<sup>o</sup>C.&nbsp;</strong>On the other hand,&nbsp;<strong>cold</strong> antibodies or <strong>IgM</strong> are reactive at 4 to 30<sup>o</sup>C.</p>\n<p>In AIHA, autoantibodies against RBC antigens are produced which coat the RBC membrane. The Fc portion of the antibody is recognized by the Fc receptor on macrophages causing <strong>phagocytosis</strong>. RBC destruction takes place in extravascular sites where macrophages are abundant.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Patients with which of the following are least likely to develop autoimmune hemolytic anemia?",
    "choices": [
      {
        "id": 1,
        "text": "Infectious mononucleosis"
      },
      {
        "id": 2,
        "text": "Non-Hodgkin's lymphoma"
      },
      {
        "id": 3,
        "text": "Ulcerative colitis"
      },
      {
        "id": 4,
        "text": "Chronic myeloid leukemia"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Autoimmune hemolytic anemia (<strong>AIHA</strong>) is commonly associated with <strong>CLL</strong> (chronic lymphocytic leukemia). It is not a typical feature of CML (chronic myeloid leukemia).</p>\n<p>AIHA can develop secondary to several autoimmune and infectious causes, as well as drugs.<strong>&nbsp;Drug-induced</strong>&nbsp;hemolytic anemia can occur by the following mechanisms:</p>\n<table style=\"height: 336px;\" width=\"370\">\n<tbody>\n<tr>\n<td style=\"width: 178.021px; text-align: center;\"><strong>Mechanism</strong></td>\n<td style=\"width: 178.021px; text-align: center;\"><strong>Drugs</strong></td>\n</tr>\n<tr>\n<td style=\"width: 178.021px;\">\n<p><strong>Adsorption</strong>:</p>\n<p>Drugs coat the RBC membrane.&nbsp;Antibodies are directed against the membrane&ndash;drug complex</p>\n</td>\n<td style=\"width: 178.021px;\">\n<p>Cefotetan</p>\n<p>Ceftriaxone</p>\n<p>Piperacillin</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 178.021px;\">\n<p><strong>Innocent bystander:</strong></p>\n<p>Drugs&nbsp;bind to antibodies in the plasma.&nbsp;This immune complex activates the complement system and destroys nearby RBCs (innocent bystanders)</p>\n</td>\n<td style=\"width: 178.021px;\">\n<p>Sulfonamides</p>\n<p>Quinine</p>\n<p>Quinidine</p>\n<p>Phenothiazines&nbsp;&nbsp;</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 178.021px;\">Some drugs trigger the production of <strong>autoantibodies</strong></td>\n<td style=\"width: 178.021px;\">Methyldopa</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following are associated with a positive Coombs test?",
    "choices": [
      {
        "id": 1,
        "text": "1, 2, 4"
      },
      {
        "id": 2,
        "text": "2, 3, 5"
      },
      {
        "id": 3,
        "text": "2, 4, 5"
      },
      {
        "id": 4,
        "text": "1, 3, 4"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>In <strong>PCH,</strong>&nbsp;the <strong>direct&nbsp;</strong>Coomb's test will be <strong>positive</strong> for <strong>complement</strong> only. This condition is characterized by the presence of the <strong>Donath-Landsteiner</strong> antibody. It is a unique antibody with anti-P specificity at 4&deg;C. Hence, it binds to the RBC at 4&deg;C. However, it causes <strong>complement-mediated lysis</strong> at 37&deg;C.</p>\n<p style=\"text-align: left;\">Interpretation of direct Coomb's test results:</p>\n<table style=\"height: 124px; width: 371px;\">\n<tbody>\n<tr>\n<td style=\"width: 111px; text-align: center;\" rowspan=\"2\">Condition</td>\n<td style=\"width: 254px; text-align: center;\" colspan=\"2\">Agglutination with</td>\n</tr>\n<tr>\n<td style=\"width: 129px; text-align: center;\">anti- IgG</td>\n<td style=\"width: 125px; text-align: center;\">anti- C3</td>\n</tr>\n<tr>\n<td style=\"width: 111px;\">Warm AIHA</td>\n<td style=\"width: 129px; text-align: center;\">+</td>\n<td style=\"width: 125px; text-align: center;\">+</td>\n</tr>\n<tr>\n<td style=\"width: 111px;\">Drug-induced</td>\n<td style=\"width: 129px; text-align: center;\">+</td>\n<td style=\"width: 125px; text-align: center;\">+</td>\n</tr>\n<tr>\n<td style=\"width: 111px; text-align: center;\">PCH</td>\n<td style=\"width: 129px; text-align: center;\">-</td>\n<td style=\"width: 125px; text-align: center;\">+</td>\n</tr>\n<tr>\n<td style=\"width: 111px;\">Cold agglutinin disease (IgM)</td>\n<td style=\"width: 129px; text-align: center;\">-</td>\n<td style=\"width: 125px; text-align: center;\">+</td>\n</tr>\n<tr>\n<td style=\"width: 111px; text-align: center;\">PNH</td>\n<td style=\"width: 129px; text-align: center;\">-</td>\n<td style=\"width: 125px; text-align: center;\">-</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c77092a1cb4d4020ac7fbc6022a783b5x1280x1197.PNG"
    ]
  },
  {
    "text": "A 20-year-old woman presented with fatigue and intermittent dark-colored urine. Further evaluation revealed positive Donath  Landsteiner antibodies. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Warm autoimmune hemolytic anemia"
      },
      {
        "id": 2,
        "text": "Cold autoimmune hemolytic anemia"
      },
      {
        "id": 3,
        "text": "Paroxysmal cold hemoglobinuria"
      },
      {
        "id": 4,
        "text": "Paroxysmal nocturnal hemoglobinuria"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Donath Landsteiner</strong> antibody is specific for paroxysmal cold hemoglobinuria (<strong>PCH</strong>). PCH is a rare form of autoimmune hemolytic anemia.</p>\n<p>The mechanism of this antibody includes:</p>\n<ul>\n<li>Binding to RBCs at 4&deg;C</li>\n<li>Complement-mediated lysis at 37&deg;C</li>\n</ul>\n<p>This condition presents with&nbsp;<strong>intravascular hemolysis</strong> and <strong>hemoglobinuria</strong>.&nbsp;Blood transfusion is required in severe anemia. It is a self-limiting condition.</p>\n<p>The differences between PCH and PNH are given below:</p>\n<table style=\"height: 351px;\" width=\"425\">\n<tbody>\n<tr>\n<td style=\"width: 134px; text-align: center;\">Condition</td>\n<td style=\"width: 134.667px; text-align: center;\"><strong>Paroxysmal nocturnal hemoglobinuria (PNH)</strong></td>\n<td style=\"width: 134.667px; text-align: center;\"><strong>Paroxysmal cold hemoglobinuria (PCH)</strong></td>\n</tr>\n<tr>\n<td style=\"width: 134px; text-align: center;\">Onset</td>\n<td style=\"width: 134.667px; text-align: center;\">Chronic with acute exacerbations</td>\n<td style=\"width: 134.667px; text-align: center;\">Acute</td>\n</tr>\n<tr>\n<td style=\"width: 134px; text-align: center;\">Pathogenesis</td>\n<td style=\"width: 134.667px; text-align: center;\"><strong>Complement-mediated</strong> destruction of CD59/55(&ndash;) RBCs</td>\n<td style=\"width: 134.667px; text-align: center;\"><strong>Immune lysis</strong> of normal red cells</td>\n</tr>\n<tr>\n<td style=\"width: 134px; text-align: center;\">Diagnosis</td>\n<td style=\"width: 134.667px; text-align: center;\">Flow cytometry to display a CD55/CD59(&ndash;) red cell population</td>\n<td style=\"width: 134.667px; text-align: center;\">Test for <strong>Donath-Landsteiner</strong> antibody</td>\n</tr>\n<tr>\n<td style=\"width: 134px; text-align: center;\">Triggers</td>\n<td style=\"width: 134.667px; text-align: center;\">Infections, alcohol, exercise, stress, or&nbsp; medications</td>\n<td style=\"width: 134.667px; text-align: center;\">Triggered by viral infection</td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Microangiopathic hemolytic anemia is seen in all of the following except:",
    "choices": [
      {
        "id": 1,
        "text": "Antiphospholipid antibody syndrome"
      },
      {
        "id": 2,
        "text": "Vasculitis"
      },
      {
        "id": 3,
        "text": "Prosthetic heart valves"
      },
      {
        "id": 4,
        "text": "Eclampsia"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Microangiopathic&nbsp;hemolytic anemia (MAHA) is not seen in <strong>prosthetic</strong> <strong>heart</strong> <strong>valves</strong>. It is associated with <strong>macroangiopathic</strong> hemolytic anemia.</p>\n<p><strong>MAHA</strong> refers to cell fragmentation that occurs in <strong>microcirculation</strong>. Microvascular lesions lead to luminal narrowing due to the deposition of fibrin and platelets. These produce shear stress that mechanically injures passing red cells. Hence, it is a type of non-immune hemolysis (<strong>Coombs-negative</strong>). On peripheral blood smear, <strong>schistocytes</strong> are seen.</p>\n<p>Common causes of MAHA include:</p>\n<ul>\n<li>Thrombotic thrombocytopenic purpura</li>\n<li>Hemolytic uremic syndrome</li>\n<li>Disseminated intravascular coagulation</li>\n<li><strong>Vasculitis</strong></li>\n<li>Malignant hypertension</li>\n<li><strong>APLA</strong> syndrome</li>\n<li>Drug-induced hemolysis</li>\n<li><strong>Eclampsia</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In patients with atypical hemolytic uremic syndrome, which of the following mutations is associated with the best prognosis?",
    "choices": [
      {
        "id": 1,
        "text": "Complement factor H"
      },
      {
        "id": 2,
        "text": "Complement factor I"
      },
      {
        "id": 3,
        "text": "Complement factor B"
      },
      {
        "id": 4,
        "text": "Membrane cofactor protein"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The <strong>best prognosis</strong> in atypical HUS is seen in <strong>membrane cofactor protein</strong> (MCP) gene&nbsp;mutation.</p>\n<p>Familial HUS or atypical HUS (aHUS) is the only inherited cause of extracorpuscular&nbsp;hemolytic anemia.&nbsp;It can occur due to <strong>mutations</strong> in any one of several genes encoding <strong>complement regulatory proteins</strong>. Mutations&nbsp;in the following genes are seen:</p>\n<ul>\n<li>Membrane cofactor protein - best&nbsp;prognosis</li>\n<li>Complement factor B -&nbsp;worst prognosis&nbsp;</li>\n<li>Complement factor H - most common&nbsp;</li>\n<li>Complement factor I - least common&nbsp;</li>\n</ul>\n<p>In these patients, infection or other triggers cause complement activation through the alternative pathway. This causes hemolysis and damage to endothelial cells in the kidney. It is usually self-limited.</p>\n<p>The standard treatment is <strong>plasma exchange</strong>. Eculizumab has recently been shown to be beneficial in atypical HUS.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You have decided to prescribe an oral iron chelator for a 10-year-old girl with thalassemia. Which of the following will you not prefer?",
    "choices": [
      {
        "id": 1,
        "text": "Deferiprone"
      },
      {
        "id": 2,
        "text": "Deferasirox"
      },
      {
        "id": 3,
        "text": "Deferoxamine"
      },
      {
        "id": 4,
        "text": "Both A and B"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Deferoxamine</strong> has poor oral bioavailability and is administered <strong>parenterally</strong> (SC/IV).</p>\n<p>Oral formulations of both<strong>&nbsp;deferiprone</strong> and <strong>d</strong><strong>eferasirox</strong> are available.</p>\n<p><span class=\"nowrap\">The adverse effects of iron chelators include:</span></p>\n<ul>\n<li><span class=\"nowrap\">Deferiprone -&nbsp;neutropenia, and agranulocytosis.</span></li>\n<li><span class=\"nowrap\">Deferasirox - transaminitis and mild, asymptomatic rise in serum creatinine</span></li>\n<li><span class=\"nowrap\">Deferoxamine - occasional cataracts, deafness, and local skin reactions, but is usually well-tolerated</span></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is the best test to screen patients for thalassemia?",
    "choices": [
      {
        "id": 1,
        "text": "Cellulose acetate hemoglobin electrophoresis"
      },
      {
        "id": 2,
        "text": "Naked eye single tube red-cell osmotic fragility test"
      },
      {
        "id": 3,
        "text": "Eosin 5' maleimide flow cytometry"
      },
      {
        "id": 4,
        "text": "Automated high performance liquid chromatography"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>&nbsp;</p>\n<p>The following tests are <strong>specific</strong> and used to confirm the diagnosis of thalassemia:</p>\n<ul>\n<li>Hemoglobin electrophoresis</li>\n<li>High-performance liquid chromatography (HPLC)</li>\n<li>Genetic testing&nbsp;</li>\n</ul>\n<p>Note: Eosin 5' maleimide (EMA)&nbsp;flow cytometry is the most specific test for the diagnosis of hereditary spherocytosis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a609c616f696497193983869d15c7671x360x604.JPEG"
    ]
  },
  {
    "text": "During a master health check-up, a 25-year-old woman was found to have the following lab values. Which of the following will help in establishing a diagnosis in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Free erythorcyte protoporphyrin levels"
      },
      {
        "id": 2,
        "text": "Hemoglobin electrophoresis"
      },
      {
        "id": 3,
        "text": "Schilling test"
      },
      {
        "id": 4,
        "text": "Bone marrow biopsy"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>This clinical scenario is consistent with <strong>&beta;-thalassemia minor</strong>. The diagnosis can be established by<strong> hemoglobin electrophoresis</strong>.</p>\n<p>This condition presents with the following features:&nbsp;</p>\n<ul>\n<li>Microcytes<strong>&nbsp;</strong>(N: 80-96 fL)</li>\n<li>Hypochromic<strong>&nbsp;</strong>(N: 27-33 pg)</li>\n<li>Mild anemia</li>\n<li>Target cells<strong>&nbsp;</strong></li>\n<li>Normal iron profile&nbsp;</li>\n</ul>\n<p>Hemoglobin electrophoresis findings are as follows:</p>\n<ul>\n<li>&nbsp;&ge;4% of HbA2</li>\n<li>&nbsp;&le;5% of HbF&nbsp;</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following clinical manifestations is not associated with sickle cell trait?",
    "choices": [
      {
        "id": 1,
        "text": "Hyposthenuria"
      },
      {
        "id": 2,
        "text": "Painless hematuria"
      },
      {
        "id": 3,
        "text": "Papillary necrosis"
      },
      {
        "id": 4,
        "text": "Acute pain crisis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Acute pain crisis</strong> is <strong>not associated</strong> with <strong>sickle cell trait</strong>. Acute pain crisis is classicaly seen in sickle cell disease.&nbsp;</p>\n<p>Manifestations of sickle cell trait include:</p>\n<ul>\n<li>Often <strong>asymptomatic</strong>.</li>\n<li><strong>Hyposthenuria</strong></li>\n<li><strong>Painless hematuria</strong> - due to <strong>papillary necrosis</strong></li>\n<li>Recurrent UTIs</li>\n<li>Risk of renal medullary carcinoma - rare</li>\n<li>Increased risk of CKD</li>\n<li>Sloughing of papillae with urethral obstruction is very rare</li>\n<li>Anemia and painful crises are rare.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Patients with sickle cell anemia most commonly present with which of the following?",
    "choices": [
      {
        "id": 1,
        "text": "Acute pain crisis"
      },
      {
        "id": 2,
        "text": "Splenic sequestration crisis"
      },
      {
        "id": 3,
        "text": "Acute chest syndrome"
      },
      {
        "id": 4,
        "text": "Isosthenuria"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Acute pain crisis</strong> is the most common clinical presentation of<strong> sickle cell anemia</strong>.</p>\n<p>These are intermittent episodes of<strong>&nbsp;vaso-occlusion</strong>&nbsp;in connective and musculoskeletal structures. This results in ischemia resulting in acute pain and tenderness, fever, tachycardia, and anxiety.&nbsp;The management includes vigorous hydration, evaluation for underlying causes, and aggressive analgesia.</p>\n<p>Other manifestations of sickle cell anemia include:</p>\n<ul>\n<li><strong>Hand-foot</strong> syndrome - painful infarcts of the digits and dactylitis</li>\n<li><strong>Priapism</strong> - infarction of the penile venous outflow tracts</li>\n<li>Chronic lower leg ulcers - ischemia and superinfection in the distal circulation</li>\n<li><strong>Splenic sequestration </strong>crisis&nbsp;<strong>-</strong>&nbsp;life-threatening&nbsp;complication due to acute venous obstruction that requires emergency transfusion and/or splenectomy</li>\n<li><strong>Aplastic crisis</strong> - commonly secondary to parvovirus B19 infection</li>\n<li><strong>Acute chest syndrome</strong>&nbsp;- sickling within the lung, producing pain and temporary pulmonary dysfunction. Treatment&nbsp;may include lifelong transfusion support, using partial exchange transfusion</li>\n<li><strong>Stroke</strong> - common in children</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '089 Hemolytic Anemia';
        let hierarchy = ["Marrow", "qBank", "Medicine"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>