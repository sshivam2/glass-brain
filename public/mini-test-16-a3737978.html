<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini Test 16 - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2021-22
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "An obese man was posted for bariatric surgery. Which of the following is the inhalational agent of choice for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Halothane"
      },
      {
        "id": 2,
        "text": "Desflurane"
      },
      {
        "id": 3,
        "text": "Sevoflurane"
      },
      {
        "id": 4,
        "text": "Isoflurane"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Desflurane</strong> is the <strong>inhalational anesthetic agent of choice</strong> for this patient.</p>\n<p>In obese individuals, the increased fat stores<strong> increase</strong> the <strong>volume of distribution</strong> for<strong> lipid-soluble drugs</strong> when compared to a lean individual of the same body weight. This increases the peripheral distribution of the lipid-soluble agents thus resulting in increased recovery time. There is an increase in the cardiac output in obese individuals that increases the early distribution of the drugs. Hence <strong>fat-soluble drugs</strong> should be administered based on the <strong>total body weight.</strong> Water-soluble agents like neuromuscular blockers have a smaller peripheral distribution that is minimally increased by body fat. Therefore, <strong>water-soluble agents</strong> are dosed based on the <strong>ideal body weight</strong>.</p>\n<p>Among the commonly used inhalational anesthetics, <strong>desflurane</strong> is the <strong>least fat-soluble</strong> which leads to a faster recovery. <strong>Desflurane</strong> is also <strong>minimally metabolized</strong> by the liver, thereby reducing hepatotoxicity.&nbsp;</p>\n<table style=\"width: 635px; height: 197px;\">\n<tbody>\n<tr>\n<td style=\"width: 184.953px; text-align: center;\">Inhalational agent</td>\n<td style=\"width: 230.094px; text-align: center;\">Blood-gas partition coefficient</td>\n</tr>\n<tr>\n<td style=\"width: 184.953px; text-align: center;\">Halothane</td>\n<td style=\"width: 230.094px; text-align: center;\">2.5</td>\n</tr>\n<tr>\n<td style=\"width: 184.953px; text-align: center;\">Isoflurane</td>\n<td style=\"width: 230.094px; text-align: center;\">1.4</td>\n</tr>\n<tr>\n<td style=\"width: 184.953px; text-align: center;\">Sevoflurane</td>\n<td style=\"width: 230.094px; text-align: center;\">0.65</td>\n</tr>\n<tr>\n<td style=\"width: 184.953px; text-align: center;\">Desflurane</td>\n<td style=\"width: 230.094px; text-align: center;\">0.45</td>\n</tr>\n</tbody>\n</table>\n<p><strong>Blood-gas partition co-efficient</strong> determines the <strong>solubility</strong> of the anesthetic agent in the blood. The <strong>higher</strong> the blood-gas partition coefficient, the <strong>higher</strong> will be the <strong>solubility</strong> of the anesthetic agent. This leads to its <strong>greater uptake</strong> by pulmonary circulation. The higher the uptake of the anesthetic agent, the higher the difference between the inspired and alveolar concentrations, which leads to a <strong>slower rate of induction</strong> and <strong>recovery.</strong>&nbsp;Desflurane has a very low blood:gas partition coefficient (0.42). Thus, the alveolar and blood concentrations rapidly rise to the level of inspired concentration, providing rapid induction of anesthesia and rapid recovery.</p>\n<p>Other options:</p>\n<p>Option A- <strong>Halothane</strong> is a high fat-soluble agent and can result in halothane hepatitis due to increased metabolism in obese individuals. Hence it is avoided.</p>\n<p>Option C- <strong>Sevoflurane</strong> has a relatively higher fat solubility compared to desflurane.</p>\n<p>Option D- <strong>Isoflurane</strong> has a higher fat-gas partition co-efficient resulting in increased recovery time from anesthesia.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 68-year-old male patient is brought by his daughter after claiming to have seen a snake on multiple occasions even though one was not present. He has had difficulty with performing daily activities for the past 8 months. Examination reveals bradykinesia and rigidity. No personality changes were observed. MMSE score is 20 with relative sparing of memory. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Frontotemporal dementia"
      },
      {
        "id": 2,
        "text": "Alzheimer's disease"
      },
      {
        "id": 3,
        "text": "Parkinson's disease dementia"
      },
      {
        "id": 4,
        "text": "Dementia with Lewy bodies"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p style=\"text-align: left;\">The given clinical vignette describes a case of <strong>Lewy-body dementia</strong>.</p>\n<p style=\"text-align: left;\">Fluctuating cognition, <strong>visual hallucinations</strong>, and <strong>motor symptoms</strong> of Parkinson's like <strong>bradykinesia</strong> and <strong>rigidity</strong> are the core features that help in the diagnosis of this disease. Characteristically, <strong>dementia</strong> in this condition <strong>develops very early</strong> and usually <strong>within 1 year</strong> of the onset of motor symptoms.\u00a0<strong>Memory is usually spared</strong> in this condition. \u00a0MMSE score of less than 24 out of 30 indicates impaired cognitive function.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Anaplerosis is the process of refilling the catalytic intermediates of the citric acid cycle that carry acetyl CoA as it gets oxidized. All of the following are anaplerotic reactions, except _____.",
    "choices": [
      {
        "id": 1,
        "text": "Conversion of pyruvate to oxaloacetate"
      },
      {
        "id": 2,
        "text": "Conversion of succinyl CoA to heme"
      },
      {
        "id": 3,
        "text": "Conversion of glutamate to \u03b1-ketoglutarate"
      },
      {
        "id": 4,
        "text": "Conversion of propionyl CoA to succinyl CoA"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p style=\"text-align: left;\">Conversion of <strong>succinyl CoA </strong>to<strong> heme</strong> is not an anaplerotic reaction. It is an example of a\u00a0<strong>cataplerotic reaction.</strong></p>\n<p style=\"text-align: left;\">The anaplerotic process is the replenishment of the intermediates of the citric acid (Krebs) cycle to replace the catalytic processes and to ensure the continuation of the cycle.</p>\n<p style=\"text-align: left;\">The most important<strong> anaplerotic reaction</strong> is the\u00a0<strong>carboxylation </strong>of<strong> pyruvate</strong>\u00a0to\u00a0<strong>oxaloacetate</strong>, which is catalyzed by <strong>pyruvate carboxylase. </strong>This reaction\u00a0is important to maintain an adequate concentration of oxaloacetate for the condensation reaction with acetyl-CoA. On accumulation, acetyl-CoA acts as an allosteric activator of pyruvate carboxylase and an inhibitor of pyruvate dehydrogenase, thereby providing an adequate supply of oxaloacetate.</p>\n<p style=\"text-align: left;\">Other anaplerotic reactions:</p>\n<ul style=\"text-align: left;\">\n<li><strong>Glutamate </strong>and<strong> glutamine</strong>\u00a0to\u00a0<strong>\u03b1-ketoglutarate</strong>, a reaction\u00a0catalyzed by glutamate dehydrogenase and glutaminase, respectively</li>\n<li>Compounds that produce\u00a0<strong>propionyl CoA</strong>\u00a0can be then carboxylated and isomerized to <strong>succinyl CoA</strong>.</li>\n<li><strong>Transamination </strong>of <strong>aspartate</strong>\u00a0to form oxaloacetate.</li>\n<li><strong>Pyruvate</strong> can be carboxylated to <strong>malate</strong>.</li>\n</ul>\n<p style=\"text-align: left;\">The <strong>cataplerotic process</strong> is the metabolism of the citric acid cycle intermediates that leave the cycle and participate in the biosynthesis of other compounds. These processes are required to\u00a0redirect\u00a0<strong>citrate</strong> toward fatty acid synthesis;\u00a0<strong>succinyl CoA</strong> to <strong>heme</strong> synthesis,\u00a0<strong>malate</strong> to gluconeogenesis; and\u00a0<strong>\u03b1-ketoglutarate</strong> to amino acid synthesis, purine synthesis, and neurotransmitter synthesis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "On examination of a 26-year-old man, tachycardia was observed during inspiration. The doctor told him that it is respiratory sinus arrhythmia. Which of the following mechanism explains this phenomenon?",
    "choices": [
      {
        "id": 1,
        "text": "Bainbridge reflex"
      },
      {
        "id": 2,
        "text": "Bezold-Jarisch reflex"
      },
      {
        "id": 3,
        "text": "Cushing reflex"
      },
      {
        "id": 4,
        "text": "J reflex"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<div class=\"ng-scope\">\n<div class=\"ng-scope\">\n<p class=\"ng-binding\">The above mechanism is explained by the\u00a0<strong>Bainbridge reflex.</strong></p>\n<p class=\"ng-binding\">Tachycardia, in response to increased venous return, is suggestive of <strong>Bainbridge reflex.\u00a0</strong>During inspiration, there is an increased venous return due to reduced intrathoracic pressure. This leads to\u00a0<strong>right atrial distension.\u00a0</strong>The stretch receptors of the atria transmit the afferent signals via the vagus nerves to the medulla of the brain.\u00a0The efferent signals are transmitted back through vagal\u00a0and sympathetic nerves to result in <strong>tachycardia</strong> and <strong>increase</strong> the <strong>strength</strong>\u00a0of <strong>heart contraction</strong>. Thus, this reflex helps prevent\u00a0damming of blood in the veins, atria, and pulmonary\u00a0circulation.</p>\n<p>Other options:</p>\n<p>Option B:<strong> Bezold\u2013Jarisch reflex:\u00a0</strong>Activation of chemosensitive vagal C fibers in the cardiopulmonary region causes profound <strong>brady\u00adcardia,</strong> <strong>hypotension,</strong> and a brief period of <strong>apnoea</strong> followed by <strong>rapid shallow breathing</strong>. It is seen in cases of myocardial ischemia and reperfusion due to the increased synthesis of oxygen free radicals.\u00a0</p>\n<p>Option C:<strong> Cushing</strong>\u00a0<strong>r</strong><strong>eflex</strong>:\u00a0When there<strong>\u00a0</strong>is increased intracranial\u00a0pressure, the blood supply to Rostral\u00a0Ventro-Lateral Medulla (RVLM) neurons is compromised.\u00a0The local hypoxia and hypercapnia cause an increase in discharge from the neurons, producing <strong>hypertension, bradycardia,</strong> and<strong> irregular respiration.\u00a0</strong></p>\n<p>Option D:<strong> J reflex:\u00a0</strong>The stimulation of the J-receptors (C receptors/juxta-pulmonary capillary receptors) due to hyperinflation of the lung causes reflex <strong>apnea</strong> followed by a <strong>rapid increase in breathing rate</strong>, <strong>bradycardia</strong> and <strong>hypotension</strong>.</p>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The life cycle of which of the following is depicted in the image below?",
    "choices": [
      {
        "id": 1,
        "text": "Japanese encephalitis"
      },
      {
        "id": 2,
        "text": "Zika virus"
      },
      {
        "id": 3,
        "text": "Rabies"
      },
      {
        "id": 4,
        "text": "Nipah virus"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given image depicts the life cycle of the <strong>Nipah virus</strong>.</p>\n<p>Nipah virus&nbsp;is an <strong>RNA</strong> virus that belongs to the family&nbsp;<strong>Paramyxoviridae</strong>, genus Henipavirus.&nbsp;It is a zoonotic virus that shows both animal-to-human (bats, pigs) and human-to-human transmission. The natural hosts are&nbsp;<strong>fruit bats</strong>&nbsp;of the Pteropodidae family.</p>\n<p>The clinical manifestations include asymptomatic subclinical&nbsp;infection, acute respiratory infection, and fatal encephalitis.&nbsp;There is <strong>no treatment</strong> or vaccine available for either people or animals. The primary treatment for humans is <strong>supportive</strong> care.</p>\n<p>Nipah virus is on the WHO list of <strong>Blueprint priority diseases</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/4bd6f0572d234ff7a7a1547f3143977c.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 26-year-old man presented with painful, bleeding genital ulcers. On examination, tender inguinal lymphadenopathy is present. Scraping from the ulcer base was taken and the microscopic appearance of the Gram-stained smear is shown below. What is the causative organism?",
    "choices": [
      {
        "id": 1,
        "text": "Haemophilus ducreyi"
      },
      {
        "id": 2,
        "text": "Treponema pallidum"
      },
      {
        "id": 3,
        "text": "Chlamydia trachomatis serovar L1"
      },
      {
        "id": 4,
        "text": "Chlamydia trachomatis serovar L2"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The image shows the' <strong>school of fish'\u00a0</strong>or '<strong>r</strong><strong>ailroad track'\u00a0</strong>appearance of<em> Haemophilus\u00a0</em><em>ducreyi.</em>\u00a0This appearance is seen when the bacilli are arranged in small groups, whorls or in chains. The given case scenario is suggestive of <strong>chancroid.</strong></p>\n<p><strong>Chancroid</strong> is characterized by <strong>non-indurated, tender</strong>, irregular <strong>ulcers</strong> that may bleed on touch. The neighbouring <strong>lymph nodes</strong> are <strong>enlarged, painful</strong>, and tender.\u00a0</p>\n<p>Other options:</p>\n<p>Option B - <em>Treponema pallidum</em> causes <strong>syphilis</strong>, characterised by <strong>chancre</strong> - a single <strong>painless</strong> ulcer with a clean base and a firm raised border,\u00a0with painless lymphadenopathy.\u00a0Persistent\u00a0<span class=\"s1\">or </span>multiple chancres may be <span class=\"s1\">seen </span>in HIV-infected or other immunodeficient patients.</p>\n<p>Options C and D - <em>Chlamydia trachomatis</em> serovars L1, L2 and L3 cause <strong>lymphogranuloma venereum</strong>, characterised by shallow, <strong>painless ulcers</strong> that progress to painful lymphadenopathy.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/65d9a8b708304e70ab69da7d9cff7bcf.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 37-year-old woman presented with a fever and malaise. On examination, petechiae, a tender, pink nodule on her finger, and a cardiac murmur were appreciated. A probable diagnosis of bacterial endocarditis was made and the blood culture was positive for enterococci. Which of the following is true about enterococcus?",
    "choices": [
      {
        "id": 1,
        "text": "Novobiocin sensitve"
      },
      {
        "id": 2,
        "text": "PYR test negative"
      },
      {
        "id": 3,
        "text": "Optochin sensitive"
      },
      {
        "id": 4,
        "text": "Non-hemolytic on blood agar"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p style=\"text-align: left;\">Enterococcus is <strong>non-hemolytic</strong> on blood agar.</p>\n<p style=\"text-align: left;\"><strong>Enterococcus</strong> belongs to the streptococcaceae family and belongs to the <strong>Lancefield D group</strong>. Enterococcus includes organisms like <em>E.fecalis, E.faecium,</em> and<em> E.durans</em>. They are gram-positive oval cocci that are paired and are arranged at an angle to each other.\u00a0</p>\n<p style=\"text-align: left;\"><span data-preserver-spaces=\"true\">Enterococcus species\u00a0</span><span data-preserver-spaces=\"true\">are generally\u00a0</span><strong><span data-preserver-spaces=\"true\">non-hemolytic,</span></strong><span data-preserver-spaces=\"true\">\u00a0although\u00a0alpha or beta hemolysis is shown by some of the strains. They\u00a0</span><span data-preserver-spaces=\"true\">show growth in\u00a0</span><strong><span data-preserver-spaces=\"true\">6.5% sodium chloride,\u00a0</span></strong><span data-preserver-spaces=\"true\"><strong>40% bile,</strong></span><span data-preserver-spaces=\"true\">\u00a0at a\u00a0<strong>pH of 9.6</strong>, and in 0.1% methylene blue milk. It can cause urinary tract and biliary tract infections, endocarditis, and suppurative infections like an intra-abdominal abscess.</span></p>\n<p style=\"text-align: left;\"><span data-preserver-spaces=\"true\">Other important characteristics of enterococcus are:</span></p>\n<ul style=\"text-align: left;\">\n<li><span data-preserver-spaces=\"true\">They are relatively\u00a0</span><strong><span data-preserver-spaces=\"true\">heat-resistant</span></strong></li>\n<li>They are<strong> PYR\u00a0</strong>(pyrrolidinyl-beta-naphtylamide) <strong>test positive</strong>\u00a0</li>\n<li><span data-preserver-spaces=\"true\"><strong>T</strong><strong>iny magenta pink</strong></span><span data-preserver-spaces=\"true\">\u00a0colonies are formed on MacConkey medium</span></li>\n<li>They ferment mannitol, sorbitol, sucrose and <strong>esculin</strong></li>\n<li>They produce <strong>black colonies</strong> on tellurite blood agar</li>\n</ul>\n<p style=\"text-align: left;\">Treatment: <strong>Vancomycin</strong> is the <strong>drug of choice</strong> for drug-resistant enterococcal infections.</p>\n<p style=\"text-align: left;\">Other options:</p>\n<p style=\"text-align: left;\"><span data-preserver-spaces=\"true\">Option A- <strong>Novobiocin sensitivity</strong> is seen in <em><strong>Staphylococcus epidermidis.</strong></em></span></p>\n<p style=\"text-align: left;\"><span data-preserver-spaces=\"true\">Option B- <strong>PYR test negative</strong> is seen in <em><strong>Streptococcus anginosus.</strong></em></span></p>\n<p style=\"text-align: left;\"><span data-preserver-spaces=\"true\">Option C- <strong>Optochin sensitivity</strong> is associated with <em><strong>Streptococcus pneumonia</strong> </em>while <em><strong>Viridans streptococci</strong></em> are <strong>optochin-resistant.</strong></span></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 28-year-old female patient in her 16th week of gestation came for prenatal karyotyping since her first child is suffering from Down's syndrome. Which among the following statements is false regarding the procedure shown in the image?",
    "choices": [
      {
        "id": 1,
        "text": "Amniocytes are used for testing"
      },
      {
        "id": 2,
        "text": "Limb reduction defect is a known complication"
      },
      {
        "id": 3,
        "text": "Down syndrome can be diagnosed"
      },
      {
        "id": 4,
        "text": "Done between 15-20 weeks"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p style=\"text-align: left;\">The procedure shown in the image is <strong>amniocentesis. Limb reduction defect</strong> is <strong>not</strong> a known <strong>complication</strong> of <strong>amniocentesis</strong>, it is a complication of chorionic villous sampling.\u00a0</p>\n<p style=\"text-align: left;\"><strong>Amniocentesis </strong>is the <strong>most common</strong> prenatal diagnostic procedure. It\u00a0is performed using an\u00a0<strong>aseptic technique, </strong>under direct<strong> sonographic guidance</strong>, using a <strong>20\u201322 gauge spinal needle</strong>. The needle is directed perpendicularly into a clear pocket of amniotic fluid while avoiding the fetus and umbilical cord. Sonography is used to observe the uterine puncture site for bleeding and fetal cardiac motion is documented at the end of the procedure. Approximately <strong>20 to 30 mL</strong> <strong>of fluid</strong> is collected for <strong>fetal karyotyping</strong> or chromosomal microarray analysis.\u00a0</p>\n<table style=\"height: 550px; width: 420.883px;\">\n<tbody>\n<tr style=\"height: 70px;\">\n<td style=\"width: 166px; text-align: center; height: 70px;\">\n<p>Study material</p>\n</td>\n<td style=\"width: 241.883px; text-align: center; height: 70px;\">\n<p>Amniotic fluid with <strong>amniocytes</strong></p>\n</td>\n</tr>\n<tr style=\"height: 70px;\">\n<td style=\"width: 166px; text-align: center; height: 70px;\">\n<p>Time</p>\n</td>\n<td style=\"width: 241.883px; text-align: center; height: 70px;\">\n<p><strong>15-20 weeks</strong></p>\n</td>\n</tr>\n<tr style=\"height: 97px;\">\n<td style=\"width: 166px; text-align: center; height: 97px;\">\n<p>Early amniocentesis</p>\n</td>\n<td style=\"width: 241.883px; text-align: center; height: 97px;\">\n<p>11-14 weeks (associated with increased fetal loss, foot deformities)</p>\n</td>\n</tr>\n<tr style=\"height: 96.2969px;\">\n<td style=\"width: 166px; text-align: center; height: 96.2969px;\">\n<p>Indications</p>\n</td>\n<td style=\"width: 241.883px; text-align: center; height: 96.2969px;\">\n<p>Congenital infections</p>\n<p><strong>Fetal genetic disorders</strong></p>\n<p>Alloimmunization</p>\n<p>Assessment of lung maturity</p>\n</td>\n</tr>\n<tr style=\"height: 124px;\">\n<td style=\"width: 166px; text-align: center; height: 124px;\">Complications</td>\n<td style=\"width: 241.883px; text-align: center; height: 124px;\">\n<p>Fetal loss</p>\n<p>Amniotic fluid leakage</p>\n<p>Transvaginal spotting</p>\n</td>\n</tr>\n</tbody>\n</table>\n<p>\u00a0</p>\n<p>Below is an image showing the procedure of amniocentesis vs chorionic villus sampling.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/2c16baede4a04d6fa429ee8e5f9c671d.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b254bbad07f04e35bfd9db5d9c9acdecx1280x3002.JPEG"
    ]
  },
  {
    "text": "A 23-year-old man presents with throat pain, fever, and pain with swallowing. When he attempts to speak his voice is muffled. The patient tilts his head to his right side. Physical examination shows findings as seen in the image.  Contrast-enhanced CT and needle aspiration reveal the diagnosis. Which of the following is not a complication of this disease?",
    "choices": [
      {
        "id": 1,
        "text": "Periodontal abscess"
      },
      {
        "id": 2,
        "text": "Jugular vein thrombosis"
      },
      {
        "id": 3,
        "text": "Airway obstruction"
      },
      {
        "id": 4,
        "text": "Aspiration pneumonitis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p style=\"text-align: left;\">Periodontal abscess is not an expected complication in this disease.\u00a0The above clinical features and the above image are suggestive of\u00a0<strong>Quinsy</strong>\u00a0or <strong>peritonsillar</strong>\u00a0<strong>abscess</strong>.</p>\n<p style=\"text-align: left;\">Quinsy is the collection of pus between the <strong>fibrous capsule </strong>of the<strong> tonsil </strong>and the <strong>superior constrictor</strong> muscles of the pharynx.</p>\n<p style=\"text-align: left;\">The clinical features are sore throat, odynophagia, muffled voice (<strong>hot potato voice</strong>), foul breath, dysphagia, drooling of saliva, trismus, ipsilateral otalgia, and fever.\u00a0</p>\n<p style=\"text-align: left;\">Physical examination reveals congestion of tonsils, pillars, and soft palate, swollen and edematous uvula pushed to the other side, mucopus over tonsils, cervical lymphadenopathy, and torticollis. This tonsillar swelling can be differentiated from other tonsillar swellings by yellowish spots of purulent material at the opening of crypts (acute follicular tonsillitis), presence of membrane over the tonsils (acute membranous tonsillitis, diphtheria, infectious mononucleosis, vincent angina), or extensive swelling and congestion of the tonsils that they may meet in the midline (acute parenchymatous tonsillitis)</p>\n<p style=\"text-align: left;\">Diagnosis is through CECT/MRI or aspiration of fluid in the abscess.</p>\n<p style=\"text-align: left;\">Management:\u00a0<strong>Antibiotics</strong> and <strong>incision &amp; drainage</strong> to drain the abscess followed by<strong> interval tonsillectomy 4-6 weeks later.\u00a0</strong>Some surgeons prefer surgery during active disease known as<strong>\u00a0</strong>a<strong> hot tonsillectomy</strong>, but this has the risk of rupture and bleeding.</p>\n<p style=\"text-align: left;\">Complications:</p>\n<ul style=\"list-style-type: disc;\">\n<li><strong>Parapharyngeal abscess</strong></li>\n<li><strong>Retropharyngeal abscess</strong></li>\n<li><strong>Airway obstruction</strong></li>\n<li>Septicemia</li>\n<li><strong>Pneumonitis</strong></li>\n<li><strong>Jugular vein thrombosis</strong></li>\n<li>Spontaneous hemorrhage from carotid artery or jugular vein</li>\n</ul>\n<p>\u00a0</p>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/17bf0da68e9e4df38a2b652e2bb001f4.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 63-year-old male patient with dyspepsia, weight loss, and melena is being evaluated with a barium upper gastrointestinal study. An outpouching with a smooth, deep ulcer crater is seen along the lesser gastric curvature and is diagnosed to be a benign gastric ulcer. Which of the following radiological feature is suggestive of a benign gastric ulcer?",
    "choices": [
      {
        "id": 1,
        "text": "Hampton's hump"
      },
      {
        "id": 2,
        "text": "Hampton\u2019s line"
      },
      {
        "id": 3,
        "text": "Carman meniscus sign"
      },
      {
        "id": 4,
        "text": "Ram\u2019s horn sign"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The radiological feature that is suggestive of a benign gastric ulcer is&nbsp;<strong>Hampton's line.</strong></p>\n<p><strong>Hampton&rsquo;s line</strong> is usually a <strong>1 mm thin, radiolucent line </strong>seen at the<strong> neck </strong>of the<strong> ulcer</strong> that represents a rim of undermined mucosa, seen in barium studies. Hampton&rsquo;s line is a feature of <strong>benign gastric ulcers</strong>.</p>\n<p>Other features of a benign ulcer include-</p>\n<ul>\n<li>Location on the lesser curvature</li>\n<li>Extends beyond the gastric wall</li>\n<li>Smooth ulcer mound - representative of edema</li>\n<li>Smooth folds reaching up to the edge of the ulcer</li>\n<li>Heals completely</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Identify the muscle attached at the marked location in this posterior surface of the femur.",
    "choices": [
      {
        "id": 1,
        "text": "Obturator externus"
      },
      {
        "id": 2,
        "text": "Quadratus femoris"
      },
      {
        "id": 3,
        "text": "Gluteus medius"
      },
      {
        "id": 4,
        "text": "Gluteus minimus"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p style=\"text-align: left;\">The marked structure in this&nbsp;posterior surface of the femur&nbsp;is the&nbsp;<strong>intertrochanteric crest.</strong> The muscle attached at this location is the <strong>quadratus femoris.</strong>&nbsp;</p>\n<p style=\"text-align: left;\"><strong>Quadratus femoris muscle </strong>originates from the <strong>upper part</strong> of the external aspect of the <strong>ischial tuberosity</strong> and is inserted on a small tubercle above the middle of the&nbsp;<strong>intertrochanteric crest</strong> of the femur. It mainly causes <strong>lateral rotation </strong>at the<strong> hip joint. </strong>It is innervated by <strong>the&nbsp;nerve to quadratus femoris</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/265de806882343debb3397ecb881dedf.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/28cfc3af6cd24c1ca088a75f534c3485x1280x1188.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e1648c36181d4722a282d13a915e4defx360x437.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3831164e513a4319a15e056746730a3fx1280x2213.JPEG"
    ]
  },
  {
    "text": "A 30-year-old pregnant woman who is a chronic opioid addict for 5 years comes to the hospital for delivery. She gives a history of opioid abuse throughout the pregnancy. A day after being born, the baby develops irritability, hypertonia, seizures, and poor sucking reflex. The random blood sugar of the baby is normal. On examination, there is no icterus.  Which of the following drugs should be administered to the baby to counter the symptoms?",
    "choices": [
      {
        "id": 1,
        "text": "Naloxone"
      },
      {
        "id": 2,
        "text": "Methadone"
      },
      {
        "id": 3,
        "text": "Naltrexone"
      },
      {
        "id": 4,
        "text": "Nalmefene"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p style=\"text-align: left;\"><strong>Methadone</strong>\u00a0should be administered to the baby to counter the symptoms. The given clinical scenario is suggestive of <strong>neonatal abstinence syndrome</strong> of opioids.</p>\n<p style=\"text-align: left;\"><strong>Neonatal abstinence syndrome</strong> is a drug-withdrawal syndrome most commonly associated with <strong>in-utero exposure</strong> to <strong>maternal opioids</strong>. It is characterized by irritability, hypertonia, autonomic instability, seizures, and poor sucking reflex.</p>\n<p style=\"text-align: left;\">Methadone is a long-acting opioid agonist with pharmacological properties similar to morphine. It is substituted for <strong>opioids</strong> during <strong>detoxification</strong> to avoid withdrawal symptoms. It has been used as a replacement agent in heroin addiction. Once stabilized, the dose is gradually reduced and the drug is stopped slowly over days.\u00a0Because of its long half-life and accumulation in tissues, discontinuing the drug still results in low concentrations of the drug in plasma resulting in mild but protracted withdrawal symptoms.</p>\n<p style=\"text-align: left;\"><strong>Methadone</strong> and other opioids like morphine can be given in neonatal abstinence syndrome.</p>\n<p style=\"text-align: left;\">Other options:\u00a0</p>\n<p style=\"text-align: left;\">Option A- <strong>Naloxone</strong> is an opioid antagonist that is used in the treatment of opioid overdose. It should be avoided in opioid-dependent individuals and opioid-dependent mothers as it might lead to withdrawal syndrome.</p>\n<p style=\"text-align: left;\">Option C- <strong>Naltrexone</strong> is an opioid antagonist that is used in the treatment of opioid overdose, alcohol dependence, and in combination with bupropion in obesity.</p>\n<p style=\"text-align: left;\">Option D- <strong>Nalmefene</strong> is an opioid receptor antagonist used in the treatment of opioid overdose. It has also been approved to reduce heavy alcohol consumption.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 27-year-old photographer presented with confusion, delirium, and corrosion near the mouth. He was found with an empty bottle containing hydrocyanic acid. He is tachycardic and hypotensive. Resuscitative measures are unsuccessful, and his body is sent for postmortem analysis. What would be the color of post-mortem hypostasis in this case?",
    "choices": [
      {
        "id": 1,
        "text": "Cherry red"
      },
      {
        "id": 2,
        "text": "Brick red"
      },
      {
        "id": 3,
        "text": "Bluish-green"
      },
      {
        "id": 4,
        "text": "Chocolate brown"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p style=\"text-align: left;\"><span data-preserver-spaces=\"true\">The given clinical vignette is suggestive of <strong>h</strong></span><strong><span data-preserver-spaces=\"true\">ydrocyanic acid (HCN) </span></strong>poisoning<span data-preserver-spaces=\"true\">, and the colour of postmortem hypostasis in case of HCN poisoning is <strong>b</strong></span><strong><span data-preserver-spaces=\"true\">rick red.\u00a0</span></strong></p>\n<p style=\"text-align: left;\">HCN<span data-preserver-spaces=\"true\">\u00a0is a toxic chemical acid found in bitter almonds, peaches, apples, cherries, etc.\u00a0</span><span data-preserver-spaces=\"true\">It has the smell of bitter almonds.\u00a0</span><span data-preserver-spaces=\"true\">It is usually present in its glycoside form, amygdalin, along with certain co-enzymes like emulsion complex, these co-enzymes hydrolyze amygdalin to release HCN. HCN is a c</span><span data-preserver-spaces=\"true\">ommon chemical used in leather tanning, electroplating, metal extractions, and photographic fixing.\u00a0</span></p>\n<p style=\"text-align: left;\">Mechanism of action:\u00a0<span data-preserver-spaces=\"true\">It is a protoplasmic poison releasing cyanide ions, which <strong>inhibit</strong>\u00a0<strong>complex IV</strong> of cellular respiratory enzyme systems. It leads to histotoxic anoxia.</span></p>\n<p style=\"text-align: left;\">Postmortem findings:\u00a0</p>\n<ul>\n<li style=\"text-align: left;\">External:\u00a0<span data-preserver-spaces=\"true\">The smell of bitter almonds, <strong>b</strong></span><span data-preserver-spaces=\"true\"><strong>rick red</strong> <strong>postmortem hypostasis.\u00a0</strong></span><span data-preserver-spaces=\"true\">Rigor mortis appears early, and jaws are firmly closed.</span></li>\n<li style=\"text-align: left;\">Internal: In suspected cyanide poisoning cases, the cranial cavity should be opened first to perceive the bitter almond smell that is marked in brain tissue. Diffuse cerebral oedema such that white and gray matter cannot be differentiated, ha<span data-preserver-spaces=\"true\">emorrhages in the lungs.</span></li>\n</ul>\n<p style=\"text-align: left;\">Toxicological analysis:\u00a0<span data-preserver-spaces=\"true\">Preserve lungs to demonstrate the gas in a <strong>n</strong></span><strong><span data-preserver-spaces=\"true\">ylon bag. </span></strong><span data-preserver-spaces=\"true\">T</span>he <strong><span data-preserver-spaces=\"true\">spleen\u00a0</span></strong><span data-preserver-spaces=\"true\">is the best specimen to demonstrate cyanide poisoning.</span></p>\n<p style=\"text-align: left;\">Laboratory diagnosis i<span data-preserver-spaces=\"true\">ncludes a <strong>classical triad</strong> of</span></p>\n<ol>\n<li><span data-preserver-spaces=\"true\">Narrow arterio-venous oxygen difference,</span></li>\n<li><span data-preserver-spaces=\"true\">Anion-gap metabolic acidosis, and</span></li>\n<li><span data-preserver-spaces=\"true\">Elevated lactate concentration.</span></li>\n</ol>\n<p style=\"text-align: left;\"><span data-preserver-spaces=\"true\">HCN may be identified by gas chromatography or spectrophotometry.</span></p>\n<p style=\"text-align: left;\"><strong><span data-preserver-spaces=\"true\">Lee-Jones Test: </span></strong>This test indicates the presence of cyanide. The test can be positive for salicylates, too.</p>\n<p style=\"text-align: left;\"><span data-preserver-spaces=\"true\">Treatment<strong>:\u00a0</strong>Shift the patient to a room with fresh air and remove his clothes.\u00a0Establish proper airway, breathing, and circulation. <strong>Inhalational amyl nitrate</strong> is administered, and <strong>100% oxygen therapy </strong>is also\u00a0given.\u00a0<strong>Wash</strong> skin and eyes with large amounts of water to remove any contact poison, if any. A slow infusion of <strong>3% sodium nitrate</strong> solution, followed by a slow infusion of <strong>25% sodium thiosulfate</strong> solution, is given.</span></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 6-year-old boy who is a known case of protein C deficiency presents with a painful limp on the right side. His parents give a history of limping after he comes home after playing, 1 week back. On examination,  he is afebrile. The boy whines with pain during passive movement of the hip. The range of motion is restricted in the abduction and internal rotation. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Developmental dysplasia of hip"
      },
      {
        "id": 2,
        "text": "Slipped capital femoral epiphysis"
      },
      {
        "id": 3,
        "text": "Perthes disease"
      },
      {
        "id": 4,
        "text": "Septic arthritis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The most likely diagnosis is <strong>Perthes disease</strong>.</p>\n<p><strong>Perthes disease</strong>, also known as Legg-Calve-Perthes disease, is the avascular necrosis of the proximal femoral epiphysis. It is <strong>most commonly</strong> seen in the age group of\u00a0<strong>4-8 years</strong>. The incidence is more in boys than girls. It is usually unilateral disease but can occur bilaterally in 10% of the cases. Risk factors include low birth weight, passive smoking, family history, low socioeconomic status, and attention deficit hyperactivity disorder. Perthes disease is associated with thrombophilia,<strong> protein C </strong>and<strong> S deficiencies.</strong></p>\n<p>The disease is characterized by the disruption of blood flow to the femoral head due to which the bone goes for <strong>osteonecrosis</strong> and <strong>stops growing</strong>. The lateral epiphyseal artery, a branch of the medial circumflex femoral artery is involved. Over time, healing and fibrosis occur by new blood vessels infiltrating the dead bone and removing the necrotic bone which leads to a loss of bone mass and weakening of the femoral head.\u00a0</p>\n<p>Clinical features include<strong>\u00a0pain</strong> and <strong>limping</strong>. Pain aggravates on doing any activity and relieves by rest. Physical examination reveals pain on passive movement of the hip and\u00a0<strong>abduction with internal rotation</strong>\u00a0movement is<strong> limited</strong>.</p>\n<p>Xray findings depend on the stages\u00a0</p>\n<ul>\n<li><strong>Initial phase</strong>: Medial joint space widening and increased density in the ossific nucleus</li>\n<li><strong>Fragmentation phase</strong>: Alternating patches of sclerosis and fibrosis</li>\n<li><strong>Re-ossification phase</strong>: Complete removal of necrotic bone. Epiphyseal density is regained in this phase</li>\n<li><strong>Remodelling phase</strong>: Remodelling occurs until skeletal maturity is attained</li>\n</ul>\n<p>The below radiograph shows features of bone necrosis followed by remodelling in Perthes disease.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7abac8ef9c63430eac8bc81ab98408d2x720x513.PNG"
    ]
  },
  {
    "text": "A 58-year-old woman presents to the clinic with a history of intermittent blood in stools and altered bowel habits for the past 3 months. After a detailed evaluation, she is diagnosed with rectal adenocarcinoma which is located at the distal third of the rectum and anal sphincters. There is no nodal or distant metastasis. What is the preferred management for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "High anterior resection"
      },
      {
        "id": 2,
        "text": "Hartmann's operation"
      },
      {
        "id": 3,
        "text": "APR with permanent colostomy"
      },
      {
        "id": 4,
        "text": "Endoluminal stent"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p style=\"text-align: justify;\"><strong>Abdominoperineal resection </strong>with<strong> permanent colostomy</strong> is preferred for this patient.&nbsp;</p>\n<p style=\"text-align: justify;\">Abdominoperineal resection is the <strong>complete excision</strong> of the entire rectum, anal canal, and anus with the construction of a permanent colostomy from the descending or sigmoid colon.</p>\n<p>Abdominoperineal resection is recommended for patients with operable <strong>low rectal carcinomas</strong> who satisfy the following conditions:</p>\n<ul>\n<li>The tumor is located <strong>within 5cm</strong> of the <strong>anal verge</strong>.</li>\n<li>Obtaining a <strong>negative distal margin</strong> (with a clearance of 5 cm proximally and 2 cm distally) is not feasible.</li>\n<li>There is involvement or invasion of nearby structures, such as the <strong>external sphincter</strong>.</li>\n</ul>\n<p style=\"text-align: justify;\">The most common immediate complication of APR is an intraabdominal or <strong>pelvic abscess.&nbsp;</strong>During pelvic dissection, there are many sites at which&nbsp;<strong>autonomic nerves</strong> that affect both <strong>sexual</strong> and <strong>urinary function</strong> may be injured.&nbsp;Dissection at the sacral promontory may injure the <strong>hypogastric nerves</strong> (sympathetic) if care is not taken to isolate them. Although <strong>urinary retention</strong> should be expected in the postoperative period, disruption to the bladder's autonomic supply may result in<strong> bladder dystonia</strong>, which may resolve over months or be permanent. In men, sexual dysfunction manifests as an inability to achieve an erection, a half erection, or retrograde ejaculation.&nbsp;</p>\n<p style=\"text-align: justify;\">Other options:</p>\n<p style=\"text-align: justify;\">Option A:&nbsp;A <strong>high anterior resection</strong> refers to the surgical removal of the <strong>distal sigmoid</strong> colon and <strong>upper rectum</strong>. This procedure is commonly performed to treat <strong>benign conditions</strong> and diseases located at the rectosigmoid junction, such as <strong>diverticulitis.</strong></p>\n<p style=\"text-align: justify;\">Option B:&nbsp;<strong>Hartman's operation</strong> is indicated in <strong>elderly</strong> and <strong>frail patients</strong> who have <strong>poor anal sphincter function</strong> or postoperative incontinence. In this surgery, colorectal excision is done along with the closure of the rectal stump and permanent proximal colostomy.</p>\n<p style=\"text-align: justify;\">Option D:&nbsp;<strong>Endoluminal stent</strong> is indicated in patients with <strong>obstructive rectal carcinoma</strong> and also as a palliative procedure. Only <strong>rectosigmoid</strong> and <strong>upper rectal tumors</strong> are suitable for stenting because, in low cancers, stent impingement results in tenesmus.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A multigravida who is a known case of diabetes delivers a newborn of weight 4.5 kg as shown in the image below. Which of the following complications can be seen in the neonate?",
    "choices": [
      {
        "id": 1,
        "text": "Small left colon syndrome"
      },
      {
        "id": 2,
        "text": "Hypermagnesemia"
      },
      {
        "id": 3,
        "text": "Hyperglycemia"
      },
      {
        "id": 4,
        "text": "Umbilical hernia"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p style=\"text-align: left;\"><strong>Small left colon syndrome</strong> is one of the complications which can be seen in this neonate.&nbsp;</p>\n<p style=\"text-align: left;\">The birth weight of 4.5 kg and the image provided indicates that the baby is&nbsp;<strong>macrosomia</strong> (large for gestational age).</p>\n<p style=\"text-align: left;\">In pregestational diabetes and gestational diabetes mellitus, maternal hyperglycemia causes a higher amount of blood glucose to pass through the placenta into the fetal circulation. It results in fetal hyperglycemia leading to fetal hyperinsulinism. As a result, extra glucose in the fetus is stored as body fat causing macrosomia. These newborns are at risk of developing various complications due to fetal hyperglycemia. They are:</p>\n<ul style=\"text-align: left;\">\n<li>Gastrointestinal: These infants may demonstrate abdominal distention caused by a transient delay in the development of the left side of the colon due to fluctuations in maternal and fetal glucose resulting in&nbsp;<strong>small left colon syndrome.</strong></li>\n<li>Metabolic: <strong>Hypoglycemia</strong>, hypocalcemia, <strong>hypomagnesemia</strong></li>\n<li>Neural: Neural tube defects like&nbsp;<strong>caudal regression syndrome</strong>, encephalocele, anencephaly&nbsp;<strong><br /></strong></li>\n<li>Respiratory: <strong>Respiratory distress syndrome</strong>,<strong>&nbsp;</strong>transient tachypnea of newborn, persistent pulmonary hypertension</li>\n<li>Cardiac: Cardiomegaly, cardiac malformations like a&nbsp;<strong>ventricular </strong>or <strong>atrial septal defect</strong>,<strong> transposition of the great vessels</strong>, truncus arteriosus, double-outlet right ventricle, tricuspid atresia, coarctation of the aorta</li>\n<li>Hematological: <strong>Polycythemia</strong>, renal vein thrombosis</li>\n<li>Others: Hyperbilirubinemia, insulin resistance, diabetes, sudden intrauterine death</li>\n</ul>\n<p style=\"text-align: left;\">Other options:</p>\n<p style=\"text-align: left;\">Option B- <strong>Hypermagnesemia</strong> is not seen in infants of diabetic mothers. Hypomagnesemia is seen due to the perinatal asphyxia.</p>\n<p style=\"text-align: left;\">Option C- <strong>Hyperglycemia</strong> is seen in the fetus and not in the neonate. Neonates present with hypoglycemia due to increased insulin.</p>\n<p style=\"text-align: left;\">Option D- <strong>Umbilical hernia</strong> is seen in congenital hypothyroidism.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/78cdf0c04b7f47bfba81275c781d4d5b.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 16-year-old woman was brought by her parents with sudden onset of blindness in both eyes. On examination, fundoscopy and cortical-evoked potentials were normal. On further probing the history, there were frequent fights between her parents, and the onset of blindness corresponded to one of their fights. Which of the following statements is incorrect regarding this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Receiving support from others constitutes secondary gain"
      },
      {
        "id": 2,
        "text": "It is caused due to repression of conflicts in the unconscious mind"
      },
      {
        "id": 3,
        "text": "Patient is unconcerned about severe symptoms"
      },
      {
        "id": 4,
        "text": "Organic neurological condition is present"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The above scenario is suggestive of <strong>conversion disorder</strong>. There is <strong>no organic neurological lesion</strong> present in such patients. The <strong>symptoms</strong> displayed <strong>cannot be explained by</strong> any <strong>neurological disease</strong>.</p>\n<p><strong>Conversion disorder</strong> is an&nbsp;<strong>acute and</strong> <strong>temporary</strong>&nbsp;<strong>loss or alteration in&nbsp;motor or sensory function</strong> triggered by <strong>psychosocial conflict</strong>.<strong>&nbsp;</strong>The patients tend to keep the <strong>psychological impact of the stressors in life repressed in their unconscious mind</strong> (option B). This <strong>stress is converted into physical symptoms</strong> such as non-epileptic seizures, paralysis, or blindness.</p>\n<p>The patient's symptoms <strong>do not fit into the diagnosis of any neurological disorder</strong> and they cannot be explained by any neurological lesion&nbsp;&mdash; this is known as <strong>astasia abasia</strong>. The patients are <strong>unconcerned about even severe symptoms</strong> such as blindness (option C) &mdash; this is known as <strong>la belle indifference</strong>.</p>\n<p>Patients achieve <strong>primary gain</strong> by keeping <strong>internal conflicts outside their awareness</strong> and then <strong>releasing them as physical symptoms</strong>. When the patients get<strong>&nbsp;advantages</strong> due to their symptoms, such as <strong>attention and care from the family</strong>, it is known as <strong>secondary gain&nbsp;</strong>(option A).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A carpenter presented with irritation and blurring of vision in both his eyes for 1 week. He gives a history of a wood chip penetrating into his right eye 3 weeks back. On evaluation, the visual acuity of the left eye was 6/12, while that of the right eye was light perception. Fundoscopic examination revealed Dalen-Fuchs nodules. Which of the following is the best step in the management of this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Enucleation of left eye"
      },
      {
        "id": 2,
        "text": "Enucleation of right eye"
      },
      {
        "id": 3,
        "text": "Spontaneous resolution"
      },
      {
        "id": 4,
        "text": "Oral cyclosporine"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p style=\"text-align: left;\">The given clinical scenario is suggestive of <strong>sympathetic ophthalmitis. </strong>The best step in the management of this patient is the&nbsp;<strong>e</strong><strong>nucleation</strong> of the <strong>right eye</strong>.</p>\n<p><strong><span class=\"notion-enable-hover\" data-token-index=\"0\" data-reactroot=\"\">Sympathetic ophthalmitis </span></strong>is a&nbsp;<strong>bilateral</strong> <strong><span class=\"notion-enable-hover\" data-token-index=\"2\" data-reactroot=\"\">granulomatous panuveitis </span></strong>that usually occurs after&nbsp;<span class=\"notion-enable-hover\" data-token-index=\"4\" data-reactroot=\"\"><strong>penetrative trauma</strong>. It can also develop after intraocular surgery.</span>&nbsp;Both the injured eye (<strong>exciting eye</strong>) and fellow eye (<strong>sympathizing eye</strong>) develop panuveitis. Trauma to the ciliary region (dangerous zone) poses an increased risk.</p>\n<p>It is a <strong>type 4 hypersensitivity</strong> reaction. According to the allergic theory, the uveal pigment in the injured eye acts as an <strong>allergen</strong> that causes uveitis in the other eye. <strong>Dalen-Fuchs nodules</strong> (proliferation of pigment epithelium), exudative retinal detachment, and optic disc swelling can be seen on fundoscopy.&nbsp;A <strong>sunset glow</strong> appearance can persist due to residual chorioretinal scarring.</p>\n<p><strong>Dalen-Fuchs nodules</strong> are granulomas located between the Bruch membrane and retinal pigmented epithelium; they are seen in <strong>Vogt-Koyanagi-Harada syndrome</strong> and <strong>sympathetic ophthalmitis.</strong></p>\n<p>Dalen-Fuchs nodules are shown in the image below.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c8f55a968e664e26ab4d8ba46330ef51x512x445.PNG"
    ]
  },
  {
    "text": "A 38-year-old man presents with complaints of diarrhea and abdominal pain. He states that he has been having 4-5 non-bloody, loose stools per day for the last 3 months. He denies any family history of colon cancer. A biopsy of the small bowel showed findings as seen in the image below. Which of the following is the most commonly associated cancer?",
    "choices": [
      {
        "id": 1,
        "text": "B cell lymphoma"
      },
      {
        "id": 2,
        "text": "Carcinoid"
      },
      {
        "id": 3,
        "text": "T cell lymphoma"
      },
      {
        "id": 4,
        "text": "Colon cancer"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p style=\"text-align: justify;\">The clinical vignette, along with the biopsy image showing&nbsp;villous atrophy, crypt hyperplasia, and lamina propria infiltrates, indicates a case of <strong>celiac disease</strong>. The most common celiac disease-associated cancer is <strong>enteropathy-associated T-cell lymphoma</strong>. <strong>Small</strong> <strong>intestinal adenocarcinoma</strong> is also more frequent in individuals with celiac disease.</p>\n<p style=\"text-align: justify;\"><strong>Celiac disease/celiac sprue/gluten-sensitive enteropathy:</strong></p>\n<p style=\"text-align: justify;\">Celiac disease is an&nbsp;<strong>autoimmune gluten-induced enteropathy.&nbsp;</strong>It is associated with&nbsp;<strong>HLA DQ2</strong> and <strong>DQ8</strong>.&nbsp;The pathogenesis of celiac disease involves an inflammatory response to gluten and gliadin (gluten-derived peptide). The gliadin peptide activates the epithelial cells to express IL-15, which in turn triggers activation and proliferation of CD8+ intraepithelial lymphocytes. This damages the epithelium and increases the passage of gliadin into the lamina propria, where&nbsp;gliadin is deamidated by the tissue transglutaminase (tTG), an intestinal enzyme. The deamidated gliadin is more immunogenic and is&nbsp;presented to helper T cells which mediate mucosal inflammation and worsen tissue damage.</p>\n<p style=\"text-align: justify;\">Microscopic findings on biopsy of the proximal small intestine will show&nbsp;<strong>villi atrophy</strong>,&nbsp;<strong>villi flattening</strong>,&nbsp;<strong>crypt hyperplasia</strong>, and&nbsp;<strong>increased intraepithelial T lymphocytes</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d86d32908264414cb4e7153fde49e6ac.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1e278a4b0423469ea1cfc0732172048ex1280x1176.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/91553a503c9941feae1da37a94b3b763x720x472.JPEG"
    ]
  },
  {
    "text": "A 40-year-year old woman presented with vegetations as shown in the image. On histopathology, a suprabasal cleft with acantholysis is seen. On immunofluorescence, intraepidermal intercellular IgG and C3 deposits are seen. Which of the following histopathological finding can be seen with this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Papillary tip neutrophilic microabscess"
      },
      {
        "id": 2,
        "text": "Spongiform pustules of Kogoj"
      },
      {
        "id": 3,
        "text": "Munro's microabscess"
      },
      {
        "id": 4,
        "text": "Intraepidermal eosinophilic microabscess"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p style=\"text-align: justify;\">The given clinical scenario is suggestive of <strong>pemphigus vegetans</strong> because of the development of vegetations in the flexural areas, intraepidermal cleft and intercellular IgG and C3 deposits<strong>. Intraepidermal eosinophilic microabscess\u00a0</strong>is the histopathological finding seen in this condition.\u00a0</p>\n<p style=\"text-align: justify;\">Pemphigus vegetans is a rare variant of pemphigus vulgaris. It is characterized by vegetating erosions primarily in the flexures. It has circulating antibodies primarily against <strong>desmoglein 3</strong>, as in pemphigus vulgaris and in some cases against <strong>desmocollin</strong>. It has 2 subtypes namely\u00a0<strong>Neumann type </strong>which is severe and\u00a0<strong>Hallopeau type </strong>which is mild.</p>\n<p style=\"text-align: justify;\">It is seen more commonly in<strong> middle-aged adults</strong>. The vegetating lesions are primarily in flexural areas which are hyperkeratotic, papillomatous and acanthotic.</p>\n<p style=\"text-align: justify;\">On histopathology, the findings include hyperkeratosis, papillomatosis, acantholysis with a <strong>suprabasal cleft</strong>, eosinophilic spongiosis, <strong>intraepidermal</strong> <strong>eosinophilic microabscess</strong> and eosinophilic dermal infiltrate. Direct immunofluorescence is similar to pemphigus vulgaris that show intraepidermal intercellular deposition of IgG and C3.</p>\n<p style=\"text-align: justify;\">The below image shows the <strong>fishnet pattern</strong> of pemphigus vegetans on direct immunofluorescence similar to pemphigus vulgaris.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/22c2d6916318472c83cae158a9890a04.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/fc61fd514b24476eaac17357ea174642x600x450.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1f81e253a42d49d1972ee8be00670d78x1280x1907.JPEG"
    ]
  }
];
        let quizName = 'Mini Test 16';
        const quizFilename = 'mini-test-16-a3737978.html';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2021-22"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>