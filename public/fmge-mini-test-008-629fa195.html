<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fmge Mini Test - 008 - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / FMGE Mini Test Series / 2023
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">30</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A woman has mild depressive symptoms after few days of delivery which disappears within 2 weeks of the postpartum period. The most likely cause is ______",
    "choices": [
      {
        "id": 1,
        "text": "Post-partum blues"
      },
      {
        "id": 2,
        "text": "Mania"
      },
      {
        "id": 3,
        "text": "Post-partum psychosis"
      },
      {
        "id": 4,
        "text": "Major depression"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The patient has mild depressive symptoms after a few days of delivery which resolved spontaneously; this is characteristic of <strong>postpartum blues</strong>.</p>\n<p class=\"p1\">During this period the patient may experience mood lability, sadness, dysphoria, subjective confusion, and tearfulness.</p>\n<p class=\"p1\">These feelings have been ascribed to rapid changes in women's hormonal levels, the stress of childbirth, and the awareness of the increased responsibility that motherhood brings. This usually resolve spontaneously.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Where are owl's eye inclusion bodies seen?",
    "choices": [
      {
        "id": 1,
        "text": "Yellow fever"
      },
      {
        "id": 2,
        "text": "Cytomegalovirus"
      },
      {
        "id": 3,
        "text": "Adenovirus"
      },
      {
        "id": 4,
        "text": "Herpes simplex virus"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Owl&rsquo;s eye inclusion bodies</strong> are intranuclear basophilic inclusion bodies seen in <strong>CMV</strong> infection.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b7f8eca580cf425b8dde6c1454b276b4x510x480.GIF"
    ]
  },
  {
    "text": "A woman is admitted to the hospital for the management of breast cancer. The tumor is 3 cm in size with ipsilateral mobile axillary lymph nodes. There is no distant metastasis. The TNM staging of the tumor is:",
    "choices": [
      {
        "id": 1,
        "text": "T2 N1 M0"
      },
      {
        "id": 2,
        "text": "T1 N1 M0"
      },
      {
        "id": 3,
        "text": "T3 N2 M0"
      },
      {
        "id": 4,
        "text": "T2 N2 M0"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The TNM staging of the tumor is <strong>T2 N1 M0</strong>.</p>\n<ul>\n<li>Tumor size 3 cm:\u00a0<strong>T2\u00a0</strong></li>\n<li>Ipsilateral mobile axillary lymph nodes:\u00a0<strong>N1</strong></li>\n<li>No distant metastasis: <strong>M0</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An HIV-positive individual presents with the following. What is the diagnosis &  WHO clinical stage of HIV?",
    "choices": [
      {
        "id": 1,
        "text": "Oral candidiasis  &  WHO Stage 2"
      },
      {
        "id": 2,
        "text": "Oral hairy leukoplakia &  WHO Stage 3"
      },
      {
        "id": 3,
        "text": "Oral candidiasis & WHO Stage 3"
      },
      {
        "id": 4,
        "text": "Oral hairy leukoplakia & WHO Stage 2"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Oral candidiasis (Thrush) is characterized in WHO Clinical Stage 3.</p>\n<p>Oral Candidiasis (Thrush)<em>,</em> and oral hairy leukoplakia, are oral lesions characterized in WHO clinical Stage 3. They generally occur in patients with <strong>CD4+ T cell counts of &lt;300/&mu;L.</strong></p>\n<p>Differentiating oral candidiasis and oral hairy leukoplakia:</p>\n<ul>\n<li>Oral Candidiasis (Thrush) appears as a white, cheesy exudate, on an erythematous mucosa in the posterior oropharynx. The diagnosis is made by direct examination of pseudohyphal elements.</li>\n<li>Oral hairy leukoplakia presents as white, frondlike lesions, generally along the lateral borders of the tongue and sometimes on the adjacent buccal mucosa(image below). Despite its name, oral hairy leukoplakia is not considered premalignant. Lesions are associated with Ebstein barr virus (EBV).</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3218e6686d724ac683c80ec8cb1dacb8.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5b06d82b3c58482f954c73818461a3afx720x405.JPEG"
    ]
  },
  {
    "text": "Severe degree of anemia in pregnancy is defined as Hb ______",
    "choices": [
      {
        "id": 1,
        "text": "<10 g/dl"
      },
      {
        "id": 2,
        "text": "<8 g/dl"
      },
      {
        "id": 3,
        "text": "<7 g/dl"
      },
      {
        "id": 4,
        "text": "<6 g/dl"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Severe Anemia is classified as <strong>Hb &lt; 7 g/dL.<u></u></strong></p>\n<p><strong>ICMR classification of anemia in pregnancy :</strong></p>\n<table style=\"width: 241px;\">\n<tbody>\n<tr>\n<td style=\"width: 147.51px;\">\n<p>Mild anemia</p>\n</td>\n<td style=\"width: 79.4896px;\">\n<p>10&ndash;10.9 g%</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 147.51px;\">\n<p>Moderate anemia</p>\n</td>\n<td style=\"width: 79.4896px;\">\n<p>7&ndash;9.9 g%</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 147.51px;\">\n<p>Severe anemia</p>\n</td>\n<td style=\"width: 79.4896px;\">\n<p>&lt; 7 g%</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 147.51px;\">\n<p>Very severe anemia</p>\n</td>\n<td style=\"width: 79.4896px;\">\n<p>&lt; 4 g%</p>\n</td>\n</tr>\n</tbody>\n</table>\n<p><strong>WHO definition of Anemia:</strong></p>\n<table style=\"width: 620px;\">\n<tbody>\n<tr>\n<td style=\"width: 170px;\"><strong>Pregnancy State</strong></td>\n<td style=\"width: 115px;\"><strong>Normal&nbsp;(g/dL)</strong></td>\n<td style=\"width: 102px;\"><strong>Mild (g/dL)</strong></td>\n<td style=\"width: 123.906px;\"><strong>Moderate (g/dL)</strong></td>\n<td style=\"width: 74.0938px;\"><strong>Severe (g/dL)</strong></td>\n</tr>\n<tr>\n<td style=\"width: 170px;\"><strong>First Trimester</strong></td>\n<td style=\"width: 115px;\"><strong>11</strong> or higher</td>\n<td style=\"width: 102px;\">10-10.9</td>\n<td style=\"width: 123.906px;\">7-9.9</td>\n<td style=\"width: 74.0938px;\"><strong>&lt;7</strong></td>\n</tr>\n<tr>\n<td style=\"width: 170px;\"><strong>Second Trimester</strong></td>\n<td style=\"width: 115px;\"><strong>10.5</strong> or higher</td>\n</tr>\n<tr>\n<td style=\"width: 170px;\"><strong>Third trimester</strong></td>\n<td style=\"width: 115px;\"><strong>11</strong> or higher</td>\n<td style=\"width: 102px;\">10-10.9</td>\n<td style=\"width: 123.906px;\">7-9.9</td>\n<td style=\"width: 74.0938px;\"><strong>&lt;7</strong></td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Staging laparotomy was performed in a woman who presented with an adnexal mass. On histopathological examination, you see the below finding. This finding is associated with?",
    "choices": [
      {
        "id": 1,
        "text": "Mucinous cystadenoma"
      },
      {
        "id": 2,
        "text": "Krukenberg tumor"
      },
      {
        "id": 3,
        "text": "Endodermal sinus tumor"
      },
      {
        "id": 4,
        "text": "Dysgerminoma"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The image shows the characteristic <strong>Schiller Duval's body</strong>. It is seen in the&nbsp;<strong>endodermal sinus tumor (yolk sac tumor).</strong></p>\n<p>It is usually unilateral and highly malignant. Histological features reveals cystic spaces lined by flattened epithelium.<strong> Vascular tufts are seen within the space - Schiller Duval body</strong>. These tumors are usually associated with <strong>raised AFP and alpha 1 antitrypsin</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/debe2b71f84c47408f8e0f838eb851c3.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "All the following are true about subconjunctival hemorrhage except ______.",
    "choices": [
      {
        "id": 1,
        "text": "The condition is mostly trivial."
      },
      {
        "id": 2,
        "text": "It can occur spontaneously in elder people with systolic hypertension."
      },
      {
        "id": 3,
        "text": "The blood gets absorbed gradually in 6-8 weeks time without treatment."
      },
      {
        "id": 4,
        "text": "Use of NSAIDs and aspirin to treat the condition should be avoided."
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The blood gets absorbed gradually in <strong>1-3 weeks time</strong> without treatment,<strong> not 6-8 weeks</strong>.</p>\n<p><strong>Subconjunctival hemorrhage</strong></p>\n<ul>\n<li>It is also called as <strong>subconjunctival ecchymosis.</strong></li>\n<li>It is due to the rupture of small blood vessels.</li>\n<li>It can occur spontaneously in elder people with systolic hypertension or after local trauma.</li>\n<li>If the&nbsp;posterior limit is not seen, check for the&nbsp;<strong>base of skull fracture.</strong>&nbsp;</li>\n<li><strong>Recurrent episodes</strong> warrant investigations for a <strong>bleeding diathesis or leukemia.</strong>&nbsp;The differential diagnosis includes <strong>Kaposi sarcoma.</strong></li>\n<li>Blood gradually changes color and <strong>resolves in 1-3 weeks time.</strong></li>\n<li>The use of<strong> NSAIDs and aspirin</strong> to treat the condition <strong>should be avoided.</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d8d81a68fae64b50ac1cf31c7677d411x571x368.PNG"
    ]
  },
  {
    "text": "Which of the following pathway is the most important source of reducing equivalents for fatty acid synthesis in the liver?",
    "choices": [
      {
        "id": 1,
        "text": "Glycolysis"
      },
      {
        "id": 2,
        "text": "Tricarboxylic acid cycle"
      },
      {
        "id": 3,
        "text": "Uronic acid pathway"
      },
      {
        "id": 4,
        "text": "Hexose monophosphate shunt pathway"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The <strong>most important</strong> source of <strong>reducing equivalents (NADPH)</strong> for fatty acid synthesis in the liver is the <strong>hexose monophosphate shunt pathway (HMP).</strong></p>\n<p>Since <strong>HMP</strong> <strong>shunt pathway</strong> and <strong>fatty acid synthesis</strong> both occur in the <strong>cytosol</strong> of the cell, there are no membranes or permeability barriers against the transfer of NADPH. This NADPH is involved as a donor of reducing equivalents in both the reduction of the 3-ketoacyl and of the 2,3-unsaturated acyl derivatives.&nbsp;</p>\n<p>Other sources are:</p>\n<ul>\n<li>Extramitochondrial isocitrate dehydrogenase (minor source)</li>\n<li>Malic enzyme</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is the most common type of Guillian-Barre syndrome (GBS)?",
    "choices": [
      {
        "id": 1,
        "text": "Acute motor axonal neuropathy (AMAN)"
      },
      {
        "id": 2,
        "text": "Acute inflammatory demyelinating polyneuropathy (AIDP)"
      },
      {
        "id": 3,
        "text": "Acute motor sensory axonal neuropathy (AMSAN)"
      },
      {
        "id": 4,
        "text": "Miller Fisher syndrome (MFS)"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Acute inflammatory demyelinating</strong> <strong>polyneuropathy (AIDP)</strong> is the most common type of GBS.</p>\n<p>There are several <strong>types of Guillain&ndash;Barre syndrome,</strong> which are recognized by electrodiagnostic studies and pathological distinctions. These include:</p>\n<p>A. Demyelinating</p>\n<ul>\n<li>Acute inflammatory demyelinating polyneuropathy (AIDP) [Most common]</li>\n</ul>\n<p>B. Axonal</p>\n<ul>\n<li>Acute motor axonal neuropathy (AMAN)</li>\n<li>Acute motor&ndash;sensory axonal neuropathy (AMSAN)</li>\n</ul>\n<p>C. Regional GBS syndromes</p>\n<ul>\n<li>Miller&ndash;Fisher syndrome (MFS)</li>\n<li>Pure sensory forms</li>\n<li>Ophthalmoplegia with anti-GQ1b antibodies as part of severe motor-sensory GBS</li>\n<li>GBS with severe bulbar and facial paralysis</li>\n<li>Acute pandysautonomia</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "All of the following structures pass through both greater and lesser sciatic foramen except _______",
    "choices": [
      {
        "id": 1,
        "text": "Pudendal nerve"
      },
      {
        "id": 2,
        "text": "Tendon of obturator internus"
      },
      {
        "id": 3,
        "text": "Nerve to obturator internus"
      },
      {
        "id": 4,
        "text": "Internal pudendal vessels"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>The Tendon of the obturator internus</strong> muscle passes only through the lesser sciatic foramen.</p>\n<p>Structures passing through <strong>both</strong> the <strong>greater and lesser sciatic foramen:</strong></p>\n<ul>\n<li>Pudendal nerve</li>\n<li>Nerve to obturator internus</li>\n<li>Internal pudendal vessels</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following  acts as the primary trigger for onset of labour in pregnant women?",
    "choices": [
      {
        "id": 1,
        "text": "ACTH in mother"
      },
      {
        "id": 2,
        "text": "ACTH in fetus"
      },
      {
        "id": 3,
        "text": "Prostaglandin"
      },
      {
        "id": 4,
        "text": "Oxytocin"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>fetal&nbsp;ACTH</strong> causes an increase in <strong>estrogen</strong> acting as the onset of labour in pregnant women. It results in the growth of the fetal adrenal gland which has the capacity for steroid biosynthesis i.e. estrogen.</p>\n<p>Daily steroid production of fetal adrenal glands near term is more than in adults.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/bea7441b630742b88b63d7f1c2d44cccx1280x1317.JPEG"
    ]
  },
  {
    "text": "A 2 year old boy presenting with diarrhoea is irritable and drinks fluids eagerly when given. According to IMNCI, which of the following is the best suited treatment plan ?",
    "choices": [
      {
        "id": 1,
        "text": "Plan A"
      },
      {
        "id": 2,
        "text": "Plan B"
      },
      {
        "id": 3,
        "text": "Plan C"
      },
      {
        "id": 4,
        "text": "Plan D"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The clinical signs and symptoms of the above child signifies <strong>some dehydration.</strong> According to IMNCI, children with some dehydration or moderate dehydration should be treated with <strong>Plan B.&nbsp;</strong></p>\n<p>In Plan B, fluid requirement (given orally) is calculated as :</p>\n<ul>\n<li>Daily fluid requirement : Holliday Segar method\n<table style=\"width: 190px;\">\n<tbody>\n<tr>\n<td style=\"width: 83px;\">Weight</td>\n<td style=\"width: 91px;\">Quantity of fluids</td>\n</tr>\n<tr>\n<td style=\"width: 83px;\">Upto 10 kg&nbsp;</td>\n<td style=\"width: 91px;\">100 ml/kg</td>\n</tr>\n<tr>\n<td style=\"width: 83px;\">10-20 kg</td>\n<td style=\"width: 91px;\">1000 ml + 50ml/kg for every kg above 10 kg</td>\n</tr>\n<tr>\n<td style=\"width: 83px;\">&gt;20 kg</td>\n<td style=\"width: 91px;\">1500 ml + 20ml/kg for every kg above 20 kg</td>\n</tr>\n</tbody>\n</table>\n&nbsp;</li>\n<li>Deficit replacement or rehydration therapy - 75ml/kg of ORS over 4 hours</li>\n<li>Maintenance therapy - Replace every stool with 10ml/kg of ORS after signs of dehydration disappear</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A salivary gland tumor with a propensity for perineural invasion is _______.",
    "choices": [
      {
        "id": 1,
        "text": "Pleomorphic adenoma"
      },
      {
        "id": 2,
        "text": "Mucoepidermoid carcinoma"
      },
      {
        "id": 3,
        "text": "Adenoid cystic carcinoma"
      },
      {
        "id": 4,
        "text": "Acinic cell carcinoma"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>A salivary gland tumour with a propensity for perineural invasion is <strong>adenoid cystic carcinoma.</strong></p>\n<p>Adenoid cystic carcinoma is a slow-growing<strong> malignant</strong> tumour of major and minor salivary glands. It is composed of both<strong> epithelial</strong> and <strong>myoepithelial</strong> cells.&nbsp;It is the <strong>second most common</strong> malignant tumour of the parotid gland. The histologic types of adenoid cystic carcinoma are tubular, cribriform, and solid. The <strong>tubular type </strong>has the<strong> best prognosis</strong>, while the&nbsp;<strong>solid type </strong>has the <strong>worst</strong>.&nbsp;</p>\n<p>Adenoid cystic carcinoma has propensity for <strong>perineural invasion</strong>. P<span style=\"font-size: 14px;\">atients will present with slow-growing <strong>masses</strong>, with the presence of<strong> numbness, paraesthesia </strong>or<strong> pain.&nbsp;</strong></span>Treatment is the <strong>removal of the gross tumor</strong>,<strong>&nbsp;</strong>with radiation therapy for the microscopic disease.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Investigation of choice in evaluation of posterior urethral valve ______",
    "choices": [
      {
        "id": 1,
        "text": "MCU"
      },
      {
        "id": 2,
        "text": "Tc DTPA scan"
      },
      {
        "id": 3,
        "text": "USG"
      },
      {
        "id": 4,
        "text": "MRI"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<ul>\n<li><strong>Voiding cystourethrogram (VCUG)/MCU</strong> is the best imaging technique for the diagnosis of posterior urethral valves. The diagnosis is best made during the <strong>micturition phase in lateral or oblique views</strong>, such that the posterior urethra can be imaged adequately.</li>\n<li>Findings include:\n<ul>\n<li>Dilatation and elongation of the posterior urethra (the equivalent of the ultrasonographic keyhole sign)</li>\n<li>The linear radiolucent band corresponding to the valve (only occasionally seen)</li>\n<li>Vesicoureteral reflux (VUR): Seen in 50% of patients</li>\n<li>Bladder trabeculation/ diverticula</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://cdn1.dailyrounds.org/uploads/e5756785d70e4173bcd157014fe517eax720x720.PNG"
    ]
  },
  {
    "text": "A 6-year-old boy was asked to blow-off a paper repeatedly while doing an EEG. The recording shows symmetric, 3-Hz spike-and-slow-wave discharges that begins and ends suddenly, superimposed on a normal EEG background. What is the diagnosis of this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Generalized tonic clonic seizures"
      },
      {
        "id": 2,
        "text": "Atonic seizures"
      },
      {
        "id": 3,
        "text": "Absence seizures"
      },
      {
        "id": 4,
        "text": "Myoclonic seizures"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given scenario of a child with a <strong>3Hz spike and wave pattern on EEG,</strong> which was provoked by <strong>hyperventilation,</strong> suggests a diagnosis of <strong>absence seizures.</strong></p>\n<p>Absence seizures are the most common seizures in children. The electrophysiologic hallmark of typical absence seizures is a <strong>generalized, symmetric, 3-Hz spike-and-slow-wave discharge pattern</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f4f9d94975bf4ce4a23003621c0ae92cx1280x1190.JPEG"
    ]
  },
  {
    "text": "Which is the study design of choice to identify the prevalence of a disease?",
    "choices": [
      {
        "id": 1,
        "text": "Cross sectional"
      },
      {
        "id": 2,
        "text": "Ambispective Cohort"
      },
      {
        "id": 3,
        "text": "Case control"
      },
      {
        "id": 4,
        "text": "Prospective Cohort"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<div><span class=\" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qoxwyy7z90zx1z73zz86z8z72z3z70zvjbz81zz122znz90zz74z1z78zz67zz66zz122zz83zjz73ziz69z\"><strong>Cross-sectional study</strong> is done to identify the <strong>prevalence</strong> of a disease.</span></div>\n<div>\n<div class=\"panel-body ng-scope\">\n<p>Prevalence is the proportion of all cases,\u00a0<strong>old and new</strong>, of a particular disease at a given point in time or over a period of time in a given population. It is a\u00a0<strong>proportion,</strong>\u00a0not a rate or ratio.\u00a0Prevalence is always expressed in\u00a0<strong>percentage.</strong></p>\n<p>It is given by the formula:</p>\n</div>\n<div class=\"panel-body ng-scope\">\n<div class=\"ng-scope\"><label class=\"ng-binding\"></label>\u00a0<img src=\"https://dhmbxeygs57ff.cloudfront.net/uploads/6746ce2989d64d339e4454605f41cde0x520x80.JPEG\" /></div>\n</div>\n<div class=\"panel-body ng-scope\">\n<p>It is useful to determine the\u00a0<strong>magnitude\u00a0</strong>of health problems.\u00a0It can be determined from\u00a0<strong>cross-sectional studies.</strong></p>\n</div>\n</div>\n<div><span class=\"ace-all-bold-hthree\"><span class=\" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qoxwyy7z90zx1z73zz86z8z72z3z70zvjbz81zz122znz90zz74z1z78zz67zz66zz122zz83zjz73ziz69z\"><strong>Other options:</strong></span></span></div>\n<div><span class=\" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qoxwyy7z90zx1z73zz86z8z72z3z70zvjbz81zz122znz90zz74z1z78zz67zz66zz122zz83zjz73ziz69z\"><strong>Option B:\u00a0</strong></span><span class=\" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qoxwyy7z90zx1z73zz86z8z72z3z70zvjbz81zz122znz90zz74z1z78zz67zz66zz122zz83zjz73ziz69z\">An </span><span class=\" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qoxwyy7z90zx1z73zz86z8z72z3z70zvjbz81zz122znz90zz74z1z78zz67zz66zz122zz83zjz73ziz69z\"><strong>ambispective\u00a0</strong></span><span class=\" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qoxwyy7z90zx1z73zz86z8z72z3z70zvjbz81zz122znz90zz74z1z78zz67zz66zz122zz83zjz73ziz69z\"><strong>cohort\u00a0</strong></span><span class=\" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qoxwyy7z90zx1z73zz86z8z72z3z70zvjbz81zz122znz90zz74z1z78zz67zz66zz122zz83zjz73ziz69z\">is the combination of both retrospective and prospective cohort studies.</span></div>\n<div><span class=\" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qoxwyy7z90zx1z73zz86z8z72z3z70zvjbz81zz122znz90zz74z1z78zz67zz66zz122zz83zjz73ziz69z\"><strong>Option C:\u00a0</strong></span><span class=\" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qoxwyy7z90zx1z73zz86z8z72z3z70zvjbz81zz122znz90zz74z1z78zz67zz66zz122zz83zjz73ziz69z\">In a case-control study, the study begins from the outcome and goes retrospectively to find out the exposure among the cases and controls.</span></div>\n<div><span class=\" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qoxwyy7z90zx1z73zz86z8z72z3z70zvjbz81zz122znz90zz74z1z78zz67zz66zz122zz83zjz73ziz69z\"><strong>Option D: </strong>In case of a <strong>prospective cohort study,</strong> the study population is followed up regularly to look for the\u00a0effects of exposure.\u00a0</span></div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Energy requirement in pregnancy for a moderate worker is:",
    "choices": [
      {
        "id": 1,
        "text": "3000 kcal"
      },
      {
        "id": 2,
        "text": "2500 kcal"
      },
      {
        "id": 3,
        "text": "2000 kcal"
      },
      {
        "id": 4,
        "text": "1500 kcal"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>A woman doing moderate work requires 2130 kcal and in pregnancy an additional 350 kcal is needed.</p>\n<p>Hence, the total requirement for a moderately working pregnant woman is 2480 kcal. Therefore, the most probable answer among the given options is <strong>2500 kcal</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The antimicrobial treatment initiated in a patient who is not yet infected is called as____________.",
    "choices": [
      {
        "id": 1,
        "text": "Preemptive therapy"
      },
      {
        "id": 2,
        "text": "Prophylactic therapy"
      },
      {
        "id": 3,
        "text": "Empirical therapy"
      },
      {
        "id": 4,
        "text": "Definitive therapy"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The antimicrobial treatment initiated in a patient who is not yet infected is called as <strong>prophylactic therapy</strong>. The goal is to <strong>prevent infection</strong> in some patients and to <strong>prevent dangerous manifestations</strong> of infections in other patients.&nbsp;</p>\n<div class=\"page\" title=\"Page 968\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Preemptive therapy: Therapy in an asymptomatic individual with <strong>evidence of infection (high-risk)</strong>.</p>\n</div>\n</div>\n</div>\n</div>\n<p>Empirical therapy: Broad therapy in a patient with symptoms of infection but <strong>no microbiological confirmation</strong> of the causative agent.&nbsp;</p>\n<p>Definitive therapy: Definite therapy directed against <strong>microbiologically confirmed</strong> microbes with sensitive agents.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A young man presents to the emergency with a painful scrotum. On examination, the patient is febrile and a Prehn\u2019s sign is positive. What is the most likely cause of the patient\u2019s condition?",
    "choices": [
      {
        "id": 1,
        "text": "Epididymal cyst rupture"
      },
      {
        "id": 2,
        "text": "Testicular appendix torsion"
      },
      {
        "id": 3,
        "text": "Acute epididymitis"
      },
      {
        "id": 4,
        "text": "Testicular inversion"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The clinical scenario is suggestive of <strong>acute epididymitis.&nbsp;</strong></p>\n<p>A <strong>positive Prehn&rsquo;s sign</strong> is used to differentiate epididymis from testicular torsion. A Prehn&rsquo;s sign is said to be positive when the <strong>pain gets relieved</strong> on <strong>lifting the testis</strong>. If it persists, it is likely to be testicular torsion.</p>\n<p><strong><em>Chlamydia trachomatis</em></strong> is the most common cause of acute epididymitis in young, sexually active males.&nbsp;In older men(&gt;40yrs) with bladder outflow obstruction, epididymitis results from <strong>urinary infection, </strong>most commonly due to <strong><em>Escherichia coli</em></strong>.</p>\n<p><strong>Acute epididymitis</strong> is managed by <strong>antibiotics</strong> and scrotal support.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 55-year-old male patient presented after an episode of acute gastroenteritis and was infused with fluids. A while later, after fluid infusion, his heart rate rose to 122 bpm and he complained of palpitations. The presence of tachycardia can be explained by which of the following mechanisms?",
    "choices": [
      {
        "id": 1,
        "text": "Bezold-Jarisch reflex"
      },
      {
        "id": 2,
        "text": "Pulmonary chemoreflex"
      },
      {
        "id": 3,
        "text": "Bainbridge reflex"
      },
      {
        "id": 4,
        "text": "Cushing's reflex"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The presence of tachycardia can be explained by the\u00a0<strong>Bainbridge</strong> <strong>reflex.</strong></p>\n<p>It is a compensatory cardiac reflex where\u00a0there is an\u00a0<strong>increase\u00a0in the\u00a0heart rate\u00a0</strong>in response to <strong>raised atrial stretch. </strong></p>\n<p>In fluid overload states, commonly after <strong>excessive fluid infusion</strong>, there is <strong>distension of the atria</strong> due to increased blood volume. This <strong>distension</strong> activates the atrial stretch receptors which transmit the afferent signals to the medulla via the vagus nerve.\u00a0The efferent signals are then transmitted back through vagal\u00a0and sympathetic nerves. This leads to an increase in\u00a0the strength\u00a0of contraction of the heart and\u00a0<strong>tachycardia.</strong>\u00a0This reflex helps in preventing excess accumulation of blood in the atria, veins, and in the pulmonary circulation.</p>\n<p>Other options -\u00a0</p>\n<p>Option A:\u00a0<strong>Bezold-Jarisch reflex</strong> is due to the activation of <strong>chemosensitive vagal C fibers</strong>\u00a0in the cardiopulmonary region. They can be elicited after administering certain irritants like <strong>capsaicin</strong> or serotonin. It can also be activated during myocardial infarction and on exposure to radioactive dyes during coronary angiography. This reflex is characterized by <strong>profound\u00a0brady\u00adcardia, hypotension</strong>, and a brief period of <strong>apnea</strong> followed by <strong>rapid shallow breathing</strong>.\u00a0</p>\n<p>Option B<strong>: Pulmonary chemoreflex</strong> is due to the stimulation of the <strong>J-receptors</strong> (C receptors/juxta-pulmonary capillary receptors) which are stimulated when there is hyperinflation of the lung. This produces\u00a0reflex <strong>apnea</strong> followed by a <strong>rapid increase in breathing rate</strong>, <strong>bradycardia,</strong> and <strong>hypotension</strong>.</p>\n<p>Option D:<strong> Cushing's reflex </strong>is seen when the\u00a0<strong>intracranial\u00a0pressure\u00a0</strong>is<strong> raised </strong>where the blood supply to ventrolateral medulla neurons is compromised.\u00a0The local hypoxia and hypercapnia stimulate the neurons producing <strong>hypertension, bradycardia</strong>, and<strong> irregular respiration</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Increased callus formation is seen in:",
    "choices": [
      {
        "id": 1,
        "text": "Necrosis of bone ends"
      },
      {
        "id": 2,
        "text": "Rigid fracture fixation"
      },
      {
        "id": 3,
        "text": "Compression plating"
      },
      {
        "id": 4,
        "text": "Flexible fracture fixation"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Increased callus formation is seen with flexibly fixed fractures.&nbsp;</p>\n<p class=\"p1\">Fracture heals through <strong>direct union</strong> (<strong>primary bone healing</strong>) or by <strong>callus formation</strong> (<strong>secondary bone healing</strong>).</p>\n<ul>\n<li class=\"p1\"><strong>Direct union</strong>: This occurs when the fracture site is absolutely stable. This is seen in a fracture held by a metal plate with absolute stability and in cases of impacted fracture in cancellous bones. There is no stimulus for callus formation. Osteoblastic new bone formation occurs directly between the fracture fragments.</li>\n<li class=\"p1\"><strong>Callus formation</strong>: This occurs when the&nbsp;fracture is not fixed rigidly. The healing proceeds through <strong>5 stages</strong>: hematoma formation, inflammation, soft callus formation, hard callus formation, and remodelling.&nbsp;</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Dissociative anesthesia is a characteristic feature of _______",
    "choices": [
      {
        "id": 1,
        "text": "Ketamine"
      },
      {
        "id": 2,
        "text": "Propofol"
      },
      {
        "id": 3,
        "text": "Etomidate"
      },
      {
        "id": 4,
        "text": "Thiopentone"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Ketamine</strong> produces <strong>dissociative anesthesia</strong> which is characterized by a state wherein the patient is conscious (eg., eye opening, swallowing, muscle contracture) but unable to process or respond to sensory input.</p>\n<p>It acts as an <strong>antagonist </strong>at the<strong> phencyclidine&nbsp;</strong>site of the <strong>NMDA receptor.</strong></p>\n<p>Ketamine functionally &ldquo;<strong>dissociates&rdquo; the thalamus</strong> (which relays sensory impulses from the reticular activating system to the cerebral cortex) <strong>from the limbic cortex</strong> (which is involved with the awareness of sensation).</p>\n<p>Though the patient may have intact corneal, cough, and swallow reflexes, they need not be protective.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 45-year-old man who is a chronic alcoholic has the following hepatitis B profile:\nHBs Ag positive, HBe Ag positive, declining IgM anti-HBc in the presence of rising total anti-HBc.\nWhat is your diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Chronic  non-infective hepatitis"
      },
      {
        "id": 2,
        "text": "Chronic  infective hepatitis"
      },
      {
        "id": 3,
        "text": "Acute non-infective hepatitis"
      },
      {
        "id": 4,
        "text": "Acute fulminant hepatitis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The diagnosis in this case is <strong>chronic infective hepatitis</strong>.</p>\n<p>HBsAg positive suggests <strong>active infection</strong>.</p>\n<p>HBeAg positive signifies continued viral replication, <strong>high infectivity</strong>, and probable progression to chronic hepatitis.</p>\n<p>Declining IgM anti-HBc in the presence of rising total anti-HBc indicates <strong>IgM </strong>being<strong> converted to IgG</strong> and hence the infection is <strong>chronic</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "While performing a PET-CT scan, uptake in which of the following areas is likely to be a false positive?",
    "choices": [
      {
        "id": 1,
        "text": "Urinary bladder"
      },
      {
        "id": 2,
        "text": "Testes"
      },
      {
        "id": 3,
        "text": "Pancreas"
      },
      {
        "id": 4,
        "text": "Lymph nodes"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>On 18F-FDG <strong>PET-CT</strong> scan, the<strong> urinary bladder</strong> shows normal physiological uptake and&nbsp;is a <strong>potential</strong> source of <strong>false-positive </strong>in oncologic imaging.&nbsp;</p>\n<p>The following are areas of <strong>normal physiological uptake</strong> on PET CT:</p>\n<ul>\n<li>Brain tissue</li>\n<li>Skeletal muscle, especially after strenuous activity and laryngeal muscles following speech</li>\n<li>Myocardium</li>\n<li>Gastrointestinal tract - intestinal wall</li>\n<li>Genitourinary tract - as FDG is excreted via the renal system and passes into the collecting systems</li>\n<li>Brown fat - FDG accumulates here as glucose and ATP are required for heat production</li>\n<li>Thymus</li>\n<li>Bone marrow</li>\n</ul>\n<p>The following image shows supraclavicular uptake on a PET scan, due to the presence of brown adipose tissue.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/aa0e461783e34c3ca1afd3412feeadf3x512x130.PNG"
    ]
  },
  {
    "text": "A child presents with fever and pain in the right iliac fossa. He had a history of nausea and vomiting 3 days back and was not taken to the hospital. The surgeon suggested percutaneous drainage as the CT of the right iliac fossa showed a well-circumscribed fluid collection.  What is the most likely diagnosis here?",
    "choices": [
      {
        "id": 1,
        "text": "Perinephric abscess"
      },
      {
        "id": 2,
        "text": "Strangulated hernia with peritonitis"
      },
      {
        "id": 3,
        "text": "Bladder rupture"
      },
      {
        "id": 4,
        "text": "Appendicular abscess"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The history of right iliac fossa pain with fever, nausea, and vomiting is suggestive of acute appendicitis, which in this case has progressed to an<strong> appendicular abscess</strong> as suggested by the radiological findings.</p>\n<p>An <strong>appendicular abscess</strong> is a very<strong> common complication</strong> of an <strong>untreated or perforated appendix</strong>. It can occur retroperitoneally or intraperitoneally.</p>\n<p>Investigations include <strong>USG </strong>or<strong> CT</strong>&nbsp;of the abdomen&nbsp;which shows a <strong>well-circumscribed, rounded</strong>, or ill-defined, irregular fluid collection&nbsp;in the appendicular region.&nbsp;</p>\n<p>With the recent advances, <strong>early laparoscopic drainage </strong>or <strong>radiologically assisted percutaneous drainage followed by delayed appendicectomy</strong> is also done. If these are unsuccessful or there is leakage into the peritoneal cavity a midline laparotomy can be done.&nbsp;</p>\n<p>Note:</p>\n<p>The popular management of <strong>an appendicular mass</strong> is the<strong> Oschner-Sherren regime</strong> which is conservative management as the inflammatory process has already been localized and surgery is complicated now.&nbsp;</p>\n<p>If it progresses to an abscess, it must be drained radiologically or laparoscopically along with intravenous antibiotics.</p>\n<p>The indications for stopping the conservative management include:</p>\n<ul>\n<li>Rising pulse rate</li>\n<li>Increasing or spreading abdominal pain&nbsp;</li>\n<li>The increasing size of the mass.</li>\n</ul>\n<p>A follow-up CT is taken in case of conservative management to ensure that there is a complete resolution of the inflammatory process.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 14-year-old boy, who is a football player, comes to the casualty with complaints of epistaxis while playing football on the ground. There is no history of trauma or fall. He also gives a history of recurrent spontaneous nasal bleeding as well as unilateral nasal obstruction and denasal speech. Contrast-enhanced CT scan of the head is shown below. What is the sign shown in the image?",
    "choices": [
      {
        "id": 1,
        "text": "Aquino sign"
      },
      {
        "id": 2,
        "text": "Holman-Miller sign"
      },
      {
        "id": 3,
        "text": "Teardrop sign"
      },
      {
        "id": 4,
        "text": "Hanging drop sign"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given CT scan showing the <strong>anterior bowing</strong> of the posterior wall of the maxillary sinus is called the <strong>Holman-Miller sign&nbsp;</strong>or&nbsp;<strong>antral sign.</strong></p>\n<p>The given clinical picture along with a CT scan showing the <strong>Holman-Miller sign</strong>&nbsp;is suggestive of the diagnosis of <strong>nasopharyngeal angiofibroma</strong>. It most commonly arises from the <strong>sphenopalatine foramen</strong>.&nbsp;</p>\n<p>From here. the tumor grows into the</p>\n<ul>\n<li>Nasal cavity</li>\n<li>Nasopharynx</li>\n<li>Pterygopalatine fossa</li>\n<li>Pterygomaxillary fossa</li>\n<li>Infratemporal fossa</li>\n</ul>\n<p><strong>Other options:</strong></p>\n<p><strong>Aquino sign </strong>is the blanching of the tumor mass in glomus tumor, when the ipsilateral carotid artery is compressed manually.</p>\n<p><strong>Hanging drop/tear-drop sign</strong> is characteristic of an orbital \"blow-out\" fracture, which represents the orbital contents herniating through the floor of the orbit into the maxillary antrum.</p>\n<p>Given below is CT showing the anterior bowing of the posterior wall of the maxillary sinus&mdash;<strong>antral sign or</strong>&nbsp;<strong>Holman-Miller sign</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/9fa7ed36cb3e4531bd224ba856aec490.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/59f3d364c7934a96a9a1130e90fc6f95x468x512.PNG"
    ]
  },
  {
    "text": "A 20-year-old male presents 3 days after an episode of unprotected intercourse. He complains of profuse purulent discharge per urethra and severe burning pain on passing urine. Which of the following is a probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Chlamydiasis"
      },
      {
        "id": 2,
        "text": "Lymphogranuloma venerum"
      },
      {
        "id": 3,
        "text": "Donovanosis"
      },
      {
        "id": 4,
        "text": "Gonorrhoea"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>This clinical picture suggests a diagnosis of gonorrhoea as the patient presents with <strong>purulent discharge</strong> within the <strong>incubation</strong> <strong>period</strong> of <strong>gonorrhoea (2&ndash;7 days).</strong></p>\n<ul>\n<li><strong>In men</strong>, gonorrhoea usually presents with <strong>acute</strong> <strong>dysuria</strong> with <strong>profuse</strong> <strong>purulent</strong> <strong>discharge</strong> per urethra.</li>\n<li>The primary site of infection <strong>in women </strong>is the <strong>cervix</strong> but the urethra, rectum and pharynx may be involved. Symptomatic infections manifest as excessive <strong>vaginal</strong> <strong>discharge</strong>, <strong>dysuria</strong>, deep dyspareunia, <strong>postcoital</strong> <strong>bleeding</strong> and <strong>intermenstrual</strong> <strong>bleeding</strong>.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 65-year-old hypertensive patient presents with dizziness and palpitations following an alcohol binge. His ECG is shown below. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Ventricular tachycardia"
      },
      {
        "id": 2,
        "text": "Focal atrial tachycardia"
      },
      {
        "id": 3,
        "text": "Ventricular fibrillation"
      },
      {
        "id": 4,
        "text": "Atrial fibrillation"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical scenario and the ECG are suggestive of&nbsp;<strong>atrial fibrillation.</strong></p>\n<p>The ECG shows narrow QRS complexes with <strong>irregular RR intervals</strong> and <strong>no distinct P waves</strong> which are the features suggestive of atrial fibrillation.</p>\n<p><strong>Atrial fibrillation</strong> is a supraventricular tachycardia caused by ectopic foci or small reentry circuits within the atria. It has an atrial rate of 400-600/min and a ventricular rate of 100-160/min. The incidence of AF <strong>increases with age</strong> and is usually associated with an acute <strong>precipitating factor</strong> such as <strong>acute alcohol intoxication</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d5e047aae3384259808b098765a4d611.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A person presents to the emergency department with suspected poisoning due to ingestion of arsenic containing pesticides 24 hours ago. Which of the following is not a likely finding in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Mees lines on nails"
      },
      {
        "id": 2,
        "text": "Cholera like gastroenteritis"
      },
      {
        "id": 3,
        "text": "Garlic odour of the breath"
      },
      {
        "id": 4,
        "text": "Acute tubular necrosis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Mees lines are unlikely to be found in a patient with arsenic ingestion 24 hours ago.&nbsp;</p>\n<p>Features of acute arsenic poisoning</p>\n<ul>\n<li>Acute toxicity typically starts in the gastrointestinal system with <strong>severe watery diarrhea (like cholera)</strong></li>\n<li>QTc prolongation and cardiac arrhythmias</li>\n<li>Acute encephalopathy</li>\n<li>Renal injury with <strong>Acute Tubular Necrosis</strong></li>\n<li><strong>Garlic odor&nbsp;</strong>of breath and stools</li>\n</ul>\n<p><strong>Mees lines</strong> (horizontal 1 to 2 mm white lines on the nails, also called transverse leukonychia), which occur from a disturbance in the nail matrix keratinization. It usually takes at least 30 days for the Mees lines to become visible. It may be seen 4 to 6 weeks after an acute arsenic ingestion. These can also be seen in&nbsp;<strong>Thallium poisoning.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6f2c8fad32fa40dbb55d2faa6b616765x1158x990.JPEG"
    ]
  },
  {
    "text": "Slow sand filters are also called _________",
    "choices": [
      {
        "id": 1,
        "text": "Biological filters"
      },
      {
        "id": 2,
        "text": "Mechanical filters"
      },
      {
        "id": 3,
        "text": "Nitrate filters"
      },
      {
        "id": 4,
        "text": "Bacteriological filters"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<ul>\n<li>Slow sand filters are also called biological filters.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = 'Fmge Mini Test - 008';
        const quizFilename = 'fmge-mini-test-008-629fa195.html';
        let hierarchy = ["Marrow", "FMGE Mini Test Series", "2023"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>