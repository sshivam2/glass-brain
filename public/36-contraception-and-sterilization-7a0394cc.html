<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>36 Contraception And Sterilization - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Obstetrics & Gynecology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">27</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following statements is false about the rhythm method?",
    "choices": [
      {
        "id": 1,
        "text": "Anencephaly is seen on accidental conception"
      },
      {
        "id": 2,
        "text": "It is a cost effective method"
      },
      {
        "id": 3,
        "text": "Safe period is determined using temperature or mucous method"
      },
      {
        "id": 4,
        "text": "Abstinence is required for 7-10 days in a month"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Anencephaly</strong> is not seen in the case of accidental conception in a woman using the rhythm method. It occurs due to <strong>deficiency of folic acid</strong> in the mother.</p>\n<p>The <strong>calendar</strong> method or the <strong>rhythm</strong> method is one of the <strong>natural</strong> methods of contraception by <strong>fertility awareness</strong>. The couple is advised avoidance of sexual intercourse around ovulation. Thus, it is very cost-effective but it can only be used by educated couples.</p>\n<p>According to this method, <strong>safe period</strong> in a normal 28-day cycle is from the <strong>1st</strong> day of menstrual period to the <strong>10th</strong> day and from the <strong>18th</strong>&nbsp;to the&nbsp;<strong>28th</strong> day. An alternate method is by calculating the risk period i.e.,&nbsp;3 days before and 3 days after ovulation. <strong>Ovulation</strong> can also be estimated by <strong>changes</strong> in <strong>cervical mucus</strong> and <strong>basal body temperature</strong>.</p>\n<p>Another method of calculating the safe period is the <strong>Knaus&ndash;Ogino method</strong>. The fertile&nbsp;period is determined by subtracting 18 days from the shortest cycle and 10 days from the longest cycle. This&nbsp;gives the&nbsp;first and the last day of the fertile period, respectively.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What does Billing's method of contraception refer to?",
    "choices": [
      {
        "id": 1,
        "text": "Basal body temperature method"
      },
      {
        "id": 2,
        "text": "Cervical mucus method"
      },
      {
        "id": 3,
        "text": "Calendar method"
      },
      {
        "id": 4,
        "text": "Coitus interruptus method"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Billing&rsquo;s</strong> method of contraception refers to the <strong>cervical mucus</strong> method. It is also called ovulation method.</p>\n<p>The properties of the cervical mucus change during the menstrual cycle. The female partner can predict the fertile period by examining her cervical mucus.</p>\n<p>Under the influence of <strong>estrogen</strong>, the <strong>mucus</strong> <strong>increases</strong> in quantity and becomes more slippery and <strong>elastic</strong>&nbsp;i.e. <strong>wet days.&nbsp;</strong>This continues&nbsp;till it reaches a peak. After this, under the influence of <strong>progesterone</strong>, it becomes thicker, scanty i.e. <strong>dry days</strong>.</p>\n<p>Abstinence is advised during the wet days till 4 days after the peak day.&nbsp;The <strong>safe&nbsp;period</strong> includes the <strong>dry days</strong> after menses till the appearance of mucus and from the 4th day after the peak day.&nbsp;</p>\n<p>The pattern of cervical mucus secretion during a menstrual cycle is given below.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b70b54b201034e8091bb6e613ae59a47x1280x1451.JPEG"
    ]
  },
  {
    "text": "Identify the contraceptive shown in the given image.",
    "choices": [
      {
        "id": 1,
        "text": "Male condom"
      },
      {
        "id": 2,
        "text": "Female condom"
      },
      {
        "id": 3,
        "text": "Diaphragm"
      },
      {
        "id": 4,
        "text": "Cervical cap"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given image shows a <strong>female condom</strong>. It consists of a pouch made of <strong>polyurethane</strong> which is 17 cm in length with a flexible ring at each end. The<strong> inner ring</strong> at the closed end is <strong>smaller</strong> than the outer ring.</p>\n<p>The inner ring is inserted at the apex of the vagina and the outer ring remains outside. It covers the cervix, the entire vagina, and external genitalia. Hence, it provides <strong>protection against HIV</strong> and <strong>STDs</strong>.&nbsp;It has a <strong>failure rate</strong> of <strong>5&ndash;15</strong> per 100 woman-years, which is higher than that of a male condom.</p>\n<p>It can be fitted by the patient hours before intercourse, and easily removed soon after. It covers the cervix, vagina, and external genitalia and is protective against sexually transmitted diseases. It can also be worn in the puerperal period, unlike the cervical diaphragm.</p>\n<div class=\"page\" title=\"Page 155\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>The female condom should not be used along with a male condom because if worn together they may slip, tear, or become displaced.</p>\n</div>\n</div>\n</div>\n</div>\n<p>The given image below shows the insertion of a female condom:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/064fe9a2b40c43449c1cbe629058165d.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8ed293680fd14bb8bab910105a433c80x1280x1464.2766407904023.JPEG"
    ]
  },
  {
    "text": "A nulliparous woman has been using Today sponge as a contraceptive. What does this contain?",
    "choices": [
      {
        "id": 1,
        "text": "Nonoxynol 9"
      },
      {
        "id": 2,
        "text": "Octoxynol 8"
      },
      {
        "id": 3,
        "text": "Menfegol"
      },
      {
        "id": 4,
        "text": "Tergitol"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Today</strong>&nbsp;sponge contains 1 g of&nbsp;<strong>nonoxynol 9.&nbsp;</strong>It is a <strong>mushroom-shaped</strong> <strong>polyurethane</strong> disposable&nbsp;<strong>sponge</strong> that is&nbsp;2 inches wide and 1.25 inches thick.</p>\n<p>It is provided with a loop for easy removal.&nbsp;It should be placed high up in the vagina with the <strong>concave side</strong> covering the <strong>cervix</strong>.&nbsp;It can remain<strong> effective for 24 h</strong>. It can be&nbsp;<strong>used only once</strong>.</p>\n<p>It acts as a <strong>mechanical barrier</strong> preventing the entry of sperms into the cervical canal, absorbs semen, and contains a <strong>spermicidal</strong> agent. The failure rate is 9-16 per 100 woman-years.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/18e1bb1844974ed4bf722dd9fe0939ccx1280x1232.JPEG"
    ]
  },
  {
    "text": "Which of the following is not a contraindication for the use of the contraceptive shown below?",
    "choices": [
      {
        "id": 1,
        "text": "Multiple sex partners"
      },
      {
        "id": 2,
        "text": "Recurrent UTI"
      },
      {
        "id": 3,
        "text": "Uterine prolapse"
      },
      {
        "id": 4,
        "text": "Herpes vaginalis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given image shows a <strong>cervical</strong>&nbsp;<strong>diaphragm</strong>&nbsp;or <strong>Dutch cap.</strong>&nbsp;It can be <strong>used</strong> by women having <strong>multiple sex partners</strong>.</p>\n<p><strong>Contraindications of cervical diaphragm usage</strong>:</p>\n<ul>\n<li>Prolapse, cystocele, rectocele - accurate fitting is not possible</li>\n<li>Recurrent urinary tract infection&nbsp;</li>\n<li>Allergy to rubber or spermicidal agent</li>\n</ul>\n<p>It must be <strong>removed following intercourse </strong>as it can lead to<strong> toxic shock syndrome</strong> (TSS) if left in the vagina for a long period. TSS is caused by <em>Streptococcus pyogenes or&nbsp;Staphylococcus aureus&nbsp;</em>infection.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/03e63bf6d5974dcbba4c514944b3939e.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "You are prescribing nonoxynol-9 jelly to a woman using a cervical diaphragm for contraception. What is its mechanism of action?",
    "choices": [
      {
        "id": 1,
        "text": "Acrosomal enzyme inhibition"
      },
      {
        "id": 2,
        "text": "Cervical enzyme alteration"
      },
      {
        "id": 3,
        "text": "Glucose uptake inhibition by sperms"
      },
      {
        "id": 4,
        "text": "Disruption of cell membrane"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Nonoxynol-9</strong> is one of the <strong>spermicidal</strong> agents which act by <strong>disruption</strong> of the <strong>sperm cell membrane</strong>.&nbsp;</p>\n<p>Spermicidal agents are chemical contraceptives as they contain<strong> surfactants</strong>, such as nonoxynol-9, octoxynol,&nbsp;menfegol and <strong>enzyme-inhibiting agents</strong>.&nbsp;These are available as:</p>\n<ul>\n<li>Foam tablets</li>\n<li>Soluble pessaries</li>\n<li>Creams</li>\n<li>Jellies</li>\n<li>Films&nbsp;</li>\n</ul>\n<p>The spermicidal agent remains <strong>effective</strong> for <strong>1&ndash;2 hours</strong> after the application. They are always used along with other contraceptives such as the diaphragm, cervical cap, and condom. When they are used alone, the <strong>failure rate</strong> is <strong>high</strong> i.e.,&nbsp;30 per 100 woman-years.&nbsp;</p>\n<p><strong>Chronic use</strong> of spermicides can cause <strong>vaginal irritation</strong>, abrasion, and ulceration. This<strong> increases</strong> the risk of <strong>HIV spread</strong>.&nbsp;Hence, spermicidal agents should not be recommended to HIV-positive couples.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A young woman who is using a cervical diaphragm asks for an alternative contraceptive. You suggest a recently launched contraceptive Phexxi. What is its composition?",
    "choices": [
      {
        "id": 1,
        "text": "Lactic acid, Citric Acid, Potassium bitartrate"
      },
      {
        "id": 2,
        "text": "Ascorbic acid, Citric acid, Calcium bitartrate"
      },
      {
        "id": 3,
        "text": "Lactic acid, Ascorbic acid, Potassium bitartrate"
      },
      {
        "id": 4,
        "text": "Ascorbic acid, Lactic acid, Calcium bitartrate."
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Phexxi</strong> is a vaginal<strong> gel</strong> that contains <strong>lactic acid</strong>, <strong>citric acid</strong>, and <strong>potassium bitartrate</strong>.</p>\n<p>Phexxi is a <strong>vaginal pH regulator </strong>which is a&nbsp;<strong>non-hormonal contraceptive</strong>. It works by maintaining vaginal pH within the range of 3.5 to 4.5. This <strong>acidic environment</strong> is inhospitable for sperms.</p>\n<p>Phexxi comes in pre-filled vaginal applicators. A <strong>single dose</strong> must be applied <strong>before vaginal intercourse</strong>. If more than one act of vaginal intercourse occurs within one hour, an additional dose must be applied.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/27038c31bbab42b3ba1dd992492c961ax1280x861.JPEG"
    ]
  },
  {
    "text": "A newly married woman was prescribed Mala-N at a PHC. What is its composition?",
    "choices": [
      {
        "id": 1,
        "text": "LNG and ethinyl estradiol"
      },
      {
        "id": 2,
        "text": "Nordesterol and ethinyl estradiol"
      },
      {
        "id": 3,
        "text": "Desogestrel and ethinyl estradiol"
      },
      {
        "id": 4,
        "text": "Norgestimate and ethinyl estradiol"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Mala-N</strong> is a combined oral contraceptive containing 0.15 mg\u00a0<strong>levonorgestrel </strong>(LNG)\u00a0and 0.03 mg\u00a0<strong>ethinyl estradiol</strong>. It\u00a0is supplied free of cost through all PHC's, urban family welfare centers, etc.</p>\n<p>All combined oral pills contain a mixture of ethinyl estradiol in a dose of 20-30 mcg and an orally active progestogen. Mala-D has the same composition as Mala-N but\u00a0is available at a price of Rs 3/- per packet.\u00a0</p>\n<p>Combined oral pill works by suppressing pituitary hormones, FSH, and LH peak which <strong>prevents ovulation</strong>. At the same time, progestogen causes atrophic changes in the endometrium and <strong>prevents implantation</strong>.</p>\n<p>Progestogen also acts on the <strong>cervical mucus</strong> making it <strong>thick</strong> and tenacious and impenetrable by sperms. It also interferes with tubal motility and alters tubal transport.</p>\n<p>, so the fertilized egg reaches the uterine cavity before the endometrium is receptive for implantation.</p>\n<p>These tablets are taken starting on the first day\u00a0of the cycle for 21 days. A new course of tablets should be commenced 7 days after the cessation of the previous course. They should be taken at bedtime, preferably after a meal.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not an advantage of norgestimate OCPs?",
    "choices": [
      {
        "id": 1,
        "text": "Reduces venous thrombosis"
      },
      {
        "id": 2,
        "text": "Less metabolic side effects"
      },
      {
        "id": 3,
        "text": "Reduces acne and hirsutism"
      },
      {
        "id": 4,
        "text": "Lesser cardiovascular risk"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Norgestimate </strong>is one of the<strong> 3rd generation progesterone agents.&nbsp;</strong>All OCPs have the disadvantage of&nbsp;<strong>increasing </strong>the<strong> risk </strong>of<strong> venous thrombosis</strong>.&nbsp;</p>\n<p>Third-generation progesterone agents are <strong>less androgenic</strong> and so reduce the occurrence of acne and hirsutism. They also have a lower&nbsp;risk of <strong>metabolic</strong> and <strong>cardiovascular</strong> disorders compared to the previous generation progesterone agents.</p>\n<p><strong>Benefits of combined pills:</strong></p>\n<ul>\n<li>Effective contraceptive</li>\n<li>Useful in menorrhagia and polymenorrhoea</li>\n<li>Relieves dysmenorrhoea and premenstrual tension</li>\n<li>Prevents anaemia by reducing the menstrual loss</li>\n<li>Lower incidence of benign breast neoplasia (fibrocystic disease),&nbsp;functional ovarian cyst, ovarian and uterine malignancy</li>\n<li>Reduced risk of PID - due to thick cervical mucus caused by progestogen, preventing the organisms from entering into the uterine cavity&nbsp;</li>\n<li>Reduced incidence of ectopic pregnancy - due to suppression of ovulation and decreased risk of PID</li>\n<li>Protects against rheumatoid arthritis</li>\n<li>Reduces the risk of anorectal cancer</li>\n<li>Useful in acne, PCOD, and endometriosis</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not a contraindication to the use of OCPs?",
    "choices": [
      {
        "id": 1,
        "text": "Ischemic heart disease"
      },
      {
        "id": 2,
        "text": "Hepatoma"
      },
      {
        "id": 3,
        "text": "Hypothyroidism"
      },
      {
        "id": 4,
        "text": "Breast cancer"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Thyroid disorders like hypothyroidism are not a contraindication for OCP usage.</p>\n<p><strong>Contraindications</strong> <strong>of OCPs</strong>:</p>\n<ul>\n<li><strong>Absolute </strong>contraindications&nbsp;-\n<ul>\n<li><strong>Breast</strong> and genital <strong>cancers</strong></li>\n<li><strong>Liver disease</strong></li>\n<li>History of thromboembolism</li>\n<li><strong>Cardiac abnormalities</strong></li>\n<li>Congenital hyperlipidemia</li>\n<li>Undiagnosed abnormal uterine bleeding</li>\n</ul>\n</li>\n<li><strong>Relative </strong>contraindications<strong> -</strong>&nbsp;\n<ul>\n<li>Age over 40 years, if&nbsp;smoker &gt;35 years</li>\n<li>Mild hypertension</li>\n<li>Chronic renal disease</li>\n<li>Epilepsy</li>\n<li>Migraine</li>\n<li>First 6 months of breastfeeding</li>\n<li>Diabetes mellitus</li>\n<li>Gallbladder disease</li>\n<li>History of infrequent bleeding or amenorrhea</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following drugs do not lead to failure of OCPs?",
    "choices": [
      {
        "id": 1,
        "text": "Rifampicin"
      },
      {
        "id": 2,
        "text": "Phenobarbitone"
      },
      {
        "id": 3,
        "text": "Valproate"
      },
      {
        "id": 4,
        "text": "Phenytoin"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Sodium valproate</strong> is an<strong> inhibitor</strong> <strong>of</strong> CYP enzymes that are responsible for <strong>OCP metabolism</strong>. Thus, it does not lead to OCP failure.&nbsp;</p>\n<p><strong>Drugs</strong> <strong>leading to OCP failure</strong> are :</p>\n<ul>\n<li><strong>Rifampicin</strong></li>\n<li>Tetracyclines - interferes with enterohepatic circulation of estrogen</li>\n<li><strong>Phenytoin</strong></li>\n<li><strong>Phenobarbitone</strong></li>\n<li>Antifungals</li>\n<li>Cephalosporin</li>\n<li>Ritonavir for HIV - interferes with absorption of OCP</li>\n</ul>\n<p>Most of the anti-convulsants are enzyme inducers and hence increase the clearance of OCPs. This leads to OCP failure.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not the mechanism of action of progesterone only pills?",
    "choices": [
      {
        "id": 1,
        "text": "Thicken the cervical mucus"
      },
      {
        "id": 2,
        "text": "Prevents ovulation"
      },
      {
        "id": 3,
        "text": "Kills the sperms in the cervical canal"
      },
      {
        "id": 4,
        "text": "Inhibits penetration of sperm"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Minipills or <strong>progesterone-only pills (POP)</strong> do not kill sperm in the cervical canal. Progesterone-only pills act by <strong>thickening</strong>\u00a0the <strong>cervical mucus</strong>\u00a0(the main mechanism of all POPs except cerazette) that inhibits penetration of sperms,<strong> inhibiting tubal motility</strong>, and <strong>suppressing ovulation</strong>.\u00a0</p>\n<p>Other advantages of POPs include a <strong>reduction</strong> in the incidence of <strong>pelvic inflammatory diseases</strong> and <strong>sexually transmitted diseases</strong> (due to thickened cervical mucus).</p>\n<p>Due to the <strong>inhibition</strong> of <strong>tubal motility,</strong> the <strong>absolute risk</strong> of all pregnancies including ectopic pregnancy <strong>decreases,</strong> while the <strong>relative risk</strong> of <strong>ectopic</strong> pregnancy <strong>increases.\u00a0</strong>But a previous history of ectopic pregnancy is not a contraindication for POP.</p>\n<p>POPs do not affect\u00a0<strong>clotting, lipid</strong> metabolism, and <strong>carbohydrate metabolism.</strong> So they can safely be used by women who are obese, breastfeeding, hypertensive, have SLE or a history of thromboembolism, diabetic with vascular disease. Significant <strong>adverse</strong> effects of POPs are <strong>irregular bleeding</strong> (mostly scanty), and <strong>secondary amenorrhea</strong> after longtime usage as it causes endometrial atrophy.</p>\n<p><strong>Contraindications</strong> for POPs include <strong>undiagnosed vaginal bleeding, pregnancy,</strong> known or suspected <strong>breast cancer,</strong> and benign or malignant <strong>liver tumors.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient has come to your clinic for contraceptive advice. As she has a family history of breast cancer, you suggest a non-hormonal oral contraceptive to her. What is the initial dose of this drug?",
    "choices": [
      {
        "id": 1,
        "text": "30 mg on day 1 of cycle"
      },
      {
        "id": 2,
        "text": "60 mg on day 1 of cycle"
      },
      {
        "id": 3,
        "text": "60 mg on day 14 of cycle"
      },
      {
        "id": 4,
        "text": "30 mg on day 14 of cycle"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Centchroman</strong>&nbsp;is a <strong>non-hormonal oral</strong> contraceptive that is started at a dose of&nbsp;<strong>30 mg&nbsp;</strong>on the <strong>first day of </strong>the menstrual <strong>cycle</strong>. It can be given to women with a family history of breast cancer where hormonal contraceptives are contraindicated.</p>\n<p><strong>Centchroman </strong>or<strong>&nbsp;ormeloxifene&nbsp;</strong>is a synthetic <strong>nonsteroidal</strong> contraceptive. Following the initial dose of 30 mg on the first day of menses, it is taken <strong>twice weekly </strong>for <strong>12 weeks</strong> and <strong>weekly thereafter</strong>.&nbsp;It <strong>prevents implantation</strong> through endometrial changes.&nbsp;The<strong> return of fertility</strong> occurs <strong>within 6 months</strong> of stopping the drug.</p>\n<p>It can also be used as a <strong>postcoital</strong> pill, given in <strong>60 mg</strong> dose <strong>within 24 hours</strong> of coitus. It has a failure rate of 1.83 per 100 woman years. It does not provide protection against HIV and other STDs.</p>\n<p><strong>Side effects </strong>of centchroman<strong>:</strong></p>\n<ul>\n<li>Headache, nausea, vomiting</li>\n<li>Weight gain</li>\n<li>Delay in return of fertility (up to 6 months)</li>\n<li>Atypical endometrial hyperplasia - prolonged use</li>\n</ul>\n<p><strong>Contraindications&nbsp;</strong>of centchroman<strong>:</strong></p>\n<ul>\n<li>PCOD</li>\n<li>Hepatic dysfunction</li>\n<li>Cervical dysplasia</li>\n<li>Allergy to the drug</li>\n</ul>\n<p>This drug has been developed by Central Drug Research Institute, Lucknow. It has been released in India under the name of <strong>Chhaya</strong> (previously called Saheli) under the <strong>National Family Planning Programme</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a420d2e0f48144869936adba284428fbx496x314.PNG"
    ]
  },
  {
    "text": "Which of the following is the most effective reversible method of contraception?",
    "choices": [
      {
        "id": 1,
        "text": "Combined pill"
      },
      {
        "id": 2,
        "text": "Norplant"
      },
      {
        "id": 3,
        "text": "Mini pill"
      },
      {
        "id": 4,
        "text": "Mirena"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>&nbsp;</p>\n<p><strong>Advantages of implants:</strong></p>\n<ul>\n<li>Long-acting with sustained effect</li>\n<li>Good compliance&nbsp;</li>\n<li>Coital-independent with no nuisance of daily oral or frequent injections</li>\n<li>Failure rate - 0.2 and 1.3 per 100 woman-years</li>\n<li>Implanon reduces acne and osteoporosis.</li>\n</ul>\n<p><strong>Disadvantages of implants:</strong></p>\n<ul>\n<li>Breakthrough bleeding</li>\n<li>Irregular cycles</li>\n<li>Amenorrhoea&nbsp;</li>\n<li>Ectopic pregnancy</li>\n<li>Local infection</li>\n<li>Requires insertion and removal with nonbiodegradable capsules</li>\n<li>Expensive.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/41fd7efd991f48cab2e66192db8f6a1ex800x479.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/43658a5aab6340a4a68a6d9d466c0c61x845x463.JPEG"
    ]
  },
  {
    "text": "Which of the following is not a mechanism of action of the device given in the image below?",
    "choices": [
      {
        "id": 1,
        "text": "Chronic endometrial inflammation"
      },
      {
        "id": 2,
        "text": "Increase the motility of tubes"
      },
      {
        "id": 3,
        "text": "Enzymatic changes to prevent implantation"
      },
      {
        "id": 4,
        "text": "Formation of cervical mucus plug"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given image shows <strong>Multiload Cu250</strong>, which is one of the <strong>copper containing IUCDs</strong>. Formation of cervical mucus plug is not one of its mechanisms of action. However, <strong>progesterone-containing IUCDs</strong> can<strong> alter</strong> the <strong>cervical mucus</strong> along with the local effects.</p>\n<p>The various&nbsp;<strong>mechanisms</strong> <strong>of</strong> action of a <strong>copper-containing</strong>&nbsp;<strong>IUCD</strong>&nbsp;are:</p>\n<ul>\n<li>Interference with the&nbsp;migration of spermatozoa</li>\n<li>Foreign body reaction releasing prostaglandins - provokes&nbsp;uterine contractility&nbsp;and increases the tubal peristalsis which&nbsp;interferes with implantation</li>\n<li>Leucocytic infiltration in the endometrium - macrophages engulf the fertilized egg if it enters the endometrial tissue</li>\n<li>Enzymatic and metabolic changes in the endometrial tissue which interferes with implantation of the fertilized ovum</li>\n</ul>\n<p>Some IUCDs like <strong>CuT-380A</strong> are <strong>effective</strong> for <strong>up to 10 years</strong>.</p>\n<p>They are a good choice of method of&nbsp;contraception for the following groups of women:</p>\n<ul>\n<li>Having low risk of STD</li>\n<li>Multiparous woman</li>\n<li>Having a monogamous relationship</li>\n<li>Wanting long-term reversible method of contraception</li>\n<li>Unreliable users of oral contraception or barrier contraception</li>\n</ul>\n<p>IUCDs are <strong>avoided</strong> in <strong>unmarried</strong> and <strong>nulliparous</strong> patients because of the risk of PID and subsequent tubal infertility. Copper IUCDs can also be used as emergency contraception following intercourse.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/507459de36ab4946ab1b0328f70d915d.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "IUCD insertion is being considered in a multiparous woman who wants long-term contraception. This method of contraception is absolutely contraindicated in all of the following except _______.",
    "choices": [
      {
        "id": 1,
        "text": "Uterine leiomyomas"
      },
      {
        "id": 2,
        "text": "Suspected pregnancy"
      },
      {
        "id": 3,
        "text": "HIV infection"
      },
      {
        "id": 4,
        "text": "Pelvic inflammatory disease"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<div class=\"page\" title=\"Page 137\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>IUCDs</strong> can be <strong>used in\u00a0HIV</strong>-affected\u00a0women.</p>\n<p>Intrauterine contraceptive devices (IUCDs) provide\u00a0<strong>long-term</strong> <strong>contraception</strong> by preventing fertilization.</p>\n</div>\n</div>\n</div>\n</div>\n<p><strong>Contraindications for IUCD insertion:</strong></p>\n<ul>\n<li><strong>Suspected pregnancy</strong></li>\n<li><strong>Pelvic inflammatory disease</strong> (PID)</li>\n<li>Lower genital tract infection</li>\n<li>Presence of <strong>fibroids</strong></li>\n<li>Severe anaemia</li>\n<li>Uncontrolled diabetes - due to increased pelvic infection</li>\n<li>Scarred uterus eg, post caesarean section</li>\n<li>Septate uterus</li>\n<li>Menorrhagia and dysmenorrhoea - if Copper T is used</li>\n<li>Breast cancer - if LNG IUCD is used</li>\n</ul>\n<p><strong>Complications</strong> <strong>of IUCD usage</strong>:</p>\n<ul>\n<li>Immediate -<br />\n<ul>\n<li>Vasovagal attack</li>\n<li>Uterine cramps</li>\n</ul>\n</li>\n<li>Early -\n<ul>\n<li>Expulsion of IUCD</li>\n<li>Perforation of uterus</li>\n<li>Spotting, menorrhagia\u00a0</li>\n<li>Dysmenorrhoea\u00a0</li>\n<li>Vaginal infection</li>\n<li>Actinomycosis</li>\n</ul>\n</li>\n<li>Late -\n<ul>\n<li>PID</li>\n<li>Ectopic pregnancy</li>\n<li>Perforation of uterus</li>\n<li>Menorrhagia</li>\n<li>Dysmenorrhoea</li>\n</ul>\n</li>\n</ul>\n<p>The failure rate of IUCD is 1\u20133 per 100 woman-years.\u00a0\u00a0</p>\n<p><strong>Levonorgestrel</strong> <strong>IUCD</strong> also causes\u00a0<strong>hormonal adverse effects</strong> such as headache, acne, breast tenderness, and functional ovarian cysts. <strong>Amenorrhoea</strong> occurs in 35% of women after 2 years of use.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You are inserting Nova-T in a patient for spacing of births. This device contains______.",
    "choices": [
      {
        "id": 1,
        "text": "Copper and silver"
      },
      {
        "id": 2,
        "text": "Copper and aluminium"
      },
      {
        "id": 3,
        "text": "Only copper"
      },
      {
        "id": 4,
        "text": "Copper and selenium"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>In copper-carrying devices,&nbsp;copper wire is wrapped around the vertical stem of a polypropylene frame. Some of them have copper wire wrapped around the arms too. Based on the surface area, they are of various types:</p>\n<ul>\n<li>Copper T 380 A</li>\n<li>Multiload copper 250</li>\n<li>Copper T 200</li>\n<li>Copper 7</li>\n<li>Copper T 220</li>\n<li>Nova-T</li>\n</ul>\n<p>They are <strong>effective</strong> for&nbsp;<strong>3&ndash;5 years</strong>. It is estimated that about <strong>50 mcg</strong> of<strong> copper</strong> is <strong>eluted daily</strong> in the uterus. <strong>Copper T 380A</strong>, known as Paraguard, has a lifespan of <strong>10 years</strong>. <strong>Nova T</strong> has a lifespan of <strong>5 years</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9f36d723733445339481cca90bf386fdx1280x1512.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/25e1581e0a434440b4f7b96680fcb722x1280x5453.JPEG"
    ]
  },
  {
    "text": "A nursing mother was prescribed progestasert for contraception. How much progesterone is released by this device?",
    "choices": [
      {
        "id": 1,
        "text": "0.65 \u03bcg/day"
      },
      {
        "id": 2,
        "text": "65 \u03bcg/day"
      },
      {
        "id": 3,
        "text": "6.5 \u03bcg/day"
      },
      {
        "id": 4,
        "text": "6.5 mg/day"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Progestasert releases <strong>65 &mu;g </strong>of progesterone<strong>/day</strong>.</p>\n<p><strong>Progestasert</strong>&nbsp;is a T-shaped device<strong> carrying 38 mg</strong> of progesterone in a silicon oil reservoir in the vertical stem. The&nbsp;<strong>progesterone</strong>&nbsp;released causes the formation of a thick plug of mucus at the cervical os. This <strong>prevents entry</strong> of the <strong>sperms</strong> in addition to the <strong>local contraceptive effect</strong> of IUCDs.</p>\n<p>There is lesser incidence of menstrual problems like menorrhagia and dysmenorrhoea compared to copper-containing intrauterine devices. However, it is <strong>expensive</strong> and requires <strong>yearly replacement</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following increases the risk of pelvic inflammatory disease?",
    "choices": [
      {
        "id": 1,
        "text": "OCPs"
      },
      {
        "id": 2,
        "text": "Mirena"
      },
      {
        "id": 3,
        "text": "DMPA injectables"
      },
      {
        "id": 4,
        "text": "Copper IUCD"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Copper IUCDs</strong> increase the risk of<strong> PID</strong>.</p>\n<p>OCPs, Mirena and DMPA injectables contain&nbsp;<strong>progesterone</strong>&nbsp;which causes <strong>thickening</strong> of the <strong>cervical mucus</strong> and decreases the motility of the female genital tract. Thus, they <strong>reduce</strong> the risk of <strong>PID</strong> by preventing the ascent of bacteria from the vagina.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the most effective mode of contraception for a woman with heart disease?",
    "choices": [
      {
        "id": 1,
        "text": "Oral pills"
      },
      {
        "id": 2,
        "text": "Hormonal implants"
      },
      {
        "id": 3,
        "text": "Condom"
      },
      {
        "id": 4,
        "text": "IUCD"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<div class=\"page\" title=\"Page 132\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>IUCD</strong>s are the most effective mode of contraception for women with <strong>heart diseases</strong>.&nbsp;IUCDs are <strong>safe</strong> in these patients and come under the <strong>first-tier contraceptive </strong>methods.</p>\n<p><strong>Condoms</strong> are not contraindicated in heart disease patients but they are <strong>third-tier contraceptives</strong>. Hence, they are not as effective as IUCDs.</p>\n<p><strong>OCPs</strong> and hormonal <strong>implants</strong>&nbsp;are contraindicated in patients with heart diseases as the constituent hormones can cause <strong>thromboembolic</strong> disorders.</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following techniques of permanent contraception does not require an abdominal incision?",
    "choices": [
      {
        "id": 1,
        "text": "Pomeroy"
      },
      {
        "id": 2,
        "text": "Parkland"
      },
      {
        "id": 3,
        "text": "Essure"
      },
      {
        "id": 4,
        "text": "Irving"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Essure permanent device </strong>is a method of<strong> hysteroscopic sterilization.&nbsp;</strong>Pomeroy, Parkland, and Irving procedures are methods for tubal ligation via an abdominal approach.</p>\n<p>Essure device consists of a&nbsp;micro-inserter with a flexible <strong>inner coil</strong> made of <strong>stainless steel</strong> and a dynamic <strong>outer coil</strong> made of <strong>nickel titanium</strong> alloy (nitinol).&nbsp;</p>\n<p>This device is inserted into the fallopian tube by hysteroscopy. It acts by benign <strong>local fibrous tissue growth</strong> leading to occlusion of the tube.&nbsp;The failure rate is 3.5%.</p>\n<p>Its advantages are that there is <strong>no abdominal scar</strong> and the procedure can be done under <strong>local anaesthesia</strong>.</p>\n<p><strong>Disadvantages </strong>of Essure:</p>\n<ul>\n<li>Hysteroscopy required for the procedure and to confirm the blockage</li>\n<li>Expensive procedure</li>\n<li>Expertise required</li>\n<li>Irreversible - tuboplasty for reversal not possible</li>\n<li>3 months waiting time to ensure sterility - HSG must be done after 3 months to confirm tubal blockage</li>\n<li>Bilateral insertion difficult due to spasm&nbsp;</li>\n<li>Can cause perforation of the tube</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8c996c86646945fe87fa69f29b0a0688x1200x1451.JPEG"
    ]
  },
  {
    "text": "A woman has come to your clinic for a checkup following tubal ligation by Pomeroy technique. Which portion of the tube is ligated in this technique?",
    "choices": [
      {
        "id": 1,
        "text": "Infundibulum"
      },
      {
        "id": 2,
        "text": "Ampulla"
      },
      {
        "id": 3,
        "text": "Isthmus"
      },
      {
        "id": 4,
        "text": "Interstitium"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Isthmus </strong>of the fallopian tube&nbsp;is <strong>ligated</strong> in&nbsp;<strong>Pomeroy technique</strong>. It is the&nbsp;most popular technique of tubal ligation.</p>\n<p>Midline, paramedian or transverse abdominal incision is made 2 inches above the pubic symphysis (1 inch in puerperal sterilisation). The fallopian tube is identified, made into a loop and tied at the base. The loop is then excised.</p>\n<p>The operation is simple and requires a short period of hospitalization. The failure rate is only 0.4% and it is mainly due to spontaneous canalization.&nbsp;It is <strong>surgically reversible</strong>.</p>\n<p>The below image shows Pomeroy&rsquo;s method of tubal ligation.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/68eb0440727d410ca729173009d8a441x1200x2309.JPEG"
    ]
  },
  {
    "text": "Fimbriectomy is also known as:",
    "choices": [
      {
        "id": 1,
        "text": "Pomeroy technique"
      },
      {
        "id": 2,
        "text": "Uchida's procedure"
      },
      {
        "id": 3,
        "text": "Kroener's procedure"
      },
      {
        "id": 4,
        "text": "Irving's procedure"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Madlener's </strong>procedure<strong> -</strong>&nbsp;A loop of the fallopian <strong>tube is&nbsp;crushed</strong>&nbsp;and then ligated with a nonabsorbable suture.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4caec47b20a04233891a5a2610e280aax1280x992.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8de23c3cf2764095b9cc139758f29e4ax1280x973.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a95b458acaae46e5bd94ba5828801655x1280x1852.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/459d8d4c6f1141a484d36daa5544d18ax1280x991.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/13030913f5e542d3ac44667d89b41702x1280x973.JPEG"
    ]
  },
  {
    "text": "A 40-year-old male patient underwent a vasectomy. What is the failure rate of this procedure?",
    "choices": [
      {
        "id": 1,
        "text": "0.5%"
      },
      {
        "id": 2,
        "text": "0.15%"
      },
      {
        "id": 3,
        "text": "3%"
      },
      {
        "id": 4,
        "text": "1%"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The failure rate of vasectomy is <strong>0.15%</strong></p>\n<p>This procedure is done under <strong>local anaesthesia.</strong> A <strong>small incision</strong> is made in the <strong>scrotum</strong>. The <strong>vas deferens</strong> are <strong>divided</strong>&nbsp;on both sides which disrupts the passage of sperms.</p>\n<p>The<strong> no-scalpel technique</strong> has been now adopted. One single incision is made with <strong>special forceps</strong> and skin <strong>stitch</strong> is <strong>not required</strong>. Clips and plugs can be applied over the vas instead of cutting.</p>\n<p>The <strong>sperms</strong>&nbsp;can <strong>remain</strong>&nbsp;in the reproductive tract for up to <strong>3 months</strong>. Hence, sterility is not immediate. The couple must abstain from intercourse during this period or use other methods of contraception.</p>\n<p>Approximately, 20 ejaculates clear the semen of all sperms. <strong>Two semen analysis reports</strong> must <strong>confirm</strong> the absence of sperms before the man can be declared sterile.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/746162c9169b42b8b8c5a2f8e829da52x1280x1677.JPEG"
    ]
  },
  {
    "text": "A couple with a history of unprotected sexual intercourse requires emergency contraception. Which of the following is not a mechanism by which these drugs act?",
    "choices": [
      {
        "id": 1,
        "text": "Delaying or inhibiting ovulation"
      },
      {
        "id": 2,
        "text": "Inhibiting fertilization"
      },
      {
        "id": 3,
        "text": "Preventing the implantation of the fertilized egg"
      },
      {
        "id": 4,
        "text": "Interrupting an early pregnancy"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Emergency contraceptives</strong> do not interrupt early pregnancy, once conception has occured.&nbsp;They are used to <strong>prevent pregnancy</strong> after unprotected intercourse. Hence, they are also called&nbsp;<strong>interceptives</strong>.</p>\n<p>The main action of emergency contraceptives is to<strong> make</strong> the <strong>endometrium</strong> <strong>unsuitable</strong> for implantation. They can also <strong>delay or inhibit ovulation</strong>, and <strong>prevent fertilization</strong> of the egg by sperms.</p>\n<p><strong>Methods of emergency contraception:</strong></p>\n<table style=\"width: 501px;\">\n<tbody>\n<tr>\n<td style=\"width: 185px;\"><strong>Drug</strong></td>\n<td style=\"width: 300px;\"><strong>Dose</strong></td>\n</tr>\n<tr>\n<td style=\"width: 185px;\">Levonorgestrel</td>\n<td style=\"width: 300px;\">\n<p>0.75mg stat and repeat dose after 12 hours or</p>\n<p>1.5mg as a single dose</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 185px;\">Ethinyl estradiol 50 &mu;g + Norgestrel 0.25 mg</td>\n<td style=\"width: 300px;\">2 tabs stat and 2 tabs after 12 hours</td>\n</tr>\n<tr>\n<td style=\"width: 185px;\">RU486 (Mifepristone)</td>\n<td style=\"width: 300px;\">Single dose of 25-50mg</td>\n</tr>\n<tr>\n<td style=\"width: 185px;\">Ethinyl Estradiol</td>\n<td style=\"width: 300px;\">2.5 mg BD X 5 days</td>\n</tr>\n<tr>\n<td style=\"width: 185px;\">Copper IUDs</td>\n<td style=\"width: 300px;\">Insertion within 5 days of intercourse</td>\n</tr>\n<tr>\n<td style=\"width: 185px;\">Centchroman</td>\n<td style=\"width: 300px;\">\n<p>2 tabs(60 mg) to be taken twice at an interval of 12 hours</p>\n<p>Should be taken within 24 hours of intercourse.</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 185px;\">Ulipristal</td>\n<td style=\"width: 300px;\">30 mg within 5 days of intercourse</td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 23-year-old woman comes to the clinic with a history of unprotected intercourse 2 days ago. Which of the following will you prescribe as a single dose contraceptive?",
    "choices": [
      {
        "id": 1,
        "text": "Levonorgestrel 0.75 mg"
      },
      {
        "id": 2,
        "text": "Ethinyl estradiol 50 mcg"
      },
      {
        "id": 3,
        "text": "Levonorgestrel 1.5 mg"
      },
      {
        "id": 4,
        "text": "Norgestrel 0.25 mg"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Levonorgestrel</strong>&nbsp;(LNG)<strong> 1.5 mg </strong>i.e. 2 tablets of LNG 0.75 mg can be used as a <strong>single dose emergency contraceptive</strong>. This should be taken within 72 hours of unprotected intercourse.</p>\n<p>Alternatively, one tablet of LNG 0.75mg can be followed by another tablet 12 hours later. The tablets can be offered up to 120 hours but the efficacy decreases with the increase in interval between coitus and drug intake.</p>\n<p>LNG <strong>prevents ovulation</strong> and makes <strong>endometrium unsuitable</strong> for implantation.&nbsp;The failure rate is 1.1%. If pregnancy occurs as a result of <strong>contraceptive failure</strong>, the <strong>risk of ectopic pregnancy</strong> increases but it is not teratogenic.</p>\n<p><strong>Advantages </strong>of LNG<strong>:</strong></p>\n<ul>\n<li>No oestrogen and its associated side effects</li>\n<li>Can be used in hypertensive, cardiac and diabetic patients</li>\n<li>Suitable for lactating woman</li>\n<li>Can be given up to 120 hours after the unprotected intercourse</li>\n<li>Single-dose therapy&nbsp;</li>\n</ul>\n<p><strong>Contraindications</strong> of LNG:</p>\n<ul>\n<li>Liver disease</li>\n<li>Thrombophlebitis</li>\n<li>Migraine</li>\n<li>Galactose allergy - as the tablet contains lactose</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the dose of ulipristal for emergency contraception?",
    "choices": [
      {
        "id": 1,
        "text": "60 \u00b5g"
      },
      {
        "id": 2,
        "text": "3 mg"
      },
      {
        "id": 3,
        "text": "30 mg"
      },
      {
        "id": 4,
        "text": "30 \u00b5g"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The dose of <strong>ulipristal</strong> is <strong>30 mg</strong> tablet and it should be taken <strong>within 5 days&nbsp;</strong>of intercourse.</p>\n<p>Ulipristal is a synthetic progesterone receptor modulator. It attaches to the progesterone receptor and acts by:</p>\n<ul>\n<li>Preventing/delaying ovulation</li>\n<li>Suppressing endometrial and follicular growth</li>\n<li>Inhibiting implantation</li>\n</ul>\n<p><strong>Side effects</strong> are <strong>headaches</strong> and <strong>mood changes</strong>. It is <strong>contraindicated</strong> in women with severe <strong>hepatic dysfunction</strong> and severe <strong>asthma</strong>.</p>\n<p>Note: The use of ulipristal for the treatment of fibroids has been discontinued due to the increased incidence of severe liver injury.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '36 Contraception And Sterilization';
        let hierarchy = ["Marrow", "qBank", "Obstetrics & Gynecology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>