<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>06 Schizophrenia - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Psychiatry
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">26</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A middle-aged man presents to the psychiatry OPD with a history of speaking to himself, hearing two people talk about him, reduced affect, and impaired judgment which is present for more than 6 months. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Schizophreniform disorder"
      },
      {
        "id": 2,
        "text": "Schizoaffective disorder"
      },
      {
        "id": 3,
        "text": "Schizophrenia"
      },
      {
        "id": 4,
        "text": "Schizoid personality disorder"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The patient has&nbsp;auditory hallucination, reduced affect, lack of insight, impaired judgment for <strong>more than 6 months</strong>, which makes the diagnosis of&nbsp;<strong>schizophrenia</strong> more&nbsp;likely.&nbsp;</p>\n<p>Schizophrenia was previously known&nbsp;as<strong> dementia praecox</strong>, a term first coined by<strong>&nbsp;Emil Kraepelin</strong>. He classified psychiatric illness into two categories &ndash; dementia praecox and manic depressive disorder.</p>\n<p>Diagnostic criteria for schizophrenia (DSM-5):</p>\n<p class=\"p1\">1. The DSM-5 criteria to diagnose schizophrenia require a total duration of <strong>6 months</strong>.</p>\n<p class=\"p1\">2.&nbsp;Within this 6-month period, there must be at least <strong>1 month</strong> of active-phase symptoms (overt psychotic symptoms) where 2 or more of the following have to be present (at least one must be among the a, b, or c):&nbsp;</p>\n<ol style=\"list-style-type: lower-alpha;\">\n<li>Delusion</li>\n<li>Hallucination</li>\n<li>Disorganized speech (or formal thought disorder)</li>\n<li>Disorganized behavior</li>\n<li>Affective flattening or other negative symptoms</li>\n</ol>\n<p class=\"p1\">3. The rest of the 6-month period may include</p>\n<ul>\n<li class=\"p1\">Continuing psychotic symptoms</li>\n<li class=\"p1\">Prodromal symptoms preceding clear-cut psychosis</li>\n<li class=\"p1\">Residual symptoms after the resolution of the psychotic symptoms</li>\n</ul>\n<p>4. Residual symptoms are defined as attenuated forms of psychotic symptoms, such as:</p>\n<ul>\n<li>Odd beliefs</li>\n<li>Magical thinking</li>\n<li>Ideas of reference</li>\n<li>Odd perceptual experiences</li>\n<li>Peculiar or concrete thinking</li>\n<li>Vague speech</li>\n<li>Odd behavior</li>\n<li>Negative symptoms may also be included</li>\n</ul>\n<p>5. Exclusion of mood disorder &amp; substance abuse</p>\n<p>Note:&nbsp;DSM-5 does not require that delusions must be bizarre.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient with auditory hallucinations and persecutory delusions is diagnosed with schizophrenia. Which of the following is false regarding the neurotransmitters involved in its pathogenesis?",
    "choices": [
      {
        "id": 1,
        "text": "NMDA receptor hypoactivity in the prefrontal cortex"
      },
      {
        "id": 2,
        "text": "Decreased levels of nicotinic and muscarinic receptors in the hippocampus"
      },
      {
        "id": 3,
        "text": "Increased GABA receptor binding in the cingulate cortex"
      },
      {
        "id": 4,
        "text": "Dopaminergic hypoactivity in the subcortical regions"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Dopaminergic hyperactivity</strong> in the subcortical regions is seen in <strong>schizophrenia.&nbsp;</strong></p>\n<p>All of the following neurotransmitters have been implicated in the pathogenesis of schizophrenia:</p>\n<ul>\n<li><strong>Dopamine - </strong>dopaminergic <strong>hyperactivity</strong> in the <strong>subcortical</strong> region and <strong>hypoactivity</strong> in <strong>prefrontal</strong> cortical regions is seen. It is linked to <strong>positive symptoms</strong> and cognitive deficits respectively.&nbsp;</li>\n<li><strong>Serotonin</strong>&nbsp;<strong>excess</strong> is linked to both <strong>positive </strong>and<strong> negative symptoms.</strong></li>\n<li class=\"p1\"><strong>Norepinephrine&nbsp;</strong>- selective neuronal <strong>degeneration</strong> within the <strong>norepinephrine reward neural system</strong> is thought to be <strong>responsible for anhedonia,</strong> a feature of schizophrenia.</li>\n<li class=\"p1\"><strong>GABA&nbsp;</strong>has a regulatory effect on dopamine activity. In some patients, there is a <strong>loss</strong> of inhibitory GABAergic neurons, which could indirectly lead to the hyperactivity of dopaminergic neurons.&nbsp;Increased GABA<sub>A</sub> receptor binding has been reported in the prefrontal and cingulate cortices and the hippocampus.</li>\n<li><strong>Acetylcholine</strong> and <strong>nicotine</strong>- <strong>decreased</strong> levels of nicotinic and muscarinic receptors in the hippocampus is seen.</li>\n<li><strong>NMDA</strong>-&nbsp;N-methyl-D-aspartate receptor <strong>hypoactivity</strong>&nbsp;is seen in the prefrontal cortex.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A middle-aged woman presented with talkativeness, poor sleep, and wandering away from home for the past year. She often became aggressive and violent when restrained. On questioning, she cried uncontrollably and told that if she stays home it would result in her premature death. She admitted to hearing voices that warned her to not interact with her family members. Which of the following is not a risk factor associated with this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Amphetamine use"
      },
      {
        "id": 2,
        "text": "High socio-economic status"
      },
      {
        "id": 3,
        "text": "Advanced paternal age"
      },
      {
        "id": 4,
        "text": "Industrialization"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario is suggestive of <strong>schizophrenia.&nbsp;</strong>High socioeconomic status is not associated with an increased risk of developing this disorder.</p>\n<p>Factors that increase the risk of schizophrenia are:</p>\n<ul>\n<li>Genetic factor- first-degree relatives and twins are at a higher risk.</li>\n<li><strong>Low socioeconomic status</strong>, immigration</li>\n<li><strong>Industrialization</strong></li>\n<li>High expressed emotions</li>\n<li>Drugs- <strong>amphetamines</strong>, cocaine, cannabis, ketamine</li>\n<li>Metabolic disorders &ndash; Huntington&rsquo;s disease, Wilson&rsquo;s disease, hemochromatosis</li>\n<li>Asthenic body type</li>\n<li><strong>Advanced paternal age</strong>&nbsp;</li>\n<li>Winter born babies&nbsp;</li>\n</ul>\n<p>Schizophrenia is equally prevalent in both sexes.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An adolescent boy with schizophrenia had witnessed his parents fighting with each other for the past several years. He is overly close with his mother and she convinced him to take her side in the divorce. He always blamed his father for all their family problems. Which of the following best describes the abnormal family dynamics?",
    "choices": [
      {
        "id": 1,
        "text": "Expressed emotions"
      },
      {
        "id": 2,
        "text": "Marital skew"
      },
      {
        "id": 3,
        "text": "Marital schism"
      },
      {
        "id": 4,
        "text": "Double bind"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>This scenario describes an abnormal family dynamic, where one parent is overly close to the child of the opposite gender. This is known as <strong>marital schism</strong>.</p>\n<p>Marital schism, marital skew, expressed emotions, and double-bind refer to <strong>abnormalities</strong> of<strong> family dynamics</strong>.&nbsp;They act as psychosocial stressors, hampering the adaptive capacity of the individual, thus <strong>contributing</strong> to the <strong>development</strong> of <strong>schizophrenia.</strong></p>\n<p><strong>Marital schism</strong>- one parent is overly close to the child of the opposite gender.</p>\n<p><strong>Marital skew</strong>- a disharmonious situation where one parent dominates over the other.</p>\n<p><strong>Expressed emotions</strong>- parents or other caregivers may behave with overt criticism, hostility, or over-involvement towards a person with schizophrenia, which further worsens the illness.</p>\n<p><strong>Double bind-&nbsp;</strong>a hypothetical family in which children receive conflicting parental messages about their behavior, attitudes, and feelings.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not  a part of the 4 A's of Bleuler ?",
    "choices": [
      {
        "id": 1,
        "text": "Ambivalence"
      },
      {
        "id": 2,
        "text": "Avolition"
      },
      {
        "id": 3,
        "text": "Affective disturbances"
      },
      {
        "id": 4,
        "text": "Autism"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Avolition</strong>&nbsp;is not a part of the 4 A's of Bleuler .</p>\n<p>The term schizophrenia was introduced by Eugen Bleuler. He described the primary symptoms of schizophrenia, known as the 4 A's of Bleuler.</p>\n<p>This includes:</p>\n<ul>\n<li><strong>Autism-</strong>&nbsp;social withdrawal with excessive irrational fantasy thinking.</li>\n<li><strong>Ambivalence-</strong>&nbsp;marked inability to take a decision.</li>\n<li><strong>Association disturbances-</strong>&nbsp;loosening of association refers to changing the topic without identifiable links between the subjects.</li>\n<li><strong>Affect problems-</strong>&nbsp;flattening of affect or inappropriate affect.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient with schizophrenia presents with the following symptoms. Which of them is not a Schneiderian\u00a0first-rank symptom?",
    "choices": [
      {
        "id": 1,
        "text": "Ambivalence"
      },
      {
        "id": 2,
        "text": "Somatic passivity"
      },
      {
        "id": 3,
        "text": "Hallucination"
      },
      {
        "id": 4,
        "text": "Thought insertion"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Ambivalence</strong>&nbsp;is <strong>not</strong>&nbsp;a Schneiderian&nbsp;<strong>first-rank symptom</strong> of schizophrenia. It is one of the 4A&rsquo;s of schizophrenia as described by Bleuler.</p>\n<p>The first rank symptoms of schizophrenia described by Kurt Schneider include :</p>\n<p>1.&nbsp;<strong>Hallucination</strong>:</p>\n<ul>\n<li><strong>First-person</strong> hallucination (audible thoughts) - auditory hallucinations of the person&rsquo;s own voice being spoken aloud.</li>\n<li><strong>Second-person</strong> hallucination (voices directly addressing the patient) - auditory hallucinations of 1 or more voices talking directly to the person. They can be persecutory, complimentary, or issue commands (command hallucination)</li>\n<li><strong>Third-person</strong> hallucination (voices speaking about the patient) - auditory hallucinations of 1 or more voices speaking about the person. The voice may deliver a running commentary or the voices maybe be arguing/discussing the person.</li>\n</ul>\n<p>2.&nbsp;<strong>Thought phenomenon</strong>:&nbsp;</p>\n<ul>\n<li>Thought <strong>withdrawal-</strong>&nbsp; thoughts being actively removed from a person&rsquo;s mind.</li>\n<li>Thought <strong>insertion-</strong> thoughts inserted into a person&rsquo;s mind by some external agent.</li>\n<li>Thought <strong>broadcasting-</strong> the sense that a person&rsquo;s thoughts are experienced by others - the thoughts are made audible or may be experienced by others through telepathy.</li>\n</ul>\n<p>3.&nbsp;<strong>Made phenomenon</strong>:</p>\n<ul>\n<li>Made <strong>affect-</strong> feelings are imposed on that person by an external agent.</li>\n<li>Made <strong>impulses</strong> or drives - an impulse for action is imposed on a person by some external agent.</li>\n<li>Made <strong>volitional acts</strong> - a person&rsquo;s actions are controlled by an external agent; the person is a passive participant in the action.</li>\n</ul>\n<p>4.&nbsp;<strong>Delusional perception</strong>- the person attaches an abnormal significance/meaning to a normal perception, which leads to delusional interpretation. The most common delusion in schizophrenia is the&nbsp;<strong>delusion of persecution</strong>.&nbsp;These persecutory fears of the patient can range from transient doubts to profound convictions that people are plotting to have them tortured or killed.</p>\n<p>5.&nbsp;<strong>Somatic passivity</strong>- tactile or visceral hallucinations that are thought to be imposed on a person's body by some external agent.</p>\n<p>These symptoms are not specific to schizophrenia and may also be present in other psychiatric disorders.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A psychiatric resident is assessing the negative symptoms in a case of chronic schizophrenia. Which of the following is not tested?",
    "choices": [
      {
        "id": 1,
        "text": "Avolition"
      },
      {
        "id": 2,
        "text": "Alogia"
      },
      {
        "id": 3,
        "text": "Anhedonia"
      },
      {
        "id": 4,
        "text": "Anomia"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Anomia</strong> is <strong>not tested</strong> because it is not a feature of schizophrenia. It is a type of aphasia&nbsp;where there is difficulty in naming of objects. It is common in head trauma, metabolic encephalopathy, and Alzheimer&rsquo;s disease.</p>\n<p>Symptoms of schizophrenia can be classified as <strong>positive</strong> or <strong>negative.</strong></p>\n<p>Anything&nbsp;abnormal added to a patient's life is a positive symptom and anything normal lost from a patient's life is a negative symptom.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 39-year-old man has a three-week history of speaking to himself and complains of hearing two people talking about him. On examination, he has reduced affect and impaired judgment. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Schizophrenia"
      },
      {
        "id": 2,
        "text": "Schizophreniform disorder"
      },
      {
        "id": 3,
        "text": "Brief psychotic episode"
      },
      {
        "id": 4,
        "text": "Schizoaffective disorder"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario is suggestive of&nbsp;<strong>brief psychotic episode</strong>&nbsp;(DSM-5), as the symptoms are present for<strong> less than 30 days</strong>.</p>\n<div class=\"page\" title=\"Page 95\">\n<p class=\"p1\">The diagnosis of brief psychotic disorder in DSM-5 is based on the presence of one or more of the following psychotic symptoms for a period of at least<strong> 1 day but less than 1 month:&nbsp;</strong></p>\n<ol>\n<li class=\"p1\">Delusions</li>\n<li class=\"p1\">Hallucinations</li>\n<li class=\"p1\">Thought disorder as evidenced by disorganized speech</li>\n<li class=\"p1\">Disorganized or catatonic behavior.</li>\n</ol>\n<p class=\"p1\">DSM-5 specifies that one of the first three symptoms must be present for the diagnosis to be made.</p>\n<p class=\"p1\">According to ICD-11, this is classified as acute and transient psychotic disorder, and the duration of the episode does not last for more than 3 months.</p>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A young man presented with a 2-week history of auditory hallucinations and delusions of grandiosity. His history is significant for severe depression with psychotic symptoms. However, he has been euthymic for the past month. According to DSM-5, what would be the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Schizoaffective disorder"
      },
      {
        "id": 2,
        "text": "Schizophrenia"
      },
      {
        "id": 3,
        "text": "Mood disorder with psychotic symptoms"
      },
      {
        "id": 4,
        "text": "Schizophreniform disorder"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario points toward the diagnosis of <strong>schizoaffective disorder.&nbsp;</strong></p>\n<p>DSM-5 criteria for schizoaffective disorder: &nbsp;</p>\n<div class=\"page\" title=\"Page 64\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<ul>\n<li>An uninterrupted period of illness where there is a <strong>mood episode </strong>(depression or mania)&nbsp;<strong>concurrent with psychosis </strong>(delusions, hallucinations, disorganized speech, etc.)</li>\n<li><strong>Delusions </strong>or<strong> hallucinations</strong> (psychotic symptoms) for <strong>at least two weeks</strong> in the <strong>absence</strong> of a <strong>major depressive or manic episode</strong> during the lifetime course of the illness.</li>\n<li><strong>Mood symptoms</strong> present for the&nbsp;<strong>majority</strong> of total illnesses.</li>\n<li>Not due to intake of substances or another medical condition.</li>\n</ul>\n</div>\n</div>\n</div>\n</div>\n<p>Differential diagnosis:</p>\n<ul>\n<li>Major depressive or bipolar disorder with psychotic features: Psychotic symptoms occur <strong>exclusively during mood episodes</strong>.</li>\n<li>Schizophrenia: <strong>Mood</strong> symptoms are <strong>absent</strong> or present for only <strong>brief</strong> periods during the course of the illness <strong>dominated by psychotic symptoms</strong>.</li>\n</ul>\n<p>Note: According to<strong> DSM-5 guidelines</strong>, for a definitive <strong>diagnosis of schizoaffective disorder</strong>, there have to be <strong>two psychotic episodes</strong>. One of the psychotic episodes has to be <strong>concurrent</strong> with a severe <strong>affective</strong> (depression or manic) episode. The other psychotic episode should be for two or more weeks in the <strong>absence</strong> of <strong>affective</strong> symptoms. And affective symptoms should dominate the major part during the lifetime course of the illness.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 22-year-old man is brought with complaints of self-mutilating behaviour in which he bit off the distal end of his right ring finger and left thumb. For the past 6 months, he had decreased sleep, auditory hallucinations, social withdrawal, and disorganised behaviour. Investigations revealed neutrophilia and lymphocytosis. Serum uric acid level is 6 mg/dL. HGPRTase activity is normal. What is your diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Van-Gogh syndrome"
      },
      {
        "id": 2,
        "text": "Lesch-Nyhan syndrome"
      },
      {
        "id": 3,
        "text": "Pfropf schizophrenia"
      },
      {
        "id": 4,
        "text": "Kelley-Seegmiller syndrome"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario of&nbsp;<strong>self-mutilation</strong> in&nbsp;a patient with <strong>schizophrenia&nbsp;</strong>is known as <strong>Van Gogh syndrome.</strong></p>\n<p>Van Gogh was a Dutch painter who suffered from schizophrenia. He cut off his ear during one of his psychotic episodes.</p>\n<p><strong>Pfropf syndrome </strong>is<strong>&nbsp;</strong>schizophrenia associated with&nbsp;<strong>mental retardation</strong>.&nbsp;'Pfropf' is the German word for 'graft'. Pfrofp schizophrenia literally means schizophrenia grafted on preexisting mental retardation.</p>\n<p><strong><span class=\"ghr-condition\">Lesch-Nyhan syndrome</span></strong>&nbsp;is characterized by neurological abnormalities, self-mutilative behavior, and the overproduction of uric acid. It occurs due to a complete deficiency of HGPRTase enzyme (hypoxanthine-guanine phosphoribosyltransferase ).</p>\n<p><strong>Kelley-Seegmiller syndrome&nbsp;</strong>occurs due to<strong>&nbsp;</strong>a&nbsp;partial deficiency of HGPRTase, and is associated with hyperuricemia but no central nervous system manifestations.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following features would you not expect to see in a schizophrenic patient with catatonia?",
    "choices": [
      {
        "id": 1,
        "text": "Cataplexy"
      },
      {
        "id": 2,
        "text": "Muteness"
      },
      {
        "id": 3,
        "text": "Waxy Flexibility"
      },
      {
        "id": 4,
        "text": "Echopraxia"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Cataplexy</strong> is not a feature of catatonia. It is seen in <strong>narcolepsy.</strong> It involves the sudden loss of muscle tone,&nbsp;with full or partial consciousness.</p>\n<p>Psychomotor disturbance is an essential feature of catatonia. Some of the peculiar features of catatonia are given below:</p>\n<ol>\n<li><strong>Stupor:</strong> Absence of psychomotor activity and not actively relating to the environment.</li>\n<li><strong>Catalepsy:</strong> Passive induction of a posture held against gravity.</li>\n<li><strong>Waxy flexibility:</strong> Slight, even resistance to positioning by examiner.</li>\n<li><strong>Negativism:</strong> Opposition or no response to instructions or external stimuli.</li>\n<li><strong>Posturing:</strong> Spontaneous and active maintenance of a posture against gravity.</li>\n<li><strong>Mannerism:</strong> Odd, circumstantial caricature of normal actions.</li>\n<li><strong>Stereotypy:</strong> Repetitive, abnormally frequent, non-goal-directed movements</li>\n<li><strong>Automatic</strong> <strong>obedience-&nbsp;</strong>commands are followed automatically, irrespective of their nature.</li>\n<li><strong>Grimacing</strong></li>\n<li><strong>Ambitendency-&nbsp;</strong>due to ambivalence, opposing actions are carried out.</li>\n<li><strong>Echopraxia:</strong> Mimicking another's movement.</li>\n<li><strong>Echolalia:</strong> Mimicking another's speech.</li>\n<li><strong>Mutism:</strong> Very little or no verbal response to instructions or external stimuli.</li>\n<li><strong>Verbigeration-</strong>&nbsp;incomprehensible speech.</li>\n</ol>\n<p>Catatonia is a feature of, but <strong>not exclusive</strong> to,&nbsp;<strong>schizophrenia.</strong> It is more common in<strong> psychotic mood disorders</strong> and in patients with <strong>brain injury</strong> and <strong>encephalopathies.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient voluntarily gets himself in the posture as shown and is not changing it. What is it called?",
    "choices": [
      {
        "id": 1,
        "text": "Cataplexy"
      },
      {
        "id": 2,
        "text": "Posturing"
      },
      {
        "id": 3,
        "text": "Negativism"
      },
      {
        "id": 4,
        "text": "Waxy flexibility"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The finding shown in the above image is called <strong>posturing.&nbsp;</strong>It is the&nbsp;spontaneous and <strong>active</strong> maintenance of a posture <strong>against gravity</strong>.&nbsp;</p>\n<p><strong>Catalepsy</strong> is a <strong>passive </strong>induction of posture held against gravity.</p>\n<p>Option A:&nbsp;<strong>Cataplexy</strong>&nbsp;is a sudden, brief <strong>loss of voluntary muscle tone</strong> triggered by strong emotions such as laughter. The condition is most commonly associated with narcolepsy.</p>\n<p>Option C: <strong>Negativism</strong> is verbal or nonverbal opposition or resistance to outside suggestions and advice. Here, the <strong>patient resists</strong> any effort to be moved or does the opposite of what is asked.</p>\n<p>Option D: <strong>Waxy flexibility</strong> is a condition in which a person maintains the body position into which they are placed (<strong>passive</strong> movement). <strong>Slight resistance</strong> is felt while moving the limbs.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/1ab52d2211e94b309240c6939d2dd358.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A schizophrenic patient was started on an antipsychotic drug that decreased his hallucinations significantly. This effect is due to its action on which dopaminergic pathway?",
    "choices": [
      {
        "id": 1,
        "text": "Mesocortical"
      },
      {
        "id": 2,
        "text": "Tuberoinfundibular"
      },
      {
        "id": 3,
        "text": "Nigrostriatal"
      },
      {
        "id": 4,
        "text": "Mesolimbic"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Antipsychotic drugs act on the <strong>mesolimbic pathway</strong> to reduce <strong>positive symptoms</strong> of schizophrenia such as hallucinations and delusions.</p>\n<p>\u00a0</p>\n<p>Classification of antipsychotic drugs:</p>\n<table style=\"width: 412px; height: 532px;\">\n<tbody>\n<tr>\n<td style=\"width: 93px;\"><span style=\"font-size: 10pt;\"><strong>Property</strong></span></td>\n<td style=\"width: 131.234375px;\">\n<p><span style=\"font-size: 10pt;\"><strong>First generation\u00a0 </strong>(Typical)</span></p>\n</td>\n<td style=\"width: 179.765625px;\"><span style=\"font-size: 10pt;\"><strong>Second generation</strong> (Atypical)</span></td>\n</tr>\n<tr>\n<td style=\"width: 93px;\"><span style=\"font-size: 10pt;\">D<sub>2</sub> receptor</span></td>\n<td style=\"width: 131.234375px;\"><span style=\"font-size: 10pt;\">Preferentially blocked</span></td>\n<td style=\"width: 179.765625px;\"><span style=\"font-size: 10pt;\">Selectively blocked</span></td>\n</tr>\n<tr>\n<td style=\"width: 93px;\"><span style=\"font-size: 10pt;\">5HT<sub>2A</sub> antagonism</span></td>\n<td style=\"width: 131.234375px;\"><span style=\"font-size: 10pt;\">Low\u00a0</span></td>\n<td style=\"width: 179.765625px;\"><span style=\"font-size: 10pt;\">High</span></td>\n</tr>\n<tr>\n<td style=\"width: 93px;\"><span style=\"font-size: 10pt;\">Pathways involved</span></td>\n<td style=\"width: 131.234375px;\">\n<p><span style=\"font-size: 10pt;\">Mesocortical, mesolimbic, nigrostriatal, tuberoinfundibular,\u00a0CTZ</span></p>\n</td>\n<td style=\"width: 179.765625px;\"><span style=\"font-size: 10pt;\">Mostly mesolimbic and mesocortical</span></td>\n</tr>\n<tr>\n<td style=\"width: 93px;\"><span style=\"font-size: 10pt;\">Drugs</span></td>\n<td style=\"width: 131.234375px;\">\n<p><span style=\"font-size: 10pt;\">Haloperidol</span></p>\n<p><span style=\"font-size: 10pt;\">Fluphenazine</span></p>\n<p><span style=\"font-size: 10pt;\">Chlorpromazine</span></p>\n<p><span style=\"font-size: 10pt;\">Thioridazine (least D2 blocking activity among typical agents, markedly anticholinergic)</span></p>\n</td>\n<td style=\"width: 179.765625px;\">\n<p><span style=\"font-size: 10pt;\">Risperidone</span></p>\n<p><span style=\"font-size: 10pt;\">Sertindole</span></p>\n<p><span style=\"font-size: 10pt;\">Quetiapine</span></p>\n<p><span style=\"font-size: 10pt;\">Clozapine</span></p>\n<p><span style=\"font-size: 10pt;\">Aripiprazole (partial\u00a0D<sub>2</sub>\u00a0agonist)</span></p>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A psychotic patient developed voluntary purposeless movements and was once observed to be standing still for hours with waxy flexibility and negativism. What is the appropriate medical management?",
    "choices": [
      {
        "id": 1,
        "text": "Haloperidol"
      },
      {
        "id": 2,
        "text": "Lorazepam"
      },
      {
        "id": 3,
        "text": "Clonidine"
      },
      {
        "id": 4,
        "text": "Propanolol"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The clinical features are suggestive of a <strong>catatonic disorder</strong>. Benzodiazepines\u00a0such as <strong>lorazepam</strong> are effective in the treatment of catatonia.</p>\n<p><strong>Catatonia </strong>is a syndrome characterized by striking behav\u00adioral abnormalities such as motoric immobility or excite\u00adment, negativism, or echolalia (mimicry of speech), or echopraxia (mimicry of movement).</p>\n<p>The clinical picture may include <strong>three or more of the following features:</strong></p>\n<ol>\n<li><strong>Stupor:</strong> Absence of psychomotor activity and not actively relating to the environment.</li>\n<li><strong>Catalepsy:</strong> Passive induction of a posture held against gravity.</li>\n<li><strong>Waxy flexibility:</strong> Slight, even resistance to positioning by examiner.</li>\n<li><strong>Negativism:</strong> Opposition or no response to instructions or external stimuli.</li>\n<li><strong>Posturing:</strong> Spontaneous and active maintenance of a posture against gravity.</li>\n<li><strong>Mannerism:</strong> Odd, circumstantial caricature of normal actions.</li>\n<li><strong>Stereotypy:</strong> Repetitive, abnormally frequent, non-goal-directed movements</li>\n<li><strong>Automatic</strong> <strong>obedience: </strong>Commands are followed automatically, irrespective of their nature.</li>\n<li><strong>Grimacing</strong></li>\n<li><strong>Ambitendency:\u00a0</strong>Due to ambivalence, opposing actions are carried out.</li>\n<li><strong>Echopraxia:</strong>\u00a0Mimicking another's movement.</li>\n<li><strong>Echolalia:</strong>\u00a0Mimicking another's speech.</li>\n<li><strong>Mutism:</strong> Very little or no verbal response to instructions or external stimuli.</li>\n<li><strong>Verbigeration:</strong>\u00a0Incomprehensible speech.</li>\n</ol>\n<p>Catatonic disorder may occur due to:</p>\n<ul>\n<li>Advanced mood or psychotic illnesses</li>\n<li>Neurologi\u00adcal disorders (e.g., nonconvulsive status epilepticus, and head trauma)</li>\n<li>Infections (e.g., encephalitis)</li>\n<li>Metabolic disturbances (e.g., hepatic encephalopathy, hyponatremia, and hypercalcemia)</li>\n<li>Drugs induced- like corticoste\u00adroids, immunosuppressants, and antipsychotics (i.e., neurolep\u00adtic) agents.</li>\n</ul>\n<p><strong>Management:\u00a0</strong>The primary treatment includes:</p>\n<ul>\n<li>Identifying and treating underlying medical or pharmacological causes. Any offending substances should be removed.</li>\n<li><strong>Benzodiazepines,</strong> especially, lorazepam, are effective in improving the symptoms.</li>\n<li><strong>Electroconvulsive therapy</strong> is the definitive treatment in cases of life-threatening catatonia (if the patient is unable to eat) or if the patient has developed malignant catatonia.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A man diagnosed with schizophrenia was on chlorpromazine and olanzapine for the past 6 months. However, he is still symptomatic. What is the next line of management?",
    "choices": [
      {
        "id": 1,
        "text": "Haloperidol depot"
      },
      {
        "id": 2,
        "text": "Aripiprazole"
      },
      {
        "id": 3,
        "text": "Risperidone depot"
      },
      {
        "id": 4,
        "text": "Clozapine"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Clozapine</strong>&nbsp;is the drug of choice in <strong>treatment-resistant&nbsp;schizophrenia</strong> and&nbsp;schizophrenia with persistent suicidality.</p>\n<p>Treatment-resistant schizophrenia is the lack of response to two different antipsychotics given at adequate dosages for an adequate duration of <strong>4-6 weeks</strong>.</p>\n<p>If patients demonstrate even a mild amount of improvement during this period, it may be reasonable to wait before changing a medication, since patients may improve at a <strong>steady rate for 3 to 6 months</strong>.</p>\n<p>Here, the patient&rsquo;s medication history indicates a poor response to 2 antipsychotic trials, hence clozapine is indicated.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient diagnosed with schizophrenia was started on risperidone. After taking the medication last night, the patient rushes to OPD today with complaints of upwards rolling of his eyes. What is the management of the condition?",
    "choices": [
      {
        "id": 1,
        "text": "Lorazepam"
      },
      {
        "id": 2,
        "text": "Promethazine"
      },
      {
        "id": 3,
        "text": "Olanzapine"
      },
      {
        "id": 4,
        "text": "Stop antipsychotic"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario is suggestive of\u00a0<strong>oculogyric crisis </strong>and\u00a0<strong>promethazine</strong> is used for the management.</p>\n<p>Oculogyric crisis refers to the\u00a0<strong>s</strong><strong>pasm of the extraocular muscles</strong>, usually\u00a0causing <strong>upward</strong> and outward deviation of the eyes. It is a severe form of <strong>acute dystonia</strong>, an\u00a0<strong>extrapyramidal side effect</strong> of antipsychotics like risperidone. It can be\u00a0treated by drugs with antimuscarinic activities like promethazine.</p>\n<p><strong>Dystonia</strong>\u00a0is\u00a0<strong>a</strong><strong>cute\u00a0</strong>in onset and occurs within\u00a0<strong>1-5 days</strong>\u00a0of starting treatment. It is more common in the\u00a0<strong>younger</strong>\u00a0population. The proposed mechanism of action is\u00a0<strong>D2 blockade</strong>\u00a0in the\u00a0nigrostriatal pathway.\u00a0There is typical involvement of\u00a0<strong>head and neck</strong>\u00a0muscles and presents in a variety of forms, such as\u00a0<strong>torticollis</strong>,\u00a0trismus,\u00a0mouth opening\u00a0dystonia,\u00a0<strong>grimacing</strong>,\u00a0dysarthria<strong>,</strong>\u00a0<strong>oculogyric crisis</strong>,\u00a0blepharospasm, and\u00a0<strong>swallowing difficulties</strong>.</p>\n<p>Risperidone is an atypical antipsychotic with <strong>D2 blocking</strong> but strong <strong>5HT2 antagonistic</strong> activity.\u00a0Its main\u00a0side effects\u00a0include weight gain, hyperglycemia,\u00a0<strong>hyperprolactinemia</strong>, dyslipidemia, fatigue, etc. At low doses, extrapyramidal side effects are less, but can be significant in higher doses.\u00a0<strong>Extrapyramidal side effects</strong> include;</p>\n<ul>\n<li><strong>Parkinsonism</strong>: Features are bradykinesia, rigidity, variable tremor, masked facies, and shuffling gait.</li>\n<li><strong>Acute dystonia</strong>: Which causes spasms of muscles of the tongue, face, <strong>eyes</strong>, neck, back, etc.</li>\n<li><strong>Neuroleptic malignant syndrome:</strong> Extreme rigidity, fever, unstable blood pressure,myoglobinemia, etc.\u00a0</li>\n<li><strong>Rabbit syndrome: </strong>Perioral tremors occur as a delayed variant of parkinsonism.<strong>\u00a0</strong></li>\n</ul>\n<p>Other options:</p>\n<p>Option A: <strong>Lorazepam</strong>\u00a0is a benzodiazepine. Its adverse effects include <strong>sedation, light-headedness, confusional state, weight gain,</strong> etc.</p>\n<p>Option C: <strong>Olanzapine\u00a0</strong>is also an atypical antipsychotic. Its adverse effects are d<strong>ry mouth, constipation, weight gain, impaired glucose tolerance</strong> etc.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the major cause of death in schizophrenia?",
    "choices": [
      {
        "id": 1,
        "text": "Infection"
      },
      {
        "id": 2,
        "text": "Suicide"
      },
      {
        "id": 3,
        "text": "Drug reactions"
      },
      {
        "id": 4,
        "text": "Homicide"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>A major cause of death in schizophrenia is\u00a0<strong>suicide</strong>.</p>\n<p>The <strong>leading causes of premature death</strong> among patients with <strong>schizophrenia</strong> at present are:</p>\n<ul>\n<li>Suicide</li>\n<li>Cardiovascular disease</li>\n<li>Accidents</li>\n<li>Common physical diseases.</li>\n</ul>\n<p>In the\u00a0past, the excess mortality among individuals with schizophrenia was mainly due to\u00a0communicable diseases\u00a0such as tuberculosis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following patients with schizophrenia has the best prognosis?",
    "choices": [
      {
        "id": 1,
        "text": "A 30-year-old with stupor, negativism, rigidity, excitement, or posturing"
      },
      {
        "id": 2,
        "text": "A 20-year-old with disorganised thinking, flat affect with inappropriate emotions"
      },
      {
        "id": 3,
        "text": "A 35-year-old  with hallucinations, delusions of persecution and grandeur"
      },
      {
        "id": 4,
        "text": "A 25-year-old with insidious onset of negative symptoms without any hallucinations"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Patient with stupor, negativism, rigidity, excitement, or posturing suggests <strong>catatonic</strong>&nbsp;<strong>schizophrenia.</strong> It has the <strong>best prognosis</strong> among all types of schizophrenia.</p>\n<p><strong>Simple</strong> schizophrenia has the <strong>worst</strong> prognosis.</p>\n<p>Types of schizophrenia:</p>\n<p><strong>Hebephrenic schizophrenia (disorganized)</strong></p>\n<ul>\n<li>Early-onset</li>\n<li><strong>Disorganized behavior and thoughts</strong>, contact with reality is poor</li>\n<li class=\"p1\">Social behavior and their <strong>emotional responses</strong> are <strong>inappropriate</strong></li>\n<li>Bad prognosis</li>\n<li>Term coined by <strong>Hecker</strong></li>\n</ul>\n<p><strong>Paranoid schizophrenia:</strong></p>\n<ul>\n<li>Most common&nbsp;type.</li>\n<li>Usual onset in 3<sup>rd</sup>decade</li>\n<li>Characterized by <strong>delusions</strong> <strong>of persecution, grandeur</strong>, and control, etc</li>\n<li>Can be associated with <strong>hallucination</strong></li>\n</ul>\n<p><strong>Catatonic schizophrenia:</strong></p>\n<ul>\n<li>Marked disturbance in motor function</li>\n<li class=\"p1\">May involve <strong>stupor, negativism, rigidity, excitement, or posturing</strong></li>\n<li class=\"p1\">The alteration between extremes of excitement and stupor</li>\n<li>Best prognosis</li>\n<li>Term coined by <strong>Kahlbaum</strong></li>\n</ul>\n<p><strong>Simple schizophrenia:</strong></p>\n<ul>\n<li>The primary symptom is withdrawal from social and work-related situations</li>\n<li>Characterized by a gradual, <strong>insidious </strong>loss of drive and ambition</li>\n<li><strong>Do not experience</strong> persistent <strong>hallucinations</strong> or <strong>delusions</strong></li>\n<li class=\"p1\"><strong>Poor prognosis</strong> (simple &gt; hebephrenic)</li>\n</ul>\n<p class=\"p1\">These subtypes were dropped in DSM V. In ICD-11, they are classified under the 'schizophrenia, episode unspecified' category, but may be removed.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not a good prognostic factor in schizophrenia?",
    "choices": [
      {
        "id": 1,
        "text": "Positive symptoms"
      },
      {
        "id": 2,
        "text": "Late age of onset"
      },
      {
        "id": 3,
        "text": "Insidious onset of symptoms"
      },
      {
        "id": 4,
        "text": "Associated with depression"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Insidious onset</strong> of symptoms is a<strong> poor prognostic factor</strong> of schizophrenia.</p>\n<p>Prognostic factors of Schizophrenia:&nbsp;</p>\n<table>\n<tbody>\n<tr>\n<td><strong>Good Prognostic factors&nbsp;</strong></td>\n<td><strong>Poor prognostic factors</strong></td>\n</tr>\n<tr>\n<td>Acute onset</td>\n<td>Insidious onset</td>\n</tr>\n<tr>\n<td>Late-onset</td>\n<td>Early-onset</td>\n</tr>\n<tr>\n<td>Presence of a stressor</td>\n<td>Absence of a stressor</td>\n</tr>\n<tr>\n<td>Short duration &lt; 6 months</td>\n<td>Duration &gt;2 years</td>\n</tr>\n<tr>\n<td>Presence of depression</td>\n<td>No depression</td>\n</tr>\n<tr>\n<td>Positive symptoms</td>\n<td>Negative symptoms</td>\n</tr>\n<tr>\n<td>Family history of mood disorder</td>\n<td>Family history of schizophrenia</td>\n</tr>\n<tr>\n<td>Married, female sex</td>\n<td>Single, male sex</td>\n</tr>\n<tr>\n<td>Catatonic schizophrenia</td>\n<td>Hebephrenic schizophrenia</td>\n</tr>\n<tr>\n<td>Type 1 schizophrenia</td>\n<td>Type 2 schizophrenia</td>\n</tr>\n<tr>\n<td>&nbsp;</td>\n<td>No remissions in 3 years &nbsp;</td>\n</tr>\n<tr>\n<td>&nbsp;</td>\n<td>History of perinatal trauma</td>\n</tr>\n<tr>\n<td>&nbsp;</td>\n<td>History of assaultiveness</td>\n</tr>\n</tbody>\n</table>\n<p><strong>T.J.Crow</strong>&nbsp;classified schizophrenia into two separate types&nbsp; :</p>\n<table>\n<tbody>\n<tr>\n<td><strong>Type 1</strong></td>\n<td><strong>Type 2</strong></td>\n</tr>\n<tr>\n<td>Positive symptoms present&nbsp;</td>\n<td>Negative symptoms present</td>\n</tr>\n<tr>\n<td>More responsive to treatment</td>\n<td>Less responsive to treatment</td>\n</tr>\n<tr>\n<td>No demonstrable neuropathology</td>\n<td>Demonstrable neuropathology (CT/MRI)</td>\n</tr>\n<tr>\n<td>Good prognosis</td>\n<td>Poor prognosis</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 19-year-old woman with schizoaffective disorder and was prescribed a drug. Soon after initiation of therapy, she developed galactorrhea and dysmenorrhea, and her prolactin level was 171.6ng/mL. Which drug was most likely prescribed?",
    "choices": [
      {
        "id": 1,
        "text": "Ziprasidone"
      },
      {
        "id": 2,
        "text": "Olanzapine"
      },
      {
        "id": 3,
        "text": "Risperidone"
      },
      {
        "id": 4,
        "text": "Clozapine"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Risperidone</strong> causes the maximum rise in prolactin levels<strong>&nbsp;</strong>and has the <strong>highest potential</strong> to cause <strong>hyperprolactinemia</strong> among the <strong>atypical antipsychotics.</strong></p>\n<div>Risperidone is an antagonist of <strong>5-HT<sub>2A</sub></strong> and<strong> D2</strong> receptors. The combined use of risperidone and selective serotonin reuptake inhibitors (SSRI) can also result in a significant elevation of prolactin with galactorrhea and breast enlargement.</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 50-year-old man with type 2 diabetes was brought to the OPD by his wife after he began talking about aliens who were trying to steal his soul. He often stops talking mid-sentence and frequently scans the room for aliens. His wife reported he started expressing these ideas a few months ago, but they have become more severe and he had become isolated from his peers. Which of the following drugs should not be used in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Olanzapine"
      },
      {
        "id": 2,
        "text": "Risperidone"
      },
      {
        "id": 3,
        "text": "Quetiapine"
      },
      {
        "id": 4,
        "text": "Aripriprazole"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>This clinical scenario is suggestive of schizophrenia and given the patient's history of<strong> type 2 diabetes, olanzapine</strong> should not be prescribed as it has the <strong>highest potential</strong> to cause weight gain and&nbsp;<strong>metabolic syndrome. </strong></p>\n<p>Clozapine also has a high incidence of metabolic syndrome and weight gain.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A woman in her mid-twenties is on olanzapine and is very concerned about gaining weight. Which of the following is false?",
    "choices": [
      {
        "id": 1,
        "text": "In the first 3 months, her weight needs to be monitored weekly"
      },
      {
        "id": 2,
        "text": "Aripiprazole can be used as an alternative treatment if significant weight gain occurs"
      },
      {
        "id": 3,
        "text": "Behavioural and lifestyle modifications are not useful in reducing antipsychotic induced weight gain"
      },
      {
        "id": 4,
        "text": "Metformin can be used to moderate antipsychotic induced weight gain"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Behavioral and lifestyle modifications are very useful in reducing antipsychotic induced weight gain.</p>\n<p>Weight gain is monitored as follows (include waist size and BMI if possible):</p>\n<ul>\n<li>Weekly measurement of weight for the first 3 months</li>\n<li>Then 3 monthly for the first year</li>\n<li>Yearly measurement thereafter</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A schizophrenic patient was started on an antipsychotic drug that decreased his hallucinations significantly. Three days after starting the medication, he developed torticollis and orofacio-lingual movements. What is your diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Akathisia"
      },
      {
        "id": 2,
        "text": "Acute muscular dystonia"
      },
      {
        "id": 3,
        "text": "Tardive dyskinesia"
      },
      {
        "id": 4,
        "text": "Rabbit syndrome"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The patient has developed<strong> acute muscular dystonia</strong>&nbsp;(spasm of muscles of tongue, face, neck, and back) which is an extrapyramidal side effect of haloperidol. This occurs within 1-5 days of drug intake.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient on fluphenazine feels increasingly restless, agitated, and dysphoric and has a severe urge to move for the past 1 week. Which of the following can not be used in his management?",
    "choices": [
      {
        "id": 1,
        "text": "Ropinirole"
      },
      {
        "id": 2,
        "text": "Propanolol"
      },
      {
        "id": 3,
        "text": "Diphenhydramine"
      },
      {
        "id": 4,
        "text": "Benztropine"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The patient has developed <strong>akathisia</strong>, which is a side effect of antipsychotic medications. It is <strong>treated</strong> with <strong>propranolol,</strong> <strong>diphenhydramine</strong> (Benadryl), and <strong>benztropine</strong>. Ropinirole is not used for treatment.</p>\n<p><strong>Ropinirole</strong> is used in the treatment of <strong>restless leg syndrome</strong>, which resembles akathisia without a history of antipsychotic medication intake.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A schizophrenic patient is rushed to the casualty after attempting suicide. Which of the following drugs would benefit her the most?",
    "choices": [
      {
        "id": 1,
        "text": "Quetiapine"
      },
      {
        "id": 2,
        "text": "Olanzapine"
      },
      {
        "id": 3,
        "text": "Risperidone"
      },
      {
        "id": 4,
        "text": "Clozapine"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Clozapine</strong> is the only drug amongst the atypical antipsychotics that has been approved to be used for a <strong>schizophrenic</strong> patient with an <strong>increased risk</strong> of <strong>suicide.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A young man was brought to the OPD by his best friend. He was apparently normal half a year back after which he has become increasingly isolated, lost his job, and shouts loudly sometimes trying to get rid of the voices in his head.  He was started on olanzapine after a diagnosis of schizophrenia was made. What is the minimum duration he should continue the drug for?",
    "choices": [
      {
        "id": 1,
        "text": "8 months"
      },
      {
        "id": 2,
        "text": "2 years"
      },
      {
        "id": 3,
        "text": "18 months"
      },
      {
        "id": 4,
        "text": "6 months"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>After the <strong>initial diagnosis</strong> of schizophrenia,<strong>&nbsp;</strong>antipsychotics should be continued for at least<strong>&nbsp;2 years</strong>.</p>\n<p>If there is a&nbsp;<strong>history of relapse</strong>, treatment should be continued for at least for <strong>5 years.</strong> If there are&nbsp;<strong>multiple relapses,</strong>&nbsp;the patient is treated <strong>indefinitely.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '06 Schizophrenia';
        let hierarchy = ["Marrow", "qBank", "Psychiatry"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>