<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>11 Carcinoma Breast - Treatment - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Surgery
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">29</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "What procedure is depicted in the image?",
    "choices": [
      {
        "id": 1,
        "text": "Brachytherapy"
      },
      {
        "id": 2,
        "text": "Lateral pectoral block"
      },
      {
        "id": 3,
        "text": "USG-guided biopsy"
      },
      {
        "id": 4,
        "text": "Sentinel lymph node biopsy"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The image shows a <strong>sentinel lymph node biopsy </strong>using a gamma camera.</p>\n<p>The sentinel lymph node is the <strong>first draining lymph node</strong>.&nbsp;SLNB was first described in <strong>penile cancer</strong> by <strong>Cabana</strong>.&nbsp;Sentinel lymph node biopsy is only done&nbsp;on <strong>node-negative tumors</strong>.</p>\n<p><strong>Methylene blue dye</strong> or radioisotope i.e.,<strong>&nbsp;technetium-labeled albumin</strong> is injected into breast tissue (or subdermal tissue) at the site of the primary tumor or at the subareolar position. The sentinel node is identified as a <strong>blue node</strong> or as a <strong>radioactive node</strong> (using a gamma camera).&nbsp;The frozen section biopsy is sent to the pathologist for identification of cancer cells. If the <strong>biopsy is positive</strong> for cancer cells, then <strong>axillary dissection</strong> is simultaneously performed.&nbsp;</p>\n<p>Note: The combination of blue dye and technetium-labeled colloid has been reported to improve the detection of sentinel lymph nodes.&nbsp;Newer techniques involve the use of a fluorescent or magnetic tracer instead of the radiolabelled dye.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/1080a0881c734743b8e4dce7f556b55a.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/bcefb7f9537e4de286250de486df9ef1x1280x3063.JPEG"
    ]
  },
  {
    "text": "Which of the following is true regarding sentinel lymph node biopsy in a patient with a T2 N1 M0 breast tumour?",
    "choices": [
      {
        "id": 1,
        "text": "If biopsy is positive, then axillary dissection is not done"
      },
      {
        "id": 2,
        "text": "If biopsy is negative, then axillary dissection is done"
      },
      {
        "id": 3,
        "text": "If biopsy is positive then tumour free margin should be > 2 cm"
      },
      {
        "id": 4,
        "text": "It is not indicated"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Sentinel lymph node biopsy is only done in&nbsp;<strong>node-negative</strong> tumors. It is<strong> not</strong> done in<strong> N1</strong> stage tumors.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 40-year-old woman presents with a lump in her right breast. On examination, a 3 cm palpable mass is felt in the right upper quadrant of the right breast. A mammogram is suggestive of a malignant lesion. Biopsy confirmed invasive ductal carcinoma with no nodal involvement. How will you manage this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Modified radical mastectomy"
      },
      {
        "id": 2,
        "text": "Adjuvant chemotherapy with mastectomy"
      },
      {
        "id": 3,
        "text": "Breast conservation therapy with adjuvant radiotherapy"
      },
      {
        "id": 4,
        "text": "Modified radical mastectomy with adjuvant radiotherapy"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>This patient has <strong>stage</strong>&nbsp;<strong>T2 breast carcinoma</strong>. These patients are managed with <strong>breast conservation therapy with adjuvant radiotherapy.</strong></p>\n<p><strong>Indications</strong> of breast conservation surgery <strong>(BCS):</strong></p>\n<ol>\n<li style=\"font-weight: 400;\" aria-level=\"1\">DCIS/Tis tumors</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">T1-2 tumors</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">No contraindication for adjuvant radiotherapy</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Excision with clear margins is possible</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Who does not want a mastectomy</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Locally advanced tumors with excellent response to neoadjuvant chemotherapy.</li>\n</ol>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Breast conservative surgery can be performed in which of the following patients with breast carcinoma?",
    "choices": [
      {
        "id": 1,
        "text": "2, 3, 4 and 5"
      },
      {
        "id": 2,
        "text": "1, 3 and 4"
      },
      {
        "id": 3,
        "text": "2 and 3"
      },
      {
        "id": 4,
        "text": "Only 1"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Breast conservation surgery can be done in a post-partum woman.</p>\n<p>Breast cancer diagnosed during the<strong> second or third trimester </strong>can be managed with<strong><strong>\u00a0breast conservation surgery </strong></strong>followed by <strong><strong>adjuvant chemotherapy.\u00a0</strong></strong></p>\n<p>For breast cancer diagnosed <strong>late</strong> in the <strong>third trimester,</strong>\u00a0breast conservation surgery can be performed, deferring<strong> breast irradiation until after delivery.</strong></p>\n<div>Breast cancer diagnosed during the <strong>first trimester</strong> should be treated with <strong>mastectomy</strong>. Breast conservation surgery is contraindicated in the first\u00a0trimester since post-operative radiotherapy cannot be deferred for a long time and chemotherapy is contraindicated in the first trimester.</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient with early breast carcinoma of stage T3 N0 M0 does not want to undergo mastectomy. What is the next best treatment of choice in her case?",
    "choices": [
      {
        "id": 1,
        "text": "Breast conservation surgery followed by\u00a0radiation therapy"
      },
      {
        "id": 2,
        "text": "Chemotherapy alone since mastectomy is the only option"
      },
      {
        "id": 3,
        "text": "Neoadjuvant chemotherapy followed by breast conservation surgery"
      },
      {
        "id": 4,
        "text": "Mastectomy only since it is a large operable tumour"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>According to the clinical scenario, <strong>neoadjuvant chemotherapy</strong> followed by breast conservation surgery (<strong>BCS</strong>) is the next best treatment.</p>\n<p>Stage <strong>T3 N0 M0</strong> tumors are lesions of size &gt;5 cm and are considered as <strong>large operable breast cancer (LOBC).</strong> The best management for such tumors is<strong> mastectomy</strong>.</p>\n<p>In case the patient is <strong>not willing</strong> for <strong>mastectomy,</strong> the next best treatment is&nbsp;neoadjuvant chemotherapy&nbsp;to shrink the tumor, followed by&nbsp;breast conservation surgery.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You are assisting in a modified radical mastectomy. Which of the following steps will not be done by the operating surgeon during this procedure?",
    "choices": [
      {
        "id": 1,
        "text": "Removal of pectoralis major muscle"
      },
      {
        "id": 2,
        "text": "Level 2 axillary lymph nodes dissection"
      },
      {
        "id": 3,
        "text": "Removal of nipple-areola complex"
      },
      {
        "id": 4,
        "text": "Removal of pectoral fascia"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Pectoralis major is not removed in modified radical mastectomy.</p>\n<p><strong>Structures removed in modified radical mastectomy</strong>:</p>\n<ol>\n<li>Whole breast tissue</li>\n<li>The skin over the breast tissue</li>\n<li>Nipple-areola complex</li>\n<li>Pectoral fascia</li>\n<li>Levels I, II, &plusmn; III axillary lymph nodes</li>\n</ol>\n<p>The pectoralis <strong>minor</strong> muscle is either cut (<strong>Patey's, Scanlon's</strong> modification) or retracted (<strong>Auchincloss</strong>).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In patients with which of the following features of tumor involvement should you not perform radical mastectomy?",
    "choices": [
      {
        "id": 1,
        "text": "Pectoralis major involvement"
      },
      {
        "id": 2,
        "text": "Distant metastasis"
      },
      {
        "id": 3,
        "text": "Axillary lymph node involvement"
      },
      {
        "id": 4,
        "text": "Inter pectoral lymph node involvement"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Distant metastasis is a <strong>contraindication</strong> for radical mastectomy.</p>\n<p class=\"p1\">Excision of the breast,&nbsp;the pectoralis major and minor muscles, and all axillary lymph nodes&nbsp;constitute&nbsp;radical mastectomy. It is seldom performed given that it causes&nbsp;<strong>substantial morbidity</strong> due to shoulder joint restriction, pain,&nbsp;significant upper limb lymphedema, and chest wall deformity, with <strong>no survival</strong> advantage when compared to less radical&nbsp;surgery. In the case of distant metastases,&nbsp; less radical surgery is of<strong>&nbsp;no benefit</strong>&nbsp;either.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following structures will not be removed while performing radical mastectomy in patients with breast carcinoma?",
    "choices": [
      {
        "id": 1,
        "text": "Pectoralis major"
      },
      {
        "id": 2,
        "text": "Pectoralis minor"
      },
      {
        "id": 3,
        "text": "Axillary lymph nodes"
      },
      {
        "id": 4,
        "text": "Supraclavicular lymph nodes"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Supraclavicular lymph nodes are not removed in radical mastectomy.</p>\n<p>In&nbsp;<strong>Halsted radical mastectomy,&nbsp;</strong>the following structures are&nbsp;removed:</p>\n<ul>\n<li>All breast tissue and skin</li>\n<li>Nipple-areolar complex</li>\n<li><strong>Pectoralis major</strong> and pectoralis minor muscles</li>\n<li>Level I, II, and III axillary lymph nodes.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 50-year-old patient underwent a modified radical mastectomy for breast cancer. A drain was inserted at the site of the surgery. When can the drain be removed?",
    "choices": [
      {
        "id": 1,
        "text": "24 hr output <100 cc"
      },
      {
        "id": 2,
        "text": "Output <100 cc for 2 consecutive days"
      },
      {
        "id": 3,
        "text": "24 hr output <30-40 cc"
      },
      {
        "id": 4,
        "text": "Output <30-40 cc for 2 consecutive days"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The <strong>drain</strong> after <strong>mastectomy</strong> is <strong>removed</strong> when the <strong>output</strong>&nbsp;is <strong>&lt;30-40 cc for 2 consecutive days.&nbsp;</strong></p>\n<p>The closed system suction drains are put in to <strong>prevent</strong> the formation of <strong>seroma.&nbsp;</strong>It&nbsp;is the <strong>most common complication</strong> of mastectomy and axillary lymph node dissection.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The following image shows the boundaries of axillary lymph node dissection. The inferior boundary marked as \u2018A\u2019 denotes _____.",
    "choices": [
      {
        "id": 1,
        "text": "Axillary vein"
      },
      {
        "id": 2,
        "text": "Thoracodorsal pedicle"
      },
      {
        "id": 3,
        "text": "Angular vein"
      },
      {
        "id": 4,
        "text": "Costococlavicular ligament"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The space of axillary lymph node dissection is <strong>inferiorly</strong>&nbsp;bounded by the <strong>angular vein</strong> (marked as &lsquo;A&rsquo;).</p>\n<p><strong>Boundaries</strong> of axillary lymph node dissection (ALND):</p>\n<ul>\n<li>Superior - Axillary vein</li>\n<li>Lateral - Thoracodorsal pedicle</li>\n<li>Medial - Costoclavicular ligament (Halstead ligament)</li>\n<li>Inferior - Angular vein &nbsp; &nbsp;</li>\n</ul>\n<p><strong>Indications</strong> for ALND:</p>\n<ol>\n<li>Locally advanced (T4a, b, c) or inflammatory breast cancer</li>\n<li>Metastatic disease in axillary lymph node(s) proven by needle biopsy, clinically palpable or nonpalpable nodes which are abnormal on imaging</li>\n</ol>\n<p><strong>Structures preserved</strong> during ALND:</p>\n<ol>\n<li>Lateral and medial pectoral nerves</li>\n<li>Thoracodorsal pedicle</li>\n</ol>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/6205455158c644d6bfdb944379a58d04.JPEG"
    ],
    "explanation_images": [
      "https://cdn1.dailyrounds.org/uploads/f9b7d5fc60a14520a7c43badeb6fe232x639x628.JPEG"
    ]
  },
  {
    "text": "Which of the following is the most common complication of mastectomy?",
    "choices": [
      {
        "id": 1,
        "text": "Seroma"
      },
      {
        "id": 2,
        "text": "Lymphedema"
      },
      {
        "id": 3,
        "text": "Intercostobrachial nerve damage"
      },
      {
        "id": 4,
        "text": "Wound infection"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The most common complication post-mastectomy is&nbsp;the&nbsp;development of a<strong> seroma</strong>.&nbsp;</p>\n<p>Seroma is a collection of fluid in a surgically created cavity, that results from the <strong>transection</strong> of <strong>vessels and lymphatics</strong>.&nbsp;It&nbsp;presents as a localized, well-circumscribed swelling with discomfort. The fluid is clear, yellow, and viscous.</p>\n<p>Placement of&nbsp;<strong>closed suction drains</strong> that obliterate the space between the pectoralis major and skin flap is used to <strong>prevent </strong>seromas.</p>\n<p>Other complications include:</p>\n<ol>\n<li>Wound infection</li>\n<li>Skin flap breakdown or necrosis</li>\n<li>Lymphedema</li>\n<li>Hemorrhage</li>\n</ol>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "After modified radical mastectomy, a patient complained of loss of sensation over the medial aspect of the right upper arm. The nerve most likely damaged is ______.",
    "choices": [
      {
        "id": 1,
        "text": "Intercostobrachial nerve"
      },
      {
        "id": 2,
        "text": "Axillary nerve"
      },
      {
        "id": 3,
        "text": "Medial cutaneous nerve of arm"
      },
      {
        "id": 4,
        "text": "Long thoracic nerve"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Resection of the <strong>intercostobrachial nerve</strong>&nbsp;(ICBN) causes loss of sensation over the medial aspect of the upper arm. The intercostobrachial nerve is the lateral cutaneous branch of the second intercostal nerve.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b9fe4aa2edc94b96befa579f249d80c0x1280x1683.JPEG"
    ]
  },
  {
    "text": "A patient underwent surgery for breast carcinoma. She now presents with painless swelling involving the arm as shown in the image below. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Lymphedema"
      },
      {
        "id": 2,
        "text": "Lymphangiosarcoma"
      },
      {
        "id": 3,
        "text": "Venous thrombosis"
      },
      {
        "id": 4,
        "text": "Cellulitis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The generalized swelling of the left arm of the patient post-surgery for breast carcinoma is suggestive of <strong>post-mastectomy</strong>&nbsp;<strong>lymphedema.</strong></p>\n<p>Lymphoedema occurs when interstitial fluid accumulates due to defective lymphatic drainage. It is a common complication of breast cancer treatment, involving <strong>axillary lymph node dissection</strong>&nbsp;and <strong>radiotherapy.</strong><strong>&nbsp;Sentinel lymph node dissection</strong> (SLND) reduces the risk of lymphedema significantly.</p>\n<p>Clinical signs and symptoms are observed in the <strong>ipsilateral arm.</strong>&nbsp;A significant increase in limb size due to swelling is seen. Other symptoms are&nbsp;heaviness, tightness, numbness, tingling, limb fatigue, and reduced limb mobility.</p>\n<p><strong>Diagnosis</strong> is predominantly based on the clinical swelling of the arm. The girth of the affected arm &gt;2 centimetres than the normal limb,&nbsp;a 200-mL or more increase in limb volume, or a 5% or greater limb volume change are other diagnostic criteria.</p>\n<p>Management:</p>\n<ol>\n<li><strong>Limb elevation</strong>, <strong>elastic arm stockings</strong>, and<strong> pneumatic compression devices</strong> to reduce swelling.&nbsp;</li>\n<li>Using a <strong>low-pH water-based moisturizer </strong>to prevent dry skin caused by excess fluid accumulation.&nbsp;</li>\n<li><strong>Manual lymphatic drainage</strong> (MLD) by a therapist followed by <strong>simple lymphatic drainage</strong> (SLD) by the patient daily aids interstitial fluid evacuation.</li>\n<li>Surgical options include <strong>lymphaticovenular anastomosis</strong>, liposuction, and debulking.</li>\n</ol>\n<p>Other options:</p>\n<p>Option B:&nbsp; &nbsp;<strong>Stewart-Treves syndrome</strong>&nbsp;refers to <strong>lymphangiosarcoma</strong> seen in chronic <strong>long-standing</strong> lymphedema following mastectomy (more than 10 years). They present as single/multiple <strong>bluish-red</strong> skin and<strong> subcutaneous nodules.</strong> They can ulcerate and hemorrhage.</p>\n<p>Option C: <strong>Axillary venous thrombosis</strong> or <strong>Paget-Schrotter disease</strong> is seen in patients doing rigorous exercise and in weightlifters. The compression of the subclavian vein at the thoracic outlet causes <strong>p</strong><strong>ainful</strong> swelling of the arm.</p>\n<p>Option D: <strong>Cellulitis </strong>(lymphangitis) is a bacterial infection of the <strong>skin and subcutaneous tissue</strong>. It is characterized by a <strong>painful</strong> area of <strong>erythematous</strong> and <strong>edematous</strong> tissue.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/67451aee83c247989f7c4d258187fb6b.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A  patient presented with acute worsening of edema of the left hand, which was present for the past 5 years. Her surgical history was relevant for a radical mastectomy with radiation therapy for left-sided breast carcinoma. On examination, the limb appears as shown below. What is the likely diagnosis in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Teitze syndrome"
      },
      {
        "id": 2,
        "text": "Stewart-Treves syndrome"
      },
      {
        "id": 3,
        "text": "Rhabdomyosarcoma"
      },
      {
        "id": 4,
        "text": "Milroy's Disease"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The clinical scenario and image are suggestive of&nbsp;<strong>Stewart&ndash;Treves syndrome</strong>.</p>\n<p>The development of <strong>angiosarcoma</strong> after a combination of <strong>postmastectomy lymphedema</strong> and <strong>radiation therapy</strong> is known as Stewart&ndash;Treves syndrome. It can arise de-novo or in association with post-mastectomy lymphedema. It presents with <strong>acute worsening of edema</strong> with subcutaneous nodules which are hemorrhagic or ulcerative.</p>\n<p>Treatment is <strong>preoperative chemotherapy and radiotherapy</strong> followed by <strong>surgical excision</strong> (radical amputation of arm). The prognosis is poor.</p>\n<p>Option A:<strong> Tietze&nbsp;syndrome&nbsp;</strong>is an inflammatory condition characterized by chest pain and swelling of the cartilage around the ribs at the <strong>costochondral junction</strong>.&nbsp;</p>\n<p>Option C: Rhabdomyosarcoma is a rare type of cancer that affects the muscle tissue, mostly in children and adolescents.</p>\n<p>Option D:<strong> Milroy's disease</strong>&nbsp;is a&nbsp;familial disease, caused by <strong>congenital </strong>abnormalities in the&nbsp;<strong>lymphatic system</strong>. Disruption of the normal drainage of lymph leads to fluid accumulation and&nbsp;hypertrophy&nbsp;of soft tissues.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c3ae663956f8488a91132a39114d34b9.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Identify the flap shown in the image used for breast reconstruction.",
    "choices": [
      {
        "id": 1,
        "text": "Deep inferior epigastric perforator flap"
      },
      {
        "id": 2,
        "text": "Transverse rectus abdominis myocutaneous flap"
      },
      {
        "id": 3,
        "text": "Lattisimus dorsi flap"
      },
      {
        "id": 4,
        "text": "External oblique flap"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>DIEP flap, TRAM flap, and LD flap are autogenous tissues used in breast reconstruction.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c0276157df47446fbe1dcc083a295b14.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/bd753d65292d41a180d9a45f7d268338x1280x1547.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0bdd2c61a97a4c168f8f5164048f189ax1280x1041.JPEG"
    ]
  },
  {
    "text": "Which of the following is the gold standard flap used in breast reconstruction with autogenous tissue?",
    "choices": [
      {
        "id": 1,
        "text": "Deep inferior epigastric perforators flap"
      },
      {
        "id": 2,
        "text": "Latissimus dorsi musculocutaneous flap"
      },
      {
        "id": 3,
        "text": "Transverse rectus abdominis myocutaneous flap"
      },
      {
        "id": 4,
        "text": "Thoracoepigastric flap"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The <strong>gold standard </strong>in breast reconstruction with <strong>autogenous</strong> tissue is the deep inferior epigastric perforator<strong>&nbsp;(DIEP) flap</strong>.</p>\n<p>In DIEP flap, using a microvascular technique<strong>, </strong>only<strong>&nbsp;</strong>subcutaneous fat and skin are taken, and&nbsp;<strong>no muscle is removed.</strong>&nbsp;As the muscle is spared, there is<strong>&nbsp;</strong>a <strong>decreased risk of abdominal wall weakness</strong> and its associated complications.</p>\n<p>Lattismus dorsi flap (<strong>LD flap</strong>) -&nbsp;does not provide the bulk necessary and an <strong>implant</strong>&nbsp;is usually <strong>required.</strong></p>\n<p>Transverse rectus abdominis myocutaneous flap (<strong>TRAM flap</strong>):</p>\n<ul>\n<li>Skin, fat, and <strong>muscle</strong> are moved to the chest.</li>\n<li>It is the&nbsp;<strong>most commonly</strong> used flap.</li>\n<li>It provides <strong>good cosmesis</strong> and bulk. An implant is usually not required.&nbsp;</li>\n<li>Since the rectus abdominis muscle is excised in the procedure, it can lead to <strong>abdominal wall weakness</strong> and <strong>hernias</strong>.</li>\n</ul>\n<p>The easiest type of reconstruction is using a <strong>silicone gel implant </strong>under the <strong>pectoralis major</strong> muscle. Capsular contraction is a dreaded complication of silicone implants.</p>\n<p>In breast reconstruction surgeries, the timing of reconstruction<strong>&nbsp;may be immediate or delayed</strong>. Impediments to immediate reconstruction include insufficient theatre time and a lack of experienced reconstructive surgeons. In addition, if the patient is likely to need post-op radiotherapy, then a delayed reconstruction using a flap often gives better results.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following will you not add as part of the chemotherapeutic regime for a patient with breast cancer?",
    "choices": [
      {
        "id": 1,
        "text": "Only 5"
      },
      {
        "id": 2,
        "text": "1, 3 and 4"
      },
      {
        "id": 3,
        "text": "2 and 5"
      },
      {
        "id": 4,
        "text": "3, 4 and 5"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Fludarabine and vincristine are not used in chemotherapy for carcinoma breast.</p>\n<p>The present chemotherapy regimen used is <strong>ACT regimen</strong>, i.e., adriamycin, cyclophosphamide, and taxane (paclitaxel). It comprises 4 cycles of <strong>AC</strong>&nbsp;followed by 4 cycles of <strong>T.</strong></p>\n<p><strong>Earlier</strong> regimens that are less commonly used currently are as follows:</p>\n<ul>\n<li><strong>CAF</strong> &ndash; Cyclophosphamide, Adriamycin, 5-Fluorouracil</li>\n<li><strong>CMF</strong> &ndash; Cyclophosphamide, Methotrexate, 5-Fluorouracil</li>\n</ul>\n<p><strong>Indications </strong>for chemotherapy in carcinoma breast:</p>\n<ul>\n<li>Lymph nodes positive</li>\n<li>Lymph nodes negative but tumor size of &gt;1 cm</li>\n<li>Lymph nodes negative and tumor size of &gt;0.5 cm with\n<ol>\n<li>Blood vessel/Lymph vessel invasion</li>\n<li>ER/PR &ndash;ve</li>\n<li>Her-2/neu overexpression</li>\n<li>High grade</li>\n</ol>\n</li>\n<li>Triple-negative breast carcinoma</li>\n<li>High recurrence score after Oncotype Dx.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "All are aromatase inhibitors used in the treatment of breast cancer except ______.",
    "choices": [
      {
        "id": 1,
        "text": "Letrozole"
      },
      {
        "id": 2,
        "text": "Anastrozole"
      },
      {
        "id": 3,
        "text": "Exemastane"
      },
      {
        "id": 4,
        "text": "Fulvestrant"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Fulvestrant</strong> is a selective estrogen-receptor down regulator (<strong>SERD</strong>).</p>\n<p><strong>Selec&shy;tive aromatase inhibitors</strong> include:</p>\n<ul>\n<li>Anastrozole</li>\n<li>Exemestane</li>\n<li>Letrozole</li>\n</ul>\n<p>They are used for the treatment of breast cancer in <strong>postmenopausal women.&nbsp;</strong>Selec&shy;tive aromatase inhibitors block the conversion of the hormone androstenedione into estrone by <strong>inhibiting</strong><strong>&nbsp;</strong>the <strong>aromatase enzyme</strong>. This is the main mechanism of the production of estrogen in postmenopausal women.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A woman presented to the OPD with a painless lump in the left breast. Biopsy confirmed the presence of ductal carcinoma. Immunohistochemistry showed ER +ve, PR +ve, and HER2/neu -ve. Which of the following is the latest drug approved for treating this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Herceptin"
      },
      {
        "id": 2,
        "text": "Palbociclib"
      },
      {
        "id": 3,
        "text": "Buparlisib"
      },
      {
        "id": 4,
        "text": "Ipatasertib"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong> Palbociclib</strong> is the newest drug approved for <strong>metastatic</strong>, hormone receptor&ndash;positive, HER-2/neu-negative <strong>breast cancer. </strong></p>\n<p>It is used along with fulvestrant, a selective estrogen-receptor downregulator (SERD) based on the <strong>PALOMA 3 trial.&nbsp;</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the drug used for estrogen dependant breast cancer?",
    "choices": [
      {
        "id": 1,
        "text": "Estrogen"
      },
      {
        "id": 2,
        "text": "Clomiphene citrate"
      },
      {
        "id": 3,
        "text": "Tamoxifen"
      },
      {
        "id": 4,
        "text": "Adriamycin"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Tamoxifen</strong> is a selective estrogen receptor modulator <strong>(SERM)</strong> that is mainly used for<strong> estrogen receptor-positive</strong> breast cancers in <strong>pre-menopausal women</strong>.</p>\n<p>It exhibits selective agonistic and antagonistic activity for ER receptors (ER&alpha; and ER&beta;):</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Agonist activity at the uterus, bone, liver, and pituitary</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Antagonist activity in breast and blood vessels</li>\n</ul>\n<p>Uses:&nbsp;</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Part of the <strong>primary treatment</strong> regimen for estrogen receptor-positive <strong>(ER+) breast cancers</strong> in pre-menopausal women</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Adjuvant therapy </strong>after <strong>breast conservative surgery</strong> to prevent a recurrence</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Tamoxifen</strong> also is effective (a 40%&ndash;50% reduction in tumor incidence) in <strong>preventing</strong> ER+ breast cancer in <strong>women at increased risk</strong>.</li>\n</ul>\n<p>Adverse effects:&nbsp;</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Vasomotor symptoms <strong>(hot flashes) </strong>and sweating</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Endometrial cancer</strong></li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Increased risk of <strong>thromboembolic events</strong></li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Fatty liver disease</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A middle-aged woman underwent a trucut biopsy for the suspicion of malignancy on a mammogram. Microscopy showed the presence of invasive breast carcinoma. IHC staining of the tumor is given below. Which of the following drugs will you add along with chemotherapeutic agents for treating this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Tamoxifen"
      },
      {
        "id": 2,
        "text": "Tamoxifen + Trastuzumab"
      },
      {
        "id": 3,
        "text": "Fulvestrant"
      },
      {
        "id": 4,
        "text": "Palbociclib"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The adjuvant treatment modalities currently in practice include:</p>\n<ul>\n<li><strong>Endocrine treatment</strong> such as tamoxifen or ovarian suppression. It is given for patients with tumors that are hormone receptor-positive (either ER+ or PR+).</li>\n<li><strong>Anti-HER2</strong> therapy with trastuzumab (humanized monoclonal antibody). It is given for patients with tumors that are HER2 overexpressing.</li>\n<li><strong>Chemotherapy</strong> is given for hormone negative, HER2+, and ER+ tumors.</li>\n</ul>\n<p>The table below shows the summary of the adjuvant treatment approach:</p>\n<table style=\"height: 99px; width: 735px;\">\n<tbody>\n<tr>\n<td style=\"width: 204px;\">&nbsp;</td>\n<td style=\"width: 517px; text-align: center;\" colspan=\"2\"><strong>Tumor hormone receptor status (ER,PR) </strong></td>\n</tr>\n<tr>\n<td style=\"width: 204px;\"><strong>Tumor HER2/neu status</strong></td>\n<td style=\"width: 267.703125px; text-align: center;\"><strong>Positive</strong></td>\n<td style=\"width: 249.296875px; text-align: center;\"><strong>Negative</strong> &nbsp;</td>\n</tr>\n<tr>\n<td style=\"width: 204px;\"><strong>Positive</strong></td>\n<td style=\"width: 267.703125px;\">Endocrine therapy + chemotherapy + trastuzumab</td>\n<td style=\"width: 249.296875px;\">Chemotherapy + trastuzumab</td>\n</tr>\n<tr>\n<td style=\"width: 204px;\"><strong>Negative</strong></td>\n<td style=\"width: 267.703125px;\">Endocrine therapy &plusmn; chemotherapy</td>\n<td style=\"width: 249.296875px;\">Chemotherapy</td>\n</tr>\n</tbody>\n</table>\n<p>Note: <strong>Palbociclib</strong> is used along with hormone therapy in ER +ve, PR +ve, HER2/neu -ve tumors.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/07321cd03fa74168936aef8d9bc7489b.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/65e64b983f5540fc95708285043d0cc5x243x199.JPEG"
    ]
  },
  {
    "text": "A 60 yr old woman underwent a simple mastectomy followed by radiation therapy for ER/PR positive breast cancer. Which of the following is the most appropriate drug to be given to her to prevent the recurrence of breast cancer?",
    "choices": [
      {
        "id": 1,
        "text": "No drug is effective to prevent recurrence"
      },
      {
        "id": 2,
        "text": "Tamoxifen"
      },
      {
        "id": 3,
        "text": "Trastuzumab"
      },
      {
        "id": 4,
        "text": "Anastrozole"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Anastrozole</strong> is an <strong>aromatase inhibitor</strong> and it is the drug of choice for the <strong>prevention</strong> of <strong>recurrence</strong> of <strong>ER/PR positive breast cancer</strong> in <strong>post-menopausal women</strong> (usually &gt;50 years). It is given for 10 years.</p>\n<p><strong>Tamoxifen</strong> is a selective estrogen receptor modulator <strong>(SERM)</strong> and it is the drug of choice for preventing recurrence in <strong>pre-menopausal women.</strong> It has an agonistic action on the endometrium, leading to an <strong>increased risk</strong> of <strong>endometrial cancers.</strong> Hence, it is not used in post-menopausal women.</p>\n<p><strong>Trastuzumab</strong> is a her2/neu receptor antagonist. It is given in patients with <strong>her2/neu status positive.</strong> It would not be effective in this patient.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not true about accelerated partial breast irradiation?",
    "choices": [
      {
        "id": 1,
        "text": "Irradiation is delivered only at the lumpectomy site"
      },
      {
        "id": 2,
        "text": "Only suitable for women older than or equal to 65 years of age"
      },
      {
        "id": 3,
        "text": "It is used for low-risk DCIS patients"
      },
      {
        "id": 4,
        "text": "It is suitable if surgical margins are negative by \u2265 2 mm"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Accelerated partial breast irradiation (<strong>APBI</strong>)<strong>&nbsp;</strong>is a <strong>localized </strong>form of<strong> radiation</strong> delivered <strong>after lumpectomy</strong> to only the part of the breast where the tumor was removed. According to the updated guidelines, patients of age <strong>greater than or equal to&nbsp;50 years</strong>&nbsp;are considered suitable for APBI.</p>\n<p>Patients of age &lt;40 years are considered&nbsp;<strong>unsuitable</strong>,&nbsp;while those between 40 and 49 years of age are included in the&nbsp;<strong>cautionary</strong> group<strong>.</strong></p>\n<p>According to the recent American Society for Radiation Oncology (ASTRO) guidelines, the following patients are considered suitable for APBI:</p>\n<ul>\n<li>Patients of age <strong>50 years or older</strong></li>\n<li>Patients with <strong>low-risk DCIS</strong>. Low-risk DCIS includes patients satisfying the following criteria-\n<ol>\n<li>Screen-detected disease</li>\n<li>Low to intermediate nuclear grade</li>\n<li><strong>Tumor size &le; 2.5 cm</strong></li>\n<li>Surgical resection with margins negative by &ge; 3mm</li>\n</ol>\n</li>\n<li>Patients with surgical margins negative by &ge; 2mm</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A postmenopausal woman presented with a 4 cm lump in her left breast. Clinical and radiological examination revealed ipsilateral fixed axillary lymph node involvement without distant metastasis. Histopathology confirms invasive breast carcinoma. Immunohistochemistry is positive for ER, PR but negative for HER-2/Neu. What is the best method of management for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "2 and 4"
      },
      {
        "id": 2,
        "text": "2, 3 and 5"
      },
      {
        "id": 3,
        "text": "1, 2,3 and 4"
      },
      {
        "id": 4,
        "text": "1, 2, 3 and 5"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The best method of management in this patient is <strong>neoadjuvant chemotherapy, mastectomy, radiation</strong> therapy, and<strong>&nbsp;letrozole.</strong></p>\n<p>Step 1:&nbsp;Evaluate the TNM staging and stage grouping of the tumor</p>\n<ul>\n<li>Tumor size 4cm - <strong>T2</strong></li>\n<li>Ipsilateral fixed axillary lymph nodes are positive - <strong>N2a</strong></li>\n<li>No distant metastasis - <strong>M0</strong></li>\n</ul>\n<p>T2N2M0 belongs to the stage group IIIA which is considered<strong> locally advanced breast cancer (LABC).</strong> They are treated by neoadjuvant chemotherapy, mastectomy, and radiation therapy.</p>\n<p>Step 2: Evaluate the receptor status</p>\n<p>The immunohistochemistry is positive for estrogen and progesterone receptors. Therefore the patient has to be started with hormonal therapy with drugs like&nbsp;letrozole, anastrozole, tamoxifen etc.</p>\n<p><strong>Trastuzumab / Herceptin</strong> is a HER-2/Neu blocker and as the patient is HER2/Neu negative, it would not be effective.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 41-year-old woman underwent treatment for breast cancer of 1.2 X 1 cm with positive axillary nodes. She completed radiotherapy and chemotherapy and is now receiving tamoxifen. How would you follow up this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Annual mammogram"
      },
      {
        "id": 2,
        "text": "Regular checking of LFT once in 6 months"
      },
      {
        "id": 3,
        "text": "Follow-up with tumour markers once in 6 months"
      },
      {
        "id": 4,
        "text": "Yearly bone scans"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Follow-up of patients after treatment of breast cancer consists of a <strong>physical examination</strong> once in <strong>3-6 months </strong>for the<strong> first 3 years</strong> and an <strong>annual mammogram.</strong></p>\n<p>Mammography is the only imaging modality necessary for follow-up after breast cancer surgery. There is currently no role for tumor markers, serum investigations, or any other imaging studies like bone scans in routine follow-ups.</p>\n<p>Guidelines for <strong>follow-up after primary treatment</strong>:</p>\n<p><strong>Physical examination</strong>: every 3-6 months for the first 3 years, every 6-12 months for years 4 and 5, and annually thereafter.<br /><strong>Mammography</strong>: initially, 6 months after surgery, and thereafter, annually.<br /><strong>Breast self-examination:</strong> Monthly\u00a0<br /><strong>Pelvic examination</strong>: Annually in patients taking tamoxifen</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Post-operative radiotherapy is given in a patient with breast carcinoma mainly to _____.",
    "choices": [
      {
        "id": 1,
        "text": "Prevent metastasis"
      },
      {
        "id": 2,
        "text": "Induce ablation of the remnant cancer tissue"
      },
      {
        "id": 3,
        "text": "Prevent recurrence"
      },
      {
        "id": 4,
        "text": "Induce ablation of the affected nodes"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The main aim of radiotherapy in breast cancer is to <strong>prevent local recurrence</strong>.</p>\n<p>Radiotherapy is mainly given in the following cases:</p>\n<ul>\n<li>Positive lymph nodes</li>\n<li>After breast conservation surgery.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is the most likely site for hematogenous spread in a patient with breast carcinoma?",
    "choices": [
      {
        "id": 1,
        "text": "Lumbar vertebrae"
      },
      {
        "id": 2,
        "text": "Skull"
      },
      {
        "id": 3,
        "text": "Thoracic vertebrae"
      },
      {
        "id": 4,
        "text": "Femur"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Lumbar vertebrae</strong>, followed by the femur and thoracic vertebrae, are the most common sites for <strong>hematogenous spread</strong> of carcinoma breast. Bone metastases in breast cancer are more <strong>osteolytic</strong> than osteoblastic.</p>\n<p>The most common bony sites of blood-borne metastases are as follows:</p>\n<ul>\n<li>Lumbar vertebrae</li>\n<li>Femur</li>\n<li>Thoracic vertebrae</li>\n<li>Ribs</li>\n<li>Skull</li>\n</ul>\n<p>Note: In <strong>prostate</strong> cancer, the&nbsp;bone metastases are more <strong>osteoblastic</strong> than osteolytic.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A pregnant woman at 11-weeks of gestational age presents with a painless lump in the upper quadrant of her left breast. Ultrasound and trucut biopsy revealed the presence of invasive ductal carcinoma. What is the next best step in the management of this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Perform immediate breast conservation therapy"
      },
      {
        "id": 2,
        "text": "Perform mastectomy and start chemotherapy immediately after delivery"
      },
      {
        "id": 3,
        "text": "Mastectomy followed by hormonal therapy in the second and third trimester"
      },
      {
        "id": 4,
        "text": "Mastectomy followed by chemotherapy in the second and third trimester"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Mastectomy </strong>followed by <strong>chemotherapy in the second and third trimester</strong> is the best step of management in a pregnant woman diagnosed to have breast cancer in the first trimester.\u00a0</p>\n<p><strong>Pregnancy-associated breast cancer</strong> is defined as breast cancer that is diagnosed <strong>during</strong> <strong>pregnancy or within 1 year</strong>\u00a0postpartum.\u00a0It is the most common non-gy\u00adnecologic malignancy associated with pregnancy. Most patients present with a <strong>painless mass</strong> in the breast with or without bloody nipple discharge.</p>\n<p>Diagnosis is done by ultrasonography and tissue biopsy.</p>\n<p>Treatment of breast cancer in pregnancy involves:</p>\n<ul>\n<li><strong>Mastectomy</strong> in any trimester along with <strong>chemotherapy</strong> in the second and third trimesters.</li>\n<li><strong>Radiotherapy </strong>and<strong> hormonal therapies</strong> are absolutely <strong>contraindicated</strong> during pregnancy because of teratogenicity. They can be initiated after delivery.\u00a0</li>\n<li>Since radiotherapy is a component of <strong>breast conservation therapy</strong>, it is <strong>contraindicated</strong> in the first trimester of pregnancy. However, breast-conserving lumpectomy and axillary lymph node dissection with chemotherapy can be done in the second and third trimesters of pregnancy followed by radiation after delivery.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 45-year-old woman presented with back pain that was worse during the night. After evaluation, she was diagnosed with a recurrence of ER/PR+ breast cancer with bony metastasis. Which of the following would be the first-line treatment for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Radiotherapy"
      },
      {
        "id": 2,
        "text": "Chemotherapy + Surgery"
      },
      {
        "id": 3,
        "text": "Chemotherapy + Hormonal Therapy"
      },
      {
        "id": 4,
        "text": "Hormonal therapy"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given patient has <strong>metastatic breast cancer with bony metastasis</strong>. <strong>Hormone</strong> <strong>therapy</strong> is the <strong>first-line treatment</strong> for these patients due to its minimal side effects. It is particularly useful for bony metastasis.</p>\n<p>In <strong>premenopausal</strong> women, <strong>tamoxifen,</strong> and in <strong>post-menopausal</strong> women, <strong>anastrozole</strong> is preferred.&nbsp;</p>\n<p><strong>Chemotherapy</strong> is added to the regimen in the following scenarios:</p>\n<ol>\n<li>Young woman</li>\n<li><strong>Visceral metastasis&nbsp;</strong></li>\n<li>Rapidly growing tumors</li>\n<li>Failure of hormonal therapy</li>\n</ol>\n<p><strong>Surgery</strong> and <strong>radiotherapy</strong> are sometimes added to the regimen for <strong>palliative</strong> <strong>measures</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '11 Carcinoma Breast - Treatment';
        const quizFilename = '11-carcinoma-breast-treatment-f7670c2a.html';
        let hierarchy = ["Marrow", "qBank", "Surgery"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>