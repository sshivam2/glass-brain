<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>40 Myocardial And Pericardial Diseases And Cardiac Tumors - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Pathology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">25</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "What is the most common type of cardiomyopathy?",
    "choices": [
      {
        "id": 1,
        "text": "Dilated cardiomyopathy"
      },
      {
        "id": 2,
        "text": "Arrhythmogenic right ventricular cardiomyopathy"
      },
      {
        "id": 3,
        "text": "Hypertrophic cardiomyopathy"
      },
      {
        "id": 4,
        "text": "Restrictive cardiomyopathy"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The <strong>most</strong> common type of cardiomyopathy is<strong> dilated </strong>cardiomyopathy.\u00a0<strong>Restrictive</strong> cardiomyopathy is the <strong>least</strong> frequent.</p>\n<p>Cardiomyopathies are a heterogeneous group of diseases of the myocardium associated with <strong>mechanical</strong> and/or <strong>electrical dysfunction</strong>. They usually\u00a0<strong>exhibit</strong> inappropriate <strong>ventricular hypertrophy</strong> or <strong>dilatation.\u00a0</strong> The causes are frequently\u00a0<strong>genetic</strong>.</p>\n<p>Cardiomyopathies maybe\u00a0<strong>primary</strong>\u00a0predominantly involving the <strong>heart</strong> or <strong>secondary</strong> to a <strong>systemic</strong> or multiorgan disorder. They occur in the <strong>absence</strong> of any coronary artery disease, valvular heart disease, congenital heart disease, or systemic arterial hypertension.</p>\n<p>Types of cardiomyopathy:</p>\n<ul>\n<li>Dilated cardiomyopathy\u00a0</li>\n<li>Hypertrophic cardiomyopathy</li>\n<li>Restrictive cardiomyopathy</li>\n<li>Arrhythmogenic right ventricular cardiomyopathy</li>\n<li>Left ventricular non-compaction cardiomyopathy</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Alcohol abuse is strongly associated with the development of:",
    "choices": [
      {
        "id": 1,
        "text": "Pericarditis"
      },
      {
        "id": 2,
        "text": "Hypertrophic cardiomyopathy"
      },
      {
        "id": 3,
        "text": "Dilated cardiomyopathy"
      },
      {
        "id": 4,
        "text": "Myocarditis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Alcohol abuse is strongly associated with the development of <strong>dilated cardiomyopathy</strong>.</p>\n<p>Alcohol and its metabolites, especially <strong>acetaldehyde</strong> have a <strong>direct toxic effect </strong>on the <strong>myocardium </strong>which leads to the development of dilated cardiomyopathy.</p>\n<p>Causes of dilated cardiomyopathy:</p>\n<ul>\n<li>Acquired causes :\n<ul>\n<li>Infectious and non-infectious <strong>myocarditis</strong>: <strong>most common</strong> cause globally</li>\n<li>Alcohol is the most common cause in India</li>\n<li>Pregnancy:\n<ul>\n<li>Pregnancy-associated cardiomyopathy (PACM)</li>\n<li>Peripartum cardiomyopathy (PPCM)</li>\n</ul>\n</li>\n<li>Stress-induced: Takotsubo cardiomyopathy</li>\n<li>Drug-induced:\n<ul>\n<li>Doxorubicin (anthracycline)</li>\n<li>Trastuzumab&nbsp;</li>\n<li>Cyclophosphamide</li>\n</ul>\n</li>\n<li>Nutritional deficiency:\n<ul>\n<li>Beriberi (thiamine),</li>\n<li>Keshan disease (selenium),</li>\n<li>Carnitine deficiency</li>\n</ul>\n</li>\n<li>Endocrine: Hypo and hyperthyroidism, acromegaly, diabetes mellitus</li>\n<li>Others:\n<ul>\n<li>Cobalt toxicity,</li>\n<li>Heavy metals (lead, mercury, arsenic, lithium)</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>Familial causes (50%):&nbsp;</li>\n<ul>\n<li>Mutation in the cardiac myocyte <strong>titin</strong> gene</li>\n<li>Haemochromatosis</li>\n<li>Syndromes: Duchenne muscular dystrophy, Becker&rsquo;s muscular dystrophy</li>\n</ul>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is the largest protein expressed in humans?",
    "choices": [
      {
        "id": 1,
        "text": "Myosin"
      },
      {
        "id": 2,
        "text": "Collagen"
      },
      {
        "id": 3,
        "text": "Titin"
      },
      {
        "id": 4,
        "text": "Dystrophin"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Titin</strong> is the<strong> largest</strong> protein expressed in humans.</p>\n<p>Titin is the third myofilament of cardiac muscle. It has a single giant polypeptide spanning from Z-disk to the M-band region of the sarcomere.</p>\n<p>Mutation in TTN<em>, </em>the gene encoding titin, is responsible for <strong>20% </strong>of all cases of<strong> dilated cardiomyopathy.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Two brothers were arguing over a property dispute when the elder of the two complained of chest pain and collapsed. He was taken to the hospital but was declared brought dead.  The condition responsible for the death of the patient is grouped under which of the following?",
    "choices": [
      {
        "id": 1,
        "text": "Dilated cardiomyopathy"
      },
      {
        "id": 2,
        "text": "Constrictive cardiomyopathy"
      },
      {
        "id": 3,
        "text": "Restrictive cardiomyopathy"
      },
      {
        "id": 4,
        "text": "Arrhythmogenic cardiomyopathy"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario of<strong> sudden cardiac death&nbsp;</strong>in a previously healthy man, under a <strong>stressful</strong> situation, is suggestive of<strong>&nbsp;takotsubo cardiomyopathy.&nbsp;</strong>It is a type of&nbsp;<strong>dilated cardiomyopathy</strong>.</p>\n<p><strong>Takotsubo cardiomyopathy</strong> is also called&nbsp;broken heart syndrome, apical ballooning syndrome, or stress-induced cardiomyopathy. During extreme psychological <strong>stress</strong>, there is a <strong>catecholamine surge</strong>. This causes <strong>microcirculation spasms</strong> which lead to a transient <strong>myocardial</strong> <strong>stunning</strong>.&nbsp;It is usually seen in&nbsp;<strong>middle-aged women</strong>.&nbsp;</p>\n<p>It leads to left ventricular contractile dysfunction.&nbsp;The <strong>left ventricular apex</strong> is most often affected which leads to <strong>apical ballooning.</strong>&nbsp;This resembles a &ldquo;<strong>t</strong><strong>akotsubo</strong>,&rdquo; which is Japanese for &ldquo;fishing pot for trapping octopus&rdquo;.</p>\n<p>Histologically, acute cases may show microscopic areas of necrosis characterized by myocyte hyper contraction known as <strong>contraction band necrosis</strong>.&nbsp;Chronic cases may exhibit microscopic foci of granulation tissue.&nbsp;</p>\n<p>The first image below shows a ventriculogram showing takotsubo cardiomyopathy. The second image shows a 'takotsubo,' or octopus fishing pot.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/21d3bca3f1984b99962605be6bd05b31x1280x941.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c63e1ca3ec9c45dba00f7edeec131dddx1280x951.JPEG"
    ]
  },
  {
    "text": "A patient is admitted to the hospital with heart failure due to dilated cardiomyopathy. Toxicity by which of the following does not cause this?",
    "choices": [
      {
        "id": 1,
        "text": "Lead"
      },
      {
        "id": 2,
        "text": "Mercury"
      },
      {
        "id": 3,
        "text": "Selenium"
      },
      {
        "id": 4,
        "text": "Cobalt"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Selenium deficiency </strong>(<strong>Keshan's </strong>disease) is known to produce <strong>dilated cardiomyopathy&nbsp;</strong>and not its toxicity.</p>\n<p>Causes of dilated cardiomyopathy:</p>\n<p>Acquired causes:</p>\n<ul>\n<li>Infectious and non-infectious myocarditis is the most common cause globally</li>\n<li>Alcohol is the most common cause in India</li>\n<li>Pregnancy:\n<ul>\n<li>Pregnancy-associated cardiomyopathy (PACM)</li>\n<li>Peripartum cardiomyopathy (PPCM)</li>\n</ul>\n</li>\n<li>Stress-induced: Takotsubo cardiomyopathy</li>\n<li>Drug-induced:\n<ul>\n<li>Doxorubicin: anthracyclines</li>\n<li>Trastuzumab&nbsp;</li>\n<li>Cyclophosphamide</li>\n</ul>\n</li>\n<li><strong>Nutritional deficiency:</strong>\n<ul>\n<li>Beriberi (thiamine),</li>\n<li><strong>Keshan disease</strong> (selenium)</li>\n<li>Carnitine deficiency</li>\n</ul>\n</li>\n<li>Endocrine: Hypo and hyperthyroidism, acromegaly, diabetes mellitus</li>\n<li>Others:\n<ul>\n<li><strong>Cobalt</strong> toxicity</li>\n<li>Heavy metals (<strong>lead, mercury,</strong> arsenic, lithium)</li>\n</ul>\n</li>\n</ul>\n<p>Familial causes (50%):&nbsp;</p>\n<ol>\n<ul style=\"list-style-type: disc;\">\n<li>Mutation in the cardiac myocyte titin gene</li>\n<li>Haemochromatosis</li>\n<li>Syndromes: Duchenne muscular dystrophy, Becker&rsquo;s muscular dystrophy</li>\n</ul>\n</ol>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 55 yr old man is found to have hepatomegaly on physical examination. He also complains of dark tan despite avoiding sun exposure. His liver microscopy is given on the slide below. Which type of cardiomyopathy is usually seen in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Dilated cardiomyopathy"
      },
      {
        "id": 2,
        "text": "Hypertrophic cardiomyopathy"
      },
      {
        "id": 3,
        "text": "Restrictive cardiomyopathy"
      },
      {
        "id": 4,
        "text": "Left ventricular non-compaction cardiomyopathy"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>In the given scenario, liver microscopy shows<strong>\u00a0hepatocellular iron, </strong>stained blue with<strong>\u00a0Perl's Prussian blue\u00a0</strong>stain. The patient most likely suffers from<strong>\u00a0hemochromatosis. Dilated cardiomyopathy (DCM) </strong>is the predominant type of cardiomyopathy seen in\u00a0<strong>hemochromatosis.</strong></p>\n<p>Hemochromatosis can also produce restrictive cardiomyopathy, but it is less common than DCM.</p>\n<p>The\u00a0image below shows hemochromatosis. There is\u00a0<strong>hepatocellular iron,\u00a0</strong>stained with Perl's Prussian blue.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/97e4d06a91a74c29875aa585e3d8be95.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4baaf9fe08c544a7b2ebaf0dd5ad69bex1280x1143.JPEG"
    ]
  },
  {
    "text": "The histological examination of the heart of a patient who died due to heart failure is given below.  What underlying condition did the patient most likely have?",
    "choices": [
      {
        "id": 1,
        "text": "Hypertrophic cardiomyopathy"
      },
      {
        "id": 2,
        "text": "Restrictive cardiomyopathy"
      },
      {
        "id": 3,
        "text": "Arrhythmogenic cardiomyopathy"
      },
      {
        "id": 4,
        "text": "Dilated cardiomyopathy"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>In the given scenario, the histology image shows&nbsp;<strong>ninja-star</strong>&nbsp;like nuclei in myocytes. This is suggestive of <strong>dilated cardiomyopathy&nbsp;</strong>(DCM).</p>\n<p>These are non-specific findings but the presence of&nbsp;<strong>&ge; 5% myocytes</strong> with <strong>ninja star</strong>-like nuclei are suggestive of <strong>DCM.</strong> Here, DCM is due to <strong>titin-truncating mutations</strong>. Truncating mutations are those which shorten the coding sequence of the genes.&nbsp;</p>\n<p>Histologically they appear as variable myocyte hypertrophy and interstitial fibrosis. The nuclei are enlarged, bizarre and hyperchromatic exhibiting a ninja-star like appearance.&nbsp;</p>\n<p>The image given below explains the ninja star-like nuclei in the myocytes.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b72ce2790c9a4d3fa57437cb1dcac5aa.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/93325a80f6ee42009e9064b507199a84x600x636.JPEG"
    ]
  },
  {
    "text": "A 14-year-old boy who collapsed while playing basketball was brought to the emergency room and was resuscitated. On evaluation, he was found to have sustained ventricular tachycardia secondary to arrhythmogenic right ventricular cardiomyopathy. Which syndrome is associated with this?",
    "choices": [
      {
        "id": 1,
        "text": "Naxos syndrome"
      },
      {
        "id": 2,
        "text": "Nelson syndrome"
      },
      {
        "id": 3,
        "text": "Carvajal syndrome"
      },
      {
        "id": 4,
        "text": "Takotsubo syndrome"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Carvajal syndrome</strong> is a variant of Naxos disease but is associated with <strong>dilated cardiomyopathy.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/076b35e95cf9445bb2c1b00992741f5bx1200x728.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/86ca741f7aff463a9326c14ad95b2e56x316x430.JPEG"
    ]
  },
  {
    "text": "An autopsy was done for a young patient who had a sudden cardiac death. It revealed massive myocardial hypertrophy without ventricular dilation. The image obtained on microscopy is given below. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Ischemic cardiomyopathy"
      },
      {
        "id": 2,
        "text": "Arrhythmogenic right ventricular dysplasia"
      },
      {
        "id": 3,
        "text": "Hypertrophic cardiomyopathy"
      },
      {
        "id": 4,
        "text": "Takotsubo cardiomyopathy"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Histologic features of the HCM are:&nbsp;</p>\n<ul>\n<li>Massive myocyte hypertrophy- with transverse myocyte diameters frequently greater than 40 &mu;m, normal is approximately 15 &mu;m.</li>\n<li><strong>Myofiber disarray</strong>-&nbsp;haphazard disarray of bundles of myocytes, individual myocytes, and contractile elements in sarcomeres within cells&nbsp;</li>\n<li><strong>Interstitial fibrosis</strong> and replacement fibrosis</li>\n</ul>\n<p>The image given below is a histologic section&nbsp;of cardiac muscle showing&nbsp;myocyte disarray and extreme hypertrophy seen in an abnormal&nbsp;<acronym title=\"hypertrophic cardiomyopathy\">HCM</acronym>&nbsp;septum.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/2b5fcdf9b7bb470e96595cdc26bd87fd.GIF"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4ef950888d064315b8c09d2e8d11d073x1279x2419.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/50e6e2e423e94f4da306e716752a28abx1280x1186.JPEG"
    ]
  },
  {
    "text": "Mutations causing hypertrophic cardiomyopathy are most commonly seen in the gene encoding which of the following?",
    "choices": [
      {
        "id": 1,
        "text": "Titin"
      },
      {
        "id": 2,
        "text": "\u03b2-myosin heavy chain"
      },
      {
        "id": 3,
        "text": "\u03b1-tropomyosin"
      },
      {
        "id": 4,
        "text": "Cardiac Troponin I"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Mutations causing<strong> hypertrophic cardiomyopathy</strong>&nbsp;are most commonly seen in the genes encoding <strong>&beta;-myosin heavy chain </strong>(&beta;-MHC).</p>\n<p>Hypertrophic cardiomyopathy (HCM) is an <strong>autosomal dominant</strong> disease. In the majority of cases it is due to <strong>missense mutations</strong>&nbsp;in the following two <strong>sarcolemmal protein</strong> genes:&nbsp;</p>\n<ul>\n<li aria-level=\"1\">Myosin binding protein C (MYBC)</li>\n<li aria-level=\"1\">Beta myosin heavy chain (MYH7)</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following can cause restrictive cardiomyopathy?",
    "choices": [
      {
        "id": 1,
        "text": "1 and 4"
      },
      {
        "id": 2,
        "text": "2, 3 and 5"
      },
      {
        "id": 3,
        "text": "1, 2 and 3"
      },
      {
        "id": 4,
        "text": "1, 2, 4 and 5"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Restrictive cardiomyopathy is caused by hemochromatosis, ergotamine, amyloidosis and carcinoid syndrome. <strong>Trastuzumab</strong> causes <strong>dilated</strong> <strong>cardiomyopathy.</strong></p>\n<p><strong>Restrictive cardiomyopathy</strong> (RCM) is characterized by increased<strong> ventricular stiffness</strong> causing <strong>impaired</strong> <strong>diastolic</strong> <strong>filling</strong> of the ventricles. The stiffness is secondary to an underlying disease causing accumulation of intra and intercellular substances in the myocardium.&nbsp;</p>\n<p>Causes of RCM:</p>\n<ul>\n<li>Infiltration disorders&nbsp;\n<ul>\n<li style=\"text-align: left;\" aria-level=\"1\"><strong>Amyloidosis (most common) </strong></li>\n<li aria-level=\"1\"><strong>Sarcoidosis</strong></li>\n</ul>\n</li>\n</ul>\n<ul>\n<li aria-level=\"1\">Storage disorders&nbsp;\n<ul>\n<li>Fabry&rsquo;s disease</li>\n<li>Glycogen storage disease (type II&gt;&gt; III)</li>\n<li><strong>Hemochromatosis (DCM&gt;RCM)</strong></li>\n</ul>\n</li>\n</ul>\n<ul>\n<li>Fibrotic disorders&nbsp;\n<ul>\n<li>Scleroderma</li>\n<li>Endomyocardial fibrosis&nbsp;<br />\n<ul>\n<li>R-Radiation</li>\n<li>E-Ergotamine</li>\n<li>S-Serotonin</li>\n<li>T-Tropical Endomyocardial fibrosis</li>\n<li>C-<strong>Carcinoid syndrome</strong></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<ul>\n<li>Miscellaneous: post open heart surgery, diabetes.</li>\n</ul>\n<p>Morphology of RCM:</p>\n<ol>\n<li>Ventricles are of almost normal size or slightly enlarged</li>\n<li>The myocardium is non-compliant</li>\n<li><strong>Biatrial dilation</strong> is commonly observed</li>\n<li>Patchy or diffuse interstitial fibrosis</li>\n</ol>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 35-year-old female presents with progressive dyspnoea on exertion for one week along with a diffuse rash. Blood investigations are significant for an absolute eosinophil count of 4600 / mm\u00b3. Which of the following is caused by the patient's condition?",
    "choices": [
      {
        "id": 1,
        "text": "Hypertrophic cardiomyopathy"
      },
      {
        "id": 2,
        "text": "Dilated cardiomyopathy"
      },
      {
        "id": 3,
        "text": "Both hypertrophic and dilated cardiomyopathy"
      },
      {
        "id": 4,
        "text": "Restrictive cardiomyopathy"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>In the given scenario, the patient has progressive dyspnoea along with hypereosinophilia. This is suggestive of <strong>Loeffler's endocarditis</strong>. It leads to <strong>restrictive cardiomyopathy.</strong></p>\n<p>There is peripheral eosinophilia and <strong>eosinophilic infiltrates</strong> in multiple organs, including the heart.&nbsp;<strong>Major basic protein </strong>(MBP) is a <strong>toxic</strong> product released from <strong>eosinophils.</strong>&nbsp;This initiates <strong>endomyocardial necrosis</strong> followed by <strong>scarring.&nbsp;</strong>It leads to endomyocardial fibrosis, typically with large mural thrombi.</p>\n<p>Many patients with Loeffler's endocarditis have a myeloproliferative disorder. This is associated with chromosomal rearrangements involving platelet-derived growth factor receptor<strong> (PDGF)-&alpha; or -&beta; genes.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 2-year-old girl was brought to the outpatient department with complaints of difficulty in breathing and fatigue. The child had a history of intrauterine exposure to mumps. The cardiac evaluation showed a decrease in ventricular compliance.  Which of the following would be the cause of the child's symptoms?",
    "choices": [
      {
        "id": 1,
        "text": "Endomyocardial fibrosis"
      },
      {
        "id": 2,
        "text": "Loeffler endomyocarditis"
      },
      {
        "id": 3,
        "text": "Endocardial fibroelastosis"
      },
      {
        "id": 4,
        "text": "Arrhytmogenic right ventricular cardiomyopathy"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In this scenario, the <strong>decrease</strong> in ventricular <strong>compliance</strong> indicates <strong>restrictive cardiomyopathy</strong>.&nbsp;<strong>Endocardial fibroelastosis</strong> is an uncommon restrictive heart condition&nbsp;characterized by fibroelastic thickening that typically involves the left ventricular endocardium.</p>\n<p>It is most common in the first <strong>2 years of life.</strong>&nbsp;It results from&nbsp;several different insults including viral infections (e.g., intrauterine exposure to<strong> mumps</strong>) or mutations in the gene for <strong>tafazzin.</strong>&nbsp;These mutations affect mitochondrial inner membrane integrity.</p>\n<p><strong>Endomyocardial fibrosis </strong>is<strong>&nbsp;</strong>a&nbsp;disease of children and young adults in Africa and other tropical areas. It is characterized by fibrosis of the ventricular endocardium and subendocardium that extends from the apex upward. The aetiology is unknown.</p>\n<p><strong>Loeffler endomyocarditis</strong>&nbsp;results in endomyocardial fibrosis, typically with large mural thrombi. The overall morphology is similar to the tropical disease. In addition to the cardiac changes, there is often peripheral eosinophilia and eosinophilic infiltrates in multiple organs, including the heart.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Myocarditis is most commonly caused by which of the following viral infections?",
    "choices": [
      {
        "id": 1,
        "text": "Influenza virus"
      },
      {
        "id": 2,
        "text": "Cytomegalovirus"
      },
      {
        "id": 3,
        "text": "Coxsackie virus"
      },
      {
        "id": 4,
        "text": "Epstein-Barr virus"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Viral infections are the most common cause of myocarditis.&nbsp;<strong>Coxsackie viruses A </strong>and<strong> B </strong>and other<strong> enteroviruses</strong>&nbsp;account for most of the cases.</p>\n<p>Myocarditis is a diverse group of pathologic entities in which <strong>infectious microorganisms</strong> and/or a <strong>primary inflammatory process</strong> cause myocardial injury.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which serum protein is the major component of senile cardiac amyloid deposits?",
    "choices": [
      {
        "id": 1,
        "text": "Haptoglobin"
      },
      {
        "id": 2,
        "text": "Transthyretin"
      },
      {
        "id": 3,
        "text": "Fibronectin"
      },
      {
        "id": 4,
        "text": "Amylin"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Transthyretin </strong>is\u00a0the major component of <strong>senile cardiac amyloid</strong> deposits. It is<strong>\u00a0</strong>a <strong>normal</strong> serum <strong>protein</strong> synthesized in the liver that <strong>transports</strong> <strong>thyroxine</strong> and <strong>retinol-binding protein.</strong></p>\n<p>Amyloidosis of the heart can develop as a consequence of systemic amyloidosis or it may be localized. This is particularly seen in the elderly (<strong>senile cardiac amyloidosis</strong>). It has a far<strong> better prognosis</strong> than <strong>systemic amyloidosis.</strong></p>\n<p>Presentation of cardiac amyloidosis:</p>\n<ul>\n<li><strong>Restrictive cardiomyopathy- most common</strong></li>\n<li><strong>Asymptomatic</strong></li>\n<li>Dilation</li>\n<li>Arrhythmias</li>\n<li>Ischemic disease</li>\n<li>Valvular disease.</li>\n</ul>\n<p>The chambers are usually of normal size, but can be dilated and have thickened walls. Small, <strong>semitranslucent nodules</strong> resembling drips of wax may be seen on the <strong>atrial endocardial surface</strong>, particularly on the<strong> left.</strong></p>\n<p>Histologically, <strong>hyaline eosinophilic</strong> deposits of amyloid are found in:</p>\n<ul>\n<li>Interstitium</li>\n<li>Conduction tissue</li>\n<li>Valves, endocardium</li>\n<li>Pericardium</li>\n<li>Small intramural coronary arteries.</li>\n</ul>\n<p>The image given shows an <strong>endomyocardial biopsy </strong>of a patient with <strong>cardiac amyloidosis</strong> stained as follows: A) <strong>Congo red</strong> only,<strong> B) Apple-green birefringence </strong>under polarized light</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/054d4ac04ddb49eb9ad96cb0d8c967f2x384x207.JPEG"
    ]
  },
  {
    "text": "One week following a diagnosis of myocardial infarction,  a patient experiences precordial pain and develops a fever of 101.5\u00b0F. Physical examination is remarkable for a loud friction rub. Which of the following is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Caseous pericarditis"
      },
      {
        "id": 2,
        "text": "Fibrinous pericarditis"
      },
      {
        "id": 3,
        "text": "Hemorrhagic pericarditis"
      },
      {
        "id": 4,
        "text": "Purulent pericarditis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario suggests post-myocardial infarction <strong>fibrinous pericarditis.&nbsp;</strong>It is the<strong> most common</strong> type of pericarditis.</p>\n<p>Clinically, there is a&nbsp;<strong>loud pericardial friction rub.&nbsp;</strong>There is a rubbery fibrin mass loosely <strong>glueing</strong> the <strong>parietal</strong> and <strong>visceral pericardium</strong> together (bread and butter). It may <strong>resolve</strong> or become organized to produce <strong>adhesive pericarditis.</strong>&nbsp;</p>\n<p>It is usually seen following:</p>\n<ol>\n<li>Myocardial infarction</li>\n<li>Rheumatic fever</li>\n<li>Trauma</li>\n<li>Uremia</li>\n<li>Radiation</li>\n<li>Systemic lupus erythematosus&nbsp;(SLE)</li>\n<li>Severe pneumonia</li>\n</ol>\n<p>Types of acute pericarditis:</p>\n<p><strong>Serous pericarditis: </strong>There is a mild inflammation of epicardial and pericardial surfaces. Both acute and chronic inflammatory cells are present. There is <strong>exudative serous fluid</strong>, usually 50&ndash;200 mL. Thus, it develops slowly and rarely alters cardiac function.</p>\n<p>It is caused by:</p>\n<ol>\n<li>Rheumatic fever</li>\n<li>SLE</li>\n<li>Systemic scleroderma</li>\n<li>Tumours</li>\n<li>Uremia</li>\n<li>Viral infection</li>\n<li>Tuberculosis</li>\n</ol>\n<p><strong>Suppurative /purulent pericarditis: </strong>It may be due to bacterial, mycotic, or parasitic invasion. The inflammation may extend into the surrounding mediastinum. It usually, results in organization and, therefore, constrictive pericarditis with clinical sequelae. The entry of the pathogen into the pericardium may be by:</p>\n<ul>\n<li>direct extension</li>\n<li>seeding from blood</li>\n<li>lymphatic spread</li>\n<li>seeding by instrumentation</li>\n</ul>\n<p><strong>Hemorrhagic pericarditis:&nbsp;</strong>It can be due to tuberculosis or a malignant neoplasm (from lung or breast). It can also be seen following cardiac surgery.&nbsp;<strong>Caseous pericarditis </strong>is almost always tubercular in origin.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 52-year-old man with a history of myocardial infarction 4 weeks back,  develops fever,  pericardial chest pain and pericardial effusion. What is the aetiology behind the patient's present condition?",
    "choices": [
      {
        "id": 1,
        "text": "Viral"
      },
      {
        "id": 2,
        "text": "Bacterial"
      },
      {
        "id": 3,
        "text": "Free radical"
      },
      {
        "id": 4,
        "text": "Autoimmune"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>In the given scenario, fever, pericardial pain and effusion 4 weeks after MI, is suggestive of Dressler's syndrome. The aetiology of <strong>Dressler's syndrome</strong> is <strong>autoimmune</strong>.</p>\n<p>It is also known as post-myocardial infarction (post-MI) cardiac injury syndrome. It&nbsp;occurs <strong>one week </strong>to as long as<strong> two to three months</strong> after MI.</p>\n<p>A fibrinous or fibrinohemorrhagic pericarditis usually develops around the second or third day<strong>&nbsp;</strong>following a transmural infarct. It is a result of the underlying myocardial inflammation.</p>\n<p>Dressler's syndrome is believed to have an&nbsp;<strong>autoimmune</strong> aetiology. There is an inflammatory reaction to<strong> myocardial neo-antigens</strong> formed as a result of MI.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The autopsy of a patient who died due to heart failure revealed concretio cordis. Which of the following is this condition associated with?",
    "choices": [
      {
        "id": 1,
        "text": "Blunt trauma to the heart"
      },
      {
        "id": 2,
        "text": "Penetrating trauma to the heart"
      },
      {
        "id": 3,
        "text": "Constrictive pericarditis"
      },
      {
        "id": 4,
        "text": "Acute fibrinous pericarditis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Concretio cordis</strong>&nbsp;occurs in advanced cases of <strong>constrictive pericarditis</strong>.</p>\n<p>In constrictive pericarditis, a thick,0.5 - 1cm, fibrous scar tissue is formed. This&nbsp;can obliterate the pericardial space and sometimes calcify. In extreme cases, it can resemble a <strong>plaster mold </strong>and is known as<strong> concretio cordis.</strong></p>\n<p>Constrictive pericarditis may be idiopathic or can occur following:</p>\n<ol>\n<li>Pericarditis- serous or caseous</li>\n<li>Cardiac surgery</li>\n<li>Heavy irradiation</li>\n</ol>\n<p><strong>Adhesive mediastinopericarditis</strong>&nbsp;occurs<strong>&nbsp;</strong>when adhesion and fibrosis extends from the parietal pericardium into the mediastinum&nbsp;</p>\n<p><strong>Soldier&rsquo;s plaque </strong>is a focal pearly thickened epicardial plaque. It indicative of healed pericarditis</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is the most common primary tumour of the adult heart?",
    "choices": [
      {
        "id": 1,
        "text": "Hemangioma"
      },
      {
        "id": 2,
        "text": "Myxoma"
      },
      {
        "id": 3,
        "text": "Rhadomyoma"
      },
      {
        "id": 4,
        "text": "Fibroma"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Myxomas</strong>\u00a0are the <strong>most common</strong> primary tumours of the heart in adults.</p>\n<p>90% of myxomas are located in the atria. The left-to-right ratio of the myxoma is approximately 4:1. The region of the <strong>fossa ovalis </strong>in the <strong>atrial septum i</strong>s the <strong>favoured </strong>site of origin.</p>\n<p>Histopathological examination shows stellate or globular myxoma,\u00a0<strong>\u201clepidic,\" cells.\u00a0</strong>Peculiar vessel-like or gland-like structures are characteristic. Major clinical manifestations are fever and malaise (due to IL-6). Valvular \u201cball-valve\u201d obstruction or embolization can occur.</p>\n<p>Important points on cardiac tumors:</p>\n<ul>\n<li>Most common cardiac tumour: <strong>metastasis</strong></li>\n<li>Most common benign cardiac tumour: <strong>atrial myxoma</strong></li>\n<li>Most common primary cardiac tumour in adults: <strong>atrial myxoma</strong></li>\n<li>Most common primary cardiac tumour in children: <strong>rhabdomyoma\u00a0</strong></li>\n</ul>\n<p>The image given below shows an abundant amorphous extracellular matrix. It contains scattered multinucleate myxoma cells in various groupings, including abnormal vessel-like formations.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/528a3d9188634a509fb70d6f13136abbx1280x1885.JPEG"
    ]
  },
  {
    "text": "Which of the following conditions is commonly seen in patients with null mutations of the PRKAR1A gene?",
    "choices": [
      {
        "id": 1,
        "text": "Gastrointestinal stromal tumor"
      },
      {
        "id": 2,
        "text": "Paraganglioma"
      },
      {
        "id": 3,
        "text": "Cardiac myxoma"
      },
      {
        "id": 4,
        "text": "Rhabdomyoma"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Null mutations</strong> in the <strong>PRKAR1A</strong> gene is seen in <strong>Carney's complex</strong>. <strong>Cardiac myxomas</strong> are present in 30&ndash;40% of Carney complex patients.</p>\n<p>Familial syndromes associated with myxomas have <strong>activating</strong> mutations in the <strong>GNAS1</strong> gene or <strong>null</strong> mutations in <strong>PRKAR1A. </strong>Mutations in <strong>GNAS1 is </strong>associated&nbsp;with <strong>McCune-Albright syndrome. PRKAR1A</strong>&nbsp;gene encodes a regulatory subunit of a cyclic-AMP-dependent protein kinase (<strong>Carney complex</strong>).</p>\n<p><strong>Skin lesions </strong>are the<strong> most common </strong>manifestation of the <strong>Carney complex.&nbsp;</strong>The <strong>most common</strong> type of <strong>endocrine</strong> tumour in the Carney complex is the <strong>primary pigmented nodular adrenocortical disease</strong> (PPNAD). It is a form of bilateral adrenal hyperplasia that leads to adrenocorticotropic hormone (<strong>ACTH)-independent Cushing</strong> syndrome.&nbsp;</p>\n<p><strong>NAME </strong>syndrome and<strong> LAMB </strong>syndrome are subsets of the Carney complex.&nbsp;The LAMB acronym&nbsp;refers to lentigines, atrial myxoma,&nbsp;and blue nevi.<sup id=\"cite_ref-Schwartz20110502_1-2\" class=\"reference\"></sup>&nbsp;NAME refers to nevi, atrial myxoma, myxoid neurofibromas, and ephelids.<sup id=\"cite_ref-Schwartz20110502_1-3\" class=\"reference\"></sup></p>\n<p>Components of <strong>Carney Complex</strong>:</p>\n<ol>\n<li>Skin pigmented lesions (lentigines, blue nevi, other)</li>\n<li>Myxomas (cutaneous, mucosal, cardiac, other)</li>\n<li>PPNAD (Cushing Syndrome)</li>\n<li>GH-PRL-producing adenomas (acromegaly)</li>\n<li>Leydig or Sertoli cell tumors</li>\n<li>Ovarian cystadenoma or carcinoma</li>\n<li>Thyroid adenoma or cancer</li>\n<li>Psammomatous melanotic schwannoma</li>\n<li>Breast ductal adenoma</li>\n<li>Osteochondromyxoma</li>\n<li>Cancers (liver, pancreas, adrenal)</li>\n</ol>\n<p><strong>Carney triad</strong>:</p>\n<ol>\n<li>Extra-adrenal paraganglioma</li>\n<li>Gastrointestinal stromal tumor</li>\n<li>Pulmonary chondroma</li>\n</ol>\n<p><strong>Carney&ndash;Stratakis Syndrome:&nbsp;</strong>Familial paraganglioma and gastrointestinal stromal tumour (GIST)</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the most common site of a cardiac myxoma?",
    "choices": [
      {
        "id": 1,
        "text": "Left atrium"
      },
      {
        "id": 2,
        "text": "Right atrium"
      },
      {
        "id": 3,
        "text": "Left ventricle"
      },
      {
        "id": 4,
        "text": "Interventricular septum"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Atrial myxomas most commonly occur in the <strong>left atrium.</strong></p>\n<p>Myxoma is usually single, but can rarely be multiple. The region of the<strong> fossa ovalis </strong>in the<strong> atrial septum </strong>is the favoured site of origin. Mobile tumours exert a <strong>&ldquo;wrecking-ball&rdquo; effect,</strong> causing <strong>damage</strong> to the <strong>valve leaflets</strong>.</p>\n<p>They can be sporadic or familial.</p>\n<table style=\"width: 249px; height: 196px;\">\n<tbody>\n<tr>\n<td style=\"width: 118.333px;\"><strong>Sporadic Type Myxoma</strong></td>\n<td style=\"width: 115.667px;\"><strong>Familial Type Myxoma</strong></td>\n</tr>\n<tr>\n<td style=\"width: 118.333px;\">Single</td>\n<td style=\"width: 115.667px;\">Multiple</td>\n</tr>\n<tr>\n<td style=\"width: 118.333px;\">Postoperative recurrance NIL</td>\n<td style=\"width: 115.667px;\">Present</td>\n</tr>\n<tr>\n<td style=\"width: 118.333px;\">Younger age</td>\n<td style=\"width: 115.667px;\">&nbsp;</td>\n</tr>\n<tr>\n<td style=\"width: 118.333px;\">Left atria - Most common site</td>\n<td style=\"width: 115.667px;\">&nbsp;</td>\n</tr>\n</tbody>\n</table>\n<p>The image given below shows a gross picture of an atrial cardiac myxoma arising from the&nbsp;region of the fossa ovalis and extending to mitral valve orifice:&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2f5725854c43425b997cacf6f30c3e04x358x338.JPEG"
    ]
  },
  {
    "text": "The histopathologic findings seen in a resected heart mass is given below. What is the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Cardiac Myxomas"
      },
      {
        "id": 2,
        "text": "Papillary fibroelastoma"
      },
      {
        "id": 3,
        "text": "Cardiac Rhabdomyoma"
      },
      {
        "id": 4,
        "text": "Cardiac Rhabdomyosarcoma"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given histological slide shows abundant <strong>spider cells</strong>. They are seen in <strong>r</strong><strong>habdomyoma.</strong></p>\n<p>Microscopically,&nbsp;they are composed of <strong>bizarre, </strong>markedly<strong> enlarged myocytes</strong>. Routine histologic processing often artifactually reduces the abundant cytoplasm to thin strands that stretch from the nucleus to the surface membrane. This appearance is referred to as <strong>&ldquo;spider&rdquo; cells</strong>.</p>\n<p>Rhabdomyoma is the <strong>most frequent primary </strong>tumour of the&nbsp;<strong>pediatric heart.&nbsp;</strong>50% of cases are associated with <strong>tuberous sclerosis</strong>, with mutations in the tumour-suppressor genes <em>TSC1</em> and <em>TSC2</em>. They are usually <strong>multiple</strong> and occur in&nbsp;<strong>ventricles</strong> preferentially. They often <strong>regress spontaneously</strong> and may,&nbsp;therefore, be <strong>considered</strong> as <strong>hamartomas.</strong></p>\n<p>Image given shows spider cell in rhabdomyoma:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/cc78ac6c1bbf45efbb602f9048afd4c2.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6c9d4b5c41494c3190c81add1122b5c5x623x455.PNG"
    ]
  },
  {
    "text": "The single most important long-term limitation of cardiac transplantation is ________",
    "choices": [
      {
        "id": 1,
        "text": "Allograft rejection"
      },
      {
        "id": 2,
        "text": "Allograft arteriopathy"
      },
      {
        "id": 3,
        "text": "Infection"
      },
      {
        "id": 4,
        "text": "Malignancy"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The single <strong>most important</strong> <strong>long-term</strong> limitation of cardiac transplantation is <strong>allograft arteriopathy.</strong>&nbsp;</p>\n<p>Complications following cardiac transplantation:</p>\n<p><strong>Allograft rejection</strong>: It is the primary concern&nbsp;that requires close surveillance. Both <strong>classic cellular</strong> rejection and<strong> antibody-mediated</strong> rejection is recognized. <strong>Cellular rejection</strong> is characterized by interstitial<strong> lymphocytic</strong> <strong>inflammation</strong>, with associated <strong>myocyte damage.</strong></p>\n<p><strong>Allograft arteriopathy</strong>: It is the single most important long-term limitation for cardiac transplantation. It is a late, progressive, diffusely stenosing intimal proliferation in the coronary arteries, leading to <strong>ischemic injury</strong>.&nbsp;It can lead to <strong>silent myocardial infarction</strong> since transplant patients have <strong>denervated</strong> hearts and do not experience angina. Progressive congestive heart failure and sudden cardiac death can also occur.</p>\n<p>Other postoperative problems include infection and malignancies, especially Epstein&ndash;Barr virus-associated B-cell lymphomas.</p>\n<p>The image given below shows allograft arteriopathy. There is severe diffuse concentric intimal thickening producing critical stenosis. The internal elastic lamina and media are intact (Movat pentachrome stain, elastin black)</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1266219c66f94d37942e639554ce0dcax513x338.JPEG"
    ]
  },
  {
    "text": "What is the most common cause of the condition shown in the given image?",
    "choices": [
      {
        "id": 1,
        "text": "Malignant hypertension"
      },
      {
        "id": 2,
        "text": "Chronic hypertension"
      },
      {
        "id": 3,
        "text": "Amyloidosis"
      },
      {
        "id": 4,
        "text": "Hypertrophic obstructive cardiomyopathy"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The image shows a heart with <strong>left ventricular hypertrophy</strong>. The most common cause of left ventricular hypertrophy is <strong>chronic hypertension</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/88d3e6ba02224ebeb24bd160ca4c9bdf.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following patients with cardiac hypertrophy will have an associated increase in capillary density?",
    "choices": [
      {
        "id": 1,
        "text": "A patient with systemic hypertension"
      },
      {
        "id": 2,
        "text": "A patient with an echo finding of an aortic valvular area of 0.6cm\u00b2"
      },
      {
        "id": 3,
        "text": "A patient with a high pitched holosystolic murmur best heard at the apex"
      },
      {
        "id": 4,
        "text": "A patient who is a marathon runner who came for a pre-run evaluation"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Heart weight, </strong>rather than wall thickness, is the<strong> best measure </strong>of hypertrophy in <strong>dilated hearts.</strong></p>\n<p>A patient with systemic hypertension has pressure-overload hypertrophy.</p>\n<p>A patient with an echo finding of an aortic valvular area of 0.6cm\u00b2 is suggestive of aortic stenosis. There is pressure-overload hypertrophy.</p>\n<p>A patient with a high pitched holosystolic murmur best heard at the apex is suggestive of mitral regurgitation. There is volume-overload hypertrophy.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e022fb34b0b346b385148f8c9ee80d24x1280x1824.JPEG"
    ]
  }
];
        let quizName = '40 Myocardial And Pericardial Diseases And Cardiac Tumors';
        let hierarchy = ["Marrow", "qBank", "Pathology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>