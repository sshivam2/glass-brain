<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>28 Osteology, Scalp And Face - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Anatomy
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">27</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "How many pairs of synovial articulations are associated with the exterior of the skull?",
    "choices": [
      {
        "id": 1,
        "text": "1"
      },
      {
        "id": 2,
        "text": "2"
      },
      {
        "id": 3,
        "text": "3"
      },
      {
        "id": 4,
        "text": "4"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>There are <strong>2 pairs</strong> of <strong>synovial articulations</strong> that are associated with the exterior of the skull. They are <strong>temporomandibular</strong> joint and lateral joints<strong>&nbsp;</strong>(part of <strong>atlantooccipital</strong> joints).</p>\n<p>Joints of the cranial vault:</p>\n<ol>\n<li><strong>Fibrous</strong> joints/ Sutures - Facilitate the growth of the skull. (majority of the skull joints fall in this category)</li>\n<li><strong>Primary cartilaginous</strong> joints - Present between the bones in the skull base&nbsp;</li>\n<li><strong>Synovial</strong> joints -&nbsp;temporomandibular joints and atlantooccipital joints.</li>\n</ol>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which skull bone is known as Inca?",
    "choices": [
      {
        "id": 1,
        "text": "Parietal bone"
      },
      {
        "id": 2,
        "text": "Temporal bone"
      },
      {
        "id": 3,
        "text": "Interparietal bone"
      },
      {
        "id": 4,
        "text": "Occipital bone"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The<strong> interparietal bone</strong> of the skull is known as <strong>Inca.</strong>&nbsp;It is a sutural bone that lies between the <strong>occipital</strong> and the <strong>parietal</strong> <strong>bones</strong>.&nbsp;It is also called Goethe's ossicle.&nbsp;</p>\n<p>Sutural or wormian bones are islands of bone that are commonly&nbsp;found within the <strong>lambdoid</strong> suture in some individuals. They may arise from separate centers&nbsp;of ossification and they appear to have no clinical significance.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c3201934e66b4f2fb5f0dd76a3edd990x1280x1167.JPEG"
    ]
  },
  {
    "text": "While counselling the parents of a baby with anterior plagiocephaly, you explain that one of the skull sutures has prematurely fused. The affected suture is present between:",
    "choices": [
      {
        "id": 1,
        "text": "Both frontal bones"
      },
      {
        "id": 2,
        "text": "The frontal and parietal bones"
      },
      {
        "id": 3,
        "text": "The occipital and parietal bones"
      },
      {
        "id": 4,
        "text": "Both parietal bones"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Craniosynostosis</strong>&nbsp;consists of <strong>premature fusion</strong> of one or more cranial sutures, resulting in an abnormal head shape.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ba8e4f4abb064f7aa52941d3f3c42ba8x600x723.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4871532659934c9bb48bdc5c22572e8ex1280x2288.JPEG"
    ]
  },
  {
    "text": "Which of the following structures passes through the marked foramen?",
    "choices": [
      {
        "id": 1,
        "text": "Accessory meningeal artery"
      },
      {
        "id": 2,
        "text": "Lesser petrosal nerve"
      },
      {
        "id": 3,
        "text": "Maxillary nerve"
      },
      {
        "id": 4,
        "text": "Middle meningeal artery"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The foramen marked is the&nbsp;<strong>foramen spinosum. </strong>The structures passing through it are:&nbsp;</p>\n<ul>\n<li><strong>Middle meningeal artery&nbsp;</strong></li>\n<li>Nervus spinosus</li>\n<li>Middle meningeal vein</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/00e59694fefa400b86e1cc6f8d887f9c.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 40-year-old man presents with bruxism. The nerve supplying the muscles involved in this condition passes through:",
    "choices": [
      {
        "id": 1,
        "text": "1"
      },
      {
        "id": 2,
        "text": "2"
      },
      {
        "id": 3,
        "text": "3"
      },
      {
        "id": 4,
        "text": "4"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Bruxism</strong> or <strong>teeth grinding</strong> mainly involves the temporalis, lateral pterygoids, and the masseter (<strong>muscles</strong> of <strong>mastication</strong>). These are supplied by the&nbsp;<strong>mandibular nerve.&nbsp;</strong>It&nbsp;passes through the <strong>foramen ovale </strong>(marked A).&nbsp;&nbsp;</p>\n<p>Other foramina marked are:&nbsp;</p>\n<p>2. Foramen spinosum</p>\n<p>3. Foramen lacerum</p>\n<p>4. Jugular foramen</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b2710d25fce64a8484742cf8863eb393.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Identify the foramen marked in the image below.",
    "choices": [
      {
        "id": 1,
        "text": "Foramen rotundum"
      },
      {
        "id": 2,
        "text": "Foramen ovale"
      },
      {
        "id": 3,
        "text": "Vidian canal"
      },
      {
        "id": 4,
        "text": "Foramen spinosum"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The image shows the <strong>sphenoid</strong> bone. The foramen marked is the&nbsp;<strong>foramen</strong> <strong>rotundum</strong>. Maxillary branch of trigeminal nerve passes through it.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/9a57cc0f680f4618b858655553497390.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/bb48e90c579f43689f7f3503c102b43fx1280x1383.JPEG"
    ]
  },
  {
    "text": "A patient presenting with right-sided shoulder droop and an absent gag reflex was diagnosed with Vernet's syndrome. Which of the following structures passes through the posterior part of the involved foramen?",
    "choices": [
      {
        "id": 1,
        "text": "Spinal accessory nerve"
      },
      {
        "id": 2,
        "text": "Sigmoid sinus"
      },
      {
        "id": 3,
        "text": "Inferior petrosal sinus"
      },
      {
        "id": 4,
        "text": "Vagus nerve"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Vernet's syndrome or&nbsp;<strong>jugular foramen syndrome</strong>&nbsp;refers to the palsies of<strong>&nbsp;IX, X,</strong> and<strong> XI</strong> cranial nerves traversing the jugular foramen. The<strong>&nbsp;sigmoid sinus</strong> passes through the <strong>posterior</strong> aspect of the<strong> jugular foramen</strong>.</p>\n<p>Jugular foramen can be divided into <strong>three</strong> compartments:</p>\n<ul>\n<li>Anterior - <strong>Inferior petrosal sinus</strong>&nbsp;</li>\n<li>Intermediate -&nbsp;CN IX, X, XI</li>\n<li>Posterior -&nbsp;Sigmoid sinus continuing as the <strong>internal jugular vein</strong></li>\n</ul>\n<p>The arteries passing through the foramen are the meningeal branch&nbsp;of ascending pharyngeal artery and the meningeal branch of the occipital artery. Emissary veins may also traverse it.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a213a7d7d0a4407b855b6198f3877d63x1280x1040.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/de14a302344b487caa3adc65131ba348x600x787.JPEG"
    ]
  },
  {
    "text": "Which of the following ligaments passes through the foramen magnum?",
    "choices": [
      {
        "id": 1,
        "text": "Transverse ligament of atlas"
      },
      {
        "id": 2,
        "text": "Membrana tectoria"
      },
      {
        "id": 3,
        "text": "Anterior longitudinal ligament"
      },
      {
        "id": 4,
        "text": "Ligamentum flavum"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The<strong> membrana tectoria</strong> of <strong>atlanto-axial</strong> joint passes through the <strong>foramen magnum.&nbsp;</strong></p>\n<p>Certain structures pass through two compartments of the foramen magnum - the&nbsp;<strong>osseo-ligamentous (anterior)</strong>&nbsp;and <strong>neuro-vascular (posterior)</strong><strong> compartments</strong>&nbsp;- as shown in the image below:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5c2a7a17871148f6b55c78532134afd0x600x744.JPEG"
    ]
  },
  {
    "text": "A dentist performing a wisdom tooth extraction injects lidocaine at the structure marked X below. Which of the following nerves is blocked here?",
    "choices": [
      {
        "id": 1,
        "text": "Lingual nerve"
      },
      {
        "id": 2,
        "text": "Mandibular nerve"
      },
      {
        "id": 3,
        "text": "Chorda tympani nerve"
      },
      {
        "id": 4,
        "text": "Inferior alveolar nerve"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Given below is an image showing the administration of <strong>inferior alveolar nerve block </strong>before it enters&nbsp;the mandibular foramen.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/cd7882390f5b4377842e8fc517a477ba.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/46748e95cf0448a7a3bb08a0b47c2c07x1280x991.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2a9c8c09fcef49e7b3fb9769c32d2917x1280x935.JPEG"
    ]
  },
  {
    "text": "Identify the cranial nerve that passes through the marked foramen marked in the image below.",
    "choices": [
      {
        "id": 1,
        "text": "Oculomotor nerve"
      },
      {
        "id": 2,
        "text": "Olfactory nerve"
      },
      {
        "id": 3,
        "text": "Optic nerve"
      },
      {
        "id": 4,
        "text": "Facial nerve"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The marked structure is the&nbsp;<strong>superior orbital fissure</strong> and the&nbsp;<strong>oculomotor nerve</strong> passes through this fissure.</p>\n<p>Superior orbital fissure is divided into three compartments by the <strong>common tendinous ring</strong>. The oculomotor nerve passes through its <strong>i</strong><strong>ntermediate compartment</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d4f7a09ad20f4e64a3d8cdbc38de8509.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Identify the structure passing through the foramen marked.",
    "choices": [
      {
        "id": 1,
        "text": "Abducens nerve"
      },
      {
        "id": 2,
        "text": "Spinal accessory nerve"
      },
      {
        "id": 3,
        "text": "Ophthalmic artery"
      },
      {
        "id": 4,
        "text": "Middle meningeal artery"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The marked foramen is the&nbsp;<strong>superior orbital fissure </strong>and&nbsp;the<strong> a</strong><strong>bducens nerve</strong> passes through it.</p>\n<p>The abducens nerve is the <strong>6th cranial nerve</strong>&nbsp;and arises from the brainstem at the <strong>pontomedullary</strong> junction. It runs through the <strong>Dorello's canal</strong> which is present at the medial most end of the petrous ridge and then enters the cavernous sinus where it lies lateral to the internal carotid artery. It enters the orbit through the <strong>superior orbital fissure</strong> within the common tendinous ring and supplies the <strong>lateral rectus</strong>.</p>\n<p>&nbsp;</p>\n<p>Other options:</p>\n<p><strong>Spinal accessory nerve&nbsp;</strong>passes through the&nbsp;<strong>foramen magnum&nbsp;</strong>along with the&nbsp;<strong>medulla oblongata&nbsp;</strong>and the&nbsp;<strong>verterbral arteries</strong></p>\n<p><strong>Ophthalmic artery&nbsp;</strong>passes through the&nbsp;<strong>optic canal&nbsp;</strong>along with the&nbsp;<strong>optic nerve.</strong></p>\n<p><strong>Middle meningeal artery&nbsp;</strong>and vein&nbsp;pass through the&nbsp;<strong>foramen spinosum&nbsp;</strong>along with the&nbsp;<strong>meningeal branch of mandibular nerve.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/2c46783e8f6946c28787b328366d789d.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 24-year-old man presents to the ER after receiving a punch to the right side of his face. His X-ray is shown below. Which of the following bones maximally contributes to the region fractured?",
    "choices": [
      {
        "id": 1,
        "text": "Maxilla"
      },
      {
        "id": 2,
        "text": "Sphenoid bone"
      },
      {
        "id": 3,
        "text": "Palatine bone"
      },
      {
        "id": 4,
        "text": "Zygomatic bone"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The orbital floor can be fractured by trauma to the orbit as seen in falls, motor vehicle accidents, and assaults. The image given shows X-ray Water's view with a 'teardrop' sign. The orbital contents leak out of the fractured orbital floor, giving it a teardrop-like appearance.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/14371344308f48ae96b59ee81cc8f452.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/cfff375ad512484e8076911ef48c0f95x600x568.JPEG"
    ]
  },
  {
    "text": "A detective is brought to the casualty with an upper eyelid laceration following a knife fight. The plastic surgeon palpates for a landmark to administer lignocaine before suturing. Where is the local anesthetic injection given?",
    "choices": [
      {
        "id": 1,
        "text": "A"
      },
      {
        "id": 2,
        "text": "B"
      },
      {
        "id": 3,
        "text": "C"
      },
      {
        "id": 4,
        "text": "D"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Upper eyelid lacerations are sutured under <strong>supraorbital nerve block.</strong> The anesthesia is achieved by approaching the nerve at the supraorbital foramen/notch.&nbsp;The <strong>supraorbital notch</strong> is present at the junction of <strong>lateral two-third</strong> and<strong> medial one-third</strong> of the supraorbital margin (point C). It transmits the <strong>supraorbital nerve&nbsp;</strong>and vessels.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/08789dc853cf43ce936e58915f68700c.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1753a0f53b6e474fa75d77b26d55bf58x600x729.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c99b52ac2ef04ba58c6a745467493e2ex1200x1302.JPEG"
    ]
  },
  {
    "text": "Which of the following bony structures is present behind the marked area?",
    "choices": [
      {
        "id": 1,
        "text": "Post clivus"
      },
      {
        "id": 2,
        "text": "Lesser wing of sphenoid"
      },
      {
        "id": 3,
        "text": "Sella turcica"
      },
      {
        "id": 4,
        "text": "Carotid canal"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The pterion overlies the <strong>anterior</strong> branch of the <strong>middle meningeal artery</strong> and <strong>lateral fissure </strong>of the cerebral hemisphere. The bone in this area is thin and any injury to this area may lead to rupture of the middle meningeal artery leading to <strong>extradural hematoma.</strong></p>\n<p>The pterion also corresponds to the site of the anterolateral (sphenoidal) fontanelle of the neonatal skull, which closes in the third month after birth.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/580fe909289a493082bef33865ce97a0.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8ed16748633245758ccb4569bf6a2e8fx1280x1525.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8657a3708f3142c68a804d196cb8f4b9x600x666.JPEG"
    ]
  },
  {
    "text": "A cricket player was rushed to the emergency department, unconscious after being hit in the head with the ball. NCCT head revealed an extradural hematoma at the pterion. Which of the following vessels is likely to be injured?",
    "choices": [
      {
        "id": 1,
        "text": "Superficial temporal artery"
      },
      {
        "id": 2,
        "text": "Maxillary artery"
      },
      {
        "id": 3,
        "text": "Middle meningeal artery"
      },
      {
        "id": 4,
        "text": "Deep temporal artery"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>An extradural hematoma at the <strong>pterion</strong> is a result of an injury of the anterior division of the&nbsp;<strong>middle meningeal artery.&nbsp;</strong></p>\n<p>The pterion is an <strong>H-shaped sutural junction</strong> between four bones of the skull:</p>\n<ol>\n<li>Frontal bone</li>\n<li>Squamous part of the temporal bone</li>\n<li>Greater wing of sphenoid bone</li>\n<li>Parietal bone.</li>\n</ol>\n<p>It also overlies the&nbsp;<strong>lateral fissure</strong> of the <strong>cerebral hemisphere, </strong>the hematoma can cause compressive lesions here.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8ed16748633245758ccb4569bf6a2e8fx1280x1525.JPEG"
    ]
  },
  {
    "text": "Which of the following fontanelles is most likely to be open in an 18-month old infant?",
    "choices": [
      {
        "id": 1,
        "text": "Anterior"
      },
      {
        "id": 2,
        "text": "Posterior"
      },
      {
        "id": 3,
        "text": "Occipital"
      },
      {
        "id": 4,
        "text": "Mastoid"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The<strong> anterior fontanelle </strong>is most likely to be open as it is the last fontanelle to close. It closes at around <strong>18-24 months</strong> of age.</p>\n<p>Fontanelles of the skull:</p>\n<table style=\"height: 264px; width: 572px;\">\n<tbody>\n<tr>\n<td style=\"width: 169.531px; text-align: center;\"><strong>Fontanelle&nbsp;</strong></td>\n<td style=\"width: 209.547px; text-align: center;\"><strong>Location</strong></td>\n<td style=\"width: 170.922px; text-align: center;\"><strong>Closes at&nbsp;</strong></td>\n</tr>\n<tr>\n<td style=\"width: 169.531px; text-align: left;\">Anterior</td>\n<td style=\"width: 209.547px; text-align: left;\">\n<p>Between frontal and parietal bones</p>\n<p>Junction marked by bregma</p>\n</td>\n<td style=\"width: 170.922px; text-align: left;\">18-24 months&nbsp;</td>\n</tr>\n<tr>\n<td style=\"width: 169.531px; text-align: left;\">Posterior</td>\n<td style=\"width: 209.547px; text-align: left;\">Sagittal and lambdoid sutures</td>\n<td style=\"width: 170.922px; text-align: left;\">2-3 months</td>\n</tr>\n<tr>\n<td style=\"width: 169.531px; text-align: left;\">Sphenoid</td>\n<td style=\"width: 209.547px; text-align: left;\">Pterion</td>\n<td style=\"width: 170.922px; text-align: left;\">2-3 months</td>\n</tr>\n<tr>\n<td style=\"width: 169.531px; text-align: left;\">Mastoid/Posterolateral</td>\n<td style=\"width: 209.547px; text-align: left;\">Intersection of temporal, parietal, and occipital bones.</td>\n<td style=\"width: 170.922px; text-align: left;\">6-18 months (average 12 months)</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7a328df73afb4b69b91ef0c76b4ddc8dx600x666.JPEG"
    ]
  },
  {
    "text": "While resecting an acoustic neuroma via the middle cranial fossa approach, the surgeon drills over the arcuate eminence of the petrous temporal bone. What is the inferior relation of the structure being drilled?",
    "choices": [
      {
        "id": 1,
        "text": "Lesser petrosal nerve"
      },
      {
        "id": 2,
        "text": "Greater petrosal nerve"
      },
      {
        "id": 3,
        "text": "Superior semicircular canal"
      },
      {
        "id": 4,
        "text": "Posterior semicircular canal"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The petrous temporal bone is a <strong>pyramid-shaped</strong> structure. Its relations are:&nbsp;</p>\n<ul>\n<li>Inferior to arcuate eminence - superior semicircular canal .</li>\n<li><strong>Posterior</strong> surface - internal auditory meatus (<strong>IAM</strong>) and vestibular aqueduct</li>\n<li>Inferior surface -&nbsp;<strong>carotid canal</strong> and the <strong>jugular fossa&nbsp;</strong>(jugular notch)</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f62accf288c0405f92c369672f58e268x600x517.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7b9f38639b2e4e348d9b91f1e21f7fa0x1280x1373.JPEG"
    ]
  },
  {
    "text": "A man was hit on his face during a fight and suffered the following fracture. Which of the following bones is likely to be fractured?",
    "choices": [
      {
        "id": 1,
        "text": "Frontal bone"
      },
      {
        "id": 2,
        "text": "Maxilla"
      },
      {
        "id": 3,
        "text": "Sphenoid bone"
      },
      {
        "id": 4,
        "text": "Temporal bone"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The X-ray shows a fracture of the <strong>left zygomatic arch.</strong> The zygomatic process of the\u00a0<strong>temporal bone</strong> contributes to the formation of the zygomatic arch.</p>\n<p>Zygomatic arch\u00a0is made up of the\u00a0<strong>temporal process </strong>of the<strong> zygomatic bone </strong>and the <strong>zygomatic process </strong>of the<strong> temporal bone. </strong>They<strong>\u00a0</strong>articulate at the <strong>zygomaticotemporal suture.</strong></p>\n<p>Masseter originates from the lower border of the zygomatic arch.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/217bc854ecee45b0a0d33ca773b3e21b.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b4dff2015c34492ba833552d4d0240bfx1280x1525.JPEG"
    ]
  },
  {
    "text": "Which of the following nerves provides sensory innervation to the scalp?",
    "choices": [
      {
        "id": 1,
        "text": "Infratrochlear nerve"
      },
      {
        "id": 2,
        "text": "Lesser occipital nerve"
      },
      {
        "id": 3,
        "text": "Anterior division of greater auricular nerve"
      },
      {
        "id": 4,
        "text": "Facial nerve"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The&nbsp;<strong>temporal&nbsp;</strong>and&nbsp;<strong>posterior auricular branches&nbsp;</strong>of the&nbsp;<strong>facial nerve&nbsp;</strong>constitute the&nbsp;<strong>motor supply</strong> to the&nbsp;<strong>anterior&nbsp;</strong>and&nbsp;<strong>posterior scalp</strong>, respectively.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e23aa71de1ef4c6992c52fafb9fd2ef4x600x683.JPEG"
    ]
  },
  {
    "text": "A 2 week-old neonate developed meningitis following a scalp abscess. What is the likely route of spread?",
    "choices": [
      {
        "id": 1,
        "text": "Superficial fascia"
      },
      {
        "id": 2,
        "text": "Aponeurosis"
      },
      {
        "id": 3,
        "text": "Subaponeurotic tissue"
      },
      {
        "id": 4,
        "text": "Pericranium"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The <strong>infection</strong> has likely <strong>spread</strong> from the <strong>sub-aponeurotic tissue.&nbsp;</strong></p>\n<p>The sub-aponeurotic <strong>loose areolar tissue</strong>&nbsp;of the scalp is referred to as the <strong>dangerous area </strong>of the scalp. <strong>Infection</strong> from this layer can pass <strong>into</strong> the <strong>cranial cavity</strong> through small <strong>emissary veins</strong>, which pass through <strong>parietal foramina</strong> in the calvaria. It can reach intracranial structures causing meningitis and intracranial abscesses.&nbsp;</p>\n<p>The scalp is a soft tissue that covers the calvaria of the skull. It consists of <strong>5 layers</strong> as shown in the image below (mnemonic - SCALP):</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f776806809b54dc2ae3288a68c77042bx1280x1524.JPEG"
    ]
  },
  {
    "text": "A 41-year-old man was brought to the emergency with a profusely bleeding scalp laceration following a road traffic accident. What is the nature and layer of origin of the bleed?",
    "choices": [
      {
        "id": 1,
        "text": "Venous bleed, Loose areolar tissue"
      },
      {
        "id": 2,
        "text": "Venous bleed, Dense connective tissue"
      },
      {
        "id": 3,
        "text": "Arterial bleed, Dense connective tissue"
      },
      {
        "id": 4,
        "text": "Arterial bleed, Loose areolar tissue"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Scalp bleeding</strong> is predominantly<strong> arterial</strong>,<strong>&nbsp;</strong>from the&nbsp;<strong>dense connective tissue</strong>&nbsp;of the scalp.<strong>&nbsp;</strong></p>\n<p>Profuse bleeding from scalp injuries occurs due to:&nbsp;</p>\n<ol>\n<li><strong>Low venous pressure</strong> in the erect posture</li>\n<li>The dense connective tissue&nbsp;holds the <strong>arteries open</strong> and does <strong>not</strong> allow them to <strong>retract</strong> causing profuse bleeding.</li>\n</ol>\n<p>The scalp has an extremely rich blood supply from the <strong>external carotid arteries.</strong> Profuse bleeding from a scalp laceration is usually <strong>fatal</strong> unless it's quickly controlled by <strong>sutures.</strong>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7cf15be4ab744325a40470f1008f51e7x1280x1524.JPEG"
    ]
  },
  {
    "text": "Which of the following muscles is unlikely to be involved in a patient with Bell's palsy?",
    "choices": [
      {
        "id": 1,
        "text": "Orbicularis oris"
      },
      {
        "id": 2,
        "text": "Frontalis"
      },
      {
        "id": 3,
        "text": "Orbicularis oculi"
      },
      {
        "id": 4,
        "text": "Levator palpebrae superioris"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The <strong>motor</strong> component of the&nbsp;<strong>levator palpebrae superiors&nbsp;</strong>is innervated by the&nbsp;<strong>oculomotor </strong>(III cranial) nerve and the&nbsp;<strong>smooth muscle</strong> component is innervated by the <strong>sympathetic nerves</strong>. It is uninvolved in Bell's palsy.</p>\n<p>All the other facial muscles are innervated by the facial nerve and thus will be paralyzed in Bell's palsy.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5b858e839ecc44448099ec3ca542b951x600x721.JPEG"
    ]
  },
  {
    "text": "Match the following muscles of facial expression with their actions.",
    "choices": [
      {
        "id": 1,
        "text": "1-A ; 2-E ; 3-D ; 4-B ; 5-C"
      },
      {
        "id": 2,
        "text": "1-C ; 2-D ; 3-E ; 4-A ; 5-B"
      },
      {
        "id": 3,
        "text": "1-C ; 2-E ; 3-D ; 4-B ; 5-A"
      },
      {
        "id": 4,
        "text": "1-A ; 2-D ; 3-C ; 4-E ; 5-B"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The following are some muscles of facial expression and their actions:</p>\n<ul>\n<li><strong>Orbicularis oculi</strong> - Closing eyelids</li>\n<li><strong>Risorius</strong> - Retracts angle of the mouth, grinning muscle</li>\n<li><strong>Orbicularis oris</strong> - Closes mouth&nbsp;</li>\n<li><strong>Mentalis</strong> - wrinkles chin</li>\n<li><strong>Corrugator supercilli</strong> - frowning</li>\n<li>Zygomaticus major - smiling and laughing</li>\n<li>Depressor anguli oris - depresses angle of mouth</li>\n<li>Levator labii superioris - elevates upper lip</li>\n<li>Depressor labii inferioris - depresses lower lip</li>\n<li>Buccinator - known as whistling muscle, it flattens the cheeks against the gums and teeth</li>\n</ul>\n<p>Note: Modiolus is a fibromuscular structure formed by the interlacing of 5 muscles.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/88c088909d124bdd9ac9e930fd15d1e7x600x721.JPEG"
    ]
  },
  {
    "text": "Which of the following muscles plays a role in winking?",
    "choices": [
      {
        "id": 1,
        "text": "Levator palpebrae superioris"
      },
      {
        "id": 2,
        "text": "Corrugator supercilii"
      },
      {
        "id": 3,
        "text": "Orbicularis oculi"
      },
      {
        "id": 4,
        "text": "Frontalis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The <strong>orbicularis oculi</strong> muscle plays a role in winking.</p>\n<p>The orbicularis oculi are circumorbital muscles that are broad, flat and elliptical. They surround the circumference of the orbit and spread into the adjascent regions. It has orbital, palpebral and lacrimal parts. It plays an important role in modulating facial expression and various ocular reflexes. It mainly <strong>closes</strong> the<strong> eyelids.</strong></p>\n<p>It is <strong>supplied</strong> by branches of the facial, superficial temporal, maxillary and ophthalmic arteries. It is <strong>innervated</strong> by the temporal and zygomatic branches of the facial nerve.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f45415602a2c40c4914d9b733f8cfd38x600x721.JPEG"
    ]
  },
  {
    "text": "A patient presents with a loss of sensation over the marked area. Which nerve may be damaged?",
    "choices": [
      {
        "id": 1,
        "text": "Auriculotemporal nerve"
      },
      {
        "id": 2,
        "text": "Maxillary nerve"
      },
      {
        "id": 3,
        "text": "Great auricular nerve"
      },
      {
        "id": 4,
        "text": "Facial nerve"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The <strong>skin </strong>over the<strong> angle of the mandible</strong> is innervated by the <strong>g</strong><strong>reat auricular nerve</strong>.</p>\n<p>Most of the skin covering the face is innervated solely by branches of the trigeminal nerve except the skin over the angle of the mandible which is supplied by the great auricular nerve from the C2 cervical plexus and the ear supplied by the vagus nerve, the facial nerve, and the cervical plexus.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/27a7e52eb6b2418aadadcb4017184afd.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/51cb43ad6cf64012b6d2faf34cac540ex600x683.JPEG"
    ]
  },
  {
    "text": "While testing the cranial nerves in a stroke patient, you ask her to try to whistle. Which of the following structures doesn't pierce the muscle responsible for this action?",
    "choices": [
      {
        "id": 1,
        "text": "Parotid duct"
      },
      {
        "id": 2,
        "text": "Molar glands of the cheek"
      },
      {
        "id": 3,
        "text": "Buccal branch of the facial nerve"
      },
      {
        "id": 4,
        "text": "Buccal branch of the mandibular nerve"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The <strong>buccinator</strong> muscle is involved in flattening the cheeks against the gums and teeth. Hence, it is known as the <strong>whistling muscle</strong>. The&nbsp;<strong>buccal branch</strong> of the <strong>facial nerve innervates</strong> the <strong>buccinator</strong> muscle but does not pierce it.</p>\n<p>The structures piercing the buccinator muscle are:</p>\n<ol>\n<li>Parotid duct</li>\n<li>Buccal branch of the mandibular nerve</li>\n<li>Molar mucous glands which lie on the buccopharyngeal fascia around the parotid duct</li>\n</ol>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following nerves is related to Dorello's canal?",
    "choices": [
      {
        "id": 1,
        "text": "Trochlear nerve"
      },
      {
        "id": 2,
        "text": "Oculomotor nerve"
      },
      {
        "id": 3,
        "text": "Abducens nerve"
      },
      {
        "id": 4,
        "text": "Trigeminal nerve"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Abducens nerve</strong> is related to <strong>Dorello's canal.</strong> The abducens nerve enters the cavernous sinus by passing within this canal.</p>\n<p>Dorello's canal is an <strong>interdural space</strong> limited superiorly by the petrosphenoidal ligament, laterally by the petrous apex, and medially by the dorsum sellae. This is a confluence of superior petrosal, inferior petrosal, cavernous sinus, and basilar plexus venous sinuses.</p>\n<p>Dorello's canal anatomy was noted to be clinically significant in understanding sixth nerve palsy. The clinical implications turned toward its relevance to skull base surgery, mostly for petroclival lesions.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/209294beaa9a48a08307cb10f7a513bex600x545.JPEG"
    ]
  }
];
        let quizName = '28 Osteology, Scalp And Face';
        let hierarchy = ["Marrow", "qBank", "Anatomy"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>