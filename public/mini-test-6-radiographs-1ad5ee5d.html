<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini Test- 6 (Radiographs) - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / FMGE Mini Test Series / 2024
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A 50-year-old smoker presents with intermittent chest pain, left arm pain, and ptosis, along with a month-long history of unintentional weight loss. His chest X-ray shows a mass at the left lung apex with adjacent rib destruction. Further imaging, which shows high uptake within the tumor, was performed. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Small cell carcinoma of the lung"
      },
      {
        "id": 2,
        "text": "Bronchial carcinoid tumour"
      },
      {
        "id": 3,
        "text": "Pancoast tumor"
      },
      {
        "id": 4,
        "text": "Adenocarcinoma of the lung"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario with the imaging findings points towards diagnosis of<strong> Pancoast tumour</strong>(superior sulcus tumour).</p>\n<p><strong>Pancoast\u2019s tumour</strong> is a rare form of lung cancer that originates at the <strong>apex </strong>of the lung. It has a unique presentation due to the <strong>stellate ganglion, chest wall</strong> and <strong>brachial plexus involvement. </strong></p>\n<p>It can invade the <strong>brachial plexus </strong>(C8 and T1 commonly), resulting in a<strong> radicular distribution </strong>of <strong>pain </strong>along the <strong>ulnar nerve</strong>. Invasion of the <strong>stellate ganglion</strong> results in <strong>Horner\u2019s syndrome</strong> which presents with <strong>ipsilateral ptosis, miosis, enophthalmos, and anhidrosis</strong>. <strong>Shoulder</strong> and <strong>chest pain </strong>on the same side can result from the invasion into the <strong>chest wall</strong> and the<strong> 1st and/or 2nd rib</strong>s. Local spread, if involving the trachea or esophagus can result in <strong>dyspnea</strong> or <strong>dysphagia.</strong>\u00a0</p>\n<p>Investigations:</p>\n<ul>\n<li><strong>MRI &gt; CT</strong> is the <strong>investigation of choice</strong> for superior sulcus tumour/ Pancoast tumour.</li>\n<li><strong>FDG-PET</strong> scan shows <strong>high uptake</strong> by the tumour cells. FDG is taken up by all metabolizing cells but more avidly by cancer cells.</li>\n<li><strong>Bronchoscopy</strong> can be done in endobronchial tumours to obtain a tissue diagnosis.</li>\n</ul>\n<p>Management is summarized in the flowchart as shown below.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/040601b1e96944c0b0660d370dfce1b7.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/47460bc51cd64c32a49dcf30dabb28a6x1280x2864.JPEG"
    ]
  },
  {
    "text": "The following X-rays depicts_______?",
    "choices": [
      {
        "id": 1,
        "text": "Osteosarcoma"
      },
      {
        "id": 2,
        "text": "Melorheostosis"
      },
      {
        "id": 3,
        "text": "Osteopoikilosis"
      },
      {
        "id": 4,
        "text": "Osteopathia striata"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given x ray depicts<strong> Melorheostosis.</strong></p>\n<p><strong>Melorheostosis:</strong>\u00a0It is also known as Leri's Disease. It\u00a0is a rare mesenchymal dysplasia manifesting as regions of sclerosis of cortices with a characteristic <strong>dripping wax appearance or flowing candle wax appearance</strong>. The presentation is usually monostotic and unilateral. Symptoms include pain, deformity, skin and circulation problems and contractures.</p>\n<p><strong>Osteopoikilosis</strong> is a benign autosomal dominant sclerosing bone dysplasia with multiple bone islands in a peri-articular distribution in tubular bones, pelvis and scapulae. They are typically bilateral and symmetrical.</p>\n<p><strong>Osteopathia striata</strong>, is a rare, benign dysplasia of bone with radiographically prominent vertical striations involving the epiphysis and metaphysis of tubular bones. It is typically asymptomatic, although there can be associated joint discomfort.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/27e0dc8665df4296a09883f171bd7c61.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 5-year-old girl presents with neck webbing and a low posterior hairline. On examination, she has restricted neck mobility and elevated scapulae on both sides. X-ray neck findings are shown below. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Poland syndrome"
      },
      {
        "id": 2,
        "text": "Klippel-Feil syndrome"
      },
      {
        "id": 3,
        "text": "Turner syndrome"
      },
      {
        "id": 4,
        "text": "Diffuse idiopathic skeletal hyperostosis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario with an xray neck showing <strong>fusion of C6, C7, </strong>and<strong> T1 vertebrae</strong> suggests a diagnosis of <strong>Klippel-Feil syndrome</strong>.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/de4f75ac18714e2dac1b37071fff1d1b.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0a46c9d5686a4734acf0fae668f9e9efx1280x2777.JPEG",
      "https://cdn1.dailyrounds.org/uploads/2d1a1d9e9fed4651afe9ac60a87fe6dd.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3969bb1ea0eb491a83ce8eb1215107bbx242x254.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/979fd466be0942e7ae13f51266552230x1167x943.PNG"
    ]
  },
  {
    "text": "Identify the structure shown by the arrow.",
    "choices": [
      {
        "id": 1,
        "text": "Bile duct"
      },
      {
        "id": 2,
        "text": "Pancreatic duct"
      },
      {
        "id": 3,
        "text": "Common hepatic duct"
      },
      {
        "id": 4,
        "text": "Portal vein"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The structure marked is the <strong>common hepatic duct.</strong></p>\n<p>ERCP stands for <strong>Endoscopic Retrograde Cholangio Pancreaticography.</strong> A side-viewing endoscope is passed through the pylorus of the stomach into the second part of the duodenum to visualize the papilla. It is then cannulated, and dye is injected into the pancreatic or bile duct to visualize the pancreatic or biliary tree. It can be both therapeutic and diagnostic.</p>\n<p><strong>Endoscopic retrograde cholangiopancreatography (ERCP)</strong> is performed using a <strong>side-viewing fibreoptic duodenoscope</strong>.</p>\n<p>The ampulla of Vater is intubated, and contrast is injected into the biliary and pancreatic ducts to display the anatomy radiologically.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/079b2930e9cc40a587db59297dbe555c.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/99370be09ca54c229ff5e5e2740a2d54x1279x1339.JPEG"
    ]
  },
  {
    "text": "A young man presents with seizures that are resistant to medication. The skull X-ray findings are shown below. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Sturge-Weber syndrome"
      },
      {
        "id": 2,
        "text": "Tuberous sclerosis"
      },
      {
        "id": 3,
        "text": "Lipoma of corpus callosum"
      },
      {
        "id": 4,
        "text": "Meningioma"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given X-ray shows <strong>bracket calcification </strong>which is seen in the\u00a0<strong>lipoma of the corpus callosum.</strong></p>\n<p>Majority of the lipomas arise near the corpus callosum. These tumors have <strong>marginal calcification</strong> where they merge with the adjacent cortical tissues. This gives rise to the characteristic <strong>bracket appearance</strong>. Intracranial lipomas are asymptomatic. Epileptic seizures are common and are occasionally refractory to anticonvulsant treatment.</p>\n<p>Other options:</p>\n<p>Option A- Sturge\u2013Weber syndrome<strong>\u00a0</strong>shows the following features:</p>\n<ul>\n<li>Facial <strong>port-wine stain</strong> along the course of the trigeminal nerve</li>\n<li>Ipsilateral venous angiomas in the cortical leptomeninges</li>\n<li><strong>Mental retardation</strong></li>\n<li><strong>Seizures</strong>, hemiplegia</li>\n<li>Skull radio-opacities i.e\u00a0<strong>tram track calcification</strong>.</li>\n</ul>\n<p>\u00a0Below image shows Tram track calcification</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/0c219cfef8a9485db0627adbe5108812.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/39e1098d99c442b69335d1f76b8de15dx720x720.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a69f9db7d88846d4842754bd7ef68b50x512x669.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2b267041251846858dc4b7592c231f34x720x473.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e4744bb343cf4caba52cc11c48e4ee37x720x504.JPEG"
    ]
  },
  {
    "text": "A 56-year-old patient presents with fever, chills, and a cough with sputum production. His blood pressure is 150/88 mmHg, pulse rate is 110 bpm, respiratory rate is 18, and SpO2 is 88% on room air. An X-ray is shown below. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Tubercular pleural effusion"
      },
      {
        "id": 2,
        "text": "Community acquired pneumonia"
      },
      {
        "id": 3,
        "text": "Coal worker Pneumoconiosis"
      },
      {
        "id": 4,
        "text": "Silicosis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The clinical presentation, along with chest X-ray findings showing lobar involvement, suggest a diagnosis of community-acquired pneumonia.</p>\n<p>Clinical features include<span data-preserver-spaces=\"true\">\u00a0acute onset <strong>fever</strong>, <strong>cough</strong> (with or without sputum production), and <strong>shortness of breath</strong>. In some cases, pleuritic chest pain, tachycardia, tachypnea, hypoxemia, or increased work of breathing may be present on physical examination.</span></p>\n<p>Diagnosis can be made using<span data-preserver-spaces=\"true\"> a <strong>chest X-ray</strong>. The presence of an <strong>infiltrate</strong> on a <strong>plain chest radiograph</strong> is considered the <strong>gold standard</strong> for diagnosing pneumonia. Radiographic findings consistent with the diagnosis of CAP include <strong>lobar consolidations</strong>, interstitial infiltrates, and/or cavitations. CT chest is used for better resolution or if chest X-ray was non-diagnostic. Blood and sputum cultures are obtained to guide the antibiotic regimen.</span></p>\n<p>Other<strong>\u00a0</strong>options:</p>\n<p>Option A: <strong>Pleural effusion</strong> may present with <strong>dyspnea</strong>, <strong>pleuritic pain</strong>, <strong>dry cough</strong>, and associated symptoms like fever, weight loss, oedema, and ascites depending on the aetiology. On examination, there may be tachypnea, <strong>dullness</strong> on <strong>percussion</strong> and decreased/absent breath sounds at the base(s).</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/6cf15ff534884489b364b264a622e936.JPEG"
    ],
    "explanation_images": [
      "https://cdn1.dailyrounds.org/uploads/f343b2f8835946178f525c7b98b70f0d.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0e9ec8a41b584633b17a26170da003bex720x565.JPEG"
    ]
  },
  {
    "text": "A 68-year-old male presents with chronic back pain, easy fatigability, and a history of multiple urinary tract infections over the past 3 months. His ESR is elevated, and a skull X-ray is shown below. Which of the following investigations would be useful for diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "MRI brain"
      },
      {
        "id": 2,
        "text": "PET scan"
      },
      {
        "id": 3,
        "text": "Head CT scan with contrast"
      },
      {
        "id": 4,
        "text": "Serum electrophoresis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The clinical scenario is indicative of<strong> multiple myeloma, </strong>and a useful diagnostic test would be<strong> serum electrophoresis.</strong></p>\n<p><strong>Multiple myeloma</strong> involves a malignant proliferation of plasma cells, resulting in excessive production of abnormal immunoglobulins, causing a spike called the M band in Serum Electrophoresis.</p>\n<p>The given image demonstrates a sharp peak (\"church spire\u201d or <strong>M band</strong>) in the gamma globulin region. This is characteristically seen in\u00a0a patient with <strong>multiple myeloma.</strong></p>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/0d30637c003e4896817ff21535a70228.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2a77a64f9e2f4d8eb7bf136e84ee0116x720x291.JPEG"
    ]
  },
  {
    "text": "A 13-year-old boy presents to you with limitation of abduction and internal rotation of the left hip. The X-ray appearance of his left hip joint is shown in the below image. What is the diagnosis of this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Slipped capital femoral epiphysis"
      },
      {
        "id": 2,
        "text": "Perthes disease"
      },
      {
        "id": 3,
        "text": "Developmental Dysplasia of hip"
      },
      {
        "id": 4,
        "text": "Ankylosing spondylitis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario and<strong> trethowan's sign</strong>&nbsp;seen in the x-ray are suggestive of&nbsp;<strong>slipped capital femoral epiphysis</strong> (SCFE).</p>\n<p>The <strong>Klein line</strong> is a line along the superior aspect of the femoral neck which normally intersects the epiphysis. In SCFE, Klein's line does not intersect the epiphysis and passes superior to it. This is known as <strong>Trethowan's sign</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b705637520114c86b85853ee3e68b2db.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/36d68f0d17ec4d609106778933139f66x1024x700.jpeg",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/22636c459bc543449bc93ef7c30abf54x720x513.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/13d85a2c20a74fec8221e2dd17722672x1024x1024.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c0e68d30b02a4962b2ae47e88c96def2x419x659.PNG"
    ]
  },
  {
    "text": "The barium swallow images of different conditions of the esophagus are given below. Which of the following images represents the condition characterized by the manometric findings given below?",
    "choices": [
      {
        "id": 1,
        "text": "Image 1"
      },
      {
        "id": 2,
        "text": "Image 3"
      },
      {
        "id": 3,
        "text": "Image 2"
      },
      {
        "id": 4,
        "text": "Image 4"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The diagnosis based on the given features is\u00a0<strong>diffuse esophageal spasm </strong>(DES)/ Distal esophageal spasm. <strong>Image 2 </strong>showing a\u00a0<strong>rosary bead or corkscrew appearance</strong> of the esophagus on a barium swallow represents the condition.</p>\n<p>DES is a <strong>hypermotility</strong> disorder of the esophagus that manifests as <strong>dysphagia and chest pain </strong>that may radiate to the jaw, arms, and upper back. It is more common in the <strong>distal two-thirds</strong> of the oesophageal body. Muscular hypertrophy and degeneration of the branches of the vagus nerve in the esophagus are seen in this condition. Oesophageal contractions are repetitive, simultaneous, and of high amplitude.\u00a0</p>\n<div class=\"page\" title=\"Page 1061\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<div class=\"page\" title=\"Page 1061\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<div class=\"page\" title=\"Page 1061\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<div class=\"page\" title=\"Page 1062\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>The diagnosis of DES is made by radiographic and manometric studies. Manometric findings are:</p>\n<ul>\n<li>Normal\u00a0integrated relaxation pressure in manometry.</li>\n<li>Premature spastic contractions.</li>\n<li>Distal contractile integral (DCI) &gt;450 mmHg.</li>\n</ul>\n<p>On barium swallow, a\u00a0<strong>rosary bead or corkscrew appearance</strong>\u00a0is seen. It indicates tertiary contractions and <strong>advanced disease</strong>.</p>\n<p>Treatment is with <strong>long-acting nitrates</strong>, calcium channel-blocking agents, sedatives, and anticholinergics. <strong>Bougie dilation</strong> of the esophagus relieves dysphagia in many patients. <strong>Intrasphincteric injection of botulinum toxin</strong> has been tried. Surgery is indicated for patients who fail to respond to medical or endoscopic therapy.</p>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n<div class=\"page\" title=\"Page 1060\">\u00a0</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/7849ce6276ec4c7d9b5f468be2203c8c.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f27f762591424bc8998e673c0962dac8x336x582.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/14c1b8e5167a4345bd2bc79d2e5d4043x513x962.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1a636fcce708462189a3453747518fbfx720x1109.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/006c045e33ee46e18d248abcdc8539ebx896x1200.JPEG"
    ]
  },
  {
    "text": "A worker from the cement industry got a chest X-ray as a part of his routine health check-up. What could cause the findings in the given chest X-ray?",
    "choices": [
      {
        "id": 1,
        "text": "Berylliosis"
      },
      {
        "id": 2,
        "text": "Tuberculosis"
      },
      {
        "id": 3,
        "text": "Asbestosis"
      },
      {
        "id": 4,
        "text": "Silicosis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p style=\"margin: 0cm 0cm 7.5pt 0cm;\"><span style=\"font-size: 10.5pt; font-family: 'Source Sans Pro',sans-serif;\">The findings in the chest X-ray suggest <strong>asbestosis.</strong></span></p>\n<p style=\"margin: 0cm 0cm 7.5pt 0cm;\"><span style=\"font-size: 10.5pt; font-family: 'Source Sans Pro',sans-serif;\">The given X-ray shows irregular opacities, which appear to be <strong>pleural thickenings i.e., pleural plaques</strong>. The sign along with a history of working in the <strong>cement</strong> <strong>industry </strong>suggests a diagnosis of\u00a0<strong><span style=\"font-family: 'Source Sans Pro',sans-serif;\">asbestosis</span></strong>. It predominantly affects the<strong> lower lobes </strong>of the lung, in contrast to other forms of pneumoconiosis, which affect the upper lobes.\u00a0</span></p>\n<p style=\"margin: 0cm 0cm 7.5pt 0cm;\"><span style=\"font-size: 10.5pt; font-family: 'Source Sans Pro',sans-serif;\">Workers in the <strong><span style=\"font-family: 'Source Sans Pro',sans-serif;\">cement, shipping, and textile</span></strong> industries are at a higher risk of developing asbestosis. Asbestos tends to involve the pleura first.\u00a0The earliest manifestation is benign asbestosis-related pleural effusion. With time, the plaques are calcified resulting in the formation of thick pleural plaques. The pleural thickenings can be seen on the X-ray. This is the \u201c<strong><span style=\"font-family: 'Source Sans Pro',sans-serif;\">holly leaf sign</span></strong>\u201d.</span></p>\n<p style=\"margin: 0cm 0cm 7.5pt 0cm;\"><span style=\"font-size: 10.5pt; font-family: 'Source Sans Pro',sans-serif;\">Lung parenchymal involvement occurs after years of exposure (at least 10 years). They present with cough and exertional dyspnoea. Pulmonary function testing in asbestosis typically shows a\u00a0<strong><span style=\"font-family: 'Source Sans Pro',sans-serif;\">restrictive pattern</span></strong>\u00a0with a decrease in both lung volumes and diffusing capacity.</span></p>\n<p style=\"margin: 0cm 0cm 7.5pt 0cm;\"><span style=\"font-size: 10.5pt; font-family: 'Source Sans Pro',sans-serif;\">Other options:</span></p>\n<p style=\"margin: 0cm 0cm 7.5pt 0cm;\"><span style=\"font-size: 10.5pt; font-family: 'Source Sans Pro',sans-serif;\">Option A: <strong>Berylliosis</strong> (chronic beryllium disease) commonly occurs in workers exposed to beryllium, typically in industries like electronics or aerospace, not in cement. On imaging, it usually presents with diffuse interstitial lung disease, nodules, or enlarged hilar lymph nodes.</span></p>\n<p style=\"margin: 0cm 0cm 7.5pt 0cm;\"><span style=\"font-size: 10.5pt; font-family: 'Source Sans Pro',sans-serif;\">Option B: <strong>Tuberculosis (TB)</strong> often appears as upper lobe infiltrates, cavitation, or miliary patterns on imaging.</span></p>\n<p style=\"margin: 0cm 0cm 7.5pt 0cm;\"><span style=\"font-size: 10.5pt; font-family: 'Source Sans Pro',sans-serif;\">Option D: <strong>Silicosis,</strong> often seen in industries such as mining or quarrying, presents with nodular opacities, especially in the upper lobes, and may have <strong>eggshell </strong>calcifications in the hilar lymph nodes.</span></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/222ee5db9bd64f468d411175da5b63ba.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A newborn developed tachypnea and grunting immediately after birth. On examination, the baby was cyanotic, with a scaphoid abdomen. A chest radiograph was taken, which is shown below. Which of the following should be avoided in the management of this baby?",
    "choices": [
      {
        "id": 1,
        "text": "Extracorporeal membrane oxygenation"
      },
      {
        "id": 2,
        "text": "Endotracheal ventilation"
      },
      {
        "id": 3,
        "text": "Bag and mask ventilation"
      },
      {
        "id": 4,
        "text": "High-frequency oscillatory ventilation"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario and the x-ray showing<strong>&nbsp;herniation of the bowel loops into the chest </strong>and absence of bowel loops in the abdomen are suggestive of <strong>congenital diaphragmatic hernia. Bag and mask ventilation</strong> is to be <strong>avoided</strong> in the management of this baby.</p>\n<p><strong>Congenital diaphragmatic hernia (CDH) </strong>is a birth defect of the diaphragm. Malformation of the diaphragm allows the abdominal organs to push into the chest cavity, hindering proper lung formation and resulting in pulmonary hypoplasia. The most common type of CDH is a <strong>Bochdalek</strong> <strong>hernia and </strong>in most cases involving the <strong>left side</strong>.<strong>&nbsp;</strong>CDH is a life-threatening pathology in infants and a major cause of morbidity and mortality due to two complications:&nbsp;<strong>pulmonary</strong> <strong>hypoplasia</strong> and <strong>pulmonary</strong> <strong>hypertension</strong>.</p>\n<p>Babies with CDH present with <strong>respiratory distress</strong> characterized by tachypnea, grunting, use of accessory muscles, and cyanosis. They may also have a scaphoid abdomen and increased chest wall diameter. Auscultation of the chest may reveal bowel sounds with reduced breath sounds.</p>\n<p>Diagnosis: A chest radiograph and nasogastric tube passage can confirm the diagnosis of CDH. Prenatal diagnosis can be made using ultrasonography between 16 to 24 weeks of gestation.</p>\n<p><strong>Treatment:</strong></p>\n<p>The immediate step in the management is the naso- or orogastric tube placement for decompression. The airway is to be secured with <strong>endotracheal intubation</strong> (option B) and respiratory distress is stabilised. Bag and mask ventilation may increase the abdominal distension and limit the expansion of the hypoplastic lungs. Hence, <strong>bag and mask ventilation</strong> should be<strong> avoided</strong>.</p>\n<p><strong>Extracorporeal membrane oxygenation (ECMO)</strong>&nbsp;(option A) and <strong>high-frequency oscillatory ventilation</strong> (Option D) have been used as a part of the ventilation strategy to support respiratory failure. The main goal is to maintain oxygenation to the lungs and carbon dioxide washout without causing volutrauma.</p>\n<p>Surgical repair of the defect is to be considered at least 48 hours after stabilization and resolution of pulmonary hypertension.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/eb4f63e40dd142148ac938c672886b85.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Following appearance in IVP is diagnostic of ______.",
    "choices": [
      {
        "id": 1,
        "text": "Retrocaval ureter"
      },
      {
        "id": 2,
        "text": "Retroperitoneal fibrosis"
      },
      {
        "id": 3,
        "text": "Medullary sponge kidney"
      },
      {
        "id": 4,
        "text": "Multicystic dysplastic kidney"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The image depicts the <strong>maiden waist sign</strong> seen in retroperitoneal fibrosis.</p>\n<p><strong>Maiden waist deformity</strong> is the appearance of the <strong>deviation of bilateral ureters</strong>. This typically occurs in <strong>retroperitoneal fibrosis</strong>. In this condition, there is <strong>a medial drawing of the ureter</strong>\u00a0due to the deposition\u00a0of fibrous tissue in the lumbosacral junction. Due to the involvement of both ureters, the course of the medially-drawn ureters is said to have an appearance of a narrow waist maiden, thus giving the name.</p>\n<p>Other options:</p>\n<p>Option A: In the <strong>retrocaval ureter</strong>, the ureter abnormally loops behind the IVC, causing a characteristic <strong>S-shaped</strong> or <strong>fishhook </strong>appearance.</p>\n<p>Option C: <strong>Medullary sponge kidney</strong> is a congenital disorder characterized by dilated renal tubules, which leads to a <strong>paintbrush</strong>\u00a0appearance of the renal papillae on IVP due to small calculi in the collecting ducts.\u00a0</p>\n<p>Option D: <strong>Multicystic dysplastic kidney</strong> is a congenital anomaly where the kidney is replaced by multiple cysts of varying sizes, and the ureter may be atretic or absent.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/48705f35ba724049a8a71c02e7051ed0.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A post\u2013myocardial infarction patient presented to the emergency room with sudden-onset breathlessness and cough with frothy sputum. The patient's chest x-ray, on PA view, revealed the following findings. Identify the lines.",
    "choices": [
      {
        "id": 1,
        "text": "Kerley B lines"
      },
      {
        "id": 2,
        "text": "Kerley A lines"
      },
      {
        "id": 3,
        "text": "Kerley C lines"
      },
      {
        "id": 4,
        "text": "Kerley D lines"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The above clinical features are suggestive of <strong>pulmonary edema</strong> due to<strong>\u00a0left-sided heart failure</strong>,<strong>\u00a0</strong>and<strong>\u00a0</strong><strong>Kerley B lines\u00a0</strong>are characteristic findings seen in this setting.\u00a0Kerley B lines are horizontal subpleural lines, 1 cm in length and 1\u20133 mm in thickness, usually seen in the <strong>middle or lower zone</strong> of the lungs.\u00a0</p>\n<p><strong>Radiological signs of left-sided heart failure:</strong></p>\n<ul>\n<li>Cardiomegaly - Enlargement of the cardiac silhouette</li>\n<li><strong>Kerley B lines</strong> - Horizontal lines in the periphery of the lower posterior lung fields</li>\n<li>Upper lobe pulmonary venous congestion\u00a0</li>\n<li>Interstitial edema</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/0c7bd5ed8eb54dd4b28eab9fbe565f33.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/126901b9554746708f558cb873515c5dx742x1024.JPEG"
    ]
  },
  {
    "text": "A 30-year-old patient with complaints of inability to conceive underwent the following investigation. Which of the following is false about the same?",
    "choices": [
      {
        "id": 1,
        "text": "The best time to perform it is before ovulation"
      },
      {
        "id": 2,
        "text": "It is perfomed to detect uterine anomalies"
      },
      {
        "id": 3,
        "text": "It is the first-line investigation in genital tuberculosis"
      },
      {
        "id": 4,
        "text": "Premedication can be done with atropine"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given image shows a <strong>hysterosalpingogram (HSG).</strong>\u00a0HSG is\u00a0<strong>contraindicated </strong>in\u00a0<strong>g</strong><strong>enital tuberculosis.</strong></p>\n<p><strong>Procedure of HSG:</strong></p>\n<ul>\n<li>It is best performed in the period between the last day of menses to\u00a0<strong>ovulation,</strong> usually on the 9th/10th day of the cycle (option A).</li>\n<li>10-15ml radioopaque dye is injected into the uterine cavity via\u00a0<strong>Leech-Wilkinson</strong> cannula,<strong> Rubin's</strong> cannula, or<strong> Foley's catheter</strong>.</li>\n<li>Fluoroscopy is performed as the dye\u00a0passes through the uterine cavity and fallopian tubes.\u00a0</li>\n<li>If the tubes are patent, the dye will spill out of the tubal ostia into the peritoneum, and smear the adjacent bowel.</li>\n</ul>\n<p>It is used for the<strong> detection of:</strong></p>\n<ul>\n<li>Tubal block - It can be due to:\n<ul>\n<li>Strictures - fibrotic block</li>\n<li>Inspissated amorphous material</li>\n<li>Tubal <strong>spasm</strong> - This\u00a0can occur in apprehensive patients. It is <strong>prevented</strong> by premedication with <strong>atropine </strong>and analgesia (option D).</li>\n</ul>\n</li>\n<li>Uterine anomalies (option B)</li>\n<li>Uterine polyps</li>\n<li>Uterine synechiae</li>\n<li>The feasibility of tuboplasty, by studying the location and extent of tubal pathology.</li>\n</ul>\n<p><strong>Contraindications:</strong></p>\n<ul>\n<li>Genital tract infections, such as genital tuberculosis. This is due to the risk of spreading infection.</li>\n<li>Bleeding</li>\n<li>Suspected pregnancy</li>\n<li>Allergy to the dye</li>\n<li>Premenstrual phase:\n<ul>\n<li>If by chance pregnancy has occurred, it may be dislodged.</li>\n<li>Thick endometrium might prevent the smooth flow of the dye, at the cornual end.</li>\n<li>There is a risk of embolism and endometriosis if HSG is done during this phase.</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d9c423277010499b96e46e75c63e5ce5.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 45-year-old woman presents with chronic pain and stiffness in the knees. An X-ray of her knee is shown below. The patient is most likely suffering from which of the following conditions?",
    "choices": [
      {
        "id": 1,
        "text": "Pseudogout"
      },
      {
        "id": 2,
        "text": "Rheumatoid arthritis"
      },
      {
        "id": 3,
        "text": "Osteoarthritis"
      },
      {
        "id": 4,
        "text": "Osteoporosis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>This patient's complaints of chronic joint <strong>discomfort </strong>and <strong>radiograph</strong>\u00a0indicating the presence of <strong>subchondral sclerosis,</strong>\u00a0<strong>osteophytes,\u00a0</strong>and <strong>narrowing</strong> of the <strong>joint space</strong> strongly imply a diagnosis of <strong>osteoarthritis</strong>.</p>\n<p><strong>Osteoarthritis</strong> is a <strong>degenerative</strong> <strong>joint</strong> <strong>disease</strong> characterized by the <strong>breakdown</strong> <strong>of</strong> <strong>joint</strong> <strong>cartilage</strong> and underlying bone changes. The typical clinical features include chronic <strong>joint</strong> <strong>pain</strong>, <strong>stiffness</strong>, and <strong>limited</strong> range of motion, as well as radiographic findings of joint space <strong>narrowing</strong>, <strong>osteophyte</strong> formation, and <strong>subchondral</strong> <strong>sclerosis</strong>.\u00a0</p>\n<p><strong>Management</strong> of osteoarthritis often involves a combination of non-pharmacological and pharmacological treatments, such as <strong>weight</strong> <strong>management</strong>, physical therapy, <strong>analgesics</strong>, nonsteroidal anti-inflammatory drugs (<strong>NSAIDs</strong>), and intra-articular injections. In <strong>severe</strong> cases, <strong>joint replacement surgery</strong> may be considered to alleviate symptoms and improve joint function.</p>\n<p>Other options:</p>\n<p>Option A: <strong>Pseudogout</strong>, also known as calcium pyrophosphate deposition disease (<strong>CPPD</strong>), is a type of arthritis that occurs due to the deposition of <strong>calcium pyrophosphate</strong> <strong>crystals</strong> in the joints. It can cause sudden and severe joint pain, swelling, and stiffness. While it can present with joint-specific symptoms, it <strong>does not typically manifest</strong> with the radiographic findings described in the case, ie subchondral cysts, osteophytes and sclerosis. Patients with pseudogout <strong>have</strong> <strong>chondrocalcinosis </strong>as depicted in the image below.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/6cb969f486f040a19d302478413fc3bb.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5db96aa2ec9141a38e1f3b2242035649x1280x1644.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2baf8cf6f1234f238c46b7d15e9d393cx1024x877.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a7f7bf9d4b19454dba4979b8003931f0x570x630.JPEG"
    ]
  },
  {
    "text": "The urinary bladder shown in the MCU image below is commonly diagnostic of _______.",
    "choices": [
      {
        "id": 1,
        "text": "Bladder diverticula"
      },
      {
        "id": 2,
        "text": "Cystic pelvic mass"
      },
      {
        "id": 3,
        "text": "Neurogenic bladder"
      },
      {
        "id": 4,
        "text": "Vesico ureteric reflux"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The above image shows a <strong>pine cone bladder</strong> or <strong>Christmas tree bladder</strong>, in which the bladder is elongated and pointed with a thickened trabeculated wall. It is typically seen in <strong>severe neurogenic bladder.</strong></p>\n<p><strong>Neurogenic bladder</strong> is a term applied to a dysfunctional urinary bladder that results from an injury to the central or peripheral nerves that control and regulate urination.</p>\n<p>There are five types of neurogenic bladder based on the site of the\u00a0lesion.</p>\n<ol>\n<li><strong>Sensory neurogenic bladder</strong>: posterior columns of the spinal cord or afferent tracts leading from the bladder</li>\n<li><strong>Motor paralytic bladder</strong>: damage to motor neurons of the bladder</li>\n<li><strong>Uninhibited neurogenic bladder:</strong> incomplete spinal cord lesions above s2 or cerebral cortex or cerebropontine axis lesions</li>\n<li><strong>Reflex neurogenic bladder</strong>: complete spinal cord lesions above s2 - may lead to pine cone bladder</li>\n</ol>\n<p><strong>Autonomous neurogenic bladder</strong>: conus or cauda equina lesions.<br /><br />Other options:</p>\n<p>Option A:<strong> Bladder diverticula </strong>appear as outpouchings or sacs arising from the bladder wall, which may be visible on an MCU as small, round, or oval outpouchings.</p>\n<p>Option B: A <strong>cystic pelvic mass</strong> would generally be seen as a discrete cystic structure separate from the bladder.</p>\n<p>Option D: <strong>Vesicoureteric reflux (VUR)</strong> involves the abnormal backflow of urine from the bladder into the ureters. On an MCU, VUR would show contrast ascending into the ureters .</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/772b58af33bb467585ff71737125c18e.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 16-year-old girl presents with multiple brown coffee coloured  skin rashes. She has increased uptake on bone scans over the femur, skull, and ribs. Biochemical parameters are abnormal. She also has a history of hypothyroidism. An X-ray of her femur is given below. Which of the following is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Osteoid osteoma"
      },
      {
        "id": 2,
        "text": "Fibrous dysplasia"
      },
      {
        "id": 3,
        "text": "Giant cell tumour"
      },
      {
        "id": 4,
        "text": "Osteosarcoma"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The above X-ray shows the\u00a0<strong>bending </strong>of the <strong>femur</strong> known as<strong>\u00a0Shepherd's crook deformity.\u00a0</strong>It<strong>\u00a0</strong>is seen in\u00a0<strong>fibrous dysplasia </strong>of the proximal femur.\u00a0</p>\n<p>Her symptoms are a part of McCune Albright syndrome.\u00a0McCune Albright syndrome presents as a triad of<strong> cafe-au-lait spots</strong> (cutaneous pigmentation),\u00a0<strong>polyostotic fibrous dysplasia</strong>, and\u00a0<strong>precocious puberty</strong>. It is also associated with\u00a0<strong>multiple endocrinopathies</strong>\u00a0like hyperthyroidism, acromegaly, etc. The locus of involvement is the\u00a0<strong>GNAS1</strong>\u00a0gene.\u00a0</p>\n<p><strong>Cutaneous</strong> pigmentation is more prominent <strong>on the side</strong> with <strong>severe bone</strong> involvement.\u00a0<strong data-stringify-type=\"bold\">Fibrous dysplasia</strong>\u00a0is a condition that affects bone development and is characterized by the\u00a0<strong data-stringify-type=\"bold\">replacement\u00a0</strong>of the<strong data-stringify-type=\"bold\">\u00a0bone</strong>\u00a0with\u00a0<strong data-stringify-type=\"bold\">fibrous tissue.\u00a0</strong>The patient presents with a progressive limb deformity or a fracture through a previously asymptomatic lesion. The presentation often occurs in the\u00a0<strong data-stringify-type=\"bold\">second decade</strong>. Other symptoms include nonspecific bone pain, tenderness, and swelling in the affected area. The commonly involved sites are the\u00a0<strong data-stringify-type=\"bold\">proximal femur, tibia, pelvis, and foot</strong>.</p>\n<div class=\"p-rich_text_section\">Radiological findings include:</div>\n<ul class=\"p-rich_text_list p-rich_text_list__bullet\" data-stringify-type=\"unordered-list\" data-indent=\"0\" data-border=\"0\">\n<li data-stringify-indent=\"0\" data-stringify-border=\"0\">Well-defined, expansile intramedullary lesions</li>\n<li data-stringify-indent=\"0\" data-stringify-border=\"0\">Hazy\u00a0<strong data-stringify-type=\"bold\">ground glass appearance</strong>\u00a0is seen in the majority of cases</li>\n<li data-stringify-indent=\"0\" data-stringify-border=\"0\"><strong data-stringify-type=\"bold\">Shepherd's crook deformity</strong>\u00a0- expansion with <strong>marked varus</strong> in the proximal femur.</li>\n</ul>\n<div class=\"ng-scope\">\u00a0</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/45e4f41c461441d388f0b4a7f1dda4c2.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/cf126e6c690c4afc9a24e0adef28deeex1024x700.jpeg",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/514a38eb5c0b4492a16f6f4a997b0a17x145x240.JPEG"
    ]
  },
  {
    "text": "A 45-year-old male with a history of heart surgery now presents with the chest X-ray shown below. What is the finding indicated by the '?' on the X-ray?",
    "choices": [
      {
        "id": 1,
        "text": "Prosthetic mitral valve"
      },
      {
        "id": 2,
        "text": "Prosthetic aortic valve"
      },
      {
        "id": 3,
        "text": "Artefact"
      },
      {
        "id": 4,
        "text": "Pacemaker"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The structure marked in the image shows a <strong>prosthetic mitral valve</strong> and a pacemaker also in place.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/7638e839d4ec4c50809774007143de6a.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/743addc1b9d14acd86993781bf93eca4x1280x978.JPEG"
    ]
  },
  {
    "text": "A woman who underwent cholecystectomy now presents with abdominal pain one month later. An erect abdominal X-ray was taken, and the image is shown below. Which of the following options best describes the condition?",
    "choices": [
      {
        "id": 1,
        "text": "Novus actus interveniens"
      },
      {
        "id": 2,
        "text": "Res ipsa loquitur"
      },
      {
        "id": 3,
        "text": "Res judicata"
      },
      {
        "id": 4,
        "text": "Respondeat superior"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The x-ray shows a pair of surgical scissors left behind in the abdomen after surgery. The offense comes under <strong>res ipsa loquitur</strong>. It is obvious evidence of the negligent act committed.</p>\n<p>\"<strong>Res ipsa loquitur\"</strong>\u00a0means \"<strong>the thing or fact speaks for itself.\"</strong>\u00a0The negligent act is so <strong>obvious</strong> that the patient <strong>need not prove</strong> the negligence. He has to merely state what according to him was the negligent act.</p>\n<p>This doctrine applies to both civil and criminal negligence. All of the following conditions should be fulfilled for this doctrine:</p>\n<ul>\n<li>In the absence of negligence, there would not have been any injury usually</li>\n<li>The doctor had complete control over the injury-producing instrument or treatment.</li>\n<li>The patient was not a part of contributory negligence.</li>\n</ul>\n<p>Other options:</p>\n<p>Option A:\u00a0<strong>Novus actus interveniens - </strong>A person is responsible not only for his actions but also for the logical consequences of those actions. This principle applies to cases of assault and accidental injury.</p>\n<p>Option C:\u00a0<strong>Res judicata </strong>- If a question of negligence against a doctor has already been decided by a court in a dispute between the doctor and his patient, the patient will not be allowed to contest the same in another legal proceeding, based on the same set of facts. Multiple appeals cannot be made.\u00a0</p>\n<p>Option D:\u00a0The principle of <strong>respondeat superior</strong>\u00a0is used to explain vicarious liability, which explains that the employer is responsible for his employees\u2019 negligence if such an act occurs in the course of the employment and within its scope.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/60c007debb9c4c4f93989c07b1878578.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 35-year-old patient with chronic low-back ache underwent an oblique X-ray of the LS spine. The X-ray is given below. What is the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Normal Spine"
      },
      {
        "id": 2,
        "text": "Spondylolisthesis"
      },
      {
        "id": 3,
        "text": "Spondylolysis"
      },
      {
        "id": 4,
        "text": "Spinal tuberculosis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In the X-ray given, there is a <strong>break</strong> in the region of <strong>pars interarticularlis</strong> of the L4 vertebra, which appears like a <strong>beheaded\u00a0Scottish terrier sign</strong>. This is diagnostic of <strong>spondylolisthesis.</strong>\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/4edb0ebd268142a8bd129218f0b3a42c.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b2e117da7ba14b1d84b4f94f2626c13ex319x356.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/cb396db3386143b7a7578f0e22803c28x940x1600.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/089716fbc8e74850a1f332a1231615c0x1280x1361.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8529954640e249a4839074ae5d958b7bx1280x3636.JPEG"
    ]
  }
];
        let quizName = 'Mini Test- 6 (Radiographs)';
        const quizFilename = 'mini-test-6-radiographs-1ad5ee5d.html';
        let hierarchy = ["Marrow", "FMGE Mini Test Series", "2024"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>