<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>08 Anesthesia Workstation - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Anesthesia
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">31</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following is not a part of the high pressure section of an anesthetic workstation?",
    "choices": [
      {
        "id": 1,
        "text": "Flowmeter"
      },
      {
        "id": 2,
        "text": "Oxygen cylinder"
      },
      {
        "id": 3,
        "text": "Yoke assembly"
      },
      {
        "id": 4,
        "text": "Cylinder pressure gauge"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Flowmeter</strong> is not a part of the high-pressure system. It is a part of the <strong>low-pressure system.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b89f503637f4465bb0ae79a04fcda15fx1280x1351.311706629055.JPEG"
    ]
  },
  {
    "text": "Which of the following is the most commonly used carbon dioxide absorbent in a closed circuit?",
    "choices": [
      {
        "id": 1,
        "text": "Amsorb"
      },
      {
        "id": 2,
        "text": "Sodasorb"
      },
      {
        "id": 3,
        "text": "Soda lime"
      },
      {
        "id": 4,
        "text": "Baralyme"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Soda lime</strong> is the most commonly used carbon dioxide absorbent in circle breathing systems.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "How much carbon dioxide can be absorbed by 100 gm of soda lime?",
    "choices": [
      {
        "id": 1,
        "text": "3L"
      },
      {
        "id": 2,
        "text": "13 L"
      },
      {
        "id": 3,
        "text": "23 L"
      },
      {
        "id": 4,
        "text": "33 L"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>100 gm </strong>of<strong> Soda lime</strong> absorbs<strong> 23 L </strong>of <strong>carbon dioxide.</strong></p>\n<p>Soda lime is the <strong>most commonly</strong> used carbon dioxide absorbent in circle breathing systems.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is true regarding sodalime?",
    "choices": [
      {
        "id": 1,
        "text": "2 and 3"
      },
      {
        "id": 2,
        "text": "3 and 5"
      },
      {
        "id": 3,
        "text": "2 and 4"
      },
      {
        "id": 4,
        "text": "1 and 3"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p dir=\"ltr\" role=\"presentation\">Statement 1: 100 g of sodalime can absorb <strong>23</strong> liters of CO2</p>\n<p>Statement 2: The end product of the reaction of soda lime with CO<sub>2</sub> is&nbsp;<strong>CaCO3+NaOH.&nbsp;</strong>Reaction end products include heat (the heat of neutralization), water, calcium carbonate, and sodium hydroxide.</p>\n<div class=\"page\" title=\"Page 52\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Its reactions are as follows:</p>\n<ol>\n<li>CO<sub>2</sub> + H<sub>2</sub>O &rarr; H<sub>2</sub>CO<sub>3</sub></li>\n<li>H<sub>2</sub>CO<sub>3</sub> + 2NaOH &rarr; Na<sub>2</sub>CO<sub>3</sub> + 2H<sub>2</sub>O + Heat (a fast reaction)</li>\n<li>Na<sub>2</sub>CO<sub>3</sub> + Ca(OH)<sub>2</sub> &rarr; CaCO<sub>3</sub> + 2NaOH + Heat (a slow reaction)</li>\n</ol>\n<p>Note that the water and sodium hydroxide initially required are regenerated.</p>\n</div>\n</div>\n</div>\n<p dir=\"ltr\" role=\"presentation\">Statement 3: The <strong>major</strong> constituent of soda lime is <strong>Ca(OH)2</strong> - 80%</p>\n<p dir=\"ltr\" role=\"presentation\">Statement 4: Water content of sodalime is <strong>15</strong>%</p>\n<p dir=\"ltr\" role=\"presentation\">Statement 5: KOH is one of the components of sodalime - 2%</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An anaesthetist notices that the soda lime is exhausted and requests for it to be changed. If the indicator used is ethyl violet, what would be the color change observed?",
    "choices": [
      {
        "id": 1,
        "text": "Pink to white"
      },
      {
        "id": 2,
        "text": "Purple to white"
      },
      {
        "id": 3,
        "text": "White to Pink"
      },
      {
        "id": 4,
        "text": "White to Purple"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>When carbon dioxide absorbing capacity of soda lime using <strong>ethyl violet</strong> indicator is exhausted, the color changes from&nbsp;<strong>white to purple.</strong></p>\n<p><strong class=\"ng-binding\">Soda lime indicator dye</strong></p>\n<div class=\"panel-body ng-scope\">\n<p class=\"ng-binding ng-scope\">&nbsp;</p>\n<table>\n<tbody>\n<tr>\n<td><strong>Indicator</strong></td>\n<td><strong>Color when Fresh</strong></td>\n<td><strong>Color when Exhausted</strong></td>\n</tr>\n<tr>\n<td>Ethyl violet</td>\n<td>White</td>\n<td>Purple</td>\n</tr>\n<tr>\n<td>Phenolphthalein</td>\n<td>Colorless</td>\n<td>Pink</td>\n</tr>\n<tr>\n<td>Clayton yellow</td>\n<td>Red</td>\n<td>Yellow</td>\n</tr>\n<tr>\n<td>Ethyl orange</td>\n<td>Orange</td>\n<td>Yellow</td>\n</tr>\n<tr>\n<td>Mimosa 2</td>\n<td>Red</td>\n<td>White</td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;</p>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the action of silica when added to soda lime?",
    "choices": [
      {
        "id": 1,
        "text": "Humidifying agent"
      },
      {
        "id": 2,
        "text": "Hardening agent"
      },
      {
        "id": 3,
        "text": "Catalyst"
      },
      {
        "id": 4,
        "text": "Indicator"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Silica in the soda lime acts as a<strong> hardening agent.</strong></p>\n<p>In Amsorb,&nbsp;polyvinylpyrrolidone is used as a hardening agent.</p>\n<p><strong>NaOH and KOH</strong> serve as <strong>catalysts </strong>or activators to speed up the reaction between calcium hydroxide and carbon dioxide.</p>\n<p><strong>Ethyl violet</strong> is the most commonly used <strong>indicator</strong> dye in soda lime.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the ideal size of the carbon dioxide absorbent granules?",
    "choices": [
      {
        "id": 1,
        "text": "1 mesh"
      },
      {
        "id": 2,
        "text": "2 mesh"
      },
      {
        "id": 3,
        "text": "3 mesh"
      },
      {
        "id": 4,
        "text": "4 mesh"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The ideal granule size of the carbon dioxide absorbent is between <strong>4 and 8 mesh </strong>(1.5-5 mm).</p>\n<p>Smaller granule size favors greater area for absorption of carbon dioxide. But, it offers greater airflow resistance (caking).</p>\n<p>Converse is true with larger granule size - the absorptive area is less but airflow resistance is minimal (channeling).</p>\n<p>So, the ideal size is to be between 4 and 8 mesh as absorptive surface area and resistance to flow are optimized.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is true concerning Compound A?",
    "choices": [
      {
        "id": 1,
        "text": "Degradation product of desflurane"
      },
      {
        "id": 2,
        "text": "Neurotoxicity is the major concern"
      },
      {
        "id": 3,
        "text": "Less common with Amsorb absorbent"
      },
      {
        "id": 4,
        "text": "Seen predominantly with high flow techniques"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The true statement concerning <strong>Compound A</strong> is that its formation is <strong>less common with Amsorb</strong> absorbent.</p>\n<p><strong>Compound A</strong> is fluoro-methyl-2,2-difluoro-1-(trifluoromethyl) vinyl ether which is the degradation product of <strong>Sevoflurane,</strong>&nbsp;not desflurane.</p>\n<p>The strong bases like NaOH and KOH present in absorbents (soda lime) lead to its formation. Lack of strong&nbsp;alkali in Amsorb makes its formation less common.</p>\n<p>Compound A is <strong>nephrotoxic</strong>, not neurotoxic.</p>\n<p>It is seen predominantly with <strong>low flow</strong>&nbsp;anesthesia techniques and <strong>high absorbent temperatures.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements regarding baralyme is false?",
    "choices": [
      {
        "id": 1,
        "text": "More efficient than soda lime"
      },
      {
        "id": 2,
        "text": "Performs better in dry climate"
      },
      {
        "id": 3,
        "text": "Less caustic than soda lime"
      },
      {
        "id": 4,
        "text": "Greater tendency to produce carbon monoxide"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The true statement is <strong>baralyme is less efficient than soda-lime.</strong></p>\n<p>Baralyme is less efficient than soda-lime as its absorptive capacity is 9-18L of CO<sub>2</sub>/100 g while of soda lime is 23L&nbsp;of CO<sub>2</sub>/100 g.</p>\n<p>Baralyme with the composition of calcium hydroxide and barium hydroxide (activator) is <strong>less caustic</strong> than soda lime.</p>\n<p>It gives more reliable performance in a <strong>dry</strong> environment.</p>\n<p>As compared to soda lime, baralyme has a greater tendency to produce <strong>carbon monoxide.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An ICU patient who is dependant on oxygen support requires an MRI. What material is used to build the medical gas cylinder which can be used in this scenario?",
    "choices": [
      {
        "id": 1,
        "text": "Stainless steel"
      },
      {
        "id": 2,
        "text": "Molybdenum steel"
      },
      {
        "id": 3,
        "text": "Aluminium"
      },
      {
        "id": 4,
        "text": "Hard plastic"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>MRI compatible</strong> medical gas cylinders are made of <strong>aluminium,&nbsp;</strong>while<strong>&nbsp;</strong>most medical gas cylinders are constructed of molybdenum steel.</p>\n<p>The cylinders are produced in various sizes designated by a capital letter code.</p>\n<ul>\n<li>Size A is the smallest.</li>\n<li>Size H is the largest.</li>\n<li><strong>Size E</strong> is the cylinder <strong>most commonly used</strong> in anesthesia machines, for patient transport, and resuscitation, followed by Size D.&nbsp;</li>\n<li>Size J is commonly used for cylinder manifold systems for central supply.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In order to identify an oxygen cylinder correctly, what colour would you expect the shoulder of the cylinder to be?",
    "choices": [
      {
        "id": 1,
        "text": "White"
      },
      {
        "id": 2,
        "text": "Black"
      },
      {
        "id": 3,
        "text": "Blue"
      },
      {
        "id": 4,
        "text": "Yellow"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Colour of the <strong>shoulder</strong> of oxygen cylinder in India is <strong>white,</strong>&nbsp;and the <strong>body</strong> is <strong>black</strong>.&nbsp;</p>\n<p>Maximum pressure in the oxygen cylinder is around <strong>2000 </strong>psig<strong>.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What gas is the following cylinder used to carry?",
    "choices": [
      {
        "id": 1,
        "text": "Entonox"
      },
      {
        "id": 2,
        "text": "Air"
      },
      {
        "id": 3,
        "text": "Oxygen"
      },
      {
        "id": 4,
        "text": "Nitrous oxide"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Blue cylinders are used to store <strong>nitrous oxide.</strong></p>\n<p>Maximum pressure in the nitrous oxide cylinder is around <strong>745&nbsp;</strong>psig<strong>.</strong></p>\n<p>Critical temperature of nitrous oxide is<strong> 36.5<sup>o</sup>C,&nbsp;</strong>hence it is present in <strong>liquid</strong>&nbsp;form at room temperature.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c3105d9197c64ffb9e4015eec68ea181.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "During a routine evaluation of the operating room before an operation, you hear an alarm from the anesthesia workstation. Assuming it to be due to a leak from the oxygen cylinder, you immediately check the pressure gauge. What would be the maximum pressure that is normally expected in this medical gas cylinder?",
    "choices": [
      {
        "id": 1,
        "text": "750 psig"
      },
      {
        "id": 2,
        "text": "1500 psig"
      },
      {
        "id": 3,
        "text": "2000 psig"
      },
      {
        "id": 4,
        "text": "2500 psig"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Maximum pressure in oxygen cylinder is&nbsp;<strong>2000 psig&nbsp;</strong>(pounds per square inch gauge)</p>\n<p><strong>Maximum pressure in the E-cylinders:</strong></p>\n<ul>\n<li><strong>750 psig </strong>for<strong> nitrous oxide </strong>(<strong>liquid</strong>)</li>\n<li><strong>2000 psig </strong>for<strong> air </strong>(gaseous)</li>\n<li><strong>2000 psig </strong>for<strong> oxygen&nbsp;</strong>(gaseous)</li>\n</ul>\n<p>Each cylinder is passed through a high-pressure regulator, which reduces the high pressures inside the cylinder to a lower, nearly constant pressure of 45 psig, which is suitable for use in the anesthesia machine.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Nitrous oxide cylinder at 100%, 50%, and 25% volume respectively would show the pressure (in PSI) of",
    "choices": [
      {
        "id": 1,
        "text": "750, 750, 750"
      },
      {
        "id": 2,
        "text": "2200, 2200, 2200"
      },
      {
        "id": 3,
        "text": "750, 375, 162.5"
      },
      {
        "id": 4,
        "text": "2200, 1100, 550"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>O<sub>2</sub> pressure gauge reading at full, half, one-fourth and empty cylinder.</strong></p>\n<p>In a cylinder containing a non-liquefied gas such as Oxygen, the pressure in the cylinder decreases as the contents are used. Therefore the <strong>pressure gauge</strong> can be used to measure the cylinder content.</p>\n<p>Oxygen pressure gauge would read 2200, 1100, and 550 PSI at 100%, 50%, and 25% content respectively.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/61594fa542d74771a7e9bb4cab970c63x1280x1719.605077574048.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/cd8dde346caf47b588e6cdb1eee9e440x1280x1719.JPEG"
    ]
  },
  {
    "text": "Identify the gas cylinder based on the pin index shown.",
    "choices": [
      {
        "id": 1,
        "text": "Oxygen"
      },
      {
        "id": 2,
        "text": "Air"
      },
      {
        "id": 3,
        "text": "Nitrous oxide"
      },
      {
        "id": 4,
        "text": "Entonox"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given image shows the Pin index system (3,5) of&nbsp;<strong>Nitrous oxide</strong>.&nbsp;</p>\n<p>Pin index system (PISS) is a safety measure to prevent <strong>incorrect cylinder attachment</strong>.</p>\n<ul>\n<li>Each gas cylinder has<strong> two holes (except entonox)</strong> in its <strong>cylinder valve</strong> that fits the corresponding pins in the yoke of the anesthesia machine. The relative positioning of the pins and holes is unique for each gas which constitutes the pin index system.</li>\n<li>The PISS should only be considered as <strong>partial protection</strong> because pin index failures have been reported due to bent or broken pins.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/924a24439b30415cb2d5bb0aaeaf184e.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "An overworked OT technician brings an oxygen gas cylinder instead of an air cylinder to the theater. However, he realizes his mistake when he is unable to attach it to the hanger-yoke assembly because of the Pin index safety system. What would be the Pin index of the cylinder he is holding?",
    "choices": [
      {
        "id": 1,
        "text": "2, 5"
      },
      {
        "id": 2,
        "text": "1, 5"
      },
      {
        "id": 3,
        "text": "3, 5"
      },
      {
        "id": 4,
        "text": "7"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Pin index system for oxygen gas is 2,5.</strong></p>\n<p>Pin index system (PISS) is a safety measure to prevent incorrect cylinder attachment.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c533a5d5eee649f0a15c481db2f2b004.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "What is the normal hospital pipeline supply of air?",
    "choices": [
      {
        "id": 1,
        "text": "60 psig"
      },
      {
        "id": 2,
        "text": "100 psig"
      },
      {
        "id": 3,
        "text": "600 psig"
      },
      {
        "id": 4,
        "text": "2000 psig"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The normal hospital <strong>pipeline</strong> supply pressure of all gases in India is <strong>60</strong> psig.</p>\n<p>The hospital pipeline supply is the primary source of all gases.&nbsp;2000 psig&nbsp;of oxygen cylinder, which is a part of the high pressure system, is regulated to 45 psig&nbsp;after it enters the anaesthesia workstation.&nbsp;</p>\n<p>The regulated cylinder pressure is 45 psig&nbsp;which is less than that of pipeline pressure.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is prevented by the Diameter Index safety system?",
    "choices": [
      {
        "id": 1,
        "text": "Contamination of the anesthetic environment"
      },
      {
        "id": 2,
        "text": "Delivery of hypoxic gases"
      },
      {
        "id": 3,
        "text": "Incorrect cylinder attachment"
      },
      {
        "id": 4,
        "text": "Incorrect pipeline attachment"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Diameter Index Safety system</strong></p>\n<p>Incorrect cylinder attachment(not pipeline) is prevented by <strong>Pin Index Safety System.</strong></p>\n<p>Contamination of the anesthetic environment by waste gases is prevented by <strong>Scavenging system.</strong></p>\n<p>Delivery of hypoxic gases is prevented by <strong>Oxygen failure safety device</strong> (shut-off or proportionating device).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e0d65c4f15264135884407f1f0571accx1280x1076.JPEG"
    ]
  },
  {
    "text": "The blue pipeline in the operation theatre is used for delivering which of the following gases?",
    "choices": [
      {
        "id": 1,
        "text": "Oxygen"
      },
      {
        "id": 2,
        "text": "Nitrous oxide"
      },
      {
        "id": 3,
        "text": "Air"
      },
      {
        "id": 4,
        "text": "Vacuum"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>blue pipeline</strong> in operation theatre is for <strong>nitrous oxide.</strong></p>\n<p>Other options:</p>\n<p>Oxygen: White</p>\n<p>Air: Black</p>\n<p>Vacuum/Central suction: Yellow</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In a flowmeter sequence, which of the following cylinders is placed downstream?",
    "choices": [
      {
        "id": 1,
        "text": "Nitrous oxide"
      },
      {
        "id": 2,
        "text": "Oxygen"
      },
      {
        "id": 3,
        "text": "Air"
      },
      {
        "id": 4,
        "text": "Any cylinder"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In the first two images, A and B, the nitrous oxide flowmeter is located downstream and there is a leak in the airflow tube. Through this leak, most of the oxygen passes out and mainly nitrous oxide is provided at the outlet leading to the production of a hypoxic mixture.</p>\n<p>But in the other two images, C and D, the oxygen flowmeter is located downstream. Through the leak in the airflow tube, some of the nitrous oxide passes out and the remaining passes out through the outlet with the oxygen. Thus the production of a hypoxic mixture is less likely if oxygen flowmeter is placed downstream.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a536b7980b8d41bbadb34e981bf0e987x1280x1485.JPEG"
    ]
  },
  {
    "text": "What is another name for the flow tubes used in rotameters?",
    "choices": [
      {
        "id": 1,
        "text": "Bornholm tubes"
      },
      {
        "id": 2,
        "text": "Pascal tubes"
      },
      {
        "id": 3,
        "text": "Thorpe tubes"
      },
      {
        "id": 4,
        "text": "Morton tubes"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Key points on Flowmeter:</strong></p>\n<ul>\n<li>Flowmeters are part of the <strong>low-pressure</strong> anesthetic gas supply system.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">The <strong>knobs</strong> are part of the <strong>intermediate</strong> <strong>pressure</strong> system and are textured for easy identification.</li>\n<li>Rotameters are <strong>variable orifice</strong> (area) <strong>constant pressure</strong> flowmeter.</li>\n<li>Thorpe tubes are made of tapered glass tube, the bottom has a smaller diameter than the top.</li>\n<li>The indicator is known as&nbsp;<strong>bobbin</strong> or <strong>float.&nbsp;</strong>Rotating float indicates the flow of gas.</li>\n<li>The Interior of the tube is coated with a conductive substance (gold or tin oxide) in order to reduce the effect of static electricity.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e31d21fc111c4f24a5b8e4dd92a35d48x1200x1600.JPEG"
    ]
  },
  {
    "text": "Read the flow rate of the oxygen depicted in the flow meter.",
    "choices": [
      {
        "id": 1,
        "text": "2 L"
      },
      {
        "id": 2,
        "text": "3 L"
      },
      {
        "id": 3,
        "text": "2.25 L"
      },
      {
        "id": 4,
        "text": "2.75 L"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The flow rate of oxygen in the given image is<strong> 3 L</strong>.</p>\n<p>The indicator present in the Rotameter (Flow meter) is known as <strong>Bobbin </strong>or <strong>Float.</strong></p>\n<p>The flows are read from the <strong>top</strong> end of the <strong>bobbin.</strong></p>\n<p>Some rotameters have ball indicator. Here, the reading is taken from the <strong>center</strong> of the <strong>ball</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/dff26a6627de4c29bcb0e7d822cade24.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d440c135e4674087a8264b42b33b899bx1280x1567.9548660084627.JPEG"
    ]
  },
  {
    "text": "The Heidbrink meter in Boyle\u2019s machine",
    "choices": [
      {
        "id": 1,
        "text": "Reduces pressure of gases"
      },
      {
        "id": 2,
        "text": "Is a fixed orifice meter"
      },
      {
        "id": 3,
        "text": "Indicates flow of gases"
      },
      {
        "id": 4,
        "text": "Indicates humidity of gases"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The Heidbrink meter in boyle&rsquo;s machine indicates <strong>the flow of gases.</strong></p>\n<p>Heidbrink is a type of<strong> flow meter,</strong> which was used in the past.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following combinations is incorrect regarding the vaporizers of the anaesthesia workstation?",
    "choices": [
      {
        "id": 1,
        "text": "Enflurane - Green"
      },
      {
        "id": 2,
        "text": "Halothane - Red"
      },
      {
        "id": 3,
        "text": "Isoflurane - Purple"
      },
      {
        "id": 4,
        "text": "Sevoflurane - Yellow"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Enflurane</strong> vaporizers are <strong>orange</strong> in color, not green.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You notice this  specialized vaporizer being used in the OT. Which of the following gases would you expect it to contain?",
    "choices": [
      {
        "id": 1,
        "text": "Desflurane"
      },
      {
        "id": 2,
        "text": "Sevoflurane"
      },
      {
        "id": 3,
        "text": "Halothane"
      },
      {
        "id": 4,
        "text": "Isoflurane"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The image shows a specialized vapouriser <strong>Tec</strong> <strong>6.&nbsp;</strong>Because of high vapor pressure (669 mmHg at 20&deg;C) and low boiling point (22.8&deg;C ~ room temperature), <strong>Desflurane</strong> requires this specialized&nbsp;vaporizer for its delivery.</p>\n<p>Anesthetic gas with the <strong>highest</strong> <strong>vapor</strong> <strong>pressure</strong> is Desflurane<strong>.&nbsp;</strong></p>\n<p>Other salient features of Desflurane:</p>\n<ul>\n<li>High saturated vapor pressure which is 3-4 times the other agents</li>\n<li>Low boiling point&nbsp;</li>\n<li>Low blood-gas solubility (0.42) resulting in rapid uptake and recovery</li>\n<li>High MAC value of 6, indicating low potency</li>\n<li>Requires specialized vapouriser such as <strong>Tec 6</strong></li>\n<li>Color coding of Desflurane - <strong>Blue</strong></li>\n<li>Undergoes minimal metabolism</li>\n<li>Degraded into CO by the desiccated&nbsp;CO<sub>2</sub> absorbent</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/48fc33de9a574d729dc319c014edbfb7.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "What is the maximum pressure allowed in an anesthesia reservoir bag?",
    "choices": [
      {
        "id": 1,
        "text": "20 cm H20"
      },
      {
        "id": 2,
        "text": "40 cm H20"
      },
      {
        "id": 3,
        "text": "60 cm H20"
      },
      {
        "id": 4,
        "text": "100 cm H2O"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The maximum pressure allowed in an anesthesia reservoir bag is&nbsp;<strong>60 cm H<sub>2</sub>0.&nbsp;</strong></p>\n<p>The reservoir bag serves as a reservoir for inhaled excess fresh gas and helps to generate positive pressure ventilation.</p>\n<p>It is most commonly placed between the <strong>expiratory unidirectional valve</strong> and the <strong>CO<sub>2</sub> absorber</strong>.</p>\n<p>The minimum allowed pressure is 30 cm H<sub>2</sub>O.</p>\n<p><strong>Anesthesia workstation</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3443841af4eb420c9dffb72709dcbfeex1280x1920.JPEG"
    ]
  },
  {
    "text": "In a patient with a tracheostomy, you notice the following device is used in addition to the breathing circuit. Which of the following statements is false concerning this device?",
    "choices": [
      {
        "id": 1,
        "text": "Conserves heat"
      },
      {
        "id": 2,
        "text": "Active humidifier"
      },
      {
        "id": 3,
        "text": "Artificial nose"
      },
      {
        "id": 4,
        "text": "Filters bacteria"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Shown above is the placement of HME filter in the breathing circuit.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ad2836ebe6934318ad9e878dc4cb3f14.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7bd29a8112a643b38d5073f7bf83347fx1280x1249.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a5bf107ffe9a440c8a6a4dac1436a51ex1280x1488.JPEG"
    ]
  },
  {
    "text": "Which anesthetic breathing system has the maximum ability to scavenge exhaled gases?",
    "choices": [
      {
        "id": 1,
        "text": "Insufflation"
      },
      {
        "id": 2,
        "text": "Open drop"
      },
      {
        "id": 3,
        "text": "Mapleson"
      },
      {
        "id": 4,
        "text": "Circle"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Ability to scavenge exhaled gases is maximum with <strong>Circle system</strong> (Circle&gt;Mapleson&gt;Open).</p>\n<div class=\"page\" title=\"Page 931\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Scavenging is the process of removal of waste anesthetic gases from both the anesthesia machine and the anesthetizing location (operation theatre), thus minimizing operating room pollution.</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The end product of the reaction of soda lime with CO2 is",
    "choices": [
      {
        "id": 1,
        "text": "Na2CO3+H2O"
      },
      {
        "id": 2,
        "text": "H2CO3+NaOH"
      },
      {
        "id": 3,
        "text": "Ca(OH)2+Na2CO3"
      },
      {
        "id": 4,
        "text": "CaCO3+NaOH"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The end product of the reaction of soda lime with CO<sub>2</sub> is&nbsp;<strong>CaCO3+NaOH.</strong></p>\n<div class=\"page\" title=\"Page 52\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>CO<sub>2</sub> absorbents contain hydroxide salts that are capable of neutralizing the carbonic acid.</p>\n<p>Reaction end products include heat (the heat of neutralization), water, calcium carbonate, and sodium hydroxide.</p>\n<p>Its reactions are as follows:</p>\n<ol>\n<li>CO<sub>2</sub> + H<sub>2</sub>O &rarr; H<sub>2</sub>CO<sub>3</sub></li>\n<li>H<sub>2</sub>CO<sub>3</sub> + 2NaOH &rarr; Na<sub>2</sub>CO<sub>3</sub> + 2H<sub>2</sub>O + Heat (a fast reaction)</li>\n<li>Na<sub>2</sub>CO<sub>3</sub> + Ca(OH)<sub>2</sub> &rarr; CaCO<sub>3</sub> + 2NaOH + Heat (a slow reaction)</li>\n</ol>\n<p>Note that the water and sodium hydroxide initially required are regenerated.</p>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Water content of soda lime is ________.",
    "choices": [
      {
        "id": 1,
        "text": "0%"
      },
      {
        "id": 2,
        "text": "5%"
      },
      {
        "id": 3,
        "text": "10%"
      },
      {
        "id": 4,
        "text": "15%"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The water content of soda lime is <strong>15%.</strong></p>\n<p>Dry CO<sub>2</sub> absorbent (Baralyme &gt; Sodalime) can produce carbon monoxide.&nbsp;</p>\n<p>The magnitude of CO production from greatest to least: <strong>Desflurane</strong> &gt;= Enflurane &gt; Isoflurane &gt;&gt; Halothane =Sevoflurane</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Laminar flow mainly depends on:",
    "choices": [
      {
        "id": 1,
        "text": "Viscosity"
      },
      {
        "id": 2,
        "text": "Density"
      },
      {
        "id": 3,
        "text": "Solubility"
      },
      {
        "id": 4,
        "text": "Molecular weight"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Laminar flow</strong> mainly depends on the <strong>viscosity</strong> of gas while <strong>turbulent flow</strong> is more dependent on <strong>density.</strong></p>\n<p>The transition between laminar and turbulent flow is given by <strong>Reynold's number.</strong></p>\n<p><strong>Re = pvD/n</strong></p>\n<p>(v- velocity of the fluid, p- density of the fluid, D- diameter of the tube, n- viscosity.)</p>\n<p>A Reynold's number &lt;2000 ~ laminar flow; &gt;4000 ~ turbulent flow.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '08 Anesthesia Workstation';
        let hierarchy = ["Marrow", "qBank", "Anesthesia"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>