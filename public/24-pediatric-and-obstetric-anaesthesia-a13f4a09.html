<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>24 Pediatric And Obstetric Anaesthesia - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Anesthesia
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">26</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A 25-year-old woman was taken up for a cesarean section. Following the administration of spinal anaesthesia, she suddenly developed hypotension.  Which of the following would be the vasopressor of choice for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Dopamine"
      },
      {
        "id": 2,
        "text": "Adrenaline"
      },
      {
        "id": 3,
        "text": "Ephedrine"
      },
      {
        "id": 4,
        "text": "Phenylephrine"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p style=\"text-align: justify;\"><strong>Phenylephrine</strong> is the vasopressor of choice to manage <strong>hypotension </strong>caused by spinal anaesthesia in <strong>pregnancy.</strong></p>\n<p style=\"text-align: justify;\">Phenylephrine produces lesser fetal acidosis and has lesser fetal transfer than <strong>ephedrine.&nbsp;</strong>Ephedrine was recommended in the past; however, its use has declined since it is associated with <strong>fetal acidosis</strong> and <strong>base deficit</strong>.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In pregnant women who are administered general anaesthesia, which of the following is the most common cause for mortality?",
    "choices": [
      {
        "id": 1,
        "text": "Hypotension"
      },
      {
        "id": 2,
        "text": "Pulmonary aspiration"
      },
      {
        "id": 3,
        "text": "Arrhythmias"
      },
      {
        "id": 4,
        "text": "Amniotic fluid embolism"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p style=\"text-align: left;\">Pregnant women who undergo <strong>general anaesthesia</strong>\u00a0are at increased risk of mortality from <strong>pulmonary aspiration </strong>of\u00a0gastric\u00a0contents.\u00a0</p>\n<p style=\"text-align: left;\">Other risk factors include\u00a0<strong>failed intubation </strong>of the trachea and <strong>inadequate ventilation</strong>.\u00a0General anaesthesia has a <strong>1.7 times </strong>greater risk of maternal morbidity and mortality than regional anaesthesia. Maternal mortality associated with aspiration is\u00a0<strong>5-15%.</strong></p>\n<p style=\"text-align: left;\"><strong>Mendelson's syndrome\u00a0</strong>is chemical pneumonitis or aspiration pneumonitis caused by aspiration during anaesthesia, especially during pregnancy.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the rate of maternal mortality due to pulmonary aspiration in patients undergoing general anaesthesia?",
    "choices": [
      {
        "id": 1,
        "text": "0.5%"
      },
      {
        "id": 2,
        "text": "1%"
      },
      {
        "id": 3,
        "text": "5%"
      },
      {
        "id": 4,
        "text": "50%"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Maternal mortality associated with aspiration in patients under general anaesthesia is <strong>5-15%.</strong></p>\n<p><strong>Mendelson's syndrome&nbsp;</strong>is chemical pneumonitis or aspiration pneumonitis caused by aspiration during anesthesia, especially during pregnancy. The risk factors include:</p>\n<div class=\"page\" title=\"Page 306\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<ul>\n<li>Gastric volume&nbsp;<strong>&gt;25 mL</strong> (0.4 mL/kg)</li>\n<li>Gastric <strong>pH</strong><strong>&nbsp;&lt;</strong>&nbsp;<strong>2.5</strong></li>\n</ul>\n</div>\n</div>\n</div>\n<p>Measures to reduce the incidence of aspiration:</p>\n<ul>\n<li>Administration of nonparticulate antacids like sodium citrate&nbsp;</li>\n<li>H2 receptor antagonists like intravenous ranitidine&nbsp;</li>\n<li>Metoclopramide</li>\n</ul>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is the most commonly used IV induction agent in a patient requiring caesarean section?",
    "choices": [
      {
        "id": 1,
        "text": "Propofol"
      },
      {
        "id": 2,
        "text": "Thiopentone"
      },
      {
        "id": 3,
        "text": "Etomidate"
      },
      {
        "id": 4,
        "text": "Ketamine"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p style=\"text-align: justify;\"><strong>Propofol</strong> is the most common intravenous induction agent used in <strong>general anesthesia for cesarean delivery</strong>.</p>\n<p style=\"text-align: justify;\">Propofol can induce unconsciousness in approximately 45 seconds. Its administration does not affect neonatal Apgar scores with typical intravenous induction doses (2-2.5 mg/kg). Repeated or <strong>larger cumulative doses (9 mg/kg)</strong> are associated with significant <strong>newborn depression</strong>.</p>\n<p style=\"text-align: justify;\">Other options:</p>\n<p style=\"text-align: justify;\">Option B: <strong>Thiopentone</strong> was the most commonly used agent for induction <strong>before\u00a0the introduction of propofol</strong>.</p>\n<p style=\"text-align: justify;\">Option C: <strong>Etomidate</strong> is not used as it can <strong>induce seizures</strong> in patients with reduced seizure thresholds. It is also associated with a higher incidence of nausea and vomiting.</p>\n<p style=\"text-align: justify;\">Option D: <strong>Ketamine</strong> is the preferred\u00a0agent\u00a0for patients with <strong>hemodynamic compromise</strong> as it helps maintain arterial pressure, heart rate, and cardiac output due to central stimulation of the sympathetic nervous system.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 24-year-old woman, G2P1L1, presents with features of placental abruption. If she has to be taken in for an emergency cesarean section, what will be the preferred anaesthetic technique?",
    "choices": [
      {
        "id": 1,
        "text": "General anesthesia"
      },
      {
        "id": 2,
        "text": "Spinal anesthesia"
      },
      {
        "id": 3,
        "text": "Epidural anesthesia"
      },
      {
        "id": 4,
        "text": "Caudal anesthesia"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p style=\"text-align: justify;\"><strong>General anaesthesia</strong> is the preferred anaesthetic technique of choice in an <strong>emergency LSCS</strong> in a patient with placental abruption considering the emergency nature of the surgery and the possibility of hemodynamic instability due to massive blood loss.</p>\n<p style=\"text-align: justify;\">Advantages of General anaesthesia include:</p>\n<ul>\n<li>A very rapid and reliable onset</li>\n<li>Control over the airway and ventilation</li>\n<li>More comfortable for patients who have morbid fears of needles or surgery</li>\n<li>Less incidence of hypotension as compared to regional anaesthesia.</li>\n</ul>\n<p>General anaesthesia is preferred in emergency conditions such as:</p>\n<ul>\n<li><strong>Massive bleeding</strong> (placenta previa or accreta, abruption placentae, or uterine rupture)</li>\n<li>Coagulopathy</li>\n<li>Hemodynamic instability</li>\n<li>Severe fetal distress.</li>\n</ul>\n<p>Disadvantages/risks of general anaesthesia:&nbsp;</p>\n<ul>\n<li>Pulmonary aspiration of gastric contents</li>\n<li>Difficult or failed intubation</li>\n<li>Drug exposure to the fetus.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 28-year-old woman, G3P2L2, with a history of LSCS, is brought to the ER with complaints of abdominal pain, hematuria, and vaginal bleeding. On examination, the patient is hypotensive along with foetal bradycardia and non-reassuring foetal heart rate tracing. Which of the following is the preferred IV induction agent?",
    "choices": [
      {
        "id": 1,
        "text": "Propofol"
      },
      {
        "id": 2,
        "text": "Thiopentone"
      },
      {
        "id": 3,
        "text": "Ketamine"
      },
      {
        "id": 4,
        "text": "Etomidate"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario is suggestive of <strong>hemodynamic compromise</strong> secondary to <strong>uterine scar dehiscence</strong>.<strong> Ketamine</strong> is the preferred induction agent in this patient.</p>\n<p>Ketamine is the preferred induction agent for patients with <strong>hemodynamic compromise</strong> as it helps maintain arterial pressure, heart rate, and cardiac output due to <strong>sympathetic</strong>&nbsp;<strong>stimulation</strong>&nbsp;and <strong>norepinephrine reuptake inhibition.</strong></p>\n<p>Other properties of ketamine are:</p>\n<ul>\n<li>Dissociative anesthesia with profound analgesia</li>\n<li>Preserves laryngeal and pharyngeal reflex</li>\n<li>Does not depress respiration</li>\n<li>Bronchial dilatation</li>\n</ul>\n<p>Options A and B<strong>: </strong>Propofol&nbsp;and thiopentone<strong>&nbsp;</strong>cause hypotension following induction.&nbsp;</p>\n<p>Option D<strong>: </strong>Etomidate<strong>,&nbsp;</strong>although cardiostable causes a mild reduction in peripheral vascular resistance that is responsible for a slight decline in arterial blood pressure.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following muscle relaxants will you prefer to conduct a cesarean section under general anaesthesia?",
    "choices": [
      {
        "id": 1,
        "text": "Vecuronium"
      },
      {
        "id": 2,
        "text": "Pipecuronium"
      },
      {
        "id": 3,
        "text": "Rocuronium"
      },
      {
        "id": 4,
        "text": "Succinylcholine"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Succinylcholine</strong>&nbsp;will be the preferred&nbsp;<strong>muscle relaxant</strong>&nbsp;in the given scenario.</p>\n<p>Pregnancy is considered to be a state of 'full stomach' and therefore <strong>rapid sequence induction</strong> is preferred when undergoing procedures under <strong>general anaesthesia</strong>.&nbsp;</p>\n<p>Succinylcholine is the preferred muscle relaxant in rapid sequence induction due to its following properties:</p>\n<ul>\n<li>Rapid onset&nbsp;(30-45 seconds)</li>\n<li>The short duration of action (metabolized by pseudocholinesterase)</li>\n<li>Highly ionized and poorly lipid-soluble (lower placental transfer to foetus).&nbsp;&nbsp;</li>\n</ul>\n<p><strong>Rocuronium </strong>can be used as an<strong> alternative</strong> to succinylcholine. It is the <strong>non-depolarizing neuromuscular blocking agent of choice</strong> for rapid sequence induction. It has a rapid onset(&lt;60 seconds) and its duration of action can be terminated by the reversal agent <strong>sugammadex.</strong> But the use of rocuronium is associated with lower Apgar scores at 1 minute when compared with succinylcholine.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 25-year-old primigravida is screaming in pain while being wheeled into the labour room at 2 am. On examination, her cervix is well-effaced and is 4 cm dilated. What is the preferred anaesthetic technique to ensure this patient has a painless labour?",
    "choices": [
      {
        "id": 1,
        "text": "Pudendal nerve block"
      },
      {
        "id": 2,
        "text": "Spinal anesthesia"
      },
      {
        "id": 3,
        "text": "Caudal anesthesia"
      },
      {
        "id": 4,
        "text": "Lumbar epidural"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p style=\"text-align: justify;\"><strong>Lumbar epidural&nbsp;</strong>is the most commonly used technique to produce labour analgesia because it can provide analgesia during the first stage of labour and also provide anaesthesia during vaginal delivery or cesarean section if necessary.</p>\n<p style=\"text-align: justify;\">For adequate pain relief, the<strong> sensory block </strong>of <strong>T10-L1 i</strong>s required during the first stage of labour and <strong>S2-S4 </strong>is required during the&nbsp;second stage. The epidural catheter placed at L3-L4 or L4-L5 interspace sufficiently provides T10&ndash;S5 neural blockade.</p>\n<p style=\"text-align: justify;\">Option A<strong>: </strong>Pudendal nerve block&nbsp;is given in the <strong>second stage</strong> of&nbsp;labor&nbsp;just before delivery of the baby to provide analgesia to the vulva and anus\u200b. However, it has no effect on the pain of contractions. It is also given before repair of episiotomy or perineal lacerations.</p>\n<p style=\"text-align: justify;\">Option B<strong>: </strong>Spinal anaesthesia&nbsp;for labour analgesia has the advantage of a rapid and reliable onset of the neural blockade, and it is technically easier to administer&nbsp;compared to epidural analgesia. However, repeated intrathecal injections may be required for a prolonged labour, thus increasing the risk of <strong>post-dural puncture headache.</strong></p>\n<p style=\"text-align: justify;\">Option C<strong>: </strong>Caudal epidural&nbsp;is largely <strong>abandoned</strong> to provide pain relief in obstetrics.&nbsp;It requires large volumes of a local anaesthetic to anaesthetize upper lumbar and lower thoracic dermatomes to provide adequate labour analgesia. Though rare, accidental puncture of the fetus is a possibility.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You observe a resident injecting a local anaesthetic to provide pain relief to a primigravida who is in labour.  Which of the following is the local anaesthetic of choice in this case?",
    "choices": [
      {
        "id": 1,
        "text": "Lidocaine"
      },
      {
        "id": 2,
        "text": "Bupivacaine"
      },
      {
        "id": 3,
        "text": "Chloroprocaine"
      },
      {
        "id": 4,
        "text": "Cocaine"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Bupivacaine&nbsp;</strong>is the preferred local anaesthetic (LA) agent for labour analgesia.</p>\n<p>Bupivacaine&nbsp;is preferred<strong>&nbsp;</strong>over lidocaine, chloroprocaine, and cocaine for labour analgesia because of its following properties:</p>\n<ul>\n<li><strong>Differential blockade </strong>&nbsp;(less motor blockade as compared to sensory blockade). This preferred motor function is useful as voluntary push down efforts by the patient may lead to better delivery outcomes.</li>\n<li><strong>Long duration of action</strong> (infrequent top-ups).</li>\n</ul>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following drug combinations is preferred for providing epidural analgesia during labour?",
    "choices": [
      {
        "id": 1,
        "text": "Bupivacaine + epinephrine"
      },
      {
        "id": 2,
        "text": "Bupivacaine + fentanyl"
      },
      {
        "id": 3,
        "text": "Bupivacaine + neostigmine"
      },
      {
        "id": 4,
        "text": "Bupivacaine + clonidine"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The preferred combination used for epidural analgesia during labour is <strong>b</strong><strong>upivacaine </strong>with<strong> fentanyl</strong>.</p>\n<p>This is because, doses of local anaesthetics can be <strong>reduced</strong> by combining them with<strong> opioids</strong> like fentanyl or sufentanil.</p>\n<p>The lesser concentration of local anaesthetic used leads to greater preservation of motor function and makes ambulation of the patient possible (<strong>walking </strong>or<strong> mobile epidural</strong>).&nbsp;Also, by reducing the concentration of the drugs, adverse effects like <strong>hypotension</strong> and <strong>drug</strong> <strong>toxicity</strong> are <strong>minimized</strong>.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the concentration of bupivacaine you will use to provide labour analgesia, when used in combination with fentanyl?",
    "choices": [
      {
        "id": 1,
        "text": "0.0625 %"
      },
      {
        "id": 2,
        "text": "0.25%"
      },
      {
        "id": 3,
        "text": "0.5%"
      },
      {
        "id": 4,
        "text": "5%"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p style=\"text-align: justify;\">The concentration of bupivacaine used to provide labour analgesia, when used along with fentanyl is <strong>0.0625%.</strong></p>\n<p style=\"text-align: justify;\">The required doses of local anaesthetics can be <strong>reduced</strong> if it is used in combination with opioids like fentanyl or sufentanil.&nbsp;</p>\n<p style=\"text-align: justify;\">Concentration of LA used in epidural:</p>\n<table style=\"height: 110px;\" width=\"442\">\n<tbody>\n<tr>\n<td style=\"width: 139px;\"><strong>Drug</strong></td>\n<td style=\"width: 140px; text-align: center;\" colspan=\"2\"><strong>Concentrations</strong></td>\n</tr>\n<tr>\n<td style=\"width: 139px;\">&nbsp;</td>\n<td style=\"width: 140px;\"><strong>Without opioid</strong></td>\n<td style=\"width: 141px;\"><strong>With opioid</strong></td>\n</tr>\n<tr>\n<td style=\"width: 139px;\">Bupivacaine</td>\n<td style=\"width: 140px;\">0.25%</td>\n<td style=\"width: 141px;\">0.0625-0.125%</td>\n</tr>\n<tr>\n<td style=\"width: 139px;\">Ropivacaine</td>\n<td style=\"width: 140px;\">0.2%</td>\n<td style=\"width: 141px;\">0.0625-0.2%</td>\n</tr>\n</tbody>\n</table>\n<p style=\"text-align: justify;\">&nbsp;</p>\n<p style=\"text-align: justify;\">The dose of opioid used in epidural:</p>\n<ul style=\"text-align: justify;\">\n<li><strong>Fentanyl :&nbsp;</strong>2&ndash;3 mcg/mL&nbsp;</li>\n<li><strong>Sufentanil: </strong>0.3&ndash;0.5 mcg/mL</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "To provide epidural analgesia during labour, what is the ideal concentration of epinephrine added to the local anaesthetic?",
    "choices": [
      {
        "id": 1,
        "text": "1:10,000"
      },
      {
        "id": 2,
        "text": "1: 1,00,000"
      },
      {
        "id": 3,
        "text": "1: 2,00,000"
      },
      {
        "id": 4,
        "text": "1: 4,00,000"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Very dilute concentration of epinephrine<strong> (1:400,000 to 1:800,000) </strong>is&nbsp;used along with local anaesthetics for labour epidural analgesia.</p>\n<p><strong>Epidural epinephrine</strong> can provide vasoconstriction which would <strong>delay the vascular uptake of local anaesthetic and opioid.</strong> Additionally, it can activate &alpha;2-adrenergic receptors and thus produce analgesia on its own.</p>\n<p>Epinephrine, used along with local anaesthetics at a concentration of 5 &mu;g/mL or <strong>1:200,000</strong> may be associated with uterine artery vasoconstriction which can adversely affect the fetus and delay the progress of labour. Hence epinephrine at this dose is used only for <strong>test dose </strong>(15 &mu;g/mL or 3 ml of 1:200,000). A test dose is given to rule out the intravascular placement of epidural catheter following the procedure.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In a patient scheduled for an elective caesarean section, what is the preferred anaesthetic technique used?",
    "choices": [
      {
        "id": 1,
        "text": "General anesthesia"
      },
      {
        "id": 2,
        "text": "Spinal anesthesia"
      },
      {
        "id": 3,
        "text": "Lumbar epidural"
      },
      {
        "id": 4,
        "text": "Paracervical block"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Spinal anaesthesia</strong> is preferred over other techniques for an elective cesarean section.</p>\n<p>Advantages of spinal anaesthesia <strong>over</strong> <strong>general</strong> anaesthesia:</p>\n<ul>\n<li>Less neonatal exposure to potentially depressant drugs</li>\n<li>A decreased risk of maternal pulmonary aspiration</li>\n<li>An awake mother at the birth of her child</li>\n<li>Spinal opioids can be used for postoperative pain relief</li>\n</ul>\n<p>Advantages of spinal anaesthesia <strong>over epidural</strong> anaesthesia:</p>\n<ul>\n<li>Rapid and predictable block</li>\n<li>Complete block (lesser failure rate)</li>\n<li>Lesser risk of systemic toxicity or high spinal due to accidental intravascular or intrathecal injection seen with epidural anesthesia</li>\n<li>More cost-effective</li>\n</ul>\n<div class=\"page\" title=\"Page 2719\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Paracervical block</strong> is used for labour analgesia, but not for elective cesarean section. Side effects include transient fetal bradycardia, maternal local anaesthetic toxicity, and accidental injection of local anaesthetic into the presenting fetal head.</p>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 20-year-old primigravida who is in her second trimester of pregnancy is scheduled for an open appendectomy.  What is the preferred anaesthetic technique for this surgery?",
    "choices": [
      {
        "id": 1,
        "text": "General anesthesia"
      },
      {
        "id": 2,
        "text": "Spinal anesthesia"
      },
      {
        "id": 3,
        "text": "Epidural anesthesia"
      },
      {
        "id": 4,
        "text": "Caudal anesthesia"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Spinal anesthesia</strong> is preferred over other techniques for the appendectomy in the second trimester. Total anesthetic drug exposure is least with spinal anesthesia over others.</p>\n<p>General anesthesia is associated with a greater risk of:</p>\n<ul>\n<li>Pulmonary aspiration of gastric contents</li>\n<li>Difficult or failed intubation</li>\n<li>Drug exposure to the fetus</li>\n</ul>\n<p>Epidural anesthesia has the risk of:</p>\n<ul>\n<li>Accidental intravascular injection</li>\n<li>Accidental intrathecal injection</li>\n</ul>\n<p>Although spinal anesthesia is preferred in most situations, the choice between general anesthesia and spinal anesthesia is to be individualized. In general, <strong>spinal anesthesia </strong>is appropriate for <strong>open appendectomies </strong>and <strong>general anesthesia </strong>for<strong> laparoscopic appendectomies</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An elderly primigravida at 37 weeks of gestation develops bilateral pedal oedema. On examination, she has a BP of 148/92 mmHg and proteinuria of 400mg/day. Emergency LSCS has been scheduled for the patient. Which of the following anaesthetic techniques would be prefered in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "General anesthesia"
      },
      {
        "id": 2,
        "text": "Spinal anesthesia"
      },
      {
        "id": 3,
        "text": "Lumbar epidural"
      },
      {
        "id": 4,
        "text": "Caudal anesthesia"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p style=\"text-align: justify;\"><strong>Epidural anaesthesia</strong> is the preferred anaesthetic technique in this patient who is likely to be suffering from <strong>preeclampsia</strong>.&nbsp;</p>\n<p style=\"text-align: justify;\">Epidural anaesthesia is the first choice anaesthetic technique for patients with<strong> pre-eclampsia </strong>during labour, vaginal delivery, and cesarean section.&nbsp;One major prerequisite for its usage is <strong>normal platelet count </strong>(minimum 100,000/&mu;L)<strong>&nbsp;</strong>and <strong>normal coagulation</strong>.</p>\n<p style=\"text-align: justify;\">It has been shown to decrease catecholamine secretion and improve uteroplacental perfusion up to 75% in these patients, provided hypotension is avoided.</p>\n<p style=\"text-align: justify;\">Option A:<strong> General anaesthesia</strong> is indicated in patients with <strong>coagulopathy</strong> and in <strong>severe pre-eclampsia&nbsp;</strong>with complications.</p>\n<p style=\"text-align: justify;\">Option B:<strong> Spinal anaesthesia</strong> can be given in mild pre-eclampsia but hypotension associated with spinal anaesthesia limits its use in moderate to severe pre-eclampsia.&nbsp;</p>\n<p style=\"text-align: justify;\">Option D: <strong>Caudal anaesthesia</strong> is generally unpopular in obstetric anaesthesia because of painful needle placement, high failure rates, potential contamination at the injection site, and risks of accidental fetal injection.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 30-year-old woman with coarctation of the aorta is admitted for elective caesarean section. Which of the following is the anaesthesia of choice?",
    "choices": [
      {
        "id": 1,
        "text": "Spinal anesthesia"
      },
      {
        "id": 2,
        "text": "Epidural anesthesia"
      },
      {
        "id": 3,
        "text": "General anesthesia"
      },
      {
        "id": 4,
        "text": "Local anesthesia with nerve blocks"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>General anaesthesia</strong> is the technique of choice for elective caesarean section in a patient with coarctation of the aorta.</p>\n<p>In coarctation of the aorta, any decrease in cardiac output or cardiac return is deleterious to the fetus because the placental circulation is already compromised on account of coarctation.</p>\n<p><strong>Regional anaesthesia</strong> should be <strong>avoided </strong>in the patient with coarctation of the aorta because <strong>hypotension</strong> is the most common side effect of these anaesthesias.</p>\n<p><strong>Local anaesthesia</strong>&nbsp;with nerve blocks does not provide adequate anaesthesia for caesarean section.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is false regarding neonates and their airways?",
    "choices": [
      {
        "id": 1,
        "text": "They are obligate nasal breathers."
      },
      {
        "id": 2,
        "text": "Narrowest part of their larynx is the glottis."
      },
      {
        "id": 3,
        "text": "Epiglottis is omega-shaped."
      },
      {
        "id": 4,
        "text": "Their glottis lies at the level of C4 vertebrae."
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p style=\"text-align: justify;\">The <strong>cricoid cartilage </strong>is the narrowest point of the airway (larynx is funnel-shaped) in children under 5 years of age.</p>\n<p style=\"text-align: justify;\">In adults, it was earlier believed that the narrowest part of the airway is the glottis. But, now it has been discovered that the subglottic region at the level of the cricoid cartilage is the narrowest portion in about 70% of adults.&nbsp;</p>\n<p style=\"text-align: justify;\">Salient features of pediatric airway:</p>\n<ul>\n<li style=\"text-align: justify;\">Neonates are obligate <strong>nasal breathers</strong> (up to 5 months).</li>\n<li style=\"text-align: justify;\">Nasal passages are narrower.</li>\n<li style=\"text-align: justify;\">Larger tongue in relation to the oropharynx (airway obstruction and difficult intubation may be a problem).</li>\n<li style=\"text-align: justify;\">The larynx is placed higher in the neck (the glottis is at a vertebral level of <strong>C4</strong> versus C6 in adults), so straight laryngoscope blades are preferred.</li>\n<li style=\"text-align: justify;\">A short, <strong>omega-shaped</strong> <strong>epiglottis</strong>, and a shorter trachea and neck.</li>\n<li style=\"text-align: justify;\">Vocal cords are angulated and so if a tracheal tube is passed blindly instead of passing into the trachea it could lodge in the anterior commissure.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 4-year-old boy was rushed to the ER after he accidentally swallowed a small coin. The ENT surgeon has planned a rigid bronchoscopy to remove the coin. Which of the following drugs will you prefer for rapid sequence induction before the procedure?",
    "choices": [
      {
        "id": 1,
        "text": "Succinylcholine"
      },
      {
        "id": 2,
        "text": "Rocuronium"
      },
      {
        "id": 3,
        "text": "Vecuronium"
      },
      {
        "id": 4,
        "text": "Atracurium"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p style=\"text-align: justify;\"><strong>Rocuronium </strong>is considered to be the <strong>drug of choice</strong> to provide muscle relaxation during routine <strong>rapid sequence induction </strong>or intubation in <strong>pediatric patients</strong> with foreign body aspiration.</p>\n<p style=\"text-align: justify;\">It has a&nbsp;<strong>faster onset</strong> and can be administered <strong>intramuscularly</strong>. Its long duration of action is a disadvantage. <strong>S</strong><strong>ugammadex&nbsp;</strong>is a specific reversal agent that can terminate the action of rocuronium.</p>\n<p style=\"text-align: justify;\">Option A:<strong> Succinylcholine </strong>is used for rapid sequence induction of anaesthesia because of its <strong>rapid onset</strong> and <strong>ultra-short duration</strong> of action<strong>. </strong>It&nbsp;is the <strong>shortest acting muscle relaxant</strong> but it is not used for routine intubation in children due to its many adverse effects like rhabdomyolysis, hyperkalemia, cardiac arrhythmias, and malignant hyperthermia.&nbsp;</p>\n<p style=\"text-align: justify;\">Option C:<strong> Vecuronium</strong> action is prolonged in small children due to immature hepatic and renal function.</p>\n<p style=\"text-align: justify;\">Option D:<strong> Atracurium</strong> or <strong>cisatracurium</strong> may be preferred in young infants, particularly for short procedures, because they undergo Hoffman elimination leading to a short duration of action. Besides, they do not require intact hepatic and renal functions.</p>\n<p style=\"text-align: justify;\">&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not used for induction of anaesthesia in pediatric patients?",
    "choices": [
      {
        "id": 1,
        "text": "Halothane"
      },
      {
        "id": 2,
        "text": "Sevoflurane"
      },
      {
        "id": 3,
        "text": "Desflurane"
      },
      {
        "id": 4,
        "text": "Nitrous oxide"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p style=\"text-align: justify;\"><strong>Desflurane</strong> is a <strong>highly pungent gas</strong> and can produce <strong>laryngospasm</strong> if used for inhalational induction. Hence it is not used as an induction agent.</p>\n<p style=\"text-align: justify;\">The incidence of <strong>laryngospasm</strong> following desflurane induction is almost <strong>50%</strong>. It is usually used for <strong>maintenance of anaesthesia </strong>only and is of particular value in obese patients, neurosurgical and spinal fusion procedures where<strong> rapid awakening </strong>is required for neurological function assessment.</p>\n<p style=\"text-align: justify;\">Option A: <strong>Halothane</strong> is hepatotoxic but can be used (Sevoflurane is preferred)</p>\n<p style=\"text-align: justify;\">Option B:<strong> Sevoflurane</strong> is the preferred inhalational agent for induction in the pediatric age group. Cardiovascular depression, bradycardia, and arrhythmias are less frequent with sevoflurane than with halothane and hence the former is preferred.</p>\n<p style=\"text-align: justify;\">Option D:<strong> Nitrous oxide</strong> has the highest minimum alveolar concentration and so it is the least potent. It is used in combination with other potent inhaled anaesthetics to reduce their dose. It can be used to hasten the induction of anaesthesia along with other induction agents.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 5-year-old child was brought to the local clinic in a remote village with a high fever for the past 2 days. It was associated with a barking cough. His neck radiograph is given below. In case a laryngoscopy has to be done, what will be the preferred induction agent?",
    "choices": [
      {
        "id": 1,
        "text": "Nitrous oxide"
      },
      {
        "id": 2,
        "text": "Halothane"
      },
      {
        "id": 3,
        "text": "Sevoflurane"
      },
      {
        "id": 4,
        "text": "Desflurane"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p style=\"text-align: justify;\">The clinical features and neck radiograph (steeple sign) are suggestive of <strong>laryngotracheobronchitis (croup)</strong> in the child and <strong>halothane</strong> is the preferred agent used for induction in this condition.\u00a0</p>\n<p style=\"text-align: justify;\">Normally sevoflurane and halothane are agents used for induction in children. But in a child with <strong>airway obstruction </strong>like croup (laryngotracheobronchitis), <strong>rapid induction</strong>\u00a0is <strong>contraindicated</strong>.</p>\n<p style=\"text-align: justify;\">To perform laryngoscopy and tracheal intubation in such children, slow induction of anaesthesia is required before the child becomes sufficiently anaesthetized.\u00a0Moreover, halothane has a slower excretion than sevoflurane, which provides sufficient time for airway management.</p>\n<p style=\"text-align: justify;\">The<strong> therapeutic index </strong>of<strong> sevoflurane</strong> is<strong> higher</strong> than halothane (myocardial depression, sensitization of the myocardium to arrhythmias, halothane hepatitis) and hence is preferred for <strong>routine cases</strong>. However in certain underdeveloped countries, due\u00a0to its cost-effectiveness, halothane is preferred.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/eb4813fb39c6437abebab97fe9f6e3f9.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "In a child with temporal lobe epilepsy, which of the following anaesthetic agents should be avoided?",
    "choices": [
      {
        "id": 1,
        "text": "Thiopentone"
      },
      {
        "id": 2,
        "text": "Methohexitone"
      },
      {
        "id": 3,
        "text": "Propofol"
      },
      {
        "id": 4,
        "text": "Ketamine"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p style=\"text-align: justify;\"><strong>Methohexitone</strong> has the potential to cause seizures<strong>,</strong>&nbsp;hence it is avoided in children with temporal lobe epilepsy.</p>\n<p style=\"text-align: justify;\">Intravenous administration of methohexitone can cause burning, hiccups, apnea, and extrapyramidal-like movements<strong>.</strong> Due to&nbsp;its potential to cause seizures, it is used to <strong>therapeutically</strong> induce seizures in <strong>electroconvulsive therapy</strong> in adults.</p>\n<p style=\"text-align: justify;\">Option D: <strong>Ketamine</strong> is contraindicated in patients with increased intracranial tension and better avoided in epileptic patients due to ketamine-induced myoclonic and seizure-like activity.&nbsp;</p>\n<p style=\"text-align: justify;\">Options A and C: <strong>Propofol</strong> and <strong>thiopentone</strong> have anti-convulsant property.</p>\n<p style=\"text-align: justify;\">Note: This is a <strong>controversial</strong>&nbsp;MCQ. Among the above options, methohexitone is the most specific answer.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is the most commonly used opioid in children?",
    "choices": [
      {
        "id": 1,
        "text": "Morphine"
      },
      {
        "id": 2,
        "text": "Meperidine"
      },
      {
        "id": 3,
        "text": "Fentanyl"
      },
      {
        "id": 4,
        "text": "Sufentanil"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Fentanyl</strong> is the most commonly used opioid in infants and children due to its rapid onset and short duration of action.</p>\n<p>Termination of its effects is due to rapid redistribution and elimination. It has the advantage of maintaining cardiovascular stability while providing anaesthesia. But, fentanyl induced bradycardia may require treatment with atropine/glycopyrrolate since the cardiac output of neonates is determined by the heart rate.</p>\n<p>Option A:<strong> Morphine </strong>leads to greater <strong>respiratory depression </strong>in neonates due to slower clearance of morphine.</p>\n<p>Option B: <strong>Meperidine / Pethidine&nbsp;</strong>is not used in children since long term or repeated administration of the drug leads to <strong>seizures </strong>due to the accumulation of its metabolite-normeperidine.</p>\n<p>Option D:<strong> Sufentanil </strong>is usually preferred for <strong>cardiac anaesthesia.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 6-week-old baby was brought to the OPD with a history of projectile, non-bilious vomiting. On abdominal examination, an olive-shaped mass was noted in the RUQ. After further evaluation, he was scheduled for surgical correction. Which of the following is true regarding his anaesthetic management?",
    "choices": [
      {
        "id": 1,
        "text": "Aspiration of gastric contents with an NG tube is not indicated"
      },
      {
        "id": 2,
        "text": "Cricoid pressure needs to be applied"
      },
      {
        "id": 3,
        "text": "Atropine has to be administered before giving suxamethonium"
      },
      {
        "id": 4,
        "text": "Mask ventilation is contraindicated"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p style=\"text-align: justify;\">The clinical scenario is suggestive of <strong>pyloric stenosis</strong> and the child should be pretreated with atropine&nbsp;if suxamethonium is used during the surgery.</p>\n<p style=\"text-align: justify;\">For surgical repair in children with pyloric stenosis, either of the following two techniques can be done:</p>\n<ul>\n<li style=\"text-align: justify;\"><strong>Rapid-sequence induction</strong> - if suxamethonium (2mg/kg) is used, atropine&nbsp;(0.02 mg/kg) should be given because children are more susceptible than adults to <strong>bradycardia and sinus node arrest</strong> associated with suxamethonium.&nbsp;</li>\n<li style=\"text-align: justify;\"><strong>Awake intubation</strong> - preserves airway reflexes</li>\n</ul>\n<p style=\"text-align: justify;\">The classically described rapid sequence technique (preoxygenation, cricoid pressure, and avoiding mask ventilation) is <strong>not appropriate</strong> for an infant with pyloric stenosis.</p>\n<p style=\"text-align: justify;\">Opton A: <strong>Aspiration </strong>of gastric contents is done by suctioning with a wide bore vented catheter before induction of anaesthesia to remove 98% of gastric contents.</p>\n<p style=\"text-align: justify;\">Option B:<strong> Cricoid pressure</strong> can distort the anatomy making laryngoscopy difficult, hence <strong>avoided.</strong> If it is applied and there is no clear view of the larynx then the pressure should be relaxed.</p>\n<p style=\"text-align: justify;\">Option D: Infants rapidly desaturate compared to adults due to greater oxygen consumption and smaller functional residual capacity.&nbsp;This means that gentle <strong>bag-mask ventilation</strong> is required prior to laryngoscopy to avoid hypoxemia and bradycardia.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is the preferred agent used as sedative premedication in pediatric anaesthesia?",
    "choices": [
      {
        "id": 1,
        "text": "Barbiturate"
      },
      {
        "id": 2,
        "text": "Diazepam"
      },
      {
        "id": 3,
        "text": "Midazolam"
      },
      {
        "id": 4,
        "text": "Propofol"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p style=\"text-align: justify;\">The preferred sedative premedication in children is <strong>midazolam</strong>.</p>\n<p style=\"text-align: justify;\">It is preferred as it has a <strong>shorter elimination half-life</strong> (2 hours) and has the advantage of producing <strong>anterograde amnesia</strong>. It is water-soluble and hence painless on injection. It&nbsp;is usually administered to children <strong>10 to 12 months or older</strong>&nbsp;because of separation anxiety from parents.</p>\n<p style=\"text-align: justify;\">Other sedative premedications that are sometimes used include dexmedetomidine, clonidine, temazepam and ketamine.</p>\n<p style=\"text-align: justify;\">Option A:<strong> Barbiturates </strong>are not commonly used for premedication in children since the availability of short-acting benzodiazepines. A major disadvantage is hyperalgesia, which can induce agitation in children with pain.&nbsp;</p>\n<p style=\"text-align: justify;\">Option B: <strong>Diazepam</strong>&nbsp;has a longer elimination half-life (18 hours) and immature liver function that would prolong its action in young children.</p>\n<p style=\"text-align: justify;\">Option D: <strong>Propofol&nbsp;</strong>is the most useful sedative-hypnotic drug but is not approved for this use in pediatric patients.</p>\n<p style=\"text-align: justify;\">Note<strong>- Ketamine </strong>is effective as a sedative, but it can increase oral secretion and can cause hallucinations during recovery. Hence oral ketamine is usually avoided, and when used, is administered along&nbsp;with antisialogogue (atropine/glycopyrrolate) and a benzodiazepine (such as midazolam).</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following agents is not used for induction of anaesthesia in children?",
    "choices": [
      {
        "id": 1,
        "text": "Halothane"
      },
      {
        "id": 2,
        "text": "Sevoflurane"
      },
      {
        "id": 3,
        "text": "Morphine"
      },
      {
        "id": 4,
        "text": "Nitrous oxide"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Morphine is not commonly recommended for induction of anaesthesia in children, especially below the age of 6 months.</p>\n<p>Most commonly used induction agents in children:</p>\n<p><strong>Inhalational agents:</strong></p>\n<ul>\n<li>Nitrous oxide</li>\n<li>Halothane</li>\n<li>Sevoflurane</li>\n</ul>\n<p><strong>Intravenous agents:</strong></p>\n<ul>\n<li>Propofol</li>\n<li>Thiopentone</li>\n<li>Etomidate</li>\n<li>Ketamine</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In which of the following cases is ketamine preferred as the induction agent?",
    "choices": [
      {
        "id": 1,
        "text": "A 25-year old man with an open eye injury"
      },
      {
        "id": 2,
        "text": "RTA case with head injury"
      },
      {
        "id": 3,
        "text": "An elderly woman with sinusitis"
      },
      {
        "id": 4,
        "text": "A case of stab injury with severe hypotension"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Ketamine</strong> is the <strong>agent of choice </strong>for induction of anesthesia in patients with<strong> hypovolemia</strong>.</p>\n<p>It helps to maintain arterial pressure, heart rate, and cardiac output via central stimulation of the sympathetic nervous system and inhibition of the reuptake of norepinephrine.</p>\n<p>The following are contraindications for ketamine<strong>:</strong></p>\n<ul>\n<li>Active upper respiratory infection (URI)</li>\n<li>Increased intracranial pressure</li>\n<li>Open-globe injury (only intravenous induction agent which raises intraocular pressure)</li>\n<li>Psychiatric or seizure disorder</li>\n</ul>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '24 Pediatric And Obstetric Anaesthesia';
        let hierarchy = ["Marrow", "qBank", "Anesthesia"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>