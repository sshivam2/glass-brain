<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>13 Carcinogenesis, Paraneoplastic Syndromes And Tumor Markers - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Pathology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">29</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following tumors is best suited to study the mechanism of multi-step carcinogenesis?",
    "choices": [
      {
        "id": 1,
        "text": "Colon carcinoma"
      },
      {
        "id": 2,
        "text": "Melanoma"
      },
      {
        "id": 3,
        "text": "Thyroid carcinoma"
      },
      {
        "id": 4,
        "text": "Breast carcinoma"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Multi-step carcinogenesis</strong> is best studied in <strong>colon carcinoma.</strong></p>\n<p>The molecular model for the evolution of colorectal cancers is described as Fearon-Vogelstein&nbsp;adenoma-carcinoma sequence.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following procarcinogens does not require metabolic activation?",
    "choices": [
      {
        "id": 1,
        "text": "Cyclophosphamide"
      },
      {
        "id": 2,
        "text": "Benzidene"
      },
      {
        "id": 3,
        "text": "3-Methylcholanthrene"
      },
      {
        "id": 4,
        "text": "Dimethylaminoazobenzene"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Cyclophosphamide</strong> is a <strong>directly-acting carcinogen</strong> that does not require metabolic activation.</p>\n<p>Carcinogens can be direct-acting or indirect-acting based on their activation.</p>\n<p><strong>Direct-acting</strong> carcinogens require no metabolic conversion to become carcinogenic. Most are weak carcinogens, but some are important because they are cancer chemotherapeutic drugs (e.g., alkylating agents). The direct-acting carcinogens include:</p>\n<ul>\n<li>Alkylating Agents:\n<ul>\n<li>\u03b2-Propiolactone</li>\n<li>Dimethyl sulfate</li>\n<li>Diepoxybutane</li>\n<li>Anticancer drugs (<strong>cyclophosphamide</strong>, chlorambucil, nitrosoureas, and others)</li>\n</ul>\n</li>\n<li>Acylating Agents:\n<ul>\n<li>1-Acetyl-imidazole</li>\n<li>Dimethylcarbamyl chloride</li>\n</ul>\n</li>\n</ul>\n<p><strong>Indirect-acting</strong> carcinogens (<strong>procarcinogens</strong>) are chemicals that require <strong>metabolic conversion</strong> to become active carcinogens. The carcinogenic product of metabolism is called an <strong>ultimate carcinogen</strong>.\u00a0The indirect-acting carcinogens include:</p>\n<ul>\n<li>Polycyclic and heterocyclic aromatic hydrocarbons:\n<ul>\n<li>Benz[a]anthracene</li>\n<li>Benzo[a]pyrene</li>\n<li>Dibenz[a,h]anthracene</li>\n<li><strong>3-Methylcholanthrene</strong></li>\n<li>7,12-Dimethylbenz[a]anthracene</li>\n</ul>\n</li>\n<li>Aromatic amines, amides, azo dyes:\n<ul>\n<li>2-Naphthylamine (\u03b2-naphthylamine)</li>\n<li><strong>Benzidine</strong></li>\n<li>2-Acetylaminofluorene</li>\n<li><strong>Dimethylaminoazobenzene</strong> (butter yellow)</li>\n</ul>\n</li>\n<li>Natural plant and microbial products:\n<ul>\n<li>Aflatoxin B1</li>\n<li>Griseofulvin</li>\n<li>Cycasin</li>\n<li>Safrole</li>\n<li>Betel nuts</li>\n<li>Others</li>\n<li>Nitrosamine and amides</li>\n<li>Vinyl chloride, nickel, chromium</li>\n<li>Insecticides, fungicides</li>\n<li>Polychlorinated biphenyls</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 45-year-old man presents with a hyperpigmented lesion on his face. He is a farmer by occupation and works for long hours with sun exposure. He is at increased risk for all of the following except:",
    "choices": [
      {
        "id": 1,
        "text": "Squamous cell carcinoma"
      },
      {
        "id": 2,
        "text": "Basal cell carcinoma"
      },
      {
        "id": 3,
        "text": "Seborrheic keratosis"
      },
      {
        "id": 4,
        "text": "Actinic keratosis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Seborrheic keratosis</strong> is <strong>not </strong>associated with exposure to ultraviolet (UV) rays from sun exposure.</p>\n<p><strong>UV rays</strong> derived from sun exposure are associated with the increased incidence of:</p>\n<ul>\n<li><strong>Squamous cell carcinoma</strong></li>\n<li><strong>Basal cell carcinoma</strong></li>\n<li>Melanoma of the skin</li>\n</ul>\n<p><strong>Actinic keratosis</strong> is a <strong>precancerous</strong> skin condition that can cause squamous cell cancer if untreated.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which form of radiation is responsible for cutaneous cancer?",
    "choices": [
      {
        "id": 1,
        "text": "Only UVA"
      },
      {
        "id": 2,
        "text": "Only UVB"
      },
      {
        "id": 3,
        "text": "Both UVB and UVC"
      },
      {
        "id": 4,
        "text": "Both UVA and UVC"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>UVB</strong> (ultraviolet B)&nbsp;causes&nbsp;<strong>cutaneous cancers&nbsp;</strong>due to the formation of <strong>pyrimidine dimers</strong> in DNA.&nbsp;</p>\n<p>When DNA absorbs energy from UVB, there is a&nbsp;<strong>covalent crosslinking</strong> of <strong>pyrimidine bases</strong> and distortion of the DNA helix. This prevents proper pairing of the dimer with bases in the opposite DNA strand.&nbsp;</p>\n<p>Normally, these defects&nbsp;are repaired by&nbsp;<strong>nucleotide excision repair</strong> pathway.&nbsp;Defects in nucleotide excision repair pathway result in <strong>xeroderma pigmentosum.</strong></p>\n<p><strong>UV</strong> portion of the <strong>solar spectrum</strong> is divided into three wavelength ranges:</p>\n<table style=\"height: 115px;\" width=\"308\">\n<tbody>\n<tr>\n<td style=\"width: 146px;\"><strong>Spectrum</strong></td>\n<td style=\"width: 146px;\"><strong>Wavelength</strong></td>\n</tr>\n<tr>\n<td style=\"width: 146px;\">UVA</td>\n<td style=\"width: 146px;\">320-400 nm</td>\n</tr>\n<tr>\n<td style=\"width: 146px;\">UVB</td>\n<td style=\"width: 146px;\">280-320 nm</td>\n</tr>\n<tr>\n<td style=\"width: 146px;\">UVC</td>\n<td style=\"width: 146px;\">200-280 nm</td>\n</tr>\n</tbody>\n</table>\n<p>Note: UVC is the most potent mutagen but is not considered significant as it is filtered out by the ozone layer.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Individuals with repeated exposure to ionizing radiation are at increased risk of which of the following malignancies?",
    "choices": [
      {
        "id": 1,
        "text": "Hodgkin lymphoma"
      },
      {
        "id": 2,
        "text": "Myeloid leukemia"
      },
      {
        "id": 3,
        "text": "Malignant melanoma"
      },
      {
        "id": 4,
        "text": "Squamous cell carcinoma"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Individuals with repeated <strong>exposure</strong> to <strong>ionizing radiation</strong> are at increased risk of&nbsp;<strong>myeloid leukemia.</strong></p>\n<p><strong>Carcinogenic radiations</strong> include:</p>\n<ul>\n<li><strong>Electromagnetic</strong>&nbsp;radiation -\n<ul>\n<li>X-rays</li>\n<li>&gamma; rays</li>\n</ul>\n</li>\n<li><strong>Particulate&nbsp;</strong>radiation -&nbsp;\n<ul>\n<li>&alpha; particles</li>\n<li>&beta; particles</li>\n<li>Protons</li>\n<li>Neutrons</li>\n</ul>\n</li>\n</ul>\n<p><strong>Cancers</strong> due to ionizing radiation:</p>\n<ul>\n<li>Most frequent - myeloid leukemia and thyroid cancer</li>\n<li>Intermediate frequency - cancers of breast, lungs, and salivary glands</li>\n<li>Relatively resistant cancers - cancers of skin, bone, and gastrointestinal tract</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following tumors is not caused by microbes?",
    "choices": [
      {
        "id": 1,
        "text": "Burkitt lymphoma"
      },
      {
        "id": 2,
        "text": "Castleman's disease"
      },
      {
        "id": 3,
        "text": "Adenocarcinoma lung"
      },
      {
        "id": 4,
        "text": "Primary effusion lymphoma"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Adenocarcinoma carcinoma</strong> of the <strong>lung </strong>is not associated with microbial etiopathogenesis. It is associated with <strong>smoking</strong> and <strong>genetic</strong> <strong>predispositions</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following malignancies is caused by HTLV-1?",
    "choices": [
      {
        "id": 1,
        "text": "Adult T-cell leukemia/ lymphoma"
      },
      {
        "id": 2,
        "text": "Enteropathy associated T-cell lymphoma"
      },
      {
        "id": 3,
        "text": "Diffuse large B cell lymphoma"
      },
      {
        "id": 4,
        "text": "B cell lymphomas"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Human T-cell leukemia-lymphoma virus (<strong>HTLV-1</strong>) causes adult T-cell leukemia/lymphoma (<strong>ATLL</strong>).</p>\n<p>HTLV-1<strong>&nbsp;</strong>encodes the viral protein <strong>Tax</strong>,<strong>&nbsp;</strong>which leads to polyclonal expansion of T cells. It exhibits tropism for CD4+ T cells.</p>\n<p>Human infection requires transmission of infected T cells through sexual intercourse, blood products or breast feeding. Leukemia develops only in 3-5% of infected individuals, typically after a long latent period of 40-60 years.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following pairs of HPV oncoproteins and target genes are correctly matched?",
    "choices": [
      {
        "id": 1,
        "text": "E6-RB, E7-p53"
      },
      {
        "id": 2,
        "text": "E6-p53, E7-RB"
      },
      {
        "id": 3,
        "text": "E5-RB, E6-p53"
      },
      {
        "id": 4,
        "text": "E5-p53, E6-RB"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The<strong> target genes</strong> for viral oncoproteins of human papilloma virus (<strong>HPV</strong>) are as follows:</p>\n<ul>\n<li>E6 - p53</li>\n<li>E7 - RB</li>\n</ul>\n<p>The image given below shows the functions of the E6 and E7 oncoproteins of HPV.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/08c5dd0f1d66435f9b8c7e3f4b47172ex1280x1382.JPEG"
    ]
  },
  {
    "text": "A 13-year-old child presents to the OPD with fever, pharyngitis, and cervical lymphadenopathy. Peripheral smear showed a predominance of lymphocytes. The heterophile agglutination test is positive. The causative organism of this condition is not implicated in which of the following tumors?",
    "choices": [
      {
        "id": 1,
        "text": "Burkitt lymphoma"
      },
      {
        "id": 2,
        "text": "Hodgkin's lymphoma"
      },
      {
        "id": 3,
        "text": "Nasopharyngeal carcinoma"
      },
      {
        "id": 4,
        "text": "Follicular lymphoma"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The clinical scenario is suggestive of\u00a0<strong>infectious mononucleosis</strong> caused by\u00a0<strong>Epstein-Barr virus. </strong>This virus<strong>\u00a0</strong>is not implicated in follicular lymphoma<strong>.</strong></p>\n<p>Epstein\u2013Barr virus (EBV), a member of the <strong>herpesvirus</strong> family, has been implicated in:</p>\n<ul>\n<li>African form of <strong>Burkitt lymphoma</strong></li>\n<li>B-cell lymphomas in immunosuppressed</li>\n<li>A subset of <strong>Hodgkin lymphoma</strong></li>\n<li><strong>Nasopharyngeal carcinoma</strong></li>\n<li>Gastric carcinoma - most common EBV associated malignancy</li>\n<li>T-cell lymphoma and natural killer (NK) cell lymphoma</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements about Epstein-Barr virus is incorrect?",
    "choices": [
      {
        "id": 1,
        "text": "EBV infection always results in Burkitt lymphoma"
      },
      {
        "id": 2,
        "text": "It uses the complement receptor CD21 to attach and infect B cells"
      },
      {
        "id": 3,
        "text": "It is implicated in B-cell lymphomas in immunosuppressed people"
      },
      {
        "id": 4,
        "text": "It is a potent inducer of B-cell growth and transformation"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Epstein-Barr<strong>\u00a0</strong>virus (<strong>EBV</strong>) infection does not always result in Burkitt lymphoma.</p>\n<p>EBV infection is highly prevalent even in areas where Burkitt lymphoma is not found. It commonly causes <strong>infectious mononucleosis</strong>.\u00a0</p>\n<p>EBV uses the complement receptor <strong>CD21</strong> to attach to and infect B cells. EBV genome <strong>triggers</strong>\u00a0B-cell signaling pathways inducing <strong>B-cell growth</strong> and transformation.\u00a0</p>\n<p>The infection of B cells is\u00a0<strong>latent\u00a0</strong>as\u00a0there is no viral replication and the cells are not killed.\u00a0However, B cells latently infected with EBV express\u00a0<strong>viral proteins</strong>\u00a0that result in the ability to<strong>\u00a0propagate indefinitely</strong>\u00a0in vitro.\u00a0In the <strong>absence</strong> of<strong> T-cell</strong> immunity, EBV-infected B cells can rapidly grow out as <strong>aggressive</strong> B-cell <strong>tumors</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following pathogens is implicated in the causation of primary effusion lymphoma and Castleman disease?",
    "choices": [
      {
        "id": 1,
        "text": "JC virus"
      },
      {
        "id": 2,
        "text": "Polyoma BK virus"
      },
      {
        "id": 3,
        "text": "EBV"
      },
      {
        "id": 4,
        "text": "HHV 8"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Human herpesvirus 8 (<strong>HHV8</strong>) is a gamma-herpesvirus associated with Kaposi sarcoma, multicentric <strong>Castleman</strong> disease, and <strong>primary effusion</strong> <strong>lymphoma</strong>.</p>\n<p>They are lymphoproliferative diseases that are most commonly observed in <strong>immunocompromised</strong> individuals.\u00a0The viral genome expresses genes responsible for inhibition of apoptosis, cell cycle entry, and angiogenesis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient presents with abdominal distension and intermittent fever. Peripheral smear findings are normal. A tumor is resected and the histopathology image of the resected lymph node is shown below. What is the most probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Angiolymphoma"
      },
      {
        "id": 2,
        "text": "Hodgkin's lymphoma"
      },
      {
        "id": 3,
        "text": "IgG4-related disease"
      },
      {
        "id": 4,
        "text": "Castleman disease"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical scenario and histopathological image showing <strong>follicular hyperplasia</strong> of lymph nodes are suggestive of <strong>Castleman disease</strong>.</p>\n<p><strong>Castleman disease </strong>(angiofollicular&nbsp;lymph node hyperplasia) is a lymphoproliferative disorder that can be associated with <strong>HHV-8</strong> (multicentric Castleman disease or MCD) or idiopathic (unicentric Castleman disease or UCD)</p>\n<p>There are 3 major histological <strong>subtypes</strong>:</p>\n<ul>\n<li style=\"font-weight: 400;\"><strong>Hypervascular</strong>&nbsp;(UCD) - &nbsp;\n<ul>\n<li style=\"font-weight: 400;\">Lollipop appearance - atrophic germinal centers with radially penetrating blood vessels</li>\n<li style=\"font-weight: 400;\">Onion skin appearance of mantle zone around germinal centers</li>\n</ul>\n</li>\n<li style=\"font-weight: 400;\"><strong>Plasma cell</strong> subtype (UCD or MCD) -&nbsp;hypertrophic germinal centers, increased vascularity</li>\n<li style=\"font-weight: 400;\"><strong>Mixed</strong> variant (MCD) - mix of hypervascular and plasma cell subtype features in the same lymph node</li>\n</ul>\n<p>The <strong>clinical features</strong> include:</p>\n<ul>\n<li style=\"font-weight: 400;\">Multiple enlarged lymph nodes</li>\n<li style=\"font-weight: 400;\">Night sweats</li>\n<li style=\"font-weight: 400;\">Weight loss</li>\n<li style=\"font-weight: 400;\">Weakness and fatigue</li>\n<li style=\"font-weight: 400;\">Hepatosplenomegaly&nbsp;</li>\n</ul>\n<p>As this condition is associated with elevated levels of IL-6, the treatment involves&nbsp;<strong>IL-6 inhibitors </strong>like <strong>siltuximab </strong>and<strong> tocilizumab.</strong></p>\n<p>Note:<strong>&nbsp;</strong>Hodgkin's lymphoma has characteristic <strong>Reed-Sternberg cells</strong> in the histopathological section of lymph nodes.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e8c76803f2174861ab20e9539750dd3d.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following is an EBV oncogene behaving like a constitutively active CD40 receptor?",
    "choices": [
      {
        "id": 1,
        "text": "LMP-1"
      },
      {
        "id": 2,
        "text": "EBNA-2"
      },
      {
        "id": 3,
        "text": "EBNA-1"
      },
      {
        "id": 4,
        "text": "LMP-2"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>LMP-1 </strong>is an<strong> EBV oncogene </strong>that<strong>\u00a0</strong>behaves like a constitutively <strong>active CD40 receptor</strong>.</p>\n<p>The CD40 receptor-like activity stimulates B-cell growth.\u00a0LMP-1 activates the <strong>NF-\u03baB</strong> and <strong>JAK</strong> / <strong>STAT</strong> signaling pathways and promotes B-cell survival. It also prevents apoptosis by activating <strong>BCL2</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Helicobacter pylori increases the risk of development of which of the following conditions?",
    "choices": [
      {
        "id": 1,
        "text": "1, 3, 5"
      },
      {
        "id": 2,
        "text": "2, 4, 5"
      },
      {
        "id": 3,
        "text": "1, 2, 4"
      },
      {
        "id": 4,
        "text": "1, 3, 4"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong><em>Helicobacter pylori</em></strong> is implicated in the following conditions:</p>\n<ul>\n<li>Peptic ulcer</li>\n<li>Gastric adenocarcinoma&nbsp;- preceded by chronic gastritis, gastric atrophy, intestinal metaplasia, and dysplasia</li>\n<li>MALT lymphoma of the stomach - through polyclonal B cell proliferation</li>\n</ul>\n<p><em>Helicobacter pylori</em>&nbsp;is<em>&nbsp;</em><strong>protective</strong> for:</p>\n<ul>\n<li>Barrett's esophagus</li>\n<li>Adenocarcinoma of esophagus</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is the most common endocrinopathy caused by tumors?",
    "choices": [
      {
        "id": 1,
        "text": "Cushing syndrome"
      },
      {
        "id": 2,
        "text": "Osteomalacia"
      },
      {
        "id": 3,
        "text": "SIADH"
      },
      {
        "id": 4,
        "text": "Hypercalcemia"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Cushing syndrome </strong>is the most common <strong>endocrinopathy&nbsp;</strong>caused by tumors<strong>.</strong></p>\n<p>Endocrinopathy refers to <strong>ectopic hormone </strong>production by <strong>non-endocrine</strong> <strong>tumors</strong>. Approximately, 50% of the individuals with Cushing syndrome as endocrinopathy have carcinoma of the lung, chiefly the <strong>small-cell type</strong>.</p>\n<p><strong>Hypercalcemia </strong>is the most common <strong>paraneoplastic</strong> syndrome.&nbsp;Cancer-associated hypercalcemia occurs due to:</p>\n<ul>\n<li><strong>Osteolysis</strong> induced by cancer - due to primary or secondary involvement of the skeleton by tumor</li>\n<li>Production of <strong>calcemic humoral</strong> substances by <strong>extraosseous</strong> neoplasms - for example, parathyroid hormone-related protein. Only this mechanism is considered to be paraneoplastic.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Patients with which of the following tumors present with pure red cell aplasia as a paraneoplastic manifestation?",
    "choices": [
      {
        "id": 1,
        "text": "Pancreatic carcinoma"
      },
      {
        "id": 2,
        "text": "Renal carcinoma"
      },
      {
        "id": 3,
        "text": "Thymoma"
      },
      {
        "id": 4,
        "text": "Acute myeloid leukemia"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Thymoma </strong>often presents with<strong> pure red cell aplasia </strong>as a paraneoplastic manifestation.</p>\n<p>Thymomas are unusual neoplasms of <strong>thymic</strong> <strong>epithelial</strong> tissue, ranging from small indolent tumors to aggressive thymic carcinomas.</p>\n<p><strong>Pure red cell aplasia</strong> is a rare cause of anemia, caused by the&nbsp;<strong>absence</strong> of RBC&nbsp;<strong>precursors</strong> in the bone marrow.&nbsp;<strong>Causes</strong>&nbsp;of&nbsp;pure&nbsp;red cell aplasia&nbsp;include:</p>\n<ul>\n<li>Neoplasms -&nbsp;thymomas&nbsp;and large granular lymphocytic&nbsp;leukemia</li>\n<li>Drug exposure - phenytoin, azathioprine, and isoniazid</li>\n<li>Auto-immune disorders - neutralizing antibodies against erythropoietin</li>\n<li>Parvovirus&nbsp;infection</li>\n<li>Hereditary -&nbsp;Diamond Blackfan syndrome</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which subtype of acute myeloid leukemia presents with disseminated intravascular coagulation as a paraneoplastic manifestation?",
    "choices": [
      {
        "id": 1,
        "text": "AML minimally differentiated"
      },
      {
        "id": 2,
        "text": "Acute promyelocytic leukemia"
      },
      {
        "id": 3,
        "text": "Acute myelomonocytic leukemia"
      },
      {
        "id": 4,
        "text": "Acute megakaryoblastic leukemia"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Disseminated intravascular coagulation&nbsp;(<strong>DIC</strong>) as a paraneoplastic syndrome is most commonly associated with <strong>acute promyelocytic leukemia&nbsp;</strong>(APL) and<strong> prostatic adenocarcinoma.</strong></p>\n<p>Major determinants of coagulopathy in APL are endogenous factors of the malignant leukemic cells and their interaction with host defense mechanisms.</p>\n<p><strong>Factors</strong> that cause coagulopathy include:</p>\n<ul>\n<li>Increased expression of procoagulant activity (PCA)</li>\n<li>Expression of fibrinolytic and proteolytic properties</li>\n<li>Secretion of pro-inflammatory cytokines - interleukin-1b (IL-1b) and tumor necrosis factor (TNF)</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 60-year-old patient presents with loss of weight and appetite. On clinical examination, grade IV clubbing is evident. Imaging shows periosteal new bone formation and synovial effusion. Which of the following tumors is associated with this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Bronchogenic carcinoma"
      },
      {
        "id": 2,
        "text": "Carcinoma of the pancreas"
      },
      {
        "id": 3,
        "text": "Esophageal carcinoma"
      },
      {
        "id": 4,
        "text": "Acute myeloid leukaemia"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical history is suggestive of <strong>hypertrophic osteoarthropathy. </strong>It is commonly associated with <strong>bronchiogenic carcinoma.</strong></p>\n<p>Hypertrophic osteoarthropathy is characterised by the following:</p>\n<ul>\n<li><strong>Periosteal new bone formation</strong>, primarily at the distal ends of long bones, metatarsals, metacarpals, and proximal phalanges</li>\n<li><strong>Arthritis</strong> of the adjacent joints</li>\n<li><strong>Clubbing</strong> of the digits</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 55-year-old patient presents with generalized tiredness, malaise, muscle weakness, and bone pain. Laboratory investigations reveal serum calcium to be 13 mg/dL.  Which of the following is lung cancers is implicated in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Squamous cell carcinoma of lung"
      },
      {
        "id": 2,
        "text": "Adenosquamous carcinoma of lung"
      },
      {
        "id": 3,
        "text": "Small cell carcinoma of lung"
      },
      {
        "id": 4,
        "text": "Large cell carcinoma of lung"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical history and laboratory investigations are suggestive of <strong>hypercalcemia.</strong>&nbsp;It is associated with<strong> squamous cell carcinoma </strong>of the<strong> lung.</strong></p>\n<p>Tumors associated with <strong>paraneoplastic hypercalcemia</strong>:</p>\n<ul>\n<li>Breast carcinoma</li>\n<li>Lung carcinoma</li>\n<li>Renal cell carcinoma</li>\n<li>Ovarian carcinoma</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following paraneoplastic manifestations is likely to occur in a patient with a phosphaturic mesenchymal tumor?",
    "choices": [
      {
        "id": 1,
        "text": "Cushing syndrome"
      },
      {
        "id": 2,
        "text": "Osteomalacia"
      },
      {
        "id": 3,
        "text": "SIADH"
      },
      {
        "id": 4,
        "text": "Polycythemia"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Phosphaturic mesenchymal tumor</strong> presents with <strong>osteomalacia</strong> as a paraneoplastic manifestation.</p>\n<p>Phosphaturic mesenchymal tumor is caused due to mutation of the <strong>FGF-23 gene</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 48-year-old obese female presents with skin changes in her axilla and neck as shown in the image. Which of the following tumors is not associated with this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Gastric carcinoma"
      },
      {
        "id": 2,
        "text": "Bladder carcinoma"
      },
      {
        "id": 3,
        "text": "Uterine carcinoma"
      },
      {
        "id": 4,
        "text": "Thymoma"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical picture is suggestive of<strong>&nbsp;acanthosis nigricans. </strong>It is not associated with thymoma.</p>\n<p>Acanthosis nigricans is a disorder characterized by gray-black patches of thickened, <strong>hyperkeratotic</strong> skin with a velvety appearance. The causal mechanism is immunologic due to secretion of<strong> epidermal growth factor.</strong></p>\n<p>Acanthosis nigricans is commonly associated with:</p>\n<ul>\n<li><strong>Gastric carcinoma</strong></li>\n<li>Lung carcinoma</li>\n<li><strong>Gynecological cancers</strong></li>\n<li>Breast carcinoma</li>\n<li><strong>Bladder carcinoma</strong></li>\n<li>Gallbladder and bile-duct carcinoma</li>\n<li>Acromegaly and gigantism</li>\n<li>Dermatomyositis</li>\n<li>Diabetes</li>\n<li>Hashimoto thyroiditis</li>\n<li>Lupus erythematosus</li>\n<li>Phenylketonuria</li>\n<li>Polycystic ovary syndrome</li>\n<li>Systemic sclerosis</li>\n<li>Wilson syndrome</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c8285a5da2d94d10a7bff5f2e8f1d92a.jpg"
    ],
    "explanation_images": []
  },
  {
    "text": "A 45-year-old patient presents with headache, vertigo, tinnitus, and visual disturbance. On further evaluation, blood hemoglobin and hematocrit levels are found to be 18 g/dL and 62% respectively. Which of the following tumors does not present with these paraneoplastic manifestations?",
    "choices": [
      {
        "id": 1,
        "text": "Melanoma"
      },
      {
        "id": 2,
        "text": "Renal cell carcinoma"
      },
      {
        "id": 3,
        "text": "Cerebellar hemangioma"
      },
      {
        "id": 4,
        "text": "Hepatocellular carcinoma"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical history and laboratory investigations are suggestive of <strong>polycythemia</strong> which is not seen in&nbsp;melanoma&nbsp;as a paraneoplastic manifestation.</p>\n<p>Polycythemia, as a paraneoplastic syndrome, is mediated by <strong>erythropoietin</strong> (EPO). EPO is a glycoprotein that induces differentiation of erythrocyte colony-forming units in the bone marrow to promote red blood cell production.&nbsp;</p>\n<p>Under normal physiological conditions, EPO is produced by <strong>peritubular renal interstitial cells </strong>in response to<strong> local tissue hypoxia.</strong> However, in tumors, EPO production occurs in the neoplastic cells themselves.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of these paraneoplastic syndromes is associated with small-cell carcinoma lung?",
    "choices": [
      {
        "id": 1,
        "text": "Osteomalacia"
      },
      {
        "id": 2,
        "text": "SIADH"
      },
      {
        "id": 3,
        "text": "Polycythemia"
      },
      {
        "id": 4,
        "text": "Hypercalcemia"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Syndrome of inappropriate antidiuretic hormone (<strong>SIADH</strong>) is associated with <strong>small cell carcinoma</strong> of <strong>lung</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 60-year-old patient notices spontaneously appearing and disappearing painful, linearly arranged nodules in different parts of the body. Which of the following malignancies is not associated with this clinical presentation?",
    "choices": [
      {
        "id": 1,
        "text": "Uterine carcinoma"
      },
      {
        "id": 2,
        "text": "Pancreatic carcinoma"
      },
      {
        "id": 3,
        "text": "Bronchogenic carcinoma"
      },
      {
        "id": 4,
        "text": "Bladder carcinoma"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical presentation is suggestive of <strong>migratory thrombophlebitis</strong> (Trousseau syndrome) and it is not associated with <strong>bladder carcinoma.</strong></p>\n<p><strong>Trousseau syndrome&nbsp;</strong>may be encountered in association with deep-seated cancers, most often carcinomas of the <strong>pancreas </strong>or<strong> lung. </strong>It is caused by hypercoagulability leading to multiple repeated venous thromboembolism.</p>\n<p>Malignant brain tumors, hematological malignancies, and adenocarcinomas of the pancreas, stomach, ovary, <strong>uterus</strong>, lungs, and kidneys are at the&nbsp;highest risk of venous thromboembolism (VTE) development.</p>\n<p>Advanced, metastatic cancer has been shown to be associated with an increased risk of VTE compared with localized tumors.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 24-year-old patient with paroxysmal hypertension is suspected to have malignant pheochromocytoma. Which of the following tumor markers will help you confirm your diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Calcitonin"
      },
      {
        "id": 2,
        "text": "Catecholamine"
      },
      {
        "id": 3,
        "text": "\u03b1-fetoprotein"
      },
      {
        "id": 4,
        "text": "Carcinoembryonic antigen"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The serum levels of <strong>catecholamines</strong> are elevated in malignant <strong>pheochromocytoma</strong>. Extra-adrenal location is the only criteria for malignancy in pheochromocytoma.</p>\n<p><strong>Pheochromocytoma</strong>&nbsp;is a rare&nbsp;<strong>catecholamine-secreting tumor</strong> that may precipitate life-threatening <strong>hypertension</strong>.&nbsp;It is classically associated with three syndromes:</p>\n<ul>\n<li>von Hippel-Lindau (<strong>VHL</strong>) syndrome</li>\n<li>Multiple endocrine neoplasia type 2 (<strong>MEN 2</strong>)</li>\n<li>Neurofibromatosis type 1 (<strong>NF1</strong>)</li>\n</ul>\n<p><strong>Catecholamines</strong> produced by pheochromocytomas are metabolized within chromaffin cells. <strong>Norepinephrine</strong> is metabolized to <strong>normetanephrine,</strong> and <strong>epinephrine</strong> is metabolized to <strong>metanephrine</strong>. Because this process occurs within the tumor, independent of catecholamine release, pheochromocytomas are best diagnosed by the measurement of these metabolites, rather than by measurement of the parent catecholamines.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following are oncofetal antigens?",
    "choices": [
      {
        "id": 1,
        "text": "1 and 3"
      },
      {
        "id": 2,
        "text": "1, 3 and 4"
      },
      {
        "id": 3,
        "text": "3, 4 and 5"
      },
      {
        "id": 4,
        "text": "1 and 2"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Alpha-fetoprotein </strong>(AFP)<strong>&nbsp;</strong>and<strong> carcinoembryonic antigen</strong> (CEA)&nbsp;are oncofetal antigens.</p>\n<p><strong>Alpha-fetoprotein</strong> is a valuable clinical aid in diagnosis, prognosis, and monitoring of the following tumors:</p>\n<ul>\n<li>Primary hepatocellular carcinoma</li>\n<li>Hepatoblastoma</li>\n<li>Non-seminomatous testicular germ cell tumors</li>\n<li>Embryonal carcinoma</li>\n<li>Teratomas</li>\n<li>Choriocarcinoma</li>\n<li>Yolk sac carcinoma</li>\n<li>Germ cell tumors of the&nbsp;ovary and extragonadal germ cell tumors</li>\n</ul>\n<p><strong>Regenerated hepatic tissue</strong> following liver damage due to viral hepatitis, chemically induced necrosis, and liver surgery are associated with moderately <strong>raised</strong> serum <strong>AFP</strong> levels.</p>\n<p><strong>Carcinoembryonic antigen</strong> is normally detected in <strong>glycocalyx</strong> of fetal epithelial cells.&nbsp;It is useful in detection, assessing recurrence, and&nbsp;prognosis of the following tumors:</p>\n<ul>\n<li>Adenocarcinoma of lung</li>\n<li>Colorectal carcinoma</li>\n</ul>\n<p>CEA levels <strong>&gt;5 ng/dL</strong> are noted in ascites fluid associated with <strong>malignancy</strong>. Canalicular pattern for polyclonal CEA more sensitive for hepatocellular carcinoma, metastases in pancreatic adenocarcinoma&nbsp;and not sensitive for metastasis in bile duct adenoma.</p>\n<p>Elevated levels are also present in the following <strong>non-neoplastic</strong> conditions:</p>\n<ul>\n<li>Cirrhosis</li>\n<li>Biliary obstruction</li>\n<li>Hepatitis</li>\n<li>Inflammatory bowel disease</li>\n<li>Smokers</li>\n<li>Post-surgical bowel sequestration</li>\n<li>Mucocele</li>\n<li>Benign cysts may be positive for carcinoembryonic antigen</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 42-year-old patient is diagnosed with breast cancer. Which of the following glycoproteins is expected to be elevated in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "CA-125"
      },
      {
        "id": 2,
        "text": "CA-19-9"
      },
      {
        "id": 3,
        "text": "CA-15-3"
      },
      {
        "id": 4,
        "text": "CA-5-13"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The level of cancer antigen 15-3 (<strong>CA 15-3</strong>) is elevated in patients with&nbsp;<strong>breast cancer</strong>.</p>\n<p>The reference range of serum CA 15-3 is less than <strong>30 U/mL.&nbsp;</strong>It is used to monitor<strong> response </strong>to breast cancer<strong> treatment</strong> and disease <strong>recurrence</strong>.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 51-year-old male patient who is a chronic smoker presents with dry persistent cough and progressive dyspnea. You are suspecting small cell carcinoma of lung. Which of the following tumor markers is likely to be elevated in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Lactate dehydrogenase"
      },
      {
        "id": 2,
        "text": "Acid phosphatase"
      },
      {
        "id": 3,
        "text": "Neuron-specific enolase"
      },
      {
        "id": 4,
        "text": "Thymidine kinase"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario is suggestive of <strong>small cell carcinoma</strong> of the <strong>lung</strong> (SCLC) in which levels of<strong> neuron-specific enolase </strong>(NSE)&nbsp;are elevated.</p>\n<p><strong>NSE</strong>&nbsp;is also called gamma enolase or enolase 2 (ENO2) and is encoded by <strong>ENO2</strong> <strong>gene</strong>. It is a phosphopyruvate hydratase that is produced by small-cell lung carcinomas, which are <strong>neuroendocrine </strong>in origin. Their levels&nbsp;have been implicated as a <strong>prognostic</strong> <strong>factor</strong> for patients with small-cell lung cancer.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not a marker for gastrointestinal stromal tumors?",
    "choices": [
      {
        "id": 1,
        "text": "KIT"
      },
      {
        "id": 2,
        "text": "SDH"
      },
      {
        "id": 3,
        "text": "PDGFRA"
      },
      {
        "id": 4,
        "text": "NRG-1"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Succinate dehydrogenase</strong> (SDH)-deficient GIST is a subset of wild-type GIST seen with Carney triad or Carney-Stratakis syndrome.\u00a0</p>\n<p><strong>Imatinib</strong> can be used to treat GIST with mutations in <strong>KIT</strong> or <strong>PDGFRA.</strong> Succinate dehydrogenase (SDH) - deficient GIST is imatinib-resistant, so sunitinib, sorafenib, or regorafenib can be used instead.\u00a0</p>\n<p>During surgical resection of GIST, care must be taken to prevent capsule rupture, which causes <strong>seeding</strong> of <strong>nearby tissues</strong> leading to <strong>relapse</strong> in <strong>100%</strong> of the <strong>cases.</strong> If capsule rupture occurs, adjuvant therapy with imatinib is indicated regardless of tumor extent.</p>\n<p>Other options:</p>\n<p>Option A: <strong>KIT (CD117):</strong> This is the most well-known marker for GISTs. About 85% of GISTs show mutations in the KIT gene, leading to the expression of the KIT protein on the cell surface. KIT is a receptor tyrosine kinase, and its activation is a key driver in the pathogenesis of GISTs.</p>\n<p>Option B: <strong>SDH (Succinate</strong> Dehydrogenase): SDH mutations are associated with a subset of GISTs, particularly those that are KIT and PDGFRA wild-type. Loss of SDH function is characteristic of this subgroup, and SDH deficiency can be demonstrated through immunohistochemistry.</p>\n<p>Option C: <strong>PDGFRA</strong> (Platelet-Derived Growth Factor Receptor Alpha): Mutations in the PDGFRA gene account for approximately 5-10% of GISTs. Similar to KIT, PDGFRA is a receptor tyrosine kinase, and mutations in this gene can lead to the development of GISTs.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a9bf9b67e36847358296aa149b9b4ea8x1280x1033.JPEG"
    ]
  }
];
        let quizName = '13 Carcinogenesis, Paraneoplastic Syndromes And Tumor Markers';
        let hierarchy = ["Marrow", "qBank", "Pathology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>